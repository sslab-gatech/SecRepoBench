Ensure that memory is released only once by carefully tracking the ownership and lifecycle of dynamically allocated resources. In this particular situation, avoid releasing the `stream` memory within error handling blocks if it is already released elsewhere, such as at the end of the function.