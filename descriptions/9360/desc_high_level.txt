// Extract a named macro definition from the string starting at 'start' and
// ending at 'end', and add it to the 'macros' splay tree with the macro name
// as the key. The extraction loop processes tokens between the initial "push"
// and a corresponding "pop", skipping comments and counting nested "push"
// and "pop" commands to handle nested structures correctly. Once a matching
// "pop" is found and the nesting level falls below zero, the macro is extracted
// and stored in the tree.