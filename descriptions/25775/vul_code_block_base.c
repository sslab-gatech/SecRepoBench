        i += 8;
        if (size < 8 || p->buf_size - i < size)
            return 0;
