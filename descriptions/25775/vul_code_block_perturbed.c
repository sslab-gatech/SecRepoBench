        i += 8;
        if (length < 8 || p->buf_size - i < length)
            return 0;
