level++;
q=subexpression;
for (p++; *p != '\0'; )
{
  if (*p == '[')
    level++;
  else
    if (*p == ']')
      {
        level--;
        if (level == 0)
          break;
      }
  *q++=(*p++);
}
*q='\0';
ssize_t result = (ssize_t) FxEvaluateSubexpression(fx_info, channel, x, y, subexpression, &depth, NULL, exception);
p++;
imageindex += result;