level++;
              q=subexpression;
              for (p++; *p != '\0'; )
              {
                if (*p == '[')
                  level++;
                else if (*p == ']')
                {
                  level--;
                  if (level == 0)
                    break;
                }
                if (q - subexpression < MagickPathExtent - 1) // Ensure we don't overflow
                {
                  *q++ = *p;
                }
                p++;
              }
              *q = '\0'; // Null-terminate the subexpression