level++;
              q=subexpression;
              for (p++; *p != '\0'; )
              {
                if (*p == '[')
                  level++;
                else
                  if (*p == ']')
                    {
                      level--;
                      if (level == 0)
                        break;
                    }
                if ((q - subexpression) >= (MagickPathExtent - 1))
                  {
                    *q = '\0';
                    (void) ThrowMagickException(exception,GetMagickModule(),
                      OptionError,"SubexpressionTooLong","`%s'",expression);
                    return(0.0);
                  }
                *q++=(*p++);
              }
              *q='\0';
              alpha=FxEvaluateSubexpression(fx_info,channel,x,y,subexpression,
                &depth,&beta,exception);
              imageindex=(ssize_t) alpha;
              if (*p != '\0')
                p++;
            }