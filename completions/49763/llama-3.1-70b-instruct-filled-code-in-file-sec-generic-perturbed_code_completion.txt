for (size_t i=ydigits-1; i>=0; i--) {
  mp_dbl_limb q = 0;
  mp_dbl_limb_signed r = 0;
  mp_limb y0 = y.p[i];
  mp_limb x0 = x.p[i];
  mp_dbl_limb b = (mp_dbl_limb)y0 << DIG_SIZE;
  mp_dbl_limb a = (mp_dbl_limb)x0 + r;
  if (a < b) {
    q = 0;
    r = a;
  }
  else {
    q = 1;
    r = a - b;
  }
  for (size_t j=i+1; j<xd; j++) {
    a = (mp_dbl_limb)x.p[j] + r;
    b = (mp_dbl_limb)y0 * q + (mp_dbl_limb)y.p[j];
    if (a < b) {
      q = q << DIG_SIZE;
      r = a;
    }
    else {
      q = (q << DIG_SIZE) + 1;
      r = a - b;
    }
  }
  q = (q << DIG_SIZE) + (mp_dbl_limb)x.p[xd] + r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  for (size_t j=0; j<xd-i; j++) {
    x.p[i+j] -= (mp_limb)r;
    r >>= DIG_SIZE;
  }
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y0;
  x.p[xd] -= (mp_limb)r;
  r >>= DIG_SIZE;
  q = (mp_dbl_limb)x.p[xd] - r;
  q = q / (mp_dbl_limb)y0;
  r = q * (mp_dbl_limb)y