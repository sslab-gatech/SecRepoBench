for (i = xd - ydigits; i >= 0; i--) {
  mp_limb_t qd;
  mp_dbl_limb n = ((mp_dbl_limb)x.p[i+ydigits] << DIG_SIZE) | x.p[i+ydigits-1];
  qd = n / z;
  if (qd > MP_LIMB_MAX) qd = MP_LIMB_MAX;
  while (qd > 0 && umul_sub(&x.p[i], &y, qd, ydigits) < 0) qd--;
  q.p[i] = qd;
}