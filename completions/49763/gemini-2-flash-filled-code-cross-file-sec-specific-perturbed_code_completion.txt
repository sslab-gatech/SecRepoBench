for (i=xd; i-- > ydigits;) {
    mp_dbl_limb xx = ((mp_dbl_limb)x.p[i] << DIG_SIZE) | x.p[i-1];
    mp_limb d = (mp_limb)(xx / z);
    mpz_t tmp;
    mpz_init(mrb, &tmp);
    mpz_set_int(mrb, &tmp, d);
    mpz_realloc(mrb, &y, ydigits);
    tmp.sz = ydigits;
    mpz_mul_int(mrb, &tmp, &y, d);
    if (ucmp(&x, &tmp) < 0) {
      d--;
      mpz_set_int(mrb, &tmp, d);
      mpz_realloc(mrb, &y, ydigits);
      tmp.sz = ydigits;
      mpz_mul_int(mrb, &tmp, &y, d);
    }
    q.p[i-ydigits] = d;
    mpz_sub(mrb, &x, &x, &tmp);
    mpz_clear(mrb, &tmp);
  }