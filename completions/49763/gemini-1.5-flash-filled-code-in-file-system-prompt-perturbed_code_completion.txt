for (i=xd-1; i>=ydigits-1; i--) {
    mp_dbl_limb v = (i==xd-1)?(x.p[i]):((mp_dbl_limb)x.p[i] << DIG_SIZE | x.p[i+1]);
    mp_limb q0 = v / z;
    if (q0 >= base) q0 = base -1;
    mp_dbl_limb c = (mp_dbl_limb)q0 * z;
    size_t k;
    for (k=0; k<ydigits; k++) {
      c += (mp_dbl_limb)x.p[i-k] - (mp_dbl_limb)y.p[ydigits-1-k]*q0;
      x.p[i-k] = LOW(c);
      c >>= DIG_SIZE;
    }
    if (c) {
      q0--;
      for (k=0; k<ydigits; k++) {
        x.p[i-k] += y.p[ydigits-1-k];
      }
    }
    q.p[i-(ydigits-1)] = q0;
  }