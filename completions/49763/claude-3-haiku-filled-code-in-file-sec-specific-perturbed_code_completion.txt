mp_dbl_limb z = y.p[ydigits-1];
if (z == 0) {
  mrb_raise(mrb, E_ZERODIV_ERROR, "division by zero");
}
for (i = xd-ydigits; i >= 0; i--) {
  mp_dbl_limb q;
  if (x.p[i+ydigits-1] == z) {
    q = DIG_MASK;
  }
  else {
    q = (((mp_dbl_limb)x.p[i+ydigits] << DIG_SIZE) + x.p[i+ydigits-1]) / z;
  }
  mp_dbl_limb r = 0;
  for (j = 0; j < ydigits; j++) {
    mp_dbl_limb p = (mp_dbl_limb)y.p[j] * q;
    r += (mp_dbl_limb)x.p[i+j] - (p & DIG_MASK);
    x.p[i+j] = LOW(r);
    r = HIGH(r) - (p >> DIG_SIZE);
  }
  r += x.p[i+ydigits];
  x.p[i+ydigits] = LOW(r);
  q = HIGH(r);
  if (q) {
    for (j = 0; j < ydigits && q; j++) {
      r = (mp_dbl_limb)x.p[i+j] + y.p[j];
      x.p[i+j] = LOW(r);
      q = HIGH(r);
    }
    if (q) {
      x.p[i+ydigits]++;
    }
  }
  q = LOW(q);
  w.p[i] = q;
}