for (i = xd - 1; i-- > ydigits - 1;) {
    mp_dbl_limb xi = x.p[i + ydigits - 1];
    mp_dbl_limb qi = xi / z;
    q.p[i] = qi;
    mp_dbl_limb ri = xi % z;
    size_t j;
    for (j = 0; j < ydigits; j++) {
      mp_dbl_limb t = qi * y.p[j];
      if (i + j >= xd) break;
      x.p[i + j] -= t;
    }
    for (j = 0; j < ydigits; j++) {
      if (x.p[i + j] > y.p[j]) {
        x.p[i + j] += y.p[j];
        q.p[i]--;
      }
    }
  }