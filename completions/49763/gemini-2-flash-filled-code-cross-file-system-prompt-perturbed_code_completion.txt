for (i=xd; i-- > ydigits;) {
    mp_dbl_limb xx = ((mp_dbl_limb)x.p[i] << DIG_SIZE) + x.p[i-1];
    mp_limb qhat = (mp_limb)(xx / z);
    if (qhat > MAX_MP_LIMB)
      qhat = MAX_MP_LIMB;
    x.p[i] -= umul_ppmm(x.p+i-ydigits, y.p, ydigits, qhat);
    while (x.p[i] & MP_LIMB_HIGH_BIT) {
      qhat--;
      x.p[i] += umul_ppmm(x.p+i-ydigits, y.p, ydigits, 1);
    }
    q.p[i-ydigits] = qhat;
  }
  mpz_set(mrb, &x, x);