size_t xdigits = digits(&x);
for (i = xdigits - ydigits; i >= 0; i--) {
  mp_dbl_limb q = (x.p[i + ydigits - 1] * RADIX + x.p[i + ydigits - 2]) / z;
  mp_dbl_limb r = (x.p[i + ydigits - 1] * RADIX + x.p[i + ydigits - 2]) - q * y.p[ydigits - 1];
  while (r < RADIX && q > 0) {
    q--;
    r += y.p[ydigits - 1];
  }
  x.p[i + ydigits] -= q;
  for (size_t j = 0; j < ydigits; j++) {
    x.p[i + j] = x.p[i + j] - q * y.p[j];
  }
  q.p[i] = q;
}