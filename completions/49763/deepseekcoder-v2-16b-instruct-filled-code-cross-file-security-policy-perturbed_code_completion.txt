/* long division algorithm */
  for (i = xd; i >= ydigits; i--) {
    mp_dbl_limb z = y.p[ydigits - 1];
    if (xd >= ydigits) {
      mp_dbl_limb qhat = (mp_dbl_limb)x.p[i] * (mp_dbl_limb)DIG_SIZE + x.p[i - 1];
      qhat /= z;
      mp_dbl_limb rhat = (mp_dbl_limb)x.p[i] * (mp_dbl_limb)DIG_SIZE + x.p[i - 1];
      rhat %= z;
      mp_dbl_limb k = 1;
      while (k < DIG_SIZE && (qhat * z + (mp_dbl_limb)y.p[ydigits - 1 + k]) > (mp_dbl_limb)x.p[i] * (mp_dbl_limb)DIG_SIZE + x.p[i - 1 + k]) {
        qhat--;
        rhat += z;
        k++;
      }
      ulshift(mrb, &q, &q, 1);
      q.p[0] = qhat;
      trim(&q);
      umul(mrb, &t, &q, &y);
      usub(mrb, &t, &x, &t);
      if (ucmp(&t, &y) <= 0) {
        uadd(mrb, &q, &q, &one);
        usub(mrb, &t, &t, &y);
      }
      trim(&t);
      urshift(mrb, &t, &t, 1);
      urshift(mrb, &q, &q, 1);
      umove(mrb, &x, &t);
    }
  }