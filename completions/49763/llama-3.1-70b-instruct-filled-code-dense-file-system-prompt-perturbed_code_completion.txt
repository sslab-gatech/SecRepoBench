for (i = xd - 1; i >= 0; i--) {
  mp_dbl_limb qhat = (mp_dbl_limb)q.p[i] << DIG_SIZE | (i > 0? q.p[i - 1] : 0);
  mp_dbl_limb rhat = (mp_dbl_limb)x.p[xd - 1 - i] << DIG_SIZE | (i < xd - 1? x.p[xd - 2 - i] : 0);
  mp_dbl_limb dhat = (mp_dbl_limb)z * qhat;
  mp_dbl_limb_signed tmp = (mp_dbl_limb_signed)rhat - dhat;
  if (tmp < 0) {
    q.p[i]--;
    tmp += (mp_dbl_limb)y.p[ydigits - 1];
  }
  usub(mrb, &x, &x, &y);
  if (i > 0)
    x.p[i - 1] = (mp_limb)tmp;
}