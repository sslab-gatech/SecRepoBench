for (i = 0; i < xd - ydigits + 1; i++) {
    mp_dbl_limb xi = x.p[i + ydigits - 1];
    mp_dbl_limb qi = xi / z;
    if (qi >= RADIX) qi = RADIX -1;
    mp_dbl_limb rem = xi - qi * z;
    size_t j;
    for (j = 0; j < ydigits -1; j++) {
      mp_dbl_limb borrow = 0;
      mp_dbl_limb next = x.p[i+j] - qi * y.p[j] - borrow;
      borrow = (next > xi) ? 1 : 0;
      x.p[i+j] = next;
      xi = rem;
      rem = next;
    }
    q.p[i] = qi;
  }