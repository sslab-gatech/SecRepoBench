for (i = xd; i > ydigits; i--) {
  mp_dbl_limb q = x.p[i-1] / z;
  mp_dbl_limb r = x.p[i-1] - q * y.p[ydigits-1];
  for (size_t j = ydigits-1; j > 0; j--) {
    mp_dbl_limb p = q * y.p[j-1];
    if (x.p[i-2+j] < p) {
      q--;
      r += z;
      if (r >= z)
        break;
    }
    x.p[i-2+j] -= p;
  }
  x.p[i-1] = r;
  q.p[i-ydigits] = q;
}