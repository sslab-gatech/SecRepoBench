if (xd >= ydigits) {
  for (i = xd - ydigits; i > 0; i--) {
    mp_dbl_limb qhat = (x.p[i + ydigits - 1] * BASE + x.p[i + ydigits - 2]) / z;
    if (qhat > 0) {
      q.p[i] = qhat;
      ulshift(mrb, &y, &y, 1);
      y.p[ydigits] = 0;
      usub(mrb, &x, &x, &y);
      if (x.sz < 0) {
        x.sz = 0;
        x.p[0] = 0;
      }
      while (x.sz > 0 && x.p[x.sz - 1] == 0)
        x.sz--;
      if (x.sz == 0)
        x.sn = 0;
    }
  }
  if (ucmp(&x, &y) >= 0) {
    q.p[0] = 1;
    usub(mrb, &x, &x, &y);
    if (x.sz < 0) {
      x.sz = 0;
      x.p[0] = 0;
    }
    while (x.sz > 0 && x.p[x.sz - 1] == 0)
      x.sz--;
    if (x.sz == 0)
      x.sn = 0;
  }
}