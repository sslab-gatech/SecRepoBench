// This code block implements the division of multi-precision integers using a long division algorithm.
  mpz_t temp_q, temp_r;
  mpz_init(mrb, &temp_q);
  mpz_init(mrb, &temp_r);

  size_t xd = digits(&x);
  size_t yd = digits(&y);

  for (i = xd; i >= yd; i--) {
    size_t j;
    mp_dbl_limb d = 0;
    if (x.p[i] >= y.p[yd - 1]) {
      d = x.p[i] / y.p[yd - 1];
      if (d > 0) {
        ulshift(mrb, &temp_q, &q, i - (xd - yd));
        urshift(mrb, &temp_r, &x, ns);
        if (ucmp(&temp_r, &y) >= 0) {
          d--;
          ulshift(mrb, &temp_q, &q, i - (xd - yd));
          urshift(mrb, &temp_r, &x, ns);
          mpz_add_int(mrb, &temp_r, &temp_r, 1);
        }
        mpz_add_int(mrb, &q, &q, d);
        ulshift(mrb, &temp_r, &y, ns);
        ulshift(mrb, &temp_r, &temp_r, i - (xd - yd));
        mpz_sub(mrb, &x, &x, &temp_r);
        trim(&q);
      }
    }
  }

  mpz_move(mrb, qq, &q);
  mpz_clear(mrb, &temp_q);
  mpz_clear(mrb, &temp_r);