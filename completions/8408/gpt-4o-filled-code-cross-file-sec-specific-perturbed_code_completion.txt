PrimitiveInfo
    *primitive_info;

  size_t
    number_points;

  ssize_t
    n;

  MagickBooleanType
    status;

  /*
    Initialize graphics context.
  */
  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(draw_info != (DrawInfo *) NULL);
  assert(draw_info->signature == MagickCoreSignature);
  assert(exception != (ExceptionInfo *) NULL);
  assert(exception->signature == MagickCoreSignature);

  /*
    Allocate primitive info memory.
  */
  number_points=2048;
  primitive_info=(PrimitiveInfo *) AcquireQuantumMemory(number_points,
    sizeof(*primitive_info));
  if (primitive_info == (PrimitiveInfo *) NULL)
    ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
      image->filename);

  /*
    Parse the drawing commands.
  */
  status=MagickTrue;
  n=0;
  for (q=draw_info->primitive; *q != '\0'; )
  {
    /*
      Interpret graphic primitive.
    */
    GetNextToken(q,&q,MagickPathExtent,primitive_name);
    if (*primitive_name == '\0')
      break;
    if (LocaleCompare("push",primitive_name) == 0)
      {
        GetNextToken(q,&q,MagickPathExtent,primitive_name);
        if (LocaleCompare("graphic-context",primitive_name) == 0)
          {
            if (n >= (ssize_t) (number_points-1))
              {
                number_points+=2048;
                primitive_info=(PrimitiveInfo *) ResizeQuantumMemory(
                  primitive_info,number_points,sizeof(*primitive_info));
                if (primitive_info == (PrimitiveInfo *) NULL)
                  ThrowBinaryException(ResourceLimitError,
                    "MemoryAllocationFailed",image->filename);
              }
            primitive_info[n].primitive=PushGraphicContextPrimitive;
            n++;
            continue;
          }
      }
    if (LocaleCompare("pop",primitive_name) == 0)
      {
        GetNextToken(q,&q,MagickPathExtent,primitive_name);
        if (LocaleCompare("graphic-context",primitive_name) == 0)
          {
            if (n >= (ssize_t) (number_points-1))
              {
                number_points+=2048;
                primitive_info=(PrimitiveInfo *) ResizeQuantumMemory(
                  primitive_info,number_points,sizeof(*primitive_info));
                if (primitive_info == (PrimitiveInfo *) NULL)
                  ThrowBinaryException(ResourceLimitError,
                    "MemoryAllocationFailed",image->filename);
              }
            primitive_info[n].primitive=PopGraphicContextPrimitive;
            n++;
            continue;
          }
      }
    status=MagickFalse;
    break;
  }
  if (status == MagickFalse)
    {
      primitive_info=(PrimitiveInfo *) RelinquishMagickMemory(primitive_info);
      ThrowBinaryException(DrawError,"NonconformingDrawingPrimitiveDefinition",
        primitive_name);
    }