DrawInfo
    *graphic_context[MagickPathExtent];

  ExceptionInfo
    *clone_exception;

  Image
    *pattern_image;

  MagickBooleanType
    status;

  PrimitiveInfo
    *primitive_info;

  StopInfo
    *stops;

  size_t
    n;

  char
    *message;

  /*
    Initialize graphic context.
  */
  status=MagickTrue;
  n=0;
  graphic_context[n]=CloneDrawInfo(draw_info);
  if (graphic_context[n] == (DrawInfo *) NULL)
    {
      status=MagickFalse;
      goto cleanup;
    }
  primitive_info=(PrimitiveInfo *) NULL;
  stops=(StopInfo *) NULL;
  token=AcquireString(draw_info->primitive);
  primitive=AcquireString("");
  clone_exception=CloneExceptionInfo(exception);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(DrawEvent,GetMagickModule(),"begin draw-image");
  /*
    Process the drawing commands.
  */
  for (q=token; *q != '\0'; )
  {
    /*
      Interpret graphic primitive.
    */
    GetNextToken(q,&q,MagickPathExtent,primitive_name);
    if (*primitive_name == '\0')
      break;
    if (*primitive_name == '#')
      {
        /*
          Comment.
        */
        continue;
      }
    (void) CopyMagickString(primitive,primitive_name,MagickPathExtent);
    primitive_info=InterpretImagePrimitive(graphic_context[n],primitive,q,
      &q,clone_exception);
    if (primitive_info == (PrimitiveInfo *) NULL)
      {
        status=MagickFalse;
        break;
      }
    if (primitive_info->primitive == ImagePrimitive)
      {
        pattern_image=ReadImage(primitive_info->text,clone_exception);
        if (pattern_image == (Image *) NULL)
          {
            status=MagickFalse;
            break;
          }
        (void) CompositeImage(image,pattern_image,OverCompositeOp,
          primitive_info->point.x,primitive_info->point.y);
        pattern_image=DestroyImage(pattern_image);
        primitive_info=(PrimitiveInfo *) RelinquishMagickMemory(
          primitive_info);
        continue;
      }
    if (primitive_info->primitive == TextPrimitive)
      {
        message=InterpretText(graphic_context[n],primitive_info,
          clone_exception);
        if (message == (char *) NULL)
          {
            status=MagickFalse;
            break;
          }
        (void) DrawText(image,graphic_context[n],message,clone_exception);
        message=DestroyString(message);
        primitive_info=(PrimitiveInfo *) RelinquishMagickMemory(
          primitive_info);
        continue;
      }
    if (primitive_info->primitive == PathPrimitive)
      {
        (void) DrawPathPrimitive(image,graphic_context[n],primitive_info,
          clone_exception);
        primitive_info=(PrimitiveInfo *) RelinquishMagickMemory(
          primitive_info);
        continue;
      }
    if (primitive_info->primitive == GradientPrimitive)
      {
        stops=InterpretGradient(graphic_context[n],primitive_info,
          clone_exception);
        if (stops == (StopInfo *) NULL)
          {
            status=MagickFalse;
            break;
          }
        (void) DrawGradient(image,graphic_context[n],primitive_info,stops,
          clone_exception);
        stops=(StopInfo *) RelinquishMagickMemory(stops);
        primitive_info=(PrimitiveInfo *) RelinquishMagickMemory(
          primitive_info);
        continue;
      }
    (void) DrawPrimitive(image,graphic_context[n],primitive_info,
      clone_exception);
    primitive_info=(PrimitiveInfo *) RelinquishMagickMemory(primitive_info);
  }
cleanup:
  clone_exception=DestroyExceptionInfo(clone_exception);