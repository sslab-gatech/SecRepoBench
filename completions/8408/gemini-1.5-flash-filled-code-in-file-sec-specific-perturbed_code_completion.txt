DrawInfo
    **graphic_context;

  Image
    *composite_mask,
    *fill_pattern,
    *stroke_pattern;

  MagickBooleanType
    status;

  MVGInfo
    mvg_info;

  PrimitiveInfo
    *primitive_info;

  StopInfo
    *stops;

  size_t
    extent;

  ssize_t
    n;

  /*
    Initialize draw attributes.
  */
  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(draw_info != (const DrawInfo *) NULL);
  status=MagickTrue;
  graphic_context=(DrawInfo **) AcquireQuantumMemory(16UL,
    sizeof(*graphic_context));
  if (graphic_context == (DrawInfo **) NULL)
    ThrowFatalException(ResourceLimitFatalError,"MemoryAllocationFailed");
  (void) memset(graphic_context,0,16UL*sizeof(*graphic_context));
  n=0;
  graphic_context[n]=CloneDrawInfo((ImageInfo *) NULL,draw_info);
  extent=MaxBezierCoordinates;
  primitive_info=(PrimitiveInfo *) AcquireQuantumMemory(extent,
    sizeof(*primitive_info));
  if (primitive_info == (PrimitiveInfo *) NULL)
    ThrowFatalException(ResourceLimitFatalError,"MemoryAllocationFailed");
  (void) memset(primitive_info,0,extent*sizeof(*primitive_info));
  mvg_info.primitive_info=&primitive_info;
  mvg_info.extent=&extent;
  mvg_info.offset=0;
  mvg_info.exception=exception;
  stops=(StopInfo *) NULL;
  if (draw_info->primitive != (char *) NULL)
    {
      char
        *primitive;

      primitive=AcquireString(draw_info->primitive);
      token=AcquireString(primitive);
      if (LocaleNCompare(primitive,"@",1) == 0)
        {
          /*
            Read primitive from file.
          */
          Image
            *image;

          ImageInfo
            *clone_info;

          clone_info=AcquireImageInfo();
          (void) CopyMagickString(clone_info->filename,primitive+1,
            MagickPathExtent);
          image=ReadImage(clone_info,exception);
          clone_info=DestroyImageInfo(clone_info);
          if (image != (Image *) NULL)
            {
              (void) SetImageProgressMonitor(image,(MagickProgressMonitor)
                NULL,(void *) NULL);
              primitive=DestroyString(primitive);
              primitive=AcquireString(image->magick);
            }
        }
      if (LocaleCompare("gradient",primitive) == 0)
        {
          /*
            Draw gradient.
          */
          status&=DrawGradientImage(image,draw_info,exception);
        }
      else
        {
          /*
            Draw primitive.
          */
          size_t
            number_primitives;

          number_primitives=TracePath(&mvg_info,primitive,exception);
          if (number_primitives == 0)
            status=MagickFalse;
          else
            {
              primitive_info[number_primitives].primitive=UndefinedPrimitive;
              status&=DrawPrimitive(image,graphic_context[n],primitive_info,
                exception);
            }
        }
      primitive=DestroyString(primitive);
    }
  if (draw_info->fill_pattern != (Image *) NULL)
    {
      /*
        Draw fill pattern.
      */
      fill_pattern=CloneImage(draw_info->fill_pattern,0,0,MagickTrue,
        exception);
      if (fill_pattern != (Image *) NULL)
        {
          (void) SetImageProgressMonitor(fill_pattern,(MagickProgressMonitor)
            NULL,(void *) NULL);
          (void) SetImageBackgroundColor(fill_pattern,exception);
          (void) DrawPatternPath(image,draw_info,"fill",
            &fill_pattern,exception);
          (void) SetImageMask(image,WritePixelMask,fill_pattern,exception);
        }
      fill_pattern=DestroyImage(fill_pattern);
    }
  if (draw_info->stroke_pattern != (Image *) NULL)
    {
      /*
        Draw stroke pattern.
      */
      stroke_pattern=CloneImage(draw_info->stroke_pattern,0,0,MagickTrue,
        exception);
      if (stroke_pattern != (Image *) NULL)
        {
          (void) SetImageProgressMonitor(stroke_pattern,(MagickProgressMonitor)
            NULL,(void *) NULL);
          (void) SetImageBackgroundColor(stroke_pattern,exception);
          (void) DrawPatternPath(image,draw_info,"stroke",
            &stroke_pattern,exception);
          (void) SetImageMask(image,WritePixelMask,stroke_pattern,exception);
        }
      stroke_pattern=DestroyImage(stroke_pattern);
    }
  if (draw_info->clip_mask != (char *) NULL)
    {
      /*
        Draw clip mask.
      */
      composite_mask=DrawClippingMask(image,draw_info,draw_info->clip_mask,
        draw_info->clip_mask,exception);
      if (composite_mask != (Image *) NULL)
        {
          (void) SetImageProgressMonitor(composite_mask,(MagickProgressMonitor)
            NULL,(void *) NULL);
          (void) SetImageMask(image,WritePixelMask,composite_mask,exception);
        }
      composite_mask=DestroyImage(composite_mask);
    }
  if (draw_info->clip_path != MagickFalse)
    {
      /*
        Draw clip path.
      */
      composite_mask=DrawClippingMask(image,draw_info,draw_info->clip_path,
        draw_info->clip_path,exception);
      if (composite_mask != (Image *) NULL)
        {
          (void) SetImageProgressMonitor(composite_mask,(MagickProgressMonitor)
            NULL,(void *) NULL);
          (void) SetImageMask(image,WritePixelMask,composite_mask,exception);
        }
      composite_mask=DestroyImage(composite_mask);
    }
  if (draw_info->composite_mask != (char *) NULL)
    {
      /*
        Draw composite mask.
      */
      composite_mask=DrawCompositeMask(image,draw_info,
        draw_info->composite_mask,draw_info->composite_mask,exception);
      if (composite_mask != (Image *) NULL)
        {
          (void) SetImageProgressMonitor(composite_mask,(MagickProgressMonitor)
            NULL,(void *) NULL);
          (void) SetImageMask(image,CompositePixelMask,composite_mask,
            exception);
        }
      composite_mask=DestroyImage(composite_mask);
    }