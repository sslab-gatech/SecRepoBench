// <MASK>
if (image->debug!= MagickFalse)
  (void) LogMagickEvent(DrawEvent,GetMagickModule(),"%s",image->filename);
GetAffineMatrix(&affine);
GetAffineMatrix(&current);
token=AcquireString(draw_info->primitive);
primitive=AcquireString(draw_info->primitive);
primitive_info=(PrimitiveInfo *) AcquireQuantumMemory(2047,sizeof(*primitive_info));
if (primitive_info == (PrimitiveInfo *) NULL)
  ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed","`%s'",
    image->filename);
stops=(StopInfo *) AcquireQuantumMemory(2047,sizeof(*stops));
if (stops == (StopInfo *) NULL)
  ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed","`%s'",
    image->filename);
graphic_context=(DrawInfo **) AcquireQuantumMemory(2047,sizeof(*graphic_context));
if (graphic_context == (DrawInfo **) NULL)
  ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed","`%s'",
    image->filename);
n=0;
status=MagickTrue;
for (q=(const char *) draw_info->primitive; *q!= '\0'; )
{
  GetNextToken(q,&q,MagickPathExtent,primitive_name);
  if (*primitive_name == '\0')
    break;
  if (*primitive_name == '#')
    {
      if (image->debug!= MagickFalse)
        (void) LogMagickEvent(DrawEvent,GetMagickModule(),"%s",primitive_name);
      continue;
    }
  primitive_type=UndefinedPrimitive;
  switch (*primitive_name)
  {
    case ';':
      break;
    case 'a':
    case 'A':
    {
      if (LocaleCompare("affine",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          affine.sx=StringToDouble(token,&next_token);
          GetNextToken(q,&q,MagickPathExtent,token);
          if (*token == ',')
            GetNextToken(q,&q,MagickPathExtent,token);
          affine.rx=StringToDouble(token,&next_token);
          GetNextToken(q,&q,MagickPathExtent,token);
          if (*token == ',')
            GetNextToken(q,&q,MagickPathExtent,token);
          affine.ry=StringToDouble(token,&next_token);
          GetNextToken(q,&q,MagickPathExtent,token);
          if (*token == ',')
            GetNextToken(q,&q,MagickPathExtent,token);
          affine.sy=StringToDouble(token,&next_token);
          GetNextToken(q,&q,MagickPathExtent,token);
          if (*token == ',')
            GetNextToken(q,&q,MagickPathExtent,token);
          affine.tx=StringToDouble(token,&next_token);
          GetNextToken(q,&q,MagickPathExtent,token);
          if (*token == ',')
            GetNextToken(q,&q,MagickPathExtent,token);
          affine.ty=StringToDouble(token,&next_token);
          break;
        }
      if (LocaleCompare("alpha",primitive_name) == 0)
        {
          primitive_type=AlphaPrimitive;
          break;
        }
      if (LocaleCompare("angle",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          affine.rx=StringToDouble(token,&next_token);
          affine.ry=StringToDouble(token,&next_token);
          break;
        }
      if (LocaleCompare("arc",primitive_name) == 0)
        {
          primitive_type=ArcPrimitive;
          break;
        }
      status=MagickFalse;
      break;
    }
    case 'b':
    case 'B':
    {
      if (LocaleCompare("bezier",primitive_name) == 0)
        {
          primitive_type=BezierPrimitive;
          break;
        }
      status=MagickFalse;
      break;
    }
    case 'c':
    case 'C':
    {
      if (LocaleCompare("clip-path",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,
            "clip-path:url(#%s);",token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      if (LocaleCompare("clip-rule",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,
            "clip-rule:%s;",token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      if (LocaleCompare("clip-units",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,
            "clipPathUnits=%s;",token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      if (LocaleCompare("circle",primitive_name) == 0)
        {
          primitive_type=CirclePrimitive;
          break;
        }
      if (LocaleCompare("color",primitive_name) == 0)
        {
          primitive_type=ColorPrimitive;
          break;
        }
      status=MagickFalse;
      break;
    }
    case 'd':
    case 'D':
    {
      if (LocaleCompare("decorate",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,
            "text-decoration:%s;",token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      status=MagickFalse;
      break;
    }
    case 'e':
    case 'E':
    {
      if (LocaleCompare("ellipse",primitive_name) == 0)
        {
          primitive_type=EllipsePrimitive;
          break;
        }
      status=MagickFalse;
      break;
    }
    case 'f':
    case 'F':
    {
      if (LocaleCompare("fill",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,"fill:%s;",
            token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      if (LocaleCompare("fill-rule",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,
            "fill-rule:%s;",token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      if (LocaleCompare("fill-opacity",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,
            "fill-opacity:%s;",token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      if (LocaleCompare("font-family",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,
            "font-family:%s;",token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      if (LocaleCompare("font-stretch",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,
            "font-stretch:%s;",token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      if (LocaleCompare("font-style",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,
            "font-style:%s;",token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      if (LocaleCompare("font-size",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,
            "font-size:%s;",token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      if (LocaleCompare("font-weight",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,
            "font-weight:%s;",token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      status=MagickFalse;
      break;
    }
    case 'g':
    case 'G':
    {
      if (LocaleCompare("gradient-units",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          break;
        }
      if (LocaleCompare("text-align",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,
            "text-align %s ",token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      if (LocaleCompare("text-anchor",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,
            "text-anchor %s ",token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      status=MagickFalse;
      break;
    }
    case 'i':
    case 'I':
    {
      if (LocaleCompare("image",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          primitive_type=ImagePrimitive;
          break;
        }
      status=MagickFalse;
      break;
    }
    case 'l':
    case 'L':
    {
      if (LocaleCompare("line",primitive_name) == 0)
        {
          primitive_type=LinePrimitive;
          break;
        }
      status=MagickFalse;
      break;
    }
    case 'o':
    case 'O':
    {
      if (LocaleCompare("opacity",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          (void) FormatLocaleString(geometry,MagickPathExtent,"opacity %s ",
            token);
          (void) DrawSetVectorGraphics(image,geometry);
          break;
        }
      status=MagickFalse;
      break;
    }
    case 'p':
    case 'P':
    {
      if (LocaleCompare("path",primitive_name) == 0)
        {
          primitive_type=PathPrimitive;
          break;
        }
      if (LocaleCompare("point",primitive_name) == 0)
        {
          primitive_type=PointPrimitive;
          break;
        }
      if (LocaleCompare("polyline",primitive_name) == 0)
        {
          primitive_type=PolylinePrimitive;
          break;
        }
      if (LocaleCompare("polygon",primitive_name) == 0)
        {
          primitive_type=PolygonPrimitive;
          break;
        }
      if (LocaleCompare("pop",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          if (LocaleCompare("clip-path",token) == 0)
            {
              (void) DrawSetVectorGraphics(image,"</clipPath>");
              break;
            }
          if (LocaleCompare("defs",token) == 0)
            {
              (void) DrawSetVectorGraphics(image,"</defs>");
              break;
            }
          if (LocaleCompare("gradient",token) == 0)
            {
              (void) FormatLocaleString(geometry,MagickPathExtent,
                "</%sGradient>",token);
              (void) DrawSetVectorGraphics(image,geometry);
              break;
            }
          if (LocaleCompare("graphic-context",token) == 0)
            {
              n--;
              if (n < 0)
                ThrowBinaryException(DrawError,
                  "UnbalancedGraphicContextPushPop");
              (void) DrawSetVectorGraphics(image,"</g>");
            }
          if (LocaleCompare("pattern",token) == 0)
            {
              (void) DrawSetVectorGraphics(image,"</pattern>");
              break;
            }
          if (LocaleCompare("symbol",token) == 0)
            {
              (void) DrawSetVectorGraphics(image,"</symbol>");
              break;
            }
          if ((LocaleCompare("defs",token) == 0) ||
              (LocaleCompare("symbol",token) == 0))
            (void) DrawSetVectorGraphics(image,"</g>");
          break;
        }
      if (LocaleCompare("push",primitive_name) == 0)
        {
          GetNextToken(q,&q,MagickPathExtent,token);
          if (LocaleCompare("clip-path",token) == 0)
            {
              GetNextToken(q,&q,MagickPathExtent,token);
              (void) FormatLocaleString(geometry,MagickPathExtent,
                "<clipPath id=\"%s\">",token);
              (void) DrawSetVectorGraphics(image,geometry);
              break;
            }
          if (LocaleCompare("defs",token) == 0)
            {
              (void) DrawSetVectorGraphics(image,"<defs>");
              break;
            }
          if (LocaleCompare("gradient",token) == 0)
            {
              GetNextToken(q,&q,MagickPathExtent,token);
              (void) CopyMagickString(pattern,token,MagickPathExtent);
              GetNextToken(q,&q,MagickPathExtent,token);
              (void) CopyMagickString(token,token,MagickPathExtent);
              (void) FormatLocaleString(geometry,MagickPathExtent,
                "<%sGradient id=\"%s\">",token,pattern);
              (void) DrawSetVectorGraphics(image,geometry);
              break;
            }
          if (LocaleCompare("graphic-context",token