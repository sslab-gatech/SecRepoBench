// This code block interprets and executes a series of drawing commands to render 
  // graphics on an image. It parses the commands from a string, which may include 
  // transformations, styles, and primitive shapes such as lines, rectangles, and paths.
  // A stack of graphic contexts is maintained to handle nested transformations and styles.

  status=MagickTrue;
  graphic_context=(DrawInfo **) AcquireQuantumMemory(number_context,
    sizeof(*graphic_context));
  if (graphic_context == (DrawInfo **) NULL)
    ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
      image->filename);
  graphic_context[n]=CloneDrawInfo((ImageInfo *) NULL,draw_info);
  token=AcquireString(primitive);
  primitive_info=(PrimitiveInfo *) NULL;
  extent=0;
  for (q=(char *) primitive; *q != '\0'; )
  {
    /*
      Interpret graphic primitive.
    */
    GetNextToken(q,&q,MagickPathExtent,token);
    if (*token == '\0')
      break;
    primitive_type=UndefinedPrimitive;
    switch (*token)
    {
      case 'a':
      case 'A':
      {
        if (LocaleCompare("affine",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            affine.sx=StringToDouble(token,&next_token);
            GetNextToken(q,&q,MagickPathExtent,token);
            if (*token == ',')
              GetNextToken(q,&q,MagickPathExtent,token);
            affine.rx=StringToDouble(token,&next_token);
            GetNextToken(q,&q,MagickPathExtent,token);
            if (*token == ',')
              GetNextToken(q,&q,MagickPathExtent,token);
            affine.ry=StringToDouble(token,&next_token);
            GetNextToken(q,&q,MagickPathExtent,token);
            if (*token == ',')
              GetNextToken(q,&q,MagickPathExtent,token);
            affine.sy=StringToDouble(token,&next_token);
            GetNextToken(q,&q,MagickPathExtent,token);
            if (*token == ',')
              GetNextToken(q,&q,MagickPathExtent,token);
            affine.tx=StringToDouble(token,&next_token);
            GetNextToken(q,&q,MagickPathExtent,token);
            if (*token == ',')
              GetNextToken(q,&q,MagickPathExtent,token);
            affine.ty=StringToDouble(token,&next_token);
            graphic_context[n]->affine=affine;
            break;
          }
        if (LocaleCompare("alpha",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            alpha=StringToDouble(token,&next_token);
            if (alpha == 1.0)
              graphic_context[n]->alpha=OpaqueAlpha;
            else
              graphic_context[n]->alpha=(Quantum) (QuantumRange-
                QuantumRange*alpha);
            break;
          }
        if (LocaleCompare("arc",token) == 0)
          {
            primitive_type=ArcPrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'b':
      case 'B':
      {
        if (LocaleCompare("bezier",token) == 0)
          {
            primitive_type=BezierPrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'c':
      case 'C':
      {
        if (LocaleCompare("clip-path",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            status=DrawClipPath(image,graphic_context[n],token,exception);
            break;
          }
        if (LocaleCompare("clip-rule",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            if (LocaleCompare("evenodd",token) == 0)
              graphic_context[n]->fill_rule=EvenOddRule;
            if (LocaleCompare("nonzero",token) == 0)
              graphic_context[n]->fill_rule=NonZeroRule;
            break;
          }
        if (LocaleCompare("clip-units",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            if (LocaleCompare("userSpace",token) == 0)
              graphic_context[n]->clip_units=UserSpace;
            if (LocaleCompare("userSpaceOnUse",token) == 0)
              graphic_context[n]->clip_units=UserSpaceOnUse;
            if (LocaleCompare("objectBoundingBox",token) == 0)
              graphic_context[n]->clip_units=ObjectBoundingBox;
            break;
          }
        if (LocaleCompare("circle",token) == 0)
          {
            primitive_type=CirclePrimitive;
            break;
          }
        if (LocaleCompare("color",token) == 0)
          {
            primitive_type=ColorPrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'd':
      case 'D':
      {
        if (LocaleCompare("decorate",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            if (LocaleCompare("none",token) == 0)
              graphic_context[n]->decorate=NoDecoration;
            if (LocaleCompare("line-through",token) == 0)
              graphic_context[n]->decorate=LineThroughDecoration;
            if (LocaleCompare("overline",token) == 0)
              graphic_context[n]->decorate=OverlineDecoration;
            if (LocaleCompare("underline",token) == 0)
              graphic_context[n]->decorate=UnderlineDecoration;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'e':
      case 'E':
      {
        if (LocaleCompare("ellipse",token) == 0)
          {
            primitive_type=EllipsePrimitive;
            break;
          }
        if (LocaleCompare("encoding",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            (void) CloneString(&graphic_context[n]->encoding,token);
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'f':
      case 'F':
      {
        if (LocaleCompare("fill",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            (void) QueryColorCompliance(token,AllCompliance,
              &graphic_context[n]->fill,exception);
            break;
          }
        if (LocaleCompare("fill-opacity",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            graphic_context[n]->fill.alpha=StringToDouble(token,
              (char **) NULL);
            break;
          }
        if (LocaleCompare("fill-rule",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            if (LocaleCompare("evenodd",token) == 0)
              graphic_context[n]->fill_rule=EvenOddRule;
            if (LocaleCompare("nonzero",token) == 0)
              graphic_context[n]->fill_rule=NonZeroRule;
            break;
          }
        if (LocaleCompare("font",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            (void) CloneString(&graphic_context[n]->font,token);
            if (LocaleCompare("none",token) == 0)
              graphic_context[n]->font=(char *) RelinquishMagickMemory(
                graphic_context[n]->font);
            break;
          }
        if (LocaleCompare("font-family",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            (void) CloneString(&graphic_context[n]->family,token);
            break;
          }
        if (LocaleCompare("font-size",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            graphic_context[n]->pointsize=StringToDouble(token,
              (char **) NULL);
            break;
          }
        if (LocaleCompare("font-stretch",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            graphic_context[n]->stretch=UndefinedStretch;
            if (LocaleCompare("all",token) == 0)
              graphic_context[n]->stretch=AnyStretch;
            if (LocaleCompare("condensed",token) == 0)
              graphic_context[n]->stretch=CondensedStretch;
            if (LocaleCompare("expanded",token) == 0)
              graphic_context[n]->stretch=ExpandedStretch;
            if (LocaleCompare("extra-condensed",token) == 0)
              graphic_context[n]->stretch=ExtraCondensedStretch;
            if (LocaleCompare("extra-expanded",token) == 0)
              graphic_context[n]->stretch=ExtraExpandedStretch;
            if (LocaleCompare("normal",token) == 0)
              graphic_context[n]->stretch=NormalStretch;
            if (LocaleCompare("semi-condensed",token) == 0)
              graphic_context[n]->stretch=SemiCondensedStretch;
            if (LocaleCompare("semi-expanded",token) == 0)
              graphic_context[n]->stretch=SemiExpandedStretch;
            if (LocaleCompare("ultra-condensed",token) == 0)
              graphic_context[n]->stretch=UltraCondensedStretch;
            if (LocaleCompare("ultra-expanded",token) == 0)
              graphic_context[n]->stretch=UltraExpandedStretch;
            break;
          }
        if (LocaleCompare("font-style",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            graphic_context[n]->style=UndefinedStyle;
            if (LocaleCompare("all",token) == 0)
              graphic_context[n]->style=AnyStyle;
            if (LocaleCompare("italic",token) == 0)
              graphic_context[n]->style=ItalicStyle;
            if (LocaleCompare("normal",token) == 0)
              graphic_context[n]->style=NormalStyle;
            if (LocaleCompare("oblique",token) == 0)
              graphic_context[n]->style=ObliqueStyle;
            break;
          }
        if (LocaleCompare("font-weight",token) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent