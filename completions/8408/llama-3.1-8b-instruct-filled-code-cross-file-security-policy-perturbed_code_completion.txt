if (image->debug!= MagickFalse)
  (void) LogMagickEvent(DrawEvent,GetMagickModule(),"end draw-image");
/*
  Relinquish resources.
*/
token=DestroyString(token);
if (primitive_info!= (PrimitiveInfo *) NULL)
  primitive_info=(PrimitiveInfo *) RelinquishMagickMemory(primitive_info);
primitive=DestroyString(primitive);
if (stops!= (StopInfo *) NULL)
  stops=(StopInfo *) RelinquishMagickMemory(stops);
for ( ; n >= 0; n--)
  graphic_context[n]=DestroyDrawInfo(graphic_context[n]);
graphic_context=(DrawInfo **) RelinquishMagickMemory(graphic_context);
if (status == MagickFalse)
  ThrowBinaryException(DrawError,"NonconformingDrawingPrimitiveDefinition",
    primitive_name);
status=MagickTrue;
for (i=0; i < n; i++)
{
  if (graphic_context[i]->primitive == UndefinedPrimitive)
    continue;
  if (graphic_context[i]->primitive == TextPrimitive)
    {
      if (graphic_context[i]->text!= (char *) NULL)
        {
          (void) WriteBlobString(image,graphic_context[i]->text);
          graphic_context[i]->text=(char *) NULL;
        }
    }
  else
    {
      if (graphic_context[i]->text!= (char *) NULL)
        {
          (void) WriteBlobString(image,graphic_context[i]->text);
          graphic_context[i]->text=(char *) NULL;
        }
    }
  switch (graphic_context[i]->primitive)
  {
    case LinePrimitive:
    case RectanglePrimitive:
    case RoundRectanglePrimitive:
    case EllipsePrimitive:
    case CirclePrimitive:
    case PolylinePrimitive:
    case PolygonPrimitive:
    case BezierPrimitive:
    case PathPrimitive:
    {
      ssize_t
        j;

      for (j=0; j < graphic_context[i]->number_points; j++)
        {
          (void) FormatLocaleString(message,MagickPathExtent,
            "  <%s x=\"%g\" y=\"%g\" ",PrimitiveName(graphic_context[i]->primitive),
            graphic_context[i]->points[j].x,graphic_context[i]->points[j].y);
          (void) WriteBlobString(image,message);
          if (graphic_context[i]->primitive == LinePrimitive)
            {
              (void) FormatLocaleString(message,MagickPathExtent,
                "x2=\"%g\" y2=\"%g\"/>\n",graphic_context[i]->points[j+1].x,
                graphic_context[i]->points[j+1].y);
              (void) WriteBlobString(image,message);
              j++;
            }
          else if (graphic_context[i]->primitive == RectanglePrimitive)
            {
              (void) FormatLocaleString(message,MagickPathExtent,
                "width=\"%g\" height=\"%g\"/>\n",graphic_context[i]->points[j+1].x-
                graphic_context[i]->points[j].x,graphic_context[i]->points[j+1].y-
                graphic_context[i]->points[j].y);
              (void) WriteBlobString(image,message);
              j++;
            }
          else if (graphic_context[i]->primitive == RoundRectanglePrimitive)
            {
              (void) FormatLocaleString(message,MagickPathExtent,
                "rx=\"%g\" ry=\"%g\"/>\n",graphic_context[i]->points[j+2].x,
                graphic_context[i]->points[j+2].y);
              (void) WriteBlobString(image,message);
              j+=2;
            }
          else if (graphic_context[i]->primitive == EllipsePrimitive)
            {
              (void) FormatLocaleString(message,MagickPathExtent,
                "rx=\"%g\" ry=\"%g\"/>\n",graphic_context[i]->points[j+1].x,
                graphic_context[i]->points[j+1].y);
              (void) WriteBlobString(image,message);
              j++;
            }
          else if (graphic_context[i]->primitive == CirclePrimitive)
            {
              (void) FormatLocaleString(message,MagickPathExtent,
                "r=\"%g\"/>\n",hypot(graphic_context[i]->points[j+1].x-
                graphic_context[i]->points[j].x,graphic_context[i]->points[j+1].y-
                graphic_context[i]->points[j].y));
              (void) WriteBlobString(image,message);
              j++;
            }
          else if (graphic_context[i]->primitive == PolylinePrimitive)
            {
              (void) FormatLocaleString(message,MagickPathExtent,
                "points=\"",graphic_context[i]->points[j].x,graphic_context[i]->points[j].y);
              (void) WriteBlobString(image,message);
              for ( ; j < graphic_context[i]->number_points-1; j++)
                {
                  (void) FormatLocaleString(message,MagickPathExtent,"%g,%g ",
                    graphic_context[i]->points[j+1].x,graphic_context[i]->points[j+1].y);
                  (void) WriteBlobString(image,message);
                }
              (void) FormatLocaleString(message,MagickPathExtent,"%g,%g\"/>\n",
                graphic_context[i]->points[j].x,graphic_context[i]->points[j].y);
              (void) WriteBlobString(image,message);
            }
          else if (graphic_context[i]->primitive == PolygonPrimitive)
            {
              (void) FormatLocaleString(message,MagickPathExtent,
                "points=\"",graphic_context[i]->points[j].x,graphic_context[i]->points[j].y);
              (void) WriteBlobString(image,message);
              for ( ; j < graphic_context[i]->number_points-1; j++)
                {
                  (void) FormatLocaleString(message,MagickPathExtent,"%g,%g ",
                    graphic_context[i]->points[j+1].x,graphic_context[i]->points[j+1].y);
                  (void) WriteBlobString(image,message);
                }
              (void) FormatLocaleString(message,MagickPathExtent,"%g,%g\"/>\n",
                graphic_context[i]->points[j].x,graphic_context[i]->points[j].y);
              (void) WriteBlobString(image,message);
            }
          else if (graphic_context[i]->primitive == BezierPrimitive)
            {
              (void) FormatLocaleString(message,MagickPathExtent,
                "d=\"",graphic_context[i]->text);
              (void) WriteBlobString(image,message);
              (void) WriteBlobString(image,graphic_context[i]->text);
              (void) WriteBlobString(image,"\"/>\n");
            }
          else if (graphic_context[i]->primitive == PathPrimitive)
            {
              (void) FormatLocaleString(message,MagickPathExtent,
                "d=\"",graphic_context[i]->text);
              (void) WriteBlobString(image,message);
              (void) WriteBlobString(image,graphic_context[i]->text);
              (void) WriteBlobString(image,"\"/>\n");
            }
        }
    }
    case AlphaPrimitive:
    case ColorPrimitive:
    {
      ssize_t
        j;

      for (j=0; j < graphic_context[i]->number_points; j++)
        {
          (void) FormatLocaleString(message,MagickPathExtent,
            "  <%s x=\"%g\" y=\"%g\" ",PrimitiveName(graphic_context[i]->primitive),
            graphic_context[i]->points[j].x,graphic_context[i]->points[j].y);
          (void) WriteBlobString(image,message);
          if (graphic_context[i]->primitive == AlphaPrimitive)
            {
              (void) FormatLocaleString(message,MagickPathExtent,
                "method=\"%s\"/>\n",PrimitiveName(graphic_context[i]->method));
              (void) WriteBlobString(image,message);
            }
          else
            {
              (void) FormatLocaleString(message,MagickPathExtent,
                "method=\"%s\"/>\n",PrimitiveName(graphic_context[i]->method));
              (void) WriteBlobString(image,message);
            }
        }
    }
    case TextPrimitive:
    {
      ssize_t
        j;

      for (j=0; j < graphic_context[i]->number_points; j++)
        {
          (void) FormatLocaleString(message,MagickPathExtent,
            "  <text x=\"%g\" y=\"%g\">",graphic_context[i]->points[j].x,
            graphic_context[i]->points[j].y);
          (void) WriteBlobString(image,message);
          (void) WriteBlobString(image,graphic_context[i]->text);
          (void) WriteBlobString(image,"</text>\n");
        }
    }
    case ImagePrimitive:
    {
      ssize_t
        j;

      for (j=0; j < graphic_context[i]->number_points; j++)
        {
          (void) FormatLocaleString(message,MagickPathExtent,
            "  <image x=\"%g\" y=\"%g\" width=\"%g\" height=\"%g\" "
            "href=\"%s\"/>\n",graphic_context[i]->points[j].x,
            graphic_context[i]->points[j].y,graphic_context[i]->points[j+1].x-
            graphic_context[i]->points[j].x,graphic_context[i]->points[j+1].y-
            graphic_context[i]->points[j].y,graphic_context[i]->text);
          (void) WriteBlobString(image,message);
        }
    }
  }
}
return(status!= 0? MagickTrue : MagickFalse);