status=MagickTrue;
  for (q=draw_info->primitive; *q != '\0'; )
  {
    /*
      Interpret graphic primitive.
    */
    GetNextToken(q,&q,MagickPathExtent,primitive_name);
    if (*primitive_name == '\0')
      break;
    primitive_type=UndefinedPrimitive;
    switch (*primitive_name)
    {
      case ';':
        break;
      case 'a':
      case 'A':
      {
        if (LocaleCompare("affine",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            current.sx=StringToDouble(token,&next_token);
            GetNextToken(q,&q,MagickPathExtent,token);
            if (*token == ',')
              GetNextToken(q,&q,MagickPathExtent,token);
            current.rx=StringToDouble(token,&next_token);
            GetNextToken(q,&q,MagickPathExtent,token);
            if (*token == ',')
              GetNextToken(q,&q,MagickPathExtent,token);
            current.ry=StringToDouble(token,&next_token);
            GetNextToken(q,&q,MagickPathExtent,token);
            if (*token == ',')
              GetNextToken(q,&q,MagickPathExtent,token);
            current.sy=StringToDouble(token,&next_token);
            GetNextToken(q,&q,MagickPathExtent,token);
            if (*token == ',')
              GetNextToken(q,&q,MagickPathExtent,token);
            current.tx=StringToDouble(token,&next_token);
            GetNextToken(q,&q,MagickPathExtent,token);
            if (*token == ',')
              GetNextToken(q,&q,MagickPathExtent,token);
            current.ty=StringToDouble(token,&next_token);
            break;
          }
        if (LocaleCompare("alpha",primitive_name) == 0)
          {
            primitive_type=AlphaPrimitive;
            break;
          }
        if (LocaleCompare("angle",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            affine.rx=StringToDouble(token,&next_token);
            affine.ry=StringToDouble(token,&next_token);
            break;
          }
        if (LocaleCompare("arc",primitive_name) == 0)
          {
            primitive_type=ArcPrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'b':
      case 'B':
      {
        if (LocaleCompare("bezier",primitive_name) == 0)
          {
            primitive_type=BezierPrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'c':
      case 'C':
      {
        if (LocaleCompare("clip-path",primitive_name) == 0)
          {
            /*
              Set clip path.
            */
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("clip-rule",primitive_name) == 0)
          {
            ssize_t
              fill_rule;

            GetNextToken(q,&q,MagickPathExtent,token);
            fill_rule=ParseCommandOption(MagickFillRuleOptions,MagickFalse,token);
            if (fill_rule == -1)
              {
                status=MagickFalse;
                break;
              }
            break;
          }
        if (LocaleCompare("clip-units",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("circle",primitive_name) == 0)
          {
            primitive_type=CirclePrimitive;
            break;
          }
        if (LocaleCompare("color",primitive_name) == 0)
          {
            primitive_type=ColorPrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'd':
      case 'D':
      {
        if (LocaleCompare("decorate",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'e':
      case 'E':
      {
        if (LocaleCompare("ellipse",primitive_name) == 0)
          {
            primitive_type=EllipsePrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'f':
      case 'F':
      {
        if (LocaleCompare("fill",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("fill-rule",primitive_name) == 0)
          {
            ssize_t
              fill_rule;

            GetNextToken(q,&q,MagickPathExtent,token);
            fill_rule=ParseCommandOption(MagickFillRuleOptions,MagickFalse,token);
            if (fill_rule == -1)
              {
                status=MagickFalse;
                break;
              }
            break;
          }
        if (LocaleCompare("fill-opacity",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("font",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("font-family",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("font-size",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("font-stretch",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("font-style",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("font-weight",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'g':
      case 'G':
      {
        if (LocaleCompare("gradient-units",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("gravity",primitive_name) == 0)
          {
            ssize_t
              gravity;

            GetNextToken(q,&q,MagickPathExtent,token);
            gravity=ParseCommandOption(MagickGravityOptions,MagickFalse,token);
            if (gravity == -1)
              {
                status=MagickFalse;
                break;
              }
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'i':
      case 'I':
      {
        if (LocaleCompare("image",primitive_name) == 0)
          {
            primitive_type=ImagePrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'l':
      case 'L':
      {
        if (LocaleCompare("line",primitive_name) == 0)
          {
            primitive_type=LinePrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'o':
      case 'O':
      {
        if (LocaleCompare("offset",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("opacity",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'p':
      case 'P':
      {
        if (LocaleCompare("path",primitive_name) == 0)
          {
            primitive_type=PathPrimitive;
            break;
          }
        if (LocaleCompare("point",primitive_name) == 0)
          {
            primitive_type=PointPrimitive;
            break;
          }
        if (LocaleCompare("polyline",primitive_name) == 0)
          {
            primitive_type=PolylinePrimitive;
            break;
          }
        if (LocaleCompare("polygon",primitive_name) == 0)
          {
            primitive_type=PolygonPrimitive;
            break;
          }
        if (LocaleCompare("pop",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            if (LocaleCompare("clip-path",token) == 0)
              {
                break;
              }
            if (LocaleCompare("defs",token) == 0)
              {
                break;
              }
            if (LocaleCompare("gradient",token) == 0)
              {
                break;
              }
            if (LocaleCompare("graphic-context",token) == 0)
              {
                if (n > 0)
                  {
                    n--;
                    graphic_context[n]=DestroyDrawInfo(graphic_context[n]);
                  }
                break;
              }
            if (LocaleCompare("pattern",token) == 0)
              {
                break;
              }
            status=MagickFalse;
            break;
          }
        if (LocaleCompare("push",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            if (LocaleCompare("clip-path",token) == 0)
              {
                GetNextToken(q,&q,MagickPathExtent,token);
                (void) CopyMagickString(pattern,token,MagickPathExtent);
                GetNextToken(q,&q,MagickPathExtent,token);
                if (LocaleCompare("url",token) == 0)
                  {
                    GetNextToken(q,&q,MagickPathExtent,token);
                    (void) ConcatenateString(&pattern,"(");
                    (void) ConcatenateString(&pattern,token);
                    (void) ConcatenateString(&pattern,")");
                  }
                break;
              }
            if (LocaleCompare("defs",token) == 0)
              {
                break;
              }
            if (LocaleCompare("gradient",token) == 0)
              {
                char
                  name[MagickPathExtent],
                  type[MagickPathExtent];

                GetNextToken(q,&q,MagickPathExtent,token);
                (void) CopyMagickString(name,token,MagickPathExtent);
                GetNextToken(q,&q,MagickPathExtent,token);
                (void) CopyMagickString(type,token,MagickPathExtent);
                GetNextToken(q,&q,MagickPathExtent,token);
                if (n == 0)
                  {
                    graphic_context=(DrawInfo **) ResizeQuantumMemory(
                      graphic_context,(size_t) (n+1),sizeof(*graphic_context));
                    if (graphic_context == (DrawInfo **) NULL)
                      {
                        (void) ThrowMagickException(exception,GetMagickModule(),
                          ResourceLimitError,"MemoryAllocationFailed",
                          "`%s'",image->filename);
                        return(MagickFalse);
                      }
                  }
                else
                  if (n >= (ssize_t) (MaxContextExtent-1))
                    {
                      status=MagickFalse;
                      break;
                    }
                graphic_context[n]=CloneDrawInfo((ImageInfo *) NULL,
                  graphic_context[n-1]);
                n++;
                GetNextToken(q,&q,MagickPathExtent,token);
                GetNextToken(q,&q,MagickPathExtent,token);
                GetNextToken(q,&q,MagickPathExtent,token);
                GetNextToken(q,&q,MagickPathExtent,token);
                break;
              }
            if (LocaleCompare("graphic-context",token) == 0)
              {
                if (n == 0)
                  {
                    graphic_context=(DrawInfo **) ResizeQuantumMemory(
                      graphic_context,(size_t) (n+1),sizeof(*graphic_context));
                    if (graphic_context == (DrawInfo **) NULL)
                      {
                        (void) ThrowMagickException(exception,GetMagickModule(),
                          ResourceLimitError,"MemoryAllocationFailed",
                          "`%s'",image->filename);
                        return(MagickFalse);
                      }
                  }
                else
                  if (n >= (ssize_t) (MaxContextExtent-1))
                    {
                      status=MagickFalse;
                      break;
                    }
                graphic_context[n]=CloneDrawInfo((ImageInfo *) NULL,
                  graphic_context[n-1]);
                n++;
                break;
              }
            if (LocaleCompare("pattern",token) == 0)
              {
                GetNextToken(q,&q,MagickPathExtent,token);
                (void) CopyMagickString(pattern,token,MagickPathExtent);
                break;
              }
            status=MagickFalse;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'r':
      case 'R':
      {
        if (LocaleCompare("rectangle",primitive_name) == 0)
          {
            primitive_type=RectanglePrimitive;
            break;
          }
        if (LocaleCompare("rotate",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("roundRectangle",primitive_name) == 0)
          {
            primitive_type=RoundRectanglePrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 's':
      case 'S':
      {
        if (LocaleCompare("scale",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("skewX",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("skewY",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("stop-color",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("stroke",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("stroke-antialias",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("stroke-dasharray",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("stroke-dashoffset",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("stroke-linecap",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("stroke-linejoin",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("stroke-miterlimit",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("stroke-opacity",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("stroke-width",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        status=MagickFalse;
        break;
      }
      case 't':
      case 'T':
      {
        if (LocaleCompare("text",primitive_name) == 0)
          {
            primitive_type=TextPrimitive;
            break;
          }
        if (LocaleCompare("text-antialias",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        if (LocaleCompare("translate",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'v':
      case 'V':
      {
        if (LocaleCompare("viewbox",primitive_name) == 0)
          {
            GetNextToken(q,&q,MagickPathExtent,token);
            GetNextToken(q,&q,MagickPathExtent,token);
            GetNextToken(q,&q,MagickPathExtent,token);
            GetNextToken(q,&q,MagickPathExtent,token);
            break;
          }
        status=MagickFalse;
        break;
      }
      default:
      {
        status=MagickFalse;
        break;
      }
    }
    if (status == MagickFalse)
      break;
    if (primitive_type == UndefinedPrimitive)
      continue;
    /*
      Parse the primitive attributes.
    */
    i=0;
    j=0;
    for (x=0; *q != '\0'; x++)
    {
      /*
        Define points.
      */
      if (IsPoint(q) == MagickFalse)
        break;
      GetNextToken(q,&q,MagickPathExtent,token);
      point.x=StringToDouble(token,&next_token);
      GetNextToken(q,&q,MagickPathExtent,token);
      if (*token == ',')
        GetNextToken(q,&q,MagickPathExtent,token);
      point.y=StringToDouble(token,&next_token);
      GetNextToken(q,(const char **) NULL,MagickPathExtent,token);
      if (*token == ',')
        GetNextToken(q,&q,MagickPathExtent,token);
      primitive_info[i].primitive=primitive_type;
      primitive_info[i].point=point;
      primitive_info[i].coordinates=0;
      primitive_info[i].method=FloodfillMethod;
      i++;
      if (i < (ssize_t) (number_points-6*BezierQuantum-360))
        continue;
      number_points+=6*BezierQuantum+360;
      primitive_info=(PrimitiveInfo *) ResizeQuantumMemory(primitive_info,
        number_points,sizeof(*primitive_info));
      if (primitive_info == (PrimitiveInfo *) NULL)
        {
          (void) ThrowMagickException(exception,GetMagickModule(),
            ResourceLimitError,"MemoryAllocationFailed","`%s'",image->filename);
          return(MagickFalse);
        }
    }
    primitive_info[j].primitive=primitive_type;
    primitive_info[j].coordinates=x;
    primitive_info[j].method=FloodfillMethod;
    primitive_info[j].text=(char *) NULL;
    if (primitive_type == ImagePrimitive)
      {
        /*
          Image primitive.
        */
        GetNextToken(q,&q,MagickPathExtent,token);
        primitive_info[j].text=AcquireString(token);
      }
    if ((primitive_type == TextPrimitive) || (primitive_type == ImagePrimitive))
      {
        point.x=primitive_info[j].point.x;
        point.y=primitive_info[j].point.y;
      }
    status=MagickTrue;
  }