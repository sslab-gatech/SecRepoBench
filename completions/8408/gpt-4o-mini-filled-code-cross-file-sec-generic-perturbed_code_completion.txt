// Initialize the graphics state
  n = 0;
  status = MagickTrue;
  GetAffineMatrix(&affine);
  while (*token != '\0')
  {
    // Get the next drawing command
    GetNextToken(token, &next_token, MagickPathExtent, primitive_name);
    if (*primitive_name == '\0')
      break;

    // Handle different drawing primitives
    if (LocaleCompare("push", primitive_name) == 0)
    {
      graphic_context[n] = CloneDrawInfo(draw_info);
      n++;
      continue;
    }
    if (LocaleCompare("pop", primitive_name) == 0)
    {
      n--;
      if (n < 0)
        ThrowBinaryException(DrawError, "UnbalancedGraphicContextPushPop", primitive_name);
      continue;
    }

    // Process the drawing command
    // (Assuming a function exists to handle the specific primitive)
    status = ProcessDrawingPrimitive(image, &affine, primitive_name, next_token, exception);
    if (status == MagickFalse)
      break;

    // Update the token for the next iteration
    token = next_token;
  }