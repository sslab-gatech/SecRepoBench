MagickBooleanType
    status;

  DrawInfo
    **graphic_context;

  GradientInfo
    *gradient;

  PrimitiveInfo
    *primitive_info;

  register ssize_t
    n;

  StopInfo
    *stops;

  /*
    Initialize graphic context.
  */
  status=MagickTrue;
  n=0;
  primitive_info=(PrimitiveInfo *) NULL;
  stops=(StopInfo *) NULL;
  gradient=(GradientInfo *) NULL;
  graphic_context=(DrawInfo **) AcquireQuantumMemory(MaxGraphicsStack,
    sizeof(*graphic_context));
  if (graphic_context == (DrawInfo **) NULL)
    ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
      image->filename);
  (void) ResetMagickMemory(graphic_context,0,MaxGraphicsStack*sizeof(*graphic_context));
  graphic_context[n]=CloneDrawInfo((ImageInfo *) NULL,draw_info);
  if (graphic_context[n] == (DrawInfo *) NULL)
    ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
      image->filename);
  /*
    Parse drawing primitives.
  */
  primitive=AcquireString(draw_info->primitive);
  token=primitive;
  GetAffineMatrix(&affine);
  GetAffineMatrix(&current);
  for (q=(const char *) primitive; *q != '\0'; )
  {
    /*
      Interpret graphic primitive.
    */
    GetNextToken(q,&q,MagickPathExtent,primitive_name);
    if (*primitive_name == '\0')
      break;
    if (*primitive_name == '#')
      {
        /*
          Comment.
        */
        continue;
      }
    if (LocaleCompare("pop",primitive_name) == 0)
      {
        if (n == 0)
          {
            status=MagickFalse;
            break;
          }
        graphic_context[n]=DestroyDrawInfo(graphic_context[n]);
        n--;
        continue;
      }
    if (LocaleCompare("push",primitive_name) == 0)
      {
        n++;
        if (n >= MaxGraphicsStack)
          {
            status=MagickFalse;
            break;
          }
        graphic_context[n]=CloneDrawInfo((ImageInfo *) NULL,graphic_context[n-1]);
        if (graphic_context[n] == (DrawInfo *) NULL)
          {
            status=MagickFalse;
            break;
          }
        continue;
      }
    /*
      Process drawing primitive.
    */
    status=InterpretImageProperties(image,graphic_context[n],primitive_name,
      exception);
    if (status == MagickFalse)
      break;
  }