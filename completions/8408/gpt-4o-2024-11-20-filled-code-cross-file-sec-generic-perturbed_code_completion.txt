/*
    Parse and execute drawing commands.
  */
  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  assert(draw_info != (DrawInfo *) NULL);
  assert(draw_info->signature == MagickCoreSignature);
  assert(exception != (ExceptionInfo *) NULL);
  assert(exception->signature == MagickCoreSignature);

  if (image->debug != MagickFalse)
    (void) LogMagickEvent(DrawEvent,GetMagickModule(),"begin draw-image");

  GetAffineMatrix(&affine);
  GetAffineMatrix(&current);

  token = primitive = AcquireString(draw_info->primitive);
  if (token == (char *) NULL)
    ThrowBinaryException(ResourceLimitError, "MemoryAllocationFailed", image->filename);

  size_t extent = strlen(token) + MagickPathExtent;
  size_t number_points = 2047;
  PrimitiveInfo *primitive_info = (PrimitiveInfo *) AcquireQuantumMemory(number_points, sizeof(*primitive_info));
  if (primitive_info == (PrimitiveInfo *) NULL)
    ThrowBinaryException(ResourceLimitError, "MemoryAllocationFailed", image->filename);

  DrawInfo **graphic_context = (DrawInfo **) AcquireMagickMemory(sizeof(*graphic_context));
  if (graphic_context == (DrawInfo **) NULL)
    ThrowBinaryException(ResourceLimitError, "MemoryAllocationFailed", image->filename);

  graphic_context[0] = CloneDrawInfo((ImageInfo *) NULL, draw_info);
  ssize_t n = 0;
  MagickBooleanType status = MagickTrue;

  for (q = primitive; *q != '\0'; )
  {
    char keyword[MagickPathExtent];
    GetNextToken(q, &q, MagickPathExtent, keyword);
    if (*keyword == '\0')
      break;

    if (LocaleCompare(keyword, "push") == 0)
    {
      GetNextToken(q, &q, extent, token);
      if (LocaleCompare(token, "graphic-context") == 0)
      {
        n++;
        graphic_context = (DrawInfo **) ResizeQuantumMemory(graphic_context, (size_t) (n + 1), sizeof(*graphic_context));
        if (graphic_context == (DrawInfo **) NULL)
          ThrowBinaryException(ResourceLimitError, "MemoryAllocationFailed", image->filename);
        graphic_context[n] = CloneDrawInfo((ImageInfo *) NULL, graphic_context[n - 1]);
        continue;
      }
      status = MagickFalse;
      break;
    }

    if (LocaleCompare(keyword, "pop") == 0)
    {
      GetNextToken(q, &q, extent, token);
      if (LocaleCompare(token, "graphic-context") == 0)
      {
        if (n == 0)
        {
          status = MagickFalse;
          break;
        }
        graphic_context[n] = DestroyDrawInfo(graphic_context[n]);
        n--;
        continue;
      }
      status = MagickFalse;
      break;
    }

    if (LocaleCompare(keyword, "affine") == 0)
    {
      GetNextToken(q, &q, extent, token);
      affine.sx = StringToDouble(token, &next_token);
      GetNextToken(q, &q, extent, token);
      affine.rx = StringToDouble(token, &next_token);
      GetNextToken(q, &q, extent, token);
      affine.ry = StringToDouble(token, &next_token);
      GetNextToken(q, &q, extent, token);
      affine.sy = StringToDouble(token, &next_token);
      GetNextToken(q, &q, extent, token);
      affine.tx = StringToDouble(token, &next_token);
      GetNextToken(q, &q, extent, token);
      affine.ty = StringToDouble(token, &next_token);
      continue;
    }

    if (LocaleCompare(keyword, "primitive") == 0)
    {
      GetNextToken(q, &q, extent, token);
      graphic_context[n]->primitive = ConstantString(token);
      continue;
    }

    if (LocaleCompare(keyword, "fill") == 0)
    {
      GetNextToken(q, &q, extent, token);
      (void) QueryColorCompliance(token, AllCompliance, &graphic_context[n]->fill, exception);
      continue;
    }

    if (LocaleCompare(keyword, "stroke") == 0)
    {
      GetNextToken(q, &q, extent, token);
      (void) QueryColorCompliance(token, AllCompliance, &graphic_context[n]->stroke, exception);
      continue;
    }

    if (LocaleCompare(keyword, "stroke-width") == 0)
    {
      GetNextToken(q, &q, extent, token);
      graphic_context[n]->stroke_width = StringToDouble(token, &next_token);
      continue;
    }

    status = MagickFalse;
    break;
  }

  if (status != MagickFalse)
  {
    status = RenderMVGContent(image, graphic_context, primitive_info, exception);
  }