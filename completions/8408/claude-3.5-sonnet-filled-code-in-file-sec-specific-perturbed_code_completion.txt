if (image->debug != MagickFalse)
    (void) LogMagickEvent(DrawEvent,GetMagickModule(),"    begin draw-image");

  status=MagickTrue;
  primitive=InterpretImageProperties((ImageInfo *) NULL,image,draw_info->primitive,
    exception);
  if (primitive == (char *) NULL)
    return(MagickFalse);
  token=AcquireString(primitive);
  extent=strlen(token)+1;
  primitive_info=(PrimitiveInfo *) AcquireQuantumMemory(extent,
    sizeof(*primitive_info));
  if (primitive_info == (PrimitiveInfo *) NULL)
    {
      token=DestroyString(token);
      primitive=DestroyString(primitive);
      ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
        image->filename);
    }
  graphic_context=(DrawInfo **) AcquireQuantumMemory(extent,
    sizeof(*graphic_context));
  if (graphic_context == (DrawInfo **) NULL)
    {
      primitive_info=(PrimitiveInfo *) RelinquishMagickMemory(primitive_info);
      token=DestroyString(token);
      primitive=DestroyString(primitive);
      ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
        image->filename);
    }
  graphic_context[n]=CloneDrawInfo((ImageInfo *) NULL,draw_info);
  token[0]='\0';
  next_token=token;
  for (q=(char *) primitive; *q != '\0'; )
  {
    GetNextToken(q,&q,MagickPathExtent,token);
    if (*token == '\0')
      continue;
    if (*token == '#')
      {
        /*
          Comment.
        */
        while ((*q != '\n') && (*q != '\0'))
          q++;
        continue;
      }
    if (LocaleCompare("push",token) == 0)
      {
        n++;
        graphic_context[n]=CloneDrawInfo((ImageInfo *) NULL,
          graphic_context[n-1]);
        continue;
      }
    if (LocaleCompare("pop",token) == 0)
      {
        if (n <= 0)
          {
            (void) ThrowMagickException(exception,GetMagickModule(),
              DrawError,"UnbalancedGraphicContextPushPop","`%s'",token);
            status=MagickFalse;
            break;
          }
        graphic_context[n]=DestroyDrawInfo(graphic_context[n]);
        n--;
        continue;
      }
    if (LocaleCompare("graphic-context",token) == 0)
      {
        primitive_type=UndefinedPrimitive;
        continue;
      }
    status=RenderPrimitiveToken(image,graphic_context[n],token,&primitive_type,
      &primitive_info[number_points],&start,&stop,&next_token,&point,exception);
    if (status == MagickFalse)
      break;
    if (primitive_type == UndefinedPrimitive)
      continue;
    if (stop < start)
      continue;
    number_points+=stop-start+1;
    q=next_token;
  }