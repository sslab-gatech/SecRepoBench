/*
    Initialize graphic context stack.
  */
  GetAffineMatrix(&affine);
  GetAffineMatrix(&current);
  token=AcquireString(draw_info->primitive);
  extent=strlen(token)+MagickPathExtent;
  graphic_context=(DrawInfo **) AcquireMagickMemory(sizeof(*graphic_context));
  if (graphic_context == (DrawInfo **) NULL)
    ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
      image->filename);
  graphic_context[0]=CloneDrawInfo((ImageInfo *) NULL,draw_info);
  n=0;
  status=MagickTrue;
  primitive_info=(PrimitiveInfo *) NULL;
  stops=(StopInfo *) NULL;
  for (q=token; *q != '\0'; )
  {
    /*
      Interpret graphic primitive.
    */
    GetNextToken(q,&q,MagickPathExtent,primitive_name);
    if (*primitive_name == '\0')
      break;
    if (LocaleCompare("push",primitive_name) == 0)
      {
        GetNextToken(q,&q,MagickPathExtent,primitive_name);
        if (LocaleCompare("graphic-context",primitive_name) == 0)
          {
            n++;
            graphic_context=(DrawInfo **) ResizeQuantumMemory(graphic_context,
              (size_t) (n+1),sizeof(*graphic_context));
            if (graphic_context == (DrawInfo **) NULL)
              ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
                image->filename);
            graphic_context[n]=CloneDrawInfo((ImageInfo *) NULL,
              graphic_context[n-1]);
            continue;
          }
        status=MagickFalse;
        break;
      }
    if (LocaleCompare("pop",primitive_name) == 0)
      {
        GetNextToken(q,&q,MagickPathExtent,primitive_name);
        if (LocaleCompare("graphic-context",primitive_name) == 0)
          {
            if (n == 0)
              {
                status=MagickFalse;
                break;
              }
            graphic_context[n]=DestroyDrawInfo(graphic_context[n]);
            n--;
            continue;
          }
        status=MagickFalse;
        break;
      }
    primitive=AcquireString(primitive_name);
    primitive_info=(PrimitiveInfo *) ResizeQuantumMemory(primitive_info,
      (size_t) (n+1),sizeof(*primitive_info));
    if (primitive_info == (PrimitiveInfo *) NULL)
      ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
        image->filename);
    status=ParsePrimitive(image,graphic_context[n],primitive,primitive_info,
      exception);
    primitive=DestroyString(primitive);
    if (status == MagickFalse)
      break;
  }