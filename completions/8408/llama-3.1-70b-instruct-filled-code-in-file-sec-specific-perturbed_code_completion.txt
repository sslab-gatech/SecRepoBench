primitive = AcquireString(draw_info->primitive);
if (primitive == (char *) NULL)
  return(MagickFalse);
if (LocaleCompare(primitive,"push graphic-context") == 0)
  {
    graphic_context[n]=CloneDrawInfo((ImageInfo *) NULL,draw_info);
    if (graphic_context[n] == (DrawInfo *) NULL)
      return(MagickFalse);
    n++;
    if (n >= (ssize_t) GetMagickResourceLimit(ThreadResource))
      {
        status=MagickFalse;
        break;
      }
    continue;
  }
if (LocaleCompare(primitive,"pop graphic-context") == 0)
  {
    if (n == 0)
      {
        status=MagickFalse;
        break;
      }
    n--;
    graphic_context[n]=DestroyDrawInfo(graphic_context[n]);
    continue;
  }
if (LocaleCompare(primitive,"define") == 0)
  {
    char
      *id;

    id=GetNodeByURL(primitive,"id");
    if (id == (char *) NULL)
      {
        status=MagickFalse;
        break;
      }
    (void) FormatLocaleString(property,MagickPathExtent,"%s",id);
    if (GetImageArtifact(image,property)!= (const char *) NULL)
      {
        DestroyString(id);
        continue;
      }
    (void) FormatLocaleString(property,MagickPathExtent,"%s",id);
    (void) SetImageArtifact(image,property,primitive);
    DestroyString(id);
    continue;
  }
if (LocaleCompare(primitive,"use") == 0)
  {
    char
      *id;

    id=GetNodeByURL(primitive,"id");
    if (id == (char *) NULL)
      {
        status=MagickFalse;
        break;
      }
    (void) FormatLocaleString(property,MagickPathExtent,"%s",id);
    primitive=GetImageArtifact(image,property);
    DestroyString(id);
    if (primitive == (char *) NULL)
      {
        status=MagickFalse;
        break;
      }
  }
if (LocaleCompare(primitive,"image") == 0)
  {
    PrimitiveInfo
      primitive_info[3];

    if (draw_info->debug!= MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),
        "  begin image");
    primitive_info[0].primitive=ImagePrimitive;
    primitive_info[0].coordinates=2;
    primitive_info[0].point.x=0.0;
    primitive_info[0].point.y=0.0;
    primitive_info[1].primitive=UndefinedPrimitive;
    primitive_info[1].point.x=0.0;
    primitive_info[1].point.y=0.0;
    primitive_info[1].text=AcquireString(primitive);
    if (primitive_info[1].text == (char *) NULL)
      {
        status=MagickFalse;
        break;
      }
    status&=DrawPrimitive(image,draw_info,primitive_info,exception);
    primitive_info[1].text=DestroyString(primitive_info[1].text);
    if (draw_info->debug!= MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),"  end image");
    continue;
  }
if (LocaleCompare(primitive,"pattern") == 0)
  {
    if (draw_info->debug!= MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),
        "  begin pattern");
    status&=DrawPatternPath(image,draw_info,primitive,&pattern,exception);
    if (draw_info->debug!= MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),"  end pattern");
    continue;
  }
if (LocaleCompare(primitive,"clip-path") == 0)
  {
    if (draw_info->debug!= MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),
        "  begin clip-path");
    status&=DrawClipPath(image,draw_info,primitive,exception);
    if (draw_info->debug!= MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),"  end clip-path");
    continue;
  }
if (LocaleCompare(primitive,"mask-path") == 0)
  {
    if (draw_info->debug!= MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),
        "  begin mask-path");
    status&=DrawCompositeMask(image,draw_info,primitive,primitive,exception);
    if (draw_info->debug!= MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),"  end mask-path");
    continue;
  }
if (LocaleCompare(primitive,"gradient") == 0)
  {
    if (draw_info->debug!= MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),
        "  begin gradient");
    status&=DrawGradientImage(image,draw_info,exception);
    if (draw_info->debug!= MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),"  end gradient");
    continue;
  }
if (LocaleCompare(primitive,"viewbox") == 0)
  {
    char
      *next_token;

    double
      x,
      y;

    GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    x=StringToDouble(token,&next_token);
    if (token == next_token)
      ThrowPointExpectedException(token,exception);
    GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    y=StringToDouble(token,&next_token);
    if (token == next_token)
      ThrowPointExpectedException(token,exception);
    GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    x=StringToDouble(token,&next_token);
    if (token == next_token)
      ThrowPointExpectedException(token,exception);
    GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    y=StringToDouble(token,&next_token);
    if (token == next_token)
      ThrowPointExpectedException(token,exception);
    draw_info->viewbox.x=(double) x;
    draw_info->viewbox.y=(double) y;
    draw_info->viewbox.width=(double) x;
    draw_info->viewbox.height=(double) y;
    continue;
  }
if (LocaleCompare(primitive,"scale") == 0)
  {
    char
      *next_token;

    double
      x,
      y;

    GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    x=StringToDouble(token,&next_token);
    if (token == next_token)
      ThrowPointExpectedException(token,exception);
    GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    y=StringToDouble(token,&next_token);
    if (token == next_token)
      ThrowPointExpectedException(token,exception);
    draw_info->affine.sx*=x;
    draw_info->affine.sy*=y;
    continue;
  }
if (LocaleCompare(primitive,"rotate") == 0)
  {
    char
      *next_token;

    double
      angle,
      x,
      y;

    GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    angle=StringToDouble(token,&next_token);
    if (token == next_token)
      ThrowPointExpectedException(token,exception);
    GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    x=StringToDouble(token,&next_token);
    if (token == next_token)
      ThrowPointExpectedException(token,exception);
    GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    y=StringToDouble(token,&next_token);
    if (token == next_token)
      ThrowPointExpectedException(token,exception);
    angle=DegreesToRadians(angle);
    draw_info->affine.sx*=cos(angle);
    draw_info->affine.rx*=cos(angle);
    draw_info->affine.ry*=sin(angle);
    draw_info->affine.sy*=sin(angle);
    draw_info->affine.tx+=x;
    draw_info->affine.ty+=y;
    draw_info->affine.tx-=x*cos(angle)-y*sin(angle);
    draw_info->affine.ty-=x*sin(angle)+y*cos(angle);
    continue;
  }
if (LocaleCompare(primitive,"translate") == 0)
  {
    char
      *next_token;

    double
      x,
      y;

    GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    x=StringToDouble(token,&next_token);
    if (token == next_token)
      ThrowPointExpectedException(token,exception);
    GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    y=StringToDouble(token,&next_token);
    if (token == next_token)
      ThrowPointExpectedException(token,exception);
    draw_info->affine.tx+=x;
    draw_info->affine.ty+=y;
    continue;
  }
if (LocaleCompare(primitive,"skewX") == 0)
  {
    char
      *next_token;

    double
      angle;

    GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    angle=StringToDouble(token,&next_token);
    if (token == next_token)
      ThrowPointExpectedException(token,exception);
    angle=DegreesToRadians(angle);
    draw_info->affine.rx+=tan(angle);
    continue;
  }
if (LocaleCompare(primitive,"skewY") == 0)
  {
    char
      *next_token;

    double
      angle;

    GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    angle=StringToDouble(token,&next_token);
    if (token == next_token)
      ThrowPointExpectedException(token,exception);
    angle=DegreesToRadians(angle);
    draw_info->affine.ry+=tan(angle);
    continue;
  }
if (LocaleCompare(primitive,"path") == 0)
  {
    MVGInfo
      mvg_info;

    mvg_info.primitive_info=(PrimitiveInfo **) &primitive_info;
    mvg_info.extent=(size_t *) &extent;
    mvg_info.offset=(ssize_t *) &offset;
    mvg_info.exception=exception;
    offset=TracePath(&mvg_info,primitive,exception);
    if (offset == 0)
      {
        status=MagickFalse;
        break;
      }
    continue;
  }
if (LocaleCompare(primitive,"fill") == 0)
  {
    if (draw_info->debug!= MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),
        "  begin fill");
    (void) QueryColorCompliance(primitive,AllCompliance,&draw_info->fill,
      exception);
    if (draw_info->debug!= MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),"  end fill");
    continue;
  }
if (LocaleCompare(primitive,"stroke") == 0)
  {
    if (draw_info->debug!= MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),
        "  begin stroke");
    (void) QueryColorCompliance(primitive,AllCompliance,&draw_info->stroke,
      exception);
    if (draw_info->debug!= MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),"  end stroke");
    continue;
  }
if (LocaleCompare(primitive,"stroke-width") == 0)
  {
    char
      *next_token;

    double
      width;

    GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    width=StringToDouble(token,&next_token);
    if (token == next_token)
      ThrowPointExpectedException(token,exception);
    draw_info->stroke_width=width;
    continue;
  }
if (LocaleCompare(primitive,"stroke-linecap") == 0)
  {
    const char
      *option;

    option=GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    draw_info->linecap=(LineCap) ParseCommandOption(MagickLineCapOptions,
      MagickFalse,option);
    continue;
  }
if (LocaleCompare(primitive,"stroke-linejoin") == 0)
  {
    const char
      *option;

    option=GetNextToken(primitive,&primitive,MagickPathExtent,token);
    if (*token == ',')
      GetNextToken(primitive,&primitive,MagickPathExtent,token);
    draw_info->linejoin=(LineJoin) ParseCommandOption(Magic