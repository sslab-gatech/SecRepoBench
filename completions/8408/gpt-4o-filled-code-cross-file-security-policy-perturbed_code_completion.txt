MagickBooleanType
    status;

  PrimitiveInfo
    *primitive_info;

  size_t
    number_points;

  ssize_t
    n;

  /*
    Initialize graphics context.
  */
  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(draw_info != (DrawInfo *) NULL);
  assert(draw_info->signature == MagickCoreSignature);
  assert(exception != (ExceptionInfo *) NULL);
  assert(exception->signature == MagickCoreSignature);
  status=MagickTrue;
  number_points=2047;
  primitive_info=(PrimitiveInfo *) AcquireQuantumMemory(number_points,
    sizeof(*primitive_info));
  if (primitive_info == (PrimitiveInfo *) NULL)
    ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
      image->filename);
  GetAffineMatrix(&affine);
  token=AcquireString(draw_info->primitive);
  extent=strlen(token)+MagickPathExtent;
  n=0;
  for (q=(const char *) token; *q != '\0'; )
  {
    /*
      Interpret graphic primitive.
    */
    GetNextToken(q,&q,MagickPathExtent,primitive_name);
    if (*primitive_name == '\0')
      break;
    if (*primitive_name == '#')
      {
        /*
          Comment.
        */
        for ( ; (*q != '\n') && (*q != '\0'); q++);
        continue;
      }
    primitive_type=UndefinedPrimitive;
    switch (*primitive_name)
    {
      case ';':
      {
        break;
      }
      case 'a':
      case 'A':
      {
        if (LocaleCompare("affine",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            affine.sx=StringToDouble(token,&next_token);
            GetNextToken(q,&q,extent,token);
            if (*token == ',')
              GetNextToken(q,&q,extent,token);
            affine.rx=StringToDouble(token,&next_token);
            GetNextToken(q,&q,extent,token);
            if (*token == ',')
              GetNextToken(q,&q,extent,token);
            affine.ry=StringToDouble(token,&next_token);
            GetNextToken(q,&q,extent,token);
            if (*token == ',')
              GetNextToken(q,&q,extent,token);
            affine.sy=StringToDouble(token,&next_token);
            GetNextToken(q,&q,extent,token);
            if (*token == ',')
              GetNextToken(q,&q,extent,token);
            affine.tx=StringToDouble(token,&next_token);
            GetNextToken(q,&q,extent,token);
            if (*token == ',')
              GetNextToken(q,&q,extent,token);
            affine.ty=StringToDouble(token,&next_token);
            break;
          }
        if (LocaleCompare("alpha",primitive_name) == 0)
          {
            primitive_type=AlphaPrimitive;
            break;
          }
        if (LocaleCompare("angle",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            affine.rx=StringToDouble(token,&next_token);
            affine.ry=StringToDouble(token,&next_token);
            break;
          }
        if (LocaleCompare("arc",primitive_name) == 0)
          {
            primitive_type=ArcPrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'b':
      case 'B':
      {
        if (LocaleCompare("bezier",primitive_name) == 0)
          {
            primitive_type=BezierPrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'c':
      case 'C':
      {
        if (LocaleCompare("circle",primitive_name) == 0)
          {
            primitive_type=CirclePrimitive;
            break;
          }
        if (LocaleCompare("clip-path",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,
              "clip-path:url(#%s);",token);
            break;
          }
        if (LocaleCompare("clip-rule",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,"clip-rule:%s;",
              token);
            break;
          }
        if (LocaleCompare("clip-units",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,
              "clipPathUnits=%s;",token);
            break;
          }
        if (LocaleCompare("color",primitive_name) == 0)
          {
            primitive_type=ColorPrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'd':
      case 'D':
      {
        if (LocaleCompare("decorate",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,
              "text-decoration:%s;",token);
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'e':
      case 'E':
      {
        if (LocaleCompare("ellipse",primitive_name) == 0)
          {
            primitive_type=EllipsePrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'f':
      case 'F':
      {
        if (LocaleCompare("fill",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,"fill:%s;",
              token);
            break;
          }
        if (LocaleCompare("fill-rule",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,
              "fill-rule:%s;",token);
            break;
          }
        if (LocaleCompare("fill-opacity",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,
              "fill-opacity:%s;",token);
            break;
          }
        if (LocaleCompare("font-family",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,
              "font-family:%s;",token);
            break;
          }
        if (LocaleCompare("font-stretch",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,
              "font-stretch:%s;",token);
            break;
          }
        if (LocaleCompare("font-style",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,
              "font-style:%s;",token);
            break;
          }
        if (LocaleCompare("font-size",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,
              "font-size:%s;",token);
            break;
          }
        if (LocaleCompare("font-weight",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,
              "font-weight:%s;",token);
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'g':
      case 'G':
      {
        if (LocaleCompare("gradient-units",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            break;
          }
        if (LocaleCompare("text-align",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,
              "text-align %s ",token);
            break;
          }
        if (LocaleCompare("text-anchor",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,
              "text-anchor %s ",token);
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'i':
      case 'I':
      {
        if (LocaleCompare("image",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            primitive_type=ImagePrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'l':
      case 'L':
      {
        if (LocaleCompare("line",primitive_name) == 0)
          {
            primitive_type=LinePrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'o':
      case 'O':
      {
        if (LocaleCompare("opacity",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,"opacity %s ",
              token);
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'p':
      case 'P':
      {
        if (LocaleCompare("path",primitive_name) == 0)
          {
            primitive_type=PathPrimitive;
            break;
          }
        if (LocaleCompare("point",primitive_name) == 0)
          {
            primitive_type=PointPrimitive;
            break;
          }
        if (LocaleCompare("polyline",primitive_name) == 0)
          {
            primitive_type=PolylinePrimitive;
            break;
          }
        if (LocaleCompare("polygon",primitive_name) == 0)
          {
            primitive_type=PolygonPrimitive;
            break;
          }
        if (LocaleCompare("pop",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            if (LocaleCompare("clip-path",token) == 0)
              {
                break;
              }
            if (LocaleCompare("defs",token) == 0)
              {
                break;
              }
            if (LocaleCompare("gradient",token) == 0)
              {
                break;
              }
            if (LocaleCompare("graphic-context",token) == 0)
              {
                n--;
                if (n < 0)
                  ThrowBinaryException(DrawError,
                    "UnbalancedGraphicContextPushPop",primitive_name);
              }
            if (LocaleCompare("pattern",token) == 0)
              {
                break;
              }
            if (LocaleCompare("symbol",token) == 0)
              {
                break;
              }
            break;
          }
        if (LocaleCompare("push",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            if (LocaleCompare("clip-path",token) == 0)
              {
                GetNextToken(q,&q,extent,token);
                break;
              }
            if (LocaleCompare("defs",token) == 0)
              {
                break;
              }
            if (LocaleCompare("gradient",token) == 0)
              {
                GetNextToken(q,&q,extent,token);
                GetNextToken(q,&q,extent,token);
                GetNextToken(q,&q,extent,token);
                GetNextToken(q,&q,extent,token);
                GetNextToken(q,&q,extent,token);
                GetNextToken(q,&q,extent,token);
                break;
              }
            if (LocaleCompare("graphic-context",token) == 0)
              {
                n++;
              }
            if (LocaleCompare("pattern",token) == 0)
              {
                GetNextToken(q,&q,extent,token);
                GetNextToken(q,&q,extent,token);
                GetNextToken(q,&q,extent,token);
                GetNextToken(q,&q,extent,token);
                GetNextToken(q,&q,extent,token);
                break;
              }
            if (LocaleCompare("symbol",token) == 0)
              {
                break;
              }
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'r':
      case 'R':
      {
        if (LocaleCompare("rectangle",primitive_name) == 0)
          {
            primitive_type=RectanglePrimitive;
            break;
          }
        if (LocaleCompare("roundRectangle",primitive_name) == 0)
          {
            primitive_type=RoundRectanglePrimitive;
            break;
          }
        if (LocaleCompare("rotate",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,"rotate(%s) ",
              token);
            break;
          }
        status=MagickFalse;
        break;
      }
      case 's':
      case 'S':
      {
        if (LocaleCompare("scale",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            affine.sx=StringToDouble(token,&next_token);
            GetNextToken(q,&q,extent,token);
            if (*token == ',')
              GetNextToken(q,&q,extent,token);
            affine.sy=StringToDouble(token,&next_token);
            break;
          }
        if (LocaleCompare("skewX",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometry,MagickPathExtent,"skewX(%s) ",
              token);
            break;
          }
        if (LocaleCompare("skewY",primitive_name) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(geometr