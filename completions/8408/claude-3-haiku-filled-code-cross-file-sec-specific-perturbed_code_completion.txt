if (image->debug != MagickFalse)
  (void) LogMagickEvent(DrawEvent,GetMagickModule(),"begin draw-image");

// Allocate and initialize the graphic context stack
graphic_context=(DrawInfo **) AcquireQuantumMemory((size_t) BezierQuantum+1,
  sizeof(*graphic_context));
if (graphic_context == (DrawInfo **) NULL)
  ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
    primitive_name);
(void) memset(graphic_context,0,(size_t) BezierQuantum*sizeof(*graphic_context));
n=0;
graphic_context[n]=CloneDrawInfo((ImageInfo *) NULL,draw_info);

// Parse and execute the drawing commands
token=AcquireString(draw_info->primitive);
primitive_info=(PrimitiveInfo *) AcquireQuantumMemory(BezierQuantum,
  sizeof(*primitive_info));
if (primitive_info == (PrimitiveInfo *) NULL)
  ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
    primitive_name);
stops=(StopInfo *) NULL;
status=MagickTrue;
for (q=token; *q != '\0'; )
{
  // Interpret and execute the drawing commands
  // ...
}