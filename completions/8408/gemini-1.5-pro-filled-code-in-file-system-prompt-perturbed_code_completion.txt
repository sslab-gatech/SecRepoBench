char
    *clip_path;

  const char
    *primitive;

  DrawInfo
    **graphic_context;

  double
    angle,
    coordinates,
    cursor,
    factor,
    primitive_extent;

  ElementInfo
    element;

  MagickBooleanType
    status;

  MVGInfo
    mvg_info;

  PointInfo
    point;

  PrimitiveInfo
    *primitive_info;

  PrimitiveType
    primitive_type;

  register ssize_t
    i,
    n;

  size_t
    extent,
    number_stops;

  ssize_t
    j,
    offset;

  StopInfo
    *stops;

  /*
    Ensure the primitive is not NULL.
  */
  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(draw_info != (DrawInfo *) NULL);
  assert(draw_info->signature == MagickCoreSignature);
  if (draw_info->primitive == (char *) NULL)
    return(MagickFalse);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(DrawEvent,GetMagickModule(),"begin draw-image");
  /*
    Allocate primitive info memory.
  */
  primitive_extent=(strlen(draw_info->primitive)+1)*ExpandAffine(
    &draw_info->affine)+65537;
  if (primitive_extent > MaxBezierCoordinates)
    primitive_extent=MaxBezierCoordinates;
  primitive_info=(PrimitiveInfo *) AcquireQuantumMemory((size_t)
    primitive_extent,sizeof(*primitive_info));
  if (primitive_info == (PrimitiveInfo *) NULL)
    return(MagickFalse);
  (void) memset(primitive_info,0,(size_t) primitive_extent*
    sizeof(*primitive_info));
  /*
    Parse the primitive string, and initialize the graphic context stack.
  */
  primitive=draw_info->primitive;
  extent=strlen(primitive)+MagickPathExtent;
  token=(char *) AcquireQuantumMemory(extent,sizeof(*token));
  graphic_context=(DrawInfo **) AcquireQuantumMemory(
    GetMagickResourceLimit(ListLengthResource),sizeof(*graphic_context));
  stops=(StopInfo *) NULL;
  number_stops=0;
  status=MagickTrue;
  if ((token == (char *) NULL) || (graphic_context == (DrawInfo **) NULL))
    ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
      image->filename);
  n=0;
  graphic_context[n]=CloneDrawInfo((ImageInfo *) NULL,draw_info);
  mvg_info.primitive_info=&primitive_info;
  mvg_info.extent=&primitive_extent;
  mvg_info.offset=0;
  mvg_info.exception=exception;
  offset=0;
  cursor=0.0;
  element.cx=0.0;
  element.cy=0.0;
  element.major=0.0;
  element.minor=0.0;
  element.angle=0.0;
  for (q=primitive; *q != '\0'; )
  {
    /*
      Interpret graphic primitive.
    */
    GetNextToken(q,&q,extent,token);
    if (*token == '\0')
      break;
    if (image->debug != MagickFalse)
      (void) LogMagickEvent(DrawEvent,GetMagickModule(),"  %.20g: %s",
        (double) cursor,(char *) token);
    if (*token == '@')
      {
        /*
          Annotation.
        */
        GetNextToken(q,&q,extent,token);
        clip_path=GetNodeByURL(primitive,token);
        if (clip_path != (char *) NULL)
          {
            (void) DrawClipPath(image,graphic_context[n],token,exception);
            clip_path=DestroyString(clip_path);
          }
        continue;
      }