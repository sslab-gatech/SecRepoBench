def ndpi_int_tls_add_connection(ndpi_struct, flow, protocol):
    if protocol != NDPI_PROTOCOL_TLS:
        protocol = ndpi_tls_refine_master_protocol(ndpi_struct, flow, protocol)

    ndpi_set_detected_protocol(ndpi_struct, flow, protocol, NDPI_PROTOCOL_TLS)
    sslInitExtraPacketProcessing(flow)