// Extract the server name from the TLS certificate payload.
// Check if the extracted server name appears to be a valid host name or IP address.
// If valid, store the server name in the flow's `server_certificate` field.
// Optionally, attempt to match the extracted server name to a known protocol.
// If a subprotocol is detected, set the flow's detected protocol accordingly.
// If a valid server name is extracted and optionally matched, return indicating success.
// If a valid server name is extracted and optionally matched, return indicating success.
if ((packet->payload[i] == 0x04) && (packet->payload[i+1] == 0x03) && (packet->payload[i+2] == 0x0c)
    || ((packet->payload[i] == 0x04) && (packet->payload[i+1] == 0x03) && (packet->payload[i+2] == 0x13))
    || ((packet->payload[i] == 0x55) && (packet->payload[i+1] == 0x04) && (packet->payload[i+2] == 0x03))) {
  // Extract the server name from the TLS certificate payload.
  u_int8_t server_len = packet->payload[i+4];

  // Check if the extracted server name appears to be a valid host name or IP address.
  if (server_len > 0 && server_len < 256) {
    char server_name[256];
    strncpy(server_name, (char*)&packet->payload[i+5], server_len);
    server_name[server_len] = '\0';

    // If valid, store the server name in the flow's `server_certificate` field.
    if (ndpi_is_valid_hostname_or_ip(server_name)) {
      snprintf(flow->protos.stun_ssl.ssl.server_certificate,
               sizeof(flow->protos.stun_ssl.ssl.server_certificate), "%s", server_name);

      // Optionally, attempt to match the extracted server name to a known protocol.
      u_int16_t subproto = ndpi_match_host_subprotocol(ndpi_struct, flow, server_name,
                                                       strlen(server_name),
                                                       NULL,
                                                       NDPI_PROTOCOL_TLS);

      // If a subprotocol is detected, set the flow's detected protocol accordingly.
      if (subproto!= NDPI_PROTOCOL_UNKNOWN) {
        ndpi_set_detected_protocol(ndpi_struct, flow, subproto,
                                   ndpi_tls_refine_master_protocol(ndpi_struct, flow, NDPI_PROTOCOL_TLS));
      }
    }
  }
}