u_int8_t server_name_len = packet->payload[i+3];
            u_int copy_len = (u_int)ndpi_min(server_name_len, buffer_len - 1);

            if((i + 4 + server_name_len) < packet->payload_packet_len) {
              strncpy(buffer, (char*)&packet->payload[i+4], copy_len);
              buffer[copy_len] = '\0';

              stripCertificateTrailer(buffer, buffer_len);

              if(!ndpi_struct->disable_metadata_export) {
                snprintf(flow->protos.stun_ssl.ssl.server_certificate,
                         sizeof(flow->protos.stun_ssl.ssl.server_certificate), "%s", buffer);
              }

              // Optionally match the server name to a known protocol
              // and set the flow's detected protocol accordingly.
              // This part is left as a placeholder for actual implementation.

              return 1; // Indicate success
            }