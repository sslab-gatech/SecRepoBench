u_int16_t len = (packet->payload[i+3] << 8) + packet->payload[i+4];
if((i+5+len) <= packet->payload_packet_len) {
  char *server_name = (char*)&packet->payload[i+5];
  u_int server_len = ndpi_min(len, buffer_len-1);

  strncpy(buffer, server_name, server_len);
  buffer[server_len] = '\0';

  stripCertificateTrailer(buffer, buffer_len);

  if(ndpi_isprint_str(buffer, server_len)) {
    if(!ndpi_struct->disable_metadata_export) {
      snprintf(flow->protos.stun_ssl.ssl.server_certificate,
               sizeof(flow->protos.stun_ssl.ssl.server_certificate), "%s", buffer);
    }

    if(ndpi_match_hostname_protocol(ndpi_struct, flow, buffer, server_len)) {
      return(1);
    }
  }
}