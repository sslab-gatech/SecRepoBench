char server_name[256];
u_int8_t server_name_len = packet->payload[i+3];

if(i + 3 + server_name_len < packet->payload_packet_len) {
  strncpy(server_name, (char*)&packet->payload[i+3], server_name_len);
  server_name[server_name_len] = '\0';

  if(ndpi_is_valid_host(server_name)) {
    snprintf(flow->protos.stun_ssl.ssl.server_certificate,
             sizeof(flow->protos.stun_ssl.ssl.server_certificate), "%s", server_name);

    if(ndpi_match_known_protocol(server_name, &flow->detected_protocol)) {
      return 1; // Success, valid server name extracted and matched
    }
  }
}