q=p->points;
for (i=1; i < (ssize_t) p->number_points; i++)
{
  /*
    Check if the edge from q[i-1] to q[i] crosses the horizontal line at ycoordinate.
  */
  if (((q[i-1].y <= (double) ycoordinate) && (q[i].y > (double) ycoordinate)) ||
      ((q[i-1].y > (double) ycoordinate) && (q[i].y <= (double) ycoordinate)))
    {
      /*
        Compute the x-intersection of this edge with the line y = ycoordinate.
      */
      double intersect = q[i-1].x + (q[i].x - q[i-1].x) *
        (((double) ycoordinate - q[i-1].y) /
        (q[i].y - q[i-1].y));

      /*
        If the intersection is to the right of (or exactly at) x, update winding number.
      */
      if (intersect >= (double) x)
        {
          /*
            Increase or decrease the winding number depending on
            whether this edge goes upward or downward.
          */
          if (q[i].y > q[i-1].y)
            winding_number++;
          else
            winding_number--;
        }
    }
}