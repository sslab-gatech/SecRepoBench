status;

  /*
    Draw a composite mask.
  */
  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(draw_info != (const DrawInfo *) NULL);
  composite_mask=AcquireImage((const ImageInfo *) NULL,exception);
  status=SetImageExtent(composite_mask,image->columns,image->rows,exception);
  if (status == MagickFalse)
    return(DestroyImage(composite_mask));
  status=SetImageMask(composite_mask,WritePixelMask,(Image *) NULL,exception);
  status=QueryColorCompliance("#0000",AllCompliance,
    &composite_mask->background_color,exception);
  composite_mask->background_color.alpha=(MagickRealType) TransparentAlpha;
  composite_mask->background_color.alpha_trait=BlendPixelTrait;
  status=SetImageBackgroundColor(composite_mask,exception);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(DrawEvent,GetMagickModule(),"\nbegin composite-mask %s",
      id);
  clone_info=CloneDrawInfo((ImageInfo *) NULL,draw_info);
  (void) CloneString(&clone_info->primitive,mask_path);
  status=QueryColorCompliance("#ffffff",AllCompliance,&clone_info->fill,
    exception);
  if (clone_info->clip_mask != (char *) NULL)
    clone_info->clip_mask=DestroyString(clone_info->clip_mask);
  status=QueryColorCompliance("#00000000",AllCompliance,&clone_info->stroke,
    exception);
  clone_info->stroke_width=0.0;
  clone_info->alpha=OpaqueAlpha;
  clone_info->clip_path=MagickFalse;
  status=RenderMVGContent(composite_mask,clone_info,0,exception);
  clone_info=DestroyDrawInfo(clone_info);
  separate_mask=SeparateImage(composite_mask,AlphaChannel,exception);
  if (separate_mask == (Image *) NULL)
    status=MagickFalse; 
  else
    {
      composite_mask=DestroyImage(composite_mask);
      composite_mask=separate_mask;
      status&=NegateImage(composite_mask,MagickFalse,exception);
    }
  if (status == MagickFalse)
    composite_mask=DestroyImage(composite_mask);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(DrawEvent,GetMagickModule(),"end composite-mask");
  return(composite_mask);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w C o m p o s i t e M a s k S u b r e g i o n                       %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawCompositeMaskSubregion() draws the mask path and returns it as an image
%  mask.
%
%  The format of the DrawCompositeMaskSubregion method is:
%
%      MagickBooleanType DrawCompositeMaskSubregion(Image *image,
%        const DrawInfo *draw_info,const char *id,const RectangleInfo *subregion,
%        ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o id: the mask path id.
%
%    o subregion: the subregion.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType DrawCompositeMaskSubregion(Image *image,
  const DrawInfo *draw_info,const char *id,const RectangleInfo *subregion,
  ExceptionInfo *exception)
{
  Image
    *composite_mask;

  MagickBooleanType
    status;

  /*
    Draw a composite mask.
  */
  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(draw_info != (const DrawInfo *) NULL);
  assert(subregion != (const RectangleInfo *) NULL);
  composite_mask=DrawCompositeMask(image,draw_info,id,exception);
  if (composite_mask == (Image *) NULL)
    return(MagickFalse);
  if (subregion->width == 0)
    subregion->width=(ssize_t) image->columns;
  if (subregion->height == 0)
    subregion->height=(ssize_t) image->rows;
  status=SetImageRegion(image,composite_mask,subregion->x,subregion->y,
    subregion->width,subregion->height,exception);
  composite_mask=DestroyImage(composite_mask);
  return(status);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w C o m p o s i t e M a s k U s i n g R e g i o n                     %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawCompositeMaskUsingRegion() draws the mask path and returns it as an
%  image mask.
%
%  The format of the DrawCompositeMaskUsingRegion method is:
%
%      MagickBooleanType DrawCompositeMaskUsingRegion(Image *image,
%        const DrawInfo *draw_info,const char *id,const RectangleInfo *region,
%        ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o id: the mask path id.
%
%    o region: the region.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType DrawCompositeMaskUsingRegion(Image *image,
  const DrawInfo *draw_info,const char *id,const RectangleInfo *region,
  ExceptionInfo *exception)
{
  Image
    *composite_mask;

  MagickBooleanType
    status;

  /*
    Draw a composite mask.
  */
  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(draw_info != (const DrawInfo *) NULL);
  assert(region != (const RectangleInfo *) NULL);
  composite_mask=DrawCompositeMask(image,draw_info,id,exception);
  if (composite_mask == (Image *) NULL)
    return(MagickFalse);
  status=SetImageRegion(image,composite_mask,region->x,region->y,region->width,
    region->height,exception);
  composite_mask=DestroyImage(composite_mask);
  return(status);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w C o m p o s i t e M a s k U s i n g R e g i o n s                     %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawCompositeMaskUsingRegions() draws the mask path and returns it as an
%  image mask.
%
%  The format of the DrawCompositeMaskUsingRegions method is:
%
%      MagickBooleanType DrawCompositeMaskUsingRegions(Image *image,
%        const DrawInfo *draw_info,const char *id,const RectangleInfo *regions,
%        size_t number_regions,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o id: the mask path id.
%
%    o regions: the regions.
%
%    o number_regions: the number of regions.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType DrawCompositeMaskUsingRegions(Image *image,
  const DrawInfo *draw_info,const char *id,const RectangleInfo *regions,
  size_t number_regions,ExceptionInfo *exception)
{
  Image
    *composite_mask;

  MagickBooleanType
    status;

  size_t
    i;

  /*
    Draw a composite mask.
  */
  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(draw_info != (const DrawInfo *) NULL);
  assert(regions != (const RectangleInfo *) NULL);
  composite_mask=DrawCompositeMask(image,draw_info,id,exception);
  if (composite_mask == (Image *) NULL)
    return(MagickFalse);
  for (i=0; i < number_regions; i++)
    {
      status=SetImageRegion(image,composite_mask,regions[i].x,regions[i].y,
        regions[i].width,regions[i].height,exception);
      if (status == MagickFalse)
        break;
    }
  composite_mask=DestroyImage(composite_mask);
  return(status);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w C o m p o s i t e M a s k U s i n g R e g i o n s U s i n g R e g i o n s   %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawCompositeMaskUsingRegionsUsingRegions() draws the mask path and returns
%  it as an image mask.
%
%  The format of the DrawCompositeMaskUsingRegionsUsingRegions method is:
%
%      MagickBooleanType DrawCompositeMaskUsingRegionsUsingRegions(Image *image,
%        const DrawInfo *draw_info,const char *id,const RectangleInfo *regions,
%        size_t number_regions,const RectangleInfo *using_regions,
%        size_t number_using_regions,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o id: the mask path id.
%
%    o regions: the regions.
%
%    o number_regions: the number of regions.
%
%    o using_regions: the using regions.
%
%    o number_using_regions: the number of using regions.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType DrawCompositeMaskUsingRegionsUsingRegions(
  Image *image,const DrawInfo *draw_info,const char *id,
  const RectangleInfo *regions,size_t number_regions,
  const RectangleInfo *using_regions,size_t number_using_regions,
  ExceptionInfo *exception)
{
  Image
    *composite_mask;

  MagickBooleanType
    status;

  size_t
    i;

  /*
    Draw a composite mask.
  */
  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(draw_info != (const DrawInfo *) NULL);
  assert(regions != (const RectangleInfo *) NULL);
  assert(using_regions != (const RectangleInfo *) NULL);
  composite_mask=DrawCompositeMask(image,draw_info,id,exception);
  if (composite_mask == (Image *) NULL)
    return(MagickFalse);
  for (i=0; i < number_regions; i++)
    {
      size_t
        j;

      for (j=0; j < number_using_regions; j++)
        {
          status=SetImageRegion(image,composite_mask,regions[i].x+using_regions[j