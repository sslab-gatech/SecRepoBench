if (pictureparameterset->num_ref_loc_offsets < 0) {
        av_log(avctx, AV_LOG_ERROR, "Invalid num_ref_loc_offsets\n");
        return AVERROR_INVALIDDATA;
    }

    pictureparameterset->ref_loc_offsets = av_malloc_array(pictureparameterset->num_ref_loc_offsets, sizeof(*pictureparameterset->ref_loc_offsets));
    if (!pictureparameterset->ref_loc_offsets && pictureparameterset->num_ref_loc_offsets > 0)
        return AVERROR(ENOMEM);

    for (int i = 0; i < pictureparameterset->num_ref_loc_offsets; i++) {
        HEVCRefLocOffset *rlo = &pictureparameterset->ref_loc_offsets[i];
        rlo->layer_id = get_bits(gb, 6);
        
        rlo->scaled_ref_layer_offset_present_flag = get_bits1(gb);
        if (rlo->scaled_ref_layer_offset_present_flag)
            rlo->scaled_ref_layer_offset = get_se_golomb_long(gb);
        
        rlo->ref_region_offset_present_flag = get_bits1(gb);
        if (rlo->ref_region_offset_present_flag) {
            rlo->ref_region_left_offset = get_se_golomb_long(gb);
            rlo->ref_region_top_offset = get_se_golomb_long(gb);
            rlo->ref_region_right_offset = get_se_golomb_long(gb);
            rlo->ref_region_bottom_offset = get_se_golomb_long(gb);
        }
        
        rlo->resample_phase_set_present_flag = get_bits1(gb);
        if (rlo->resample_phase_set_present_flag) {
            rlo->luma_phase_h = get_ue_golomb_long(gb);
            rlo->luma_phase_v = get_ue_golomb_long(gb);
            rlo->chroma_phase_h = get_ue_golomb_long(gb);
            rlo->chroma_phase_v = get_ue_golomb_long(gb);
            
            if (rlo->luma_phase_h > 7 || rlo->luma_phase_v > 7 ||
                rlo->chroma_phase_h > 7 || rlo->chroma_phase_v > 7) {
                av_log(avctx, AV_LOG_ERROR, "Resample phase values out of range (0-7)\n");
                return AVERROR_INVALIDDATA;
            }
        }
    }