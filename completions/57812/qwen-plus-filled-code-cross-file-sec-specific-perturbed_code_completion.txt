if (pictureparameterset->num_ref_loc_offsets > 0) {
    pictureparameterset->ref_layer_ids = av_malloc_array(pictureparameterset->num_ref_loc_offsets, sizeof(*pictureparameterset->ref_layer_ids));
    if (!pictureparameterset->ref_layer_ids)
        return AVERROR(ENOMEM);

    for (int i = 0; i < pictureparameterset->num_ref_loc_offsets; i++) {
        pictureparameterset->ref_layer_ids[i] = get_bits(gb, 6);
    }
}

for (int i = 0; i < pictureparameterset->num_ref_loc_offsets; i++) {
    pictureparameterset->scaled_ref_layer_offset_present_flag[i] = get_bits1(gb);
    if (pictureparameterset->scaled_ref_layer_offset_present_flag[i]) {
        pictureparameterset->scaled_ref_layer_horizontal_offset[i] = get_se_golomb_long(gb);
        pictureparameterset->scaled_ref_layer_vertical_offset[i]   = get_se_golomb_long(gb);
    }

    pictureparameterset->ref_region_offset_present_flag[i] = get_bits1(gb);
    if (pictureparameterset->ref_region_offset_present_flag[i]) {
        pictureparameterset->ref_region_horizontal_offset[i] = get_se_golomb_long(gb);
        pictureparameterset->ref_region_vertical_offset[i]   = get_se_golomb_long(gb);
    }
}

pictureparameterset->resample_phase_set_present_flag = get_bits1(gb);
if (pictureparameterset->resample_phase_set_present_flag) {
    for (int i = 0; i < pictureparameterset->num_ref_loc_offsets; i++) {
        if (get_bits1(gb)) { // resample phase present flag
            pictureparameterset->luma_phase[i]     = get_bits(gb, 8);
            pictureparameterset->chroma_phase[i][0] = get_bits(gb, 8);
            pictureparameterset->chroma_phase[i][1] = get_bits(gb, 8);
        }
    }
}