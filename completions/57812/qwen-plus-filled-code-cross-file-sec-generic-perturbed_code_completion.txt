for (int i = 0; i < pictureparameterset->num_ref_loc_offsets; i++) {
    int layer_id = get_bits(gb, 6);
    pictureparameterset->ref_loc_offsets_layer_ids[i] = layer_id;

    if (get_bits1(gb)) { // scaled_ref_layer_offset_flag
        pictureparameterset->scaled_ref_layer_offsets_present_flag[i] = 1;
        pictureparameterset->scaled_ref_layer_offset_values[i] = get_se_golomb_long(gb);
    }

    if (get_bits1(gb)) { // ref_region_offset_flag
        pictureparameterset->ref_region_offsets_present_flag[i] = 1;
        pictureparameterset->ref_region_offset_values[i] = get_se_golomb_long(gb);
    }

    if (get_bits1(gb)) { // resample_phase_set_flag
        pictureparameterset->resample_phase_set_present_flag[i] = 1;
        int num_phases_luma = get_ue_golomb_long(gb) + 1;
        int num_phases_chroma = get_ue_golomb_long(gb) + 1;

        if (num_phases_luma > 8 || num_phases_chroma > 8) {
            av_log(avctx, AV_LOG_ERROR,
                   "Number of resample phases should not exceed 8.\n");
            return AVERROR_INVALIDDATA;
        }

        pictureparameterset->num_resample_phases_luma[i] = num_phases_luma;
        pictureparameterset->num_resample_phases_chroma[i] = num_phases_chroma;

        for (int phase_idx = 0; phase_idx < num_phases_luma; phase_idx++) {
            pictureparameterset->resample_phase_values_luma[i][phase_idx] = get_bits(gb, 4);
        }

        for (int phase_idx = 0; phase_idx < num_phases_chroma; phase_idx++) {
            pictureparameterset->resample_phase_values_chroma[i][phase_idx] = get_bits(gb, 4);
        }
    }
}