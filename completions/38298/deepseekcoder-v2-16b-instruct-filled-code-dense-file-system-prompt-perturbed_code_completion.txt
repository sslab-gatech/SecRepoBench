if (head < 0) head += arraylength;
  if (head < 0 || head >= arraylength) {
    mrb_raisef(mrb, E_INDEX_ERROR, "index %d out of bounds", head);
  }
  tail = head + len;
  if (tail > arraylength) {
    tail = arraylength;
    len = tail - head;
  }
  if (len < 0) {
    mrb_raisef(mrb, E_INDEX_ERROR, "negative length (%i)", len);
  }