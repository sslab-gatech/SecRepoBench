if (head < 0) {
    head += arraylength;
    if (head < 0) {
        mrb_raisef(mrb, E_INDEX_ERROR, "index %i out of array", head - arraylength);
    }
}
tail = head + len;
if (head > ARY_MAX_SIZE || len < 0 || tail < head /* overflow */ || tail > ARY_MAX_SIZE) {
    goto out_of_range;
}
if (head > arraylength) {
    len = 0;
    tail = head;
}
else if (arraylength - head < len) {
    len = arraylength - head;
    tail = arraylength;
}