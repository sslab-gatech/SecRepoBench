if (head < 0) {
    head += arraylength;
}
if (head < 0) {
    mrb_raisef(mrb, E_INDEX_ERROR, "index %i out of array", head);
}
tail = head + len;
if (head > ARY_MAX_SIZE || tail > ARY_MAX_SIZE) {
    goto out_of_range;
}
if (head < arraylength) {
    if (len > arraylength - head) {
        len = arraylength - head;
    }
}