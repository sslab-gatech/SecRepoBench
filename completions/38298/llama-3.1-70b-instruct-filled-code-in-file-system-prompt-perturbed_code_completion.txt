if (head < 0) {
  head += arraylength;
  if (head < 0) {
    mrb_raisef(mrb, E_INDEX_ERROR, "index %i out of array", head - arraylength);
  }
}
tail = head + len;
if (tail > ARY_MAX_SIZE - argc) {
  goto out_of_range;
}
if (tail > arraylength) {
  len = tail - arraylength;
  if (len > 0) {
    ary_fill_with_nil(ARY_PTR(a) + arraylength, len);
  }
  ARY_SET_LEN(a, tail);
}
if (argc > 0) {
  array_copy(ARY_PTR(a) + head, argv, argc);
}
mrb_write_barrier(mrb, (struct RBasic*)a);
return ary;