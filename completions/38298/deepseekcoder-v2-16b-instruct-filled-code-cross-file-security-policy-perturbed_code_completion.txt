// Adjust the `head` index for negative values by adding the array length.
  // If the adjusted `head` is still negative, raise an index error as it's out of bounds.
  // Calculate the `tail` index.
  // If the `head` index or calculated `tail` would result in exceeding the maximum array size, raise an index error.
  // If the current array length is less than `len` or `tail`, adjust `len` to fit within the array bounds.
  if (head < 0) head += arraylength;
  if (head < 0 || head >= arraylength) {
    mrb_raisef(mrb, E_INDEX_ERROR, "index %i out of array", head);
  }
  tail = head + len;
  if (tail < 0 || tail > arraylength) {
    if (tail > ARY_MAX_SIZE) {
      mrb_raisef(mrb, E_INDEX_ERROR, "index %i out of array", tail);
    }
    len = arraylength - head;
  }