if (head < 0) {
    head += arraylength;
    if (head < 0) {
      mrb_raisef(mrb, E_INDEX_ERROR, "index %i out of array", head - arraylength);
    }
  }
  tail = head + len;
  if (tail < 0) {
    mrb_raisef(mrb, E_INDEX_ERROR, "index %i out of array", tail - arraylength);
  }
  if (tail > ARY_MAX_SIZE) {
    mrb_raisef(mrb, E_INDEX_ERROR, "index %i out of array bounds", tail);
  }
  if (len > arraylength) {
    len = arraylength;
  }