if (head < 0) {
  head = arraylength + head;
  if (head < 0) {
    mrb_raisef(mrb, E_INDEX_ERROR, "index %i out of array", head - arraylength);
  }
}
if (head > ARY_MAX_SIZE || len > ARY_MAX_SIZE - head) {
out_of_range:
  mrb_raisef(mrb, E_INDEX_ERROR, "index %i out of array", head);
}
tail = head + len;
if (arraylength < len || arraylength < tail) {
  len = arraylength - head;
  if (len < 0) len = 0;
}