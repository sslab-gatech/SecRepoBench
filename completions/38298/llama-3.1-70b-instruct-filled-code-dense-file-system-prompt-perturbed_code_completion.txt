if (head < 0) head += arraylength;
if (head < 0) mrb_raisef(mrb, E_INDEX_ERROR, "index %d out of range", head);
tail = head + len;
if (tail > arraylength) {
  if (tail > ARY_MAX_SIZE) mrb_raise(mrb, E_INDEX_ERROR, "index out of range");
  len = tail - head;
}
if (len > arraylength) len = arraylength;