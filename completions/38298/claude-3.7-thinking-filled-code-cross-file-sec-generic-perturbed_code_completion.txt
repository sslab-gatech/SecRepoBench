if (head < 0) {
  head += arraylength;
  if (head < 0) {
    mrb_raisef(mrb, E_INDEX_ERROR, "index %i out of array", head - arraylength);
  }
}

/* Check if head + len would overflow */
if (len > 0 && head > ARY_MAX_SIZE - len) {
  goto out_of_range;
}

tail = head + len;