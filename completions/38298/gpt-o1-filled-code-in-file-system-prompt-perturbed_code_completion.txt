if (head < 0) {
  head += arraylength;
  if (head < 0) {
    mrb_raisef(mrb, E_INDEX_ERROR, "index %i out of array", head - arraylength);
  }
}
tail = head + len;
if (tail < head) {
  mrb_raise(mrb, E_INDEX_ERROR, "index out of range");
}
if (head > ARY_MAX_SIZE || tail > ARY_MAX_SIZE) {
  mrb_raise(mrb, E_ARGUMENT_ERROR, "array size too big");
}
if (tail > arraylength) {
  len = arraylength - head;
  tail = arraylength;
}