head = (head < 0) ? arraylength + head : head;
  if (head < 0) {
    mrb_raisef(mrb, E_INDEX_ERROR, "index %i out of array", head);
  }
  tail = head + len;
  if (tail > arraylength) {
    tail = arraylength;
  }
  if (head > ARY_MAX_SIZE - argc || tail > ARY_MAX_SIZE - argc) {
    goto out_of_range;
  }
  if (arraylength < len || tail > arraylength) {
    len = arraylength - head;
  }