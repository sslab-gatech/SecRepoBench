if (head < 0) head += arraylength;
  if (head < 0 || head >= arraylength) {
    mrb_raisef(mrb, E_INDEX_ERROR, "index %d out of array", head);
  }
  tail = head + len;
  if (tail < 0 || tail > arraylength) {
    mrb_raisef(mrb, E_INDEX_ERROR, "index %d out of array", tail);
  }
  if (len > arraylength - head) {
    len = arraylength - head;
  }
  if (tail > ARY_MAX_SIZE) {
    mrb_raisef(mrb, E_INDEX_ERROR, "index %d out of array", tail);
  }