if (head < 0) {
    head += arraylength;
    if (head < 0) {
      mrb_raisef(mrb, E_INDEX_ERROR, "index out of range (%i)", head);
    }
  }
  tail = head + len;
  if (head > ARY_MAX_SIZE || tail > ARY_MAX_SIZE) {
    goto out_of_range;
  }
  if (tail > arraylength) {
    len = arraylength - head;
    if (len < 0) {
      len = 0;
    }
    tail = head + len;
  }