head = (head < 0) ? head + arraylength : head;
  if (head < 0 || head > arraylength) {
    mrb_raisef(mrb, E_INDEX_ERROR, "index %i out of array", head);
  }
  tail = head + len;
  if (tail > arraylength) {
    len = arraylength - head; // Adjust len to prevent overflow
  }
  if (len > arraylength || tail > ARY_MAX_SIZE) {
    mrb_raisef(mrb, E_INDEX_ERROR, "length %i out of array bounds", len);
  }