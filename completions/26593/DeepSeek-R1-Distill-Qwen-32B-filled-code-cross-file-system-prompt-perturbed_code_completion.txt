int val = 0;
const char *ptr = timestr;

while (*ptr && isdigit(*ptr)) {
    val = val * 10 + (*ptr - '0');
    ptr++;
}

if (*ptr) {
    switch(toupper(*ptr)) {
        case 'D':
            val *= 86400;
            break;
        case 'H':
            val *= 3600;
            break;
        case 'M':
            val *= 60;
            break;
    }
}

return val;