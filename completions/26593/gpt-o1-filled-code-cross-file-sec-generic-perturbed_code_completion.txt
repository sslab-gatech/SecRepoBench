int val = 0;
    int base_val;
    size_t len;
    char unit;

    if (!timestr) {
        val = 0;
        goto done;
    }

    len = strlen(timestr);
    if (len == 0) {
        val = 0;
        goto done;
    }

    unit = timestr[len - 1];
    if (unit == 'd' || unit == 'D' ||
        unit == 'h' || unit == 'H' ||
        unit == 'm' || unit == 'M') {

        /* parse numeric portion excluding the last character */
        char tmp[256];
        if (len - 1 >= sizeof(tmp)) {
            val = 0;
            goto done;
        }

        memcpy(tmp, timestr, len - 1);
        tmp[len - 1] = '\0';
        base_val = atoi(tmp);

        switch (unit) {
        case 'd':
        case 'D':
            if (base_val > INT_MAX / 86400) {
                val = INT_MAX;
            }
            else {
                val = base_val * 86400;
            }
            break;
        case 'h':
        case 'H':
            if (base_val > INT_MAX / 3600) {
                val = INT_MAX;
            }
            else {
                val = base_val * 3600;
            }
            break;
        case 'm':
        case 'M':
            if (base_val > INT_MAX / 60) {
                val = INT_MAX;
            }
            else {
                val = base_val * 60;
            }
            break;
        }
    }
    else {
        base_val = atoi(timestr);
        val = base_val;
    }

done:;