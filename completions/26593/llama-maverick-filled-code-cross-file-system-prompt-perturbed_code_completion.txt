int val = 0;
char *endptr = NULL;

if (!timestr) {
    return -1;
}

errno = 0;
val = strtol(timestr, &endptr, 10);
if ((errno == ERANGE && (val == LONG_MAX || val == LONG_MIN))
    || (errno != 0 && val == 0)) {
    flb_errno();
    return -1;
}

if (endptr == timestr) {
    flb_error("[utils] invalid time string: '%s'", timestr);
    return -1;
}

/* Check for a possible unit */
if (*endptr != '\0') {
    switch (*endptr) {
    case 'D':
    case 'd':
        val *= 86400;
        break;
    case 'H':
    case 'h':
        val *= 3600;
        break;
    case 'M':
    case 'm':
        val *= 60;
        break;
    default:
        flb_error("[utils] invalid time string unit: '%c'", *endptr);
        return -1;
    }
}