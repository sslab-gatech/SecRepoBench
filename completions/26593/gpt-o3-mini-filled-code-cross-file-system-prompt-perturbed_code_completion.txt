int multiplier = 1;
size_t len = strlen(timestr);
char num_str[64];

if (len > 0) {
    char unit = timestr[len - 1];
    if ((unit == 'D' || unit == 'd' || unit == 'H' || unit == 'h' || unit == 'M' || unit == 'm') && len > 1) {
        /* Copy all but the last character */
        memcpy(num_str, timestr, len - 1);
        num_str[len - 1] = '\0';
        if (unit == 'D' || unit == 'd') {
            multiplier = 86400;
        }
        else if (unit == 'H' || unit == 'h') {
            multiplier = 3600;
        }
        else if (unit == 'M' || unit == 'm') {
            multiplier = 60;
        }
    }
    else {
        strncpy(num_str, timestr, sizeof(num_str) - 1);
        num_str[sizeof(num_str) - 1] = '\0';
    }
    val = atoi(num_str) * multiplier;
}
else {
    val = 0;
}