int len = strlen(timestr);
int val = 0;
char unit = '\0';
char numstr[32];

if (len == 0) {
    return 0;
}

/* Check if the last character is a unit */
if (isalpha(timestr[len - 1])) {
    unit = timestr[len - 1];
    if (len - 1 >= (int)sizeof(numstr)) {
        /* Too long */
        return 0;
    }
    strncpy(numstr, timestr, len - 1);
    numstr[len - 1] = '\0';
}
else {
    if (len >= (int)sizeof(numstr)) {
        /* Too long */
        return 0;
    }
    strncpy(numstr, timestr, len);
    numstr[len] = '\0';
}

val = atoi(numstr);

if (unit == 'D' || unit == 'd') {
    val *= 86400;
}
else if (unit == 'H' || unit == 'h') {
    val *= 3600;
}
else if (unit == 'M' || unit == 'm') {
    val *= 60;
}