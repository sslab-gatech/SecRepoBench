if (dict->subdict != NULL) {
    const xmlChar *subdictEntry;

    if (pref == NULL) {
        subdictEntry = xmlDictLookup(dict->subdict, name, len);
    } else {
        size_t totalLen = plen + 1 + len;
        if (totalLen > INT_MAX)
            return(NULL);

        xmlChar *qname = xmlMalloc((totalLen + 1) * sizeof(xmlChar));
        if (qname == NULL)
            return(NULL);

        memcpy(qname, pref, plen * sizeof(xmlChar));
        qname[plen] = ':';
        memcpy(&qname[plen + 1], name, len * sizeof(xmlChar));
        qname[plen + 1 + len] = '\0';

        subdictEntry = xmlDictLookup(dict->subdict, qname, totalLen);
        xmlFree(qname);
    }

    if (subdictEntry != NULL)
        return (const xmlDictEntry *) subdictEntry;
}