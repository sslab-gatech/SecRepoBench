// Extract macros from the MVG string. The code iterates through the string 
// to find 'push' and 'pop' commands, handling nested structures accordingly.
// It skips comments starting with '#'. When a complete macro is identified, 
// it extracts the macro definition and adds it to a splay tree 
// for later retrieval using the macro name as the key.
while ((*q != '\0') && (*q != '"'))
{
    if (*q == '#')
    {
        // Skip comment
        while ((*q != '\n') && (*q != '\0'))
            q++;
        continue;
    }
    if (LocaleCompare("push", token) == 0)
    {
        GetNextToken(q, &q, length, token);
        if (*q == '"')
        {
            char name[MagickPathExtent];
            const char *p, *start;
            ssize_t n;

            // Named macro (e.g. push graphic-context "wheel")
            GetNextToken(q, &q, length, token);
            start = q;
            while ((*q != '"') && (*q != '\0'))
                q++;
            if (*q == '"')
            {
                n = q - start;
                if (n < (ssize_t) sizeof(name))
                {
                    (void) CopyMagickString(name, start, (size_t) n + 1);
                    p = name;
                    while ((*p != '\0') && (*p != ' '))
                        p++;
                    *p = '\0';
                    AddValueToSplayTree(macros, ConstantString(name), NULL);
                }
            }
        }
    }
    else if (LocaleCompare("pop", token) == 0)
    {
        GetNextToken(q, &q, length, token);
        // Handle nested push/pop
    }
    GetNextToken(q, &q, length, token);
}