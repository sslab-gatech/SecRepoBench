// Extract macros from the MVG string. The code iterates through the string 
// to find 'push' and 'pop' commands, handling nested structures accordingly.
// It skips comments starting with '#'. When a complete macro is identified, 
// it extracts the macro definition and adds it to a splay tree 
// for later retrieval using the macro name as the key.
GetNextToken(q,&q,length,token);
if (*token == '"')
{
  char
    name[MagickPathExtent];

  const char
    *p;

  ssize_t
   n;

  /*
    Named macro (e.g. push graphic-context "wheel").
  */
  GetNextToken(q,&q,length,token);
  start=q;
  n=0;
  for (p=start; *p != '"'; p++)
  {
    if (*p == '\\')
    {
      p++;
      if (*p == '\0')
        break;
    }
  }
  if (*p == '"')
  {
    p++;
    n = p - start;
    if (n >= MagickPathExtent)
      n = MagickPathExtent - 1;
    (void) CopyMagickString(name, start, n);
    name[n] = '\0';
    AddSplayTreeString(macros, name, NewSplayTreeInfo(name, start, n));
  }
}