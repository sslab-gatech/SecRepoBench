GetNextToken(q,&q,length,token);
            end=q;
            n=1;
            while ((n != 0) && (*end != '\0'))
            {
              GetNextToken(end,&end,length,token);
              if (LocaleCompare("push",token) == 0)
                n++;
              if (LocaleCompare("pop",token) == 0)
                n--;
            }
            if (n != 0)
              {
                macros=DestroySplayTree(macros);
                token=DestroyString(token);
                return((SplayTreeInfo *) NULL);
              }
            length=(size_t) (end-start);
            p=(const char *) AcquireQuantumMemory(length+MagickPathExtent,
              sizeof(*p));
            if (p == (const char *) NULL)
              {
                macros=DestroySplayTree(macros);
                token=DestroyString(token);
                return((SplayTreeInfo *) NULL);
              }
            (void) CopyMagickString(name,token,MagickPathExtent);
            (void) CopyMagickString((char *) p,start,length+1);
            (void) AddValueToSplayTree(macros,ConstantString(name),
              (void *) p);
            q=end;