// Extract macros from the MVG string. The code iterates through the string
// to find 'push' and 'pop' commands, handling nested structures accordingly.
// It skips comments starting with '#'. When a complete macro is identified,
// it extracts the macro definition and adds it to a splay tree
// for later retrieval using the macro name as the key.
// <MASK>
for ( ; ; )
{
  if (IsPoint(q) == MagickFalse)
    break;
  GetNextToken(q,&q,length,token);
  if (*token == '\0')
    break;
  if (*token == '#')
    {
      // Skip comment.
      while ((*q != '\n') && (*q != '\0'))
        q++;
      continue;
    }
  if (LocaleCompare("push",token) == 0)
    {
      register const char
        *end,
        *start;

      GetNextToken(q,&q,length,token);
      if (*q == '"')
        {
          char
            name[MagickPathExtent];

          const char
            *p;

          ssize_t
           n;

          // Named macro (e.g. push graphic-context "wheel").
          GetNextToken(q,&q,length,token);
          start=q;
          // Extract macros from the MVG string. The code iterates through the string
          // to find 'push' and 'pop' commands, handling nested structures accordingly.
          // It skips comments starting with '#'. When a complete macro is identified,
          // it extracts the macro definition and adds it to a splay tree
          // for later retrieval using the macro name as the key.
          // <MASK>
          while ((*q != '\0') && (IsPoint(q) == MagickFalse))
            q++;
          if (*q == '"')
            {
              GetNextToken(q,&q,length,token);
              end=q;
              while ((*q != '\0') && (IsPoint(q) == MagickFalse))
                q++;
              if (*q == '"')
                {
                  n=end-q;
                  if (n >= MagickPathExtent)
                    n=MagickPathExtent-1;
                  (void) CopyMagickString(name,end,n);
                  name[n]='\0';
                  // Add the extracted macro to the splay tree.
                  // <MASK>
                  // Add the extracted macro to the splay tree.
                  // <MASK>
                }
            }
        }
    }
}