end=q;
            while ((*q != '\0') && (LocaleNCompare("pop graphic-context",q,19) != 0))
            {
              if (LocaleNCompare("push graphic-context",q,20) == 0)
              {
                /*
                  Found nested push, skip until matching pop.
                */
                int
                  nesting=1;

                q+=20;
                while ((*q != '\0') && (nesting > 0))
                {
                  if (LocaleNCompare("push graphic-context",q,20) == 0)
                  {
                    nesting++;
                    q+=20;
                  }
                  else if (LocaleNCompare("pop graphic-context",q,19) == 0)
                  {
                    nesting--;
                    q+=19;
                  }
                  else
                    q++;
                }
                if (*q == '\0')
                  break;
                continue;
              }
              if (*q == '#')
              {
                /*
                  Skip comment.
                */
                while ((*q != '\n') && (*q != '\0'))
                  q++;
                if (*q == '\n')
                  q++;
                continue;
              }
              q++;
            }
            if (*q == '\0')
              break;
            (void) CopyMagickString(name,token,MagickPathExtent);
            n=q-start;
            p=AcquireString(NULL);
            if (p != (char *) NULL)
              {
                (void) CopyMagickString(p,start,MagickPathExtent);
                p[n]='\0';
                (void) AddValueToSplayTree(macros,ConstantString(name),
                  ConstantString(p));
              }
          }
        else
          q=primitive+strlen(primitive);
        continue;
      }
    if (LocaleCompare("pop",token) == 0)
      {
        GetNextToken(q,&q,length,token);
        continue;
      }