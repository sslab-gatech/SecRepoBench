end=q;
            while ((*q != '\0') && (LocaleNCompare("pop graphic-context",q,19) != 0))
            {
              if (LocaleNCompare("push graphic-context",q,20) == 0)
                {
                  ssize_t
                    count = 1;
                  q += 20;
                  while (count > 0 && *q != '\0')
                  {
                    if (LocaleNCompare("push graphic-context", q, 20) == 0)
                    {
                      count++;
                      q += 20;
                    }
                    else if (LocaleNCompare("pop graphic-context", q, 19) == 0)
                    {
                      count--;
                      q += 19;
                    }
                    else
                      q++;
                  }
                  if (*q == '\0')
                    break;
                }
              else if (*q == '#')
                {
                  while ((*q != '\n') && (*q != '\0'))
                    q++;
                  if (*q == '\n')
                    q++;
                }
              else
                q++;
            }
            if (*q != '\0')
              q += strlen("pop graphic-context");
            while ((*q != '\0') && ((*q == ' ') || (*q == '\t') || (*q == '\r') || (*q == '\n')))
              q++;
            p=start;
            n=0;
            while ((p < end) && (n < (ssize_t) (MagickPathExtent-1)))
            {
              name[n++] = *p++;
            }
            name[n]='\0';
            if (macros != (SplayTreeInfo *) NULL)
              (void) AddValueToSplayTree(macros,ConstantString(token),
                ConstantString(name));
          }
        else
          q++;