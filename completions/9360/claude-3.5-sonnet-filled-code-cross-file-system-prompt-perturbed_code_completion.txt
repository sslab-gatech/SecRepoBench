end=q;
for (n=1; n > 0; )
{
  GetNextToken(end,&end,extent,token);
  if (*token == '\0')
    break;
  if (LocaleCompare(token,"push") == 0)
    n++;
  else if (LocaleCompare(token,"pop") == 0)
    n--;
}
if (n != 0)
  {
    (void) ThrowMagickException(exception,GetMagickModule(),
      DrawError,"UnbalancedPushPop","`%s'",token);
    break;
  }
for (p=token; *p != '\0'; p++)
  if (isalpha((int) *p))
    break;
(void) CopyMagickString(name,p,MagickPathExtent);
LocaleLower(name);
(void) FormatLocaleString(message,MagickPathExtent,
  "<g id=\"%s\">\n",name);
(void) WriteBlobString(image,message);
(void) CopyMagickString(token,start,(size_t) (end-start+1));
(void) WriteBlobString(image,token);
(void) WriteBlobString(image,"\n</g>\n");