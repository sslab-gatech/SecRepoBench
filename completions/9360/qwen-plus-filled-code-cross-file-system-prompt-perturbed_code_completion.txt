end=start;
while ((*end != '"') && (*end != '\0'))
  end++;
*end='\0';
(void) FormatLocaleString(name,MagickPathExtent,"%s",start);
SplayTreeNodeInfo
  *node;

node=NewSplayTreeNode(macros,name,(void *) NULL);
if (node == (SplayTreeNodeInfo *) NULL)
  return((SplayTreeInfo *) NULL);
GetNextToken(q,&q,extent,token);
// Now handle the macro body until 'pop' is encountered
char macroBody[MagickPathExtent];
char *bodyPtr = macroBody;
size_t bodyLength = 0;

while ((*q != '\0') && LocaleCompare("pop", token) != 0) {
  size_t tokenLen = strlen(token);
  if (bodyLength + tokenLen >= MagickPathExtent - 1) {
    break; // Prevent buffer overflow
  }
  strncpy(bodyPtr, token, tokenLen);
  bodyPtr += tokenLen;
  *bodyPtr++ = ' ';
  bodyLength += tokenLen + 1;
  GetNextToken(q,&q,extent,token);
}

*bodyPtr = '\0'; // Null terminate the macro body

node->value=(void *) AcquireString(macroBody);