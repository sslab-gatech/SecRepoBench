GetNextToken(q,&q,length,token);
            if (*token != '\0')
              (void) CopyMagickString(name,token,MagickPathExtent);
            n=1;
            for (p=q; *p != '\0'; )
            {
              GetNextToken(p,&p,length,token);
              if (LocaleCompare(token,"push") == 0)
                n++;
              if (LocaleCompare(token,"pop") == 0)
                n--;
              if (n == 0)
                break;
            }
            end=p;
            if (end > start)
            {
              char
                *macro;

              size_t
                extent;

              extent=(size_t) (end-start);
              macro=(char *) AcquireQuantumMemory(extent+MagickPathExtent,
                sizeof(*macro));
              if (macro == (char *) NULL)
                ThrowFatalException(ResourceLimitFatalError,
                  "MemoryAllocationFailed");
              (void) CopyMagickString(macro,"push ",MagickPathExtent);
              (void) ConcatenateMagickString(macro,name,MagickPathExtent);
              (void) ConcatenateMagickString(macro," ",MagickPathExtent);
              (void) strncat(macro,start,extent);
              (void) AddValueToSplayTree(macros,ConstantString(name),macro);
            }
          }