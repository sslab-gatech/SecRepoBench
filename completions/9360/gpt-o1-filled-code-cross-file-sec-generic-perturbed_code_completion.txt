CopyMagickString(name,token,MagickPathExtent);
n=1;
while ((n > 0) && (*q != '\0'))
{
  p=q;
  GetNextToken(q,&q,length,token);
  if (LocaleCompare("push",token) == 0)
    n++;
  else if (LocaleCompare("pop",token) == 0)
    n--;
}
if (n == 0)
{
  end=p;
  if (end > start)
  {
    size_t macro_length=(size_t) (end-start);
    char *macro_string=(char *) AcquireQuantumMemory(macro_length+1,sizeof(*macro_string));
    if (macro_string != (char *) NULL)
    {
      (void) memcpy(macro_string,start,macro_length);
      macro_string[macro_length]='\0';
      (void) AddValueToSplayTree(macros,ConstantString(name),macro_string);
    }
  }
}