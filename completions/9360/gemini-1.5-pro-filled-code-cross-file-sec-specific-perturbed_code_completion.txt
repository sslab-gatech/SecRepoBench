end=q;
while ((*end != '\"') && (*end != '\0'))
  end++;
if (*end == '\0')
  {
    token=DestroyString(token);
    return(DestroySplayTree(macros));
  }
(void) CopyMagickString(name,q,end-q+1);
(void) AddValueToSplayTree(macros,ConstantString(name),
  ConstantString(q));
q=end+1;
while (isspace((int) ((unsigned char) *q)) != 0)
  q++;
if (*q == '{')
  {
    char
      *macro;

    /*
      Multi-line macro (e.g. "push graphic-context { ... }").
    */
    GetNextToken(q,&q,length,token);
    start=q;
    end=q;
    while (*end != '}')
    {
      if (*end == '\0')
        {
          token=DestroyString(token);
          return(DestroySplayTree(macros));
        }
      end++;
    }
    macro=AcquireString(q);
    (void) CopyMagickString(macro,q,end-q+1);
    (void) AddValueToSplayTree(macros,ConstantString(name),
      ConstantString(macro));
    macro=DestroyString(macro);
    q=end+1;
  }