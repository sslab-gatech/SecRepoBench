n=0;
            p=q;
            for (end=q; *end != '\0'; end++)
            {
              if (*end == '\\')
                {
                  end++;
                  continue;
                }
              if (*end == '"')
                break;
            }
            if ((end == q) || (*end != '"'))
              {
                (void) ThrowMagickException(exception,GetMagickModule(),
                  DrawError,"UnbalancedGraphicContextPushPop","`%s'",token);
                status=MagickFalse;
                break;
              }
            *end='\0';
            (void) CopyMagickString(name,q,MagickPathExtent);
            for (q=end+1; *q != '\0'; )
            {
              GetNextToken(q,&q,length,token);
              if (*token == '\0')
                break;
              if (*token != '{')
                continue;
              n++;
              for (p=q; *q != '\0'; )
              {
                GetNextToken(q,&q,length,token);
                if (*token == '\\')
                  {
                    GetNextToken(q,&q,length,token);
                    continue;
                  }
                if (*token == '#')
                  {
                    /*
                      Skip comment.
                    */
                    while ((*q != '\n') && (*q != '\0'))
                      q++;
                    continue;
                  }
                if (*token == '{')
                  n++;
                if (*token == '}')
                  {
                    n--;
                    if (n == 0)
                      break;
                  }
              }
              if (*q == '}')
                q++;
              (void) FormatLocaleString(token,MagickPathExtent,"#%s",name);
              (void) AddValueToSplayTree(macros,token,
                AcquireString(p,(size_t) (q-p-1)));
              break;
            }
            break;