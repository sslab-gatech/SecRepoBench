end=q;
            n=1;
            while ((n != 0) && (*end != '\0'))
            {
              GetNextToken(end,&end,length,token);
              if (LocaleCompare("push",token) == 0)
                n++;
              else if (LocaleCompare("pop",token) == 0)
                n--;
            }
            if (n != 0)
              continue; /* Unbalanced push/pop, skip this macro */
            p=name;
            while ((*q != '"') && (*q != '\0'))
            {
              if ((p-name) >= (ssize_t) (MagickPathExtent-1))
                break;
              *p++=(*q++);
            }
            *p='\0';
            if (*q == '"')
              q++;
            length=(size_t) (end-start);
            p=(char *) AcquireQuantumMemory(length+MagickPathExtent,
              sizeof(*p));
            if (p == (char *) NULL)
              continue;
            (void) CopyMagickString(p,name,MagickPathExtent);
            (void) ConcatenateMagickString(p,"=",MagickPathExtent);
            (void) ConcatenateMagickString(p,start,length+MagickPathExtent-
              strlen(p));
            (void) AddValueToSplayTree(macros,ConstantString(name),p);
            q=end;