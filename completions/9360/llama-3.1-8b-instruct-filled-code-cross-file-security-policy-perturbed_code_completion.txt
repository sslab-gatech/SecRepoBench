if (LocaleCompare("push",token) == 0)
  {
    register const char
      *end,
      *start;

    GetNextToken(q,&q,length,token);
    if (*q == '"')
      {
        char
          name[MagickPathExtent];

        const char
          *p;

        ssize_t
         n;

        /*
          Named macro (e.g. push graphic-context "wheel").
        */
        GetNextToken(q,&q,length,token);
        start=q;
        // Extract macros from the MVG string. The code iterates through the string 
        // to find 'push' and 'pop' commands, handling nested structures accordingly.
        // It skips comments starting with '#'. When a complete macro is identified, 
        // it extracts the macro definition and adds it to a splay tree 
        // for later retrieval using the macro name as the key.
        // <MASK>
        {
          SplayTreeInfo
            *macros;

          macros=NewSplayTree(CompareSplayTreeString,RelinquishMagickMemory,
            RelinquishMagickMemory);
          token=AcquireString(primitive);
          length=strlen(token)+MagickPathExtent;
          for (p=start; *p!= '\0'; )
          {
            GetNextToken(p,&p,length,token);
            if (*token == '\0')
              break;
            if (*token == '#')
              {
                /*
                  Skip comment.
                */
                while ((*p!= '\n') && (*p!= '\0'))
                  p++;
                continue;
              }
            if (LocaleCompare("pop",token) == 0)
              {
                break;
              }
            if (LocaleCompare("push",token) == 0)
              {
                continue;
              }
            if (LocaleCompare("graphic-context",token) == 0)
              {
                GetNextToken(p,&p,length,token);
                if (*token == '"')
                  {
                    char
                      name[MagickPathExtent];

                    const char
                      *q;

                    ssize_t
                     n;

                    /*
                      Named macro (e.g. push graphic-context "wheel").
                    */
                    GetNextToken(p,&p,length,token);
                    start=p;
                    // Extract macros from the MVG string. The code iterates through the string 
                    // to find 'push' and 'pop' commands, handling nested structures accordingly.
                    // It skips comments starting with '#'. When a complete macro is identified, 
                    // it extracts the macro definition and adds it to a splay tree 
                    // for later retrieval using the macro name as the key.
                    // <MASK>
                    {
                      SplayTreeInfo
                        *macros;

                      macros=NewSplayTree(CompareSplayTreeString,RelinquishMagickMemory,
                        RelinquishMagickMemory);
                      token=AcquireString(primitive);
                      length=strlen(token)+MagickPathExtent;
                      for (q=start; *q!= '\0'; )
                      {
                        GetNextToken(q,&q,length,token);
                        if (*token == '\0')
                          break;
                        if (*token == '#')
                          {
                            /*
                              Skip comment.
                            */
                            while ((*q!= '\n') && (*q!= '\0'))
                              q++;
                            continue;
                          }
                        if (LocaleCompare("pop",token) == 0)
                          {
                            break;
                          }
                        if (LocaleCompare("push",token) == 0)
                          {
                            continue;
                          }
                        if (LocaleCompare("graphic-context",token) == 0)
                          {
                            GetNextToken(q,&q,length,token);
                            if (*token == '"')
                              {
                                char
                                  name[MagickPathExtent];

                                const char
                                  *p;

                                ssize_t
                                 n;

                                /*
                                  Named macro (e.g. push graphic-context "wheel").
                                */
                                GetNextToken(q,&q,length,token);
                                start=q;
                                // Extract macros from the MVG string. The code iterates through the string 
                                // to find 'push' and 'pop' commands, handling nested structures accordingly.
                                // It skips comments starting with '#'. When a complete macro is identified, 
                                // it extracts the macro definition and adds it to a splay tree 
                                // for later retrieval using the macro name as the key.
                                // <MASK>
                                {
                                  SplayTreeInfo
                                    *macros;

                                  macros=NewSplayTree(CompareSplayTreeString,RelinquishMagickMemory,
                                    RelinquishMagickMemory);
                                  token=AcquireString(primitive);
                                  length=strlen(token)+MagickPathExtent;
                                  for (p=start; *p!= '\0'; )
                                  {
                                    GetNextToken(p,&p,length,token);
                                    if (*token == '\0')
                                      break;
                                    if (*token == '#')
                                      {
                                        /*
                                          Skip comment.
                                        */
                                        while ((*p!= '\n') && (*p!= '\0'))
                                          p++;
                                        continue;
                                      }
                                    if (LocaleCompare("pop",token) == 0)
                                      {
                                        break;
                                      }
                                    if (LocaleCompare("push",token) == 0)
                                      {
                                        continue;
                                      }
                                    if (LocaleCompare("graphic-context",token) == 0)
                                      {
                                        GetNextToken(p,&p,length,token);
                                        if (*token == '"')
                                          {
                                            char
                                              name[MagickPathExtent];

                                            const char
                                              *q;

                                            ssize_t
                                             n;

                                            /*
                                              Named macro (e.g. push graphic-context "wheel").
                                            */
                                            GetNextToken(p,&p,length,token);
                                            start=p;
                                            // Extract macros from the MVG string. The code iterates through the string 
                                            // to find 'push' and 'pop' commands, handling nested structures accordingly.
                                            // It skips comments starting with '#'. When a complete macro is identified, 
                                            // it extracts the macro definition and adds it to a splay tree 
                                            // for later retrieval using the macro name as the key.
                                            // <MASK>
                                            {
                                              SplayTreeInfo
                                                *macros;

                                              macros=NewSplayTree(CompareSplayTreeString,RelinquishMagickMemory,
                                                RelinquishMagickMemory);
                                              token=AcquireString(primitive);
                                              length=strlen(token)+MagickPathExtent;
                                              for (q=start; *q!= '\0'; )
                                              {
                                                GetNextToken(q,&q,length,token);
                                                if (*token == '\0')
                                                  break;
                                                if (*token == '#')
                                                  {
                                                    /*
                                                      Skip comment.
                                                    */
                                                    while ((*q!= '\n') && (*q!= '\0'))
                                                      q++;
                                                    continue;
                                                  }
                                                if (LocaleCompare("pop",token) == 0)
                                                  {
                                                    break;
                                                  }
                                                if (LocaleCompare("push",token) == 0)
                                                  {
                                                    continue;
                                                  }
                                                if (LocaleCompare("graphic-context",token) == 0)
                                                  {
                                                    GetNextToken(q,&q,length,token);
                                                    if (*token == '"')
                                                      {
                                                        char
                                                          name[MagickPathExtent];

                                                        const char
                                                          *p;

                                                        ssize_t
                                                         n;

                                                        /*
                                                          Named macro (e.g. push graphic-context "wheel").
                                                        */
                                                        GetNextToken(q,&q,length,token);
                                                        start=q;
                                                        // Extract macros from the MVG string. The code iterates through the string 
                                                        // to find 'push' and 'pop' commands, handling nested structures accordingly.
                                                        // It skips comments starting with '#'. When a complete macro is identified, 
                                                        // it extracts the macro definition and adds it to a splay tree 
                                                        // for later retrieval using the macro name as the key.
                                                        // <MASK>
                                                        {
                                                          SplayTreeInfo
                                                            *macros;

                                                          macros=NewSplayTree(CompareSplayTreeString,RelinquishMagickMemory,
                                                            RelinquishMagickMemory);
                                                          token=AcquireString(primitive);
                                                          length=strlen(token)+MagickPathExtent;
                                                          for (p=start; *p!= '\0'; )
                                                          {
                                                            GetNextToken(p,&p,length,token);
                                                            if (*token == '\0')
                                                              break;
                                                            if (*token == '#')
                                                              {
                                                                /*
                                                                  Skip comment.
                                                                */
                                                                while ((*p!= '\n') && (*p!= '\0'))
                                                                  p++;
                                                                continue;
                                                              }
                                                            if (LocaleCompare("pop",token) == 0)
                                                              {
                                                                break;
                                                              }
                                                            if (LocaleCompare("push",token) == 0)
                                                              {
                                                                continue;
                                                              }
                                                            if (LocaleCompare("graphic-context",token) == 0)
                                                              {
                                                                GetNextToken(p,&p,length,token);
                                                                if (*token == '"')
                                                                  {
                                                                    char
                                                                      name[MagickPathExtent];

                                                                    const char
                                                                      *q;

                                                                    ssize_t
                                                                     n;

                                                                    /*
                                                                      Named macro (e.g. push graphic-context "wheel").
                                                                    */
                                                                    GetNextToken(p,&p,length,token);
                                                                    start=p;
                                                                    // Extract macros from the MVG string. The code iterates through the string 
                                                                    // to find 'push' and 'pop' commands, handling nested structures accordingly.
                                                                    // It skips comments starting with '#'. When a complete macro is identified, 
                                                                    // it extracts the macro definition and adds it to a splay tree 
                                                                    // for later retrieval using the macro name as the key.
                                                                    // <MASK>
                                                                    {
                                                                      SplayTreeInfo
                                                                        *macros;

                                                                      macros=NewSplayTree(CompareSplayTreeString,RelinquishMagickMemory,
                                                                        RelinquishMagickMemory);
                                                                      token=AcquireString(primitive);
                                                                      length=strlen(token)+MagickPathExtent;
                                                                      for (q=start; *q!= '\0'; )
                                                                      {
                                                                        GetNextToken(q,&q,length,token);
                                                                        if (*token == '\0')
                                                                          break;
                                                                        if (*token == '#')
                                                                          {
                                                                            /*
                                                                            Skip comment.
                                                                          */
                                                                            while ((*q!= '\n') && (*q!= '\0'))
                                                                            q++;
                                                                            continue;
                                                                          }
                                                                        if (LocaleCompare("pop",token) == 0)
                                                                          {
                                                                            break;
                                                                          }
                                                                        if (LocaleCompare("push",token) == 0)
                                                                          {
                                                                            continue;
                                                                          }
                                                                        if (LocaleCompare("graphic-context",token) == 0)
                                                                          {
                                                                            GetNextToken(q,&q,length,token);
                                                                            if (*token == '"')
                                                                              {
                                                                                char
                                                                                  name[MagickPathExtent];

                                                                                const char
                                                                                  *p;

                                                                                ssize_t
                                                                               n;

                                                                                /*
                                                                                 Named macro (e.g. push graphic-context "wheel").
                                                                                */
                                                                                GetNextToken(q,&q,length,token);
                                                                                start=q;
                                                                                // Extract macros from the MVG string. The code iterates through the string 
                                                                                // to find 'push' and 'pop' commands, handling nested structures accordingly.
                                                                                // It skips comments starting with '#'. When a complete macro is identified, 
                                                                                // it extracts the macro definition and adds it to a splay tree 
                                                                                // for later retrieval using the macro name as the key.
                                                                                // <MASK>
                                                                                {
                                                                                  SplayTreeInfo
                                                                                    *macros;

                                                                                  macros=NewSplayTree(CompareSplayTreeString,RelinquishMagickMemory,
                                                                                    RelinquishMagickMemory);
                                                                                  token=AcquireString(primitive);
                                                                                  length=strlen(token)+MagickPathExtent;
                                                                                  for (p=start; *p!= '\0'; )
                                                                                  {
                                                                                    GetNextToken(p,&p,length,token);
                                                                                    if (*token == '\0')
                                                                                      break;
                                                                                    if (*token == '#')
                                                                                      {
                                                                                    /*
                                                                                    Skip comment.
                                                                                    */
                                                                                    while ((*p!= '\n') && (*p!= '\0'))
                                                                                      p++;
                                                                                    continue;
                                                                                    }
                                                                                    if (LocaleCompare("pop",token) == 0)
                                                                                      {
                                                                                    break;
                                                                                    }
                                                                                    if (LocaleCompare("push",token) == 0)
                                                                                      {
                                                                                    continue;
                                                                                    }
                                                                                    if (LocaleCompare("graphic-context",token) == 0)
                                                                                      {
                                                                                    GetNextToken(p,&p,length,token);
                                                                                    if (*token == '"')
                                                                                      {
                                                                                    char
                                                                                      name[MagickPathExtent];

                                                                                    const char
                                                                                      *q;

                                                                                    ssize_t
                                                                                     n;

                                                                                    /*
                                                                                      Named macro (e.g. push graphic-context "wheel").
                                                                                    */
                                                                                    GetNextToken(p,&p,length,token);
                                                                                    start=p;
                                                                                    // Extract macros from the MVG string. The code iterates through the string 
                                                                                    // to find 'push' and 'pop' commands, handling nested structures accordingly.
                                                                                    // It skips comments starting with '#'. When a complete macro is identified, 
                                                                                    // it extracts the macro definition and adds it to a splay tree 
                                                                                    // for later retrieval using the macro name as the key.
                                                                                    // <MASK>
                                                                                    {
                                                                                      SplayTreeInfo
                                                                                        *macros;

                                                                                      macros=NewSplayTree(CompareSplayTreeString,RelinquishMagickMemory,
                                                                                        RelinquishMagickMemory);
                                                                                      token=AcquireString(primitive);
                                                                                      length=strlen(token)+MagickPathExtent;
                                                                                      for (q=start; *q!= '\0'; )
                                                                                      {
                                                                                        GetNextToken(q,&q,length,token);
                                                                                        if (*token == '\0')
                                                                                          break;
                                                                                        if (*token == '#')
                                                                                          {
                                                                                        /*
                                                                                        Skip comment.
                                                                                        */
                                                                                        while ((*q!= '\n') && (*q!= '\0'))
                                                                                          q++;
                                                                                        continue;
                                                                                        }
                                                                                        if (LocaleCompare("pop",token) == 0)
                                                                                          {
                                                                                        break;
                                                                                        }
                                                                                        if (LocaleCompare("push",token) == 0)
                                                                                          {
                                                                                        continue;
                                                                                        }
                                                                                        if (LocaleCompare("graphic-context",token) == 0)
                                                                                          {
                                                                                        GetNextToken(q,&q,length,token);
                                                                                        if (*token == '"')
                                                                                          {
                                                                                        char
                                                                                          name[MagickPathExtent];

                                                                                        const char
                                                                                          *p;

                                                                                        ssize_t
                                                                                         n;

                                                                                        /*
                                                                                          Named macro (e.g. push graphic-context "wheel").
                                                                                        */
                                                                                        GetNextToken(q,&q,length,token);
                                                                                        start=q;
                                                                                        // Extract macros from the MVG string. The code iterates through the string 
                                                                                        // to find 'push' and 'pop' commands, handling nested structures accordingly.
                                                                                        // I