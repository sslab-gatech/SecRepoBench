next_token[i] = '\0';
  {
    const char prefix[] = "url(";
    size_t prefix_len = strlen(prefix);
    if (strlen(next_token) >= prefix_len &&
        strncasecmp(next_token, prefix, prefix_len) == 0)
    {
      const char *ptr = next_token + prefix_len;
      while (isspace((unsigned char)*ptr))
        ptr++;
      if (*ptr == '#')
        ptr++;
      /* Locate the closing parenthesis if it exists */
      const char *closing = strrchr(ptr, ')');
      size_t len = (closing != NULL) ? (size_t)(closing - ptr) : strlen(ptr);
      /* Shift the URL to the beginning of the token buffer */
      memmove(next_token, ptr, len);
      next_token[len] = '\0';
    }
  }