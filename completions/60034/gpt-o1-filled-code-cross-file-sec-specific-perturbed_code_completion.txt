while (entry_result && entry_result->astr) {
    // If this homonym is forbidden for compound words, but we're not allowed
    // by the Hungarian movement rule, skip it and check the next homonym.
    if (compoundforbidflag &&
        TESTAFF(entry_result->astr, compoundforbidflag, entry_result->alen) &&
        !hu_mov_rule) {
        entry_result = entry_result->next_homonym;
        continue;
    }

    // If we've reached a valid homonym, stop checking further.
    break;
}

// If no valid homonym remains, restore original character and break out.
if (!entry_result) {
    st[i] = ch;
    break;
}