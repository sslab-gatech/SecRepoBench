if (entry_result->astr && TESTAFF(entry_result->astr, compoundforbidflag, entry_result->alen)) {
          st[i] = ch; // Restore the character
          break; // Exit the loop if the entry is forbidden
        }

        // Check if the entry is valid for compound words
        if (entry_result && (entry_result->astr) && 
            (TESTAFF(entry_result->astr, needaffix, entry_result->alen) || 
             TESTAFF(entry_result->astr, ONLYUPCASEFLAG, entry_result->alen))) {
          st[i] = ch; // Restore the character
          break; // Exit the loop if the entry requires an affix
        }

        // Check for valid compound conditions
        if (entry_result && (compoundflag && TESTAFF(entry_result->astr, compoundflag, entry_result->alen))) {
          // Valid compound entry found
          break; // Exit the loop as we found a valid entry
        }

        // If we reach here, it means we need to continue searching for valid entries
        entry_result = entry_result->next_homonym; // Move to the next homonym