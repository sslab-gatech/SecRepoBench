{
  /* For Server Hello, extract the cipher suite from the payload.
   * The Server Hello structure is as follows:
   *   1 byte  - Handshake type (0x02)
   *  3 bytes  - Length
   *  2 bytes  - TLS version (already extracted into "tls_version")
   * 32 bytes  - Random
   *  1 byte  - Session ID length (session_id_len, already extracted)
   * n bytes  - Session ID (n = session_id_len)
   *  2 bytes  - Cipher suite
   *  1 byte  - Compression method
   *
   * Calculate the offset of the cipher suite:
   */
  u_int16_t cipher_offset = offset + 1 + session_id_len;
  if (cipher_offset + 1 >= total_len) {
    return 0; /* Not enough data for cipher suite extraction */
  }
  u_int16_t cipher_suite = ntohs(*((u_int16_t *)&packet->payload[cipher_offset]));

  /* Construct the JA3 string in the format "TLSVersion,CipherSuite".
   * For a simple Server Hello fingerprint, only the TLS version and server cipher suite are used.
   */
  ja3_str_len = snprintf(ja3_str, JA3_STR_LEN, "%u,%u", tls_version, cipher_suite);

  /* Compute the MD5 hash of the JA3 string */
  ndpi_MD5_Init(&ctx);
  ndpi_MD5_Update(&ctx, ja3_str, ja3_str_len);
  ndpi_MD5_Final(md5_hash, &ctx);

  /* Store the computed JA3 hash into the flow's TLS structure for later analysis.
   * It is assumed that the flow structure contains a field "l4.tcp.tls.ja3" that can hold 16 bytes.
   */
  memcpy(flow->l4.tcp.tls.ja3, md5_hash, 16);

  return 2; /* Indicate that a Server Hello was successfully processed */
}