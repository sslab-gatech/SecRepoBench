if(handshake_type == 0x02 /* Server Hello */) {
      // Parse the TLS handshake message from the packet to determine whether it is a Client Hello or Server Hello.
      // Depending on the type of handshake message, extract relevant information such as cipher suites and TLS extensions.
      // For a Server Hello, adjust offsets based on the session ID length and extract the server's cipher suite.
      // For a Client Hello, parse the cipher suites and extensions, skipping GREASE values, and extract supported versions and other extension information.
      // Construct a JA3 string based on extracted details, including TLS version, cipher suites, and extensions for fingerprinting purposes.
      // Compute an MD5 hash of the JA3 string for both Client and Server handshakes to create a unique JA3 fingerprint.
      // Store the computed JA3 hash in the flow structure for later analysis or comparison.
      // Return a specific code to indicate the type of handshake processed, or zero if parsing was unsuccessful.

      // Extract TLS version
      tls_version = ntohs(*((u_int16_t*)&packet->payload[version_offset]));
      flow->protos.stun_ssl.ssl.ssl_version = ja3.tls_handshake_version = tls_version;

      // Extract cipher suites and extensions
      u_int16_t cipher_suites_offset = version_offset + 2;
      u_int16_t extensions_offset = cipher_suites_offset + 2 + session_id_len;
      u_int16_t cipher_suites_len = ntohs(*((u_int16_t*)&packet->payload[cipher_suites_offset]));
      u_int16_t extensions_len = ntohs(*((u_int16_t*)&packet->payload[extensions_offset]));

      // Construct JA3 string
      snprintf(ja3_str, JA3_STR_LEN, "%04X%04X", tls_version, cipher_suites_len);
      for (i = cipher_suites_offset + 2; i < cipher_suites_offset + 2 + cipher_suites_len; i += 2) {
        u_int16_t cipher_suite = ntohs(*((u_int16_t*)&packet->payload[i]));
        snprintf(buffer, sizeof(buffer), "%04X", cipher_suite);
        strncat(ja3_str, buffer, JA3_STR_LEN - strlen(ja3_str) - 1);
      }

      // Compute MD5 hash of JA3 string
      memset(md5_hash, 0, sizeof(md5_hash));
      ndpi_MD5_Init(&ctx);
      ndpi_MD5_Update(&ctx, (u_char*)ja3_str, strlen(ja3_str));
      ndpi_MD5_Final(md5_hash, &ctx);

      // Store JA3 hash in flow structure
      for (i = 0; i < 16; i++) {
        snprintf(buffer, sizeof(buffer), "%02X", md5_hash[i]);
        strncat(ja3_str, buffer, JA3_STR_LEN - strlen(ja3_str) - 1);
      }

      // Store the JA3 hash in the flow structure
      flow->ja3_fingerprint = strdup(ja3_str);

      // Return a specific code to indicate the type of handshake processed
      return 1; // Server Hello processed
    } else if(handshake_type == 0x01 /* Client Hello */) {
      // Similar processing for Client Hello
      // Extract cipher suites, extensions, and other relevant information
      // Construct JA3 string and compute MD5 hash
      // Store the JA3 hash in the flow structure
      // Return a specific code to indicate the type of handshake processed
      return 2; // Client Hello processed
    }