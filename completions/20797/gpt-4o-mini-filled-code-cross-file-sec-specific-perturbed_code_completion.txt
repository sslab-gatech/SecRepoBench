if (session_id_len > 32) {
        return 0; // Invalid session ID length
    }

    offset += 1 + session_id_len; // Move past the session ID

    // Read the cipher suite
    if (offset + 2 > total_len) {
        return 0; // Invalid offset for cipher suite
    }
    u_int16_t cipher_suite = (packet->payload[offset] << 8) | packet->payload[offset + 1];
    offset += 2;

    // Read the length of the extensions
    if (offset + 2 > total_len) {
        return 0; // Invalid offset for extensions length
    }
    u_int16_t extensions_length = (packet->payload[offset] << 8) | packet->payload[offset + 1];
    offset += 2;

    // Validate the total length of the extensions
    if (offset + extensions_length > total_len) {
        return 0; // Invalid offset for extensions
    }

    // Process extensions (if any)
    while (extensions_length > 0) {
        if (offset + 4 > total_len) {
            return 0; // Invalid offset for extension type/length
        }
        u_int16_t extension_type = (packet->payload[offset] << 8) | packet->payload[offset + 1];
        u_int16_t extension_data_length = (packet->payload[offset + 2] << 8) | packet->payload[offset + 3];
        offset += 4;

        // Validate extension data length
        if (extension_data_length > extensions_length || offset + extension_data_length > total_len) {
            return 0; // Invalid extension data length
        }

        // Process the extension data here (omitted for brevity)
        offset += extension_data_length;
        extensions_length -= (extension_data_length + 4);
    }

    // Construct the JA3 string
    snprintf(ja3_str, sizeof(ja3_str), "%u,%04X", tls_version, cipher_suite);
    ja3_str_len = strlen(ja3_str);

    // Compute the MD5 hash of the JA3 string
    md5_hash[0] = 0; // Initialize MD5 hash
    ndpi_MD5_Init(&ctx);
    ndpi_MD5_Update(&ctx, (u_char *)ja3_str, ja3_str_len);
    ndpi_MD5_Final(md5_hash, &ctx);

    // Store the JA3 hash in the flow structure
    memcpy(flow->l4.tcp.tls.ja3_hash, md5_hash, sizeof(md5_hash));

    return 2; // Indicate successful processing of Server Hello