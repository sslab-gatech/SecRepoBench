if(handshake_type == 0x02 /* Server Hello */) {
  offset += 2 + session_id_len;
  extension_len = (packet->payload[offset] << 8) + packet->payload[offset+1];
  offset += 2;

  if(extension_len > 0) {
    while(extension_len > 0) {
      u_int16_t extension_type = (packet->payload[offset] << 8) + packet->payload[offset+1];
      u_int16_t extension_len_type = (packet->payload[offset+2] << 8) + packet->payload[offset+3];
      offset += 4;

      if(extension_len_type > extension_len) {
	jainvalid = 1;
	break;
      }

      extension_len -= extension_len_type + 4;

      if(extension_type == 0x0000) { /* SNI */
	u_int8_t len = packet->payload[offset+5];

	if(len > 0) {
	  u_int16_t server_len = (packet->payload[offset+6] << 8) + packet->payload[offset+7];

	  if(server_len > 0) {
	    char *server_name = (char*)&packet->payload[offset+8];

	    u_int len = (u_int)ndpi_min(server_len, sizeof(buffer)-1);
	    strncpy(buffer, server_name, len);
	    buffer[len] = '\0';

	    // check if server name string are all printable
	    u_int8_t is_printable = 1;
	    for(j = 0; j < len; j++) {
	      if(!ndpi_isprint(buffer[j])) {
		is_printable = 0;
		break;
	      }
	    }

	    if(is_printable == 1) {
	      snprintf(flow->protos.stun_ssl.ssl.server_name,
		       sizeof(flow->protos.stun_ssl.ssl.server_name), "%s", buffer);
#ifdef DEBUG_TLS
	      printf("Server name: %s\n", flow->protos.stun_ssl.ssl.server_name);
#endif
	    }
	  }
	}
      } else if(extension_type == 0x0005) { /* status_request */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x000d) { /* signature_algorithms */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0017) { /* extended_master_secret */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x002b) { /* cookie */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0033) { /* key_share */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0035) { /* supported_versions */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x003b) { /* psk_key_exchange_modes */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x003c) { /* pre_shared_key */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x003d) { /* early_data */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0042) { /* supported_groups */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0043) { /* signature_algorithms_cert */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0044) { /* key_share */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0045) { /* renegotiation_info */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0046) { /* max_fragment_length */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0047) { /* status_request_v2 */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0048) { /* extended_master_secret */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0049) { /* session_ticket */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x004a) { /* pre_shared_key */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x004b) { /* early_data */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x004c) { /* supported_versions */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x004d) { /* cookie */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x004e) { /* psk_key_exchange_modes */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x004f) { /* post_handshake_auth */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0051) { /* key_share */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0052) { /* renegotiation_info */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0053) { /* application_layer_protocol_negotiation */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0054) { /* status_request_v2 */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0055) { /* signed_certificate_timestamp */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0056) { /* client_certificate_type */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0057) { /* server_certificate_type */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0058) { /* padding */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0059) { /* encrypt_then_mac */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x005a) { /* extended_master_secret */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x005b) { /* session_ticket */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x005c) { /* renegotiation_info */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x005d) { /* key_share */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x005e) { /* pre_shared_key */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x005f) { /* early_data */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0060) { /* supported_versions */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0061) { /* cookie */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0062) { /* psk_key_exchange_modes */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0063) { /* post_handshake_auth */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0064) { /* signature_algorithms_cert */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0065) { /* key_share */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0066) { /* renegotiation_info */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0067) { /* application_layer_protocol_negotiation */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0068) { /* status_request_v2 */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0069) { /* signed_certificate_timestamp */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x006a) { /* client_certificate_type */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x006b) { /* server_certificate_type */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x006c) { /* padding */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x006d) { /* encrypt_then_mac */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x006e) { /* extended_master_secret */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x006f) { /* session_ticket */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0070) { /* renegotiation_info */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0071) { /* key_share */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0072) { /* pre_shared_key */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0073) { /* early_data */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extension_type;
      } else if(extension_type == 0x0074) { /* supported_versions */
	ja3.num_tls_extension++;
	ja3.tls_extension[ja3.num_tls_extension-1] = extensio