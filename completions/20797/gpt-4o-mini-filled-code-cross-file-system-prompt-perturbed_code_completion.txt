{
        u_int16_t cipher_suite_offset = base_offset + 1 + session_id_len;
        u_int16_t cipher_suite_length = (packet->payload[cipher_suite_offset] << 8) + packet->payload[cipher_suite_offset + 1];
        u_int16_t cipher_suite_count = cipher_suite_length / 2;

        // Extract cipher suites
        for (j = 0; j < cipher_suite_count; j++) {
            u_int16_t cipher_suite = (packet->payload[cipher_suite_offset + 2 + j * 2] << 8) + packet->payload[cipher_suite_offset + 3 + j * 2];
            // Skip GREASE values (0x00FF to 0x00FF)
            if ((cipher_suite & 0xFF00) == 0x00FF) {
                continue;
            }
            // Add cipher suite to JA3 string
            snprintf(buffer + strlen(buffer), sizeof(buffer) - strlen(buffer), "%04X:", cipher_suite);
        }

        // Remove the trailing colon
        if (strlen(buffer) > 0) {
            buffer[strlen(buffer) - 1] = '\0';
        }

        // Construct JA3 string
        snprintf(ja3_str, sizeof(ja3_str), "%u,%s", tls_version, buffer);
        ja3_str_len = strlen(ja3_str);

        // Compute MD5 hash of the JA3 string
        ndpi_MD5_Init(&ctx);
        ndpi_MD5_Update(&ctx, (u_char *)ja3_str, ja3_str_len);
        ndpi_MD5_Final(md5_hash, &ctx);

        // Store the JA3 hash in the flow structure
        memcpy(flow->l4.tcp.tls.ja3_hash, md5_hash, sizeof(md5_hash));
        flow->l4.tcp.tls.ja3_hash_set = 1;

        return 1; // Indicate successful processing of Server Hello
    }