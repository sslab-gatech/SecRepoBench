case 0x02: /* Server Hello */
    {
        u_int16_t cipher_suite_len = (packet->payload[offset+2] << 8) + packet->payload[offset+3];
        offset += 4;

        ja3.num_cipher = 0;
        for(i=0; i<cipher_suite_len; i+=2) {
            u_int16_t cipher = ntohs(*((u_int16_t*)&packet->payload[offset+i]));

            // Skip GREASE values
            if((cipher & 0x0F0F) == 0x0A0A || (cipher & 0x0F0F) == 0x1A1A || (cipher & 0x0F0F) == 0x1D1D)
                continue;

            ja3.cipher[ja3.num_cipher++] = cipher;
        }
        offset += cipher_suite_len;

        u_int8_t compression_methods_len = packet->payload[offset++];
        offset += compression_methods_len;

        extension_len = (packet->payload[offset] << 8) + packet->payload[offset+1];
        offset += 2;

        ja3.num_tls_extension = 0;
        while(extension_len >= 4) {
            u_int16_t ext_type = ntohs(*((u_int16_t*)&packet->payload[offset]));
            u_int16_t ext_len = ntohs(*((u_int16_t*)&packet->payload[offset+2]));

            // Skip GREASE values
            if((ext_type & 0x0F0F) == 0x0A0A || (ext_type & 0x0F0F) == 0x1A1A || (ext_type & 0x0F0F) == 0x1D1D) {
                offset += ext_len + 4;
                extension_len -= ext_len + 4;
                continue;
            }

            ja3.tls_extension[ja3.num_tls_extension++] = ext_type;
            offset += ext_len + 4;
            extension_len -= ext_len + 4;
        }
    }
    break;

case 0x01: /* Client Hello */
    {
        tls_version = ntohs(*((u_int16_t*)&packet->payload[version_offset]));
        ja3.tls_handshake_version = tls_version;

        u_int16_t session_id_len = packet->payload[offset++];
        offset += session_id_len;

        u_int16_t cipher_suite_len = ntohs(*((u_int16_t*)&packet->payload[offset]));
        offset += 2;

        ja3.num_cipher = 0;
        for(i=0; i<cipher_suite_len; i+=2) {
            u_int16_t cipher = ntohs(*((u_int16_t*)&packet->payload[offset+i]));

            // Skip GREASE values
            if((cipher & 0x0F0F) == 0x0A0A || (cipher & 0x0F0F) == 0x1A1A || (cipher & 0x0F0F) == 0x1D1D)
                continue;

            ja3.cipher[ja3.num_cipher++] = cipher;
        }
        offset += cipher_suite_len;

        u_int8_t compression_methods_len = packet->payload[offset++];
        offset += compression_methods_len;

        extension_len = ntohs(*((u_int16_t*)&packet->payload[offset]));
        offset += 2;

        ja3.num_tls_extension = 0;
        ja3.num_elliptic_curve = 0;
        ja3.num_elliptic_curve_point_format = 0;
        while(extension_len >= 4) {
            u_int16_t ext_type = ntohs(*((u_int16_t*)&packet->payload[offset]));
            u_int16_t ext_len = ntohs(*((u_int16_t*)&packet->payload[offset+2]));

            // Skip GREASE values
            if((ext_type & 0x0F0F) == 0x0A0A || (ext_type & 0x0F0F) == 0x1A1A || (ext_type & 0x0F0F) == 0x1D1D) {
                offset += ext_len + 4;
                extension_len -= ext_len + 4;
                continue;
            }

            switch(ext_type) {
            case 0x000a: /* supported_groups (aka elliptic_curves) */
                {
                    u_int16_t curve_len = ntohs(*((u_int16_t*)&packet->payload[offset+4]));
                    ja3.num_elliptic_curve = 0;
                    for(j=0; j<curve_len; j+=2) {
                        ja3.elliptic_curve[ja3.num_elliptic_curve++] = ntohs(*((u_int16_t*)&packet->payload[offset+6+j]));
                    }
                }
                break;
            case 0x000b: /* ec_point_formats */
                {
                    ja3.num_elliptic_curve_point_format = packet->payload[offset+5];
                    for(j=0; j<ja3.num_elliptic_curve_point_format; j++) {
                        ja3.elliptic_curve_point_format[j] = packet->payload[offset+6+j];
                    }
                }
                break;
            default:
                ja3.tls_extension[ja3.num_tls_extension++] = ext_type;
                break;
            }

            offset += ext_len + 4;
            extension_len -= ext_len + 4;
        }
    }
    break;

default:
    return(0); /* Not found */