{
  /* Validate that the payload contains at least 1 byte for session ID length */
  if(packet->payload_packet_len < base_offset + 1)
    return 0;

  session_id_len = packet->tcp ? packet->payload[base_offset] : packet->payload[base_offset];

  /* Calculate offset for cipher suite (session ID length field + session ID data) */
  u_int16_t cipher_suite_offset = base_offset + 1 + session_id_len;
  if(packet->payload_packet_len < cipher_suite_offset + 2)
    return 0;

  /* Extract the cipher suite (2 bytes) from the packet */
  u_int16_t cipher_suite = (packet->payload[cipher_suite_offset] << 8) |
                           packet->payload[cipher_suite_offset + 1];

  /* Construct the JA3 string for the Server Hello using TLS version and cipher suite.
     (For Server Hello, typically only one cipher suite is present.) */
  ja3_str_len = snprintf(ja3_str, sizeof(ja3_str), "%u,%u", tls_version, cipher_suite);
  
  /* Compute the MD5 hash of the JA3 string */
  ndpi_MD5_Init(&ctx);
  ndpi_MD5_Update(&ctx, (unsigned char *)ja3_str, ja3_str_len);
  ndpi_MD5_Final(md5_hash, &ctx);
  
  /* Store the computed JA3 hash in the flow structure.
     (Assuming that 'flow->l4.tcp.tls.ja3_hash' is a valid 16-byte array.) */
  memcpy(flow->l4.tcp.tls.ja3_hash, md5_hash, sizeof(md5_hash));
  
  return 2;
}