{
    /* Compute cipher suite offset: after session id length byte and session id */
    u_int16_t cipher_suite_offset = offset + 1 + session_id_len;
    u_int16_t cipher_suite;

    /* Ensure we have enough payload for cipher suite (2 bytes) */
    if (cipher_suite_offset + 2 > total_len)
      return 0;

    cipher_suite = ntohs(*((u_int16_t *)&packet->payload[cipher_suite_offset]));

    /* Construct the JA3 string for Server Hello.
       For Server Hello, we use the TLS version and the single cipher suite.
       The format here is: "<tls_version>,<cipher_suite>" */
    snprintf(ja3_str, sizeof(ja3_str), "%u,%u", tls_version, cipher_suite);

    /* Compute the MD5 hash of the JA3 string */
    ndpi_MD5_Init(&ctx);
    ndpi_MD5_Update(&ctx, (const unsigned char *)ja3_str, (unsigned int)strlen(ja3_str));
    ndpi_MD5_Final(md5_hash, &ctx);

    /* Store the computed JA3 fingerprint into the flow structure.
       It is assumed that flow->l4.tcp.tls.ja3_fingerprint is a 16-byte array. */
    memcpy(flow->l4.tcp.tls.ja3_fingerprint, md5_hash, sizeof(md5_hash));

    return 2;
  }