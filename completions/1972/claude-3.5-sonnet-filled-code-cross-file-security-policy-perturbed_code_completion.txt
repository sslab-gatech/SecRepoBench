switch (content->type) {
    case XML_ELEMENT_CONTENT_PCDATA:
        if (strlen(buf) + 7 <= capacity) {
            strcat(buf, "#PCDATA");
        } else {
            strcat(buf, " ...");
            return;
        }
        break;
    case XML_ELEMENT_CONTENT_ELEMENT:
        if (content->prefix != NULL) {
            int required_len = strlen(buf) + strlen((char *)content->prefix) + strlen((char *)content->name) + 2;
            if (required_len <= capacity) {
                strcat(buf, (char *)content->prefix);
                strcat(buf, ":");
                strcat(buf, (char *)content->name);
            } else {
                strcat(buf, " ...");
                return;
            }
        } else {
            int required_len = strlen(buf) + strlen((char *)content->name) + 1;
            if (required_len <= capacity) {
                strcat(buf, (char *)content->name);
            } else {
                strcat(buf, " ...");
                return;
            }
        }
        break;
    case XML_ELEMENT_CONTENT_SEQ:
    case XML_ELEMENT_CONTENT_OR:
        if (content->c1 != NULL) {
            xmlSnprintfElementContent(buf, capacity, content->c1, 1);
            if (content->c2 != NULL) {
                int required_len = strlen(buf) + 3;
                if (required_len <= capacity) {
                    strcat(buf, content->type == XML_ELEMENT_CONTENT_SEQ ? ", " : " | ");
                    xmlSnprintfElementContent(buf, capacity, content->c2, 1);
                } else {
                    strcat(buf, " ...");
                    return;
                }
            }
        }
        break;
}