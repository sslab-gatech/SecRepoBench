switch (content->type) {
    case XML_ELEMENT_CONTENT_PCDATA: {
        int len = strlen(buf);
        int remaining = capacity - len;
        if (remaining <= 0) return;
        snprintf(buf + len, remaining, "#PCDATA");
        break;
    }
    case XML_ELEMENT_CONTENT_ELEMENT: {
        int len = strlen(buf);
        int remaining = capacity - len;
        if (remaining <= 0) return;
        if (content->prefix) {
            snprintf(buf + len, remaining, "%s:%s", content->prefix, content->name);
        } else {
            snprintf(buf + len, remaining, "%s", content->name);
        }
        break;
    }
    case XML_ELEMENT_CONTENT_SEQ: {
        int englob_left = (content->left->type == XML_ELEMENT_CONTENT_OR) ? 1 : 0;
        xmlSnprintfElementContent(buf, capacity, content->left, englob_left);
        int len = strlen(buf);
        int remaining = capacity - len;
        if (remaining <= 2) {
            if (remaining >= 4)
                snprintf(buf + len, remaining, " ...");
            return;
        }
        snprintf(buf + len, remaining, ", ");
        int englob_right = (content->right->type == XML_ELEMENT_CONTENT_OR) ? 1 : 0;
        xmlSnprintfElementContent(buf, capacity, content->right, englob_right);
        break;
    }
    case XML_ELEMENT_CONTENT_OR: {
        int englob_left = (content->left->type == XML_ELEMENT_CONTENT_SEQ) ? 1 : 0;
        xmlSnprintfElementContent(buf, capacity, content->left, englob_left);
        int len = strlen(buf);
        int remaining = capacity - len;
        if (remaining <= 3) {
            if (remaining >= 4)
                snprintf(buf + len, remaining, " ...");
            return;
        }
        snprintf(buf + len, remaining, " | ");
        int englob_right = (content->right->type == XML_ELEMENT_CONTENT_SEQ) ? 1 : 0;
        xmlSnprintfElementContent(buf, capacity, content->right, englob_right);
        break;
    }
}