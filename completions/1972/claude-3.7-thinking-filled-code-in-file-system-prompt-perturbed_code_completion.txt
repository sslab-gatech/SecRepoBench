switch (content->type) {
    case XML_ELEMENT_CONTENT_PCDATA:
        len = strlen(buf);
        if (capacity - len < 8) { // "#PCDATA" needs 7 chars + null
            if ((capacity - len > 4) && (buf[len - 1] != '.'))
                strcat(buf, " ...");
            return;
        }
        strcat(buf, "#PCDATA");
        break;
    case XML_ELEMENT_CONTENT_ELEMENT:
        len = strlen(buf);
        if (content->prefix != NULL) {
            if (capacity - len < xmlStrlen(content->prefix) + xmlStrlen(content->name) + 3) {
                if ((capacity - len > 4) && (buf[len - 1] != '.'))
                    strcat(buf, " ...");
                return;
            }
            strcat(buf, (char *) content->prefix);
            strcat(buf, ":");
        } else {
            if (capacity - len < xmlStrlen(content->name) + 1) {
                if ((capacity - len > 4) && (buf[len - 1] != '.'))
                    strcat(buf, " ...");
                return;
            }
        }
        strcat(buf, (char *) content->name);
        break;
    case XML_ELEMENT_CONTENT_SEQ:
        if (content->c1 != NULL) {
            if ((content->c1->type == XML_ELEMENT_CONTENT_OR) ||
                (content->c1->type == XML_ELEMENT_CONTENT_SEQ))
                xmlSnprintfElementContent(buf, capacity, content->c1, 1);
            else
                xmlSnprintfElementContent(buf, capacity, content->c1, 0);
                
            len = strlen(buf);
            if (capacity - len < 5) {
                if ((capacity - len > 4) && (buf[len - 1] != '.'))
                    strcat(buf, " ...");
                return;
            }
            strcat(buf, " , ");
        }
        
        if (content->c2 != NULL) {
            if ((content->c2->type == XML_ELEMENT_CONTENT_OR) ||
                ((content->c2->type == XML_ELEMENT_CONTENT_SEQ) &&
                 (content->c2->ocur != XML_ELEMENT_CONTENT_ONCE)))
                xmlSnprintfElementContent(buf, capacity, content->c2, 1);
            else
                xmlSnprintfElementContent(buf, capacity, content->c2, 0);
        }
        break;
    case XML_ELEMENT_CONTENT_OR:
        if (content->c1 != NULL) {
            if ((content->c1->type == XML_ELEMENT_CONTENT_OR) ||
                (content->c1->type == XML_ELEMENT_CONTENT_SEQ))
                xmlSnprintfElementContent(buf, capacity, content->c1, 1);
            else
                xmlSnprintfElementContent(buf, capacity, content->c1, 0);
                
            len = strlen(buf);
            if (capacity - len < 5) {
                if ((capacity - len > 4) && (buf[len - 1] != '.'))
                    strcat(buf, " ...");
                return;
            }
            strcat(buf, " | ");
        }
        
        if (content->c2 != NULL) {
            if ((content->c2->type == XML_ELEMENT_CONTENT_SEQ) ||
                ((content->c2->type == XML_ELEMENT_CONTENT_OR) &&
                 (content->c2->ocur != XML_ELEMENT_CONTENT_ONCE)))
                xmlSnprintfElementContent(buf, capacity, content->c2, 1);
            else
                xmlSnprintfElementContent(buf, capacity, content->c2, 0);
        }
        break;
    default:
        xmlErrValid(NULL, XML_ERR_INTERNAL_ERROR,
                "Internal: ELEMENT content corrupted invalid type\n",
                NULL);
}