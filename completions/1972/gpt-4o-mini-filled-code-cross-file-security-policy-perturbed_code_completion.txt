if (content->type == XML_ELEMENT_CONTENT_PCDATA) {
        const char *pcdata = "#PCDATA";
        int required_length = len + strlen(pcdata) + 1; // +1 for null terminator
        if (capacity >= required_length) {
            strcat(buf, pcdata);
        } else {
            if (capacity - len > 4 && buf[len - 1] != '.') {
                strcat(buf, " ...");
            }
            return;
        }
    } else if (content->type == XML_ELEMENT_CONTENT_ELEMENT) {
        const char *element_name = (const char *)content->name;
        int required_length = len + strlen(element_name) + 1; // +1 for null terminator
        if (capacity >= required_length) {
            strcat(buf, element_name);
        } else {
            if (capacity - len > 4 && buf[len - 1] != '.') {
                strcat(buf, " ...");
            }
            return;
        }
    } else if (content->type == XML_ELEMENT_CONTENT_SEQ) {
        xmlElementContentPtr first_child = content->children;
        while (first_child) {
            xmlSnprintfElementContent(buf, capacity, first_child, 0);
            first_child = first_child->next;
            if (first_child) {
                int required_length = len + 2; // +1 for comma, +1 for null terminator
                if (capacity >= required_length) {
                    strcat(buf, ", ");
                } else {
                    if (capacity - len > 4 && buf[len - 1] != '.') {
                        strcat(buf, " ...");
                    }
                    return;
                }
            }
        }
    } else if (content->type == XML_ELEMENT_CONTENT_OR) {
        xmlElementContentPtr first_child = content->children;
        while (first_child) {
            xmlSnprintfElementContent(buf, capacity, first_child, 0);
            first_child = first_child->next;
            if (first_child) {
                int required_length = len + 2; // +1 for pipe, +1 for null terminator
                if (capacity >= required_length) {
                    strcat(buf, " | ");
                } else {
                    if (capacity - len > 4 && buf[len - 1] != '.') {
                        strcat(buf, " ...");
                    }
                    return;
                }
            }
        }
    }