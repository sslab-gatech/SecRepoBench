switch (content->type) {
        case XML_ELEMENT_CONTENT_PCDATA:
            if (capacity - len >= 8) { // "#PCDATA" is 7 characters + null terminator
                strcat(buf, "#PCDATA");
            } else {
                if (capacity - len > 4 && buf[len - 1] != '.')
                    strcat(buf, " ...");
                return;
            }
            break;
        case XML_ELEMENT_CONTENT_ELEMENT:
            {
                const char *prefix = (content->prefix != NULL) ? (const char *)content->prefix : "";
                const char *name = (const char *)content->name;
                int required_space = strlen(prefix) + strlen(name) + 2; // 1 for ':', 1 for null terminator
                if (capacity - len >= required_space) {
                    if (prefix[0] != '\0') {
                        strcat(buf, prefix);
                        strcat(buf, ":");
                    }
                    strcat(buf, name);
                } else {
                    if (capacity - len > 4 && buf[len - 1] != '.')
                        strcat(buf, " ...");
                    return;
                }
            }
            break;
        case XML_ELEMENT_CONTENT_SEQ:
        case XML_ELEMENT_CONTENT_OR:
            {
                const char *delimiter = (content->type == XML_ELEMENT_CONTENT_SEQ) ? ", " : " | ";
                xmlSnprintfElementContent(buf, capacity, content->c1, 1);
                len = strlen(buf);
                if (capacity - len >= strlen(delimiter)) {
                    strcat(buf, delimiter);
                } else {
                    if (capacity - len > 4 && buf[len - 1] != '.')
                        strcat(buf, " ...");
                    return;
                }
                xmlSnprintfElementContent(buf, capacity, content->c2, 1);
            }
            break;
    }