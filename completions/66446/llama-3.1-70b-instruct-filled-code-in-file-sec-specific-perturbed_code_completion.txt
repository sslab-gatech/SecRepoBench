if (xmlIsStreaming(ctxt)) {
    if (id->attr!= NULL) {
        id->attr->id = NULL;
        id->attr = attr;
    }
    attr->atype = XML_ATTRIBUTE_ID;
    attr->id = id;
    id->name = xmlStrdup(attr->name);
    if (id->name == NULL) {
        xmlVErrMemory(ctxt);
        return(-1);
    }
    id->lineno = xmlGetLineNo(attr->parent);
    if (xmlHashAddEntry(doc->ids, id->value, id, xmlFreeIDTableEntry) < 0) {
        xmlVErrMemory(ctxt);
        xmlFreeID(id);
        return(-1);
    }
} else {
    if (xmlHashAddEntry(doc->ids, id->value, id, xmlFreeIDTableEntry) < 0) {
        xmlVErrMemory(ctxt);
        xmlFreeID(id);
        return(-1);
    }
    attr->atype = XML_ATTRIBUTE_ID;
    attr->id = id;
}