if (streaming) {
        /* In streaming mode, the attribute node may be temporary.
         * Set the ID's name using the document's dictionary if available,
         * otherwise duplicate the attribute's name.
         */
        if (doc->dict && attr->name)
            ret->name = xmlDictLookup(doc->dict, attr->name, -1);
        else
            ret->name = xmlStrdup(attr->name);
    } else {
        /* In non-streaming mode, the attribute persists.
         * Use its name directly and associate it with the ID.
         */
        ret->name = attr->name;
        ret->attr = attr;
    }

    /* Record the line number from the attribute's parent element, if available */
    if (attr->parent != NULL)
        ret->line = attr->parent->line;
    else
        ret->line = 0;

    /* Add the new ID to the document's ID table */
    if (xmlHashAddEntry(table, ret->value, ret) != 0) {
        xmlFreeID(ret);
        return(-1);
    }

    /* Set the attribute as an ID type and associate the attribute with the ID if not in streaming mode */
    attr->atype = XML_ATTRIBUTE_ID;
    if (!streaming)
        attr->id = ret;

    if (id != NULL)
        *id = ret;

    return(0);