if (streaming) {
    /* In streaming mode, the attribute is temporary, so do not tie it directly.
     * Instead, try to use the document's dictionary to intern the identifier.
     */
    if (doc->dict != NULL) {
        xmlChar *interned = xmlDictLookup(doc->dict, identifier, -1);
        if (interned != NULL) {
            xmlFree(ret->value);
            ret->value = interned;
        }
    }
    ret->attr = NULL;
} else {
    /* In non-streaming mode associate the attribute with the ID */
    ret->attr = attr;
}

if (attr->parent != NULL)
    ret->line = attr->parent->line;
else
    ret->line = 0;

/* Add the new ID to the document's ID table */
if (xmlHashAddEntry(table, ret->value, ret) != 0) {
    xmlFreeID(ret);
    return(-1);
}

attr->atype = XML_ATTRIBUTE_ID;
if (!streaming)
    attr->id = ret;
if (id != NULL)
    *id = ret;
return(0);