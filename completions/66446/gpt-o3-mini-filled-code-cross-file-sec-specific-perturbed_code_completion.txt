if (streaming) {
    /* In streaming mode, the attribute may be temporary.
     * Do not retain a direct reference to it.
     */
    ret->attr = NULL;
} else {
    /* For non-streaming, associate the attribute with the ID */
    ret->attr = attr;
    attr->atype = XML_ATTRIBUTE_ID;
    attr->id = ret;
}

/* Record the line number from the attribute's parent element, if available */
if ((attr != NULL) && (attr->parent != NULL))
    ret->line = attr->parent->line;
else
    ret->line = 0;

/* Add the new ID to the document's ID table */
if (xmlHashAddEntry(table, ret->value, ret) < 0) {
    xmlFreeID(ret);
    return(-1);
}

if (id != NULL)
    *id = ret;

return(0);