if (xmlIsStreaming(ctxt)) {
    // Handle streaming mode
    if (doc->dict != NULL) {
        ret->name = xmlDictLookup(doc->dict, attr->name, -1);
    } else {
        ret->name = xmlStrdup(attr->name);
    }
    if (ret->name == NULL)
        goto mem_error;
    ret->attr = NULL;
} else {
    // Associate attribute with ID
    ret->attr = attr;
}

// Record line number from parent element
if (attr->parent != NULL)
    ret->lineno = attr->parent->line;
else
    ret->lineno = 0;

// Add new ID to document's ID table
if (xmlHashAddEntry(table, ret->value, ret) < 0)
    goto mem_error;

attr->atype = XML_ATTRIBUTE_ID;
if (!xmlIsStreaming(ctxt))
    attr->id = ret;

if (id != NULL)
    *id = ret;

return(1);