switch (i)
  {
    case 0:
    {
      if (jp2_image->numcomps == 1)
      {
        scale=(double) (((size_t) 1UL << jp2_image->comps[0].prec)-1)/QuantumRange;
        *q=(int) (scale*GetPixelGray(image,p));
        SetPixelGray(image,ClampToQuantum(*q),q);
        SetPixelAlpha(image,OpaqueAlpha,q);
        break;
      }
      scale=(double) (((size_t) 1UL << jp2_image->comps[0].prec)-1)/QuantumRange;
      *q=(int) (scale*GetPixelRed(image,p));
      SetPixelRed(image,ClampToQuantum(*q),q);
      scale=(double) (((size_t) 1UL << jp2_image->comps[1].prec)-1)/QuantumRange;
      q++;
      *q=(int) (scale*GetPixelGreen(image,p));
      SetPixelGreen(image,ClampToQuantum(*q),q);
      scale=(double) (((size_t) 1UL << jp2_image->comps[2].prec)-1)/QuantumRange;
      q++;
      *q=(int) (scale*GetPixelBlue(image,p));
      SetPixelBlue(image,ClampToQuantum(*q),q);
      SetPixelAlpha(image,OpaqueAlpha,q);
      break;
    }
    case 1:
    {
      if (jp2_image->numcomps == 2)
      {
        scale=(double) (((size_t) 1UL << jp2_image->comps[0].prec)-1)/QuantumRange;
        *q=(int) (scale*GetPixelAlpha(image,p));
        SetPixelAlpha(image,ClampToQuantum(*q),q);
        break;
      }
      scale=(double) (((size_t) 1UL << jp2_image->comps[1].prec)-1)/QuantumRange;
      q++;
      *q=(int) (scale*GetPixelGreen(image,p));
      SetPixelGreen(image,ClampToQuantum(*q),q);
      break;
    }
    case 2:
    {
      scale=(double) (((size_t) 1UL << jp2_image->comps[2].prec)-1)/QuantumRange;
      q++;
      *q=(int) (scale*GetPixelBlue(image,p));
      SetPixelBlue(image,ClampToQuantum(*q),q);
      break;
    }
    case 3:
    {
      scale=(double) (((size_t) 1UL << jp2_image->comps[3].prec)-1)/QuantumRange;
      q++;
      *q=(int) (scale*GetPixelAlpha(image,p));
      SetPixelAlpha(image,ClampToQuantum(*q),q);
      break;
    }
  }