scale = (double) QuantumRange / ( ((size_t) 1UL << jp2_image->comps[i].prec) - 1 );
{
  ssize_t offset =
    (y / jp2_image->comps[i].dy) *
      (jp2_image->comps[i].w / jp2_image->comps[i].dx) +
    (columnindex / jp2_image->comps[i].dx);
  pixel = scale * (double) jp2_image->comps[i].data[offset];
}