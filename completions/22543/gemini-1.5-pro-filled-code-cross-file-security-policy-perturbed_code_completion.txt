scale = (double)QuantumRange / ((size_t)1UL << jp2_image->comps[i].prec) /
                (jp2_image->comps[i].sgnd ? 1 : 2);
        if ((size_t)(y / jp2_image->comps[i].dy * image->columns /
                     jp2_image->comps[i].dx + columnindex / jp2_image->comps[i].dx) >= (size_t)(jp2_image->comps[i].h * jp2_image->comps[i].w)) {
           opj_destroy_codec(jp2_codec);
           opj_image_destroy(jp2_image);
           ThrowReaderException(CoderError, "Invalid image geometry");
        }

        pixel = scale * (jp2_image->comps[i].data[y / jp2_image->comps[i].dy *
                                                image->columns / jp2_image->comps[i].dx +
                                                columnindex / jp2_image->comps[i].dx] +
                         (jp2_image->comps[i].sgnd ? 0 : 1));