scale=(double) QuantumRange/(((size_t)1UL << jp2_image->comps[i].prec)-1);
{
  size_t comp_dx = jp2_image->comps[i].dx;
  size_t comp_dy = jp2_image->comps[i].dy;
  size_t effective_width = image->columns/comp_dx;
  size_t index = (size_t)(y/comp_dy)*effective_width + (columnindex/comp_dx);
  pixel = jp2_image->comps[i].data[index] * scale;
}