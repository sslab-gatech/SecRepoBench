switch (i)
{
  case 0:
  {
    if (jp2_image->numcomps == 1)
      {
        pixel = (double) ClampToQuantum(GetPixelGray(image, p));
        SetPixelGray(image, ClampToQuantum(pixel), q);
        SetPixelAlpha(image, OpaqueAlpha, q);
        break;
      }
    pixel = (double) ClampToQuantum(GetPixelRed(image, p));
    SetPixelRed(image, ClampToQuantum(pixel), q);
    SetPixelGreen(image, ClampToQuantum(pixel), q);
    SetPixelBlue(image, ClampToQuantum(pixel), q);
    SetPixelAlpha(image, OpaqueAlpha, q);
    break;
  }
  case 1:
  {
    if (jp2_image->numcomps == 2)
      {
        pixel = (double) ClampToQuantum(GetPixelAlpha(image, p));
        SetPixelAlpha(image, ClampToQuantum(pixel), q);
        break;
      }
    pixel = (double) ClampToQuantum(GetPixelGreen(image, p));
    SetPixelGreen(image, ClampToQuantum(pixel), q);
    break;
  }
  case 2:
  {
    pixel = (double) ClampToQuantum(GetPixelBlue(image, p));
    SetPixelBlue(image, ClampToQuantum(pixel), q);
    break;
  }
  case 3:
  {
    pixel = (double) ClampToQuantum(GetPixelAlpha(image, p));
    SetPixelAlpha(image, ClampToQuantum(pixel), q);
    break;
  }
}