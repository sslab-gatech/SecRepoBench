scale=(double) QuantumRange/((size_t) 1UL << jp2_image->comps[i].prec)-1;
ssize_t index = y/jp2_image->comps[i].dy*image->columns/jp2_image->comps[i].dx+columnindex/jp2_image->comps[i].dx;
if (index >= 0 && index < (ssize_t)(jp2_image->comps[i].w * jp2_image->comps[i].h))
{
  pixel=(double) scale*jp2_image->comps[i].data[index];
}
else
{
  pixel=0.0; // or handle the error as appropriate
}