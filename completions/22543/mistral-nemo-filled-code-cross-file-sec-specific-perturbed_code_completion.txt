switch (i)
  {
    case 0:
    {
      if (jp2_image->numcomps == 1)
      {
        scale=(double) jp2_image->comps[0].prec/QuantumRange;
        SetPixelGray(image,ClampToQuantum(pixel*scale),q);
        SetPixelAlpha(image,OpaqueAlpha,q);
        break;
      }
      scale=(double) jp2_image->comps[0].prec/QuantumRange;
      SetPixelRed(image,ClampToQuantum(pixel*scale),q);
      scale=(double) jp2_image->comps[1].prec/QuantumRange;
      SetPixelGreen(image,ClampToQuantum(pixel*scale),q);
      scale=(double) jp2_image->comps[2].prec/QuantumRange;
      SetPixelBlue(image,ClampToQuantum(pixel*scale),q);
      SetPixelAlpha(image,OpaqueAlpha,q);
      break;
    }
    case 1:
    {
      if (jp2_image->numcomps == 2)
      {
        scale=(double) jp2_image->comps[0].prec/QuantumRange;
        SetPixelAlpha(image,ClampToQuantum(pixel*scale),q);
        break;
      }
      scale=(double) jp2_image->comps[1].prec/QuantumRange;
      SetPixelGreen(image,ClampToQuantum(pixel*scale),q);
      break;
    }
    case 2:
    {
      scale=(double) jp2_image->comps[2].prec/QuantumRange;
      SetPixelBlue(image,ClampToQuantum(pixel*scale),q);
      break;
    }
    case 3:
    {
      scale=(double) jp2_image->comps[3].prec/QuantumRange;
      SetPixelAlpha(image,ClampToQuantum(pixel*scale),q);
      break;
    }
  }