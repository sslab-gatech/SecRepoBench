if (ret < 0) {
    BLOSC_TRACE_ERROR("Unable to get header info from frame.");
    return -1;
}

int64_t trailer_offset = get_trailer_offset(frame, header_len, cbytes);
if (trailer_offset < 0) {
    BLOSC_TRACE_ERROR("Unable to get trailer offset.");
    return -1;
}

uint32_t usermeta_len_network;
if (frame->sdata != NULL) {
    memcpy(&usermeta_len_network, frame->sdata + trailer_offset + FRAME_TRAILER_USERMETA_LEN_OFFSET, sizeof(int32_t));
} else {
    FILE* fp = fopen(frame->fname, "rb");
    if (fp == NULL) {
        BLOSC_TRACE_ERROR("Unable to open file %s", frame->fname);
        return -1;
    }
    if (fseek(fp, trailer_offset + FRAME_TRAILER_USERMETA_LEN_OFFSET, SEEK_SET) != 0) {
        BLOSC_TRACE_ERROR("Unable to seek in file %s", frame->fname);
        fclose(fp);
        return -1;
    }
    size_t rbytes = fread(&usermeta_len_network, 1, sizeof(int32_t), fp);
    fclose(fp);
    if (rbytes != sizeof(int32_t)) {
        BLOSC_TRACE_ERROR("Unable to read usermeta_len from file %s", frame->fname);
        return -1;
    }
}
int32_t usermeta_len;
swap_store(&usermeta_len, &usermeta_len_network, sizeof(int32_t));