// Extract the signature algorithms from the packet payload starting from the given offset.
// Calculate the number of signature algorithms and store it in the appropriate field.
// Optionally, copy the signature algorithms into a dedicated structure if a specific flag is enabled.
// Convert each signature algorithm to a string format and append it to a string buffer for logging or further processing.

int extract_signature_algorithms(struct ndpi_detection_module_struct *ndpi_struct,
                                 struct ndpi_flow_struct *flow,
                                 u_int16_t offset,
                                 u_int16_t total_len,
                                 char *signature_algorithms_str,
                                 size_t max_len) {
  int sessoffset = offset;
  u_int16_t tot_signature_algorithms_len = ntohs(*((u_int16_t*)&packet->payload[sessoffset]));
  size_t sa_size = ndpi_min(tot_signature_algorithms_len / 2, MAX_NUM_TLS_SIGNATURE_ALGORITHMS);
  size_t signature_algorithms_str_len = 0;

  sessoffset += 2;
  tot_signature_algorithms_len = ndpi_min(sa_size * 2, tot_signature_algorithms_len);

  for(u_int16_t i = 0; i < tot_signature_algorithms_len; i += 2) {
    u_int16_t signature_algo = ntohs(*((u_int16_t*)&packet->payload[sessoffset + i]));

    if (signature_algorithms_str_len > 0) {
      signature_algorithms_str[signature_algorithms_str_len++] = ',';
    }

    signature_algorithms_str_len += snprintf(&signature_algorithms_str[signature_algorithms_str_len],
                                             max_len - signature_algorithms_str_len,
                                             "%u", signature_algo);

    if (signature_algorithms_str_len >= max_len) {
      break;
    }
  }

  return signature_algorithms_str_len;
}