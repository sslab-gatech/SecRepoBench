size_t sa_size = ndpi_min(tot_signature_algorithms_len / 2, MAX_NUM_TLS_SIGNATURE_ALGORITHMS);
ja.client.num_signature_algorithms = 0;

for (i = 0; i < tot_signature_algorithms_len && ja.client.num_signature_algorithms < sa_size; i += 2) {
    if (sessoffset + i + 2 > packet->payload_packet_len) break;
    
    u_int16_t algo = ntohs(*((u_int16_t*)&packet->payload[sessoffset + i]));
    ja.client.signature_algorithms[ja.client.num_signature_algorithms] = algo;
    
    int offset = ja.client.num_signature_algorithms * 4;
    if (offset + 4 >= sizeof(ja.client.signature_algorithms_str)) break;
    
    snprintf(&ja.client.signature_algorithms_str[offset], sizeof(ja.client.signature_algorithms_str) - offset, 
            "%04X", algo);
    ja.client.num_signature_algorithms++;
}

if (ja.client.num_signature_algorithms > 0) {
    int final_offset = ja.client.num_signature_algorithms * 4;
    ja.client.signature_algorithms_str[final_offset] = '\0';
} else {
    ja.client.signature_algorithms_str[0] = '\0';
}