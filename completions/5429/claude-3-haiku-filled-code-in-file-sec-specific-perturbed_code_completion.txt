/*
  Allocate memory for the colormap index based on the number of colors in the image.
*/
colormap_index=(ssize_t *) AcquireQuantumMemory(MaxColormapSize,sizeof(*colormap_index));
if (colormap_index == (ssize_t *) NULL)
  ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",image->filename);
(void) ResetMagickMemory(colormap_index,(-1),MaxColormapSize*sizeof(*colormap_index));
if (AcquireImageColormap(image,MaxColormapSize,exception_info) == MagickFalse)
  {
    colormap_index=(ssize_t *) RelinquishMagickMemory(colormap_index);
    ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",image->filename);
  }
image->colors=0;