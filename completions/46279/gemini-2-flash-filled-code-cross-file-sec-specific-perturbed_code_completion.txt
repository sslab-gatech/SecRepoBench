int64_t tend;
  size_t start, end;
  int ret;
  static uint32_t lastfilteraddress = 0;
  static uint32_t lastfilterlength = 0;

  if (filter == NULL)
    return 0;

  start = filter->blockstartpos;
  tend = (int64_t)start + filter->blocklength;

  /*
   * This is a sanity check.  If the filter start position is
   * too large, we should invalidate the current filter start.
   */
  if (filters->filterstart > start)
    filters->filterstart = (size_t)~0;

  if (tend > (int64_t)archivereadptr->buffer_size)
  {
    if (tend > (int64_t)ARCHIVE_READ_MAX_LOOKAHEAD)
      return 0;
    if (archive_read_grow_buff(archivereadptr, (size_t)tend) == NULL)
      return 0;
  }