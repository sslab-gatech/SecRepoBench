int64_t tend;
  size_t start = filter->blockstartpos;
  int ret;

  if (!filter)
    return 0;
  if (!filters->stack)
    return 0;

  tend = filter->blockstartpos + filter->blocklength;
  if (filters->lastend > filter->blockstartpos)
    start = filters->lastend;
  if (archive_read_get_bytes_in_buffer(archivereadptr) < tend - start)
  {
    if (archive_read_ahead(archivereadptr, tend - start, NULL) != ARCHIVE_OK)
      return 0;
  }