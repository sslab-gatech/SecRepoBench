if (filters == NULL || filter == NULL)
  return 0;
filter->blockstartpos = filters->filterstart;
tend = (int64_t)filter->blockstartpos + (int64_t)filter->blocklength;
if (tend < archivereadptr->read_data_offset)
  filter->blockstartpos = (size_t)-1;
else
{
  ret = archive_read_data_block_is_in_buffer(archivereadptr, tend);
  if (ret == ARCHIVE_WARN)
    ; /* Ok, buffer contains data. */
  else if (ret == ARCHIVE_OK)
  {
    /* Ok, buffer does not contain data, but it can be expanded. */
    ret = archive_read_data_block_expand_buffer(archivereadptr, tend);
    if (ret != ARCHIVE_OK)
      return 0;
  }
  else
    return 0;
}