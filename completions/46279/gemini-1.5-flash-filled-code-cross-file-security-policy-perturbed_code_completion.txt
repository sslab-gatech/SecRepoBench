int64_t tend;
  size_t start = filter->blockstartpos;
  int ret;

  if (!filter || !filters->stack)
    return 0;

  tend = filter->blockstartpos + filter->blocklength;
  if (filters->lastend > tend)
    tend = filters->lastend;

  ret = archive_read_data_block(archivereadptr, (void *)&filters->vm->memory[start], tend - start);
  if (ret != ARCHIVE_OK)
    return 0;

  if (filter == NULL || filters->stack == NULL) {
    return 0;
  }

  if (archive_read_data_block(archivereadptr, (void *)&filters->vm->memory[start], tend - start) != ARCHIVE_OK) {
    return 0;
  }