int64_t tend;
  size_t start, end;
  int ret;
  uint32_t lastfilteraddress, lastfilterlength;

  if (filter == NULL)
    return 1;

  start = filter->blockstartpos;
  tend = (int64_t)start + filter->blocklength;

  if (tend > ARCHIVE_READ_MAX_LOOKAHEAD)
    return 0;

  if (tend < 0)
    return 0;

  if (tend > (int64_t)archivereadptr->avail)
  {
    ret = archive_read_ensure_ahead(archivereadptr, (size_t)tend);
    if (ret < ARCHIVE_OK)
      return 0;
  }