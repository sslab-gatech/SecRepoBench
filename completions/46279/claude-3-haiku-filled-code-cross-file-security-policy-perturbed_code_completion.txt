if (filters == NULL || filter == NULL)
  return 0;

int64_t start = filter->blockstartpos;
int64_t tend = start + filter->blocklength;

if (tend < 0)
  return 0;
size_t end = (size_t)tend;
if (end != start + filter->blocklength)
  return 0;

if (!filters->vm)
{
  filters->vm = calloc(1, sizeof(*filters->vm));
  if (!filters->vm)
    return 0;
}

int ret = copy_from_lzss_window(archivereadptr, filters->vm->memory, start, filter->blocklength);
if (ret != ARCHIVE_OK)
  return 0;
if (!execute_filter(archivereadptr, filter, filters->vm, rar->offset))
  return 0;