if (filters == NULL || filter == NULL)
    return 0;

start = filters->filterstart;
tend = filter->blockstartpos + filter->blocklength;

filter->blockstartpos = INT64_MAX;

if (archive_read_expand(archivereadptr, tend) != ARCHIVE_OK)
    return 0;

// Verify that the filter pointer is still valid after expansion
if (filters->stack != filter) {
    // Handle the discrepancy, possibly by logging an error or resetting the filter
    return 0;
}