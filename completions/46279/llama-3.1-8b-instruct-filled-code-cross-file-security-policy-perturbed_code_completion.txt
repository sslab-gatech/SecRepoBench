// Attempt to expand the archive read buffer up to the calculated end position.
// <MASK>
if (filters->vm)
{
  free(filters->vm->memory);
  free(filters->vm);
  filters->vm = NULL;
}
filters->vm = calloc(1, sizeof(*filters->vm));
if (!filters->vm)
  return 0;

size_t new_end = start + filter->blocklength;
if (new_end > end)
  new_end = end;

if (new_end > archivereadptr->size)
{
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr, &archivereadptr->size))
    return 0;
  if (rar_decode_byte(archivereadptr,