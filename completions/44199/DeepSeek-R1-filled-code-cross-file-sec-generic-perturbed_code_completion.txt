jsmntok_info_t ti = {tokens, r};
    plist_t root = NULL;

    switch (tokens[startindex].type) {
        case JSMN_OBJECT:
            root = parse_object(jsonstr, &ti, &startindex);
            break;
        case JSMN_ARRAY:
            root = parse_array(jsonstr, &ti, &startindex);
            break;
        case JSMN_STRING:
            root = parse_string(jsonstr, &ti, &startindex);
            break;
        case JSMN_PRIMITIVE:
            root = parse_primitive(jsonstr, &ti, &startindex);
            break;
        default:
            PLIST_JSON_ERR("%s: Unexpected root token type %d\n", __func__, tokens[startindex].type);
            free(tokens);
            return PLIST_ERR_PARSE;
    }

    if (!root) {
        PLIST_JSON_ERR("%s: Failed to parse root element\n", __func__);
        free(tokens);
        return PLIST_ERR_PARSE;
    }

    if (startindex != ti.count) {
        PLIST_JSON_ERR("%s: Extra tokens after root element\n", __func__);
        plist_free(root);
        free(tokens);
        return PLIST_ERR_PARSE;
    }

    *plist = root;