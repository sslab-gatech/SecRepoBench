if (startindex >= r) {
    PLIST_JSON_ERR("%s: No tokens to parse\n", __func__);
    free(tokens);
    return PLIST_ERR_PARSE;
}

jsmntok_info_t ti;
ti.tokens = tokens;
ti.count = r;

plist_t parsed = NULL;
switch (tokens[startindex].type) {
    case JSMN_OBJECT:
        parsed = parse_object(jsonstr, &ti, &startindex);
        break;
    case JSMN_ARRAY:
        parsed = parse_array(jsonstr, &ti, &startindex);
        break;
    case JSMN_STRING:
        parsed = parse_string(jsonstr, &ti, &startindex);
        break;
    case JSMN_PRIMITIVE:
        parsed = parse_primitive(jsonstr, &ti, &startindex);
        break;
    default:
        PLIST_JSON_ERR("%s: Unsupported JSON token type: %d\n", __func__, tokens[startindex].type);
        free(tokens);
        return PLIST_ERR_PARSE;
}

if (!parsed) {
    PLIST_JSON_ERR("%s: Failed to parse JSON token\n", __func__);
    free(tokens);
    return PLIST_ERR_PARSE;
}
*plist = parsed;