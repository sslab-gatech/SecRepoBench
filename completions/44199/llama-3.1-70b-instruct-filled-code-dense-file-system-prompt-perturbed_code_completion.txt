// Parse the JSON token at the current start index based on its type.
// Depending on whether the token is a primitive, string, array, or object,
// call the corresponding parse function to convert the JSON data into a plist structure.
// Assign the parsed plist result to the output pointer `plist`.
plist_t node = NULL;
int index = 0;
jsmntok_info_t ti;
ti.tokens = tokens;
ti.count = r;
ti.js = jsonstr;

switch (tokens[0].type) {
    case JSMN_PRIMITIVE:
        node = parse_primitive(jsonstr, &ti, &index);
        break;
    case JSMN_STRING:
        node = parse_string(jsonstr, &ti, &index);
        break;
    case JSMN_ARRAY:
        node = parse_array(jsonstr, &ti, &index);
        break;
    case JSMN_OBJECT:
        node = parse_object(jsonstr, &ti, &index);
        break;
    default:
        PLIST_JSON_ERR("%s: Unknown token type\n", __func__);
        free(tokens);
        return PLIST_ERR_PARSE;
}

if (!node) {
    free(tokens);
    return PLIST_ERR_PARSE;
}

*plist = node;