jsmntok_info_t ti;
    ti.tokens = tokens;
    ti.count = r;

    plist_t root = NULL;

    if (tokens[startindex].type == JSMN_OBJECT) {
        root = parse_object(jsonstr, &ti, &startindex);
    } else if (tokens[startindex].type == JSMN_ARRAY) {
        root = parse_array(jsonstr, &ti, &startindex);
    } else if (tokens[startindex].type == JSMN_STRING) {
        root = parse_string(jsonstr, &ti, &startindex);
    } else if (tokens[startindex].type == JSMN_PRIMITIVE) {
        root = parse_primitive(jsonstr, &ti, &startindex);
    } else {
        PLIST_JSON_ERR("%s: unexpected token type\n", __func__);
        free(tokens);
        return PLIST_ERR_PARSE;
    }

    if (root) {
        *plist = root;
    } else {
        free(tokens);
        return PLIST_ERR_PARSE;
    }

    free(tokens);
    return PLIST_ERR_SUCCESS;