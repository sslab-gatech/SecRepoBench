plist_t parse_json_token(const char* js, jsmntok_info_t* ti, int* index) {
    switch (ti->tokens[*index].type) {
        case JSMN_PRIMITIVE:
            return parse_primitive(js, ti, index);
        case JSMN_STRING:
            return parse_string(js, ti, index);
        case JSMN_ARRAY:
            return parse_array(js, ti, index);
        case JSMN_OBJECT:
            return parse_object(js, ti, index);
        default:
            PLIST_JSON_ERR("%s: Invalid token type\n", __func__);
            return NULL;
    }
}

plist_t plist_from_json(const char *jsonstr, uint32_t length, plist_t * plist) {
    // ... (previous code)

    jsmntok_info_t ti = {tokens, r};
    *plist = parse_json_token(jsonstr, &ti, &startindex);

    // ... (remaining code)
}