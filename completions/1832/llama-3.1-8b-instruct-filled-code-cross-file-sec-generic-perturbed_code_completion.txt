// <MASK>
if (s->num_primitive_matrices > 0) {
    for (unsigned int i = 0; i < s->num_primitive_matrices; i++) {
        mat = get_bits(gbp, 4);
        channel = get_bits(gbp, 4);
        if (channel >= max_channel) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max channel %d.\n", channel, max_channel);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_MLP && channel >= MAX_NOISE_CHANNELS) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 1) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 1);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 2) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 2);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 3) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 3);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 4) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 4);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 5) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 5);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 6) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 6);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 7) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 7);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 8) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 8);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 9) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 9);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 10) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 10);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 11) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 11);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 12) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 12);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 13) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 13);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 14) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 14);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 15) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 15);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 16) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 16);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 17) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 17);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 18) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 18);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 19) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 19);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 20) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 20);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 21) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 21);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 22) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 22);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 23) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 23);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 24) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 24);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 25) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 25);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 26) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 26);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 27) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 27);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 28) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 28);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 29) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 29);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 30) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 30);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 31) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 31);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 32) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 32);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 33) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 33);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 34) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 34);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 35) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 35);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 36) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 36);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 37) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 37);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 38) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 38);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 39) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max noise channel %d.\n", channel, MAX_NOISE_CHANNELS + 39);
            return AVERROR_INVALIDDATA;
        }
        if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD && channel >= MAX_NOISE_CHANNELS + 40) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds max nois