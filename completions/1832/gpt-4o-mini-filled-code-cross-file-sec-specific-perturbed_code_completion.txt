if (s->num_primitive_matrices > max_primitive_matrices) {
        av_log(m->avctx, AV_LOG_ERROR, "Number of primitive matrices exceeds maximum allowed.\n");
        return AVERROR_INVALIDDATA;
    }

    for (mat = 0; mat < s->num_primitive_matrices; mat++) {
        channel = get_bits(gbp, 5); // Assuming channel is read from gbp
        if (channel >= MAX_CHANNELS) {
            av_log(m->avctx, AV_LOG_ERROR, "Output channel %d exceeds maximum allowed channels.\n", channel);
            return AVERROR_INVALIDDATA;
        }

        int fractional_bits = get_bits(gbp, 4);
        if (fractional_bits > 14) {
            av_log(m->avctx, AV_LOG_ERROR, "Fractional bits %d exceed maximum allowed of 14.\n", fractional_bits);
            return AVERROR_INVALIDDATA;
        }

        // Read and validate coefficients, noise shift, etc. as needed
        // ...
    }