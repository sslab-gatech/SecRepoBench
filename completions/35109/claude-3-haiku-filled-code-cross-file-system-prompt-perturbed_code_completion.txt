int digit = *p - '0';
if (digit < 0 || digit > 9) {
  mrb_raisef(mrb, E_ARGUMENT_ERROR, "invalid format character '%c'", *p);
  return NULL;
}
nextnumber = nextnumber * 10 + digit;
p++;