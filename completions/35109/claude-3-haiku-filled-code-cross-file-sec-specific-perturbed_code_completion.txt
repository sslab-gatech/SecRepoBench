int i = 0;
while (p < end && isdigit((unsigned char)*p)) {
  if (nextnumber > MRB_INT_MAX / 10) {
    mrb_raisef(mrb, E_ARGUMENT_ERROR, "invalid format string: too big number");
    return NULL;
  }
  nextnumber = nextnumber * 10 + (*p - '0');
  p++;
  i++;
}
if (i == 0) {
  mrb_raisef(mrb, E_ARGUMENT_ERROR, "invalid format string: no digits found");
  return NULL;
}