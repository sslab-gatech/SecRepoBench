while (p < end && mrb_isdigit(*p)) {
  nextnumber = nextnumber * 10 + (*p++ - '0');
}
if (p == end || !mrb_isdigit(*p)) {
  // do nothing, p points to a non-digit character
} else {
  // Malformed format string
  mrb_raise(mrb, E_ARGUMENT_ERROR, "malformed format string");
}