while (p < end && *p >= '0' && *p <= '9') {
  nextnumber = nextnumber * 10 + (*p - '0');
  p++;
}
if (p == end || !(*p >= '0' && *p <= '9')) {
  // No digits were parsed or the first character is not a digit
  mrb_raisef(mrb, E_ARGUMENT_ERROR, "malformed format string at %S", mrb_str_new_cstr(mrb, p));
}