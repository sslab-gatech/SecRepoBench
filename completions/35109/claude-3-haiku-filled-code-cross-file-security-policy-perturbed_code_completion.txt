int digit = (int)(*p - '0');
if (digit < 0 || digit > 9) {
  mrb_raisef(mrb, E_ARGUMENT_ERROR, "invalid format character '%c'", *p);
}
if (nextnumber > (mrb_int)INT_MAX / 10 || (nextnumber == (mrb_int)INT_MAX / 10 && digit > 7)) {
  mrb_raisef(mrb, E_RANGE_ERROR, "integer %d out of range", (int)nextnumber * 10 + digit);
}
nextnumber = nextnumber * 10 + digit;
p++;