if (m->factor_op == FILE_FACTOR_OP_NONE) {
		m->factor_op = FILE_FACTOR_OP_PLUS;
		m->factor = 1;
		return 0;
	}
	if (m->factor_op == FILE_FACTOR_OP_PLUS) {
		m->factor += factor;
	} else if (m->factor_op == FILE_FACTOR_OP_MINUS) {
		m->factor -= factor;
	} else if (m->factor_op == FILE_FACTOR_OP_TIMES) {
		m->factor *= factor;
	} else if (m->factor_op == FILE_FACTOR_OP_DIV) {
		if (factor == 0) {
			file_magwarn(ms, "Division by zero in factor operation");
			goto out;
		}
		m->factor /= factor;
	} else {
		file_magwarn(ms, "Unknown factor operation `%c'", m->factor_op);
		goto out;
	}