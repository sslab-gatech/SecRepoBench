struct magic *m;
	const char *l = line;
	char *el;
	unsigned long factor;
	int op;

	EATAB;
	m = &myself->mp[myself->cont_count == 0 ? 0 : myself->cont_count - 1];

	if (m->type == FILE_NAME) {
		file_magwarn(ms, "Strength setting not supported for FILE_NAME entries");
		return -1;
	}

	op = *l;
	switch (op) {
	case '/':
		m->factor_op = FILE_FACTOR_OP_DIV;
		l++;
		break;
	case '*':
		m->factor_op = FILE_FACTOR_OP_TIMES;
		l++;
		break;
	case '+':
		m->factor_op = FILE_FACTOR_OP_PLUS;
		l++;
		break;
	case '-':
		m->factor_op = FILE_FACTOR_OP_MINUS;
		l++;
		break;
	case '\0':
		m->factor_op = FILE_FACTOR_OP_NONE;
		break;
	default:
		m->factor_op = FILE_FACTOR_OP_NONE;
		break;
	}

	EATAB;
	factor = strtoul(l, &el, 0);
	if (factor > 255) {
		file_magwarn(ms, "Too large factor `%lu'", factor);
		goto out;
	}
	if (*el && !isspace((unsigned char)*el)) {
		file_magwarn(ms, "Bad factor `%s'", l);
		goto out;
	}

	m->factor = (uint8_t)factor;
	if (m->factor == 0 && m->factor_op == FILE_FACTOR_OP_DIV) {
		file_magwarn(ms, "Cannot have factor op `/' and factor 0");
		goto out;
	}
	return 0;

out:
	m->factor_op = FILE_FACTOR_OP_NONE;
	m->factor = 0;
	return -1;