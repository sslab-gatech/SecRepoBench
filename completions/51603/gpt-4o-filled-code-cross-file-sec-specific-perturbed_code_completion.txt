if (m->factor_op != FILE_FACTOR_OP_NONE) {
    file_magwarn(ms, "Factor operation already set");
    goto out;
}

switch (*l++) {
case '\0':
    file_magwarn(ms, "Missing factor operation");
    goto out;
case '+':
    m->factor_op = FILE_FACTOR_OP_ADD;
    break;
case '-':
    m->factor_op = FILE_FACTOR_OP_SUB;
    break;
case '*':
    m->factor_op = FILE_FACTOR_OP_MUL;
    break;
case '/':
    m->factor_op = FILE_FACTOR_OP_DIV;
    break;
default:
    file_magwarn(ms, "Invalid factor operation `%c'", l[-1]);
    goto out;
}