if (!checkcpdtable.empty() && scpd < checkcpdtable.size()) {
  std::string pattern1 = checkcpdtable[scpd].pattern1;
  std::string pattern2 = checkcpdtable[scpd].pattern2;
  size_t pattern1_len = pattern1.size();
  
  if (i >= pattern1_len && 
      (pattern2.size() == 0 || i + pattern2.size() <= st.size())) {
    if (isRevSubset(pattern1.c_str(), st.c_str() + i - 1, pattern1_len)) {
      if (!soldi) {
        soldi = i;
        oldlen = len;
        oldcmin = cmin;
        oldcmax = cmax;
      }
      
      // Replace pattern1 with pattern2
      if (pattern2.size() == 0) {
        st.replace(i - pattern1_len, pattern1_len, "");
        i -= pattern1_len;
        len -= pattern1_len;
      } else {
        st.replace(i - pattern1_len, pattern1_len, pattern2);
        i = i - pattern1_len + pattern2.size();
        len = len - pattern1_len + pattern2.size();
      }
      
      // Recalculate cmin and cmax
      setcminmax(&cmin, &cmax, st.c_str(), len);
    }
  }
}