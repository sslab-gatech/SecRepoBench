if (!checkcpdtable.empty() && scpd < checkcpdtable.size()) {
    // Save old values for possible rollback if we can't complete the pattern
    oldlen = len;
    oldcmin = cmin;
    oldcmax = cmax;
    soldi = i;

    // Attempt to match a compound pattern at the current position
    size_t pat_len = checkcpdtable[scpd].pattern.size();
    if ((i >= (int)pat_len) &&
        !st.compare(i - pat_len, pat_len, checkcpdtable[scpd].pattern)) {
      // Replace the matched pattern section with its replacement text
      st.replace(i - pat_len, pat_len, checkcpdtable[scpd].repl);

      // Adjust 'i' to reflect the inserted replacement
      i = i - pat_len + checkcpdtable[scpd].repl.size();

      // Update the string length
      len = st.size();

      // Recalculate compound boundary limits
      setcminmax(&cmin, &cmax, st.c_str(), len);
    }
}