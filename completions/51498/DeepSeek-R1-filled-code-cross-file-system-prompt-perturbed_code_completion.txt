if (scpd < checkcpdtable.size()) {
    const cpdpattern& pat = checkcpdtable[scpd];
    size_t patlen = pat.pattern.size();
    if (i >= patlen && st.compare(i - patlen, patlen, pat.pattern) == 0) {
        st.replace(i - patlen, patlen, pat.replacement);
        soldi = i;
        oldlen = len;
        oldcmin = cmin;
        oldcmax = cmax;
        len = st.size();
        i = i - patlen + pat.replacement.size();
        cmin = i - pat.replacement.size();
        cmax = i + 1;
    }
}