if (!checkcpdtable.empty() && scpd > 0) {
            int j = scpd - 1;
            if (j < (int)checkcpdtable.size()) {
                const std::string& pattern = checkcpdtable[j].pattern;
                const std::string& repl = checkcpdtable[j].pattern2;
                size_t pattern_len = pattern.length();
                if (i + pattern_len <= st.length() && st.compare(i, pattern_len, pattern) == 0) {
                    soldi = i;
                    oldcmin = cmin;
                    oldcmax = cmax;
                    oldlen = len;
                    st.replace(i, pattern_len, repl);
                    len = st.length();
                    i += repl.length() - 1;  // -1 because loop increments i
                    setcminmax(&cmin, &cmax, st.c_str(), len);
                }
            }
        }