// Check for a matching simplified compound pattern ("pattern3") and apply it
if (scpd < checkcpdtable.size() && !checkcpdtable[scpd].pattern3.empty()) {
    size_t p3len = checkcpdtable[scpd].pattern3.size();
    // Ensure there's enough space in 'st' to match the pattern just before 'i'
    if (i >= (int)p3len) {
        // Compare the substring ending at 'i' with the pattern3 entry
        if (st.compare(i - p3len, p3len, checkcpdtable[scpd].pattern3) == 0) {
            // Replace or remove that part of the string as specified
            // (here we remove it; adapt if needed to insert other text)
            st.erase(i - p3len, p3len);

            // Adjust position and length
            i -= p3len; 
            len = st.size();

            // Recompute compound length limits
            setcminmax(&cmin, &cmax, st.c_str(), len);
        }
    }
}