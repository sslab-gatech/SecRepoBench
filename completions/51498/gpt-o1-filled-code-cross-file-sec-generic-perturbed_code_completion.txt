// store the current index and length in case we need to revert
soldi = i;
oldlen = len;
oldcmin = cmin;
oldcmax = cmax;

// attempt to find a compound pattern match ending at position i
if (scpd > 0 && scpd <= checkcpdtable.size()) {
    const auto &cpd = checkcpdtable[scpd - 1];
    if (!cpd.pattern.empty() && i >= static_cast<int>(cpd.pattern.size())) {
        // look for cpd.pattern ending exactly at i
        size_t pos = st.rfind(cpd.pattern, i);
        if (pos != std::string::npos && (pos + cpd.pattern.size() == static_cast<size_t>(i))) {
            // replace the matching pattern with the specified replacement text
            st.replace(pos, cpd.pattern.size(), cpd.pattern2);
            // update indexed values after the replacement
            len = st.size();
            cmax = len;
            i = static_cast<int>(pos + cpd.pattern2.size());
            if (i < cmin) {
                cmin = i;
            }
        }
    }
}