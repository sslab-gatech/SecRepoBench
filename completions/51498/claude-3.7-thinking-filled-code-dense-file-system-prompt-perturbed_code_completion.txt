if (!checkcpdtable.empty() && scpd <= checkcpdtable.size()) {
  int matchlen = 0;
  int patternid = -1;
  
  // Check for a matching pattern in the table
  if (scpd > 0 && checkcpdtable[scpd - 1].pattern.size() <= i) {
    size_t len2 = checkcpdtable[scpd - 1].pattern.size();
    if (st.compare(i - len2, len2, checkcpdtable[scpd - 1].pattern) == 0) {
      matchlen = len2;
      patternid = scpd - 1;
    }
  }
  
  // If a match was found, perform the replacement
  if (patternid >= 0) {
    // Save current state for potential reversion
    if (soldi == 0) {
      soldi = i;
      oldlen = len;
      oldcmin = cmin;
      oldcmax = cmax;
    }
    
    // Replace the matched pattern with its replacement
    st.replace(i - matchlen, matchlen, checkcpdtable[patternid].replacement);
    
    // Update the indices and length parameters to reflect the changes
    i = i - matchlen + checkcpdtable[patternid].replacement.size();
    len = st.size();
    
    // Adjust character minimum and maximum values for further processing
    setcminmax(&cmin, &cmax, st.c_str(), len);
    
    continue;
  }
}