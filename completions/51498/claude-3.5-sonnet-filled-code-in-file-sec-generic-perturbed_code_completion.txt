// Check if there is an active compound pattern processing.
if (!checkcpdtable.empty() && scpd < checkcpdtable.size()) {
  const patentry& pe = checkcpdtable[scpd];
  
  // Find a matching pattern in the compound pattern table
  if (pe.pattern.empty() || (i >= pe.pattern.size() && 
      strncmp(st.c_str() + i - pe.pattern.size(), pe.pattern.c_str(), pe.pattern.size()) == 0)) {
    
    // Replace parts of the string 'st' with new patterns
    if (!pe.pattern2.empty()) {
      st.replace(i - pe.pattern.size(), pe.pattern.size(), pe.pattern2);
      i += pe.pattern2.size() - pe.pattern.size();
    }
    
    // Update indices and length parameters
    len = st.size();
    
    // Adjust character minimum and maximum values
    setcminmax(&cmin, &cmax, st.c_str(), len);
    
    // Save current position for possible rollback
    soldi = i;
    oldlen = len;
    oldcmin = cmin;
    oldcmax = cmax;
  }
}