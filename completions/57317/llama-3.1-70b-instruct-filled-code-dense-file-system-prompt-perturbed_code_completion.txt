_captured, reader_thread->array_index,
	      header->len, (l4_ptr - packet) + sizeof(struct ndpi_udphdr));
      return;
    }
    udp = (struct ndpi_udphdr *)l4_ptr;
    flow.src_port = ntohs(udp->source);
    flow.dst_port = ntohs(udp->dest);
  } else {
    fprintf(stderr, "[%8llu, %d] Non TCP/UDP protocol detected: 0x%X\n",
	    workflow->packets_captured, reader_thread->array_index, flow.l4_protocol);
    return;
  }

  flow.packet_num = workflow->packets_captured;
  flow.packet_cnt = 1;
  flow.packet_cnt_total = 1;
  flow.packet_direction = 0;
  flow.packet_timestamp = time_ms;
  flow.packet_timestamp_end = time_ms;
  flow.packet_gap = 0;
  flow.packet_gap_timestamp = 0;
  flow.packet_gap_timestamp_end = 0;
  flow.packet_gap_cnt = 0;
  flow.packet_gap_cnt_total = 0;
  flow.packet_gap_direction = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap_direction_timestamp = 0;
  flow.packet_gap_direction_timestamp_end = 0;
  flow.packet_gap_direction_cnt_total = 0;
  flow.packet_gap_direction_cnt = 0;
  flow.packet_gap