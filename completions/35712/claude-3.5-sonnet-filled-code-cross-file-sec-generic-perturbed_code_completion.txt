CASE(OP_EXT1, Z) {
  FETCH_Z();
  switch (insn) {
    CASE(OP_ANDN, BB) {
      regs[a] = mrb_integer_value(mrb_integer(regs[a]) & ~mrb_integer(regs[a+1]));
      NEXT;
    }
    CASE(OP_ORN, BB) {
      regs[a] = mrb_integer_value(mrb_integer(regs[a]) | ~mrb_integer(regs[a+1]));
      NEXT;
    }
    CASE(OP_XNOR, BB) {
      regs[a] = mrb_integer_value(~(mrb_integer(regs[a]) ^ mrb_integer(regs[a+1])));
      NEXT;
    }
    default:
      mrb_raisef(mrb, E_RUNTIME_ERROR, "Unknown OP_EXT1 instruction: %S", mrb_fixnum_value(insn));
  }
  pc--;
  NEXT;
}

CASE(OP_EXT2, Z) {
  FETCH_Z();
  switch (insn) {
    CASE(OP_BYTE, BB) {
      regs[a] = mrb_fixnum_value((mrb_int)((uint8_t)mrb_integer(regs[a+1])));
      NEXT;
    }
    CASE(OP_WORD, BB) {
      regs[a] = mrb_fixnum_value((mrb_int)((uint16_t)mrb_integer(regs[a+1])));
      NEXT;
    }
    default:
      mrb_raisef(mrb, E_RUNTIME_ERROR, "Unknown OP_EXT2 instruction: %S", mrb_fixnum_value(insn));
  }
  pc--;
  NEXT;
}

CASE(OP_EXT3, Z) {
  FETCH_Z();
  switch (insn) {
    CASE(OP_FORMAT, BBB) {
      mrb_value format = regs[b];
      mrb_value arg = regs[b+1];
      regs[a] = mrb_format(mrb, RSTRING_PTR(format), arg);
      NEXT;
    }
    CASE(OP_GETBV, BB) {
      mrb_value v = mrb_vm_special_get(mrb, syms[b]);
      regs[a] = mrb_bool_value(mrb_test(v));
      NEXT;
    }
    default:
      mrb_raisef(mrb, E_RUNTIME_ERROR, "Unknown OP_EXT3 instruction: %S", mrb_fixnum_value(insn));
  }
  pc--;
  NEXT;
}