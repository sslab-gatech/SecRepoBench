ary = regs[a];
      mrb_value v = mrb_ary_new_from_values(mrb, b, &regs[a+1]);
      ary = mrb_ary_plus(mrb, ary, v);
      regs[a] = ary;
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_ARYPUSH, BB) {
      mrb_value ary = regs[a];
      mrb_ary_push(mrb, ary, regs[a+1]);
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_ARYUNSHIFT, BB) {
      mrb_value ary = regs[a];
      mrb_ary_unshift(mrb, ary, regs[a+1]);
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_HASH, BB) {
      mrb_value v = mrb_hash_new_with_size(mrb, b);
      regs[a] = v;
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_HASH2, BBB) {
      mrb_value v = mrb_hash_new_with_size(mrb, c);
      regs[a] = v;
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_HASHSET, BBB) {
      mrb_hash_set(mrb, regs[a], regs[b], regs[b+1]);
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_HASHDELETE, B) {
      mrb_hash_delete(mrb, regs[a], regs[a+1]);
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_HASHCLEAR, B) {
      mrb_hash_clear(mrb, regs[a]);
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_HASHKEYP, BB) {
      if (mrb_hash_has_key(mrb, regs[a], regs[b])) {
        SET_TRUE_VALUE(regs[a]);
      }
      else {
        SET_FALSE_VALUE(regs[a]);
      }
      NEXT;
    }

    CASE(OP_HASHSIZE, B) {
      SET_INT_VALUE(mrb, regs[a], mrb_hash_size(mrb, regs[a]));
      NEXT;
    }

    CASE(OP_HASHEMPTYP, B) {
      SET_BOOL_VALUE(regs[a], mrb_hash_empty_p(mrb, regs[a]));
      NEXT;
    }

    CASE(OP_STRCAT, B) {
      mrb_value str = regs[a];
      mrb_value v = regs[a+1];
      if (mrb_str_p(str) && mrb_str_p(v)) {
        str = mrb_str_plus(mrb, str, v);
      }
      else {
        str = mrb_str_new_lit(mrb, "");
        str = mrb_str_plus(mrb, str, regs[a]);
        str = mrb_str_plus(mrb, str, regs[a+1]);
      }
      regs[a] = str;
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_STRCAT2, BB) {
      mrb_value str = regs[a];
      mrb_value v = mrb_ary_new_from_values(mrb, b, &regs[a+1]);
      if (mrb_str_p(str) && mrb_ary_p(v)) {
        str = mrb_str_plus(mrb, str, v);
      }
      else {
        str = mrb_str_new_lit(mrb, "");
        str = mrb_str_plus(mrb, str, regs[a]);
        str = mrb_str_plus(mrb, str, v);
      }
      regs[a] = str;
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_STRCAT3, BBB) {
      mrb_value str = regs[a];
      mrb_value v1 = mrb_ary_new_from_values(mrb, c, &regs[b]);
      mrb_value v2 = mrb_ary_new_from_values(mrb, c, &regs[b+c]);
      if (mrb_str_p(str) && mrb_ary_p(v1)) {
        str = mrb_str_plus(mrb, str, v1);
      }
      else {
        str = mrb_str_new_lit(mrb, "");
        str = mrb_str_plus(mrb, str, regs[a]);
        str = mrb_str_plus(mrb, str, v1);
      }
      if (mrb_ary_p(v2)) {
        str = mrb_str_plus(mrb, str, v2);
      }
      regs[a] = str;
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_STRCAT4, BBB) {
      mrb_value str = regs[a];
      mrb_value v1 = mrb_ary_new_from_values(mrb, c, &regs[b]);
      mrb_value v2 = mrb_ary_new_from_values(mrb, c, &regs[b+c]);
      mrb_value v3 = mrb_ary_new_from_values(mrb, c, &regs[b+2*c]);
      if (mrb_str_p(str) && mrb_ary_p(v1)) {
        str = mrb_str_plus(mrb, str, v1);
      }
      else {
        str = mrb_str_new_lit(mrb, "");
        str = mrb_str_plus(mrb, str, regs[a]);
        str = mrb_str_plus(mrb, str, v1);
      }
      if (mrb_ary_p(v2)) {
        str = mrb_str_plus(mrb, str, v2);
      }
      if (mrb_ary_p(v3)) {
        str = mrb_str_plus(mrb, str, v3);
      }
      regs[a] = str;
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_STRCAT5, BBB) {
      mrb_value str = regs[a];
      mrb_value v1 = mrb_ary_new_from_values(mrb, c, &regs[b]);
      mrb_value v2 = mrb_ary_new_from_values(mrb, c, &regs[b+c]);
      mrb_value v3 = mrb_ary_new_from_values(mrb, c, &regs[b+2*c]);
      mrb_value v4 = mrb_ary_new_from_values(mrb, c, &regs[b+3*c]);
      if (mrb_str_p(str) && mrb_ary_p(v1)) {
        str = mrb_str_plus(mrb, str, v1);
      }
      else {
        str = mrb_str_new_lit(mrb, "");
        str = mrb_str_plus(mrb, str, regs[a]);
        str = mrb_str_plus(mrb, str, v1);
      }
      if (mrb_ary_p(v2)) {
        str = mrb_str_plus(mrb, str, v2);
      }
      if (mrb_ary_p(v3)) {
        str = mrb_str_plus(mrb, str, v3);
      }
      if (mrb_ary_p(v4)) {
        str = mrb_str_plus(mrb, str, v4);
      }
      regs[a] = str;
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_STRCAT6, BBB) {
      mrb_value str = regs[a];
      mrb_value v1 = mrb_ary_new_from_values(mrb, c, &regs[b]);
      mrb_value v2 = mrb_ary_new_from_values(mrb, c, &regs[b+c]);
      mrb_value v3 = mrb_ary_new_from_values(mrb, c, &regs[b+2*c]);
      mrb_value v4 = mrb_ary_new_from_values(mrb, c, &regs[b+3*c]);
      mrb_value v5 = mrb_ary_new_from_values(mrb, c, &regs[b+4*c]);
      if (mrb_str_p(str) && mrb_ary_p(v1)) {
        str = mrb_str_plus(mrb, str, v1);
      }
      else {
        str = mrb_str_new_lit(mrb, "");
        str = mrb_str_plus(mrb, str, regs[a]);
        str = mrb_str_plus(mrb, str, v1);
      }
      if (mrb_ary_p(v2)) {
        str = mrb_str_plus(mrb, str, v2);
      }
      if (mrb_ary_p(v3)) {
        str = mrb_str_plus(mrb, str, v3);
      }
      if (mrb_ary_p(v4)) {
        str = mrb_str_plus(mrb, str, v4);
      }
      if (mrb_ary_p(v5)) {
        str = mrb_str_plus(mrb, str, v5);
      }
      regs[a] = str;
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_STRCAT7, BBB) {
      mrb_value str = regs[a];
      mrb_value v1 = mrb_ary_new_from_values(mrb, c, &regs[b]);
      mrb_value v2 = mrb_ary_new_from_values(mrb, c, &regs[b+c]);
      mrb_value v3 = mrb_ary_new_from_values(mrb, c, &regs[b+2*c]);
      mrb_value v4 = mrb_ary_new_from_values(mrb, c, &regs[b+3*c]);
      mrb_value v5 = mrb_ary_new_from_values(mrb, c, &regs[b+4*c]);
      mrb_value v6 = mrb_ary_new_from_values(mrb, c, &regs[b+5*c]);
      if (mrb_str_p(str) && mrb_ary_p(v1)) {
        str = mrb_str_plus(mrb, str, v1);
      }
      else {
        str = mrb_str_new_lit(mrb, "");
        str = mrb_str_plus(mrb, str, regs[a]);
        str = mrb_str_plus(mrb, str, v1);
      }
      if (mrb_ary_p(v2)) {
        str = mrb_str_plus(mrb, str, v2);
      }
      if (mrb_ary_p(v3)) {
        str = mrb_str_plus(mrb, str, v3);
      }
      if (mrb_ary_p(v4)) {
        str = mrb_str_plus(mrb, str,