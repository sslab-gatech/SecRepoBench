CASE(OP_EXT1, Z) {
  uint8_t ext_opcode;
  FETCH_B(ext_opcode);
  pc--;
  switch (ext_opcode) {
    CASE(OP_EXT1_SEND, BBB) {
      mrb_value recv = regs[a];
      mrb_sym mid = syms[b];
      mrb_int argc = c;
      mrb_value *argv = &regs[a+1];
      mrb_value blk = mrb_nil_value();
      if (argc < CALL_MAXARGS) {
        blk = regs[a+argc+1];
      }
      return mrb_funcall_with_block(mrb, recv, mid, argc, argv, blk);
    }
    CASE(OP_EXT1_SENDB, BBB) {
      mrb_value recv = regs[a];
      mrb_sym mid = syms[b];
      mrb_int argc = c;
      mrb_value *argv = &regs[a+1];
      mrb_value blk = regs[a+argc+1];
      return mrb_funcall_with_block(mrb, recv, mid, argc, argv, blk);
    }
    default:
      mrb_raise(mrb, E_NOTIMP_ERROR, "unsupported extended opcode");
  }
  pc++;
  NEXT;
}

CASE(OP_EXT2, Z) {
  uint16_t ext_opcode;
  FETCH_W(ext_opcode);
  pc -= 2;
  switch (ext_opcode) {
    // Add extended opcode cases here
    default:
      mrb_raise(mrb, E_NOTIMP_ERROR, "unsupported extended opcode");
  }
  pc += 2;
  NEXT;
}

CASE(OP_EXT3, Z) {
  uint32_t ext_opcode;
  FETCH_L(ext_opcode);
  pc -= 4;
  switch (ext_opcode) {
    // Add extended opcode cases here
    default:
      mrb_raise(mrb, E_NOTIMP_ERROR, "unsupported extended opcode");
  }
  pc += 4;
  NEXT;
}