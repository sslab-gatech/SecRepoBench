CASE(OP_EXT1, B) {
  FETCH_B();
  switch (instruction) {
    CASE(EXT_OP1, B): {
      // Handle extended opcode EXT_OP1
      mrb_value value = mrb_ary_ref(mrb, regs[b], a);
      regs[a] = value;
      pc--; // Adjust program counter for the additional byte read
      NEXT;
    }
    CASE(EXT_OP2, B): {
      // Handle extended opcode EXT_OP2
      mrb_value result = mrb_str_plus(mrb, regs[a], regs[b]);
      regs[a] = result;
      pc--; // Adjust program counter for the additional byte read
      NEXT;
    }
    default:
      mrb_value exc = mrb_exc_new_lit(mrb, E_NOTIMP_ERROR, "Unknown extended opcode");
      mrb_exc_set(mrb, exc);
      goto L_RAISE;
  }
}

CASE(OP_EXT2, B) {
  FETCH_B();
  switch (instruction) {
    CASE(EXT_OP3, B): {
      // Handle extended opcode EXT_OP3
      mrb_int len = pool[b].tt >> 2;
      mrb_value str = mrb_str_new(mrb, pool[b].u.str, len);
      regs[a] = str;
      pc--; // Adjust program counter for the additional byte read
      NEXT;
    }
    CASE(EXT_OP4, B): {
      // Handle extended opcode EXT_OP4
      struct RClass *cls = mrb_class_ptr(regs[a]);
      mrb_value super = regs[b];
      cls = mrb_vm_define_class(mrb, mrb_obj_value(cls), super, syms[b]);
      regs[a] = mrb_obj_value(cls);
      pc--; // Adjust program counter for the additional byte read
      NEXT;
    }
    default:
      mrb_value exc = mrb_exc_new_lit(mrb, E_NOTIMP_ERROR, "Unknown extended opcode");
      mrb_exc_set(mrb, exc);
      goto L_RAISE;
  }
}

CASE(OP_EXT3, B) {
  FETCH_B();
  switch (instruction) {
    CASE(EXT_OP5, B): {
      // Handle extended opcode EXT_OP5
      mrb_value recv = regs[a];
      struct RProc *p = mrb_proc_ptr(regs[b]);
      p->flags |= MRB_PROC_STRICT;
      proc_adjust_upper(p);
      regs[a] = mrb_obj_value(p);
      pc--; // Adjust program counter for the additional byte read
      NEXT;
    }
    CASE(EXT_OP6, B): {
      // Handle extended opcode EXT_OP6
      mrb_value exc = mrb_exc_new_lit(mrb, E_RANGE_ERROR, "Extended opcode overflow");
      mrb_exc_set(mrb, exc);
      goto L_RAISE;
    }
    default:
      mrb_value exc = mrb_exc_new_lit(mrb, E_NOTIMP_ERROR, "Unknown extended opcode");
      mrb_exc_set(mrb, exc);
      goto L_RAISE;
  }
}