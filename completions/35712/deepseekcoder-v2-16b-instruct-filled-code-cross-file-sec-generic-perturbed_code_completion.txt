}

    CASE(OP_HASH, BB) {
      mrb_value v = mrb_hash_new_with_size(mrb, b);
      mrb_hash_set(mrb, v, regs[a], regs[a+1]);
      regs[a] = v;
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_HASH2, BBB) {
      mrb_value v = mrb_hash_new_with_size(mrb, c);
      mrb_hash_set(mrb, v, regs[b], regs[b+1]);
      regs[a] = v;
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_STR, BB) {
      mrb_value v = mrb_str_new_from_values(mrb, b, &regs[a]);
      regs[a] = v;
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_STR2, BBB) {
      mrb_value v = mrb_str_new_from_values(mrb, c, &regs[b]);
      regs[a] = v;
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_SYM, BB) {
      mrb_value v = mrb_symbol_value(syms[b]);
      regs[a] = v;
      mrb_gc_arena_restore(mrb, ai);
      NEXT;
    }

    CASE(OP_TWOARG, BB) {
      regs[a] = regs[a+1];
      regs[a+1] = regs[a+2];
      NEXT;
    }

    CASE(OP_THREEARG, BBB) {
      regs[a] = regs[a+1];
      regs[a+1] = regs[a+2];
      regs[a+2] = regs[a+3];
      NEXT;
    }

    CASE(OP_RESCUE_PUSH, B) {
      mrb_value exc = mrb->exc;

      if (exc && (exc->tt == MRB_TT_BREAK || exc->tt == MRB_TT_EXCEPTION)) {
        regs[a] = exc;
        mrb->exc = NULL;
      }
      else {
        regs[a] = mrb_nil_value();
      }
      NEXT;
    }

    CASE(OP_RESCUE_JUMP, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      NEXT;
    }

    CASE(OP_RESCUE_END, Z) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      NEXT;
    }

    CASE(OP_RESCUE_RETURN, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto NORMAL_RETURN;
    }

    CASE(OP_RESCUE_BREAK, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto L_BREAK;
    }

    CASE(OP_RESCUE_RAISE, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto L_RAISE;
    }

    CASE(OP_RESCUE_RETRY, Z) {
      goto RETRY_TRY_BLOCK;
    }

    CASE(OP_RESCUE_RETRY_PUSH, B) {
      mrb_value exc = mrb->exc;

      if (exc && (exc->tt == MRB_TT_BREAK || exc->tt == MRB_TT_EXCEPTION)) {
        regs[a] = exc;
        mrb->exc = NULL;
      }
      else {
        regs[a] = mrb_nil_value();
      }
      goto RETRY_TRY_BLOCK;
    }

    CASE(OP_RESCUE_RETRY_JUMP, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto RETRY_TRY_BLOCK;
    }

    CASE(OP_RESCUE_RETRY_END, Z) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto RETRY_TRY_BLOCK;
    }

    CASE(OP_RESCUE_RETRY_RETURN, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto NORMAL_RETURN;
    }

    CASE(OP_RESCUE_RETRY_BREAK, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto L_BREAK;
    }

    CASE(OP_RESCUE_RETRY_RAISE, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto L_RAISE;
    }

    CASE(OP_RESCUE_RETRY_RESCUE, BB) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto RETRY_TRY_BLOCK;
    }

    CASE(OP_RESCUE_RETRY_RESCUE_PUSH, B) {
      mrb_value exc = mrb->exc;

      if (exc && (exc->tt == MRB_TT_BREAK || exc->tt == MRB_TT_EXCEPTION)) {
        regs[a] = exc;
        mrb->exc = NULL;
      }
      else {
        regs[a] = mrb_nil_value();
      }
      goto RETRY_TRY_BLOCK;
    }

    CASE(OP_RESCUE_RETRY_RESCUE_JUMP, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto RETRY_TRY_BLOCK;
    }

    CASE(OP_RESCUE_RETRY_RESCUE_END, Z) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto RETRY_TRY_BLOCK;
    }

    CASE(OP_RESCUE_RETRY_RESCUE_RETURN, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto NORMAL_RETURN;
    }

    CASE(OP_RESCUE_RETRY_RESCUE_BREAK, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto L_BREAK;
    }

    CASE(OP_RESCUE_RETRY_RESCUE_RAISE, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto L_RAISE;
    }

    CASE(OP_RESCUE_RETRY_RESCUE_RESCUE, BB) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto RETRY_TRY_BLOCK;
    }

    CASE(OP_RESCUE_RETRY_RESCUE_RESCUE_PUSH, B) {
      mrb_value exc = mrb->exc;

      if (exc && (exc->tt == MRB_TT_BREAK || exc->tt == MRB_TT_EXCEPTION)) {
        regs[a] = exc;
        mrb->exc = NULL;
      }
      else {
        regs[a] = mrb_nil_value();
      }
      goto RETRY_TRY_BLOCK;
    }

    CASE(OP_RESCUE_RETRY_RESCUE_RESCUE_JUMP, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto RETRY_TRY_BLOCK;
    }

    CASE(OP_RESCUE_RETRY_RESCUE_RESCUE_END, Z) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto RETRY_TRY_BLOCK;
    }

    CASE(OP_RESCUE_RETRY_RESCUE_RESCUE_RETURN, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto NORMAL_RETURN;
    }

    CASE(OP_RESCUE_RETRY_RESCUE_RESCUE_BREAK, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        mrb->exc = NULL;
      }
      else {
        mrb->exc = mrb_obj_ptr(exc);
      }
      goto L_BREAK;
    }