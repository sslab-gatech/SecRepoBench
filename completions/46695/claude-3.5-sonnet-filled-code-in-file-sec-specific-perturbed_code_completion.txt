if (encoding != (const char *) NULL)
  {
    if (LocaleCompare(encoding,"UTF-8") == 0)
      encoding_type=FT_ENCODING_UNICODE;
    else
      if (LocaleCompare(encoding,"AdobeCustom") == 0)
        encoding_type=FT_ENCODING_ADOBE_CUSTOM;
      else
        if (LocaleCompare(encoding,"AdobeExpert") == 0)
          encoding_type=FT_ENCODING_ADOBE_EXPERT;
        else
          if (LocaleCompare(encoding,"AdobeStandard") == 0)
            encoding_type=FT_ENCODING_ADOBE_STANDARD;
          else
            if (LocaleCompare(encoding,"AppleRoman") == 0)
              encoding_type=FT_ENCODING_APPLE_ROMAN;
            else
              if (LocaleCompare(encoding,"BIG5") == 0)
                encoding_type=FT_ENCODING_BIG5;
              else
                if (LocaleCompare(encoding,"GB2312") == 0)
                  encoding_type=FT_ENCODING_PRC;
                else
                  if (LocaleCompare(encoding,"Johab") == 0)
                    encoding_type=FT_ENCODING_JOHAB;
                  else
                    if (LocaleCompare(encoding,"MacRoman") == 0)
                      encoding_type=FT_ENCODING_APPLE_ROMAN;
                    else
                      if (LocaleCompare(encoding,"SJIScode") == 0)
                        encoding_type=FT_ENCODING_SJIS;
                      else
                        if (LocaleCompare(encoding,"Symbol") == 0)
                          encoding_type=FT_ENCODING_ADOBE_CUSTOM;
                        else
                          if (LocaleCompare(encoding,"Unicode") == 0)
                            encoding_type=FT_ENCODING_UNICODE;
                          else
                            if (LocaleCompare(encoding,"Wansung") == 0)
                              encoding_type=FT_ENCODING_WANSUNG;
  }
  ft_status=FT_Select_Charmap(face,encoding_type);
  if (ft_status != 0)
  {
    (void) FT_Done_Face(face);
    (void) FT_Done_FreeType(library);
    ThrowFreetypeErrorException("UnableToSetEncoding",ft_status,args.pathname);
    return(MagickFalse);
  }
  resolution.x=DefaultResolution;
  resolution.y=DefaultResolution;
  if (draw_info->density != (char *) NULL)
    {
      GeometryInfo
        geometry_info;

      MagickStatusType
        flags;

      flags=ParseGeometry(draw_info->density,&geometry_info);
      if ((flags & RhoValue) != 0)
        resolution.x=geometry_info.rho;
      resolution.y=resolution.x;
      if ((flags & SigmaValue) != 0)
        resolution.y=geometry_info.sigma;
    }
  ft_status=FT_Set_Char_Size(face,(FT_F26Dot6) (64.0*draw_info->pointsize),
    (FT_F26Dot6) (64.0*draw_info->pointsize),(FT_UInt) resolution.x,
    (FT_UInt) resolution.y);
  if (ft_status != 0)
  {
    (void) FT_Done_Face(face);
    (void) FT_Done_FreeType(library);
    ThrowFreetypeErrorException("UnableToSetPointSize",ft_status,
      args.pathname);
    return(MagickFalse);
  }
  metrics->pixels_per_em.x=face->size->metrics.x_ppem;
  metrics->pixels_per_em.y=face->size->metrics.y_ppem;
  metrics->ascent=(double) face->size->metrics.ascender/64.0;
  metrics->descent=(double) face->size->metrics.descender/64.0;
  metrics->width=0;
  metrics->origin.x=0;
  metrics->origin.y=0;
  metrics->height=(double) face->size->metrics.height/64.0;
  metrics->max_advance=(double) face->size->metrics.max_advance/64.0;
  if (face->size->metrics.ascender == 0)
    metrics->ascent=(double) face->ascender*metrics->pixels_per_em.y/
      face->units_per_EM;
  if (face->size->metrics.descender == 0)
    metrics->descent=(-((double) face->descender)*metrics->pixels_per_em.y/
      face->units_per_EM);
  if (face->size->metrics.height == 0)
    metrics->height=metrics->ascent-metrics->descent;
  metrics->underline_position=face->underline_position*
    (metrics->pixels_per_em.x/face->units_per_EM);
  metrics->underline_thickness=face->underline_thickness*
    (metrics->pixels_per_em.x/face->units_per_EM);
  if ((draw_info->text == (char *) NULL) || (*draw_info->text == '\0') ||
      (face->glyph->advance.x == 0))
    {
      (void) FT_Done_Face(face);
      (void) FT_Done_FreeType(library);
      return(MagickTrue);
    }
  /*
    Compute bounding box.
  */
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(AnnotateEvent,GetMagickModule(),
      "Font %s; pointsize %g",draw_info->font != (char *) NULL ?
      draw_info->font : "none",draw_info->pointsize);
  flags=FT_LOAD_DEFAULT;
  if (draw_info->render == MagickFalse)
    flags=FT_LOAD_NO_BITMAP;
  if (draw_info->text_antialias == MagickFalse)
    flags|=FT_LOAD_TARGET_MONO;
  else
    {
      if (((draw_info->stroke.alpha == TransparentAlpha) ||
           (draw_info->stroke_width == 0.0)) &&
          (draw_info->fill.alpha != TransparentAlpha))
        flags|=FT_LOAD_TARGET_NORMAL;
      else
        if ((draw_info->stroke.alpha != TransparentAlpha) &&
            (draw_info->stroke_width != 0.0))
          flags|=FT_LOAD_TARGET_NORMAL;
        else
          flags|=FT_LOAD_TARGET_LIGHT;
    }
  value=GetImageProperty(img,"type:hinting",exception);
  if ((value != (const char *) NULL) && (LocaleCompare(value,"off") == 0))
    flags|=FT_LOAD_NO_HINTING;
  glyph.id=0;
  glyph.image=NULL;
  last_glyph_id=0;
  origin.x=0;
  origin.y=0;