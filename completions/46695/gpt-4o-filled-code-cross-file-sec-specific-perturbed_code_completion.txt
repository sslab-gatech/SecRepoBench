/*
    Set character size.
  */
  resolution.x=DefaultResolution;
  resolution.y=DefaultResolution;
  if (draw_info->density != (char *) NULL)
    {
      GeometryInfo
        geometry_info;

      MagickStatusType
        flags;

      flags=ParseGeometry(draw_info->density,&geometry_info);
      resolution.x=geometry_info.rho;
      resolution.y=geometry_info.sigma;
      if ((flags & SigmaValue) == 0)
        resolution.y=resolution.x;
    }
  ft_status=FT_Set_Char_Size(face,0,(FT_F26Dot6) (64.0*draw_info->pointsize),
    (FT_UInt) resolution.x,(FT_UInt) resolution.y);
  if (ft_status != 0)
    {
      (void) FT_Done_Face(face);
      (void) FT_Done_FreeType(library);
      ThrowFreetypeErrorException("UnableToSetFontSize",ft_status,
        img->filename);
      return(MagickFalse);
    }
  /*
    Initialize font metrics.
  */
  metrics->ascent=(double) face->size->metrics.ascender/64.0;
  metrics->descent=(double) face->size->metrics.descender/64.0;
  metrics->width=0.0;
  metrics->height=(double) face->size->metrics.height/64.0;
  metrics->max_advance=(double) face->size->metrics.max_advance/64.0;
  if (face->size->metrics.y_ppem > 0)
    {
      metrics->underline_position=(double) face->underline_position*
        face->size->metrics.y_ppem/64.0;
      metrics->underline_thickness=(double) face->underline_thickness*
        face->size->metrics.y_ppem/64.0;
    }
  else
    {
      metrics->underline_position=(double) face->underline_position/64.0;
      metrics->underline_thickness=(double) face->underline_thickness/64.0;
    }
  if (metrics->descent == 0.0)
    metrics->descent=(metrics->ascent+metrics->descent)-metrics->height;
  if (metrics->descent > 0.0)
    metrics->descent=(-metrics->descent);
  if ((img->debug != MagickFalse) && (face->family_name != (char *) NULL) &&
      (face->style_name != (char *) NULL))
    (void) LogMagickEvent(AnnotateEvent,GetMagickModule(),
      "Font %s, style %s, %ld glyphs",face->family_name,face->style_name,
      (long) face->num_glyphs);
  /*
    Render text.
  */
  if ((draw_info->text == (char *) NULL) || (*draw_info->text == '\0') ||
      (face->num_glyphs == 0))
    {
      (void) FT_Done_Face(face);
      (void) FT_Done_FreeType(library);
      return(MagickTrue);
    }
  status=MagickTrue;
  if (draw_info->render != MagickFalse)
    {
      annotate_info=CloneDrawInfo((ImageInfo *) NULL,draw_info);
      annotate_info->affine.sx=1.0;
      annotate_info->affine.rx=0.0;
      annotate_info->affine.ry=0.0;
      annotate_info->affine.sy=1.0;
      annotate_info->affine.tx=0.0;
      annotate_info->affine.ty=0.0;
      if (draw_info->affine.sx != 1.0)
        annotate_info->affine.sx=draw_info->affine.sx;
      if (draw_info->affine.sy != 1.0)
        annotate_info->affine.sy=draw_info->affine.sy;
      if (draw_info->affine.rx != 0.0)
        annotate_info->affine.rx=draw_info->affine.rx;
      if (draw_info->affine.ry != 0.0)
        annotate_info->affine.ry=draw_info->affine.ry;
      if (draw_info->affine.tx != 0.0)
        annotate_info->affine.tx=draw_info->affine.tx;
      if (draw_info->affine.ty != 0.0)
        annotate_info->affine.ty=draw_info->affine.ty;
      status=RenderX11(img,annotate_info,offset,metrics,exception);
      annotate_info=DestroyDrawInfo(annotate_info);
    }
  /*
    Free resources.
  */
  (void) FT_Done_Face(face);
  (void) FT_Done_FreeType(library);
  return(status);