if (ft_status != 0)
    {
      (void) FT_Done_Face(face);
      (void) FT_Done_FreeType(library);
      ThrowFreetypeErrorException("UnableToSetCharmap",ft_status,
        draw_info->font);
      return(MagickFalse);
    }
  value=draw_info->density;
  if (value == (const char *) NULL)
    {
      resolution.x=image->resolution.x;
      resolution.y=image->resolution.y;
    }
  else
    {
      GeometryInfo
        geometry_info;

      MagickStatusType
        flags;

      flags=ParseGeometry(value,&geometry_info);
      resolution.x=geometry_info.rho;
      resolution.y=resolution.x;
      if ((flags & SigmaValue) != 0)
        resolution.y=geometry_info.sigma;
    }
  if (resolution.x == 0.0)
    resolution.x=72.0;
  if (resolution.y == 0.0)
    resolution.y=72.0;
  ft_status=FT_Set_Char_Size(face,0,
    (FT_F26Dot6)(draw_info->pointsize*64.0),
    (FT_F26Dot6)(resolution.x*64.0),(FT_F26Dot6)(resolution.y*64.0));
  if (ft_status != 0)
    {
      (void) FT_Done_Face(face);
      (void) FT_Done_FreeType(library);
      ThrowFreetypeErrorException("UnableToSetFontSize",ft_status,
        draw_info->font);
      return(MagickFalse);
    }
  metrics->ascent=(double) face->size->metrics.ascender/64.0;
  metrics->descent=(double) face->size->metrics.descender/64.0;
  metrics->width=(double) face->size->metrics.max_advance/64.0;
  metrics->height=(double) (face->size->metrics.height)/64.0;
  metrics->max_advance=(double) face->size->metrics.max_advance/64.0;
  metrics->bounds.x1=0.0;
  metrics->bounds.y1=0.0;
  metrics->bounds.x2=0.0;
  metrics->bounds.y2=0.0;
  metrics->origin.x=0.0;
  metrics->origin.y=0.0;
  metrics->underline_position=(double) face->underline_position/64.0;
  metrics->underline_thickness=(double) face->underline_thickness/64.0;
  if (metrics->ascent == 0.0)
    metrics->ascent=1.0;
  if (metrics->descent == 0.0)
    metrics->descent=-1.0;
  if (draw_info->text == (char *) NULL)
    {
      (void) FT_Done_Face(face);
      (void) FT_Done_FreeType(library);
      return(MagickTrue);
    }
  if (face->num_glyphs == 0)
    {
      (void) FT_Done_Face(face);
      (void) FT_Done_FreeType(library);
      return(MagickTrue);
    }
  flags=FT_LOAD_DEFAULT;
  if (draw_info->antialias == MagickFalse)
    flags|=FT_LOAD_MONOCHROME;
  if (draw_info->hint != UndefinedHint)
    {
      if (draw_info->hint == NativeHint)
        flags|=FT_LOAD_NO_HINTING;
      else
        flags|=FT_LOAD_FORCE_AUTOHINT;
    }
  length=strlen(draw_info->text);
  utf8=(unsigned char *) ConvertUTF8(encoding,draw_info->text,&length);
  if (utf8 == (unsigned char *) NULL)
    {
      (void) FT_Done_Face(face);
      (void) FT_Done_FreeType(library);
      return(MagickFalse);
    }
  grapheme=(GraphemeInfo *) NULL;
  (void) ComplexTextLayout(img,draw_info,(const char *) utf8,length,face,flags,
    &grapheme,exception);
  utf8=(unsigned char *) RelinquishMagickMemory(utf8);
  if (grapheme == (GraphemeInfo *) NULL)
    {
      (void) FT_Done_Face(face);
      (void) FT_Done_FreeType(library);
      return(MagickFalse);
    }
  annotate_info=CloneDrawInfo((ImageInfo *) NULL,draw_info);
  (void) FormatLocaleString(annotate_info->primitive,MagickPathExtent,"fill %s",
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw_info->fill.alpha != TransparentAlpha ?
    draw