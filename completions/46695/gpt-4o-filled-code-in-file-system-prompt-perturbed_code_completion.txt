if (ft_status != 0)
    {
      (void) FT_Done_Face(face);
      (void) FT_Done_FreeType(library);
      ThrowFreetypeErrorException("UnableToSelectFontEncoding",ft_status,
        draw_info->font);
      return(MagickFalse);
    }
  if (encoding != (const char *) NULL)
    {
      if (LocaleCompare(encoding,"AdobeCustom") == 0)
        encoding_type=FT_ENCODING_ADOBE_CUSTOM;
      if (LocaleCompare(encoding,"AdobeExpert") == 0)
        encoding_type=FT_ENCODING_ADOBE_EXPERT;
      if (LocaleCompare(encoding,"AdobeStandard") == 0)
        encoding_type=FT_ENCODING_ADOBE_STANDARD;
      if (LocaleCompare(encoding,"AppleRoman") == 0)
        encoding_type=FT_ENCODING_APPLE_ROMAN;
      if (LocaleCompare(encoding,"BIG5") == 0)
        encoding_type=FT_ENCODING_BIG5;
      if (LocaleCompare(encoding,"GB2312") == 0)
        encoding_type=FT_ENCODING_GB2312;
      if (LocaleCompare(encoding,"Johab") == 0)
        encoding_type=FT_ENCODING_JOHAB;
      if (LocaleCompare(encoding,"Latin2") == 0)
        encoding_type=FT_ENCODING_LATIN_2;
      if (LocaleCompare(encoding,"Latin3") == 0)
        encoding_type=FT_ENCODING_LATIN_3;
      if (LocaleCompare(encoding,"Latin4") == 0)
        encoding_type=FT_ENCODING_LATIN_4;
      if (LocaleCompare(encoding,"Latin5") == 0)
        encoding_type=FT_ENCODING_LATIN_5;
      if (LocaleCompare(encoding,"Latin6") == 0)
        encoding_type=FT_ENCODING_LATIN_6;
      if (LocaleCompare(encoding,"Latin7") == 0)
        encoding_type=FT_ENCODING_LATIN_7;
      if (LocaleCompare(encoding,"Latin8") == 0)
        encoding_type=FT_ENCODING_LATIN_8;
      if (LocaleCompare(encoding,"Latin9") == 0)
        encoding_type=FT_ENCODING_LATIN_9;
      if (LocaleCompare(encoding,"Latin10") == 0)
        encoding_type=FT_ENCODING_LATIN_10;
      if (LocaleCompare(encoding,"SJIS") == 0)
        encoding_type=FT_ENCODING_SJIS;
      if (LocaleCompare(encoding,"Unicode") == 0)
        encoding_type=FT_ENCODING_UNICODE;
      if (LocaleCompare(encoding,"Wansung") == 0)
        encoding_type=FT_ENCODING_WANSUNG;
      ft_status=FT_Select_Charmap(face,encoding_type);
      if (ft_status != 0)
        {
          (void) FT_Done_Face(face);
          (void) FT_Done_FreeType(library);
          ThrowFreetypeErrorException("UnableToSelectFontEncoding",ft_status,
            draw_info->font);
          return(MagickFalse);
        }
    }
  resolution.x=DefaultResolution;
  resolution.y=DefaultResolution;
  if (draw_info->density != (char *) NULL)
    {
      GeometryInfo
        geometry_info;

      MagickStatusType
        flags;

      flags=ParseGeometry(draw_info->density,&geometry_info);
      if ((flags & RhoValue) != 0)
        resolution.x=geometry_info.rho;
      resolution.y=resolution.x;
      if ((flags & SigmaValue) != 0)
        resolution.y=geometry_info.sigma;
    }
  ft_status=FT_Set_Char_Size(face,(FT_F26Dot6) (64.0*draw_info->pointsize),
    (FT_F26Dot6) (64.0*draw_info->pointsize),(FT_UInt) resolution.x,(FT_UInt)
    resolution.y);
  if (ft_status != 0)
    {
      (void) FT_Done_Face(face);
      (void) FT_Done_FreeType(library);
      ThrowFreetypeErrorException("UnableToSetFontSize",ft_status,
        draw_info->font);
      return(MagickFalse);
    }
  (void) memset(metrics,0,sizeof(*metrics));
  metrics->pixels_per_em.x=(double) face->size->metrics.x_ppem;
  metrics->pixels_per_em.y=(double) face->size->metrics.y_ppem;
  metrics->ascent=(double) face->size->metrics.ascender/64.0;
  metrics->descent=(double) face->size->metrics.descender/64.0;
  metrics->width=0.0;
  metrics->height=(double) face->size->metrics.height/64.0;
  metrics->max_advance=(double) face->size->metrics.max_advance/64.0;
  metrics->bounds.x1=0.0;
  metrics->bounds.y1=0.0;
  metrics->bounds.x2=0.0;
  metrics->bounds.y2=0.0;
  metrics->origin.x=0.0;
  metrics->origin.y=0.0;
  if (metrics->ascent == 0)
    metrics->ascent=(double) face->bbox.yMax*face->size->metrics.y_ppem/
      face->units_per_EM/64.0;
  if (metrics->descent == 0)
    metrics->descent=(double) face->bbox.yMin*face->size->metrics.y_ppem/
      face->units_per_EM/64.0;
  metrics->underline_position=(double) face->underline_position*
    face->size->metrics.y_ppem/face->units_per_EM/64.0;
  metrics->underline_thickness=(double) face->underline_thickness*
    face->size->metrics.y_ppem/face->units_per_EM/64.0;
  if ((draw_info->text == (char *) NULL) || (*draw_info->text == '\0'))
    {
      (void) FT_Done_Face(face);
      (void) FT_Done_FreeType(library);
      return(MagickTrue);
    }
  if (face->num_glyphs == 0)
    {
      (void) FT_Done_Face(face);
      (void) FT_Done_FreeType(library);
      return(MagickTrue);
    }
  flags=FT_LOAD_NO_BITMAP;
  if (draw_info->text_antialias == MagickFalse)
    flags|=FT_LOAD_TARGET_MONO;
  else
    if (image->storage_class == PseudoClass)
      flags|=FT_LOAD_TARGET_MONO;
    else
      if (image->alpha_trait != UndefinedPixelTrait)
        flags|=FT_LOAD_NO_HINTING;
  if (draw_info->text_antialias == MagickFalse)
    flags|=FT_LOAD_NO_HINTING;
  if (draw_info->decorate != NoDecoration)
    flags|=FT_LOAD_NO_HINTING;
  if (draw_info->interword_spacing != 0.0)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->interline_spacing != 0.0)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->kerning != MagickFalse)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == RightToLeftDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == LeftToRightDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == TopToBottomDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == BottomToTopDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == UndefinedDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == RightToLeftDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == LeftToRightDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == TopToBottomDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == BottomToTopDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == UndefinedDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == RightToLeftDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == LeftToRightDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == TopToBottomDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == BottomToTopDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == UndefinedDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == RightToLeftDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == LeftToRightDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == TopToBottomDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == BottomToTopDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == UndefinedDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == RightToLeftDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == LeftToRightDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == TopToBottomDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == BottomToTopDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == UndefinedDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == RightToLeftDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == LeftToRightDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == TopToBottomDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == BottomToTopDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == UndefinedDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == RightToLeftDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == LeftToRightDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == TopToBottomDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == BottomToTopDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == UndefinedDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == RightToLeftDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == LeftToRightDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == TopToBottomDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == BottomToTopDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == UndefinedDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == RightToLeftDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == LeftToRightDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == TopToBottomDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == BottomToTopDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == UndefinedDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == RightToLeftDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == LeftToRightDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == TopToBottomDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == BottomToTopDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == UndefinedDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == RightToLeftDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == LeftToRightDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == TopToBottomDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == BottomToTopDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == UndefinedDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == RightToLeftDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == LeftToRightDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == TopToBottomDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == BottomToTopDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == UndefinedDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == RightToLeftDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == LeftToRightDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == TopToBottomDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == BottomToTopDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == UndefinedDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == RightToLeftDirection)
    flags|=FT_LOAD_IGNORE_TRANSFORM;
  if (draw_info->direction == LeftToRightDirection)
    flags|=FT_LOAD_IGNOR