// Iterate through the coordinates up to the smaller of coords_length and axisCount.
    for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      coords[i] = map->map(coords[i]);
      map = &StructAfter<SegmentMaps>(*map);
    }

#ifndef HB_NO_VARIATIONS2
    if (version.major >= 2)
    {
      // Allocate an output vector for the transformed coordinates.
      int *output_coords = (int *)alloca(coords_length * sizeof(int));
      memcpy(output_coords, coords, coords_length * sizeof(int));

      // Process the coordinates using variation data.
      hb_var_store_cache_t var_store_cache;
      if (varStore.init_cache(&var_store_cache, this))
      {
        for (unsigned int i = 0; i < effectiveaxiscount; i++)
        {
          unsigned int outerIndex = varIdxMap.get_outer_index(i);
          if (outerIndex != 0xFFFF)
          {
            int delta = varStore.get_delta(&var_store_cache, outerIndex, output_coords, effectiveaxiscount);
            output_coords[i] = coords[i] + roundf(delta);
            output_coords[i] = hb_clamp(output_coords[i], -0x4000, 0x4000);
          }
        }
        varStore.fini_cache(&var_store_cache);
      }

      // Update the original coordinates array with the transformed values.
      memcpy(coords, output_coords, coords_length * sizeof(int));
    }
#endif