for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      coords[i] = map->map (coords[i]);
      map = &StructAfter<SegmentMaps> (*map);
    }
#ifndef HB_NO_VARIATIONS2
    if (version.major >= 2)
    {
      const auto &v2 = * (const avarV2Tail *) map;
      auto varIdxMap = v2.varIdxMap.get ();
      auto varStore = v2.varStore.get ();

      if (!varIdxMap || !varStore) return;

      std::vector<int> mapped_coords (coords, coords + effectiveaxiscount);

      for (unsigned int i = 0; i < effectiveaxiscount; i++)
      {
	int delta = 0;
	if (varIdxMap->map[i] < varStore->deltas.length ())
	{
	  delta = varStore->deltas[varIdxMap->map[i]];
	}
	mapped_coords[i] += roundf (delta);
      }
      memcpy (coords, mapped_coords.data(), sizeof (int) * effectiveaxiscount);
    }
#endif