for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  coords[i] = map->map (coords[i]);
  map = &StructAfter<SegmentMaps> (*map);
}

if (version >= 2)
{
  // Further process using variation data
  if (varIdxMap && varStore)
  {
    int *out = (int *) hb_calloc (effectiveaxiscount, sizeof (int));
    if (unlikely (!out)) return;

    hb_var_store_cache_t *cache = varStore->create_cache ();
    for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      float delta = 0.f;
      unsigned int idx = varIdxMap->get_mapping (i);
      if (idx != HB_OT_LAYOUT_NO_VARIATION_INDEX)
        delta = varStore->get_delta (cache, idx, coords, effectiveaxiscount);

      int v = coords[i] + (int)roundf (delta);
      v = hb_clamp (v, -0x4000, 0x3FFF);
      out[i] = v;
    }
    varStore->destroy_cache (cache);

    for (unsigned int i = 0; i < effectiveaxiscount; i++)
      coords[i] = out[i];

    hb_free (out);
  }
}