for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      coords[i] = map->map (coords[i]);
      map = &StructAfter<SegmentMaps> (*map);
    }

    if (version >= 2)
    {
      hb_vector_t<int> output;
      if (unlikely (!output.resize (effectiveaxiscount))) return;

      const auto &varidx_map = StructAfter<VarIdxMap> (*map);
      const auto &var_store = StructAfter<VariationStore> (varidx_map);

      for (unsigned int i = 0; i < effectiveaxiscount; i++)
      {
        int varidx = varidx_map.get_varidx (i);
        float delta = var_store.get_delta (varidx, coords, coords_length);
        int adjusted = coords[i] + (int) hb_roundf (delta);
        adjusted = hb_clamp (adjusted, -0x7FFFFFFF, 0x7FFFFFFF);
        output[i] = adjusted;
      }

      memcpy (coords, output.arrayZ, effectiveaxiscount * sizeof (int));
      var_store.destroy_cache ();
    }