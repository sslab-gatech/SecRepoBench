for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      coords[i] = map->map (coords[i]);
      map = &StructAfter<SegmentMaps> (*map);
    }

    if (version < 2) return;

    unsigned int axis_count = axes.get_len ();
    int *output = (int *) hb_calloc (axis_count, sizeof (int));
    if (unlikely (!output)) return;

    for (unsigned int i = 0; i < axis_count; i++)
    {
      float delta = 0.f;
      const VariationAxisRecord &axis = axes[i];
      if (axis.has_variation_index_map ())
      {
	unsigned int variation_index = axis.get_variation_index_map ()->map (coords[i]);
	delta = axis.get_variation_store ()->get_delta (variation_index);
      }
      else
      {
	delta = axis.get_variation_store ()->get_delta (coords[i]);
      }

      output[i] = coords[i] + roundf (delta);
      output[i] = hb_clamp (output[i], axis.get_min_value (), axis.get_max_value ());
    }

    variation_store_cache.destroy ();

    memcpy (coords, output, axis_count * sizeof (coords[0]));
    hb_free (output);