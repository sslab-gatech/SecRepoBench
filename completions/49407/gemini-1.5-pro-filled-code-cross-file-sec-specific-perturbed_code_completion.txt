for (unsigned int i = 0; i < effectiveaxiscount; ++i)
    {
      coords[i] = map->map_coord (coords[i]);
      ++map;
    }

    if (version >= 2)
    {
      std::vector<int> output (coords_length);

      const VariationData *variation_data = font->get_variation_data ();
      const hb_array_t<const HBUINT8> &item_variation_store = variation_data->item_variation_store;
      const hb_array_t<HBUINT16> &item_variation_index_map = variation_data->item_variation_index_map;
      unsigned int item_variation_store_size = item_variation_store.get_size ();

      map = &firstAxisSegmentMaps;
      for (unsigned int i = 0; i < effectiveaxiscount; ++i)
      {
        float delta = 0;
        unsigned int index = map->fvar_index;
        if (index < item_variation_index_map.len)
        {
          index = item_variation_index_map[index];
          if (index < item_variation_store_size)
          {
            const F16DOT16 *variation_store_item = reinterpret_cast<const F16DOT16 *> (&item_variation_store[index]);
            delta = *variation_store_item;
          }
        }
        int rounded_delta = roundf (delta);
        output[i] = clamp (coords[i] + rounded_delta, 0, 16383);
        ++map;
      }

      for (unsigned int i = 0; i < coords_length; ++i)
      {
        coords[i] = output[i];
      }
    }