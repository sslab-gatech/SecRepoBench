for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  coords[i] = map->map(coords[i]);
  map = &StructAfter<SegmentMaps> (*map);
}

if (version >= 2)
{
  hb_vector_t<int> output;
  output.reserve(effectiveaxiscount);

  VariationStoreCache variationStoreCache;
  variationStoreCache.allocate();

  for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    unsigned int variationIndex = variationIndexMap[i];
    float variationValue = variationStoreCache.get(variationIndex);
    int delta = round(variationValue * 1000.0f);
    int transformedCoord = coords[i] + delta;
    transformedCoord = hb_clamp(transformedCoord, minValue, maxValue);
    output.push_back(transformedCoord);
  }

  variationStoreCache.deallocate();

  for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    coords[i] = output[i];
  }
}