for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  coords[i] = map->map (coords[i]);
  map = &StructAfter<SegmentMaps> (*map);
}

if (version >= 2)
{
  hb_vector_t<int> output_coords;
  if (!output_coords.alloc (effectiveaxiscount))
    return;

  const VariationIndexMap *varIdxMap = &variationIndexMap;
  for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    unsigned int variationIndex = varIdxMap->x_get_item (i);
    HBFixed delta = HBFixed::ONE;
    if (variationIndex != 0xFFFF)
    {
      VariationStoreCache *vstore_cache = nullptr;
      delta = get_delta (variationIndex, vstore_cache);
      if (vstore_cache) vstore_cache->destroy ();
    }

    int adjustedCoord = coords[i] + delta.round ();
    if (adjustedCoord > HB_OT Variation_MaxValue) adjustedCoord = HB_OT Variation_MaxValue;
    else if (adjustedCoord < HB_OT Variation_MinValue) adjustedCoord = HB_OT Variation_MinValue;

    output_coords[i] = adjustedCoord;
    varIdxMap = &StructAfter<VariationIndexMap> (*varIdxMap);
  }

  for (unsigned int i = 0; i < effectiveaxiscount; i++)
    coords[i] = output_coords[i];

  output_coords.fini ();
}