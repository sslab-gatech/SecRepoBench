for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  coords[i] = map->map (coords[i]);
  map = &StructAfter<SegmentMaps> (*map);
}

if (version >= 2)
{
  // Prepare variation store/cache as needed
  VariationStoreCache cache;
  cache.init (face, variationStoreOffset);

  int *transformed_coords = (int *) hb_calloc (effectiveaxiscount, sizeof (int));
  if (likely (transformed_coords))
  {
    // Apply variation-based delta adjustments
    for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      VariationIndex var_idx = variationIndexMap[i];
      int delta = cache.get_delta (var_idx, coords[i]);
      int adjusted = coords[i] + hb_round (delta);

      // Clamp to acceptable range
      if (adjusted < MIN_COORD) adjusted = MIN_COORD;
      if (adjusted > MAX_COORD) adjusted = MAX_COORD;

      transformed_coords[i] = adjusted;
    }

    // Update original coords
    for (unsigned int i = 0; i < effectiveaxiscount; i++)
      coords[i] = transformed_coords[i];

    hb_free (transformed_coords);
  }

  cache.fini ();
}