for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  coords[i] = map->map(coords[i]);
  map = &StructAfter<SegmentMaps>(*map);
}

if (version >= 2)
{
  unsigned int i;
  int *transformed = (int *) calloc(effectiveaxiscount, sizeof(int));
  if (!transformed)
    return; /* Allocation failure: bail out */

  VariationStoreCache *cache = init_variation_store_cache(variationStore);

  for (i = 0; i < effectiveaxiscount; i++)
  {
    int delta = compute_variation_delta(variationIndexMap[i], variationStore, cache);
    int rounded_delta = (int)round(delta);
    int new_coord = coords[i] + rounded_delta;

    if (new_coord < minCoord)
      new_coord = minCoord;
    else if (new_coord > maxCoord)
      new_coord = maxCoord;

    transformed[i] = new_coord;
  }

  free_variation_store_cache(cache);

  for (i = 0; i < effectiveaxiscount; i++)
    coords[i] = transformed[i];

  free(transformed);
}