for (unsigned int i = 0; i < effectiveaxiscount; ++i) {
  coords[i] = map->apply (coords[i]);
  map++;
}

if (version >= 2) {
  float *output = new float[coords_length];
  VariationStoreCache cache;
  VariationIndexMap *varidxmap = &firstVariationIndexMap;
  VariationStore *varstore = &firstVariationStore;

  for (unsigned int i = 0; i < coords_length; ++i) {
    float delta = varidxmap->getDelta (varstore, coords[i]);
    output[i] = hb_clamp (coords[i] + roundf (delta), min, max);
    varidxmap++;
  }

  delete[] coords;
  coords = new int[coords_length];
  for (unsigned int i = 0; i < coords_length; ++i) {
    coords[i] = output[i];
  }
  delete[] output;
  cache.deallocate ();
}