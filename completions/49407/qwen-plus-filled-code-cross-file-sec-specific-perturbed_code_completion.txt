for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  coords[i] = map->map (coords[i]);
  map = &StructAfter<SegmentMaps> (*map);
}

if (version >= 2)
{
  hb_vector_t<int> transformed_coords;
  if (unlikely (!transformed_coords.alloc (effectiveaxiscount)))
    return;

  const VariationIndexMap *variation_index_map = &varIdxMap;
  for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    float delta = 0.0f;
    unsigned variation_index = variation_index_map->getVariationIndex(i);
    if (variation_index != 0xFFFFu)
    {
      delta = varStore->computeDelta(variation_index, coords[i]);
    }
    transformed_coords[i] = hb_roundf(coords[i] + delta);
    transformed_coords[i] = hb_max(hb_min(transformed_coords[i], 32767), -32768); // Clamp to range
    variation_index_map = &StructAfter<VariationIndexMap>(*variation_index_map);
  }

  varStore_cache.destroy (); // Deallocate variation store cache

  for (unsigned int i = 0; i < effectiveaxiscount; i++)
    coords[i] = transformed_coords[i];
}