for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  coords[i] = map->map (coords[i]);
  map = &StructAfter<SegmentMaps> (*map);
}

#ifndef HB_NO_VARIATIONS2
if (version.major >= 2)
{
  const auto &v2 = * (const avarV2Tail *) map;
  
  hb_vector_t<int> out;
  if (unlikely (!out.resize (effectiveaxiscount)))
    return;
  
  hb_hashmap_t<unsigned, float> cache;
  
  for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    unsigned varidx = (this+v2.varIdxMap).map (i);
    float delta = (this+v2.varStore).get_delta (varidx, coords, effectiveaxiscount, cache);
    out[i] = roundf (coords[i] + delta);
  }
  
  for (unsigned int i = 0; i < effectiveaxiscount; i++)
    coords[i] = out[i];
  
  cache.fini ();
}
#endif