for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  coords[i] = map->map (coords[i]);
  map = &StructAfter<SegmentMaps> (*map);
}

if (version >= 2)
{
  hb_vector_t<int> out_coords;
  if (unlikely (!out_coords.resize (coords_length))) return;

  for (unsigned int i = 0; i < coords_length; i++)
  {
    uint32_t varidx = varidx_map[i];
    float delta = varStore->get_delta (varidx, coords, coords_length);
    int rounded = roundf (delta);
    out_coords[i] = hb_clamp (coords[i] + rounded, -0x7FFF, 0x7FFF);
  }

  varStore->destroy_cache ();
  memcpy (coords, out_coords.arrayZ, coords_length * sizeof (int));
}