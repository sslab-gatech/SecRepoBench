for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      coords[i] = map->map (coords[i]);
      map = &StructAfter<SegmentMaps> (*map);
    }

#ifndef HB_NO_VARIATIONS2
    if (version.major >= 2)
    {
      const auto &v2 = * (const avarV2Tail *) map;
      auto varIdxMap = v2.varIdxMap.get ();
      auto varStore = v2.varStore.get ();

      std::vector<int> mapped_coords (coords_length);
      for (unsigned int i = 0; i < effectiveaxiscount; i++)
      {
	int delta = 0;
	if (varIdxMap && varStore)
	{
	  unsigned int varIdx = varIdxMap->map (i);
	  if (varIdx < varStore->deltas.len)
	    delta = varStore->deltas.arrayZ[varIdx].get_value ();
	}
	mapped_coords[i] = coords[i] + roundf (delta);
      }
      memcpy (coords, mapped_coords.data (), sizeof (int) * coords_length);
    }
#endif