if (version.major < 2)
{
  unsigned int count = effectiveaxiscount;
  const SegmentMaps *map = &firstAxisSegmentMaps;
  for (unsigned int i = 0; i < count; i++)
  {
    coords[i] = map->map (coords[i]);
    map = &StructAfter<SegmentMaps> (*map);
  }
}
else
{
  const auto &v2 = * (const avarV2Tail *) (&firstAxisSegmentMaps + axisCount);
  const DeltaSetIndexMap &varIdxMap = v2.varIdxMap;
  const VariationStore &varStore = v2.varStore;

  std::vector<int> out_coords (effectiveaxiscount);
  for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    int delta = 0;
    if (varIdxMap.get_delta (coords[i], &delta))
    {
      int new_coord = coords[i] + roundf (delta);
      new_coord = hb_clamp (new_coord, -1 * 0x10000, 0x10000);
      out_coords[i] = new_coord;
    }
    else
    {
      out_coords[i] = coords[i];
    }
  }
  varStore.cache_dealloc ();
  for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    coords[i] = out_coords[i];
  }
}