for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  coords[i] = map->map(coords[i]);
  map = &StructAfter<SegmentMaps>(*map);
}

if (version >= 2)
{
  hb_vector_t<int> transformed_coords;
  if (unlikely(!transformed_coords.alloc(effectiveaxiscount)))
    return;

  const VariationIndexMap* variation_index_map = &firstVariationIndexMap;
  for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    unsigned int variation_index = variation_index_map->getVariationIndex();
    float delta = getDeltaFromVariationStore(variation_index, coords[i]);
    transformed_coords[i] = round(coords[i] + delta);

    // Clamp the result to the specified range
    transformed_coords[i] = hb_max(hb_min(transformed_coords[i], MAX_COORD), MIN_COORD);

    variation_index_map = &StructAfter<VariationIndexMap>(*variation_index_map);
  }

  // Deallocate variation store cache if necessary
  freeVariationStoreCache();

  // Update the original coordinates array with the transformed values
  for (unsigned int i = 0; i < effectiveaxiscount; i++)
    coords[i] = transformed_coords[i];
}