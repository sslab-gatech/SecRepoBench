for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  coords[i] = map->map (coords[i]);
  map = &StructAfter<SegmentMaps> (*map);
}

#ifndef HB_NO_VARIATIONS2
if (version.major >= 2)
{
  const auto &v2 = * (const avarV2Tail *) map;
  hb_vector_t<int> output;
  if (unlikely (!output.alloc (effectiveaxiscount)))
    return;

  hb_array_t<const int> input (coords, effectiveaxiscount);
  unsigned int num_output = effectiveaxiscount;

  const DeltaSetIndexMap &index_map = this+v2.varIdxMap;
  const VariationStore &var_store = this+v2.varStore;

  hb_vector_t<int> store_cache;
  if (unlikely (!store_cache.resize (var_store.get_sub_table_count ())))
    return;
  store_cache.push (0);

  for (unsigned int i = 0; i < num_output; i++)
  {
    uint32_t delta = roundf (var_store.get_delta (input, index_map.map (i), store_cache.arrayZ));
    output[i] = hb_clamp (coords[i] + delta, -16384, 16384);
  }

  hb_memcpy (coords, output.arrayZ, effectiveaxiscount * sizeof (coords[0]));
}
#endif