unsigned int effectiveaxiscount = hb_min (coords_length, axisCount);

const SegmentMaps *map = &firstAxisSegmentMaps;
for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  coords[i] = map->map (coords[i]);
  map = &StructAfter<SegmentMaps> (*map);
}

#ifndef HB_NO_VARIATIONS2
if (version.major >= 2)
{
  const auto &v2 = * (const avarV2Tail *) map;
  const auto &varIdxMap = v2.varIdxMap;
  const auto &varStore = v2.varStore;

  hb_vector_t<int> out_coords;
  out_coords.resize (effectiveaxiscount);

  for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    int varIdx = varIdxMap.get_value (i);
    int delta = varStore.get_delta (varIdx, coords[i]);
    out_coords[i] = coords[i] + roundf (delta);
    out_coords[i] = hb_clamp (out_coords[i], -1 * 0x10000, 0x10000);
  }

  for (unsigned int i = 0; i < effectiveaxiscount; i++)
    coords[i] = out_coords[i];
}
#endif