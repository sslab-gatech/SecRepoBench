unsigned int count = hb_min(coords_length, axisCount);

for (unsigned int i = 0; i < count; i++) {
    coords[i] = map->map(coords[i]);
    map = &StructAfter<SegmentMaps>(*map);
}

if (version >= 2) {
    int *output = (int *)hb_calloc(count, sizeof(int));
    if (output) {
        for (unsigned int i = 0; i < count; i++) {
            unsigned int variation_index = variationIndexMap[i];
            int delta = variationStore.get_delta(variation_index);
            int adjusted = coords[i] + HBROUND(delta);
            adjusted = hb_min(adjusted, axisRanges[i].max);
            adjusted = hb_max(adjusted, axisRanges[i].min);
            output[i] = adjusted;
        }
        hb_free(variationStore.cache);
        memcpy(coords, output, count * sizeof(int));
        hb_free(output);
    }
}