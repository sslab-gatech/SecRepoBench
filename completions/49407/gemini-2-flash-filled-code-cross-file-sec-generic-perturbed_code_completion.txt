for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      coords[i] = map->map (coords[i]);
      map = &StructAfter<SegmentMaps> (*map);
    }

    if (likely (face->table.Vary.has_data ()))
    {
      /* We have to do the following:
       *
       *   delta = VariationIndexMap::get_delta (coords)
       *   value += round (delta / scale)
       *   value = clamp (value, min, max)
       */

      unsigned int num_coords = coords_length;
      int *transformed_coords = (int *) hb_alloca (num_coords * sizeof (int));

      VariationStoreCacheRAII variation_store_cache (face);

      for (unsigned int i = 0; i < num_coords; ++i)
      {
        int32_t delta = face->table.Vary->get_value (face, i, coords, effectiveaxiscount);
        transformed_coords[i] = hb_clamp (coords[i] + HB_Div_Round (delta, face->var_scale),
                                           HB_INT16_MIN,
                                           HB_INT16_MAX);
      }

      memcpy (coords, transformed_coords, num_coords * sizeof (int));
    }