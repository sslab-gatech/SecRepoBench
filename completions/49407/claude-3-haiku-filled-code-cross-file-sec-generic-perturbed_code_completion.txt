// <MASK>
for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
    // Apply mapping transformation using the current SegmentMaps object
    map->map_coordinate(&coords[i]);
    map++;
}

if (version >= 2)
{
    std::vector<float> output_coords(effectiveaxiscount);
    for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
        // Apply variation data transformation
        float delta = variation_index_map->get_delta(variation_store, i);
        output_coords[i] = clamp(coords[i] + round(delta), min_coord, max_coord);
    }
    variation_store_cache->deallocate();
    memcpy(coords, output_coords.data(), effectiveaxiscount * sizeof(int));
}