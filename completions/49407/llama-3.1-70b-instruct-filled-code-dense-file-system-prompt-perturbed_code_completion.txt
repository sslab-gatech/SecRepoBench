for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    coords[i] = map->map (coords[i]);
    map = &StructAfter<SegmentMaps> (*map);
  }

if (version >= 2)
  {
    unsigned int count = effectiveaxiscount;
    int *output = (int *) hb_calloc (count, sizeof (int));
    if (unlikely (!output))
      return;

    VariationStoreCache cache;
    VariationIndexMap *varidxmap = &firstAxisVariationIndexMap;
    for (unsigned int i = 0; i < count; i++)
      {
        int delta = varidxmap->get_delta (coords[i], &cache);
        output[i] = coords[i] + hb_round (delta);
        output[i] = hb_clamp (output[i], min_value, max_value);
        varidxmap = &StructAfter<VariationIndexMap> (*varidxmap);
      }

    memcpy (coords, output, count * sizeof (int));
    hb_free (output);
  }