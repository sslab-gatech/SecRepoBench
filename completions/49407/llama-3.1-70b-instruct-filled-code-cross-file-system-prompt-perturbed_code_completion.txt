for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  coords[i] = map->unmap (coords[i]);
  map = &StructAfter<SegmentMaps> (*map);
}

if (version >= 2)
{
  unsigned int variation_store_cache_size = 0;
  const VariationStore *variation_store = get_variation_store (variation_store_cache_size);
  float *variation_store_cache = (float *) hb_malloc (variation_store_cache_size * sizeof (float));
  if (unlikely (!variation_store_cache)) return;

  int *output_coords = (int *) hb_malloc (effectiveaxiscount * sizeof (int));
  if (unlikely (!output_coords))
  {
    hb_free (variation_store_cache);
    return;
  }

  for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    float delta = variation_store->get_delta (coords[i], variation_store_cache);
    output_coords[i] = hb_clamp (coords[i] + hb_round (delta), min_value, max_value);
  }

  hb_free (variation_store_cache);

  for (unsigned int i = 0; i < effectiveaxiscount; i++)
    coords[i] = output_coords[i];

  hb_free (output_coords);
}