for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      coords[i] = map->map (coords[i]);
      map = &StructAfter<SegmentMaps> (*map);
    }

#ifndef HB_NO_VARIATIONS2
    if (version.major < 2)
      return;

    const auto &v2 = * (const avarV2Tail *) map;

    unsigned int count = hb_min (coords_length, v2.varStore.get_axis_count ());
    if (!count) return;

    float *normalized = (float *) hb_calloc (count, sizeof (float));
    if (unlikely (!normalized)) return;

    for (unsigned int i = 0; i < count; i++)
      normalized[i] = coords[i] * (1.f/16384.f);

    hb_vector_t<int> mapped_coords;
    mapped_coords.resize (count);
    if (unlikely (mapped_coords.in_error ()))
    {
      hb_free (normalized);
      return;
    }

    const hb_array_t<const HBUINT16> &axis_indices = v2.varIdxMap->get_axis_indices ();
    for (unsigned int i = 0; i < count; i++)
    {
      float delta;
      if (i < axis_indices.length)
        delta = v2.varStore->get_delta (axis_indices[i], normalized);
      else
        delta = 0.f;

      mapped_coords[i] = coords[i] + roundf (delta * 16384.f);
      mapped_coords[i] = hb_clamp (mapped_coords[i], -16384, 16384);
    }

    hb_free (normalized);

    for (unsigned int i = 0; i < count; i++)
      coords[i] = mapped_coords[i];
#endif