for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      coords[i] = map->map(coords[i]);
      map = &StructAfter<SegmentMaps>(*map);
    }

#ifndef HB_NO_VARIATIONS2
    if (version.major >= 2)
    {
      // Allocate a vector for the output coordinates
      int *output_coords = (int *) malloc(coords_length * sizeof(int));
      if (!output_coords) return; // Handle allocation failure

      // Initialize the variation store cache
      VariationStoreCache cache;
      if (!cache.init(&varStore)) {
        free(output_coords);
        return; // Handle cache initialization failure
      }

      for (unsigned int i = 0; i < effectiveaxiscount; i++)
      {
        // Get the delta value from the variation store
        int delta = cache.get_delta(varIdxMap.get_index(i), coords[i]);
        // Adjust the coordinate by the rounded delta
        output_coords[i] = coords[i] + roundf(delta);
        // Clamp the result to the range [-16384, 16384]
        output_coords[i] = hb_clamp(output_coords[i], -16384, 16384);
      }

      // Deallocate the variation store cache
      cache.fini();

      // Update the original coordinates array with the transformed values
      for (unsigned int i = 0; i < effectiveaxiscount; i++)
      {
        coords[i] = output_coords[i];
      }

      // Free the allocated output vector
      free(output_coords);
    }
#endif