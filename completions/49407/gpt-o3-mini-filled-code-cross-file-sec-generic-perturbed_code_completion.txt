for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    coords[i] = map->map (coords[i]);
    map = &StructAfter<SegmentMaps> (*map);
  }

  if (version >= 2)
  {
    int *out = (int *)malloc(effectiveaxiscount * sizeof(int));
    if (!out)
      return; // Allocation failure; in a real-world scenario consider reporting the error.

    for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      /* Compute a variation delta using the variation index map and the variation store.
         It is assumed that variationStore.get_delta() is a secure function that returns
         a floating point delta for the given index and coordinate value. */
      float delta = variationStore.get_delta(variationIndexMap[i], coords[i]);
      int delta_rounded = (int)roundf(delta);
      int adjusted = coords[i] + delta_rounded;

      /* Clamp the adjusted coordinate to the allowed range [coordMin, coordMax]. */
      if (adjusted < coordMin)
        adjusted = coordMin;
      else if (adjusted > coordMax)
        adjusted = coordMax;

      out[i] = adjusted;
    }

    /* Deallocate any temporary caches within the variation store. */
    variationStore.clear_cache();

    /* Update the original coordinates with the transformed values. */
    for (unsigned int i = 0; i < effectiveaxiscount; i++)
      coords[i] = out[i];

    free(out);
  }