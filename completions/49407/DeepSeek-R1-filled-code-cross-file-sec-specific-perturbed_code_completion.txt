for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  coords[i] = map->map (coords[i]);
  map = &StructAfter<SegmentMaps> (*map);
}

if (version.major >= 2 && varStore)
{
  hb_vector_t<int> out;
  if (out.alloc (effectiveaxiscount))
  {
    for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      unsigned varIdx = varIdxMap[i];
      float delta = varStore->get_delta (varIdx, coords, coords_length, varStoreCache);
      int adjusted = coords[i] + (int) roundf (delta);
      adjusted = hb_clamp (adjusted, HB_OT_VAR_NO_AXIS_INDEX, HB_OT_VAR_AXIS_INDEX_VALUE_MAX);
      out[i] = adjusted;
    }
    memcpy (coords, out.arrayZ, effectiveaxiscount * sizeof (int));
  }
  VariationStore::destroy_cache (varStoreCache);
  varStoreCache = nullptr;
}