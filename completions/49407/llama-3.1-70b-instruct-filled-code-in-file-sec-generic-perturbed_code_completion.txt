if (version.major < 2)
{
  unsigned int count = effectiveaxiscount;
  for (unsigned int i = 0; i < count; i++)
  {
    coords[i] = map->map (coords[i]);
    map = &StructAfter<SegmentMaps> (*map);
  }
}
else
{
  const auto &v2 = * (const avarV2Tail *) map;
  const auto &varIdxMap = v2.varIdxMap;
  const auto &varStore = v2.varStore;

  std::vector<int> out (effectiveaxiscount);
  for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    int delta = varStore.get_delta (varIdxMap.get (i), coords[i]);
    out[i] = coords[i] + roundf (delta);
    out[i] = hb_clamp (out[i], -1.0f * (1 << 16), 1 << 16);
  }
  for (unsigned int i = 0; i < effectiveaxiscount; i++)
    coords[i] = out[i];
}