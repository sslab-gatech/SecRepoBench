for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  coords[i] = map->map (coords[i]);
  map = &StructAfter<SegmentMaps> (*map);
}

if (version.major >= 2)
{
  hb_vector_t<int> out;
  out.alloc (effectiveaxiscount);
  if (unlikely (out.in_error ())) return;

  const VariationStore &var_store = get_var_store ();
  for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    float delta = var_store.get_delta (varIdxMap.get (i), coords, effectiveaxiscount);
    int rounded = roundf (delta);
    int new_coord = coords[i] + rounded;
    new_coord = hb_clamp (new_coord, minValue, maxValue);
    out[i] = new_coord;
  }

  var_store.destroy_cache ();
  memcpy (coords, out.arrayZ, effectiveaxiscount * sizeof (int));
}