std::vector<int> output_coords(effectiveaxiscount);

    for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      coords[i] = map->map(coords[i]);
      map = &StructAfter<SegmentMaps>(*map);
    }

    if (version >= 2)
    {
      VariationStoreCache cache;
      if (!cache.init(variationStore)) return;

      for (unsigned int i = 0; i < effectiveaxiscount; i++)
      {
        int delta = 0;
        if (variationIndexMap)
        {
          unsigned int index = variationIndexMap->getIndex(i);
          delta = cache.getDelta(index);
        }
        output_coords[i] = coords[i] + delta;
        output_coords[i] = hb_clamp(output_coords[i], minCoord, maxCoord);
      }

      cache.fini();
    }
    else
    {
      for (unsigned int i = 0; i < effectiveaxiscount; i++)
      {
        output_coords[i] = coords[i];
      }
    }

    for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      coords[i] = output_coords[i];
    }