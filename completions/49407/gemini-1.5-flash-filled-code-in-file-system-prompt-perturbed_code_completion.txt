for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      coords[i] = map->map (coords[i]);
      map = &StructAfter<SegmentMaps> (*map);
    }

#ifndef HB_NO_VARIATIONS2
    if (version.major >= 2)
    {
      const auto &v2 = * (const avarV2Tail *) map;
      auto varIdxMap = v2.varIdxMap.get ();
      auto varStore = v2.varStore.get ();

      if (!varIdxMap || !varStore) return;

      std::vector<int> out_coords (coords_length);
      for (unsigned int i = 0; i < effectiveaxiscount; i++)
      {
	int delta = 0;
	unsigned int varIdx = varIdxMap->get (i);
	if (varIdx < varStore->deltas.length ())
	  delta = varStore->deltas[varIdx];
	out_coords[i] = coords[i] + roundf (delta);
      }
      memcpy (coords, out_coords.data (), sizeof (int) * coords_length);
    }
#endif
  }