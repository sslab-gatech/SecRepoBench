unsigned int count = hb_min(coords_length, axisCount);
    for (unsigned int i = 0; i < count; i++) {
        int mapped_value = map->map(coords[i]);
        coords[i] = mapped_value;
        map = &StructAfter<SegmentMaps>(*map);
    }

    if (version.major >= 2) {
        // Allocate an output vector for the transformed coordinates.
        std::vector<int> transformed_coords(coords_length);

        // For each coordinate, apply an additional transformation involving a variation index map and a variation store.
        for (unsigned int i = 0; i < count; i++) {
            int mapped_value = map->map(coords[i]);
            int delta = v2.varIdxMap.get_value(mapped_value) + v2.varStore.get_value(mapped_value);
            transformed_coords[i] = clamp(mapped_value + round(delta), min_value, max_value);
            map = &StructAfter<SegmentMaps>(*map);
        }

        // Update the original coordinates array with the transformed values from the output vector.
        std::copy(transformed_coords.begin(), transformed_coords.end(), coords);
    }