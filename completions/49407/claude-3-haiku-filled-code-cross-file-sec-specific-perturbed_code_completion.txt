for (unsigned int i = 0; i < effectiveaxiscount; i++)
{
  map->map_coordinate (&coords[i]);
  map++;
}

if (version >= 2)
{
  std::vector<float> output_coords(effectiveaxiscount);
  for (unsigned int i = 0; i < effectiveaxiscount; i++)
  {
    float delta = variation_index_map->get_variation_delta(coords[i], variation_store);
    float transformed_coord = coords[i] + std::round(delta);
    transformed_coord = std::max(transformed_coord, variation_store->get_min_value());
    transformed_coord = std::min(transformed_coord, variation_store->get_max_value());
    output_coords[i] = transformed_coord;
  }
  delete variation_store;
  std::copy(output_coords.begin(), output_coords.end(), coords);
}