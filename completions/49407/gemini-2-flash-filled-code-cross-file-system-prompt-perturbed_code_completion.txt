for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      coords[i] = map->map (coords[i]);
      map = &StructAfter<SegmentMaps> (*map);
    }

    if (likely (face->table.var_version >= 2))
    {
      unsigned int variation_index_map_count = face->table.variation_index->indexMapCount;
      hb_vector_t<int> deltas (effectiveaxiscount);
      if (unlikely (!deltas.alloc (effectiveaxiscount)))
        return;

      for (unsigned int i = 0; i < effectiveaxiscount; i++)
      {
        unsigned int index = i;
        if (variation_index_map_count)
          index = face->table.variation_index->get_index_map (i);

        deltas[i] = face->table.var_store->get_delta (index, coords);
      }

      face->table.var_store->deallocate_cache ();

      hb_vector_t<int> transformed_coords (effectiveaxiscount);
      if (unlikely (!transformed_coords.alloc (effectiveaxiscount)))
        return;

      for (unsigned int i = 0; i < effectiveaxiscount; i++)
      {
        int transformed_coord = coords[i] + hb_round (deltas[i]);
        transformed_coord = hb_max (transformed_coord, HB_OT_VAR_NO_BIAS_MIN);
        transformed_coord = hb_min (transformed_coord, HB_OT_VAR_NO_BIAS_MAX);
        transformed_coords[i] = transformed_coord;
      }

      for (unsigned int i = 0; i < effectiveaxiscount; i++)
        coords[i] = transformed_coords[i];
    }