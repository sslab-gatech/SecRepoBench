for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      coords[i] = map->map (coords[i]);
      map = &StructAfter<SegmentMaps> (*map);
    }

    if (version < 2) return;

    unsigned int avar_count = hb_ot_var_avar_get_axis_count (face);

    if (unlikely (!avar_count)) return;

    effectiveaxiscount = hb_min (coords_length, avar_count);

    int *output = (int *) hb_calloc (effectiveaxiscount, sizeof (int));
    if (unlikely (!output)) return;

    const VariationStore *store = hb_ot_var_get_variation_store (face);
    const hb_array_t<const HBUINT8> index_map = hb_ot_var_avar_get_index_map (face);
    for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      unsigned int index = i < index_map.length ? index_map[i] : i;
      float delta = store->get_delta (index, coords, coords_length);
      output[i] = coords[i] + hb_ot_var_round_to_int (delta);
      output[i] = hb_clamp (output[i], -128, +127);
    }

    hb_ot_var_destroy_variation_store_cache (face);

    memcpy (coords, output, effectiveaxiscount * sizeof (int));
    hb_free (output);