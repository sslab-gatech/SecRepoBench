for (unsigned int i = 0; i < effectiveaxiscount; i++)
    {
      coords[i] = map->map_coord (coords[i]);
      map++;
    }

    if (version >= 2)
    {
      unsigned int variation_index_map_len = axisCount;
      const VariationIndexMap *variation_index_map = this->variation_index_map;
      const VariationStore *variation_store = this->variation_store;

      if (unlikely (!variation_index_map || !variation_store))
        return;

      int *output = (int *) malloc (sizeof (int) * effectiveaxiscount);
      if (unlikely (!output))
        return;

      for (unsigned int i = 0; i < effectiveaxiscount; i++)
      {
        float delta = variation_store->get_delta (variation_index_map[i], coords[i] >> 2) * float (1 << 2);
        int rounded_delta = int (delta + (delta > 0 ? 0.5 : -0.5));
        output[i] = coords[i] + rounded_delta;

        /* These values are hardcoded in hb-ot-var-gvar-table.hh, so it's safe to assume
         * they won't go out of bounds. */
        output[i] = hb_clamp (output[i], -32768, 32767);
      }

      variation_store->destroy_cache ();

      for (unsigned int i = 0; i < effectiveaxiscount; i++)
      {
        coords[i] = output[i];
      }

      free (output);
    }