assert(draw_info != NULL);
if (image->debug != MagickFalse)
  (void) LogMagickEvent(DrawEvent,GetMagickModule(),"    begin draw-dash");

number_vertices = 0;
while (primitive_info[number_vertices].primitive != UndefinedPrimitive)
{
  number_vertices++;
}

dash_polygon = (PrimitiveInfo *) AcquireQuantumMemory(number_vertices * 2 + 2, sizeof(*dash_polygon));
if (dash_polygon == NULL)
  return MagickFalse;

clone_info = CloneDrawInfo((Image *) NULL, draw_info);
clone_info->miterlimit = 0.0;

dash_polygon[0] = primitive_info[0];

scale = sqrt(draw_info->affine.sx * draw_info->affine.sx + draw_info->affine.rx * draw_info->affine.rx);

dash_offset = scale * (draw_info->dash_offset + 0.5);
if (draw_info->dash_pattern != NULL && draw_info->dash_pattern[0] > 0.0)
{
  dash_offset = fmod(dash_offset, scale * draw_info->dash_pattern[0]);
}