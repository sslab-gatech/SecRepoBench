// Retrieve and set image properties from TIFF tags.
// This block of code attempts to extract various metadata fields from a TIFF image,
// such as artist, copyright, document name, and other descriptive fields.
// Each TIFF field is checked for existence and non-null value, and if so, it is
// set as an image property using the SetImageProperty function. Special handling
// is done for fields like OPIIMAGEID, with count validation and string copying.
// Additionally, it handles the subfiletype field with specific values like REDUCEDIMAGE,
// PAGE, and MASK. This code can be adapted to include new properties or handle
// additional TIFF tags as needed.

// Retrieve TIFF tags
TIFFGetField(tiff, TIFFTAG_ARTIST, &text);
if (text!= NULL)
  (void) SetImageProperty(img, "artist", text, exception);

TIFFGetField(tiff, TIFFTAG_COPYRIGHT, &text);
if (text!= NULL)
  (void) SetImageProperty(img, "copyright", text, exception);

TIFFGetField(tiff, TIFFTAG_DOCUMENTNAME, &text);
if (text!= NULL)
  (void) SetImageProperty(img, "document", text, exception);

TIFFGetField(tiff, TIFFTAG_IMAGEDESCRIPTION, &text);
if (text!= NULL)
  (void) SetImageProperty(img, "comment", text, exception);

TIFFGetField(tiff, TIFFTAG_MAKE, &text);
if (text!= NULL)
  (void) SetImageProperty(img, "make", text, exception);

TIFFGetField(tiff, TIFFTAG_MODEL, &text);
if (text!= NULL)
  (void) SetImageProperty(img, "model", text, exception);

TIFFGetField(tiff, TIFFTAG_SOFTWARE, &text);
if (text!= NULL)
  (void) SetImageProperty(img, "software", text, exception);

TIFFGetField(tiff, TIFFTAG_DATETIME, &text);
if (text!= NULL)
  (void) SetImageProperty(img, "timestamp", text, exception);

TIFFGetField(tiff, TIFFTAG_HOSTCOMPUTER, &text);
if (text!= NULL)
  (void) SetImageProperty(img, "host", text, exception);

TIFFGetField(tiff, TIFFTAG_PAGENAME, &text);
if (text!= NULL)
  (void) SetImageProperty(img, "label", text, exception);

TIFFGetField(tiff, TIFFTAG_OPIIMAGEID, &text, &count);
if ((text!= NULL) && (count > 0))
  {
    char
      *id;

    id=(char *) AcquireQuantumMemory(count+1,sizeof(*id));
    if (id!= NULL)
      {
        (void) strncpy(id,text,count);
        id[count]='\0';
        (void) SetImageProperty(img, "OPI:ImageId", id, exception);
        id=(char *) RelinquishMagickMemory(id);
      }
  }

TIFFGetField(tiff, TIFFTAG_SUBFILETYPE, &type);
if (type == FILETYPE_REDUCEDIMAGE)
  (void) SetImageProperty(img, "tiff:subfiletype", "REDUCEDIMAGE", exception);
else if (type == FILETYPE_PAGE)
  (void) SetImageProperty(img, "tiff:subfiletype", "PAGE", exception);
else if (type == FILETYPE_MASK)
  (void) SetImageProperty(img, "tiff:subfiletype", "MASK", exception);

TIFFGetField(tiff, TIFFTAG_INKSET, &type);
if (type == INKSET_CMYK)
  (void) SetImageProperty(img, "tiff:inkset", "CMYK", exception);

TIFFGetField(tiff, TIFFTAG_DOTRANGE, &count, &length);
if ((count!= 0) && (length!= 0))
  {
    char
      *dot_range;

    dot_range=(char *) AcquireQuantumMemory(length+1,sizeof(*dot_range));
    if (dot_range!= NULL)
      {
        (void) strncpy(dot_range,text,length);
        dot_range[length]='\0';
        (void) SetImageProperty(img, "tiff:dot-range", dot_range, exception);
        dot_range=(char *) RelinquishMagickMemory(dot_range);
      }
  }

TIFFGetField(tiff, TIFFTAG_TARGETPRINTER, &text);
if (text!= NULL)
  (void) SetImageProperty(img, "tiff:target-printer", text, exception);

TIFFGetField(tiff, TIFFTAG_WHITEPOINT, &count, &length);
if ((count == 2) && (length == 2))
  {
    char
      *white_point;

    white_point=(char *) AcquireQuantumMemory(length*2+1,sizeof(*white_point));
    if (white_point!= NULL)
      {
        (void) strncpy(white_point,text,length*2);
        white_point[length*2]='\0';
        (void) SetImageProperty(img, "tiff:white-point", white_point, exception);
        white_point=(char *) RelinquishMagickMemory(white_point);
      }
  }

TIFFGetField(tiff, TIFFTAG_PRIMARYCHROMATICITIES, &count, &length);
if ((count == 6) && (length == 6))
  {
    char
      *primary_chromaticities;

    primary_chromaticities=(char *) AcquireQuantumMemory(length*2+1,sizeof(*primary_chromaticities));
    if (primary_chromaticities!= NULL)
      {
        (void) strncpy(primary_chromaticities,text,length*2);
        primary_chromaticities[length*2]='\0';
        (void) SetImageProperty(img, "tiff:primary-chromaticities", primary_chromaticities, exception);
        primary_chromaticities=(char *) RelinquishMagickMemory(primary_chromaticities);
      }
  }

TIFFGetField(tiff, TIFFTAG_YCBCRSUBSAMPLING, &count, &length);
if ((count == 2) && (length == 2))
  {
    char
      *ycbcr_subsampling;

    ycbcr_subsampling=(char *) AcquireQuantumMemory(length*2+1,sizeof(*ycbcr_subsampling));
    if (ycbcr_subsampling!= NULL)
      {
        (void) strncpy(ycbcr_subsampling,text,length*2);
        ycbcr_subsampling[length*2]='\0';
        (void) SetImageProperty(img, "tiff:ycbcr-subsampling", ycbcr_subsampling, exception);
        ycbcr_subsampling=(char *) RelinquishMagickMemory(ycbcr_subsampling);
      }
  }

TIFFGetField(tiff, TIFFTAG_JPEGQUALITY, &count);
if (count!= 0)
  {
    char
      quality[MagickPathExtent];

    (void) FormatLocaleString(quality,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "jpeg:quality", quality, exception);
  }

TIFFGetField(tiff, TIFFTAG_JPEGTABLESMODE, &count);
if (count!= 0)
  {
    char
      tables_mode[MagickPathExtent];

    (void) FormatLocaleString(tables_mode,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "jpeg:tables-mode", tables_mode, exception);
  }

TIFFGetField(tiff, TIFFTAG_PHOTOMETRIC, &count);
if (count!= 0)
  {
    char
      photometric[MagickPathExtent];

    (void) FormatLocaleString(photometric,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:photometric", photometric, exception);
  }

TIFFGetField(tiff, TIFFTAG_ORIENTATION, &count);
if (count!= 0)
  {
    char
      orientation[MagickPathExtent];

    (void) FormatLocaleString(orientation,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:orientation", orientation, exception);
  }

TIFFGetField(tiff, TIFFTAG_RESOLUTIONUNIT, &count);
if (count!= 0)
  {
    char
      resolution_unit[MagickPathExtent];

    (void) FormatLocaleString(resolution_unit,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:resolution-unit", resolution_unit, exception);
  }

TIFFGetField(tiff, TIFFTAG_XRESOLUTION, &count);
if (count!= 0)
  {
    char
      x_resolution[MagickPathExtent];

    (void) FormatLocaleString(x_resolution,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:x-resolution", x_resolution, exception);
  }

TIFFGetField(tiff, TIFFTAG_YRESOLUTION, &count);
if (count!= 0)
  {
    char
      y_resolution[MagickPathExtent];

    (void) FormatLocaleString(y_resolution,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:y-resolution", y_resolution, exception);
  }

TIFFGetField(tiff, TIFFTAG_XPOSITION, &count);
if (count!= 0)
  {
    char
      x_position[MagickPathExtent];

    (void) FormatLocaleString(x_position,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:x-position", x_position, exception);
  }

TIFFGetField(tiff, TIFFTAG_YPOSITION, &count);
if (count!= 0)
  {
    char
      y_position[MagickPathExtent];

    (void) FormatLocaleString(y_position,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:y-position", y_position, exception);
  }

TIFFGetField(tiff, TIFFTAG_ZIPQUALITY, &count);
if (count!= 0)
  {
    char
      zip_quality[MagickPathExtent];

    (void) FormatLocaleString(zip_quality,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:zip-quality", zip_quality, exception);
  }

TIFFGetField(tiff, TIFFTAG_PREDICTOR, &count);
if (count!= 0)
  {
    char
      predictor[MagickPathExtent];

    (void) FormatLocaleString(predictor,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:predictor", predictor, exception);
  }

TIFFGetField(tiff, TIFFTAG_COMPRESSION, &count);
if (count!= 0)
  {
    char
      compression[MagickPathExtent];

    (void) FormatLocaleString(compression,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:compression", compression, exception);
  }

TIFFGetField(tiff, TIFFTAG_FILLORDER, &count);
if (count!= 0)
  {
    char
      fill_order[MagickPathExtent];

    (void) FormatLocaleString(fill_order,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:fill-order", fill_order, exception);
  }

TIFFGetField(tiff, TIFFTAG_BITSPERSAMPLE, &count);
if (count!= 0)
  {
    char
      bits_per_sample[MagickPathExtent];

    (void) FormatLocaleString(bits_per_sample,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:bits-per-sample", bits_per_sample, exception);
  }

TIFFGetField(tiff, TIFFTAG_SAMPLESPERPIXEL, &count);
if (count!= 0)
  {
    char
      samples_per_pixel[MagickPathExtent];

    (void) FormatLocaleString(samples_per_pixel,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:samples-per-pixel", samples_per_pixel, exception);
  }

TIFFGetField(tiff, TIFFTAG_ROWSPERSTRIP, &count);
if (count!= 0)
  {
    char
      rows_per_strip[MagickPathExtent];

    (void) FormatLocaleString(rows_per_strip,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:rows-per-strip", rows_per_strip, exception);
  }

TIFFGetField(tiff, TIFFTAG_STRIPBYTECOUNTS, &count);
if (count!= 0)
  {
    char
      strip_byte_counts[MagickPathExtent];

    (void) FormatLocaleString(strip_byte_counts,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:strip-byte-counts", strip_byte_counts, exception);
  }

TIFFGetField(tiff, TIFFTAG_STRIPOffsets, &count);
if (count!= 0)
  {
    char
      strip_offsets[MagickPathExtent];

    (void) FormatLocaleString(strip_offsets,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:strip-offsets", strip_offsets, exception);
  }

TIFFGetField(tiff, TIFFTAG_SAMPLEFORMAT, &count);
if (count!= 0)
  {
    char
      sample_format[MagickPathExtent];

    (void) FormatLocaleString(sample_format,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:sample-format", sample_format, exception);
  }

TIFFGetField(tiff, TIFFTAG_SMINSAMPLEVALUE, &count);
if (count!= 0)
  {
    char
      min_sample_value[MagickPathExtent];

    (void) FormatLocaleString(min_sample_value,MagickPathExtent,"%d",count);
    (void) SetImageProperty(img, "tiff:min-sample-value", min_sample_value, exception);
  }

TIFFGetField(tiff, TIFFTAG_SMAXSAMPLEVALUE, &count);
if (count!= 0)
  {
    char
      max_sample_value[MagickPathExtent];

    (void) Forma