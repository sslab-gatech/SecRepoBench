static av_always_inline void mpeg_motion_lowres(MpegEncContext *s,
                                                uint8_t *dest_y,
                                                uint8_t *dest_cb,
                                                uint8_t *dest_cr,
                                                int field_based,
                                                int bottom_field,
                                                int field_select,
                                                uint8_t *const *ref_picture,
                                                const h264_chroma_mc_func *pix_op,
                                                int motion_x, int motion_y,
                                                int h, int mb_y)
{
    const int lowres         = s->avctx->lowres;
    const int w              = 16 >> lowres;                  // Luma block width at lowres
    const int s_mask         = (2 << lowres) - 1;
    int width                = s->width  >> lowres;
    int height               = s->height >> lowres;
    int src_x, src_y, sx, sy;

    // Luma motion
    sx    = motion_x & s_mask;
    sy    = motion_y & s_mask;
    src_x = ((s->mb_x << 4) >> lowres) + (motion_x >> (lowres + 1));
    src_y = ((mb_y    << 4) >> lowres) + (motion_y >> (lowres + 1));

    hpel_motion_lowres(s, dest_y, ref_picture[0],
                       field_based, field_select,
                       src_x, src_y, width, height, s->linesize,
                       s->h_edge_pos >> lowres, s->v_edge_pos >> lowres,
                       w, h, pix_op, motion_x, motion_y);

    // Chroma motion (unless we're in GRAY mode)
    if (!CONFIG_GRAY || !(s->avctx->flags & AV_CODEC_FLAG_GRAY)) {
        int mx, my, uvsrc_x, uvsrc_y, uvw, uvh;
        mx      = motion_x >> s->chroma_x_shift;
        my      = motion_y >> s->chroma_y_shift;
        uvw     = w      >> s->chroma_x_shift;
        uvh     = h      >> s->chroma_y_shift;
        uvsrc_x = ((s->mb_x << 4) >> s->chroma_x_shift) >> lowres;
        uvsrc_y = ((mb_y    << 4) >> s->chroma_y_shift) >> lowres;
        uvsrc_x += mx >> (lowres + 1);
        uvsrc_y += my >> (lowres + 1);

        hpel_motion_lowres(s, dest_cb, ref_picture[1],
                           field_based, field_select,
                           uvsrc_x, uvsrc_y,
                           width  >> s->chroma_x_shift,
                           height >> s->chroma_y_shift,
                           s->uvlinesize,
                           (s->h_edge_pos >> s->chroma_x_shift) >> lowres,
                           (s->v_edge_pos >> s->chroma_y_shift) >> lowres,
                           uvw, uvh, pix_op, mx, my);

        hpel_motion_lowres(s, dest_cr, ref_picture[2],
                           field_based, field_select,
                           uvsrc_x, uvsrc_y,
                           width  >> s->chroma_x_shift,
                           height >> s->chroma_y_shift,
                           s->uvlinesize,
                           (s->h_edge_pos >> s->chroma_x_shift) >> lowres,
                           (s->v_edge_pos >> s->chroma_y_shift) >> lowres,
                           uvw, uvh, pix_op, mx, my);
    }

    // FIXME h261 lowres loop filter could be placed here if needed
}