const int block_s = 8 >> lowres;
    const int s_mask = (2 << lowres) - 1;

    mx = (s->mv[0][0][0] + s->mv[1][0][0]) >> 1;
    my = (s->mv[0][0][1] + s->mv[1][0][1]) >> 1;

    src_x = (mb_x * block_s) + (mx >> lowres);
    src_y = (mb_y * block_s) + (my >> lowres);

    if ((unsigned)src_x > h_edge_pos || (unsigned)src_y > v_edge_pos) {
        s->vdsp.emulated_edge_mc(s->sc.edge_emu_buffer, ref_picture[0] + src_y * s->linesize + src_x,
                                 s->linesize, s->linesize, block_s, block_s, src_x, src_y,
                                 h_edge_pos, v_edge_pos);
        ptr_y = s->sc.edge_emu_buffer;
    } else {
        ptr_y = ref_picture[0] + src_y * s->linesize + src_x;
    }

    for (int i = 0; i < block_s; i++) {
        memcpy(dest_y + i * s->linesize, ptr_y + i * s->linesize, block_s);
    }

    if (s->chroma_x_shift || s->chroma_y_shift) {
        // Handle chroma components similarly
        // ...
    }