sx = motion_x & s_mask;
sy = motion_y & s_mask;
src_x += motion_x >> lowres + 1;
src_y += motion_y >> lowres + 1;

src   += src_y * stride + src_x;

if ((unsigned)src_x > FFMAX( h_edge_pos - (!!sx) - w,                 0) ||
    (unsigned)src_y > FFMAX((v_edge_pos >> field_based) - (!!sy) - h, 0)) {
    s->vdsp.emulated_edge_mc(s->sc.edge_emu_buffer, src,
                             s->linesize, s->linesize,
                             w + 1, (h + 1) << field_based,
                             src_x, src_y * (1 << field_based),
                             h_edge_pos, v_edge_pos);
    src = s->sc.edge_emu_buffer;
    emu = 1;
}

sx = (sx << 2) >> lowres;
sy = (sy << 2) >> lowres;
if (field_select)
    src += s->linesize;
pix_op[op_index](dest, src, stride, h, sx, sy);
return emu;