// <MASK>
if (lowres == 1) {
    if (field_based) {
        if (bottom_field) {
            ptr_y = ref_picture[0] + (motion_y + 1) * linesize;
            ptr_cb = ref_picture[1] + (motion_y + 1) * uvlinesize;
            ptr_cr = ref_picture[2] + (motion_y + 1) * uvlinesize;
        } else {
            ptr_y = ref_picture[0] + motion_y * linesize;
            ptr_cb = ref_picture[1] + motion_y * uvlinesize;
            ptr_cr = ref_picture[2] + motion_y * uvlinesize;
        }
    } else {
        ptr_y = ref_picture[0] + motion_y * linesize;
        ptr_cb = ref_picture[1] + motion_y * uvlinesize;
        ptr_cr = ref_picture[2] + motion_y * uvlinesize;
    }

    if (motion_x < 0) {
        sx = -motion_x;
        src_x = -motion_x;
    } else {
        sx = motion_x;
        src_x = motion_x;
    }

    if (motion_x < 0) {
        if (field_based) {
            if (bottom_field) {
                sx = FFMAX(sx, h_edge_pos - 1);
            } else {
                sx = FFMAX(sx, h_edge_pos);
            }
        } else {
            sx = FFMAX(sx, h_edge_pos);
        }
    }

    if (motion_x > 0) {
        if (field_based) {
            if (bottom_field) {
                sx = FFMIN(sx, h_edge_pos);
            } else {
                sx = FFMIN(sx, h_edge_pos - 1);
            }
        } else {
            sx = FFMIN(sx, h_edge_pos - 1);
        }
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        src_x = FFMIN(src_x, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        sx = FFMAX(sx, h_edge_pos - 1);
    } else {
        sx = FFMIN(sx, h_edge_pos - 1);
    }

    if (motion_x < 0) {
        src_x = FFMAX(src_x, h_edge_pos - 1);
    } else {
        sr