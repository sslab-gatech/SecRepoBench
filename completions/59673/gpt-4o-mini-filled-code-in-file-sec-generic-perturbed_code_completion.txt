const int block_s = 8 >> lowres;
    const int h = (height + block_s - 1) / block_s;
    const int w = (width + block_s - 1) / block_s;

    for (int j = 0; j < h; j++) {
        for (int i = 0; i < w; i++) {
            int x = i * block_s;
            int y = j * block_s;

            if (x < 0 || x >= h_edge_pos || y < 0 || y >= v_edge_pos) {
                continue; // Skip out-of-bounds
            }

            // Perform motion compensation for luma
            hpel_motion_lowres(s, dest_y + y * stride + x, ref_picture[0], field_based, field_select,
                               x, y, width, height, stride, h_edge_pos, v_edge_pos, block_s, block_s, pix_op,
                               motion_x, motion_y);

            // Perform motion compensation for chroma
            if (i % 2 == 0 && j % 2 == 0) {
                chroma_4mv_motion_lowres(s, dest_cb + (y / 2) * s->uvlinesize + (x / 2), 
                                          dest_cr + (y / 2) * s->uvlinesize + (x / 2), 
                                          ref_picture, pix_op, motion_x, motion_y);
            }
        }
    }