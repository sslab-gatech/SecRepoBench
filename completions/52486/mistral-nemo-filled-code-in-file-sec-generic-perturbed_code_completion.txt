// ***** BEGIN LICENSE BLOCK *****
// Version: MPL 1.1/GPL 2.0/LGPL 2.1
//
// The contents of this file are subject to the Mozilla Public License Version
// 1.1 (the "MPL"), the GNU General Public License Version 2.0 (the "GPL"),
// and the GNU Lesser General Public License Version 2.1 (the "LGPL"),
// all of which are included in the Mozilla Public License Version 1.1
// (the "MPL"). You may not use this file except in compliance with
// the MPL, the GPL, and the LGPL. You may obtain a copy of the MPL,
// the GPL, and the LGPL from the Mozilla Foundation:
// http://mozilla.org/MPL/2.0/
// http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
// http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html
//
// If you use this file, you must accept the terms of the MPL, the GPL,
// and the LGPL. If you do not agree to the terms of the MPL, the GPL,
// and the LGPL, do not use, modify, or distribute this file.
// ***** END LICENSE BLOCK *****/

#include <cstdio>
#include <cstring>
#include <cstdlib>
#include <cmath>

#include <algorithm>
#include <memory>
#include <limits>
#include <string>
#include <vector>

#include "affixmgr.hxx"
#include "affentry.hxx"
#include "langnum.hxx"

#include "csutil.hxx"

AffixMgr::AffixMgr(const char* affpath,
                   const std::vector<HashMgr*>& ptr,
                   const char* key)
  : alldic(ptr)
  , pHMgr(ptr[0])
  , pStart(0)
  , sStart(0)
  , pFlag(0)
  , sFlag(0)
  , pStart2(0)
  , sStart2(0)
  , pHMgr(NULL)
  , cpdmin(-1)
  , cpdmaxsyllable(0)
  , checkcompoundrep(0)
  , checkcompoundtriple(0)
  , simplifiedtriple(0)
  , simplifiedcpd(0)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , lemma_present(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , compoundmoresuffixes(0)
  , checksharps(0)
  , substandard(FLAG_NULL)
  , fullstrip(0)
  , keepcase(FLAG_NULL)
  , forceucase(FLAG_NULL)
  , warn(0)
  , forbidwarn(0)
  , cpdwordmax(-1)
  , cpdmin(0)
  , cpdmaxsyllable(0)
  , checkcompoundrep(0)
  , checkcompoundtriple(0)
  , simplifiedtriple(0)
  , simplifiedcpd(0)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , lemma_present(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , compoundmoresuffixes(0)
  , checksharps(0)
  , substandard(FLAG_NULL)
  , fullstrip(0)
  , keepcase(FLAG_NULL)
  , forceucase(FLAG_NULL)
  , warn(0)
  , forbidwarn(0)
  , cpdwordmax(-1)
  , cpdmin(0)
  , cpdmaxsyllable(0)
  , checkcompoundrep(0)
  , checkcompoundtriple(0)
  , simplifiedtriple(0)
  , simplifiedcpd(0)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , lemma_present(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , compoundmoresuffixes(0)
  , checksharps(0)
  , substandard(FLAG_NULL)
  , fullstrip(0)
  , keepcase(FLAG_NULL)
  , forceucase(FLAG_NULL)
  , warn(0)
  , forbidwarn(0)
  , cpdwordmax(-1)
  , cpdmin(0)
  , cpdmaxsyllable(0)
  , checkcompoundrep(0)
  , checkcompoundtriple(0)
  , simplifiedtriple(0)
  , simplifiedcpd(0)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , lemma_present(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , compoundmoresuffixes(0)
  , checksharps(0)
  , substandard(FLAG_NULL)
  , fullstrip(0)
  , keepcase(FLAG_NULL)
  , forceucase(FLAG_NULL)
  , warn(0)
  , forbidwarn(0)
  , cpdwordmax(-1)
  , cpdmin(0)
  , cpdmaxsyllable(0)
  , checkcompoundrep(0)
  , checkcompoundtriple(0)
  , simplifiedtriple(0)
  , simplifiedcpd(0)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , lemma_present(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , compoundmoresuffixes(0)
  , checksharps(0)
  , substandard(FLAG_NULL)
  , fullstrip(0)
  , keepcase(FLAG_NULL)
  , forceucase(FLAG_NULL)
  , warn(0)
  , forbidwarn(0)
  , cpdwordmax(-1)
  , cpdmin(0)
  , cpdmaxsyllable(0)
  , checkcompoundrep(0)
  , checkcompoundtriple(0)
  , simplifiedtriple(0)
  , simplifiedcpd(0)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , lemma_present(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , compoundmoresuffixes(0)
  , checksharps(0)
  , substandard(FLAG_NULL)
  , fullstrip(0)
  , keepcase(FLAG_NULL)
  , forceucase(FLAG_NULL)
  , warn(0)
  , forbidwarn(0)
  , cpdwordmax(-1)
  , cpdmin(0)
  , cpdmaxsyllable(0)
  , checkcompoundrep(0)
  , checkcompoundtriple(0)
  , simplifiedtriple(0)
  , simplifiedcpd(0)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , lemma_present(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , compoundmoresuffixes(0)
  , checksharps(0)
  , substandard(FLAG_NULL)
  , fullstrip(0)
  , keepcase(FLAG_NULL)
  , forceucase(FLAG_NULL)
  , warn(0)
  , forbidwarn(0)
  , cpdwordmax(-1)
  , cpdmin(0)
  , cpdmaxsyllable(0)
  , checkcompoundrep(0)
  , checkcompoundtriple(0)
  , simplifiedtriple(0)
  , simplifiedcpd(0)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , lemma_present(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , compoundmoresuffixes(0)
  , checksharps(0)
  , substandard(FLAG_NULL)
  , fullstrip(0)
  , keepcase(FLAG_NULL)
  , forceucase(FLAG_NULL)
  , warn(0)
  , forbidwarn(0)
  , cpdwordmax(-1)
  , cpdmin(0)
  , cpdmaxsyllable(0)
  , checkcompoundrep(0)
  , checkcompoundtriple(0)
  , simplifiedtriple(0)
  , simplifiedcpd(0)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , lemma_present(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , compoundmoresuffixes(0)
  , checksharps(0)
  , substandard(FLAG_NULL)
  , fullstrip(0)
  , keepcase(FLAG_NULL)
  , forceucase(FLAG_NULL)
  , warn(0)
  , forbidwarn(0)
  , cpdwordmax(-1)
  , cpdmin(0)
  , cpdmaxsyllable(0)
  , checkcompoundrep(0)
  , checkcompoundtriple(0)
  , simplifiedtriple(0)
  , simplifiedcpd(0)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , lemma_present(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , compoundmoresuffixes(0)
  , checksharps(0)
  , substandard(FLAG_NULL)
  , fullstrip(0)
  , keepcase(FLAG_NULL)
  , forceucase(FLAG_NULL)
  , warn(0)
  , forbidwarn(0)
  , cpdwordmax(-1)
  , cpdmin(0)
  , cpdmaxsyllable(0)
  , checkcompoundrep(0)
  , checkcompoundtriple(0)
  , simplifiedtriple(0)
  , simplifiedcpd(0)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , lemma_present(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , compoundmoresuffixes(0)
  , checksharps(0)
  , substandard(FLAG_NULL)
  , fullstrip(0)
  , keepcase(FLAG_NULL)
  , forceucase(FLAG_NULL)
  , warn(0)
  , forbidwarn(0)
  , cpdwordmax(-1)
  , cpdmin(0)
  , cpdmaxsyllable(0)
  , checkcompoundrep(0)
  , chec