// ***** BEGIN LICENSE BLOCK *****
// Version: MPL 1.1/GPL 2.0/LGPL 2.1
//
// The contents of this file are subject to the Mozilla Public License Version
// 1.1 (the "MPL"), the GNU General Public License Version 2.0 (the "GPL"),
// and the GNU Lesser General Public License Version 2.1 (the "LGPL"),
// all of which are included below in the section entitled "LICENSE".
//
// If you did not receive this file as part of a specific software
// distribution, or if you received this file from a place other than
// the project's site of the official distribution, then it is
// provided to you on an "AS IS" BASIS, WITHOUT WARRANTY OF ANY KIND,
// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE SCOPE OF
// IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
// PURPOSE, TITLE AND NON-INFRINGEMENT.  YOU MAY OBTAIN COPYRIGHT
// NOTICE AND/OR OTHER NOTICE AND/OR DISCLAIMER AS APPLICABLE
// TO ANY AND ALL PERSONS OBTAINING COPYS OF THE SOFTWARE DISTRIBUTED
// FROM THE PROJECT'S SITE OF THE OFFICIAL DISTRIBUTION.
// ***** END LICENSE BLOCK *****/

#include <cstdio>
#include <cstring>
#include <cstdlib>
#include <cmath>

#include <algorithm>
#include <memory>
#include <limits>
#include <string>
#include <vector>

#include "affixmgr.hxx"
#include "affentry.hxx"
#include "langnum.hxx"

#include "csutil.hxx"

AffixMgr::AffixMgr(const char* affpath,
                   const std::vector<HashMgr*>& ptr,
                   const char* key)
  : alldic(ptr)
  , pHMgr(ptr[0])
  , pStart(0)
  , sStart(0)
  , pFlag(0)
  , sFlag(0)
  , PfxEntry::pStart(this)
  , SfxEntry::sStart(this)
  , pHMgr(NULL)
  , cpdvowels()
  , cpdvowels_utf16()
  , cpdvowels_utf16_utf16()
  , cpdvowels_utf16_utf8()
  , cpdvowels_utf8_utf16()
  , cpdvowels_utf8_utf8()
  , contclasses(0)
  , havecontclass(0)
  , lemma_present(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , lemma_present(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , cpdwordmax(-1)
  , cpdmin(-1)
  , cpdmaxsyllable(0)
  , checkcompoundrep(0)
  , checkcompoundcase(0)
  , checkcompoundtriple(0)
  , simplifiedtriple(0)
  , forbiddenword(FLAG_NULL)
  , nosuggest(FLAG_NULL)
  , nongramsuggest(FLAG_NULL)
  , substandard(FLAG_NULL)
  , fullstrip(0)
  , keepcase(FLAG_NULL)
  , forceucase(FLAG_NULL)
  , warn(0)
  , forbidwarn(0)
  , checksharps(0)
  , sfx(NULL)
  , pfx(NULL)
  , sfxappnd(NULL)
  , sfxextra(0)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , lemma_present(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , sfxflag(FLAG_NULL)
  , sfxappnd(NULL)
  , sfxextra(0)
  , sfxcont(NULL)
  , sfxcontlen(0)
  , pfxappnd(NULL)
  , pfxextra(0)
  , pfxcont(NULL)
  , pfxcontlen(0)
  , cpdwordmax(-1)
  , cpdmin(-1)
  , cpdmaxsyllable(0)
  , checkcompoundrep(0)
  , checkcompoundcase(0)
  , checkcompoundtriple(0)
  , simplifiedtriple(0)
  , forbiddenword(FLAG_NULL)
  , nosuggest(FLAG_NULL)
  , nongramsuggest(FLAG_NULL)
  , substandard(FLAG_NULL)
  , fullstrip(0)
  , keepcase(FLAG_NULL)
  , forceucase(FLAG_NULL)
  , warn(0)
  , forbidwarn(0)
  , checksharps(0)
  , complexprefixes(0)
  , utf8(0)
  , encoding()
  , keystring()
  , trystring()
  , wordchars()
  , ignorechars()
  , ignorechars_utf16()
  , wordchars_utf16()
  , version()
  , affixlist()
  , affixlist_utf16()
  , affixlist_utf8()
  , affixlist_utf8_utf16()
  , affixlist_utf8_utf8()
  , affixlist_utf16_utf16()
  , affixlist_utf16_utf8()
  , affixlist_utf8_utf16()
  , affixlist_utf8_utf8()
  , affixlist_utf16_utf16_utf16()
  , affixlist_utf16_utf16_utf8()
  , affixlist_utf16_utf8_utf16()
  , affixlist_utf8_utf16_utf16()
  , affixlist_utf8_utf16_utf8()
  , affixlist_utf8_utf8_utf16()
  , affixlist_utf8_utf8_utf8()
  , affixlist_utf16_utf16_utf16_utf16()
  , affixlist_utf16_utf16_utf16_utf8()
  , affixlist_utf16_utf16_utf8_utf16()
  , affixlist_utf16_utf8_utf16_utf16()
  , affixlist_utf8_utf16_utf16_utf16()
  , affixlist_utf8_utf16_utf16_utf8()
  , affixlist_utf8_utf8_utf16_utf16()
  , affixlist_utf8_utf8_utf8_utf16()
  , affixlist_utf8_utf8_utf8_utf8()
  , affixlist_utf16_utf16_utf16_utf16_utf16()
  , affixlist_utf16_utf16_utf16_utf16_utf8()
  , affixlist_utf16_utf16_utf16_utf8_utf16()
  , affixlist_utf16_utf16_utf8_utf16_utf16()
  , affixlist_utf16_utf8_utf16_utf16_utf16()
  , affixlist_utf8_utf16_utf16_utf16_utf16()
  , affixlist_utf8_utf16_utf16_utf16_utf8()
  , affixlist_utf8_utf8_utf16_utf16_utf16()
  , affixlist_utf8_utf8_utf8_utf16_utf16()
  , affixlist_utf8_utf8_utf8_utf8_utf16()
  , affixlist_utf16_utf16_utf16_utf16_utf16_utf16()
  , affixlist_utf16_utf16_utf16_utf16_utf8_utf16()
  , affixlist_utf16_utf16_utf16_utf8_utf8_utf16()
  , affixlist_utf16_utf16_utf8_utf8_utf16_utf16()
  , affixlist_utf16_utf8_utf16_utf16_utf16_utf16()
  , affixlist_utf8_utf16_utf16_utf16_utf16_utf16()
  , affixlist_utf8_utf16_utf16_utf16_utf8_utf16()
  , affixlist_utf8_utf8_utf16_utf16_utf16_utf16()
  , affixlist_utf8_utf8_utf8_utf16_utf16_utf16()
  , affixlist_utf8_utf8_utf8_utf8_utf16_utf16()
  , affixlist_utf16_utf16_utf16_utf16_utf16_utf16_utf16()
  , affixlist_utf16_utf16_utf16_utf16_utf8_utf16_utf16()
  , affixlist_utf16_utf16_utf16_utf8_utf8_utf16_utf16()
  , affixlist_utf16_utf16_utf8_utf8_utf16_utf16_utf16()
  , affixlist_utf16_utf8_utf16_utf16_utf16_utf16_utf16()
  , affixlist_utf8_utf16_utf16_utf16_utf16_utf16_utf16()
  , affixlist_utf8_utf16_utf16_utf16_utf8_utf16_utf16()
  , affixlist_utf8_utf8_utf16_utf16_utf16_utf16_utf16()
  , affixlist_utf8_utf8_utf8_utf16_utf16_utf16_utf16()
  , affixlist_utf8_utf8_utf8_utf8_utf16_utf16_utf16()
  , affixlist_utf16_utf16_utf16_utf16_utf16_utf16_utf16_utf16()
  , affixlist_utf16_utf16_utf16_utf16_utf8_utf16_utf16_utf16()
  , affixlist_utf16_utf16_utf16_utf8_utf8_utf16_utf16_utf16()
  , affixlist_utf16_utf16_utf8_utf8_utf16_utf16_utf16_utf16()
  , affixlist_utf16_utf8_utf16_utf16_utf16_utf16_utf16_utf16()
  , affixlist_utf8_utf16_utf16_utf16_utf16_utf16_utf16_utf16()
  , affixlist_utf8_utf16_utf16_utf16_utf8_utf16_utf16_utf16()
  , affixlist_utf8_utf8_utf16_utf16_utf16_utf16_utf16_utf16()
  , affixlist_utf8_utf8_utf8_utf16_utf16_utf16_utf16_utf16()
  , affixlist_utf8_utf8_utf8_utf8_utf16_utf16_utf16_utf16()
  , affixlist_utf16_utf16_utf16_utf16_utf16_utf16_utf16_utf16_utf16()
  , affixlist_utf16_utf16_utf16_utf16_utf8_utf16_utf16_utf16_utf16()
  , affixlist_utf16_utf16_utf16_utf8_utf8_utf16_utf16_utf16_utf16()
  , affixlist_utf16