if (n < 0) {
  mrb_raise(mrbstateptr, E_ARGUMENT_ERROR, "negative array size");
}
if (n == 0) {
  return mrb_ary_new(mrbstateptr);
}
ary_modify(mrbstateptr, a);
if (ARY_CAPA(a) < n) {
  ary_expand_capa(mrbstateptr, a, n);
}
val = ary_subseq(mrbstateptr, a, 0, n);
if (ARY_LEN(a) < n) {
  ary_fill_with_nil(ARY_PTR(a) + ARY_LEN(a), n - ARY_LEN(a));
}
ARY_SET_LEN(a, ARY_LEN(a) - n);
if (ARY_LEN(a) > 0) {
  value_move(ARY_PTR(a), ARY_PTR(a) + n, ARY_LEN(a));
}
ary_shrink_capa(mrbstateptr, a);