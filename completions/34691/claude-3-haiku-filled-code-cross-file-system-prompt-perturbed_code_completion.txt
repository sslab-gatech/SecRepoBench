if (len > n) {
  ary_make_shared(mrbstateptr, a);
L_SHIFT:
  val = ARY_PTR(a)[0];
  mrb_int i;
  for (i = 0; i < len - n; i++) {
    ARY_PTR(a)[i] = ARY_PTR(a)[i + n];
  }
  ARY_SET_LEN(a, len - n);
}
else {
  val = mrb_ary_shift(mrbstateptr, self);
}