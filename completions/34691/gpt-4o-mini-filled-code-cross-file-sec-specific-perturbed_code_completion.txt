if (n < 0 || n > len) {
    mrb_raise(mrbstateptr, E_ARGUMENT_ERROR, "invalid array shift count");
  }

  val = ARY_PTR(a)[0]; // Get the first element to return
  if (n == 0) {
    return val; // If no elements to shift, return the first element
  }

  // Shift elements
  mrb_value *ptr = ARY_PTR(a);
  for (mrb_int i = 0; i < len - n; i++) {
    ptr[i] = ptr[i + n];
  }
  ARY_SET_LEN(a, len - n);