if (n < 0) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "negative array size");
  }
  if (n > len) {
    n = len;
  }
  if (n == 0) {
    return mrb_ary_shift(mrb, self);
  }

  val = mrb_ary_new_capa(mrb, n);
  if (len == 0)
    return val;

L_SHIFT:
  if (ARY_SHARED_P(ary)) {
    mrb_value *ptr = ARY_PTR(ary);

    for (mrb_int i = 0; i < n; i++) {
      mrb_ary_push(mrb, val, ptr[i]);
    }
  }
  else {
    mrb_value *ptr = ARY_PTR(ary);

    for (mrb_int i = 0; i < n; i++) {
      mrb_ary_push(mrb, val, ptr[i]);
    }
  }