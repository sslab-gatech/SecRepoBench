if (n < 0) {
  mrb_raise(mrbstateptr, E_ARGUMENT_ERROR, "negative array size");
}
if (n == 0) {
  return mrb_ary_new(mrbstateptr);
}
val = mrb_ary_new_capa(mrbstateptr, n);
if (ARY_SHARED_P(a)) {
L_SHIFT:
  a->as.heap.ptr += n;
  a->as.heap.len -= n;
  return val;
}
if (ARY_EMBED_P(a)) {
  mrb_value *ptr = ARY_EMBED_PTR(a);
  mrb_int len = ARY_EMBED_LEN(a);
  if (n > len) n = len;
  ARY_SET_EMBED_LEN(a, len - n);
  while (n--) {
    mrb_ary_push(mrbstateptr, val, *ptr++);
  }
  return val;
}