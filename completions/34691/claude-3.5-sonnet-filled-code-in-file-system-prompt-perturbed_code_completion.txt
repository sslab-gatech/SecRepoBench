if (n < 0) {
  mrb_raise(mrbstateptr, E_ARGUMENT_ERROR, "negative array size");
}
if (n == 0) {
  return mrb_ary_new(mrbstateptr);
}
ary_modify(mrbstateptr, a);
if (ARY_CAPA(a) < n) {
  ary_expand_capa(mrbstateptr, a, n);
}
val = ary_subseq(mrbstateptr, a, 0, n);
if (ARY_LEN(a) < n) {
  ary_fill_with_nil(ARY_PTR(a) + ARY_LEN(a), n - ARY_LEN(a));
  ARY_SET_LEN(a, n);
}
L_SHIFT:
val = mrb_ary_new_from_values(mrbstateptr, n, ARY_PTR(a));
a->as.heap.ptr += n;
a->as.heap.len -= n;
return val;