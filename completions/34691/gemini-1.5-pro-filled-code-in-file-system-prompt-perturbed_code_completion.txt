ary_modify(mrbstateptr, a);
  if (n < 0) {
    mrb_raise(mrbstateptr, E_ARGUMENT_ERROR, "negative array size");
  }
  if (n > len) {
    n = len;
  }

  val = mrb_ary_new_capa(mrbstateptr, n);
  array_copy(ARY_PTR(mrb_ary_ptr(val)), ARY_PTR(a), n);
  ARY_SET_LEN(mrb_ary_ptr(val), n);

L_SHIFT:
  if (ARY_SHARED_P(a)) {
    a->as.heap.ptr += n;
    a->as.heap.len -= n;
  }