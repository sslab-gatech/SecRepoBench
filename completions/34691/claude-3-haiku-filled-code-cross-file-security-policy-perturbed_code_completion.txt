if (n < 0) {
  mrb_raise(mrb, E_ARGUMENT_ERROR, "negative array size");
}

if (len >= n) {
  val = ARY_PTR(ary)[0];
  value_move(ARY_PTR(ary), ARY_PTR(ary) + n, len - n);
  ARY_SET_LEN(ary, len - n);
}
else {
  val = mrb_nil_value();
  ARY_SET_LEN(ary, 0);
}