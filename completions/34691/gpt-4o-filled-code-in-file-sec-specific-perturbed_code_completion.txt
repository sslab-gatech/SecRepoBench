if (n < 0 || n > len) {
    mrb_raise(mrbstateptr, E_ARGUMENT_ERROR, "invalid shift count");
  }
  if (n == 0) {
    return mrb_ary_new(mrbstateptr);
  }
  if (n >= len) {
    mrb_value result = mrb_ary_new_from_values(mrbstateptr, len, ARY_PTR(a));
    ARY_SET_LEN(a, 0);
    return result;
  }
  mrb_value result = mrb_ary_new_from_values(mrbstateptr, n, ARY_PTR(a));
  mrb_value *ptr = ARY_PTR(a);
  mrb_int size = len - n;
  while (size--) {
    *ptr = *(ptr + n);
    ++ptr;
  }
  ARY_SET_LEN(a, len - n);
  return result;