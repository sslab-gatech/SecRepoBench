if (n < 0) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "negative array size");
  }
  if (len <= n) {
    val = mrb_ary_new(mrb);
    ARY_SET_LEN(ary, 0);
  }
  else {
    val = mrb_ary_new_from_values(mrb, n, ARY_PTR(ary));
L_SHIFT:
    mrb_int size = len - n;
    if (size > 0) {
      memmove(ARY_PTR(ary), ARY_PTR(ary) + n, size * sizeof(mrb_value));
    }
    ARY_SET_LEN(ary, size);
  }