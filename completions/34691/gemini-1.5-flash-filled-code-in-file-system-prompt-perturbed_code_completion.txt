ary_modify(mrbstateptr, a);
  if (n < 0) {
    mrb_raise(mrbstateptr, E_ARGUMENT_ERROR, "negative argument");
  }
  if (len < n) {
    return mrb_nil_value();
  }
  if (ARY_SHARED_P(a)) {
  L_SHIFT:
    val = a->as.heap.ptr[0];
    a->as.heap.ptr += n;
    a->as.heap.len -= n;
    return val;
  }
  else if (len == n) {
    val = ARY_PTR(a)[0];
    ARY_SET_LEN(a, 0);
  }