if (n < 0) {
    mrb_raise(mrbstateptr, E_ARGUMENT_ERROR, "negative array size");
  }
  if (len <= n) {
    val = mrb_ary_new(mrbstateptr);
    ARY_SET_LEN(a, 0);
  }
  else {
    val = mrb_ary_new_from_values(mrbstateptr, n, ARY_PTR(a));
    L_SHIFT:;
    mrb_int size = len - n;
    if (size > 0) {
      memmove(ARY_PTR(a), ARY_PTR(a) + n, size * sizeof(mrb_value));
    }
    ARY_SET_LEN(a, size);
  }