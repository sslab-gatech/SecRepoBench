if (n > len) n = len;
if (n <= 0) return mrb_ary_new(mrb);

val = mrb_ary_new_from_values(mrb, n, ARY_PTR(ary));

if (n == len) {
  ARY_SET_LEN(ary, 0);
  return val;
}

L_SHIFT:
ary->as.heap.ptr += n;
ARY_SET_LEN(ary, len - n);