const void *p;
ssize_t bytes_avail;

/* Read at least 9 bytes of the ZIPX LZMA stream to get the magic numbers
 * and LZMA parameters. */
p = __archive_read_ahead(a, 9, &bytes_avail);
if (bytes_avail < 9) {
    archive_set_error(&(a->archive), ARCHIVE_ERRNO_FILE_FORMAT,
        "Truncated ZIPX LZMA stream");
    return (ARCHIVE_FATAL);
}

/* Set the pointer to the start of the ZIPX LZMA stream */
lzma_stream_pointer = (const uint8_t*)p;

/* Verify the magic numbers for ZIPX LZMA format
 * (based on example in code comments) */
if (lzma_stream_pointer[0] != 0x09 || lzma_stream_pointer[1] != 0x14 ||
    lzma_stream_pointer[2] != 0x05 || lzma_stream_pointer[3] != 0x00) {
    archive_set_error(&(a->archive), ARCHIVE_ERRNO_FILE_FORMAT,
        "Invalid ZIPX LZMA stream magic");
    return (ARCHIVE_FATAL);
}