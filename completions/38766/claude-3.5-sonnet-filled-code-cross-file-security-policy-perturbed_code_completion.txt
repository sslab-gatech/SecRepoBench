const uint8_t *buffer;
ssize_t avail;

buffer = __archive_read_ahead(a, 9, &avail);
if (buffer == NULL || avail < 9) {
    archive_set_error(&a->archive, ARCHIVE_ERRNO_FILE_FORMAT,
        "Truncated ZIPX LZMA stream");
    return (ARCHIVE_FATAL);
}

if (buffer[0] != 0x09 || buffer[1] != 0x14 || buffer[2] != 0x05 || buffer[3] != 0x00) {
    archive_set_error(&a->archive, ARCHIVE_ERRNO_FILE_FORMAT,
        "Invalid ZIPX LZMA stream header");
    return (ARCHIVE_FATAL);
}

lzma_stream_pointer = buffer;