const void *p;
ssize_t bytes_avail;

/* We expect 9 bytes: 2 bytes of magic1, 2 bytes of magic2, and 5 bytes of
 * LZMA parameters. */
p = __archive_read_ahead(a, 9, &bytes_avail);
if (bytes_avail < 9) {
	archive_set_error(&a->archive, ARCHIVE_ERRNO_FILE_FORMAT,
	    "Truncated lzma stream in ZIPX file");
	return (ARCHIVE_FATAL);
}

lzma_stream_pointer = (const uint8_t *)p;

/* Validate the first 4 bytes against known magic values for this variant of the LZMA stream. */
if (lzma_stream_pointer[0] != 0x09 || lzma_stream_pointer[1] != 0x14 ||
    lzma_stream_pointer[2] != 0x05 || lzma_stream_pointer[3] != 0x00) {
	archive_set_error(&a->archive, ARCHIVE_ERRNO_FILE_FORMAT,
	    "Invalid or unsupported LZMA stream magic in ZIPX file");
	return (ARCHIVE_FAILED);
}