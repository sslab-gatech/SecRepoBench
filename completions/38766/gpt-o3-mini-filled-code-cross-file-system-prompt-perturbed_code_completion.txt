{
	const void *p;
	ssize_t avail;

	/* Read at least 9 bytes: 2 bytes magic1, 2 bytes magic2, and 5 bytes LZMA parameters */
	p = __archive_read_ahead(a, 9, &avail);
	if (avail < 9) {
		archive_set_error(&a->archive, ARCHIVE_ERRNO_FILE_FORMAT,
		    "Truncated lzma file header in ZIPX entry");
		return (ARCHIVE_FATAL);
	}
	lzma_stream_pointer = p;

	/* Validate the magic numbers.
	 * Expected header structure:
	 *   [0-1]: magic1 (0x09, 0x14)
	 *   [2-3]: magic2 (0x05, 0x00)
	 */
	if (lzma_stream_pointer[0] != 0x09 ||
	    lzma_stream_pointer[1] != 0x14 ||
	    lzma_stream_pointer[2] != 0x05 ||
	    lzma_stream_pointer[3] != 0x00) {
		archive_set_error(&a->archive, ARCHIVE_ERRNO_FILE_FORMAT,
		    "Invalid lzma header in ZIPX entry");
		return (ARCHIVE_FATAL);
	}
}