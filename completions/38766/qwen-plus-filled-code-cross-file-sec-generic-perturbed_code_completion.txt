// Read the initial part of the ZIPX stream to extract the magic numbers
// and LZMA parameters. Ensure that the data format is as expected by
// validating specific byte values. If the format is incorrect or the data
// is truncated, set an appropriate error and return a failure code.
p = __archive_read_ahead(a, 9, NULL);
if (!p) {
	archive_set_error(&a->archive, ARCHIVE_ERRNO_FILE_FORMAT,
	    "Truncated file data in LZMA stream");
	return (ARCHIVE_FATAL);
}

// Validate the magic1 and magic2 headers.
uint16_t magic1 = archive_le16dec(p);
uint16_t magic2 = archive_le16dec(p + 2);

if (magic1 != 0x0914 || magic2 != 0x0500) {
	archive_set_error(&a->archive, ARCHIVE_ERRNO_FILE_FORMAT,
	    "Invalid magic numbers in LZMA stream: magic1=0x%04x, magic2=0x%04x",
	    magic1, magic2);
	return (ARCHIVE_FAILED);
}

lzma_stream_pointer = p;

__archive_read_consume(a, 9);