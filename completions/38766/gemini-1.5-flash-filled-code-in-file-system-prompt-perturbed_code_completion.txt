lzma_stream lzma_stream_temp;
	lzma_ret r;
	const uint8_t* lzma_stream_pointer;
	size_t lzma_stream_size;

	/* Read the initial part of the ZIPX stream to extract the magic
	 * numbers and LZMA parameters. Ensure that the data format is as
	 * expected by validating specific byte values. If the format is
	 * incorrect or the data is truncated, set an appropriate error and
	 * return a failure code. */
	lzma_stream_pointer = __archive_read_ahead(a, 9, &lzma_stream_size);
	if(lzma_stream_size < 9) {
		archive_set_error(&a->archive, ARCHIVE_ERRNO_FILE_FORMAT,
		    "Truncated file data in LZMA stream");
		return (ARCHIVE_FATAL);
	}

	/* Prepare an LZMA 'alone' header by copying the LZMA parameters from
	 * the ZIPX stream to the appropriate location in the header. */
	if(lzma_stream_pointer[0] != 0x09 || lzma_stream_pointer[1] != 0x14 ||
	    lzma_stream_pointer[2] != 0x05 || lzma_stream_pointer[3] != 0x00) {
		archive_set_error(&a->archive, ARCHIVE_ERRNO_FILE_FORMAT,
		    "Invalid magic numbers in LZMA stream");
		return (ARCHIVE_FAILED);
	}