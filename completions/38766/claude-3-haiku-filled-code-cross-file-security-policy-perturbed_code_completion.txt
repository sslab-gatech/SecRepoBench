/* Read the initial part of the ZIPX stream to extract the magic numbers
 * and LZMA parameters. Ensure that the data format is as expected by
 * validating specific byte values. If the format is incorrect or the data
 * is truncated, set an appropriate error and return a failure code.
 * Prepare an LZMA 'alone' header by copying the LZMA parameters from
 * the ZIPX stream to the appropriate location in the header. */
lzma_stream_pointer = __archive_read_ahead(a, 9, NULL);
if (lzma_stream_pointer == NULL || lzma_stream_pointer[0] != 0x09 || lzma_stream_pointer[1] != 0x14) {
    archive_set_error(&a->archive, ARCHIVE_ERRNO_FILE_FORMAT,
        "Invalid ZIPX LZMA stream header");
    return ARCHIVE_FATAL;
}
memcpy(&alone_header.bytes[0], lzma_stream_pointer + 4, 5);

/* Initialize the 'uncompressed size' field to unknown; we'll manually
 * monitor how many bytes there are still to be uncompressed. */
alone_header.uncompressed_size = UINT64_MAX;