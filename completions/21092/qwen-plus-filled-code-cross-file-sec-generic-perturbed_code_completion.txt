int i = 1;
if (inputvalue <= arrayZ[0].fromCoord)
  return inputvalue - arrayZ[0].fromCoord + arrayZ[0].toCoord;

for (; i < len; i++)
{
  if (arrayZ[i].fromCoord > inputvalue)
    break;
}

if (i == len || arrayZ[i-1].fromCoord == arrayZ[i].fromCoord)
{
  int denom = arrayZ[i].fromCoord - arrayZ[i-1].fromCoord;
  if (denom == 0)
    return arrayZ[i-1].toCoord;
  else
  {
    int delta = inputvalue - arrayZ[i-1].fromCoord;
    return arrayZ[i-1].toCoord + 
           ((arrayZ[i].toCoord - arrayZ[i-1].toCoord) * delta + denom/2) / denom;
  }
}
else
{
  int denom = arrayZ[i].fromCoord - arrayZ[i-1].fromCoord;
  return arrayZ[i-1].toCoord +
         ((arrayZ[i].toCoord - arrayZ[i-1].toCoord) *
          (inputvalue - arrayZ[i-1].fromCoord) + denom/2) / denom;
}