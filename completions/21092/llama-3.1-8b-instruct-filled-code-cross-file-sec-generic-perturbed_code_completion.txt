// <MASK>
// Calculate the denominator for linear interpolation between two segments.
// If the value is beyond or equal to the current segment's fromCoord, adjust the value using the current segment's toCoord.
// Handle cases where two fromCoords are equal by using the previous toCoord for mapping.
denom = (toCoord - fromCoord) > 0? (toCoord - fromCoord) : 1;
if (inputvalue <= fromCoord)
  return fromCoord;
for (i = 1; i < ARRAY_LENGTH (arrayZ); i++)
  if (inputvalue <= arrayZ[i].fromCoord)
    {
      if (i > 1 && arrayZ[i].fromCoord == arrayZ[i-1].fromCoord)
	return arrayZ[i-1].toCoord + ((arrayZ[i].toCoord - arrayZ[i-1].toCoord) * (inputvalue - arrayZ[i-1].fromCoord)) / denom;
      return arrayZ[i-1].toCoord + ((arrayZ[i].toCoord - arrayZ[i-1].toCoord) * (inputvalue - arrayZ[i-1].fromCoord) + denom/2) / denom;
    }
return toCoord;