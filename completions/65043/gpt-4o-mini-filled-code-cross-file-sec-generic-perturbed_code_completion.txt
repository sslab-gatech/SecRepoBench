xmlParserInputBufferPtr newBuffer = xmlAllocInputBuffer(handler);
        if (newBuffer == NULL) {
            xmlErrMemory(ctxt, NULL);
            return (-1);
        }

        newBuffer->buffer = xmlBufCreate();
        if (newBuffer->buffer == NULL) {
            xmlFreeInputBuffer(newBuffer);
            xmlErrMemory(ctxt, NULL);
            return (-1);
        }

        // Shrink the existing input buffer to remove processed data.
        xmlBufShrink(in->buffer, in->buffer->use);

        // Move the current buffer to the raw buffer pointer.
        newBuffer->raw = in->raw;

        // Update the number of processed bytes in the input structure.
        in->raw = newBuffer->raw;
        in->buffer = newBuffer->buffer;