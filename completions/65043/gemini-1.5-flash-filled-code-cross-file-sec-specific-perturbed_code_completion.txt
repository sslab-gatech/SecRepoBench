xmlParserInputBufferPtr newInputBuffer = xmlParserInputBufferCreate();
        if (newInputBuffer == NULL) {
            xmlCharEncCloseFunc(handler);
            return (XML_ENC_ERR_MEMORY);
        }
        xmlParserInputBufferPtr rawBuffer = in->raw;
        newInputBuffer->raw = rawBuffer;
        newInputBuffer->buffer = xmlBufCreate();
        if (newInputBuffer->buffer == NULL) {
            xmlCharEncCloseFunc(handler);
            xmlParserInputBufferFree(newInputBuffer);
            return (XML_ENC_ERR_MEMORY);
        }
        xmlBufCopyContent(newInputBuffer->buffer, in->buffer);
        xmlBufReset(in->buffer);
        in->raw = newInputBuffer;
        inputStream->buf = newInputBuffer;
        inputStream->cur = inputStream->base = xmlBufGetContent(newInputBuffer->buffer);
        inputStream->end = inputStream->cur + xmlBufUse(newInputBuffer->buffer);
        inputStream->consumed = 0;