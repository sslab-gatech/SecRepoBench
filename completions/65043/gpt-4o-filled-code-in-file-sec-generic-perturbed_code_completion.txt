xmlParserInputBufferPtr newBuf = xmlAllocParserInputBuffer(in->encoder->input);
        if (newBuf == NULL) {
            xmlErrMemory(ctxt, "Failed to allocate new input buffer\n");
            return -1;
        }
        xmlBufShrink(in->buffer, xmlBufUse(in->buffer));
        in->raw = in->buffer;
        in->buffer = newBuf->buffer;
        in->rawconsumed = in->consumed;
        in->consumed = 0;
        xmlFreeParserInputBuffer(newBuf);