{
    xmlBufPtr oldBuf = in->buffer;
    in->buffer = xmlBufCreate();
    if (in->buffer == NULL) {
        xmlErrMemory(ctxt, NULL);
        return -1;
    }

    /* Remove already processed data from the old buffer. */
    {
        size_t processed = (size_t)(inputStream->cur - inputStream->base);
        if (processed > 0 && processed <= xmlBufUse(oldBuf)) {
            xmlBufShrink(oldBuf, processed);
            inputStream->consumed += processed;
        }
    }

    /* Move the old buffer to the raw pointer. */
    in->raw = oldBuf;
}