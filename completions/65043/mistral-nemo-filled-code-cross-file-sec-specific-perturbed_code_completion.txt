xmlParserInputBufferPtr newIn = xmlParserInputBufferCreateStatic(NULL, 0);
    if (newIn == NULL) {
        xmlErrMemory(ctxt, NULL);
        return (-1);
    }
    in->raw = newIn;
    in->raw->context = in;
    in->raw->close = endOfInput;
    in->raw->compress = NULL;
    in->raw->write = NULL;
    in->raw->writeChars = NULL;
    in->raw->consume = NULL;

    xmlBufShrink(in->buffer, in->raw->consume(in->raw, in->raw->buffer->use));
    in->raw->consume(in->raw, in->raw->buffer->use);
    in->raw->buffer->use = 0;

    in->raw->buffer = in->buffer;
    in->buffer = NULL;

    in->raw->read = xmlBufRead;
    in->raw->readChars = xmlBufReadChars;
    in->raw->readFully = xmlBufReadFully;
    in->raw->readFullyFromFile = xmlBufReadFullyFromFile;
    in->raw->readFullyFromMemory = xmlBufReadFullyFromMemory;
    in->raw->readFullyFromCallback = xmlBufReadFullyFromCallback;
    in->raw->readFullyFromCallbackWithLength = xmlBufReadFullyFromCallbackWithLength;

    in->raw->encoder = in->encoder;
    in->encoder = NULL;

    in->raw->encoding = in->encoding;
    in->encoding = NULL;

    in->raw->converters = in->converters;
    in->converters = NULL;

    in->raw->input = inputStream;
    inputStream->buf = in->raw;