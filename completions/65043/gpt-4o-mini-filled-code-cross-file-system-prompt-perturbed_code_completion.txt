xmlParserInputBufferPtr newInputBuffer = xmlNewParserInputBuffer(in->buffer->use);
        if (newInputBuffer == NULL) {
            xmlErrMemory(ctxt, "Failed to create new input buffer");
            return (-1);
        }
        newInputBuffer->encoder = handler;
        newInputBuffer->buffer = in->buffer;
        in->buffer = newInputBuffer;
        in->buffer->use = 0; // Reset the buffer use count
        in->raw = in->buffer; // Move the current buffer to the raw buffer pointer
        in->processed = 0; // Update the number of processed bytes in the input structure