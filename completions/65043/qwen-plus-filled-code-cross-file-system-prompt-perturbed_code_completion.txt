xmlParserInputBufferPtr newBuf = xmlParserInputBufferCreateBuffer(in->raw, in->encoder);
if (newBuf == NULL) {
    xmlCharEncCloseFunc(handler);
    return (-1);
}
in->buffer = newBuf->buffer;
xmlBufShrink(in->buffer, xmlBufUse(in->buffer));
inputStream->raw = in->raw;
inputStream->consumed = xmlBufTell(newBuf->raw);