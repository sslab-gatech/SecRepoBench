xmlBufPtr newbuf = xmlBufCreate();
        if (newbuf == NULL) {
            xmlErrMemory(ctxt, NULL);
            xmlHaltParser(ctxt);
            return -1;
        }
        xmlBufPtr oldbuf = in->buffer;
        in->buffer = newbuf;

        if (in->raw != NULL) {
            xmlBufAddBuffer(in->raw, oldbuf);
            xmlBufFree(oldbuf);
        } else {
            in->raw = oldbuf;
        }
        inputStream->consumed += xmlBufUse(oldbuf);