xmlParserInputBufferPtr newBuf = xmlAllocParserInputBuffer(handler);
if (newBuf == NULL) {
    xmlCharEncCloseFunc(handler);
    return (-1);
}
xmlBufShrink(in->buffer, xmlBufUse(in->buffer));
in->raw = in->buffer;
in->buffer = newBuf->buffer;
inputStream->consumed += xmlBufUse(in->raw);