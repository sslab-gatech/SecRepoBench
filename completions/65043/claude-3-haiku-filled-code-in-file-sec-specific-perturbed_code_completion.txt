// <MASK>
size_t res = xmlBufShrink(buf->buffer, used - LINE_LEN);
if (res > 0) {
    used -= res;
    if ((res > ULONG_MAX) ||
        (in->consumed > ULONG_MAX - (unsigned long)res))
        in->consumed = ULONG_MAX;
    else
        in->consumed += res;
}
xmlBufResetInput(buf->buffer, inputStream);
in->base = xmlBufContent(buf->buffer);
in->cur = in->base;
in->end = xmlBufEnd(buf->buffer);