xmlParserInputBufferPtr newBuf;
        xmlBufShrink(in->buffer, in->rawconsumed);
        in->raw = in->buffer;
        in->rawconsumed = 0;
        newBuf = xmlAllocParserInputBuffer(in->encoder);
        if (newBuf == NULL) {
            xmlErrMemory(ctxt, "allocating new input buffer\n");
            return (-1);
        }
        newBuf->buffer = in->buffer;
        in->buffer = newBuf->buffer;
        in->raw = newBuf->raw;
        in->rawconsumed = newBuf->rawconsumed;
        xmlFreeParserInputBuffer(newBuf);