{
    xmlBufPtr newBuffer;
    int processed;

    newBuffer = xmlBufCreate();
    if (newBuffer == NULL) {
        xmlErrMemory(ctxt, "switching encoding: unable to allocate new input buffer\n");
        return(-1);
    }
    /* Calculate how many bytes have been processed so far */
    processed = (int)(inputStream->cur - (const char *)xmlBufContent(in->buffer));
    /* Remove the already processed data from the current buffer */
    xmlBufShrink(in->buffer);
    /* Move the current (now shrunk) buffer over to the raw buffer */
    in->raw = in->buffer;
    /* Assign the new empty buffer for further converted input */
    in->buffer = newBuffer;
    /* Update the input stream's count of processed bytes */
    inputStream->consumed += processed;
}