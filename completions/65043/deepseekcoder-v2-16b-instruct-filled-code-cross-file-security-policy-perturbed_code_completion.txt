xmlParserInputBufferPtr newBuffer = xmlBufCreate();
if (newBuffer == NULL) {
    xmlErrMemory(ctxt, NULL);
    return -1;
}

xmlBufShrink(in->buffer, in->raw);
xmlBufAttach(newBuffer, in->raw, in->size);

xmlBufFree(in->buffer);
in->buffer = newBuffer;
in->raw = xmlBufDetach(newBuffer);
in->size = xmlBufGetSize(newBuffer);