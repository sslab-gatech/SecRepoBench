// Create a new input buffer and assign it to the current buffer pointer.
xmlParserInputBufferPtr new_buffer = xmlParserInputBufferCreateStatic(NULL, 0, in->encoder);
if (new_buffer == NULL) {
    xmlErrMemory(ctxt, "creating new input buffer");
    return -1;
}

// Shrink the existing input buffer to remove processed data.
xmlBufShrink(in->buffer, inputStream->consumed);

// Move the current buffer to the raw buffer pointer.
new_buffer->raw = in->buffer;
in->buffer = new_buffer->buffer;

// Update the number of processed bytes in the input structure.
inputStream->consumed = 0;
in->raw = in->buffer->use;