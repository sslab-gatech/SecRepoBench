xmlParserInputBufferPtr newBuf = xmlAllocParserInputBuffer(handler);
        if (newBuf == NULL) {
            xmlCharEncCloseFunc(handler);
            return (-1);
        }

        xmlBufShrink(in->buffer, xmlBufUse(in->buffer));
        xmlBufMoveBuffer(newBuf->buffer, in->buffer);
        in->raw = in->buffer;
        in->buffer = newBuf->buffer;
        newBuf->buffer = NULL;
        xmlFreeParserInputBuffer(newBuf);
        inputStream->consumed = 0;