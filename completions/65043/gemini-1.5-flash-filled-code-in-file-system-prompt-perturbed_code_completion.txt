xmlParserInputBufferPtr newBuf = xmlParserInputBufferCreate();
        if (newBuf == NULL) {
            xmlCharEncCloseFunc(handler);
            xmlErrMemory(ctxt, NULL);
            return (-1);
        }
        xmlParserInputBufferPtr rawBuf = in;
        in = newBuf;
        inputStream->buf = in;
        xmlBufResetInput(in->buffer, inputStream);
        xmlBufCat(in->buffer, rawBuf->buffer);
        in->consumed = rawBuf->consumed;
        rawBuf->consumed = 0;
        inputStream->base = xmlBufContent(in->buffer);
        inputStream->cur = inputStream->base;
        inputStream->end = xmlBufEnd(in->buffer);
        xmlFreeParserInputBuffer(rawBuf);