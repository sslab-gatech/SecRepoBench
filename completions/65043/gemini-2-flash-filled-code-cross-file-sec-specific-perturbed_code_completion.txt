xmlParserInputBufferPtr oldInput = in;
        xmlBufPtr oldBuffer = in->buffer;
        xmlBufPtr rawBuffer = in->raw;
        long processed = inputStream->consumed;

        in = xmlParserInputBufferCreateIO(NULL, NULL, XML_CHAR_ENCODING_NONE);
        if (in == NULL) {
            xmlErrMemory(ctxt, NULL);
            return (-1);
        }
        inputStream->buf = in;

        xmlBufShrink(oldBuffer, processed);
        in->buffer = oldBuffer;
        in->raw = rawBuffer;
        oldInput->buffer = NULL;
        oldInput->raw = NULL;
        inputStream->consumed = 0;