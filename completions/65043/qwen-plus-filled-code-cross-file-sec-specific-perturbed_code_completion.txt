xmlParserInputBufferPtr newBuf = xmlAllocParserInputBuffer(handler->input);
if (newBuf == NULL) {
    xmlCharEncCloseFunc(handler);
    return(-1);
}
xmlBufMove(newBuf->buffer, in->buffer);
in->buffer = newBuf->buffer;
newBuf->buffer = NULL;
xmlFreeParserInputBuffer(newBuf);
inputStream->consumed += xmlBufGetConsumed(in->buffer);