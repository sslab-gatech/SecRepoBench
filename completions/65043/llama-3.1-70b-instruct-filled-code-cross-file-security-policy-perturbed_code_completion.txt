xmlParserInputBufferPtr newbuf = xmlParserInputBufferCreate(NULL, NULL, 0, NULL, NULL, NULL, NULL, NULL, NULL);
if (newbuf == NULL) {
    xmlErrMemory(ctxt, NULL);
    return (-1);
}
xmlBufShrink(in->buffer, in->consumed);
xmlBufRaw(in->buffer, &in->raw);
in->consumed = 0;
inputStream->consumed += in->consumed;
xmlParserInputBufferFree(in);
in = newbuf;
inputStream->buf = in;