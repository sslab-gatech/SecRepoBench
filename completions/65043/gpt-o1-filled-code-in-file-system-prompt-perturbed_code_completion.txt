if (in->buf->raw == NULL) {
    in->buf->raw = xmlBufCreate();
    if (in->buf->raw == NULL) {
        xmlErrMemory(ctxt, NULL);
        xmlHaltParser(ctxt);
        return(-1);
    }
}

/* Move any current content from the processed buffer into the raw buffer */
xmlBufCat(in->buf->raw, xmlBufContent(in->buf->buffer));

/* Clear the processed buffer so it can be re-decoded using the new encoding */
xmlBufEmpty(in->buf->buffer);