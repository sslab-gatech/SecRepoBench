xmlParserInputBufferPtr newBuf;
size_t used;

newBuf = xmlAllocParserInputBuffer(XML_CHAR_ENCODING_NONE);
if (newBuf == NULL) {
    xmlErrMemory(ctxt, NULL);
    return;
}

used = in->cur - in->base;
xmlBufShrink(in->buf->buffer, used);
newBuf->raw = in->buf->buffer;
in->buf->buffer = newBuf->buffer;
in->buf->raw = newBuf->raw;

xmlBufResetInput(in->buf->buffer, in);
in->consumed += used;