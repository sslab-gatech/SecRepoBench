xmlParserInputBufferPtr newBuffer = xmlAllocParserInputBuffer(in->encoder->input);
        if (newBuffer == NULL) {
            xmlErrMemory(ctxt, "allocating new input buffer");
            return (-1);
        }

        // Shrink the existing input buffer to remove processed data
        xmlBufShrink(in->buffer, in->rawconsumed);

        // Move the current buffer to the raw buffer pointer
        newBuffer->raw = in->buffer;
        newBuffer->rawconsumed = in->rawconsumed;

        // Assign the new buffer to the current buffer pointer
        in->buffer = newBuffer->buffer;
        in->rawconsumed = 0;