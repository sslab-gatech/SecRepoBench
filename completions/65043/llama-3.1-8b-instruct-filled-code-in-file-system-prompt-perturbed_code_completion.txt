if (xmlBufUse(in->buf->buffer) <= INPUT_CHUNK) {
    xmlParserInputBufferRead(in->buf, 2 * INPUT_CHUNK);
}
in->base = xmlBufContent(in->buf->buffer);
if (in->base == NULL) {
    /* TODO: raise error */
    in->base = BAD_CAST "";
    in->cur = in->base;
    in->end = in->base;
    return(-1);
}
in->cur = in->base + used;
in->end = xmlBufEnd(in->buf->buffer);