xmlBufPtr temp = xmlBufCreate();
if (temp == NULL) {
    xmlErrMemory(ctxt, "creating temporary buffer\n");
    return (-1);
}
xmlBufAdd(temp, xmlBufContent(in->buffer), xmlBufLength(in->buffer));
xmlBufShrink(in->buffer, xmlBufLength(in->buffer));
in->raw = in->buffer;
in->buffer = temp;
inputStream->consumed += inputStream->cur - inputStream->base;
inputStream->cur = inputStream->base = xmlBufContent(in->buffer);