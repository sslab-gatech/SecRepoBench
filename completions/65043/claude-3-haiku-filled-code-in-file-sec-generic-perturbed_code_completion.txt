// <MASK>
// Create a new input buffer and assign it to the current buffer pointer.
// Shrink the existing input buffer to remove processed data.
// Move the current buffer to the raw buffer pointer.
// Update the number of processed bytes in the input structure.
xmlParserInputBufferPtr newBuf = xmlParserInputBufferCreateMem(in->base, used, in->buf->encoder);
if (newBuf == NULL) {
    xmlErrMemory(ctxt, NULL);
    return;
}
xmlBufResetInput(newBuf->buffer, inputStream);
in->buf = newBuf;
in->consumed += used;