xmlBufPtr temp;

/* Store the existing buffer */
temp = in->buffer;

/* Create a new buffer for the converted content */
in->buffer = xmlBufCreate();
if (in->buffer == NULL) {
    xmlCharEncCloseFunc(in->encoder);
    in->encoder = NULL;
    return (-1);
}

/* Move the old buffer to raw */
if (in->raw != NULL)
    xmlBufFree(in->raw);
in->raw = temp;

/* Reset consumed bytes */
in->consumed = 0;