// Create a new input buffer and assign it to the current buffer pointer.
xmlParserInputBufferPtr newBuf = xmlParserInputBufferCreate(NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL, 0, NULL);
if (newBuf == NULL) {
    xmlErrMemory(ctxt, NULL);
    return(-1);
}
xmlParserInputBufferPtr oldBuf = in->buf;
in->buf = newBuf;

// Shrink the existing input buffer to remove processed data.
xmlBufShrink(oldBuf->buffer, xmlBufUse(oldBuf->buffer) - INPUT_CHUNK);

// Move the current buffer to the raw buffer pointer.
xmlBufResetInput(oldBuf->buffer, in);

// Update the number of processed bytes in the input structure.
in->consumed += xmlBufUse(oldBuf->buffer);

// Update the input buffer pointer.
in->base = xmlBufContent(oldBuf->buffer);
in->cur = in->base;
in->end = xmlBufEnd(oldBuf->buffer);