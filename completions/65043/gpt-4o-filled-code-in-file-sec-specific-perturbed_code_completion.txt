xmlParserInputBufferPtr newBuf = xmlAllocParserInputBuffer(in->encoder ? in->encoder->input : XML_CHAR_ENCODING_NONE);
        if (newBuf == NULL) {
            xmlErrMemory(ctxt, NULL);
            return (-1);
        }
        xmlBufShrink(in->buffer, xmlBufUse(in->buffer));
        in->raw = in->buffer;
        in->buffer = newBuf->buffer;
        in->consumed = 0;