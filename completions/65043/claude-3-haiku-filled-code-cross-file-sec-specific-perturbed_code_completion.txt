// Create a new input buffer and assign it to the current buffer pointer.
xmlParserInputBufferPtr new_buf = xmlParserInputBufferCreateStatic(in->raw, in->rawlen, in->encoder);
if (new_buf == NULL) {
    xmlErrMemory(ctxt, "creating new input buffer");
    return -1;
}

// Shrink the existing input buffer to remove processed data.
xmlBufShrink(in->buffer, in->consumed);

// Move the current buffer to the raw buffer pointer.
in->raw = xmlBufContent(in->buffer);
in->rawlen = xmlBufUse(in->buffer);

// Update the number of processed bytes in the input structure.
inputStream->consumed += in->consumed;
in->consumed = 0;

// Assign the new input buffer to the current buffer pointer.
in->buffer = new_buf->buffer;