xmlParserInputBufferPtr oldin = in;

        in = xmlAllocParserInputBuffer(handler);
        if (in == NULL) {
            xmlCharEncCloseFunc(handler);
            in = oldin;
            return (-1);
        }
        inputStream->buf = in;
        in->raw = oldin;
        in->readcallback = NULL;
        in->closecallback = NULL;
        oldin->readcallback = endOfInput;
        in->compressed = oldin->compressed;
        in->error = oldin->error;
        inputStream->consumed += (oldin->consumed - oldin->buffer->use);