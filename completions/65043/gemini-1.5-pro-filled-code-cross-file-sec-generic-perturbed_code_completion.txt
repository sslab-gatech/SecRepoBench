in->raw = in->buffer;
        in->buffer = xmlBufCreate();
        if (in->buffer == NULL) {
            xmlCharEncCloseFunc(handler);
            in->raw = NULL;
            return (XML_ERR_NO_MEMORY);
        }
        in->buf = xmlAllocParserInputBuffer(ctxt->dict);
        if (in->buf == NULL) {
            xmlCharEncCloseFunc(handler);
            xmlBufFree(in->raw);
            in->raw = NULL;
            xmlBufFree(in->buffer);
            in->buffer = NULL;
            return (XML_ERR_NO_MEMORY);
        }
        in->buf->buffer = in->buffer;
        in->buf->encoder = in->encoder;
        in->buf->raw = in->raw;
        in->buf->readcallback = NULL;
        in->buf->closecallback = NULL;
        in->buf->context = NULL;

        inputStream->consumed += (in->raw->use - in->raw->size);