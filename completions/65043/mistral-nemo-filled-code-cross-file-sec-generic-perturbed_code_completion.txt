xmlParserInputBufferPtr newIn = xmlParserInputBufferCreateStatic(NULL, 0);
    if (newIn == NULL) {
        xmlErrMemory(ctxt, NULL);
        return (-1);
    }
    xmlBufResetInput(newIn->buffer, inputStream);
    in->raw = newIn;
    in->raw->end = in->raw->content = in->raw->cons;
    in->raw->consumed = 0;
    in->raw->close = endOfInput;
    in->raw->context = in;
    xmlBufMoveReader(in->buffer, in->raw->content, in->raw->end - in->raw->content);
    in->raw->end = in->raw->content + xmlBufUse(in->buffer);
    in->raw->consumed = in->raw->end - in->raw->content;
    xmlBufResetInput(in->buffer, in->raw);
    nbchars = xmlCharEncInput(in);
    xmlBufFree(newIn->buffer);
    xmlParserInputBufferFree(newIn);