xmlParserInputBufferPtr newBuf = xmlParserInputBufferCreate();
        if (newBuf == NULL) {
            xmlCharEncCloseFunc(handler);
            xmlErrMemory(ctxt, NULL);
            return (-1);
        }
        xmlParserInputBufferPtr rawBuf = in;
        in = newBuf;
        inputStream->buf = in;
        xmlBufResetInput(in->buffer, inputStream);
        xmlBufAdd(rawBuf->buffer, in->buffer);
        in->consumed = rawBuf->consumed;