for (i = 0; i < rounds + 1; i++) {
        if (i < KC) {
            a->round_key[i].u8[0] = tk[i][0];
            a->round_key[i].u8[1] = tk[i][1];
            a->round_key[i].u8[2] = tk[i][2];
            a->round_key[i].u8[3] = tk[i][3];
        } else {
            uint8_t temp[4];
            memcpy(temp, &a->round_key[i - 1].u8[12], 4);
            if (i % KC == 0) {
                // Rotate and apply S-box
                uint8_t t = temp[0];
                temp[0] = sbox[temp[1]];
                temp[1] = sbox[temp[2]];
                temp[2] = sbox[temp[3]];
                temp[3] = sbox[t];
                temp[0] ^= rcon[rconpointer++];
            } else if (KC > 6 && i % KC == 4) {
                // Apply S-box
                for (int j = 0; j < 4; j++) {
                    temp[j] = sbox[temp[j]];
                }
            }
            a->round_key[i].u8[0] = a->round_key[i - KC].u8[0] ^ temp[0];
            a->round_key[i].u8[1] = a->round_key[i - KC].u8[1] ^ temp[1];
            a->round_key[i].u8[2] = a->round_key[i - KC].u8[2] ^ temp[2];
            a->round_key[i].u8[3] = a->round_key[i - KC].u8[3] ^ temp[3];
        }
    }