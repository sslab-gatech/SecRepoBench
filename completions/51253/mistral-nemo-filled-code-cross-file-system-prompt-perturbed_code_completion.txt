for (i = 0; i < rounds; i++) {
        if (decrypt) {
            if (i == 0) {
                addkey_s(&a->state[1], tk, &a->round_key[i]);
                aes_crypt(a, 0, inv_sbox, dec_multbl);
            } else {
                addkey_s(&a->state[1], &a->state[0], &a->round_key[i]);
                aes_crypt(a, 0, inv_sbox, dec_multbl);
            }
        } else {
            if (i == 0) {
                addkey_s(&a->state[1], tk, &a->round_key[i]);
                aes_crypt(a, 1, sbox, enc_multbl);
            } else {
                addkey_s(&a->state[1], &a->state[0], &a->round_key[i]);
                aes_crypt(a, 1, sbox, enc_multbl);
            }
        }
        memcpy(&a->round_key[i + 1], &a->state[0], 16);
    }
    if (!decrypt)
        reverse_round_keys(a->round_key, rounds);