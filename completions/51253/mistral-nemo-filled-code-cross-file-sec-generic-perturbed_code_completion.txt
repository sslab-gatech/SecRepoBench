for (i = 1; i < rounds; i++) {
        for (int j = 0; j < 4; j++)
            tk[i][j] = tk[i - 1][j] ^ sbox[tk[i - 1][j + 3]] ^ rcon[rconpointer++];
        memcpy(a->round_key[i].u8, tk[i], 4);
    }

    if (decrypt) {
        for (i = rounds - 1; i > 0; i--) {
            for (int j = 0; j < 4; j++)
                tk[i][j] = tk[i - 1][j] ^ inv_sbox[tk[i - 1][j + 3]] ^ rcon[rconpointer++];
            memcpy(a->round_key[i].u8, tk[i], 4);
        }
    }