for (i = 1; i < rounds; i++) {
        for (t = 0; t < 4; t++) {
            tk[(i * 4) + t] = tk[(i * 4) - 4 + t] ^ sbox[(tk[(i * 4) - 1 + t] ^ rcon[rconpointer])];
        }
        rconpointer = (rconpointer + 1) % 10;
        memcpy(a->round_key[i].u8, tk[i * 4], 16);
    }

    if (decrypt) {
        for (i = 1; i < rounds; i++) {
            for (t = 0; t < 4; t++) {
                tk[(i * 4) + t] = tk[(i * 4) - 4 + t] ^ inv_sbox[(tk[(i * 4) - 1 + t] ^ rcon[9 - rconpointer])];
            }
            rconpointer = (rconpointer + 1) % 10;
            memcpy(a->round_key[i].u8, tk[i * 4], 16);
        }
    } else {
        for (i = 1; i < rounds; i++) {
            memcpy(a->round_key[i].u8, tk[i * 4], 16);
        }
    }