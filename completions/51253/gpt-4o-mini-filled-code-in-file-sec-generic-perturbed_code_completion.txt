for (i = 1; i <= rounds; i++) {
        uint8_t temp[4];
        memcpy(temp, &tk[KC - 1], 4);
        // Rotate the last word
        uint8_t t = temp[0];
        memmove(temp, temp + 1, 3);
        temp[3] = t;

        // Apply S-box substitution
        for (int j = 0; j < 4; j++) {
            temp[j] = sbox[temp[j]];
        }

        // XOR with Rcon
        temp[0] ^= rcon[rconpointer++];
        
        // Generate the round key
        for (int j = 0; j < 4; j++) {
            a->round_key[i].u8[j] = a->round_key[i - 1].u8[j] ^ temp[j];
            if (i == rounds) {
                a->round_key[i].u8[j + 4] = a->round_key[i - 1].u8[j + 4] ^ a->round_key[i].u8[j];
            }
        }
        
        // Prepare for the next round key generation
        if (i < rounds) {
            memcpy(tk[i % KC], a->round_key[i].u8, 16);
        }
    }