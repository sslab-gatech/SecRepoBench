for (i = 0; i < TagCount; i++)
{
    if (io->Read(io, &TagEntry, sizeof(cmsTagEntry), 1) != 1) {
        cmsSignalError(Icc->ContextID, cmsERROR_RANGE, "Error reading tag directory entry %u", i);
        return FALSE;
    }

    cmsUInt32Number sig    = _cmsAdjustEndianess32(TagEntry.sig);
    cmsUInt32Number offset = _cmsAdjustEndianess32(TagEntry.offset);
    cmsUInt32Number size   = _cmsAdjustEndianess32(TagEntry.size);

    // Ensure the tag falls within file bounds
    if ((offset + size) > HeaderSize || (offset + size) > Icc->IOhandler->ReportedSize) {
        cmsSignalError(Icc->ContextID, cmsERROR_RANGE,
                       "Tag 0x%x out of profile size (offset %u, size %u)",
                       sig, offset, size);
        continue; // Skip invalid entry
    }

    // Record tag info
    Icc->TagNames[Icc->TagCount]         = (cmsTagSignature) sig;
    Icc->TagOffsets[Icc->TagCount]       = offset;
    Icc->TagSizes[Icc->TagCount]         = size;
    Icc->TagPtrs[Icc->TagCount]          = NULL;
    Icc->TagTypeHandlers[Icc->TagCount]  = NULL;
    Icc->TagSaveAsRaw[Icc->TagCount]     = FALSE;
    Icc->TagLinked[Icc->TagCount]        = 0;

    // Search for and record any links among already processed tags
    for (j = 0; j < Icc->TagCount; j++) {
        if (Icc->TagOffsets[j] == offset && Icc->TagSizes[j] == size) {
            Icc->TagLinked[Icc->TagCount] = Icc->TagNames[j];
            break;
        }
    }

    // Increment the count of valid tags found
    Icc->TagCount++;
}

return TRUE;