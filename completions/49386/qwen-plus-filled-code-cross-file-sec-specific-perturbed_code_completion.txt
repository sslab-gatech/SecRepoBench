Icc -> Tags = (cmsTagEntry *) calloc(TagCount, sizeof(cmsTagEntry));
if (Icc -> Tags == NULL) {
    cmsSignalError(Icc ->ContextID, cmsERROR_UNKNOWN, "Memory allocation failed");
    return FALSE;
}

for (i = 0; i < TagCount; i++) {

    if (!_cmsReadUInt32Number(io, &TagEntry.sig)) {
        free(Icc -> Tags);
        Icc -> Tags = NULL;
        return FALSE;
    }

    if (!_cmsReadUInt32Number(io, &TagEntry.offset)) {
        free(Icc -> Tags);
        Icc -> Tags = NULL;
        return FALSE;
    }

    if (!_cmsReadUInt32Number(io, &TagEntry.size)) {
        free(Icc -> Tags);
        Icc -> Tags = NULL;
        return FALSE;
    }

    // Perform basic sanity checks
    if (TagEntry.offset > HeaderSize || TagEntry.size > HeaderSize || TagEntry.offset + TagEntry.size > HeaderSize) {
        cmsSignalError(Icc ->ContextID, cmsERROR_RANGE, "Invalid tag offset or size");
        free(Icc -> Tags);
        Icc -> Tags = NULL;
        return FALSE;
    }

    // Assign values to the corresponding fields in the Icc structure
    Icc -> Tags[i].sig = TagEntry.sig;
    Icc -> Tags[i].offset = _cmsAdjustEndianess32(TagEntry.offset);
    Icc -> Tags[i].size   = _cmsAdjustEndianess32(TagEntry.size);
    Icc -> Tags[i].linked = _cmsAdjustEndianess32(0);

    Icc -> TagCount++;
}

// Set links between tags that share the same offset and size
SetLinks(Icc);

return TRUE;