for (i=0; i < TagCount; i++) {

    if (!_cmsReadUInt32Number(io, &TagEntry.sig)) return FALSE;
    if (!_cmsReadUInt32Number(io, &TagEntry.offset)) return FALSE;
    if (!_cmsReadUInt32Number(io, &TagEntry.size)) return FALSE;

    // Sanity check
    if (TagEntry.offset + TagEntry.size > HeaderSize) {

        cmsSignalError(Icc ->ContextID, cmsERROR_CORRUPTION_DETECTED, "Tag %d out of bounds", i);
        return FALSE;
    }

    // Check if the tag is already in the table
    j = _cmsSearchTag(Icc, TagEntry.sig, FALSE);
    if (j < 0) {

        // Not found, add it
        if (!_cmsNewTag(Icc, TagEntry.sig, &j)) return FALSE;
    }
    else {

        // Found, check if it is a link
        if (Icc ->TagLinked[j]!= (cmsTagSignature) 0) {

            // It is a link, just copy the offset and size
            Icc ->TagOffsets[j] = TagEntry.offset;
            Icc ->TagSizes[j]   = TagEntry.size;
            Icc ->TagLinked[j]  = TagEntry.sig;
            continue;
        }
    }

    // Fill the tag entry
    Icc ->TagNames[j]     = TagEntry.sig;
    Icc ->TagOffsets[j]   = TagEntry.offset;
    Icc ->TagSizes[j]     = TagEntry.size;
    Icc ->TagTypeHandlers[j] = NULL;
    Icc ->TagPtrs[j]      = NULL;
    Icc ->TagSaveAsRaw[j] = FALSE;
    Icc ->TagLinked[j]    = (cmsTagSignature) 0;

    // Increment the tag count
    Icc -> TagCount++;
}