// Read tag directory
if (!_cmsReadUInt32Number(io, &TagCount)) return FALSE;
if (TagCount > MAX_TABLE_TAG) {

    cmsSignalError(Icc ->ContextID, cmsERROR_RANGE, "Too many tags (%d)", TagCount);
    return FALSE;
}

Icc -> TagCount = 0;
for (i=0; i < TagCount; i++) {
    cmsTagEntry Tag;

    if (!_cmsReadTagEntry(io, &Tag)) return FALSE;

    // Validate tag offset and size
    if (Tag.offset + Tag.size > Icc ->IOhandler ->ReportedSize) {
        cmsSignalError(Icc ->ContextID, cmsERROR_CORRUPTION_DETECTED, "Tag '%x' is out of bounds", Tag.sig);
        return FALSE;
    }

    // Add tag to profile
    Icc ->TagNames[Icc ->TagCount] = Tag.sig;
    Icc ->TagOffsets[Icc ->TagCount] = Tag.offset;
    Icc ->TagSizes[Icc ->TagCount] = Tag.size;
    Icc ->TagLinked[Icc ->TagCount] = (cmsTagSignature) 0;
    Icc ->TagPtrs[Icc ->TagCount] = NULL;
    Icc ->TagTypeHandlers[Icc ->TagCount] = NULL;
    Icc ->TagSaveAsRaw[Icc ->TagCount] = FALSE;
    Icc ->TagCount++;
}