Icc -> TagCount = TagCount;
    Icc -> TagOffsets = (cmsUInt32Number*) malloc(TagCount * sizeof(cmsUInt32Number));
    Icc -> TagSizes = (cmsUInt32Number*) malloc(TagCount * sizeof(cmsUInt32Number));
    Icc -> TagLinked = (cmsTagSignature*) malloc(TagCount * sizeof(cmsTagSignature));

    if (Icc -> TagOffsets == NULL || Icc -> TagSizes == NULL || Icc -> TagLinked == NULL) {
        free(Icc -> TagOffsets);
        free(Icc -> TagSizes);
        free(Icc -> TagLinked);
        return FALSE;
    }

    for (i = 0; i < TagCount; i++) {
        cmsTagEntry tagEntry;
        if (io -> Read(io, &tagEntry, sizeof(cmsTagEntry), 1) != 1) {
            free(Icc -> TagOffsets);
            free(Icc -> TagSizes);
            free(Icc -> TagLinked);
            return FALSE;
        }

        Icc -> TagOffsets[i] = _cmsAdjustEndianess32(tagEntry.offset);
        Icc -> TagSizes[i] = _cmsAdjustEndianess32(tagEntry.size);
        Icc -> TagLinked[i] = tagEntry.linked;

        // Basic sanity checks
        if (Icc -> TagOffsets[i] + Icc -> TagSizes[i] > Icc -> IOhandler -> ReportedSize) {
            free(Icc -> TagOffsets);
            free(Icc -> TagSizes);
            free(Icc -> TagLinked);
            return FALSE;
        }
    }

    return TRUE;