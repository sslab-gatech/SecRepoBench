bool axis_not_pinned = false;
unsigned axis_index = 0;
if (has_avar)
  seg_maps = &fontface->table.avar->get_segment_maps ();

// Iterate over each axis
for (const auto& axis : axes)
{
  hb_tag_t axis_tag = axis.get_axis_tag ();
  plan->axes_old_index_tag_map.set (axis_index, axis_tag);

  // Check if the user specified this axis
  if (!plan->user_axes_location.has (axis_tag))
  {
    axis_not_pinned = true;
    plan->axes_index_map.set (axis_index, axis_index);
  }
  else
  {
    float user_value = plan->user_axes_location.get (axis_tag);
    
    // Normalize the value
    float normal = (user_value - axis.get_min_value ()) / (axis.get_max_value () - axis.get_min_value ());
    
    // Apply avar mapping if available
    if (has_avar)
      normal = seg_maps->map (axis_index, normal);
    
    plan->axes_location.set (axis_tag, user_value);
    plan->normalized_coords[axis_index] = normal;
    
    // If the normalized value is not 0, the font is not pinned at default
    if (normal != 0.f)
      plan->pinned_at_default = false;
  }
  
  // Move to the next segment maps for avar if available
  if (has_avar)
    seg_maps = &(*seg_maps) + 1;
  
  axis_index++;
}