bool axis_not_pinned = false;
if (has_avar)
  seg_maps = &fontface->table.avar->get_segment_maps();

// Initialize variables to track axis indices and whether any axis is not pinned.
for (unsigned i = 0; i < axes.length; i++)
{
  hb_tag_t axis_tag = axes[i].axisTag;

  // Update the map from old index to tag (if your plan needs it).
  // plan->old_index_to_tag.set (i, axis_tag);

  float user_value = 0.0f;
  bool has_user_value = plan->user_axes_location.get (axis_tag, &user_value);
  if (!has_user_value)
    axis_not_pinned = true;

  // Normalize the user-provided value.
  int normalized_value = fontface->table.fvar->normalize_axis_value (i, user_value);

  // Remap the normalized value using the 'avar' segment maps, if present.
  if (has_avar && i < seg_maps->get_count ())
    normalized_value = seg_maps->get_map (i).map_value (normalized_value);

  // Set the normalized value in the plan's coordinates.
  plan->normalized_coords[i] = normalized_value;

  // If the normalized value is not zero, mark that we are not pinned at default.
  if (normalized_value != 0)
    plan->pinned_at_default = false;
}