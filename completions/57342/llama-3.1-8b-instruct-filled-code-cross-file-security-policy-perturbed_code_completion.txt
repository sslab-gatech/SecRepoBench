if (has_avar)
{
  seg_maps = &fontface->table.avar->get_segment_maps ();
  unsigned avar_axis_count = seg_maps->get_axis_count ();
  bool axis_not_pinned = true;

  for (unsigned old_axis_idx = 0; old_axis_idx < axes.length; old_axis_idx++)
  {
    if (plan->user_axes_location.has (old_axis_idx))
    {
      const OT::AxisRecord &axis = axes[old_axis_idx];
      float value = plan->user_axes_location.get (old_axis_idx);
      float normalized_value = axis.get_normalized_value (value);

      if (normalized_value!= 0)
        plan->all_axes_pinned = false;

      if (avar_axis_count > old_axis_idx)
      {
        if (seg_maps->has (old_axis_idx))
        {
          seg_maps->remap (old_axis_idx, normalized_value);
        }
        else
        {
          axis_not_pinned = false;
        }
      }
    }
  }
}