if (has_avar)
{
  seg_maps = face->table.avar->get_segment_maps ();
  unsigned avar_axis_count = face->table.avar->get_axis_count ();
  bool axis_not_pinned = true;

  for (unsigned old_axis_idx = 0; old_axis_idx < axes.length; old_axis_idx++)
  {
    if (plan->user_axes_location.has (old_axis_idx))
    {
      const OT::AxisRecord &axis = axes[old_axis_idx];
      float normalized_value = plan->user_axes_location.get (old_axis_idx);

      if (normalized_value!= 0)
        plan->all_axes_pinned = false;

      if (has_avar)
      {
        if (old_axis_idx < avar_axis_count)
        {
          seg_maps->remap_value (old_axis_idx, normalized_value);
          normalized_value = seg_maps->get_value (old_axis_idx);
        }
      }

      plan->normalized_coords[old_axis_idx] = normalized_value;
    }
    else
    {
      axis_not_pinned = false;
      plan->normalized_coords[old_axis_idx] = 0;
    }
  }
}