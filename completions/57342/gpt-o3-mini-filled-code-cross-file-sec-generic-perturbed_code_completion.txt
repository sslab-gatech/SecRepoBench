unsigned int count = axes.length;
bool axis_not_pinned = false;

for (unsigned int i = 0; i < count; i++)
{
  // Retrieve the tag for the current axis.
  hb_tag_t tag = axes[i].tag;
  // Determine the design (userâ€supplied) value; if not provided, default to 0.
  float design_value = 0.0f;
  if (plan->user_axes_location.has(tag))
    design_value = plan->user_axes_location.get(tag);
  else
    axis_not_pinned = true;

  // Normalize the design coordinate using the fvar data.
  int norm_val = fontface->table.fvar->normalize_axis_value(i, design_value);

  // If avar data is available, remap the normalized value.
  if (has_avar)
  {
    // Retrieve the segment map corresponding to this axis tag.
    const OT::SegmentMap *seg_map = fontface->table.avar->get_segment_map(tag);
    if (seg_map)
      norm_val = seg_map->map(norm_val);
  }

  // Update the plan's normalized coordinates.
  plan->normalized_coords[i] = norm_val;

  // If any normalized value is nonzero, then the axis is not pinned at its default.
  if (norm_val != 0)
    axis_not_pinned = true;
}