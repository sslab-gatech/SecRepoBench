unsigned int axis_count = axes.length;
bool axis_not_pinned = false;
hb_hashmap_t<hb_tag_t, int> old_index_tag_map;

for (unsigned int i = 0; i < axis_count; i++)
{
  hb_tag_t axis_tag = axes[i].get_axis_tag ();
  old_index_tag_map.set (axis_tag, i);

  if (!plan->user_axes_location.has (axis_tag))
  {
    axis_not_pinned = true;
    plan->axes_index_map.set (i, -1);
    continue;
  }

  float user_value = plan->user_axes_location.get (axis_tag);
  float normalized_value = axes[i].normalize_axis_value (user_value);

  if (has_avar && seg_maps)
  {
    normalized_value = seg_maps->map (normalized_value);
    seg_maps = &StructAfter<OT::SegmentMaps> (*seg_maps);
  }

  plan->axes_index_map.set (i, plan->axes_index_map.get_population ());
  plan->axes_location.set (axis_tag, user_value);
  plan->normalized_coords[i] = normalized_value;

  if (normalized_value != 0.f)
    plan->pinned_at_default = false;
}