bool axis_not_pinned = false;

  if (has_avar)
    seg_maps = fontface->table.avar->get_segment_maps ().arrayZ;

  for (unsigned i = 0; i < axes.length; i++)
  {
    const OT::AxisRecord& axis = axes[i];
    hb_tag_t tag = axis.axisTag;
    plan->axes_old_index_tag_map.set (i, tag);

    if (!plan->user_axes_location.has (tag))
    {
      axis_not_pinned = true;
      continue;
    }

    float user_val = plan->user_axes_location.get (tag);
    user_val = hb_clamp (user_val, axis.minValue, axis.maxValue);

    float normalized_val;
    if (axis.maxValue != axis.minValue)
      normalized_val = (user_val - axis.defaultValue) / (axis.maxValue - axis.minValue);
    else
      normalized_val = 0.0f;

    if (has_avar)
    {
      normalized_val = seg_maps->map (normalized_val);
      seg_maps++;
    }

    plan->user_axes_location.set (tag, normalized_val);
    plan->normalized_coords[i] = normalized_val;

    if (normalized_val != 0.0f)
      plan->pinned_at_default = false;
  }