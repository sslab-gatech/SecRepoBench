// Initialize variables to track axis indices and whether any axis is not pinned.
  bool axis_not_pinned = true;
  hb_map_t<unsigned, unsigned> old_index_to_tag_map;
  hb_map_t<unsigned, unsigned> index_map;

  // Iterate over each axis in the 'axes' array.
  for (unsigned i = 0; i < axes.length; i++) {
    OT::AxisRecord axis = axes[i];
    unsigned old_index = i;
    unsigned tag = axis.tag;

    // Update the map from old index to tag.
    old_index_to_tag_map.set(old_index, tag);

    // Check if the axis is present in the user's axis location settings.
    if (plan->user_axes_location.has(tag)) {
      // If the axis is set by the user, normalize its value using user settings.
      float user_value = plan->user_axes_location.get(tag);
      float normalized_value = hb_ot_var_normalize_coords(face, 1, &user_value, &normalized_value);

      // If 'avar' data is available, remap the normalized value using the segment maps.
      if (has_avar) {
        seg_maps = face->table.avar->get_segment_maps(tag);
        normalized_value = seg_maps->remap(normalized_value);
      }

      // Set the normalized value in the plan's axes location and coordinates.
      plan->normalized_coords[i] = normalized_value;
      if (normalized_value != 0.0f) {
        axis_not_pinned = false;
      }
    } else {
      // If the axis is not set by the user, mark it as not pinned and update the index map.
      axis_not_pinned = false;
      index_map.set(old_index, i);
    }

    // Update segment maps for 'avar' for the next axis, if applicable.
    if (has_avar && seg_maps) {
      seg_maps = seg_maps->next();
    }
  }

  // Update the plan's axes location and coordinates using the index map.
  for (unsigned i = 0; i < plan->normalized_coords.length; i++) {
    if (index_map.has(i)) {
      plan->normalized_coords[i] = plan->normalized_coords[index_map.get(i)];
    }
  }

  // Set the plan's all_axes_pinned flag based on the axis_not_pinned variable.
  plan->all_axes_pinned = axis_not_pinned;