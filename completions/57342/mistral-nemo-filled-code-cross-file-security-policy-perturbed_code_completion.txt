for (old_axis_idx = 0; old_axis_idx < axes.length; old_axis_idx++) {
    OT::AxisTag axis_tag = axes[old_axis_idx].tag;
    plan->old_to_tag_map.set (old_axis_idx, axis_tag);

    if (plan->user_axes_location.has (axis_tag)) {
      axis_not_pinned = true;
      float user_value = plan->user_axes_location.get (axis_tag);
      plan->normalized_coords[old_axis_idx] = hb_ot_var_normalize_coords (fontface, 1, &user_value, &normalized_value);
      if (has_avar && seg_maps) {
        plan->normalized_coords[old_axis_idx] = seg_maps->remap (old_axis_idx, plan->normalized_coords[old_axis_idx]);
      }
      plan->axes_location.set (axis_tag, normalized_value);
      if (normalized_value != 0.0f) {
        plan->all_axes_pinned = false;
      }
    } else {
      axis_not_pinned = false;
      plan->normalized_coords[old_axis_idx] = hb_ot_var_normalize_coords (fontface, 1, &axes[old_axis_idx].default_value, &normalized_value);
      plan->old_to_tag_map.set (old_axis_idx, axis_tag);
      if (has_avar && seg_maps) {
        seg_maps->update (old_axis_idx, normalized_value);
      }
    }
  }