bool axis_not_pinned = false;
unsigned avar_axis_count = has_avar? seg_maps->get_axis_count () : 0;
hb_map_t<unsigned, hb_tag_t> old_axis_idx_to_tag;
for (unsigned old_axis_idx = 0; old_axis_idx < axes.length; old_axis_idx++) {
  const OT::AxisRecord &axis = axes[old_axis_idx];
  hb_tag_t axis_tag = axis.axisTag;
  old_axis_idx_to_tag.set (old_axis_idx, axis_tag);

  if (plan->user_axes_location.has (axis_tag)) {
    float value = plan->user_axes_location.get (axis_tag);
    int normalized = hb_clamp (value, axis.minimumValue, axis.maximumValue);
    if (has_avar && old_axis_idx < avar_axis_count) {
      int remapped = seg_maps->remap_axis (old_axis_idx, normalized);
      plan->normalized_coords[old_axis_idx] = remapped;
    } else {
      plan->normalized_coords[old_axis_idx] = normalized;
    }
    if (normalized!= 0) {
      plan->pinned_at_default = false;
    }
  } else {
    axis_not_pinned = true;
    plan->normalized_coords[old_axis_idx] = 0;
  }
}