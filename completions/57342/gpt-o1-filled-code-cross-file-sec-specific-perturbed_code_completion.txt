bool axis_not_pinned = false;

  hb_vector_t<float> design_coords;
  design_coords.resize (axes.length);

  // Gather user-specified or default axis values into design_coords.
  for (unsigned i = 0; i < axes.length; i++)
  {
    float val = 0.0f;
    if (plan->user_axes_location.has (axes[i].axisTag))
      val = plan->user_axes_location.get (axes[i].axisTag);

    design_coords[i] = val;
  }

  // Normalize axis values.
  hb_vector_t<int> temp_normalized;
  temp_normalized.resize (axes.length);
  for (unsigned i = 0; i < axes.length; i++)
    temp_normalized[i] = fontface->table.fvar->normalize_axis_value (i, design_coords[i]);

  // Apply 'avar' adjustments if available.
  if (has_avar)
    fontface->table.avar->map_coords (temp_normalized, axes.length);

  // Fill plan->normalized_coords and track if any axis is not pinned at zero.
  for (unsigned i = 0; i < axes.length; i++)
  {
    plan->normalized_coords[i] = temp_normalized[i];
    if (plan->normalized_coords[i] != 0)
      axis_not_pinned = true;
  }