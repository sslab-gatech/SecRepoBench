bool axis_not_pinned = false;
  bool pinned_at_default = true;

  if (has_avar)
    seg_maps = fontface->table.avar->get_segment_maps ();

  for (unsigned i = 0; i < axes.length; i++)
  {
    hb_tag_t axis_tag = axes[i].axisTag;
    // Update the map from old index to tag.
    plan->old_index_to_axis_tag.set (i, axis_tag);

    float user_value = 0.f;
    // Check if user has provided a value for this axis.
    if (!plan->user_axes_location.get (axis_tag, &user_value))
      axis_not_pinned = true;

    // Normalize the user value.
    int normalized_val = fontface->table.fvar->normalize_axis_value (i, user_value);

    // If 'avar' is present, remap using the segment maps.
    if (has_avar && seg_maps)
      normalized_val = seg_maps[i].map (normalized_val);

    // Store user and normalized values in the plan.
    plan->axes_location.set (axis_tag, user_value);
    plan->normalized_coords[i] = normalized_val;

    // If the normalized value is not zero, it's not pinned at default.
    if (normalized_val != 0)
      pinned_at_default = false;
  }

  plan->all_axes_pinned = !axis_not_pinned;