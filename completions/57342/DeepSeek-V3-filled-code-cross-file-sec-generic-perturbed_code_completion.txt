bool axis_not_pinned = false;
  hb_map_t old_idx_tag_map;
  unsigned axis_index = 0;

  for (const auto& axis : axes)
  {
    hb_tag_t tag = axis.get_axis_tag();
    old_idx_tag_map.set(axis_index, tag);

    if (plan->user_axes_location.has(tag))
    {
      float user_val = plan->user_axes_location.get(tag);
      int normalized_val = axis.normalize_value(user_val);

      if (has_avar)
      {
        if (seg_maps == nullptr || axis_index >= axes.length)
          seg_maps = fontface->table.avar->get_segment_maps(axis_index);
        if (seg_maps)
          normalized_val = seg_maps->map(normalized_val);
      }

      plan->normalized_coords[axis_index] = normalized_val;
      plan->axes_location.set(tag, normalized_val);

      if (normalized_val != 0)
        plan->pinned_at_default = false;
    }
    else
    {
      axis_not_pinned = true;
    }

    axis_index++;
  }

  plan->old_axis_index_tag_map = std::move(old_idx_tag_map);