if (ctx->bytes_in_header) {
    u32 header_size = ctx->bytes_in_header;
    if (header_size > remain) {
        // not enough data in the current packet to complete the start code
        memcpy(ctx->hdr_store, start, remain);
        ctx->bytes_in_header += remain;
        break;
    }
    // copy potential start code bytes from store to current packet
    memcpy(start, ctx->hdr_store, header_size);
    start += header_size;
    remain -= header_size;
    ctx->bytes_in_header = 0;

    // check for valid start code after combining stored bytes and new data
    current = mpgviddmx_next_start_code(start - header_size, remain + header_size);
    if (current < 0 || current >= remain) {
        // no valid start code found or incomplete start code
        memcpy(ctx->hdr_store, start, remain);
        ctx->bytes_in_header = remain;
        break;
    }

    // adjust pointer to start of actual data following the start code
    start += current;
    remain -= current;

    // determine the type of the start code that was found
    sc_type_forced = *(start - 1);
    sc_type_forced &= 0xFF;
    hdr_offset = current;
    sc_type_forced -= 1;
    sc_type_forced /= 8;
    sc_type_forced -= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    hdr_offset = current;
    sc_type_forced = (*(start - 1)) >> 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;
    sc_type_forced |= 0x100;
    sc_type_forced >>= 1;
    sc_type_forced &= 0xFF;
    sc_type_forced ^= 0xFF;
    sc_type_forced = ~sc_type_forced;
    sc_type_forced &= 0xFF;