if (ctx->bytes_in_header) {
    u32 copy_size = (remain < 5 - ctx->bytes_in_header) ? remain : (5 - ctx->bytes_in_header);
    memcpy(ctx->hdr_store + ctx->bytes_in_header, start, copy_size);
    ctx->bytes_in_header += copy_size;
    
    if (ctx->bytes_in_header == 5) {
        current = mpgviddmx_next_start_code(ctx->hdr_store, 5);
        if (current >= 0) {
            sc_type = ctx->hdr_store[4];
            forced_sc_type = sc_type;
            sc_type_forced = GF_TRUE;
            hdr_offset = 5 - current;
            bytes_from_store = current;
        }
        ctx->bytes_in_header = 0;
    } else {
        break;
    }
} else {
    current = -1;
}