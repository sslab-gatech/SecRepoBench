if (ctx->bytes_in_header > 0) {
    u8 tmp[5];
    u32 tmp_size = ctx->bytes_in_header + remain;
    tmp_size = GF_MIN(tmp_size, 5);
    memcpy(tmp, ctx->hdr_store, ctx->bytes_in_header);
    if (remain > 0)
        memcpy(tmp + ctx->bytes_in_header, start, tmp_size - ctx->bytes_in_header);
    s32 found_pos = -1;
    for (u32 i = 0; i <= tmp_size -4; i++) {
        if (tmp[i] == 0x00 && tmp[i+1] == 0x00 && tmp[i+2] == 0x01) {
            found_pos = i;
            break;
        }
    }
    if (found_pos != -1) {
        if (found_pos > 0) {
            dst_pck = gf_filter_pck_new_alloc(ctx->opid, found_pos, &packet_data);
            if (!dst_pck) return GF_OUT_OF_MEM;
            memcpy(packet_data, ctx->hdr_store, found_pos);
            if (ctx->src_pck) gf_filter_pck_merge_properties(ctx->src_pck, dst_pck);
            gf_filter_pck_set_framing(dst_pck, GF_FALSE, GF_FALSE);
            gf_filter_pck_set_cts(dst_pck, GF_FILTER_NO_TS);
            gf_filter_pck_set_dts(dst_pck, GF_FILTER_NO_TS);
            mpgviddmx_enqueue_or_dispatch(ctx, dst_pck, GF_FALSE, GF_FALSE);
        }
        u32 bytes_used = found_pos + 3;
        if (bytes_used > ctx->bytes_in_header) {
            u32 from_new = bytes_used - ctx->bytes_in_header;
            start += from_new;
            remain -= from_new;
            ctx->bytes_in_header = 0;
        } else {
            ctx->bytes_in_header -= bytes_used;
            memmove(ctx->hdr_store, ctx->hdr_store + bytes_used, ctx->bytes_in_header);
        }
        forced_sc_type = tmp[found_pos + 3];
        sc_type_forced = GF_TRUE;
        hdr_offset = 4;
        current = 0;
    } else {
        dst_pck = gf_filter_pck_new_alloc(ctx->opid, ctx->bytes_in_header, &packet_data);
        if (!dst_pck) return GF_OUT_OF_MEM;
        memcpy(packet_data, ctx->hdr_store, ctx->bytes_in_header);
        if (ctx->src_pck) gf_filter_pck_merge_properties(ctx->src_pck, dst_pck);
        gf_filter_pck_set_framing(dst_pck, GF_FALSE, GF_FALSE);
        gf_filter_pck_set_cts(dst_pck, GF_FILTER_NO_TS);
        gf_filter_pck_set_dts(dst_pck, GF_FILTER_NO_TS);
        mpgviddmx_enqueue_or_dispatch(ctx, dst_pck, GF_FALSE, GF_FALSE);
        ctx->bytes_in_header = 0;
    }
}