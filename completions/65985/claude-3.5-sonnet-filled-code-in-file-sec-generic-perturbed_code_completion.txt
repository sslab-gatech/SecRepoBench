if (ctx->bytes_in_header) {
    u32 copy_size = (remain < ctx->bytes_in_header) ? remain : ctx->bytes_in_header;
    memcpy(ctx->hdr_store + ctx->bytes_in_header, start, copy_size);
    ctx->bytes_in_header += copy_size;

    if (ctx->bytes_in_header >= 4) {
        current = mpgviddmx_next_start_code(ctx->hdr_store, ctx->bytes_in_header);
        if (current >= 0) {
            sc_type = ctx->hdr_store[3];
            sc_type_forced = GF_TRUE;
            forced_sc_type = sc_type;
            bytes_from_store = current + 4;
            hdr_offset = 4;
        }
    }

    if (!sc_type_forced) {
        start += copy_size;
        remain -= copy_size;
        continue;
    }
} else {
    current = mpgviddmx_next_start_code(start, remain);
}