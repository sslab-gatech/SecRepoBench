if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE) {
            if (codeccontext->subtitle_header) {
                av_freep(&codeccontext->subtitle_header);
            }

            if (codeccontext->codec->flags & AV_CODEC_FLAG_BITMAP_SUBTITLE) {
                if (codeccontext->sub_text_format) {
                    av_log(codeccontext, AV_LOG_WARNING, "Character encoding not applicable to bitmap-based subtitle codec; ignoring.\n");
                    codeccontext->sub_text_format = NULL;
                }
            } else {
                if (codeccontext->sub_text_format == NULL || !strcmp(codeccontext->sub_text_format, "auto")) {
                    codeccontext->sub_text_format = av_strdup("pre-decoder");
                }

#if CONFIG_ICONV
                if (strcmp(codeccontext->sub_text_format, "pre-decoder")) {
                    av_log(codeccontext, AV_LOG_WARNING, "Character encoding '%s' not supported; using 'pre-decoder'.\n", codeccontext->sub_text_format);
                    av_free(codeccontext->sub_text_format);
                    codeccontext->sub_text_format = av_strdup("pre-decoder");
                }
#else
                if (strcmp(codeccontext->sub_text_format, "pre-decoder")) {
                    av_log(codeccontext, AV_LOG_WARNING, "Character encoding specified but iconv not available; falling back to 'pre-decoder'.\n");
                    av_free(codeccontext->sub_text_format);
                    codeccontext->sub_text_format = av_strdup("pre-decoder");
                }
#endif
            }
        }