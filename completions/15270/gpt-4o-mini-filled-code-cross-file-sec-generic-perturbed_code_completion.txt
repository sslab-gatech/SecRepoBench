if (codeccontext->codec->type == AVMEDIA_TYPE_SUBTITLE) {
            if (codeccontext->subtitle_character_encoding) {
                av_log(codeccontext, AV_LOG_WARNING, "Character encoding is set for a bitmap-based subtitle codec, ignoring.\n");
            } else {
                // Set character encoding mode to pre-decoder if in automatic mode
                if (codeccontext->subtitle_character_encoding == AV_SUBTITLE_CHAR_ENCODING_AUTO) {
                    codeccontext->subtitle_character_encoding = AV_SUBTITLE_CHAR_ENCODING_PRE_DECODER;
                }
                // Validate input encoding if iconv is available
                #ifdef HAVE_ICONV
                if (validate_encoding(codeccontext->subtitle_character_encoding) < 0) {
                    av_log(codeccontext, AV_LOG_ERROR, "Invalid character encoding specified.\n");
                    ret = AVERROR(EINVAL);
                    goto free_and_end;
                }
                #endif
            }
        }