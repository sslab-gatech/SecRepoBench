// Check if subtitle character encoding is set and handle accordingly.
// Ensure that character encoding is only used with subtitle codecs.
// If the codec is bitmap-based, character encoding is ignored with a warning.
// For text-based subtitle codecs, set the character encoding mode to pre-decoder
// if it is in automatic mode and validate the input encoding using iconv if available.
if (av_codec_is_decoder(codeccontext->codec) && codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE) {
    if (codeccontext->sub_charenc_mode == FF_SUB_CHARENC_MODE_AUTOMATIC) {
        codeccontext->sub_charenc_mode = FF_SUB_CHARENC_MODE_PRE_DECODER;
    }

    if (codeccontext->sub_charenc && codeccontext->bits_per_coded_sample > 0) {
        int ret = avcodec_check_subtitle_charset(codeccontext);
        if (ret < 0) {
            av_log(codeccontext, AV_LOG_WARNING, "Invalid subtitle character encoding '%s'\n", codeccontext->sub_charenc);
            codeccontext->sub_charenc_mode = FF_SUB_CHARENC_MODE_IGNORE;
        }
    } else {
        av_log(codeccontext, AV_LOG_WARNING, "Subtitle codec is bitmap-based, ignoring character encoding\n");
        codeccontext->sub_charenc_mode = FF_SUB_CHARENC_MODE_IGNORE;
    }
}