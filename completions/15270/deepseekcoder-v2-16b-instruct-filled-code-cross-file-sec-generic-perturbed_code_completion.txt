// Check if subtitle character encoding is set and handle accordingly.
// Ensure that character encoding is only used with subtitle codecs.
// If the codec is bitmap-based, character encoding is ignored with a warning.
// For text-based subtitle codecs, set the character encoding mode to pre-decoder
// if it is in automatic mode and validate the input encoding using iconv if available.
if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE && codeccontext->subtitle_header) {
    if (codeccontext->subtitle_charset) {
        if (codeccontext->subtitle_header[0] && codeccontext->subtitle_header[1]) {
            // Validate and set the character encoding mode if necessary
            if (iconv_open("UTF-8", codeccontext->subtitle_charset) != (iconv_t)-1) {
                codeccontext->subtitle_header[0] = '\0'; // Indicate that charset is set
                codeccontext->subtitle_header[1] = '\0'; // Indicate that charset is set
            } else {
                av_log(codeccontext, AV_LOG_WARNING, "Invalid character encoding specified: %s\n", codeccontext->subtitle_charset);
            }
        } else {
            av_log(codeccontext, AV_LOG_WARNING, "Character encoding is set but subtitle header is not properly initialized\n");
        }
    } else {
        if (codeccontext->codec_id == AV_CODEC_ID_SUBRIP || codeccontext->codec_id == AV_CODEC_ID_TEXT) {
            // Automatically set the character encoding mode for text-based subtitle codecs
            codeccontext->subtitle_header[0] = '\0'; // Indicate that charset is set
            codeccontext->subtitle_header[1] = '\0'; // Indicate that charset is set
        } else {
            av_log(codeccontext, AV_LOG_WARNING, "Character encoding is not set for non-text subtitle codec\n");
        }
    }
}