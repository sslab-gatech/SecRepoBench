if (codeccontext->subtitle_header) {
        av_freep(&codeccontext->subtitle_header);
    }

    if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE) {
        const char *encoding = av_dict_get(*options, "encoding", NULL, 0) ? av_dict_get(*options, "encoding", NULL, 0)->value : NULL;
        if (encoding) {
            // Validate the encoding against known values
            if (strcmp(encoding, "UTF-8") != 0 && strcmp(encoding, "ISO-8859-1") != 0) {
                av_log(codeccontext, AV_LOG_WARNING, "Unsupported subtitle encoding: %s. Defaulting to UTF-8.\n", encoding);
                encoding = "UTF-8";
            }
            // Set the encoding in the codec context or handle it as needed
            // This is a placeholder for actual encoding handling logic
        }
    }