if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE) {
        if (codeccontext->subtitle_header) {
            av_freep(&codeccontext->subtitle_header);
        }
        if (codeccontext->subtitle_header_size > 0) {
            codeccontext->subtitle_header = av_malloc(codeccontext->subtitle_header_size);
            if (!codeccontext->subtitle_header) {
                ret = AVERROR(ENOMEM);
                goto free_and_end;
            }
            if (avcodec_decode_subtitle2(codeccontext, &sub, &got_sub_ptr, &avpkt, &subpkt) < 0) {
                ret = AVERROR(EINVAL);
                goto free_and_end;
            }
            if (got_sub_ptr) {
                av_subtitle_free(&sub);
            }
        }
    }