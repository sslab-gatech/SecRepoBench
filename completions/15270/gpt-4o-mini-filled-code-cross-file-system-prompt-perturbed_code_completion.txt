if (codeccontext->codec->type == AVMEDIA_TYPE_SUBTITLE) {
            if (codeccontext->subtitle_header) {
                av_log(codeccontext, AV_LOG_WARNING, "Character encoding is ignored for bitmap-based subtitles.\n");
            } else {
                // Set character encoding for text-based subtitles if not already set
                if (codeccontext->subtitle_character_encoding == NULL) {
                    codeccontext->subtitle_character_encoding = "UTF-8"; // Default to UTF-8
                }
                // Validate the character encoding if iconv is available
                #ifdef HAVE_ICONV
                if (iconv_open(codeccontext->subtitle_character_encoding, "UTF-8") == (iconv_t)-1) {
                    av_log(codeccontext, AV_LOG_ERROR, "Invalid character encoding: %s\n", codeccontext->subtitle_character_encoding);
                    ret = AVERROR(EINVAL);
                    goto free_and_end;
                }
                #endif
            }
        }