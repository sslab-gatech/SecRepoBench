if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE) {
            if (codeccontext->sub_charenc) {
                if (codeccontext->codec->capabilities & AV_CODEC_CAP_BITMAP_SUB) {
                    av_log(codeccontext, AV_LOG_WARNING,
                           "Character encoding %s specified for bitmap subtitle codec, ignoring\n",
                           codeccontext->sub_charenc);
                } else {
                    if (codeccontext->sub_charenc_mode == FF_SUB_CHARENC_MODE_AUTOMATIC)
                        codeccontext->sub_charenc_mode = FF_SUB_CHARENC_MODE_PRE_DECODER;
                    if (codeccontext->sub_charenc_mode == FF_SUB_CHARENC_MODE_PRE_DECODER) {
                        ret = avcodec_open_subtitle_charenc(codeccontext, codeccontext->sub_charenc);
                        if (ret < 0)
                            goto free_and_end;
                    }
                }
            }
        }