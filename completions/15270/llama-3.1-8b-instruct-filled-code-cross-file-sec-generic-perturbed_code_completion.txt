if (av_codec_is_decoder(codeccontext->codec)) {
    if (codeccontext->codec->priv_data_size > 0 && codeccontext->priv_data) {
        if (codeccontext->codec->priv_class && (ret = av_opt_set_dict(codeccontext->priv_data, &tmp)) < 0)
            goto free_and_end;
    }
    if (codeccontext->codec->check_sample_fmt(codeccontext->sample_fmt) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified sample format %s is not supported\n",
               (char *)av_x_if_null(av_get_sample_fmt_name(codeccontext->sample_fmt), "unknown"));
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_sample_rate(codeccontext->sample_rate) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified sample rate %d is not supported\n",
               codeccontext->sample_rate);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_channel_layout(codeccontext->channel_layout) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified channel layout '%s' is not supported\n",
               (char *)av_get_channel_layout_string(NULL, 0, -1, codeccontext->channel_layout));
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_bit_rate(codeccontext->bit_rate) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified bitrate %d is not supported\n",
               codeccontext->bit_rate);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_max_b_frames(codeccontext->max_b_frames) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified max_b_frames %d is not supported\n",
               codeccontext->max_b_frames);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_gop_size(codeccontext->gop_size) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified gop_size %d is not supported\n",
               codeccontext->gop_size);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_qscale(codeccontext->qscale) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified qscale %d is not supported\n",
               codeccontext->qscale);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_threads(codeccontext->thread_count) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified thread_count %d is not supported\n",
               codeccontext->thread_count);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_flags(codeccontext->flags) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified flags %d are not supported\n",
               codeccontext->flags);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_priv_data(codeccontext->priv_data) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified priv_data is not supported\n");
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_extra_data(codeccontext->extradata, codeccontext->extradata_size) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified extra_data is not supported\n");
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_len(codeccontext->pkt_len) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_len %d is not supported\n",
               codeccontext->pkt_len);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_pts(codeccontext->pkt_pts) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_pts %d is not supported\n",
               codeccontext->pkt_pts);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_dts(codeccontext->pkt_dts) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_dts %d is not supported\n",
               codeccontext->pkt_dts);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_pos(codeccontext->pkt_pos) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_pos %d is not supported\n",
               codeccontext->pkt_pos);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_duration(codeccontext->pkt_duration) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_duration %d is not supported\n",
               codeccontext->pkt_duration);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec(codeccontext->pkt_stream_codec) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec %d is not supported\n",
               codeccontext->pkt_stream_codec);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_id(codeccontext->pkt_stream_codec_id) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_id %d is not supported\n",
               codeccontext->pkt_stream_codec_id);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_type(codeccontext->pkt_stream_codec_type) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_type %d is not supported\n",
               codeccontext->pkt_stream_codec_type);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_tag(codeccontext->pkt_stream_codec_tag) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_tag %d is not supported\n",
               codeccontext->pkt_stream_codec_tag);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra(codeccontext->pkt_stream_codec_extra) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra %d is not supported\n",
               codeccontext->pkt_stream_codec_extra);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_size(codeccontext->pkt_stream_codec_extra_size) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_size %d is not supported\n",
               codeccontext->pkt_stream_codec_extra_size);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data(codeccontext->pkt_stream_codec_extra_data) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data is not supported\n");
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_size(codeccontext->pkt_stream_codec_extra_data_size) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_size %d is not supported\n",
               codeccontext->pkt_stream_codec_extra_data_size);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_offset(codeccontext->pkt_stream_codec_extra_data_offset) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_offset %d is not supported\n",
               codeccontext->pkt_stream_codec_extra_data_offset);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_len(codeccontext->pkt_stream_codec_extra_data_len) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_len %d is not supported\n",
               codeccontext->pkt_stream_codec_extra_data_len);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_ptr(codeccontext->pkt_stream_codec_extra_data_ptr) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_ptr is not supported\n");
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_ptr_size(codeccontext->pkt_stream_codec_extra_data_ptr_size) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_ptr_size %d is not supported\n",
               codeccontext->pkt_stream_codec_extra_data_ptr_size);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_ptr_offset(codeccontext->pkt_stream_codec_extra_data_ptr_offset) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_ptr_offset %d is not supported\n",
               codeccontext->pkt_stream_codec_extra_data_ptr_offset);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_ptr_len(codeccontext->pkt_stream_codec_extra_data_ptr_len) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_ptr_len %d is not supported\n",
               codeccontext->pkt_stream_codec_extra_data_ptr_len);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_ptr_ptr(codeccontext->pkt_stream_codec_extra_data_ptr_ptr) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_ptr_ptr is not supported\n");
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_ptr_ptr_size(codeccontext->pkt_stream_codec_extra_data_ptr_ptr_size) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_ptr_ptr_size %d is not supported\n",
               codeccontext->pkt_stream_codec_extra_data_ptr_ptr_size);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_ptr_ptr_offset(codeccontext->pkt_stream_codec_extra_data_ptr_ptr_offset) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_ptr_ptr_offset %d is not supported\n",
               codeccontext->pkt_stream_codec_extra_data_ptr_ptr_offset);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_ptr_ptr_len(codeccontext->pkt_stream_codec_extra_data_ptr_ptr_len) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_ptr_ptr_len %d is not supported\n",
               codeccontext->pkt_stream_codec_extra_data_ptr_ptr_len);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_ptr_ptr_ptr(codeccontext->pkt_stream_codec_extra_data_ptr_ptr_ptr) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_ptr_ptr_ptr is not supported\n");
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_ptr_ptr_ptr_size(codeccontext->pkt_stream_codec_extra_data_ptr_ptr_ptr_size) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_ptr_ptr_ptr_size %d is not supported\n",
               codeccontext->pkt_stream_codec_extra_data_ptr_ptr_ptr_size);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_ptr_ptr_ptr_offset(codeccontext->pkt_stream_codec_extra_data_ptr_ptr_ptr_offset) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_ptr_ptr_ptr_offset %d is not supported\n",
               codeccontext->pkt_stream_codec_extra_data_ptr_ptr_ptr_offset);
        ret = AVERROR(EINVAL);
        goto free_and_end;
    }
    if (codeccontext->codec->check_pkt_stream_codec_extra_data_ptr_ptr_ptr_len(codeccontext->pkt_stream_codec_extra_data_ptr_ptr_ptr_len) < 0) {
        av_log(codeccontext->codeccontext, AV_LOG_ERROR, "Specified pkt_stream_codec_extra_data_ptr_ptr_ptr_len %d is not supported\n",
               codeccontext->pkt_stream_codec_extra_dat