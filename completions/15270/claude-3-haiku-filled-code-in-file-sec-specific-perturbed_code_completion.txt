// Check if subtitle character encoding is set and handle accordingly.
// Ensure that character encoding is only used with subtitle codecs.
// If the codec is bitmap-based, character encoding is ignored with a warning.
// For text-based subtitle codecs, set the character encoding mode to pre-decoder
// if it is in automatic mode and validate the input encoding using iconv if available.
if (avctx->codec_type == AVMEDIA_TYPE_SUBTITLE) {
    if (avctx->sub_charenc_mode == FF_SUB_CHARENC_MODE_AUTOMATIC) {
        avctx->sub_charenc_mode = FF_SUB_CHARENC_MODE_PRE_DECODER;
    }
    if (avctx->sub_charenc) {
#if CONFIG_ICONV
        iconv_t cd = iconv_open("UTF-8", avctx->sub_charenc);
        if (cd == (iconv_t)-1) {
            av_log(avctx, AV_LOG_WARNING, "Unsupported input encoding '%s'\n", avctx->sub_charenc);
        } else {
            iconv_close(cd);
        }
#else
        av_log(avctx, AV_LOG_WARNING, "Subtitle character encoding is not supported\n");
#endif
    }
} else if (avctx->codec_type != AVMEDIA_TYPE_UNKNOWN) {
    av_log(avctx, AV_LOG_WARNING, "Character encoding is only supported for subtitle codecs\n");
}