if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE) {
        if (codeccontext->sub_charenc) {
            if (codeccontext->codec_descriptor && codeccontext->codec_descriptor->props & AV_CODEC_PROP_BITMAP_SUB) {
                av_log(codeccontext, AV_LOG_WARNING, "Character encoding %s specified for bitmap subtitle codec, ignoring\n", codeccontext->sub_charenc);
            } else {
                if (!codeccontext->sub_charenc_mode)
                    codeccontext->sub_charenc_mode = FF_SUB_CHARENC_MODE_PRE_DECODER;
                if (codeccontext->sub_charenc_mode == FF_SUB_CHARENC_MODE_PRE_DECODER) {
                    // Validate the character encoding
                    if (strlen(codeccontext->sub_charenc) >= MAX_CHAR_ENC_LENGTH) {
                        av_log(codeccontext, AV_LOG_ERROR, "Character encoding name too long\n");
                        ret = AVERROR(EINVAL);
                        goto free_and_end;
                    }
                    // Initialize iconv or similar library to validate encoding
                    // This is a placeholder for actual iconv initialization and validation
                    if (!is_valid_encoding(codeccontext->sub_charenc)) {
                        av_log(codeccontext, AV_LOG_ERROR, "Invalid character encoding: %s\n", codeccontext->sub_charenc);
                        ret = AVERROR(EINVAL);
                        goto free_and_end;
                    }
                }
            }
        }
    }