if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE) {
            if (codeccontext->sub_charenc_mode == FF_SUB_CHARENC_MODE_AUTO) {
                if (codeccontext->codec_descriptor->props & AV_CODEC_PROP_BITMAP_SUB) {
                    av_log(codeccontext, AV_LOG_WARNING,
                           "Codec '%s' is bitmap-based, subtitles character encoding will be ignored.\n", codeccontext->codec_descriptor->name);
                    codeccontext->sub_charenc = NULL;
                } else {
                    codeccontext->sub_charenc_mode = FF_SUB_CHARENC_MODE_PRE_DECODER;
                }
            }

            if (codeccontext->sub_charenc_mode == FF_SUB_CHARENC_MODE_PRE_DECODER) {
                if (!codeccontext->sub_charenc) {
                    codeccontext->sub_charenc = "utf-8";
                    av_log(codeccontext, AV_LOG_WARNING,
                           "Character encoding not set. Assumed to be '%s'.\n", codeccontext->sub_charenc);
                } else {
#if CONFIG_ICONV
                    iconv_t cd = iconv_open("UTF-8//IGNORE", codeccontext->sub_charenc);
                    if (cd == (iconv_t)-1) {
                        av_log(codeccontext, AV_LOG_WARNING,
                               "Character encoding '%s' is not supported.\n", codeccontext->sub_charenc);
                        if (codeccontext->strict_std_compliance > FF_COMPLIANCE_EXPERIMENTAL) {
                            ret = AVERROR(EINVAL);
                            goto free_and_end;
                        }
                        codeccontext->sub_charenc = NULL;
                    }
                    iconv_close(cd);
#else
                    av_log(codeccontext, AV_LOG_WARNING,
                           "Character encoding '%s' cannot be checked since iconv is not available.\n", codeccontext->sub_charenc);
#endif
                }
            }
        }