if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE) {
            if (codeccontext->sub_charenc_mode == FF_SUB_CHARENC_MODE_AUTO) {
                codeccontext->sub_charenc_mode = FF_SUB_CHARENC_MODE_PRE_DECODER;
            }
#if CONFIG_ICONV
            if (codeccontext->sub_charenc && codeccontext->sub_charenc_mode == FF_SUB_CHARENC_MODE_PRE_DECODER) {
                iconv_t cd = iconv_open("UTF-8", codeccontext->sub_charenc);
                if (cd == (iconv_t)-1) {

                    if (codeccontext->strict_std_compliance > FF_COMPLIANCE_EXPERIMENTAL) {
                        av_log(codeccontext, AV_LOG_ERROR, "Character encoding '%s' is not supported.\n", codeccontext->sub_charenc);
                        ret = AVERROR(EINVAL);
                        goto free_and_end;
                    } else {
                        av_log(codeccontext, AV_LOG_WARNING, "Character encoding '%s' is not supported, but strict mode is disabled, continuing anyway.\n", codeccontext->sub_charenc);
                    }

                }
                iconv_close(cd);

            }
#endif
            if (codeccontext->codec_descriptor->props & AV_CODEC_PROP_BITMAP_SUB) {
                if (codeccontext->sub_charenc) {
                    av_log(codeccontext, AV_LOG_WARNING, "Codec '%s' is bitmap-based, ignoring character encoding '%s'.\n", codeccontext->codec_descriptor->name, codeccontext->sub_charenc);
                }
            }
        } else {
            if (codeccontext->sub_charenc) {
                av_log(codeccontext, AV_LOG_WARNING, "Character encoding is only applicable to subtitles, ignoring '%s' for codec '%s'.\n", codeccontext->sub_charenc, codeccontext->codec_descriptor->name);
            }
        }