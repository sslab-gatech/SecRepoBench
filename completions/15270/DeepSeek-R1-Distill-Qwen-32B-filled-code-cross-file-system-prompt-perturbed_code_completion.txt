if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE) {
        if (codeccontext->subtitle_char_encoding) {
            iconv_t cd = iconv_open("UTF-8", codeccontext->subtitle_char_encoding);
            if (cd == (iconv_t)-1) {
                av_log(codeccontext, AV_LOG_ERROR, "Invalid subtitle character encoding: %s\n", codeccontext->subtitle_char_encoding);
                ret = AVERROR(EINVAL);
                goto free_and_end;
            }
            iconv_close(cd);
            codeccontext->subtitle_encoding_mode = SUBTITLE_ENCODING_MODE_PRE_DECODER;
        }
        if (codec->capabilities & AV_CODEC_CAP_BITMAP_SUBTITLE) {
            av_log(codeccontext, AV_LOG_WARNING, "Subtitle character encoding ignored for bitmap-based subtitle codec\n");
            codeccontext->subtitle_encoding_mode = SUBTITLE_ENCODING_MODE_AUTO;
        }
    }