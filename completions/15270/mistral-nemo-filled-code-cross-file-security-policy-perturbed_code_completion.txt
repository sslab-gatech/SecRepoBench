if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE) {
        if (codeccontext->subtitle_header) {
            av_freep(&codeccontext->subtitle_header);
        }
        if (codeccontext->subtitle_header_size > 0) {
            codeccontext->subtitle_header = av_malloc(codeccontext->subtitle_header_size);
            if (!codeccontext->subtitle_header) {
                ret = AVERROR(ENOMEM);
                goto free_and_end;
            }
            if (av_subtitle_read_header(codeccontext->subtitle_header, codeccontext->subtitle_header_size, &codeccontext->subtitle_header_size, &codeccontext->subtitle_header, &codeccontext->subtitle_header_size, NULL, NULL, NULL) < 0) {
                av_log(codeccontext, AV_LOG_ERROR, "Error reading subtitle header\n");
                ret = AVERROR(EINVAL);
                goto free_and_end;
            }
        }
    }