{
    if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE) {
        // Identify known bitmap subtitle codecs (e.g., DVD, PGS, XSUB)
        if (codeccontext->codec_id == AV_CODEC_ID_DVB_SUBTITLE ||
            codeccontext->codec_id == AV_CODEC_ID_HDMV_PGS_SUBTITLE ||
            codeccontext->codec_id == AV_CODEC_ID_XSUB) {
            av_log(codeccontext, AV_LOG_WARNING,
                   "Character encoding ignored for bitmap-based subtitle codec.\n");
        } else {
            // Text-based subtitle codec: check if character encoding is set
            if (codeccontext->subtitle_charenc && codeccontext->subtitle_charenc[0]) {
                // If automatic detection was requested
                if (!strcmp(codeccontext->subtitle_charenc, "auto")) {
                    codeccontext->subtitle_charenc_mode = FF_SUB_CHARENC_MODE_PRE_DECODER;
                    av_log(codeccontext, AV_LOG_INFO,
                           "Using automatic character encoding detection for subtitles.\n");
                } else {
#if CONFIG_ICONV
                    iconv_t cd = iconv_open("UTF-8", codeccontext->subtitle_charenc);
                    if (cd == (iconv_t)-1) {
                        av_log(codeccontext, AV_LOG_ERROR,
                               "Invalid or unsupported subtitle character encoding: %s\n",
                               codeccontext->subtitle_charenc);
                    } else {
                        iconv_close(cd);
                        codeccontext->subtitle_charenc_mode = FF_SUB_CHARENC_MODE_PRE_DECODER;
                        av_log(codeccontext, AV_LOG_INFO,
                               "Using subtitle character encoding: %s\n",
                               codeccontext->subtitle_charenc);
                    }
#else
                    av_log(codeccontext, AV_LOG_WARNING,
                           "No iconv support; unable to validate subtitle character encoding: %s\n",
                           codeccontext->subtitle_charenc);
                    codeccontext->subtitle_charenc_mode = FF_SUB_CHARENC_MODE_PRE_DECODER;
#endif
                }
            }
        }
    } else if (codeccontext->subtitle_charenc) {
        // Not a subtitle codec, ignore any character encoding setting
        av_log(codeccontext, AV_LOG_WARNING,
               "Subtitle character encoding ignored: not a subtitle stream.\n");
    }
}