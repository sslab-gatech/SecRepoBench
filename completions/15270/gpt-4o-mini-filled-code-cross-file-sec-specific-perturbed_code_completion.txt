if (codeccontext->subtitle_header) {
            // Check if the subtitle header is valid
            if (codeccontext->subtitle_header->encoding == AV_CODEC_ID_NONE) {
                av_log(codeccontext, AV_LOG_WARNING, "Subtitle header encoding is not set, using default.\n");
                codeccontext->subtitle_header->encoding = AV_CODEC_ID_DEFAULT; // Set to a default encoding
            }
            // Validate the character encoding if it's a text-based codec
            if (codeccontext->codec->type == AVMEDIA_TYPE_SUBTITLE) {
                if (codeccontext->subtitle_header->encoding == AV_CODEC_ID_TEXT) {
                    // Perform character encoding validation if iconv is available
                    if (iconv_check(codeccontext->subtitle_header->encoding) < 0) {
                        av_log(codeccontext, AV_LOG_ERROR, "Invalid character encoding for subtitles.\n");
                        ret = AVERROR(EINVAL);
                        goto free_and_end;
                    }
                }
            }
        }