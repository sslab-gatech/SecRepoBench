if (codec->subtitle_header) {
    if (codec->codec_type != AVMEDIA_TYPE_SUBTITLE) {
        av_log(codec, AV_LOG_WARNING, "Subtitle header present for non-subtitle codec. Ignoring.\n");
    } else {
        if (codec->codec_id == AV_CODEC_ID_DVB_SUBTITLE || codec->codec_id == AV_CODEC_ID_DVD_SUBTITLE) {
            av_log(codec, AV_LOG_WARNING, "Ignoring subtitle encoding for bitmap-based subtitle codec.\n");
        } else {
            codec->subtitle_header_size = strlen(codec->subtitle_header);
            if (codec->subtitle_header_size > 0) {
                if (codec->subtitle_header_size > INT_MAX - AV_INPUT_BUFFER_PADDING_SIZE) {
                    av_log(codec, AV_LOG_ERROR, "Subtitle header too large\n");
                    return AVERROR(EINVAL);
                }
                codec->extradata = av_mallocz(codec->subtitle_header_size + AV_INPUT_BUFFER_PADDING_SIZE);
                if (!codec->extradata)
                    return AVERROR(ENOMEM);
                memcpy(codec->extradata, codec->subtitle_header, codec->subtitle_header_size);
                codec->extradata_size = codec->subtitle_header_size;
            }
        }
    }
}