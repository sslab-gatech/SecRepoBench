if (codeccontext->subtitle_encoding) {
            if (codeccontext->codec_type != AVMEDIA_TYPE_SUBTITLE) {
                av_log(codeccontext, AV_LOG_WARNING, "Ignoring subtitle encoding for non-subtitle codec.\n");
            } else if (codeccontext->codec_id == AV_CODEC_ID_DVD_SUBTITLE ||
                       codeccontext->codec_id == AV_CODEC_ID_DVB_SUBTITLE ||
                       codeccontext->codec_id == AV_CODEC_ID_PGS_SUBTITLE) {
                av_log(codeccontext, AV_LOG_WARNING, "Ignoring subtitle encoding for bitmap-based subtitle codec.\n");
            } else if (codeccontext->subtitle_encoding_mode == AV_SUBTITLE_ENCODING_MODE_AUTOMATIC) {
                codeccontext->subtitle_encoding_mode = AV_SUBTITLE_ENCODING_MODE_PRE_DECODER;
                if (av_codec_subtitle_check_encoding(codeccontext) < 0) {
                    ret = AVERROR(EINVAL);
                    goto free_and_end;
                }
            }
        }