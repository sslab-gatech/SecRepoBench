if (codeccontext->subtitle_header) {
            if (codeccontext->codec_descriptor->props & AV_CODEC_PROP_BITMAP_SUB) {
                av_log(codeccontext, AV_LOG_WARNING,
                       "Ignoring subtitle character encoding for bitmap subtitle codec\n");
            } else if (codeccontext->sub_charenc_mode == FF_SUB_CHARENC_MODE_AUTOMATIC) {
                codeccontext->sub_charenc_mode = FF_SUB_CHARENC_MODE_PRE_DECODER;
#ifdef HAVE_ICONV
                if (codeccontext->sub_charenc) {
                    iconv_t cd = iconv_open("UTF-8", codeccontext->sub_charenc);
                    if (cd == (iconv_t)-1) {
                        av_log(codeccontext, AV_LOG_WARNING,
                               "Invalid subtitle character encoding \"%s\"\n",
                               codeccontext->sub_charenc);
                        codeccontext->sub_charenc = NULL;
                    } else {
                        iconv_close(cd);
                    }
                }
#endif
            }
        }