if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE) {
    if (codeccontext->sub_charenc && codeccontext->sub_charenc_size > 0) {
        // Validate the memory allocation and length of sub_charenc
        if (codeccontext->sub_charenc_size < 0 || codeccontext->sub_charenc_size > MAX_SUB_CHARENC_SIZE) {
            av_log(codeccontext, AV_LOG_ERROR, "Invalid subtitle character encoding size\n");
            ret = AVERROR(EINVAL);
            goto free_and_end;
        }
        // Additional checks for codec properties
        if (codeccontext->bits_per_coded_sample <= 0) {
            av_log(codeccontext, AV_LOG_ERROR, "bits_per_coded_sample is not properly initialized\n");
            ret = AVERROR(EINVAL);
            goto free_and_end;
        }
        // Handle character encoding logic here
        // ...
    } else {
        av_log(codeccontext, AV_LOG_WARNING, "No subtitle character encoding set\n");
    }
}