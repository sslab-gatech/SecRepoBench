if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE && codeccontext->subtitle_character_encoding) {
        /* Determine if the subtitle is bitmap-based or text-based.
         * For bitmap-based subtitles, ignore the character encoding with a warning.
         * For text-based subtitles, if the encoding is set to "auto", switch to a pre-decoder mode
         * and optionally validate the encoding using iconv if available. */
        switch (codeccontext->codec_id) {
        case AV_CODEC_ID_DVB_SUBTITLE:
        case AV_CODEC_ID_HDMV_PGS_SUBTITLE:
        case AV_CODEC_ID_XSUB:
            av_log(codeccontext, AV_LOG_WARNING,
                   "Bitmap-based subtitle detected; ignoring character encoding '%s'.\n",
                   codeccontext->subtitle_character_encoding);
            break;
        default:
            /* Assume text-based subtitle. */
            if (!strcmp(codeccontext->subtitle_character_encoding, "auto")) {
                av_log(codeccontext, AV_LOG_VERBOSE,
                       "Subtitle character encoding set to auto; using pre-decoder mode.\n");
                /* If iconv is available, we could validate here:
                 * iconv_t cd = iconv_open("UTF-8", input_encoding);
                 * if (cd == (iconv_t)-1) { ... } */
            }
            break;
        }
    } else if (codeccontext->subtitle_character_encoding) {
        /* Character encoding is set, but this is not a subtitle codec. Ignore. */
        av_log(codeccontext, AV_LOG_WARNING,
               "Ignoring character encoding for non-subtitle codec.\n");
    }