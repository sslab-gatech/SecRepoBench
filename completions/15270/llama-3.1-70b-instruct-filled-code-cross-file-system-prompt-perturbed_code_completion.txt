if (codeccontext->subtitle_header && codeccontext->codec->type == AVMEDIA_TYPE_SUBTITLE) {
    if (codeccontext->subtitle_header->format == 0) {
        if (avctx->sub_charenc) {
            codeccontext->subtitle_header->format = avctx->sub_charenc;
        } else {
            codeccontext->subtitle_header->format = AV_SUBTITLE_FMT_ASS;
        }
    }
    if (codeccontext->subtitle_header->format == AV_SUBTITLE_FMT_ASS) {
        if (avctx->sub_charenc == AV_SUBTITLE_FMT_TEXT) {
            av_log(codeccontext, AV_LOG_WARNING, "Text subtitles are not supported with ASS format\n");
            codeccontext->subtitle_header->format = AV_SUBTITLE_FMT_TEXT;
        }
    }
    if (codeccontext->subtitle_header->format == AV_SUBTITLE_FMT_TEXT) {
        if (avctx->sub_charenc == AV_SUBTITLE_FMT_ASS) {
            av_log(codeccontext, AV_LOG_WARNING, "ASS subtitles are not supported with text format\n");
            codeccontext->subtitle_header->format = AV_SUBTITLE_FMT_ASS;
        }
    }
    if (avctx->sub_charenc!= AV_SUBTITLE_FMT_NONE) {
        if (avctx->sub_charenc!= codeccontext->subtitle_header->format) {
            av_log(codeccontext, AV_LOG_WARNING, "Subtitle character encoding mismatch\n");
        }
    }
}