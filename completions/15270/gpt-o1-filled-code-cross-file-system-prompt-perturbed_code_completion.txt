if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE) {
        AVDictionaryEntry *charenc = av_dict_get(tmp, "charenc", NULL, 0);
        if (charenc) {
            switch (codeccontext->codec_id) {
            case AV_CODEC_ID_SRT:
            case AV_CODEC_ID_SUBRIP:
            case AV_CODEC_ID_ASS:
            case AV_CODEC_ID_SSA:
            case AV_CODEC_ID_WEBVTT:
            case AV_CODEC_ID_MOV_TEXT:
                /* These are text-based subtitle codecs */
                if (!strcmp(charenc->value, "auto")) {
                    /* Set the character encoding mode to pre-decoder if auto is requested */
                    av_dict_set(&tmp, "charenc_mode", "predecoder", 0);
                } else {
                    /* Here one could add validation of the input encoding via iconv if available.
                     * If validation fails:
                     *     ret = AVERROR(EINVAL);
                     *     goto free_and_end;
                     */
                }
                break;
            default:
                /* Bitmap-based (or unknown) subtitle codec, ignore charenc with a warning */
                av_log(codeccontext, AV_LOG_WARNING,
                       "Ignoring subtitle character encoding '%s' for bitmap-based/unsupported subtitle codec.\n",
                       charenc->value);
                break;
            }
        }
    }