if (codeccontext->subtitle_encoding == AV_CODEC_ID_NONE) {
            if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE &&
                codeccontext->auto_convert_sub_encoding) {
                codeccontext->sub_charenc_mode = AV_SUB_ENC_MODE_PRE;
#if CONFIG_ICONV
                if (codeccontext->sub_charenc) {
                    iconv_t cd = iconv_open("UTF-8", codeccontext->sub_charenc);
                    if (cd == (iconv_t)-1) {
                        av_log(codeccontext, AV_LOG_WARNING,
                               "Failed to open iconv for character encoding conversion.\n");
                    } else {
                        iconv_close(cd);
                    }
                }
#endif
            }
        } else if (codeccontext->codec_type != AVMEDIA_TYPE_SUBTITLE) {
            av_log(codeccontext, AV_LOG_WARNING,
                   "Character encoding is only supported for subtitle codecs.\n");
            codeccontext->subtitle_encoding = AV_CODEC_ID_NONE;
        } else if (codeccontext->codec_descriptor->props & AV_CODEC_PROP_BITMAP_SUB) {
            av_log(codeccontext, AV_LOG_WARNING,
                   "Character encoding is ignored for bitmap-based subtitle codecs.\n");
            codeccontext->subtitle_encoding = AV_CODEC_ID_NONE;
        }