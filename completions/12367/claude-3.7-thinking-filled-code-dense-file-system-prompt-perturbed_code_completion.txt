if (avctx->codec_id == AV_CODEC_ID_HYMT) {
    // Make sure we have enough data for the basic structure check
    if (buf_size < table_size + 8) {
        return AVERROR_INVALIDDATA;
    }
    
    // Look for the signature at the end of the packet
    uint32_t signature = AV_RL32(buf + buf_size - 4);
    if (signature == 0x4D594854) { // "HYMT" in little-endian
        // Get number of slices
        nb_slices = AV_RL32(buf + buf_size - 8);
        
        // Validate number of slices
        if (nb_slices <= 0 || nb_slices > height) {
            return AVERROR_INVALIDDATA;
        }
        
        // Calculate slice height
        slice_height = height / nb_slices;
        if (height % nb_slices != 0) {
            return AVERROR_INVALIDDATA;
        }
        
        // Calculate offset to slice info
        slices_info_offset = buf_size - 8 - nb_slices * 8;
        
        // Validate the offset
        if (slices_info_offset < table_size) {
            return AVERROR_INVALIDDATA;
        }
    } else {
        // No valid signature, use single slice
        nb_slices = 1;
        slice_height = height;
    }
} else {
    // Not HYMT codec, use single slice
    nb_slices = 1;
    slice_height = height;
}