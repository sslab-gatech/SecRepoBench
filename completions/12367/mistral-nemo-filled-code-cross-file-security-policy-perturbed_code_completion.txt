if (avctx->codec_id == AV_CODEC_ID_HYMT) {
        int slices_info_size = AV_RL32(packet->data + buf_size - 4);
        if (slices_info_size < 0 || slices_info_size > buf_size - 4) {
            av_log(avctx, AV_LOG_ERROR, "Invalid slices info size\n");
            return AVERROR_INVALIDDATA;
        }

        slices_info_offset = buf_size - slices_info_size;
        nb_slices = slices_info_size / 8;
        if (nb_slices * 8 != slices_info_size) {
            av_log(avctx, AV_LOG_ERROR, "Invalid number of slices\n");
            return AVERROR_INVALIDDATA;
        }

        slice_height = height / nb_slices;
        if (slice_height * nb_slices != height) {
            av_log(avctx, AV_LOG_ERROR, "Invalid slice height\n");
            return AVERROR_INVALIDDATA;
        }
    } else {
        nb_slices = 1;
        slice_height = height;
    }

    if (nb_slices * slice_height > height) {
        av_log(avctx, AV_LOG_ERROR, "Invalid number of slices or slice height\n");
        return AVERROR_INVALIDDATA;
    }