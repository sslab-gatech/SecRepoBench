u_int32_t length = packet->len;
  u_int32_t *matches = &stream->detected_protocol_matches[NDPI_PROTOCOL_MEMCACHED];

  if (packet->transport_protocol == NDPI_TRANSPORT_PROTOCOL_TCP) {
    if (length < MEMCACHED_MIN_LEN) {
      *matches = 0;
      return;
    }
  } else if (packet->transport_protocol == NDPI_TRANSPORT_PROTOCOL_UDP) {
    if (length < MEMCACHED_MIN_UDP_LEN) {
      *matches = 0;
      return;
    }
    offset += MEMCACHED_UDP_HDR_LEN;
    length -= MEMCACHED_UDP_HDR_LEN;
  } else {
    *matches = 0;
    return;
  }