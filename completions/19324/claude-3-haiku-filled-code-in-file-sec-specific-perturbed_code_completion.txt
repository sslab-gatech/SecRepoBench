// Determine if the packet uses TCP or UDP.
if (packet->tcp) {
    if (packet->payload_packet_len < MEMCACHED_MIN_LEN) {
        return;
    }
} else if (packet->udp) {
    if (packet->payload_packet_len < MEMCACHED_MIN_UDP_LEN) {
        return;
    }

    // Verify specific header conditions to determine protocol compliance.
    if (ntohs(*(uint16_t *)packet->payload) != 0x8000) {
        return;
    }
    offset += MEMCACHED_UDP_HDR_LEN;
    length -= MEMCACHED_UDP_HDR_LEN;
}

// Update the `matches` pointer to point to the appropriate memcached matches counter
// within the flow structure based on the protocol type.
uint32_t *matches = packet->tcp ? &stream->memcached_tcp_matches : &stream->memcached_udp_matches;