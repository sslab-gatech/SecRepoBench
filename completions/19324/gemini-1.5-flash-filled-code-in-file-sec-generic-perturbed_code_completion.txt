u_int32_t length = packet->payload_length;
  int is_udp = (packet->l4_proto == NDPI_PROTOCOL_UDP);
  u_int32_t *matches = is_udp ? &stream->udp_matches : &stream->tcp_matches;

  if (is_udp) {
    if (length < MEMCACHED_MIN_UDP_LEN) {
      return;
    }
    offset += MEMCACHED_UDP_HDR_LEN;
    length -= MEMCACHED_UDP_HDR_LEN;
  } else {
    if (length < MEMCACHED_MIN_LEN) {
      return;
    }
  }