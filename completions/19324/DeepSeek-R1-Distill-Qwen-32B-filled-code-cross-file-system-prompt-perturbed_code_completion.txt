if(stream->l4_proto == IPPROTO_TCP) {
    if(packet->payload_len < 1) {
      ndpi_exclude_protocol(ndpi_struct, stream, NDPI_PROTOCOL_MEMCACHED);
      return;
    }
    *matches = &stream->protos.memcached.tcp_matches;
  } else if(stream->l4_proto == IPPROTO_UDP) {
    if(packet->payload_len < 8) {
      ndpi_exclude_protocol(ndpi_struct, stream, NDPI_PROTOCOL_MEMCACHED);
      return;
    }
    offset += 8;
    packet->payload_len -= 8;
    *matches = &stream->protos.memcached.udp_matches;
  } else {
    ndpi_exclude_protocol(ndpi_struct, stream, NDPI_PROTOCOL_MEMCACHED);
    return;
  }