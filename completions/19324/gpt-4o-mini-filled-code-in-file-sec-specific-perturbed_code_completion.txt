u_int32_t length = packet->payload_length;
  u_int32_t *matches = &stream->matches;

  if (length < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->protocol == NDPI_PROTOCOL_TCP) {
    if (length < MEMCACHED_MIN_LEN) {
      return;
    }
  } else if (packet->protocol == NDPI_PROTOCOL_UDP) {
    if (length < MEMCACHED_MIN_UDP_LEN) {
      return;
    }
    offset += MEMCACHED_UDP_HDR_LEN;
    length -= MEMCACHED_UDP_HDR_LEN;
  }