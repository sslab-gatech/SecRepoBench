NDPI_LOG_DBG(ndpi_struct, "search memcached\n");

  if(packet->detected_protocol_stack[0] != NDPI_PROTOCOL_UNKNOWN)
    return;

  if(packet->l4_protocol == IPPROTO_TCP) {
    if(packet->payload_packet_len < MEMCACHED_MIN_TCP_LEN)
      return;
  } else if(packet->l4_protocol == IPPROTO_UDP) {
    if(packet->payload_packet_len < MEMCACHED_MIN_UDP_LEN)
      return;

    if(packet->payload_packet_len < 8 || GET_UDP_PAYLOAD_LEN(packet) < 8)
      return;

    offset += 8;
  } else {
    return;
  }

  u_int32_t *matches = (packet->l4_protocol == IPPROTO_TCP) ? &stream->memcached_tcp_matches : &stream->memcached_udp_matches;