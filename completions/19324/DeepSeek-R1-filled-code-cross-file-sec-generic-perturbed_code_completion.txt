NDPI_LOG_DBG(ndpi_struct, "searching memcached\n");

  u_int16_t *matches;

  if (packet->l4_proto == IPPROTO_TCP) {
    if (packet->payload_packet_len < MEMCACHED_MIN_TCP_LEN) {
      NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
      return;
    }
    matches = &stream->memcached_matches_tcp;
  } else if (packet->l4_proto == IPPROTO_UDP) {
    if (packet->payload_packet_len < MEMCACHED_MIN_UDP_LEN) {
      NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
      return;
    }
    offset += 8;
    packet->payload_packet_len -= 8;
    if (packet->payload_packet_len < MEMCACHED_MIN_LEN) {
      NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
      return;
    }
    matches = &stream->memcached_matches_udp;
  } else {
    NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
    return;
  }