u_int16_t *matches;

  if (packet->l4_proto != IPPROTO_TCP && packet->l4_proto != IPPROTO_UDP) {
    NDPI_EXCLUDE_PROTOCOL(ndpi_struct, stream);
    return;
  }

  if (packet->l4_proto == IPPROTO_TCP) {
    if (packet->payload_packet_len < 7) {
      NDPI_EXCLUDE_PROTOCOL(ndpi_struct, stream);
      return;
    }
    matches = &stream->memcached_matches[0];
  } else {
    if (packet->payload_packet_len < 8) {
      NDPI_EXCLUDE_PROTOCOL(ndpi_struct, stream);
      return;
    }
    if (offset[0] != 0x00 && offset[0] != 0x81) {
      NDPI_EXCLUDE_PROTOCOL(ndpi_struct, stream);
      return;
    }
    offset += 8;
    if (packet->payload_packet_len - 8 < 7) {
      NDPI_EXCLUDE_PROTOCOL(ndpi_struct, stream);
      return;
    }
    matches = &stream->memcached_matches[1];
  }