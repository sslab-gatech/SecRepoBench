u_int16_t *matches;

  NDPI_LOG_DBG2(ndpi_struct, "search memcached\n");

  /* Determine if the packet uses TCP or UDP */
  if (stream->l4_proto == IPPROTO_TCP) {
    /* For TCP packets, check the minimum required length */
    if (packet->payload_packet_len < MEMCACHED_MIN_TCP_LEN) {
      NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
      return;
    }
    /* Point matches to the TCP memcached counter */
    matches = &stream->l4.tcp.memcached_matches;

  } else if (stream->l4_proto == IPPROTO_UDP) {
    /* For UDP packets, check the minimum required length */
    if (packet->payload_packet_len < MEMCACHED_MIN_UDP_LEN) {
      NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
      return;
    }

    /* Verify and skip any specific UDP header if needed */
    offset += 8;
    packet->payload_packet_len -= 8;

    /* Point matches to the UDP memcached counter */
    matches = &stream->l4.udp.memcached_matches;

  } else {
    /* If neither TCP nor UDP, exclude the protocol */
    NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
    return;
  }