{
  NDPI_LOG_DBG2(ndpi_struct->ndpi_str, "Performing memcached protocol search\n");
  u_int32_t *matches = NULL;
  u_int16_t payload_length = packet->payload_packet_length;

  if(stream->l4_proto == IPPROTO_TCP) {
    // For TCP packets, require a minimum payload length.
    if(payload_length < MEMCACHED_MIN_TCP_LEN)
      return;
    matches = &stream->memcached_matches;
  }
  else if(stream->l4_proto == IPPROTO_UDP) {
    // For UDP packets, require at least the UDP header plus minimum payload.
    if(payload_length < (8 + MEMCACHED_MIN_UDP_LEN))
      return;
    // Verify UDP-specific header conditions (e.g. memcached binary protocol magic numbers: 0x80 for requests, 0x81 for responses)
    if(offset[0] != 0x80 && offset[0] != 0x81)
      return;
    // Adjust the offset and payload length by skipping the UDP header (8 bytes)
    offset += 8;
    payload_length -= 8;
    matches = &stream->memcached_matches;
  }
  else {
    return;
  }

  // Update the packet structure with the adjusted payload pointer and length.
  packet->payload = offset;
  packet->payload_packet_length = payload_length;
}