u_int16_t packet_len = packet->len;
  u_int32_t *matches = &stream->memcached_matches;

  NDPI_LOG(NDPI_PROTOCOL_MEMCACHED, ndpi_struct, NDPI_LOG_DEBUG, "search for memcached.\n");

  if (stream->protocol == NDPI_PROTOCOL_TCP) {
    if (packet_len < MEMCACHED_MIN_LEN)
      return;
  } else if (stream->protocol == NDPI_PROTOCOL_UDP) {
    if (packet_len < MEMCACHED_MIN_LEN)
      return;

    if (packet->udp.dport != htons(MEMCACHED_DEFAULT_PORT) && packet->udp.sport != htons(MEMCACHED_DEFAULT_PORT))
      return;

    offset += sizeof(struct udphdr);
    packet_len -= sizeof(struct udphdr);

    matches = &stream->udp.memcached_matches;
  } else {
    return;
  }


  if (*matches == 0) { /* do it just once */
    if (! MEMCACHED_MATCH(MCDC_VERSION)) *matches += 1;
  }