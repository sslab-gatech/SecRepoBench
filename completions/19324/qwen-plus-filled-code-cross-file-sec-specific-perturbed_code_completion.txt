u_int16_t *matches = &stream->protos.memcached.matches;

if (packet->tcp != NULL) {
  if (packet->payload_packet_len < MEMCACHED_MIN_TCP_PACKET_LEN)
    return;
} else if (packet->udp != NULL) {
  if (packet->payload_packet_len < MEMCACHED_MIN_UDP_PACKET_LEN)
    return;

  offset += UDP_HEADER_LENGTH; // Adjust for UDP header length
  packet->payload_packet_len -= UDP_HEADER_LENGTH;
}

if (packet->payload_packet_len == 0)
  return;

*matches = 0;

// Ensure that the payload does not exceed allocated memory bounds
if (packet->payload_packet_len > MEMCACHED_MAX_PACKET_LEN) {
  packet->payload_packet_len = MEMCACHED_MAX_PACKET_LEN;
}