// Determine if the packet uses TCP or UDP
if (packet->tcp) {
    // For TCP packets, check if the packet length meets the minimum required length
    if (packet->payload_packet_len < MEMCACHED_MIN_PACKET_SIZE) {
        return;
    }
} else {
    // For UDP packets, check if the packet length meets the minimum required length
    if (packet->payload_packet_len < MEMCACHED_MIN_PACKET_SIZE) {
        return;
    }

    // Verify specific header conditions to determine protocol compliance
    if (packet->payload[0] != 0x80 || packet->payload[1] != 0x00) {
        return;
    }

    // Adjust the offset and length for UDP packets by skipping the UDP header length
    offset += 8;
    packet->payload_packet_len -= 8;
}

// Update the `matches` pointer to point to the appropriate memcached matches counter
// within the flow structure based on the protocol type
if (packet->tcp) {
    matches = &stream->memcached_tcp_count;
} else {
    matches = &stream->memcached_udp_count;
}

// If the packet does not meet the expected criteria, exclude the protocol and return
if (packet->payload_packet_len < MEMCACHED_MIN_PACKET_SIZE) {
    return;
}