u_int16_t *matches;
  if (packet->detected_protocol_stack[0] == NDPI_PROTOCOL_MEMCACHED_TCP) {
    matches = &stream->memcached_tcp_matches;
  } else if (packet->detected_protocol_stack[0] == NDPI_PROTOCOL_MEMCACHED_UDP) {
    matches = &stream->memcached_udp_matches;
  } else {
    return;
  }

  if (packet->tcp) {
    if (packet->payload_packet_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->udp) {
    if (packet->payload_packet_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    // Assuming UDP header length is 8 bytes
    offset += 8;
    packet->payload_packet_len -= 8;
  }

  *matches = 0;