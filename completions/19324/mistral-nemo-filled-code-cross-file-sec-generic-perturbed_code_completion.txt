if (packet->payload_length < MIN_PACKET_LENGTH) {
  return;
}

if (packet->l4_protocol == IPPROTO_TCP) {
  if (packet->payload_length < MIN_TCP_PACKET_LENGTH) {
    return;
  }
} else if (packet->l4_protocol == IPPROTO_UDP) {
  if (packet->payload_length < MIN_UDP_PACKET_LENGTH) {
    return;
  }
  offset += UDP_HEADER_LENGTH;
}

if (packet->l4_protocol == IPPROTO_UDP) {
  if (!MEMCACHED_UDP_HEADER_CHECK(offset, packet->payload_length)) {
    return;
  }
}

*matches = 0;