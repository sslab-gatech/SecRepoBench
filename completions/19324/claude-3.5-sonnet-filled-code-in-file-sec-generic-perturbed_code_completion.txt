NDPI_LOG_DBG(ndpi_struct, "search memcached\n");

u_int16_t length = packet->payload_packet_len;
u_int16_t *matches;

if (packet->tcp) {
  if (length < MEMCACHED_MIN_LEN) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
    return;
  }
  matches = &stream->memcached_tcp_matches;
} else if (packet->udp) {
  if (length < MEMCACHED_MIN_UDP_LEN) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
    return;
  }
  if (get_u_int16_t(packet->payload, 2) != 0 ||
      get_u_int16_t(packet->payload, 6) != 1) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
    return;
  }
  offset += MEMCACHED_UDP_HDR_LEN;
  length -= MEMCACHED_UDP_HDR_LEN;
  matches = &stream->memcached_udp_matches;
} else {
  NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
  return;
}