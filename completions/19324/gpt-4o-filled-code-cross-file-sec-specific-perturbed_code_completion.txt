u_int16_t min_len;
  u_int32_t *matches;
  u_int8_t is_udp = (stream->l4_proto == IPPROTO_UDP);

  if(is_udp) {
    min_len = 8; // Minimum length for UDP memcached packet
    if(packet->payload_packet_len < min_len) {
      NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
      return;
    }
    offset += 8; // Skip UDP header
  } else {
    min_len = 24; // Minimum length for TCP memcached packet
    if(packet->payload_packet_len < min_len) {
      NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
      return;
    }
  }

  if(is_udp) {
    matches = &stream->memcached_udp_matches;
  } else {
    matches = &stream->memcached_tcp_matches;
  }