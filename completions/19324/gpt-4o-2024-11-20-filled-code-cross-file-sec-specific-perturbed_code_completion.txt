u_int16_t min_len;
  u_int8_t protocol;
  u_int32_t *matches;

  // Determine the protocol (TCP or UDP)
  protocol = stream->l4_protocol;

  if (protocol == IPPROTO_TCP) {
    // Minimum length for memcached over TCP
    min_len = 24; // Example minimum length for memcached TCP packets
    if (packet->payload_packet_len < min_len) {
      NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
      return;
    }
    matches = &stream->memcached_matches_tcp;
  } else if (protocol == IPPROTO_UDP) {
    // Minimum length for memcached over UDP
    min_len = 8; // Example minimum length for memcached UDP packets
    if (packet->payload_packet_len < min_len) {
      NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
      return;
    }

    // Verify UDP header conditions
    if (packet->payload_packet_len < (8 + 24)) { // 8 bytes UDP header + 24 bytes memcached header
      NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
      return;
    }

    // Adjust offset and length for UDP
    offset += 8; // Skip UDP header
    matches = &stream->memcached_matches_udp;
  } else {
    // Unsupported protocol
    NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
    return;
  }