unsigned long matches = 0;
  int is_tcp = (packet->l4_proto == IPPROTO_TCP);
  int min_len = is_tcp ? MEMCACHED_TCP_MIN_LEN : MEMCACHED_UDP_MIN_LEN;
  if (packet->payload_len < min_len) return;

  if (!is_tcp) {
    // Adjust offset for UDP header
    offset += 8;
    // Adjust length for UDP header
    packet->payload_len -= 8;
    // Check UDP header conditions
    if (packet->payload_len < 1) return;
  }

  unsigned long *matches_ptr = is_tcp ? &stream->tcp.memcached_matches : &stream->udp.memcached_matches;
  *matches_ptr = 0;
  matches = *matches_ptr;