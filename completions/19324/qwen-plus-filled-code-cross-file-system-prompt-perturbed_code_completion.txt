if (packet->payload_len < MEMCACHED_MIN_PACKET_LEN) {
  NDPI_EXCLUDE_PROTO();
  return;
}

u_int32_t *matches = &stream->protocol_matches[NDPI_PROTOCOL_MEMCACHED];
*matches = 0;

if (packet->tcp != NULL) {
  if (packet->payload_len < MEMCACHED_MIN_TCP_PACKET_LEN) {
    NDPI_EXCLUDE_PROTO();
    return;
  }
} else if (packet->udp != NULL) {
  if (packet->payload_len < MEMCACHED_MIN_UDP_PACKET_LEN + UDP_HEADER_LENGTH) {
    NDPI_EXCLUDE_PROTO();
    return;
  }
  offset += UDP_HEADER_LENGTH;
}