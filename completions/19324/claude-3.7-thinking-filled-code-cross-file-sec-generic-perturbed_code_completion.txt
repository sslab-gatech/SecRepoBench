NDPI_LOG_DBG(ndpi_struct, "search memcached\n");

u_int16_t *matches;

// Check if we have a TCP or UDP packet
if(packet->tcp != NULL) {
  if(packet->payload_packet_len < 8) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
    return;
  }
  matches = &stream->protos.memcached.memcached_tcp_matches;
} else if(packet->udp != NULL) {
  if(packet->payload_packet_len < 8) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
    return;
  }
  
  // For memcached UDP requests, skip the 8-byte header
  offset += 8;
  matches = &stream->protos.memcached.memcached_udp_matches;
} else {
  NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
  return;
}