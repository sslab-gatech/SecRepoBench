size_t payload_length = packet->payload_length;
  if (payload_length < MIN_MEMCACHED_LENGTH) {
    return; // Exclude protocol if the payload length is insufficient
  }

  // Check for specific conditions based on the protocol type (TCP/UDP)
  if (stream->l4_proto == IPPROTO_UDP) {
    if (payload_length < UDP_HEADER_LENGTH) {
      return; // Exclude protocol if the payload length is less than UDP header length
    }
    offset += UDP_HEADER_LENGTH; // Adjust offset for UDP
    payload_length -= UDP_HEADER_LENGTH; // Adjust length for UDP
  } else if (stream->l4_proto == IPPROTO_TCP) {
    if (payload_length < TCP_HEADER_LENGTH) {
      return; // Exclude protocol if the payload length is less than TCP header length
    }
    offset += TCP_HEADER_LENGTH; // Adjust offset for TCP
    payload_length -= TCP_HEADER_LENGTH; // Adjust length for TCP
  }

  // Ensure that the adjusted payload length is valid
  if (payload_length > MAX_PAYLOAD_LENGTH) {
    return; // Exclude protocol if the payload length exceeds maximum allowed
  }