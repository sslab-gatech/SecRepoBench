// <MASK>
  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet->l3.protocol == IPPROTO_UDP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_UDP) {
      return;
    }
    offset += 8; // skip UDP header
    packet->payload_len -= 8;
  }

  if (packet->payload_len < MEMCACHED_MIN_LEN) {
    return;
  }

  if (packet->l3.protocol == IPPROTO_TCP) {
    if (packet->payload_len < MEMCACHED_MIN_LEN_TCP) {
      return;
    }
  } else if (packet-