u_int16_t packet_len = packet->len;
  u_int32_t *matches = &stream->memcached_matches;

  NDPI_LOG(NDPI_PROTOCOL_MEMCACHED, ndpi_struct, NDPI_LOG_DEBUG, "search MEMCACHED\n");

  if (packet->l4_proto == IPPROTO_TCP) {
    if (packet_len < MEMCACHED_MIN_LEN)
      return;
  } else if (packet->l4_proto == IPPROTO_UDP) {
    if (packet_len < MEMCACHED_MIN_LEN)
      return;

    if (packet_len > 60000) /* Avoid potential DoS */
      return;

    offset += 8; /* Skip UDP header */
    packet_len -= 8;

    matches = &stream->memcached_udp_matches;
  } else
    return;

  if (*matches == 0) {
    NDPI_LOG(NDPI_PROTOCOL_MEMCACHED, ndpi_struct, NDPI_LOG_DEBUG,
	      "first memcached match\n");
  }