u_int16_t *matches = &stream->protos.memcached.matches;
if (packet->udp != NULL) {
  if (packet->payload_packet_len < sizeof(struct udphdr)) {
    ndpi_exclude_protocol(ndpi_struct, stream);
    return;
  }
  offset += sizeof(struct udphdr);
} else if (packet->tcp != NULL) {
  if (packet->payload_packet_len < sizeof(struct tcphdr)) {
    ndpi_exclude_protocol(ndpi_struct, stream);
    return;
  }
} else {
  ndpi_exclude_protocol(ndpi_struct, stream);
  return;
}

if (*matches >= MEMCACHED_MIN_MATCH) {
  ndpi_int_memcached_add_connection(ndpi_struct, stream);
}