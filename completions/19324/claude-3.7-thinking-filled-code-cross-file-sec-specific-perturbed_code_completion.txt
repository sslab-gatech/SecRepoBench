NDPI_LOG_DBG(ndpi_struct, "search memcached\n");

u_int32_t *matches = NULL;

if(packet->tcp != NULL) {
  /* TCP packet */
  if(packet->payload_packet_len < 4) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
    return;
  }
  matches = &stream->memcached.tcp_matches;
} else if(packet->udp != NULL) {
  /* UDP packet */
  if(packet->payload_packet_len < 8) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
    return;
  }
  
  /* For UDP, skip header */
  if(packet->payload_packet_len >= 8) {
    offset += 8;
  }
  matches = &stream->memcached.udp_matches;
} else {
  /* Neither TCP nor UDP */
  NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
  return;
}

/* Initialize match counter */
*matches = 0;