if (packet->payload_length < MEMCACHED_MIN_LEN) {
  NDPI_LOG_INFO(ndpi_struct, "Packet too short for memcached\n");
  return;
}

if (packet->tcp) {
  if (packet->payload_length < MEMCACHED_MIN_LEN) {
    NDPI_LOG_INFO(ndpi_struct, "TCP packet too short for memcached\n");
    return;
  }
} else if (packet->udp) {
  if (packet->payload_length < MEMCACHED_MIN_UDP_LEN) {
    NDPI_LOG_INFO(ndpi_struct, "UDP packet too short for memcached\n");
    return;
  }
  offset += MEMCACHED_UDP_HDR_LEN;
  packet->payload_length -= MEMCACHED_UDP_HDR_LEN;
}

if (packet->payload_length < MEMCACHED_MIN_LEN) {
  NDPI_LOG_INFO(ndpi_struct, "Payload too short for memcached\n");
  return;
}

if (packet->tcp) {
  matches = &stream->tcp_memcached_matches;
} else {
  matches = &stream->udp_memcached_matches;
}