u_int16_t min_len;
  u_int32_t *matches = NULL;

  if(packet->detected_protocol_stack[0] != NDPI_PROTOCOL_UNKNOWN)
    return;

  if(packet->tcp != NULL) {
    min_len = 32; // Minimum length for TCP memcached packets
    matches = &stream->memcached_tcp_matches;
  } else if(packet->udp != NULL) {
    min_len = 8; // Minimum length for UDP memcached packets
    matches = &stream->memcached_udp_matches;

    if(packet->payload_packet_len < min_len)
      return;

    // Skip UDP header
    offset += 8;
    packet->payload_packet_len -= 8;
  } else {
    return;
  }

  if(packet->payload_packet_len < min_len)
    return;