NDPI_LOG_DBG(ndpi_struct, "search memcached\n");

  if(packet->detected_protocol_stack[0] != NDPI_PROTOCOL_UNKNOWN)
    return;

  if(packet->tcp != NULL) {
    if(packet->payload_packet_len < MEMCACHED_MIN_LEN)
      return;
  } else if(packet->udp != NULL) {
    if(packet->payload_packet_len < MEMCACHED_MIN_UDP_LEN)
      return;

    if(packet->payload[0] != 0 || packet->payload[1] != 0)
      return;

    offset += MEMCACHED_UDP_HDR_LEN;
  } else
    return;

  u_int8_t *matches = &stream->memcached_stage;