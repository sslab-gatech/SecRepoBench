if (std::isupper(word[index-1], std::locale()) != std::isupper(word[index], std::locale())) {
    std::string pair;
    if (utf8) {
        u8_u16(pair, word.substr(index-1, 2));
    } else {
        pair = word.substr(index-1, 2);
    }
    
    std::string upper_pair = pair;
    if (utf8) {
        unsigned short first_char = (unsigned short)pair[0] << 8 | (unsigned char)pair[1];
        unsigned short second_char = (unsigned short)pair[2] << 8 | (unsigned char)pair[3];
        first_char = unicodetoupper(first_char);
        second_char = unicodetoupper(second_char);
        upper_pair[0] = (first_char >> 8) & 0xFF;
        upper_pair[1] = first_char & 0xFF;
        upper_pair[2] = (second_char >> 8) & 0xFF;
        upper_pair[3] = second_char & 0xFF;
    } else {
        upper_pair[0] = std::toupper(pair[0], std::locale());
        upper_pair[1] = std::toupper(pair[1], std::locale());
    }
    
    if (pair != upper_pair && pair[0] != '-' && pair[1] != '-') {
        return 1;
    }
}