if (!word || index <= 0) {
  return 0;
}

// Make sure we have enough characters to check
if (word[index] == '\0' || word[index-1] == '\0') {
  return 0;
}

// Get the characters to check
unsigned char c1 = (unsigned char)word[index-1];
unsigned char c2 = (unsigned char)word[index];

// Check that neither character is a hyphen
if (c1 == '-' || c2 == '-') {
  return 0;
}

// Check if the characters form a valid case pair
if (utf8) {
  // For UTF-8, we need to handle multi-byte characters
  // Skip UTF-8 continuation bytes (they're not the start of a character)
  if ((c1 & 0xc0) == 0x80 || (c2 & 0xc0) == 0x80) {
    return 0;
  }
  
  // For ASCII characters within UTF-8 text
  if ((c1 & 0x80) == 0 && (toupper(c1) == c1)) {
    return 1;  // ASCII uppercase character
  }
  if ((c2 & 0x80) == 0 && (toupper(c2) == c2)) {
    return 1;  // ASCII uppercase character
  }
  
  // For non-ASCII characters, we'd need proper Unicode handling
  // This would require conversion to Unicode code points
  
} else {
  // For ASCII only, check if either character is uppercase
  if (toupper(c1) == c1 || toupper(c2) == c2) {
    return 1;
  }
}