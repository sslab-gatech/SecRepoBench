{
    // Validate input and avoid out-of-bounds access
    if (!word || index < 0) return 0;
    int len = strlen(word);
    if (index + 1 >= len) return 0;

    // Ensure neither character is a hyphen
    if (word[index] == '-' || word[index + 1] == '-') return 0;

    // If not in UTF-8 mode, check ASCII uppercase
    if (!utf8) {
        if (isupper((unsigned char)word[index]) ||
            isupper((unsigned char)word[index + 1])) {
            return 1;
        }
        return 0;
    }

    // UTF-8 mode: convert the two characters to Unicode and check
    w_char c1 = 0, c2 = 0;
    int c1_size = get_utf8_char(word + index, &c1);
    if (c1_size <= 0) return 0;
    int c2_size = get_utf8_char(word + index + c1_size, &c2);
    if (c2_size <= 0) return 0;

    w_char uc1 = to_upper_utf8(c1);
    w_char uc2 = to_upper_utf8(c2);

    // If either character remains unchanged when uppercased, it's already uppercase
    if (c1 == uc1 || c2 == uc2) {
        return 1;
    }
}