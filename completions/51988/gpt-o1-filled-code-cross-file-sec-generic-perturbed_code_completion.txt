#ifdef UTF8
extern bool utf8;  // typically defined elsewhere in Hunspell
#endif

// <MASK>
if (!word || index < 0) {
    return 0;
}

// For ASCII mode, do a straightforward check
#ifndef UTF8
int len = strlen(word);
if (index + 1 >= len) {
    return 0;
}
if (word[index] == '-' || word[index + 1] == '-') {
    return 0;
}
if (isupper((unsigned char)word[index]) || isupper((unsigned char)word[index + 1])) {
    return 1;
}
#else
// If we have UTF-8 enabled, convert and check in wide-char
if (!utf8) {
    // ASCII fallback if UTF-8 not actually in use
    int len = strlen(word);
    if (index + 1 >= len) {
        return 0;
    }
    if (word[index] == '-' || word[index + 1] == '-') {
        return 0;
    }
    if (isupper((unsigned char)word[index]) || isupper((unsigned char)word[index + 1])) {
        return 1;
    }
} else {
    // Convert entire string into wide chars
    std::vector<w_char> wchars;
    u8_u16(wchars, word);

    if (index + 1 >= (int)wchars.size()) {
        return 0;
    }
    // Check for hyphens
    if (wchars[index] == (w_char)'-' || wchars[index + 1] == (w_char)'-') {
        return 0;
    }
    // Check if either character is already uppercase
    if (wchars[index] == towupper(wchars[index]) ||
        wchars[index + 1] == towupper(wchars[index + 1])) {
        return 1;
    }
}
#endif