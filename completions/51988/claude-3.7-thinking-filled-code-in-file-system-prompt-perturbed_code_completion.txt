int AffixMgr::cpdcase_check(const char* word, int index) {
  if (index <= 0) 
    return 0;
  
  unsigned char c1 = (unsigned char)word[index-1];
  unsigned char c2 = (unsigned char)word[index];
  
  // Ensure neither character is a hyphen
  if (c1 == '-' || c2 == '-')
    return 0;
  
  if (utf8) {
    std::vector<w_char> w;
    u8_u16(w, std::string(word, strlen(word)));
    
    // Find the Unicode character indices
    int windex = 0;
    for (int i = 0; i < index; i++) {
      if ((word[i] & 0xc0) != 0x80) // Skip continuation bytes
        windex++;
    }
    
    if (windex > 0 && windex < static_cast<int>(w.size())) {
      w_char& wc1 = w[windex-1];
      w_char& wc2 = w[windex];
      
      // Check if one character is uppercase and the other is not
      bool c1_upper = (wc1.h == 0) && isupper(wc1.l);
      bool c2_upper = (wc2.h == 0) && isupper(wc2.l);
      
      return (c1_upper && !c2_upper) || (!c1_upper && c2_upper);
    }
  } else {
    // For non-UTF8, use csconv to check character case
    bool c1_upper = (csconv[c1].cupper == c1);
    bool c2_upper = (csconv[c2].cupper == c2);
    
    return (c1_upper && !c2_upper) || (!c1_upper && c2_upper);
  }
  
  return 0;
}