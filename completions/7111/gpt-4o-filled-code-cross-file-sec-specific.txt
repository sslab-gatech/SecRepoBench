size_t scanline_size = TIFFScanlineSize(tiff);
    size_t max_size = MagickMax(scanline_size, (size_t) rows_per_strip * scanline_size);
    max_size = MagickMax(max_size, (size_t) image->columns * samples_per_pixel * ((bits_per_sample + 7) / 8));

    tiff_pixels = (unsigned char *) AcquireQuantumMemory(max_size, sizeof(*tiff_pixels));
    if (tiff_pixels == (unsigned char *) NULL)
      ThrowTIFFException(ResourceLimitError, "MemoryAllocationFailed");