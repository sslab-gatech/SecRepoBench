{
  tsize_t scanline_size;

  scanline_size = TIFFScanlineSize(tiff);
  if (scanline_size == 0)
    ThrowTIFFException(CorruptImageError,"InsufficientImageDataInFile");

  tiff_pixels = (unsigned char *) AcquireQuantumMemory(scanline_size, sizeof(*tiff_pixels));
  if (tiff_pixels == (unsigned char *) NULL)
    ThrowTIFFException(ResourceLimitError,"MemoryAllocationFailed");
}