// Allocate memory for tiff_pixels to store the image data from TIFF. 
// The allocated size is the maximum of the TIFF scanline size, rows per strip, or the 
// calculated size based on image columns, samples per pixel, and bits per sample.
// If memory allocation fails, an exception is thrown.
number_pixels = (MagickSizeType) image->columns * image->rows;
if (HeapOverflowSanityCheck(image->rows, sizeof(*tiff_pixels)) != MagickFalse)
  ThrowTIFFException(ResourceLimitError, "MemoryAllocationFailed");
tiff_pixels = (unsigned char *) AcquireQuantumMemory(MagickMax(TIFFScanlineSize(tiff), 
  (size_t) (rows_per_strip * image->columns * samples_per_pixel * ((bits_per_sample + 7) >> 3))), 
  sizeof(*tiff_pixels));
if (tiff_pixels == (unsigned char *) NULL)
  ThrowTIFFException(ResourceLimitError, "MemoryAllocationFailed");