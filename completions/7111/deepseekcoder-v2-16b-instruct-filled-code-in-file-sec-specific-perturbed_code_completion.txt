compression=JPEGCompression;
         method=GetJPEGMethod(tiff_image,tiff,photometric,bits_per_sample,
           samples_per_pixel);
         break;
      }
      case COMPRESSION_LZW: tiff_image->compression=LZWCompression; break;
      case COMPRESSION_PACKBITS: tiff_image->compression=PackBitsCompression; break;
      case COMPRESSION_DEFLATE: tiff_image->compression=DeflateCompression; break;
      case COMPRESSION_ADOBE_DEFLATE:
      {
        tiff_image->compression=DeflateCompression;
        method=ReadRGBAMethod;
        break;
      }
      case COMPRESSION_ADOBE_LZW:
      {
        tiff_image->compression=LZWCompression;
        method=ReadRGBAMethod;
        break;
      }
      case COMPRESSION_JBIG: tiff_image->compression=JBIGCompression; break;
      case COMPRESSION_NEXT: tiff_image->compression=NextCompression; break;
      case COMPRESSION_CCITTRLE: tiff_image->compression=CCITTRLECompression; break;
      case COMPRESSION_CCITTRLEW: tiff_image->compression=CCITTRLEWCompression; break;
      case COMPRESSION_JPEG2000: tiff_image->compression=JPEG2000Compression; break;
      case COMPRESSION_LZMA: tiff_image->compression=LZMACompression; break;
      case COMPRESSION_ZSTD: tiff_image->compression=ZSTDCompression; break;
      default:
      {
        TIFFClose(tiff);
        ThrowReaderException(CoderError,"UnknownCompression");
      }
    }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PREDICTOR,&value) == 1)
      {
        if (value == PREDICTOR_HORIZONTAL)
          tiff_image->properties.predictor=HorizontalPredictor;
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) == 1)
      tiff_image->rows_per_strip=(size_t) rows_per_strip;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&pages) == 1)
      {
        tiff_image->page.x=(size_t) pages;
        tiff_image->page.y=(size_t) pages;
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SUBFILETYPE,&value) == 1)
      {
        if (value & FILETYPE_REDUCEDIMAGE)
          tiff_image->properties.subimage=True;
        if (value & FILETYPE_PAGE)
          tiff_image->properties.tile=True;
        if (value & FILETYPE_MASK)
          tiff_image->properties.mask=True;
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_EXTRASAMPLES,&extra_samples,&sample_info) == 1)
      {
        for (i=0; i < (ssize_t) extra_samples; i++)
        {
          switch (sample_info[i])
          {
            case EXTRASAMPLE_ASSOCALPHA:
            case EXTRASAMPLE_UNASSALPHA:
            {
              tiff_image->alpha_trait=BlendPixelTrait;
              break;
            }
            default:
            {
              break;
            }
          }
        }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SAMPLEFORMAT,&sample_format) == 1)
      {
        for (i=0; i < (ssize_t) samples_per_pixel; i++)
        {
          switch (sample_format)
          {
            case SAMPLEFORMAT_UINT:
            {
              if (bits_per_sample == 8)
                tiff_image->storage_class=(i == 0) ? UndefinedPixelTrait :
                  CopyPixelTrait;
              break;
            }
            case SAMPLEFORMAT_INT:
            {
              if (bits_per_sample == 8)
                tiff_image->storage_class=(i == 0) ? UndefinedPixelTrait :
                  CopyPixelTrait;
              break;
            }
            case SAMPLEFORMAT_IEEEFP:
            {
              if (bits_per_sample == 32)
                tiff_image->storage_class=(i == 0) ? UndefinedPixelTrait :
                  CopyPixelTrait;
              break;
            }
            case SAMPLEFORMAT_VOID:
            {
              break;
            }
            default:
            {
              break;
            }
          }
        }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YCBCRCOEFFICIENTS,&chromaticity) == 1)
      {
        if (chromaticity != (float *) NULL)
          {
            tiff_image->chromaticity.y_chromaticity.x=chromaticity[0];
            tiff_image->chromaticity.y_chromaticity.y=chromaticity[1];
            tiff_image->chromaticity.cb_chromaticity.x=chromaticity[2];
            tiff_image->chromaticity.cb_chromaticity.y=chromaticity[3];
            tiff_image->chromaticity.cr_chromaticity.x=chromaticity[4];
            tiff_image->chromaticity.cr_chromaticity.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_REFERENCEBLACKWHITE,&chromaticity) == 1)
      {
        if (chromaticity != (float *) NULL)
          {
            tiff_image->chromaticity.black_point.x=chromaticity[0];
            tiff_image->chromaticity.black_point.y=chromaticity[1];
            tiff_image->chromaticity.white_point.x=chromaticity[2];
            tiff_image->chromaticity.white_point.y=chromaticity[3];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_TRANSFERFUNCTION,&chromaticity) == 1)
      {
        if (chromaticity != (float *) NULL)
          {
            tiff_image->chromaticity.red_primary.x=chromaticity[0];
            tiff_image->chromaticity.red_primary.y=chromaticity[1];
            tiff_image->chromaticity.green_primary.x=chromaticity[2];
            tiff_image->chromaticity.green_primary.y=chromaticity[3];
            tiff_image->chromaticity.blue_primary.x=chromaticity[4];
            tiff_image->chromaticity.blue_primary.y=chromaticity[5];
            tiff_image->chromaticity.white_point.x=chromaticity[6];
            tiff_image->chromaticity.white_point.y=chromaticity[7];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      {
        if (value != 0)
          (void) SetImageProperty(tiff_image,"tiff:software",
            (char *) value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ARTIST,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"tiff:artist",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_COPYRIGHT,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"tiff:copyright",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_DATETIME,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"tiff:timestamp",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_DOCUMENTNAME,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"tiff:document",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_HOSTCOMPUTER,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"tiff:hostcomputer",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_IMAGEDESCRIPTION,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"comment",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MAKE,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"tiff:make",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MODEL,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"tiff:model",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_OPIIMAGEID,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"tiff:image-id",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENAME,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"label",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"tiff:software",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,33423,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"tiff:kodak-33423",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,36867,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"tiff:kodak-36867",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SUBFILETYPE,&value) == 1)
      {
        if (value & FILETYPE_REDUCEDIMAGE)
          (void) SetImageProperty(tiff_image,"tiff:subfiletype","REDUCEDIMAGE",
            exception);
        if (value & FILETYPE_PAGE)
          (void) SetImageProperty(tiff_image,"tiff:subfiletype","PAGE",exception);
        if (value & FILETYPE_MASK)
          (void) SetImageProperty(tiff_image,"tiff:subfiletype","MASK",exception);
      }
    if (TIFFGetFieldDefaulted(tiff,37706,&value) == 1)
      {
        (void) SetImageProperty(tiff_image,"tiff:tietz_offset",
          (char *) value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XMLPACKET,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"tiff:xml-packet",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RICHTIFFIPTC,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"tiff:iptc",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PHOTOSHOP,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProperty(tiff_image,"tiff:photoshop",value,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ICCPROFILE,&value) == 1)
      {
        if (value != (char *) NULL)
          (void) SetImageProfile(tiff_image,"icc",BlobToStringInfo(value,