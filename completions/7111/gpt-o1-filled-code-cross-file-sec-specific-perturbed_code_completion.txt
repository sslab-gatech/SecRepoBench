{
  size_t scanline_size = 0;

  /*
    Allocate memory for TIFF pixels depending on read method.
  */
  if (method == ReadStripMethod)
    {
      /*
        For strip-based reading, we must allocate space for a full strip in RGBA.
      */
      MagickSizeType max_pixels;
      max_pixels=(MagickSizeType) rows_per_strip*(MagickSizeType) image->columns;
      if ((rows_per_strip == 0) || (image->columns == 0) ||
          (max_pixels > (MagickSizeType) (SIZE_MAX/sizeof(uint32))))
        ThrowTIFFException(CorruptImageError,"ImproperImageHeader");
      scanline_size=(size_t) (max_pixels*sizeof(uint32));
    }
  else
    {
      /*
        For other methods, buffer size is determined by TIFFScanlineSize().
      */
      scanline_size=(size_t) TIFFScanlineSize(tiff);
    }

  if (scanline_size == 0)
    ThrowTIFFException(CorruptImageError,"InvalidScanlineSize");

  tiff_pixels=(unsigned char *) AcquireQuantumMemory(scanline_size,1);
  if (tiff_pixels == (unsigned char *) NULL)
    ThrowTIFFException(ResourceLimitError,"MemoryAllocationFailed");
}