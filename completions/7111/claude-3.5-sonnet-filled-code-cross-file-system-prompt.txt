size_t
  allocation_size;

allocation_size=MagickMax(TIFFScanlineSize(tiff),rows_per_strip*TIFFScanlineSize(tiff));
allocation_size=MagickMax(allocation_size,image->columns*samples_per_pixel*((bits_per_sample+7)/8));
tiff_pixels=(unsigned char *) AcquireQuantumMemory(allocation_size,sizeof(*tiff_pixels));
if (tiff_pixels == (unsigned char *) NULL)
  ThrowTIFFException(ResourceLimitError,"MemoryAllocationFailed");