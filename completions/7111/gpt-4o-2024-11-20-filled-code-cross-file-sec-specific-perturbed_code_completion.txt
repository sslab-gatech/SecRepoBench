// Calculate the size of the buffer required for tiff_pixels
    size_t tiff_pixels_size = (size_t) TIFFScanlineSize(tiff) * image->rows;

    // Check for potential overflow in the buffer size calculation
    if (HeapOverflowSanityCheck(image->rows, TIFFScanlineSize(tiff)) != MagickFalse)
      ThrowTIFFException(ResourceLimitError, "MemoryAllocationFailed");

    // Allocate memory for tiff_pixels
    tiff_pixels = (unsigned char *) AcquireQuantumMemory(tiff_pixels_size, sizeof(*tiff_pixels));
    if (tiff_pixels == (unsigned char *) NULL)
      ThrowTIFFException(ResourceLimitError, "MemoryAllocationFailed");