/*
      Allocate memory for tiff_pixels to store the image data from the TIFF.
      If memory allocation fails, throw an exception.
    */
    switch (method)
    {
      case ReadStripMethod:
      {
        /*
          Each strip returned by TIFFReadRGBAStrip can hold rows_per_strip rows
          of RGBA data.
        */
        tiff_pixels=(unsigned char *) AcquireQuantumMemory(image->columns,
          (size_t) rows_per_strip*sizeof(uint32));
        if (tiff_pixels == (unsigned char *) NULL)
          ThrowTIFFException(ResourceLimitError,"MemoryAllocationFailed");
        break;
      }
      case ReadSingleSampleMethod:
      case ReadRGBAMethod:
      case ReadCMYKAMethod:
      case ReadYCCKMethod:
      {
        /*
          These methods read one scanline at a time.
        */
        tiff_pixels=(unsigned char *) AcquireQuantumMemory(1UL,
          (size_t) TIFFScanlineSize(tiff));
        if (tiff_pixels == (unsigned char *) NULL)
          ThrowTIFFException(ResourceLimitError,"MemoryAllocationFailed");
        break;
      }
      case ReadTileMethod:
      {
        /*
          The tile reading code handles its own buffer allocation separately.
        */
        tiff_pixels=(unsigned char *) NULL;
        break;
      }
      case ReadGenericMethod:
      default:
      {
        /*
          The generic method calls TIFFReadRGBAImage into a local buffer,
          so we don't need tiff_pixels here.
        */
        tiff_pixels=(unsigned char *) NULL;
        break;
      }
    }