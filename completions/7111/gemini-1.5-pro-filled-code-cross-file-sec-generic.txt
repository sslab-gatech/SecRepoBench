size_t scanline_size = TIFFScanlineSize(tiff);
    size_t rows_per_strip_size = rows_per_strip * sizeof(uint32);
    size_t pixel_size = (image->columns * samples_per_pixel * ((bits_per_sample + 7) / 8));
    size_t allocation_size = MagickMax(MagickMax(scanline_size, rows_per_strip_size), pixel_size);

    if (HeapOverflowSanityCheck(allocation_size, 1) != MagickFalse)
      ThrowTIFFException(ResourceLimitError, "MemoryAllocationFailed");

    tiff_pixels = (unsigned char *)AcquireQuantumMemory(allocation_size, 1);
    if (tiff_pixels == (unsigned char *)NULL)
      ThrowTIFFException(ResourceLimitError, "MemoryAllocationFailed");