// Allocate memory for tiff_pixels to store the image data from TIFF
    tiff_pixels = (unsigned char *) AcquireQuantumMemory((size_t) TIFFScanlineSize(tiff), image->rows);
    if (tiff_pixels == (unsigned char *) NULL)
    {
        TIFFClose(tiff);
        ThrowReaderException(ResourceLimitError, "MemoryAllocationFailed");
    }