size_t tiff_scanline_size = TIFFScanlineSize(tiff);
size_t rows_per_strip_size = rows_per_strip * ((image->columns * samples_per_pixel * bits_per_sample + 7) / 8);
size_t calculated_size = ((image->columns * samples_per_pixel * bits_per_sample + 7) / 8) * image->rows;
size_t allocation_size = MagickMax(MagickMax(tiff_scanline_size, rows_per_strip_size), calculated_size);

tiff_pixels = (unsigned char *) AcquireMagickMemory(allocation_size);
if (tiff_pixels == (unsigned char *) NULL)
  ThrowTIFFException(ResourceLimitError,"MemoryAllocationFailed");