size_t scanline_size = TIFFScanlineSize(tiff);
    size_t required_size = MagickMax(scanline_size, rows_per_strip * (image->columns * samples_per_pixel * (bits_per_sample / 8)));
    
    if (HeapOverflowSanityCheck(required_size, sizeof(*tiff_pixels)) != MagickFalse)
        ThrowTIFFException(ResourceLimitError, "MemoryAllocationFailed");

    tiff_pixels = (unsigned char *) AcquireQuantumMemory(required_size, sizeof(*tiff_pixels));
    if (tiff_pixels == (unsigned char *) NULL)
        ThrowTIFFException(ResourceLimitError, "MemoryAllocationFailed");