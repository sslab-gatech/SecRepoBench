number_pixels=(MagickSizeType) image->columns*image->rows;
if (number_pixels != 0)
  {
    size_t
      extent,
      length;

    extent=MagickMax(BZipMaxExtent(image->columns*sizeof(uint32)),
      ZipMaxExtent(image->columns*sizeof(uint32)));
    if ((image->columns == 0) || (image->rows == 0) ||
        ((MagickSizeType) extent > GetBlobSize(image)))
      ThrowTIFFException(CorruptImageError,"InsufficientImageDataInFile");
    length=MagickMax(image->columns,image->rows)*sizeof(uint32);
    if (HeapOverflowSanityCheck(image->columns,sizeof(uint32)) != MagickFalse)
      ThrowTIFFException(ResourceLimitError,"MemoryAllocationFailed");
    tiff_pixels=(unsigned char *) AcquireQuantumMemory(length,sizeof(*tiff_pixels));
    if (tiff_pixels == (unsigned char *) NULL)
      ThrowTIFFException(ResourceLimitError,"MemoryAllocationFailed");
  }