switch (v->type) {
    case MSGPACK_OBJECT_BOOLEAN:
        str_size = snprintf(str, sizeof(str), "%d", v->value.as Boolean);
        break;
    case MSGPACK_OBJECT_POSITIVE_INTEGER:
    case MSGPACK_OBJECT_NEGATIVE_INTEGER:
        str_size = snprintf(str, sizeof(str), "%lld", v->value.as Integer);
        break;
    case MSGPACK_OBJECT_FLOAT:
        str_size = snprintf(str, sizeof(str), "%g", v->value.as Float);
        break;
    case MSGPACK_OBJECT_STR:
        str_size = v->via.str.len;
        js = flb_sds_create_size(str_size);
        memcpy(js, v->via.str.ptr, str_size);
        break;
    case MSGPACK_OBJECT_NIL:
        str_size = snprintf(str, sizeof(str), "null");
        break;
    default:
        return buf;
}

if (str_size > 0) {
    tmp = flb_sds_create_size(str_size);
    memcpy(tmp, str, str_size);
    buf = flb_sds_cat(buf, tmp);
    flb_sds_destroy(tmp);
}