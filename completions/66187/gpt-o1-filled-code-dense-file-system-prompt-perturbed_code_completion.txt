{
	/* check if this is a 4-byte UTF-8 sequence */
	if (((linebuffer[i] & 0xf8) == 0xf0) && (i + 3 < len) &&
		((linebuffer[i+1] & 0xc0) == 0x80) &&
		((linebuffer[i+2] & 0xc0) == 0x80) &&
		((linebuffer[i+3] & 0xc0) == 0x80)) 
	{
		/* copy the 4-byte sequence */
		if (j + 3 >= GF_ARRAY_LENGTH(szLineConv)) 
			break;
		szLineConv[j++] = linebuffer[i++];
		szLineConv[j++] = linebuffer[i++];
		szLineConv[j++] = linebuffer[i++];
		szLineConv[j++] = linebuffer[i];
		continue;
	}

	/* otherwise handle a 3-byte UTF-8 sequence */
	if ((i + 2 < len) &&
		((linebuffer[i+1] & 0xc0) == 0x80) &&
		((linebuffer[i+2] & 0xc0) == 0x80)) 
	{
		/* copy the 3-byte sequence */
		if (j + 2 >= GF_ARRAY_LENGTH(szLineConv)) 
			break;
		szLineConv[j++] = linebuffer[i++];
		szLineConv[j++] = linebuffer[i++];
		szLineConv[j++] = linebuffer[i];
		continue;
	}
}