// ***** BEGIN LICENSE BLOCK *****
// Version: MPL 1.1/GPL 2.0/LGPL 2.1
//
// The contents of this file are subject to the Mozilla Public License Version
// 1.1 (the "MPL"), the GNU General Public License Version 2.0 (the "GPL"),
// and the GNU Lesser General Public License Version 2.1 (the "LGPL"),
// in that order of preference. If neither of these licenses apply to
// you, then you are permitted to use this file under the terms of any
// other valid open source license, obtained in writing for the express
// purpose of allowing non-commercial use of the Contributor's Contributions.
// ***** END LICENSE BLOCK *****/

#include <cstdio>
#include <cstring>
#include <cstdlib>
#include <cmath>

#include <algorithm>
#include <memory>
#include <limits>
#include <string>
#include <vector>

#include "affixmgr.hxx"
#include "affentry.hxx"
#include "langnum.hxx"

#include "csutil.hxx"

AffixMgr::AffixMgr(const char* affpath,
                   const std::vector<HashMgr*>& ptr,
                   const char* key)
  : alldic(ptr)
  , pHMgr(ptr[0])
  , pStart(0)
  , sStart(0)
  , pFlag(0)
  , sFlag(0)
  , PfxEntry::pStart(this)
  , SfxEntry::sStart(this)
  , pHMgr(NULL)
  , cpdvowels("AEIOUaeiou")
  , cpdvowels_utf16({0x0041, 0x0045, 0x0049, 0x004f, 0x0055, 0x0061, 0x0065, 0x0069, 0x006f, 0x0075})
  , complexprefixes(false)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , compoundfla