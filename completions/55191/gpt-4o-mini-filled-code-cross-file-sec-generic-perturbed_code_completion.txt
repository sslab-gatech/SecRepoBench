if ((rv) && (rv->astr) &&
            (TESTAFF(rv->astr, forbiddenword, rv->alen) ||
             TESTAFF(rv->astr, needaffix, rv->alen) ||
             TESTAFF(rv->astr, ONLYUPCASEFLAG, rv->alen) ||
             (is_sug && nosuggest && TESTAFF(rv->astr, nosuggest, rv->alen)))) {
          st[char_index] = ch;
          break;
        }

        // Check if the current word segment is valid for compounding
        if ((rv) && (compoundflag && TESTAFF(rv->astr, compoundflag, rv->alen)) &&
            (compoundend && TESTAFF(rv->astr, compoundend, rv->alen)) &&
            (compoundmiddle && TESTAFF(rv->astr, compoundmiddle, rv->alen))) {
          // Ensure that the word does not exceed syllable limits
          if ((cpdwordmax == -1 || wordnum + 1 < cpdwordmax) &&
              (cpdmaxsyllable == 0 || numsyllable + get_syllable(std::string(HENTRY_WORD(rv), rv->blen)) <= cpdmaxsyllable)) {
            // Validate against compound patterns
            if (checkcpdtable.empty() || scpd != 0 || 
                (char_index < word.size() && !cpdpat_check(word, char_index, rv_first, rv, 0))) {
              return rv_first;
            }
          }
        }