static size_t
digits(mpz_t *number)
{
  size_t count = 0;
  size_t i;

  // Skip leading zeros
  for (i = 0; i < number->sz && (number->p)[i] == 0; i++);

  // Count significant digits
  for (; i < number->sz; i++)
    count += DIGITBITS;

  // Adjust for the last limb if it has less than DIGITBITS bits set
  if (i > 0 && (number->p)[i - 1] != 0) {
    size_t j;
    for (j = 0; (number->p)[i - 1] & (1 << j); j++);
    count += j;
  }

  return count;
}