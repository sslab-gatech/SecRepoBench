if (mp_buf != tmp_out_buf) {
        flb_free(mp_buf);
    }

    if (parser->time_fmt) {
        time_key = parser->time_key ? parser->time_key : "time";
        slen = strlen(time_key);
        skip = -1;

        for (i = 0; i < map_size; i++) {
            k = map.via.map.ptr[i].key;
            v = map.via.map.ptr[i].val;

            if (k.type != MSGPACK_OBJECT_STR) {
                continue;
            }

            if (k.via.str.size != slen) {
                continue;
            }

            if (strncmp(k.via.str.ptr, time_key, slen) == 0) {
                if (parser->time_keep == FLB_FALSE) {
                    skip = i;
                }
                time_value = &v;
                break;
            }

            k = NULL;
            time_value = NULL;
        }
    }
    else {
        k = NULL;
        time_value = NULL;
    }