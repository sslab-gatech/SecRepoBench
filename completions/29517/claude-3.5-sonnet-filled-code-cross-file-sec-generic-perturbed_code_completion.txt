if (H5Aexists_by_name(dset_id, ".", "MATLAB_fields", H5P_DEFAULT)) {
    err = Mat_H5ReadFieldNames(matvariable, dset_id, &nfields);
} else {
    struct ReadGroupInfoIterData group_data = {0};
    group_data.matvar = matvariable;
    group_data.nfields = 0;

    if (H5Literate(dset_id, H5_INDEX_NAME, H5_ITER_NATIVE, NULL, Mat_H5ReadGroupInfoIterate, &group_data) < 0) {
        return MATIO_E_GENERIC_READ_ERROR;
    }
    nfields = group_data.nfields;
}

if (nfields > 0 && NULL != matvariable->internal->fieldnames) {
    matvariable->internal->num_fields = nfields;
    if (NULL == matvariable->fieldnames) {
        matvariable->fieldnames = (char**)calloc(nfields, sizeof(*matvariable->fieldnames));
    }
    if (NULL != matvariable->fieldnames) {
        size_t i;
        for (i = 0; i < nfields; i++) {
            matvariable->fieldnames[i] = strdup(matvariable->internal->fieldnames[i]);
        }
    } else {
        err = MATIO_E_OUT_OF_MEMORY;
    }
}