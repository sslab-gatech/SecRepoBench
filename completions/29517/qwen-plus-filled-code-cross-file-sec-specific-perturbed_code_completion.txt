if ( H5Aexists_by_name(dset_id,".","MATLAB_fields",H5P_DEFAULT) ) {
    hsize_t nfields = 0;
    herr_t status = H5Aopen_by_name(dset_id, ".", "MATLAB_fields", H5P_DEFAULT, H5P_DEFAULT);
    if (status >= 0) {
        hid_t field_attr_id = status;
        status = H5Aget_storage_size(field_attr_id);
        if (status >= 0) {
            nfields = (hsize_t)(status / sizeof(char*));
            matvariable->internal->fieldnames = (char**)malloc(nfields * sizeof(char*));
            if (matvariable->internal->fieldnames == NULL) {
                H5Aclose(field_attr_id);
                return MATIO_E_OUT_OF_MEMORY;
            }
            status = H5Aread(field_attr_id, H5T_C_S1, matvariable->internal->fieldnames);
            if (status < 0) {
                free(matvariable->internal->fieldnames);
                matvariable->internal->fieldnames = NULL;
                H5Aclose(field_attr_id);
                return MATIO_E_GENERIC_READ_ERROR;
            }
            matvariable->internal->num_fields = (int)nfields;
        }
        H5Aclose(field_attr_id);
    }
} else {
    struct ReadGroupInfoIterData group_data = {matvariable, 0};
    H5Literate(dset_id, H5_INDEX_NAME, H5_ITER_NATIVE, NULL, Mat_H5ReadGroupInfoIterate, &group_data);
    nfields = group_data.nfields;
    if (nfields > 0) {
        matvariable->internal->fieldnames = (char**)malloc(nfields * sizeof(char*));
        if (matvariable->internal->fieldnames == NULL) {
            return MATIO_E_OUT_OF_MEMORY;
        }
        for (hsize_t i = 0; i < nfields; ++i) {
            matvariable->internal->fieldnames[i] = strdup(group_data.matvar->internal->fieldnames[i]);
            if (matvariable->internal->fieldnames[i] == NULL) {
                for (hsize_t j = 0; j < i; ++j) {
                    free(matvariable->internal->fieldnames[j]);
                }
                free(matvariable->internal->fieldnames);
                matvariable->internal->fieldnames = NULL;
                return MATIO_E_OUT_OF_MEMORY;
            }
        }
        matvariable->internal->num_fields = (int)nfields;
    }
}