if ( H5Aexists_by_name(dset_id,".","MATLAB_fields",H5P_DEFAULT) ) {
    hid_t field_attr_id, field_type_id;
    hsize_t num_fields;
    field_attr_id = H5Aopen_by_name(dset_id,".","MATLAB_fields",H5P_DEFAULT,H5P_DEFAULT);
    field_type_id = H5Aget_type(field_attr_id);
    if ( H5T_STRING == H5Tget_class(field_type_id) ) {
        hid_t field_space_id = H5Aget_space(field_attr_id);
        H5Sget_simple_extent_dims(field_space_id, &num_fields, NULL);
        matvariable->internal->fieldnames = (char**)calloc(num_fields, sizeof(*matvariable->internal->fieldnames));
        if ( NULL != matvariable->internal->fieldnames ) {
            char **fieldnames = (char**)calloc(num_fields, sizeof(char*));
            if ( NULL != fieldnames ) {
                H5Aread(field_attr_id, field_type_id, fieldnames);
                for ( hsize_t i = 0; i < num_fields; i++ ) {
                    matvariable->internal->fieldnames[i] = strdup(fieldnames[i]);
                }
                free(fieldnames);
                nfields = num_fields;
            } else {
                err = MATIO_E_OUT_OF_MEMORY;
            }
        } else {
            err = MATIO_E_OUT_OF_MEMORY;
        }
        H5Sclose(field_space_id);
    }
    H5Tclose(field_type_id);
    H5Aclose(field_attr_id);
} else {
    H5G_info_t group_info;
    H5Gget_info(dset_id, &group_info);
    nfields = group_info.nlinks;
    if ( nfields > 0 ) {
        matvariable->internal->fieldnames = (char**)calloc(nfields, sizeof(*matvariable->internal->fieldnames));
        if ( NULL != matvariable->internal->fieldnames ) {
            struct ReadGroupInfoIterData group_data;
            group_data.matvar = matvariable;
            group_data.nfields = 0;
            H5Literate(dset_id, H5_INDEX_NAME, H5_ITER_INC, NULL, Mat_H5ReadGroupInfoIterate, &group_data);
        } else {
            err = MATIO_E_OUT_OF_MEMORY;
        }
    }
}