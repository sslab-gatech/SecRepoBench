/* Check if the structure defines its fields using the "MATLAB_fields" attribute */
if ( H5Aexists_by_name(dset_id, ".", "MATLAB_fields", H5P_DEFAULT) ) {
    err = Mat_H5ReadFieldNames(matvariable, dset_id, &nfields);
} else {
    /* Get the number of links in the dataset group */
    H5G_info_t group_info;
    herr_t herr = H5Gget_info(dset_id, &group_info);
    if ( herr < 0 ) {
        return MATIO_E_GENERIC_READ_ERROR;
    }

    /* If there are no links, return without error */
    if ( group_info.nlinks == 0 ) {
        nfields = 0;
        return MATIO_E_NO_ERROR;
    }

    /* Iterate through the links to count the fields */
    struct ReadGroupInfoIterData group_data = {0, NULL};
    herr = H5Literate(dset_id, H5_INDEX_NAME, H5_ITER_INC, NULL, 
                      Mat_H5ReadGroupInfoIterate, &group_data);
    if ( herr < 0 ) {
        return MATIO_E_GENERIC_READ_ERROR;
    }
    
    nfields = group_data.nfields;
    
    /* If fields were found, allocate memory for the fieldnames */
    if ( nfields > 0 ) {
        matvariable->internal->num_fields = nfields;
        matvariable->internal->fieldnames = (char**)calloc(nfields, sizeof(*matvariable->internal->fieldnames));
        if ( NULL == matvariable->internal->fieldnames ) {
            return MATIO_E_OUT_OF_MEMORY;
        }
        
        /* Second iteration to get the field names */
        group_data.nfields = 0;  /* Reset for second pass */
        group_data.matvar = matvariable;  /* Set matvar for second pass */
        herr = H5Literate(dset_id, H5_INDEX_NAME, H5_ITER_INC, NULL, 
                          Mat_H5ReadGroupInfoIterate, &group_data);
        if ( herr < 0 ) {
            return MATIO_E_GENERIC_READ_ERROR;
        }
    }
}