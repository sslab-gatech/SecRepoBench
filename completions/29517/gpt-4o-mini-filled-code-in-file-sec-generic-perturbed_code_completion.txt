if ( H5Aexists_by_name(dset_id,".","MATLAB_fields",H5P_DEFAULT) ) {
        hsize_t nfields;
        err = Mat_H5ReadFieldNames(matvariable, dset_id, &nfields);
    } else {
        hsize_t nlinks;
        herr_t herr = H5Gget_num_objs(dset_id, &nlinks);
        if (herr < 0) {
            return MATIO_E_GENERIC_READ_ERROR;
        }
        matvariable->internal->num_fields = (unsigned int)nlinks;
        matvariable->internal->fieldnames = (char**)calloc(nlinks, sizeof(char*));
        if (matvariable->internal->fieldnames == NULL) {
            return MATIO_E_OUT_OF_MEMORY;
        }
        for (hsize_t i = 0; i < nlinks; i++) {
            matvariable->internal->fieldnames[i] = (char*)malloc(256); // Assuming max field name length
            if (matvariable->internal->fieldnames[i] == NULL) {
                for (hsize_t j = 0; j < i; j++) {
                    free(matvariable->internal->fieldnames[j]);
                }
                free(matvariable->internal->fieldnames);
                return MATIO_E_OUT_OF_MEMORY;
            }
            herr = H5Gget_objname_by_idx(dset_id, i, matvariable->internal->fieldnames[i], 256);
            if (herr < 0) {
                for (hsize_t j = 0; j <= i; j++) {
                    free(matvariable->internal->fieldnames[j]);
                }
                free(matvariable->internal->fieldnames);
                return MATIO_E_GENERIC_READ_ERROR;
            }
        }
    }