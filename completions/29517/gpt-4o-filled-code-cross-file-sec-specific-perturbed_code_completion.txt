if ( H5Aexists_by_name(dset_id, ".", "MATLAB_fields", H5P_DEFAULT) ) {
    hid_t attr_id = H5Aopen_by_name(dset_id, ".", "MATLAB_fields", H5P_DEFAULT, H5P_DEFAULT);
    hid_t atype = H5Aget_type(attr_id);
    hid_t aspace = H5Aget_space(attr_id);
    hsize_t nfields = H5Sget_simple_extent_npoints(aspace);
    matvariable->internal->fieldnames = (char**)calloc((size_t)nfields, sizeof(*matvariable->internal->fieldnames));
    if ( matvariable->internal->fieldnames != NULL ) {
        char **fieldnames = (char**)calloc((size_t)nfields, sizeof(*fieldnames));
        if ( fieldnames != NULL ) {
            H5Aread(attr_id, atype, fieldnames);
            for ( hsize_t i = 0; i < nfields; i++ ) {
                matvariable->internal->fieldnames[i] = strdup(fieldnames[i]);
            }
            free(fieldnames);
        } else {
            H5Aclose(attr_id);
            H5Tclose(atype);
            H5Sclose(aspace);
            return MATIO_E_OUT_OF_MEMORY;
        }
    } else {
        H5Aclose(attr_id);
        H5Tclose(atype);
        H5Sclose(aspace);
        return MATIO_E_OUT_OF_MEMORY;
    }
    H5Aclose(attr_id);
    H5Tclose(atype);
    H5Sclose(aspace);
} else {
    H5G_info_t group_info;
    H5Gget_info(dset_id, &group_info);
    nfields = group_info.nlinks;
    matvariable->internal->fieldnames = (char**)calloc((size_t)nfields, sizeof(*matvariable->internal->fieldnames));
    if ( matvariable->internal->fieldnames != NULL ) {
        struct ReadGroupInfoIterData group_data;
        group_data.matvar = matvariable;
        group_data.nfields = 0;
        H5Literate(dset_id, H5_INDEX_NAME, H5_ITER_INC, NULL, Mat_H5ReadGroupInfoIterate, &group_data);
    } else {
        return MATIO_E_OUT_OF_MEMORY;
    }
}