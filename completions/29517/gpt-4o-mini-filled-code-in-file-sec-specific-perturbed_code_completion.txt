if ( H5Aexists_by_name(dset_id,".","MATLAB_fields",H5P_DEFAULT) ) {
        hsize_t nfields;
        err = Mat_H5ReadFieldNames(matvar, dset_id, &nfields);
    } else {
        hsize_t nlinks;
        herr_t herr = H5Gget_num_objs(dset_id, &nlinks);
        if (herr < 0) {
            return MATIO_E_GENERIC_READ_ERROR;
        }
        matvar->internal->num_fields = (unsigned int)nlinks;
        matvar->internal->fieldnames = (char**)calloc((size_t)nlinks, sizeof(char*));
        if (matvar->internal->fieldnames == NULL) {
            return MATIO_E_OUT_OF_MEMORY;
        }
        for (hsize_t i = 0; i < nlinks; i++) {
            matvar->internal->fieldnames[i] = (char*)malloc(256); // Assuming a max field name length
            if (matvar->internal->fieldnames[i] == NULL) {
                for (hsize_t j = 0; j < i; j++) {
                    free(matvar->internal->fieldnames[j]);
                }
                free(matvar->internal->fieldnames);
                return MATIO_E_OUT_OF_MEMORY;
            }
            herr = H5Lget_name_by_idx(dset_id, ".", H5_INDEX_NAME, H5_ITER_INC, i, matvar->internal->fieldnames[i], 256, H5P_DEFAULT);
            if (herr < 0) {
                for (hsize_t j = 0; j <= i; j++) {
                    free(matvar->internal->fieldnames[j]);
                }
                free(matvar->internal->fieldnames);
                return MATIO_E_GENERIC_READ_ERROR;
            }
        }
    }