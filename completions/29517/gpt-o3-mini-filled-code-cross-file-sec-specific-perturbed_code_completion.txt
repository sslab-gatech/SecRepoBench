if ( H5Aexists_by_name(dset_id, ".", "MATLAB_fields", H5P_DEFAULT) ) {
    /* If the MATLAB_fields attribute exists, read field names from it */
    err = Mat_H5ReadFieldNames(matvariable, dset_id, &nfields);
    if ( err < 0 ) {
        return err;
    }
} else {
    /* Otherwise, iterate over the links in the group to collect field names */
    H5G_info_t group_info;
    if ( H5Gget_info(dset_id, &group_info) < 0 ) {
        return MATIO_E_UNKNOWN_ERROR;
    }
    nfields = group_info.nlinks;
    if ( nfields > 0 ) {
        if ( matvariable->internal == NULL ) {
            Mat_Critical("Internal structure is NULL");
            return MATIO_E_UNKNOWN_ERROR;
        }
        matvariable->internal->fieldnames = (char**)calloc((size_t)nfields, sizeof(char*));
        if ( NULL == matvariable->internal->fieldnames ) {
            Mat_Critical("Error allocating memory for field names");
            return MATIO_E_OUT_OF_MEMORY;
        }
        {
            struct ReadGroupInfoIterData group_data;
            group_data.matvar = matvariable;
            group_data.nfields = 0;
            herr_t herr = H5Literate(dset_id, H5_INDEX_NAME, H5_ITER_NATIVE, NULL,
                                      Mat_H5ReadGroupInfoIterate, &group_data);
            if ( herr < 0 ) {
                return MATIO_E_GENERIC_READ_ERROR;
            }
            nfields = group_data.nfields;
        }
    }
}
if(matvariable->internal)
    matvariable->internal->num_fields = nfields;