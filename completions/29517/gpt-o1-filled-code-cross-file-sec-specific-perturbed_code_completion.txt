if ( H5Aexists_by_name(dset_id,".","MATLAB_fields",H5P_DEFAULT) ) {
        err = Mat_H5ReadFieldNames(matvariable, dset_id, &nfields);
        if ( err ) {
            return err;
        }
    } else {
        struct ReadGroupInfoIterData group_data_count;
        struct ReadGroupInfoIterData group_data_store;
        hsize_t idx = 0;
        memset(&group_data_count, 0, sizeof(group_data_count));
        group_data_count.matvar = NULL;

        /* First pass: count the fields */
        H5Literate(dset_id, H5_INDEX_NAME, H5_ITER_INC, &idx,
                   Mat_H5ReadGroupInfoIterate, &group_data_count);
        nfields = group_data_count.nfields;

        if ( nfields > 0 ) {
            size_t size;
            err = Mul(&size, nfields, sizeof(*matvariable->internal->fieldnames));
            if ( err ) {
                Mat_Critical("Integer multiplication overflow");
                return err;
            }

            matvariable->internal->fieldnames = (char**)calloc(size, 1);
            if ( NULL == matvariable->internal->fieldnames ) {
                return MATIO_E_OUT_OF_MEMORY;
            }

            /* Second pass: store the field names */
            idx = 0;
            memset(&group_data_store, 0, sizeof(group_data_store));
            group_data_store.matvar = matvariable;
            H5Literate(dset_id, H5_INDEX_NAME, H5_ITER_INC, &idx,
                       Mat_H5ReadGroupInfoIterate, &group_data_store);
        }
    }

    matvariable->internal->num_fields = (int)nfields;