if ( H5Aexists_by_name(dset_id,".","MATLAB_fields",H5P_DEFAULT) ) {
    hsize_t nfields_local;
    err = Mat_H5ReadFieldNames(matvariable, dset_id, &nfields_local);
    if ( err < 0 ) {
        return err;
    }
    nfields = nfields_local;
    matvariable->internal->num_fields = (size_t)nfields;
} else {
    hsize_t idx = 0;
    struct ReadGroupInfoIterData group_data;
    group_data.matvar = matvariable;
    group_data.nfields = 0;

    (void)H5Literate(dset_id, H5_INDEX_NAME, H5_ITER_INC, &idx,
                     Mat_H5ReadGroupInfoIterate, (void*)&group_data);
    nfields = group_data.nfields;
    matvariable->internal->num_fields = (size_t)nfields;
}