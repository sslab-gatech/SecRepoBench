if ( H5Aexists_by_name(dset_id,".","MATLAB_fields",H5P_DEFAULT) ) {
    err = Mat_H5ReadFieldNames(matvariable, dset_id, &nfields);
    if ( err ) {
        return err;
    }
} else {
    /* First iteration to count the number of fields */
    struct ReadGroupInfoIterData group_data = {0, NULL};
    /* No matvar in first pass to just count */
    H5Literate(dset_id, H5_INDEX_NAME, H5_ITER_INC, NULL,
               Mat_H5ReadGroupInfoIterate, &group_data);
    nfields = group_data.nfields;
    
    /* Second iteration to collect field names */
    if ( nfields > 0 ) {
        matvariable->internal->fieldnames =
            (char**)calloc(nfields, sizeof(*matvariable->internal->fieldnames));
        if ( NULL == matvariable->internal->fieldnames ) {
            Mat_Critical("Error allocating memory for structure fieldnames");
            return MATIO_E_OUT_OF_MEMORY;
        }
        /* Reset field count and provide matvar for second pass */
        group_data.nfields = 0;
        group_data.matvar = matvariable;
        H5Literate(dset_id, H5_INDEX_NAME, H5_ITER_INC, NULL,
                   Mat_H5ReadGroupInfoIterate, &group_data);
    }
}
matvariable->internal->num_fields = nfields;
matvariable->class_type = MAT_C_STRUCT;