if ( H5Aexists_by_name(dset_id, ".", "MATLAB_fields", H5P_DEFAULT) ) {
    err = Mat_H5ReadFieldNames(matvariable, dset_id, &nfields);
    if ( err < 0 ) {
        return err;
    }
    matvariable->internal->num_fields = nfields;
} else {
    H5G_info_t group_info;
    if ( H5Gget_info(dset_id, &group_info) < 0 ) {
        return MATIO_E_GENERIC_READ_ERROR;
    }
    nfields = group_info.nlinks;
    if ( nfields > 0 ) {
        /* Allocate memory for storing the field names */
        matvariable->internal->fieldnames = (char**)calloc(nfields, sizeof(char*));
        if ( NULL == matvariable->internal->fieldnames ) {
            return MATIO_E_OUT_OF_MEMORY;
        }
        /* Iterate over the links in the group to collect field names */
        struct ReadGroupInfoIterData group_data;
        group_data.nfields = 0;
        group_data.matvar   = matvariable;
        err = H5Literate(dset_id, H5_INDEX_NAME, H5_ITER_NATIVE, NULL, Mat_H5ReadGroupInfoIterate, &group_data);
        if ( err < 0 ) {
            return MATIO_E_GENERIC_READ_ERROR;
        }
        nfields = group_data.nfields;
        matvariable->internal->num_fields = nfields;
    }
}