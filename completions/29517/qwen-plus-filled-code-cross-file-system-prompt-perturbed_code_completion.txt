// Check if the structure defines its fields using the "MATLAB_fields" attribute.
if ( H5Aexists_by_name(dset_id, ".", "MATLAB_fields", H5P_DEFAULT) ) {
    hid_t attr_id = H5Aopen_by_name(dset_id, ".", "MATLAB_fields", H5P_DEFAULT, H5P_DEFAULT);
    hsize_t nfields;
    herr_t status = H5Aget_storage_size(attr_id, &nfields);
    H5Aclose(attr_id);

    if ( status >= 0 && nfields > 0 ) {
        matvar_t *field_names_var = Mat_VarCalloc();
        field_names_var->class_type = MAT_C_CHAR;
        field_names_var->isComplex = MAT_F_DONTKNOW;
        field_names_var->rank = 2;
        field_names_var->data_size = sizeof(char);
        field_names_var->dims = (size_t*)malloc(2 * sizeof(*field_names_var->dims));
        if ( NULL == field_names_var->dims ) {
            Mat_VarFree(field_names_var);
            return MATIO_E_OUT_OF_MEMORY;
        }
        field_names_var->dims[0] = nfields;
        field_names_var->dims[1] = 1;
        field_names_var->nbytes = nfields * sizeof(char*);
        field_names_var->data = calloc(nfields, sizeof(char*));

        err = Mat_H5ReadData73(mat, field_names_var, field_names_var->data, NULL, NULL, NULL);
        if ( err < 0 ) {
            Mat_VarFree(field_names_var);
            return err;
        }

        matvariable->internal->num_fields = nfields;
        matvariable->internal->fieldnames = (char**)calloc(nfields, sizeof(char*));
        if ( NULL == matvariable->internal->fieldnames ) {
            Mat_VarFree(field_names_var);
            return MATIO_E_OUT_OF_MEMORY;
        }

        for ( size_t i = 0; i < nfields; ++i ) {
            matvariable->internal->fieldnames[i] = strdup(((char**)field_names_var->data)[i]);
            if ( NULL == matvariable->internal->fieldnames[i] ) {
                while ( i-- > 0 ) free(matvariable->internal->fieldnames[i]);
                free(matvariable->internal->fieldnames);
                Mat_VarFree(field_names_var);
                return MATIO_E_OUT_OF_MEMORY;
            }
        }

        Mat_VarFree(field_names_var);
        nfields = matvariable->internal->num_fields;
    } else {
        return MATIO_E_GENERIC_READ_ERROR;
    }
} else {
    struct ReadGroupInfoIterData group_data;
    group_data.matvar = matvariable;
    group_data.nfields = 0;

    herr_t status = H5Literate(dset_id, H5_INDEX_NAME, H5_ITER_INC, NULL,
                               Mat_H5ReadGroupInfoIterate, (void*)&group_data);
    if ( status < 0 ) {
        return MATIO_E_GENERIC_READ_ERROR;
    }

    nfields = group_data.nfields;
    if ( nfields > 0 ) {
        matvariable->internal->num_fields = nfields;
        matvariable->internal->fieldnames = (char**)calloc(nfields, sizeof(char*));
        if ( NULL == matvariable->internal->fieldnames ) {
            return MATIO_E_OUT_OF_MEMORY;
        }

        for ( hsize_t i = 0; i < nfields; ++i ) {
            matvariable->internal->fieldnames[i] = strdup(group_data.matvar->internal->fieldnames[i]);
            if ( NULL == matvariable->internal->fieldnames[i] ) {
                while ( i-- > 0 ) free(matvariable->internal->fieldnames[i]);
                free(matvariable->internal->fieldnames);
                return MATIO_E_OUT_OF_MEMORY;
            }
        }
    }
}