mrb_int value;
if (mrb_string_to_int(mrb, mrb_str_substr(mrb, tmpl->str, tmpl->idx, tlen - tmpl->idx), 10, &value) == MRB_INT_OVERFLOW) {
  mrb_raise(mrb, E_RUNTIME_ERROR, "template length too large");
}
repeatcount = (int)value;
tmpl->idx += mrb_int_to_str(mrb, value, 10, NULL);