mrb_int count = 0;
while (ISDIGIT(ch)) {
  count = count * 10 + (ch - '0');
  tmpl->idx++;
  if (tmpl->idx >= tlen) {
    mrb_raisef(mrb, E_RUNTIME_ERROR, "template length is too large");
  }
  ch = tptr[tmpl->idx];
}
if (count == 0) {
  mrb_raisef(mrb, E_ARGUMENT_ERROR, "zero length repeat");
}
repeatcount = count;