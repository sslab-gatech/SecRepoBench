int num = 0;
    while (ISDIGIT(ch)) {
        num = num * 10 + (ch - '0');
        tmpl->idx++;
        if (tmpl->idx >= tlen) break;
        ch = tptr[tmpl->idx];
    }
    if (tmpl->idx >= tlen) {
        mrb_raisef(mrb, E_RUNTIME_ERROR, "mruby-pack template length too large");
    }
    *countp = num;