int i = tmpl->idx;
      long val = 0;
      for (; i < tlen && ISDIGIT(tptr[i]); i++) {
        int next_val;
        if (__builtin_mul_overflow(val, 10, &val) ||
            __builtin_add_overflow(val, tptr[i] - '0', &val)) {
          mrb_raise(mrb, E_RUNTIME_ERROR, "too big template length");
        }
      }
      if (i == tmpl->idx) {
        val = 1;
      }
      repeatcount = (int)val;
      tmpl->idx = i;