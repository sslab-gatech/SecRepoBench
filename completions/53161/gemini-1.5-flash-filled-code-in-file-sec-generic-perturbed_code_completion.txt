char *endptr;
      mrb_int num = mrb_strtoi(mrb, tptr + tmpl->idx, &endptr, 10);
      if (endptr == tptr + tmpl->idx) {
        mrb_raise(mrb, E_RUNTIME_ERROR, "template length is too large");
      }
      tmpl->idx = endptr - tptr;
      if (num < 0) {
        mrb_raise(mrb, E_RANGE_ERROR, "negative (or overflowed) integer");
      }
      if (type == PACK_TYPE_STRING) {
        if (num > INT_MAX) {
          mrb_raise(mrb, E_RUNTIME_ERROR, "template length is too large");
        }
        count = (int)num;
      } else {
        count = (int)num;
      }