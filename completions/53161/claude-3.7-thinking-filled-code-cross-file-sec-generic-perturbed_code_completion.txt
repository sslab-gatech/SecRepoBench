{
  mrb_int n = ch - '0';
  while (tmpl->idx + 1 < tlen) {
    ch = tptr[tmpl->idx + 1];
    if (!ISDIGIT(ch)) break;
    tmpl->idx++;
    
    mrb_int old_n = n;
    n = n * 10 + (ch - '0');
    
    // Check for overflow
    if (n < 0 || n / 10 != old_n) {
      mrb_raise(mrb, E_RUNTIME_ERROR, "template length too big");
    }
  }
  repeatcount = n;
}