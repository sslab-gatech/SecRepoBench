int count;
if (ISDIGIT(ch)) {
  count = 0;
  while (ISDIGIT(tptr[tmpl->idx])) {
    count = count * 10 + (tptr[tmpl->idx] - '0');
    tmpl->idx++;
  }
  if (count > INT_MAX) {
    mrb_raisef(mrb, E_RUNTIME_ERROR, "template length too large: %d", count);
  }
} else {
  count = 1;
}