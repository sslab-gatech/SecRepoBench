// Check if the current character is a digit.
// If so, read an integer value from the template string.
// Update the template index to point after the read integer value.
// If reading fails raise a runtime error indicating the template length is too large.
int ch_val;
if (ISDIGIT(ch)) {
  char *endptr;
  ch_val = (int)strtol(&tptr[tmpl->idx], &endptr, 10);
  if (endptr == &tptr[tmpl->idx]) {
    mrb_raisef(mrb, E_RUNTIME_ERROR, "template length too large");
  }
  tmpl->idx = endptr - tptr;
  if (type == PACK_TYPE_NONE) {
    repeatcount = ch_val;
  } else {
    size *= ch_val;
  }
}