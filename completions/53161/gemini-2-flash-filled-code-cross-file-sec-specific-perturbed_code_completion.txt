mrb_int num = 0;
      while (tmpl->idx < tlen && ISDIGIT(tptr[tmpl->idx])) {
        if (num > (MRB_INT_MAX / 10)) {
          mrb_raise(mrb, E_RUNTIME_ERROR, "template length too large");
        }
        num = num * 10 + (tptr[tmpl->idx] - '0');
        if (num > MRB_INT_MAX) {
          mrb_raise(mrb, E_RUNTIME_ERROR, "template length too large");
        }
        tmpl->idx++;
      }
      tmpl->idx--; // decrement to compensate for the outer loop increment
      repeatcount = (int)num;