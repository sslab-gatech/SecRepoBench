mrb_int num = 0;
int digit = 0;
while (tmpl->idx < tlen && ISDIGIT(ch)) {
  digit = ch - '0';
  if (num > (MRB_INT_MAX - digit) / 10) {
    mrb_raisef(mrb, E_RUNTIME_ERROR, "template length too large: %" MRB_INT_FMT "d", num);
  }
  num = num * 10 + digit;
  tmpl->idx++;
  if (tmpl->idx < tlen) {
    ch = tptr[tmpl->idx];
  } else {
    break;
  }
}
if (num > MRB_INT_MAX) {
  mrb_raisef(mrb, E_RUNTIME_ERROR, "template length too large: %" MRB_INT_FMT "d", num);
}
repeatcount = (int)num;