if (ch >= '0' && ch <= '9') {
        mrb_int num = 0;
        while (tmpl->idx < tlen && ISDIGIT(tptr[tmpl->idx])) {
          if (num > (MRB_INT_MAX - (tptr[tmpl->idx] - '0')) / 10) {
            mrb_raise(mrb, E_RUNTIME_ERROR, "template length too large");
          }
          num = num * 10 + (tptr[tmpl->idx] - '0');
          tmpl->idx++;
        }
        repeatcount = (int)num;
      } else {
        mrb_raise(mrb, E_RUNTIME_ERROR, "invalid template character");
      }