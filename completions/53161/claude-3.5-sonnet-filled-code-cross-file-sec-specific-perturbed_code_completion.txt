mrb_int value;
const char *p = tptr + tmpl->idx;
mrb_bool overflow;

value = mrb_read_int(mrb, &p, tptr + tlen, &overflow);
if (overflow) {
  mrb_raise(mrb, E_RUNTIME_ERROR, "template length too big");
}
tmpl->idx = (mrb_int)(p - tptr);
repeatcount = (int)value;