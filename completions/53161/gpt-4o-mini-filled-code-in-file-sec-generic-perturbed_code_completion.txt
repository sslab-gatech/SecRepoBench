if (tmpl->idx >= tlen) {
        mrb_raise(mrb, E_ARGUMENT_ERROR, "invalid template length");
      }
      int value = 0;
      while (tmpl->idx < tlen && ISDIGIT(tptr[tmpl->idx])) {
        value = value * 10 + (tptr[tmpl->idx] - '0');
        tmpl->idx++;
        if (value < 0) { // Check for overflow
          mrb_raise(mrb, E_ARGUMENT_ERROR, "template length too large");
        }
      }
      repeatcount = value;