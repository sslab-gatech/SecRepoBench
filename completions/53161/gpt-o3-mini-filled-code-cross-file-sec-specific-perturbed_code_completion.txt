{
  int num = 0;
  while (tmpl->idx < tlen && ISDIGIT(tptr[tmpl->idx])) {
    int digit = tptr[tmpl->idx] - '0';
    if (num > (INT_MAX - digit) / 10)
      mrb_raisef(mrb, E_RUNTIME_ERROR, "template length too large");
    num = num * 10 + digit;
    tmpl->idx++;
  }
  repeatcount = num;
  if (tmpl->idx < tlen)
    tmpl->idx--;
}