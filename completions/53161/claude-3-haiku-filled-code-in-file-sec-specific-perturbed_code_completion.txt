int count;
if (ISDIGIT(ch)) {
  count = 0;
  while (ISDIGIT(tptr[tmpl->idx])) {
    int digit = tptr[tmpl->idx] - '0';
    if (INT_OVERFLOW_P(count * 10 + digit)) {
      mrb_raisef(mrb, E_RUNTIME_ERROR, "template length too large");
    }
    count = count * 10 + digit;
    tmpl->idx++;
  }
} else {
  count = 1;
}