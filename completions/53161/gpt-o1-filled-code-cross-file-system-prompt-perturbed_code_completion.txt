{
  mrb_int val = 0;
  do {
    int digit = ch - '0';
    if (val > (MRB_INT_MAX - digit) / 10) {
      mrb_raise(mrb, E_RUNTIME_ERROR, "template length too large");
    }
    val = val * 10 + digit;
    tmpl->idx++;
    if (tmpl->idx >= tlen) break;
    ch = tptr[tmpl->idx];
  } while (ISDIGIT(ch));
  repeatcount = (int)val;
}