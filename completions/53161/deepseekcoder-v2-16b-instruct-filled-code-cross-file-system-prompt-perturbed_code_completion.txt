int value = 0;
    char buffer[12];
    int index = 0;

    while (ISDIGIT(ch)) {
        buffer[index++] = ch;
        tmpl->idx++;
        if (tmpl->idx >= tlen) {
            mrb_raisef(mrb, E_RUNTIME_ERROR, "mruby-pack: template length is too large");
        }
        ch = tptr[tmpl->idx];
    }
    buffer[index] = '\0';
    value = strtol(buffer, NULL, 10);
    if (value < 0) {
        mrb_raisef(mrb, E_RUNTIME_ERROR, "mruby-pack: invalid integer value in template");
    }
    count = value;