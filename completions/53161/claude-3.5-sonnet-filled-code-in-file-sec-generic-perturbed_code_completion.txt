mrb_int value;
const char *p = tptr + tmpl->idx;
mrb_bool overflow = FALSE;

value = mrb_int_read(&p, tptr + tlen, &overflow);
if (overflow) {
  mrb_raise(mrb, E_RUNTIME_ERROR, "template length too big");
}
repeatcount = (int)value;
tmpl->idx = (mrb_int)(p - tptr);