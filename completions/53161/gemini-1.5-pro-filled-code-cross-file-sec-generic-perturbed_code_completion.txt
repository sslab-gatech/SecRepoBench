int i = 0;
      char num[10]; // Assuming a maximum of 9 digits + null terminator

      while (ISDIGIT(ch)) {
        if (i >= sizeof(num) - 1) {
          mrb_raisef(mrb, E_RUNTIME_ERROR, "repeat count too large");
        }
        num[i++] = ch;
        ch = tptr[++tmpl->idx];
        if (tmpl->idx >= tlen) {
          break;
        }
      }
      num[i] = '\0';
      if (i > 0) {
        repeatcount = atoi(num);
        tmpl->idx--; // Rewind to the last digit
      }