if (ISDIGIT(ch)) {
    int value = 0;
    int mult = 1;
    while (tmpl->idx < tlen && ISDIGIT(tptr[tmpl->idx])) {
      value += (tptr[tmpl->idx] - '0') * mult;
      mult *= 10;
      tmpl->idx++;
    }
    if (value > INT_MAX) {
      mrb_raisef(mrb, E_RUNTIME_ERROR, "Template length too large: %d", value);
    }
    if (repeatcount == 0) {
      repeatcount = value;
    } else if (repeatcount > 0) {
      repeatcount *= value;
    }
  }