int num = 0;
      while (tmpl->idx < tlen) {
          ch = tptr[tmpl->idx];
          if (!ISDIGIT(ch)) {
              break;
          }
          int digit = ch - '0';
          if (num > (INT_MAX - digit) / 10) {
              mrb_raisef(mrb, E_RUNTIME_ERROR, "template length too large");
          }
          num = num * 10 + digit;
          tmpl->idx++;
      }
      repeatcount = num;
      tmpl->idx--;