repeatcount = 0;
while (ISDIGIT(tptr[tmpl->idx])) {
  repeatcount = repeatcount * 10 + (tptr[tmpl->idx] - '0');
  tmpl->idx++;
  if (tmpl->idx >= tlen) {
    mrb_raisef(mrb, E_RUNTIME_ERROR, "template length is too large");
  }
}