int value = 0;
      int base = 10;
      if (ch == '0') {
        tmpl->idx++;
        if (tmpl->idx < tlen && (tptr[tmpl->idx] == 'x' || tptr[tmpl->idx] == 'X')) {
          base = 16;
          tmpl->idx++;
        } else {
          base = 8;
        }
      }
      while (tmpl->idx < tlen && ISDIGIT(tptr[tmpl->idx])) {
        value = value * base + (tptr[tmpl->idx] - '0');
        tmpl->idx++;
        if (value < 0) { // Check for overflow
          mrb_raisef(mrb, E_RUNTIME_ERROR, "template length too large");
        }
      }
      repeatcount = value;