if (ret == NULL) {
        xsltTransformError(tctxt, NULL, tctxt->inst,
            "exsltCryptoRc4DecryptFunction: Failed to allocate memory\n");
        tctxt->state = XSLT_STATE_STOPPED;
        xmlXPathReturnEmptyString (parsercontext);
        goto done;
    }

    exsltCryptoRc4Process(&padkey[0], key_len, bin, ret_len, ret);
    ret[ret_len] = 0;

    xmlXPathReturnString(parsercontext, ret);

done: