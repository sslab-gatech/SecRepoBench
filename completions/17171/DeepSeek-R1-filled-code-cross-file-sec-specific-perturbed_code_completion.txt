if (ret == NULL) {
	xsltTransformError(tctxt, NULL, tctxt->inst,
	    "exsltCryptoRc4DecryptFunction: Failed to allocate result\n");
	tctxt->state = XSLT_STATE_STOPPED;
	xmlXPathReturnEmptyString(parsercontext);
	goto done;
    }

    exsltCryptoRc4(padkey, RC4_KEY_LENGTH, bin, ret_len, ret, ret_len);
    ret[ret_len] = 0;

    if (xmlCheckUTF8(ret) != 1) {
	xsltTransformError(tctxt, NULL, tctxt->inst,
	    "exsltCryptoRc4DecryptFunction: Invalid UTF-8 in decrypted data\n");
	tctxt->state = XSLT_STATE_STOPPED;
	xmlFree(ret);
	xmlXPathReturnEmptyString(parsercontext);
	goto done;
    }

    xmlXPathReturnString(parsercontext, ret);