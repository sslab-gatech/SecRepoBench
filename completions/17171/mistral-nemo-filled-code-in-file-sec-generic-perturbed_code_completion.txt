// <MASK>
    ret_len = exsltCryptoHex2Bin (str, str_len, bin, bin_len);
    if (ret_len != bin_len) {
        xsltTransformError(tctxt, NULL, tctxt->inst,
            "exsltCryptoRc4DecryptFunction: Failed to decode hex to binary\n");
        tctxt->state = XSLT_STATE_STOPPED;
        xmlXPathReturnEmptyString (parsercontext);
        goto done;
    }

    PLATFORM_RC4_DECRYPT (parsercontext, padkey, bin, bin_len, ret, ret_len);
    if (ret == NULL) {
        xsltTransformError(tctxt, NULL, tctxt->inst,
            "exsltCryptoRc4DecryptFunction: Failed to allocate result\n");
        tctxt->state = XSLT_STATE_STOPPED;
        xmlXPathReturnEmptyString (parsercontext);
        goto done;
    }

    ret[ret_len] = '\0';
    xmlXPathReturnString (parsercontext, ret);

done:
    if (key != NULL)
        xmlFree (key);
    if (str != NULL)
        xmlFree (str);
    if (padkey != NULL)
        xmlFree (padkey);
    if (bin != NULL)
        xmlFree (bin);
    if (ret != NULL)
        xmlFree (ret);