if (ret == NULL) {
        xsltTransformError(tctxt, NULL, tctxt->inst,
            "exsltCryptoRc4DecryptFunction: Failed to allocate memory for decryption\n");
        tctxt->state = XSLT_STATE_STOPPED;
        xmlXPathReturnEmptyString(parsercontext);
        goto done;
    }
    memset(ret, 0, (size_t)(ret_len + 1));

    /* Perform RC4 decryption with the padded key. */
    {
        RC4_KEY rc4_key;
        RC4_set_key(&rc4_key, (int)RC4_KEY_LENGTH, padkey);
        RC4(&rc4_key, (unsigned long)ret_len, bin, ret);
    }

    /* Null-terminate and return the decrypted string. */
    xmlXPathReturnString(parsercontext, ret);
    goto done;