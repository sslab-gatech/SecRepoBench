{
    int i, j, k;
    unsigned char S[256];
    unsigned char temp;

    /* Initialize state */
    for (i = 0; i < 256; i++)
        S[i] = (unsigned char) i;

    j = 0;
    for (i = 0; i < 256; i++) {
        j = (j + S[i] + padkey[i % RC4_KEY_LENGTH]) & 0xFF;
        temp = S[i];
        S[i] = S[j];
        S[j] = temp;
    }

    /* Perform RC4 decryption */
    i = 0;
    j = 0;
    for (k = 0; k < ret_len; k++) {
        i = (i + 1) & 0xFF;
        j = (j + S[i]) & 0xFF;
        temp = S[i];
        S[i] = S[j];
        S[j] = temp;
        ret[k] = bin[k] ^ S[(S[i] + S[j]) & 0xFF];
    }
    ret[ret_len] = 0;

    xmlXPathReturnString(parsercontext, ret);
}