if (ret_len <= 0) {
        xmlXPathReturnEmptyString(parsercontext);
        goto done;
    }

    PLATFORM_RC4_DECRYPT(ctxt, padkey, bin, ret_len, ret, ret_len);
    ret[ret_len] = '\0'; // Null-terminate the decrypted string

    xmlXPathReturnString(parsercontext, ret);

done:
    if (key != NULL)
        xmlFree(key);
    if (str != NULL)
        xmlFree(str);
    if (padkey != NULL)
        xmlFree(padkey);
    if (bin != NULL)
        xmlFree(bin);
    if (ret != NULL)
        xmlFree(ret);