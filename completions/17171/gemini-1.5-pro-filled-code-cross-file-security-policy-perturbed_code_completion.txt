if (ret == NULL) {
	xsltTransformError(tctxt, NULL, tctxt->inst,
	    "exsltCryptoRc4DecryptFunction: Failed to allocate result\n");
	tctxt->state = XSLT_STATE_STOPPED;
	xmlXPathReturnEmptyString (parsercontext);
	goto done;
    }
    memset(ret, 0, ret_len + 1);

    if (exsltCryptoRc4Process(&ret, padkey, bin, ret_len) == 0) {
        if (!xmlCheckUTF8(ret)) {
            xsltTransformError(tctxt, NULL, tctxt->inst,
                "exsltCryptoRc4DecryptFunction: Invalid UTF-8 after decryption\n");
            tctxt->state = XSLT_STATE_STOPPED;
            xmlFree(ret);
            xmlXPathReturnEmptyString(parsercontext);
            goto done;
        }
        xmlXPathReturnString(parsercontext, ret);

    } else {
        xmlXPathReturnEmptyString (parsercontext);
    }

done:
    if (key != NULL)
	xmlFree (key);