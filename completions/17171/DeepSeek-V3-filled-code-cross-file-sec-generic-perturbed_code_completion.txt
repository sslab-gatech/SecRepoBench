if (ret == NULL) {
        xsltTransformError(tctxt, NULL, tctxt->inst,
            "exsltCryptoRc4DecryptFunction: Failed to allocate result\n");
        tctxt->state = XSLT_STATE_STOPPED;
        xmlXPathReturnEmptyString(parsercontext);
        goto done;
    }

    exsltCryptoRc4(padkey, RC4_KEY_LENGTH, bin, ret_len, ret);
    ret[ret_len] = 0; /* null-terminate */

    xmlXPathReturnString(parsercontext, ret);

done:
    if (key != NULL)
        xmlFree(key);