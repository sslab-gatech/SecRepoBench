if (ret == NULL) {
	xsltTransformError(tctxt, NULL, tctxt->inst,
	    "exsltCryptoRc4DecryptFunction: Failed to allocate ret\n");
	tctxt->state = XSLT_STATE_STOPPED;
	xmlXPathReturnEmptyString(parsercontext);
	goto done;
    }

    RC4_KEY rc4_key;
    RC4_set_key(&rc4_key, RC4_KEY_LENGTH, (unsigned char *)padkey);
    RC4(&rc4_key, ret_len, (unsigned char *)bin, (unsigned char *)ret);
    ret[ret_len] = '\0';

    xmlXPathReturnString(parsercontext, ret);

done:
    if (ret != NULL)
	xmlFree(ret);