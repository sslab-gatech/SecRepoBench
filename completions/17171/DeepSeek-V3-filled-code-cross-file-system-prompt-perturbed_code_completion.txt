if (ret == NULL) {
	xsltTransformError(tctxt, NULL, tctxt->inst,
	    "exsltCryptoRc4DecryptFunction: Failed to allocate result\n");
	tctxt->state = XSLT_STATE_STOPPED;
	xmlXPathReturnEmptyString (parsercontext);
	goto done;
    }

    exsltCryptoRc4Crypt (bin, ret_len, padkey, RC4_KEY_LENGTH, ret);
    ret[ret_len] = 0; /* null-terminate */

    if (xmlUTF8Strlen(ret) < 0) {
	xsltTransformError(tctxt, NULL, tctxt->inst,
	    "exsltCryptoRc4DecryptFunction: invalid UTF-8 in result\n");
	tctxt->state = XSLT_STATE_STOPPED;
	xmlXPathReturnEmptyString (parsercontext);
	goto done;
    }

    xmlXPathReturnString (parsercontext, ret);

done:
    if (key != NULL)
	xmlFree (key);