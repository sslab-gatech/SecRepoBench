if (ret == NULL) {
    xsltTransformError(tctxt, NULL, tctxt->inst,
        "exsltCryptoRc4DecryptFunction: Failed to allocate result\n");
    tctxt->state = XSLT_STATE_STOPPED;
    xmlXPathReturnEmptyString (parsercontext);
    goto done;
}

/* perform rc4 decryption */
exsltCryptoRC4(bin, ret_len, padkey, ret);
ret[ret_len] = 0;  /* null terminator */

xmlXPathReturnString (parsercontext, ret);

done:
    if (key != NULL)
        xmlFree (key);