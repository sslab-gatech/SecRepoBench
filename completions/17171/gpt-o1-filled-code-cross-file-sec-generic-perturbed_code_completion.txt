#ifdef HAVE_OPENSSL
    if (ret == NULL) {
        xsltTransformError(tctxt, NULL, tctxt->inst,
            "exsltCryptoRc4DecryptFunction: Failed to allocate output buffer\n");
        tctxt->state = XSLT_STATE_STOPPED;
        xmlXPathReturnEmptyString(parsercontext);
        goto done;
    }

    /* Perform RC4 decryption with the padded key. */
    {
        RC4_KEY rc4_key;
        RC4_set_key(&rc4_key, RC4_KEY_LENGTH, (unsigned char *)padkey);
        RC4(&rc4_key, ret_len, (unsigned char *)bin, (unsigned char *)ret);
    }

    /* Null-terminate and return the result. */
    ret[ret_len] = 0;
    xmlXPathReturnString(parsercontext, ret);
    goto done;
#else
    xsltTransformError(tctxt, NULL, tctxt->inst,
        "exsltCryptoRc4DecryptFunction: OpenSSL RC4 not available\n");
    tctxt->state = XSLT_STATE_STOPPED;
    xmlXPathReturnEmptyString(parsercontext);
    goto done;
#endif