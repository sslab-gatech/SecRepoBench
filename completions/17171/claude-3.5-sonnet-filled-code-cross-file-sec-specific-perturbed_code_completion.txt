if (ret == NULL) {
    xsltTransformError(tctxt, NULL, tctxt->inst,
        "exsltCryptoRc4DecryptFunction: Failed to allocate result\n");
    tctxt->state = XSLT_STATE_STOPPED;
    xmlXPathReturnEmptyString(parsercontext);
    goto done;
}
memset(ret, 0, ret_len + 1);

RC4_KEY rc4_key;
RC4_set_key(&rc4_key, RC4_KEY_LENGTH, padkey);
RC4(&rc4_key, ret_len, bin, ret);

ret[ret_len] = '\0';

xmlXPathReturnString(parsercontext, ret);

done:
if (key != NULL)
    xmlFree(key);