#define CheckPathExtent(add_points) \
do { \
  size_t needed_p = (size_t)(p + (add_points)); \
  size_t needed_q = (size_t)(q + (add_points)); \
  if ((needed_p >= (stroke_limit + MaxStrokePad)) || (needed_q >= (stroke_limit + MaxStrokePad))) \
    { \
      /* Compute new size to ensure we have enough space. */ \
      size_t new_size = (stroke_limit + MaxStrokePad) * 2; \
      if (needed_p + MaxStrokePad > new_size) \
        new_size = needed_p + MaxStrokePad; \
      if (needed_q + MaxStrokePad > new_size) \
        new_size = needed_q + MaxStrokePad; \
      /* Reallocate path_p */ \
      PointInfo *new_path_p = (PointInfo *) ResizeQuantumMemory(path_p, new_size, sizeof(*path_p)); \
      /* Reallocate path_q */ \
      PointInfo *new_path_q = (PointInfo *) ResizeQuantumMemory(path_q, new_size, sizeof(*path_q)); \
      if ((new_path_p == (PointInfo *) NULL) || (new_path_q == (PointInfo *) NULL)) \
        { \
          if (new_path_p != (PointInfo *) NULL) \
            (void) RelinquishMagickMemory(new_path_p); \
          path_p = (PointInfo *) RelinquishMagickMemory(path_p); \
          path_q = (PointInfo *) RelinquishMagickMemory(path_q); \
          polygon_primitive = (PrimitiveInfo *) RelinquishMagickMemory(polygon_primitive); \
          return ((PrimitiveInfo *) NULL); \
        } \
      path_p = new_path_p; \
      path_q = new_path_q; \
      stroke_limit = new_size - MaxStrokePad; \
    } \
} while (0)