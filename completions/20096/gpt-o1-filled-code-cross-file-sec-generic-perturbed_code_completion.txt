#define CheckPathExtent(increment)                                          \
  do {                                                                      \
    size_t needed_p = (size_t) (p + (increment));                           \
    size_t needed_q = (size_t) (q + (increment));                           \
    /* Check if we are about to exceed the current stroke_limit. */         \
    if ((needed_p >= stroke_limit) || (needed_q >= stroke_limit))           \
      {                                                                     \
        /* Determine the new required size. */                              \
        size_t needed = (needed_p > needed_q ? needed_p : needed_q);        \
        size_t new_limit = stroke_limit;                                    \
        /* Grow by doubling until it satisfies the requirement. */          \
        while (new_limit < needed)                                          \
          {                                                                 \
            if (new_limit > (SIZE_MAX >> 1))                                \
              {                                                             \
                /* Overflow concern; clean up and return. */               \
                path_p=(PointInfo *) RelinquishMagickMemory(path_p);        \
                path_q=(PointInfo *) RelinquishMagickMemory(path_q);        \
                polygon_primitive=(PrimitiveInfo *)                         \
                  RelinquishMagickMemory(polygon_primitive);               \
                return((PrimitiveInfo *) NULL);                             \
              }                                                             \
            new_limit <<= 1;                                               \
          }                                                                 \
        /* Add padding to reduce frequent resizing. */                      \
        if (new_limit > SIZE_MAX - MaxStrokePad)                            \
          {                                                                 \
            /* Overflow check. */                                          \
            path_p=(PointInfo *) RelinquishMagickMemory(path_p);           \
            path_q=(PointInfo *) RelinquishMagickMemory(path_q);           \
            polygon_primitive=(PrimitiveInfo *)                             \
              RelinquishMagickMemory(polygon_primitive);                   \
            return((PrimitiveInfo *) NULL);                                 \
          }                                                                 \
        new_limit += MaxStrokePad;                                          \
        /* Attempt to reallocate path_p and path_q. */                      \
        {                                                                   \
          PointInfo *new_path_p = (PointInfo *) ResizeQuantumMemory(path_p, \
            new_limit,sizeof(*new_path_p));                                 \
          PointInfo *new_path_q = (PointInfo *) ResizeQuantumMemory(path_q, \
            new_limit,sizeof(*new_path_q));                                 \
          if ((new_path_p == (PointInfo *) NULL) ||                         \
              (new_path_q == (PointInfo *) NULL))                           \
            {                                                               \
              if (new_path_p != (PointInfo *) NULL)                         \
                new_path_p=(PointInfo *) RelinquishMagickMemory(new_path_p);\
              if (new_path_q != (PointInfo *) NULL)                         \
                new_path_q=(PointInfo *) RelinquishMagickMemory(new_path_q);\
              path_p=(PointInfo *) RelinquishMagickMemory(path_p);          \
              path_q=(PointInfo *) RelinquishMagickMemory(path_q);          \
              polygon_primitive=(PrimitiveInfo *)                           \
                RelinquishMagickMemory(polygon_primitive);                 \
              return((PrimitiveInfo *) NULL);                               \
            }                                                               \
          path_p=new_path_p;                                               \
          path_q=new_path_q;                                               \
          stroke_limit=new_limit;                                          \
        }                                                                   \
      }                                                                     \
  } while (0)