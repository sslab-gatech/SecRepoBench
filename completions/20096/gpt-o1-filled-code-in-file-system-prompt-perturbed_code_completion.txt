/*
  Ensure that we can store at least "needed" more points in our working arrays
  (path_p and path_q). If not, grow each array. If reallocation fails, clean up
  and return NULL.
*/
#define CheckPathExtent(needed)                                                \
  do {                                                                         \
    size_t required = (size_t)((p) + (needed));                                \
    if (required >= stroke_limit)                                              \
      {                                                                        \
        size_t new_limit = stroke_limit;                                       \
        while (required >= new_limit)                                          \
          {                                                                    \
            /* Grow by 1.5x plus some padding for larger expansions. */       \
            new_limit += (new_limit >> 1) + 256;                               \
          }                                                                    \
        path_p = (PointInfo *) ResizeQuantumMemory(path_p,                    \
          new_limit, sizeof(*path_p));                                         \
        path_q = (PointInfo *) ResizeQuantumMemory(path_q,                    \
          new_limit, sizeof(*path_q));                                         \
        if ((path_p == (PointInfo *) NULL) || (path_q == (PointInfo *) NULL))  \
          {                                                                    \
            if (path_p)                                                       \
              (void) RelinquishMagickMemory(path_p);                           \
            if (path_q)                                                       \
              (void) RelinquishMagickMemory(path_q);                           \
            if (polygon_primitive)                                            \
              (void) RelinquishMagickMemory(polygon_primitive);               \
            return ((PrimitiveInfo *) NULL);                                   \
          }                                                                    \
        stroke_limit = new_limit;                                             \
      }                                                                        \
  } while (0)