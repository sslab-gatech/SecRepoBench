#define CheckPathExtent(pad) \
  do { \
    size_t required_p = (size_t)(p + (pad)); \
    size_t required_q = (size_t)(q + (pad)); \
    size_t required = (required_p > required_q) ? required_p : required_q; \
    if (required > (stroke_limit + MaxStrokePad)) { \
      size_t new_stroke_limit = required; \
      size_t new_alloc_size = new_stroke_limit + MaxStrokePad; \
      PointInfo *new_path_p = (PointInfo *) ResizeQuantumMemory(path_p, new_alloc_size, sizeof(*path_p)); \
      PointInfo *new_path_q = (PointInfo *) ResizeQuantumMemory(path_q, new_alloc_size, sizeof(*path_q)); \
      if (new_path_p == NULL || new_path_q == NULL) { \
        if (new_path_p != NULL) { \
          RelinquishMagickMemory(new_path_p); \
        } else { \
          RelinquishMagickMemory(path_p); \
        } \
        if (new_path_q != NULL) { \
          RelinquishMagickMemory(new_path_q); \
        } else { \
          RelinquishMagickMemory(path_q); \
        } \
        polygon_primitive = (PrimitiveInfo *) RelinquishMagickMemory(polygon_primitive); \
        return ((PrimitiveInfo *) NULL); \
      } \
      path_p = new_path_p; \
      path_q = new_path_q; \
      stroke_limit = new_stroke_limit; \
    } \
  } while(0)