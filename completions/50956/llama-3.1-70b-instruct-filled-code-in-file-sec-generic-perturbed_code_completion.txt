_cmsStageMatrixData* m1 = (_cmsStageMatrixData*) cmsStageData(Matrix1);
_cmsStageMatrixData* m2 = (_cmsStageMatrixData*) cmsStageData(Matrix2);

// Retrieve data from two matrix stages in the pipeline.
// Ensure that the input offset of the first matrix is zero.
// Multiply the matrices to combine them into a single result matrix.
// Determine if the resulting matrix is an identity matrix and whether the offset is null.
// Set the appropriate flags to indicate if the matrix can be optimized away due to being an identity matrix.

if (m1->Offset!= NULL) return FALSE;  // Input offset should be zero to use this optimization

_cmsMAT3per(&res, (cmsMAT3*)m2->Double, (cmsMAT3*)m1->Double);

cmsVEC3* Offset = NULL;
if (m2->Offset!= NULL) {
    Offset = (_cmsVEC3*) _cmsMallocZero(ContextID, sizeof(cmsVEC3));
    if (Offset == NULL) return FALSE;
    _cmsVEC3add(Offset, (cmsVEC3*)m1->Offset, (cmsVEC3*)m2->Offset);
}

isIdentityMatrix = isFloatMatrixIdentity(&res) && (Offset == NULL || _cmsVEC3isZero(Offset));