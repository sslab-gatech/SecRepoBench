if (cmsPipelineCheckAndRetreiveStages(Src, 4,
    cmsSigCurveSetElemType, cmsSigMatrixElemType, cmsSigMatrixElemType, cmsSigCurveSetElemType,
    &Curve1, &Matrix1, &Matrix2, &Curve2)) {

    _cmsStageMatrixData* Data1 = (_cmsStageMatrixData*)cmsStageData(Matrix1);
    _cmsStageMatrixData* Data2 = (_cmsStageMatrixData*)cmsStageData(Matrix2);

    // Ensure that the input offset of the first matrix is zero
    if (Data1->Offset != NULL) {
        return FALSE;
    }

    // Multiply the matrices to combine them into a single result matrix
    _cmsMAT3per(&res, &Data2->Double, &Data1->Double);

    // Preserve the offset from the second matrix
    Offset = Data2->Offset;

    if (_cmsMAT3isIdentity(&res) && Offset == NULL) {
        // We can get rid of full matrix
        isIdentityMatrix = TRUE;
    }
}