#include <string.h>
#include <stdlib.h>

void gf_url_to_fs_path(char *urlString)
{
    const char *filePrefix = "file://";
    const char *filePrefixWithDrive = "file:///";
    size_t prefixLength = strlen(filePrefix);
    size_t prefixWithDriveLength = strlen(filePrefixWithDrive);
    size_t urlLength = strlen(urlString);

    // Check if the URL starts with "file://"
    if (urlLength >= prefixLength && strncmp(urlString, filePrefix, prefixLength) == 0) {
        // Check if it is "file:///" followed by a drive letter (e.g., "file:///C:/")
        if (urlLength > prefixWithDriveLength && urlString[prefixWithDriveLength] != '/') {
            // Move the string to remove "file:///"
            memmove(urlString, urlString + prefixWithDriveLength, urlLength - prefixWithDriveLength + 1);
        } else {
            // Move the string to remove "file://"
            memmove(urlString, urlString + prefixLength, urlLength - prefixLength + 1);
        }
    }

    // Replace "%20" with spaces
    char *percentEncoded = strstr(urlString, "%20");
    while (percentEncoded) {
        *percentEncoded = ' ';
        memmove(percentEncoded + 1, percentEncoded + 3, strlen(percentEncoded + 3) + 1);
        percentEncoded = strstr(percentEncoded + 1, "%20");
    }
}