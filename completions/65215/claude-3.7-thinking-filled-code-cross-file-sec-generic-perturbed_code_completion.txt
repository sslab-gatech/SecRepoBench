if (!urlString) return;  // Basic null check

// Check for file:// prefix
if (!strncmp(urlString, "file://", 7)) {
    size_t offset = 7;  // Default number of characters to remove: "file://"
    
    // Handle case with third slash: file:///path or file:///C:/path
    if (urlString[7] == '/') {
        // Check if it's a Windows path with drive letter
        if (urlString[8] && 
            ((urlString[8] >= 'A' && urlString[8] <= 'Z') || 
             (urlString[8] >= 'a' && urlString[8] <= 'z')) && 
            urlString[9] == ':') {
            offset = 8;  // Remove "file:///" but keep the drive letter
        } else {
            offset = 8;  // Remove "file:///" for non-Windows paths
        }
    }
    
    // Shift string to remove prefix
    memmove(urlString, urlString + offset, strlen(urlString + offset) + 1);  // +1 for the null terminator
}

// Replace %20 with spaces
char *src = urlString;
char *dst = urlString;
while (*src) {
    if (src[0] == '%' && src[1] == '2' && src[2] == '0') {
        *dst++ = ' ';
        src += 3;
    } else {
        *dst++ = *src++;
    }
}
*dst = '\0';  // Null-terminate the string