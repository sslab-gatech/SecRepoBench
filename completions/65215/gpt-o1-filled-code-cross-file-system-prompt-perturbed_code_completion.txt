{
	const char *file_prefix = "file://";
	size_t prefix_len = strlen(file_prefix);

	/* Check if the URL has a file:// prefix. */
	if (!strncmp(urlString, file_prefix, prefix_len)) {
		/* Handle the case of file:///. On some systems with drive letters (e.g. Windows),
		   a path might look like file:///C:/... */
		if (!strncmp(urlString, "file:///", 8) && isalpha((unsigned char)urlString[8]) && urlString[9] == ':') {
			/* Remove the first 8 chars ("file:///") so that "C:/..." remains. */
			memmove(urlString, urlString + 8, strlen(urlString + 8) + 1);
		} else {
			/* Otherwise, remove the first 7 chars ("file://") to get the path. */
			memmove(urlString, urlString + 7, strlen(urlString + 7) + 1);
		}
	}

	/* Replace occurrences of "%20" with a space. */
	{
		char *ptr = urlString;
		while ((ptr = strstr(ptr, "%20")) != NULL) {
			*ptr = ' ';
			memmove(ptr + 1, ptr + 3, strlen(ptr + 3) + 1);
			ptr++;
		}
	}
}