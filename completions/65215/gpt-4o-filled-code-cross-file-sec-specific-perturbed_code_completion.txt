#include <string.h>
#include <stdlib.h>

void gf_url_to_fs_path(char *urlString)
{
    if (!urlString) return;

    // Check if the URL starts with "file://"
    const char *prefix = "file://";
    size_t prefix_len = strlen(prefix);
    if (strncmp(urlString, prefix, prefix_len) == 0) {
        // Move the string pointer past the "file://" prefix
        urlString += prefix_len;

        // If the next character is a '/', it might be a "file:///" URL with a drive letter
        if (*urlString == '/') {
            urlString++;
            // Check if the next character is a drive letter followed by ':'
            if (urlString[1] == ':') {
                urlString--; // Move back to include the '/'
            }
        }
    }

    // Replace "%20" with spaces
    char *src = urlString;
    char *dst = urlString;
    while (*src) {
        if (src[0] == '%' && src[1] == '2' && src[2] == '0') {
            *dst++ = ' ';
            src += 3;
        } else {
            *dst++ = *src++;
        }
    }
    *dst = '\0';
}