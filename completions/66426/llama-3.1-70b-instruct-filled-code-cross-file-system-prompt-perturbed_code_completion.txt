bitint x = 0;
for (i = 0; i < m; i++) {
  x |= (bitint)(MASK1 * (needle[i] & MASK2)) >> 56;
}
bitint y = 0;
for (i = 0; i < n; i++) {
  y = (y << 8) | (bitint)ys[i];
  if ((y & MASK3) == x) {
    // Check if the match is correct
    const char *s0 = ys + i - m + 1;
    if (memcmp(s0, needle, m) == 0) return (mrb_int)(s0 - ys);
  }
}