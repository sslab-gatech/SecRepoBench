if (m <= 0 || n < m) {
    return -1;
  }

  const char *s = ys;
  const char *end = ys + n - m + 1;
  bitint v, mask;

  // Initialize the mask for the first byte of the needle
  mask = MASK4;
  v = *(bitint *)(needle);

  while (s <= end) {
    // Load a chunk of memory from the haystack and compare it with the needle
    bitint t = *(bitint *)s;
    bitint diff = v ^ t;

    if (((diff - MASK1) & ~diff & MASK2) != 0) {
      // If there is a match in the SWAR comparison, verify byte by byte
      if (memcmp(s, needle, m) == 0) {
        return (mrb_int)(s - ys);
      }
    }
    s++;
  }