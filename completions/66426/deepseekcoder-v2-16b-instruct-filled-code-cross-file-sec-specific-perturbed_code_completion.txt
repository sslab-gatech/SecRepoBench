// <MASK>
  bitint needle_mask = 0;
  for (long j = 0; j < m; ++j) {
    needle_mask |= (bitint)(needle[j]) << (8 * (m - j - 1));
  }

  bitint ys_mask = 0;
  for (long j = 0; j < m; ++j) {
    ys_mask |= (bitint)(ys[j]) << (8 * (m - j - 1));
  }

  bitint mask = MASK3 | (MASK2 << 8) | (MASK1 << 16);
  bitint needle_mask_shifted = needle_mask << 8 * (m - 1);

  for (long i = 0; i <= n - m; ++i) {
    bitint ys_word = 0;
    for (long j = 0; j < m; ++j) {
      ys_word |= (bitint)(ys[i + j]) << (8 * (m - j - 1));
    }

    if ((ys_word & mask) == needle_mask_shifted) {
      return (mrb_int)(i);
    }
  }

  return -1;