const char *s0 = ys;
  const char *s = ys;
  const char *t = needle;
  bitint v, eq, x, y;
  long i = 0;

  if (m < 1 || n < 1) return -1;

  if (m == 1) {
    for (; i < n; i++) {
      if (ys[i] == needle[0]) return i;
    }
    return -1;
  }

  if (m > n) return -1;

  v = 0;
  for (i = 0; i < m; i++) {
    v = (v << 8) | (bitint)(unsigned char)t[i];
  }

  eq = 0;
  for (i = 0; i < m; i++) {
    eq = (eq << 8) | (bitint)0xff;
  }

  for (i = 0; i <= n - m; i++) {
    x = *(bitint *)(s + i);
    y = x ^ v;
    y = (y - MASK1) & ~y & MASK2;
    if (y == eq) return i;
  }

  return -1;