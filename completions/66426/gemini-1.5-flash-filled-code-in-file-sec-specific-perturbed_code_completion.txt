bitint *s0 = (bitint*)needle;
  bitint *s1 = (bitint*)(needle + m - 1);
  bitint *t0;
  bitint mask;
  long i;

  if (m > n) return -1;
  if (m == 0) return 0;
  if (m == 1) {
    const char *p = (const char*)memchr(ys, *needle, n);
    if (p) return (mrb_int)(p - ys);
    return -1;
  }

  for (i = 0; i + m <= n; i++) {
    t0 = (bitint*)(ys + i);
    mask = *s0 ^ *t0;
    if (!(mask & MASK3)) {
      if (memcmp(ys + i + 1, needle + 1, m - 1) == 0) return i;
    }
  }
  return -1;
}