if (m <= 0 || n <= 0 || m > n) {
    return -1; // Invalid parameters
  }

  const bitint *needle_bits = (const bitint *)needle;
  const bitint *text_bits = (const bitint *)ys;
  long i = 0;

  for (; i <= n - m; i++) {
    bitint needle_masked = (needle_bits[0] & MASK2) | (MASK1 & (needle_bits[0] ^ MASK3));
    bitint text_masked = (text_bits[i] & MASK2) | (MASK1 & (text_bits[i] ^ MASK3));

    if ((text_masked ^ needle_masked) == 0) {
      return (mrb_int)i; // Match found
    }
  }