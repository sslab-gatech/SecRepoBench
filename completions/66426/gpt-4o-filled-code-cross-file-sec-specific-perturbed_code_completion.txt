if (m <= 0 || n <= 0 || m > n) return -1;

  const char *s0 = ys;
  bitint vn1 = (bitint)(unsigned char)needle[0] * MASK1;
  bitint vn2 = (bitint)(unsigned char)needle[m-1] * MASK1;
  long i;

  for (i = 0; i <= n - m; i++) {
    bitint sv1 = *(const bitint *)(ys + i) ^ vn1;
    bitint sv2 = *(const bitint *)(ys + i + m - 1) ^ vn2;
    if (((sv1 - MASK1) & ~sv1 & MASK2) && ((sv2 - MASK1) & ~sv2 & MASK2)) {
      if (memcmp(ys + i + 1, needle + 1, m - 2) == 0) {
        return i;
      }
    }
  }