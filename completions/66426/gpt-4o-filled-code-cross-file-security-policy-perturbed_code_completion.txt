const char *s0 = ys;
  long i, j;
  bitint v, eq, x, y, z;

  if (m > n) return -1;
  if (m <= 0) return -1;

  for (i = 0; i <= n - m; i += sizeof(bitint)) {
    v = *(const bitint*)(ys + i);
    eq = v ^ MASK1 * (unsigned char)needle[0];
    eq = (eq - MASK1) & ~eq & MASK2;
    if (eq) {
      for (j = 0; j < sizeof(bitint); j++) {
        if (eq & (MASK4 >> (j * 8))) {
          if (memcmp(ys + i + j, needle, m) == 0) {
            return i + j;
          }
        }
      }
    }
  }