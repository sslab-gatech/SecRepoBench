const char *s0 = ys;
  const char *e0 = ys + n;
  const char *p = needle;
  const char *pe = needle + m;
  bitint mask1 = 0, mask2 = 0, mask3 = 0, mask4 = 0;
  bitint *p1, *p2;

  for (int i = 0; i < m; i++) {
    mask1 |= (bitint)(1ULL << (p[i] & 0x3F));
  }

  while (s0 <= e0 - m) {
    p1 = (bitint *)s0;
    mask2 = *p1 & mask1;
    if (mask2 == mask1) {
      return (mrb_int)(s0 - ys);
    }
    s0++;
  }

  return -1;