const char *s0 = ys;
  bitint v, eq, x;
  long i = 0;

  if (m < 1 || n < 1) return -1;

  if (m < sizeof(bitint)) {
    /* short needle */
    for (i = 0; i <= n - m; i++) {
      if (ys[i] == needle[0] && memcmp(ys + i, needle, m) == 0) {
        return i;
      }
    }
    return -1;
  }

  /* long needle */
  v = 0;
  for (i = 0; i < m; i++) {
    v = (v << 8) | (unsigned char)needle[i];
  }

  for (i = 0; i <= n - m; i++) {
    x = *(bitint *)(ys + i);
    eq = x ^ v;
    if ((eq & MASK2) == 0) {
      if (memcmp(ys + i, needle, m) == 0) {
        return i;
      }
    }
  }
  return -1;