const char *s0 = ys;
  const char *e0 = ys + n;
  const char *needle_end = needle + m;
  const char *p = s0;
  const char *end = e0 - (m - 1);
  bitint mask1 = 0, mask2 = 0, mask3 = 0;

  while (p < end) {
    mask1 = 0;
    for (size_t i = 0; i < m; i++) {
      mask1 |= (bitint)(*(p + i) == needle[i]) << i;
    }
    if (mask1 == ((bitint)1 << m) - 1) {
      return (mrb_int)(p - ys);
    }
    p++;
  }

  return -1;