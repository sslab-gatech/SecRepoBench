bitint needle_mask = 0;
  bitint text_mask = 0;
  bitint match_mask = 0;
  long i;

  // Create a mask for the needle
  for (i = 0; i < m; i++) {
    needle_mask |= ((bitint)(needle[i] == 0 ? 0 : 1) << (i % (sizeof(bitint) * 8)));
  }

  // Initialize the text mask
  for (i = 0; i < n; i++) {
    text_mask |= ((bitint)(ys[i] == 0 ? 0 : 1) << (i % (sizeof(bitint) * 8)));
  }

  // Perform the search using the masks
  for (i = 0; i <= n - m; i++) {
    match_mask = (text_mask >> i) & needle_mask;
    if (match_mask == needle_mask) {
      return (mrb_int)i; // Match found
    }
  }