if (i+m < n) {
    const char *p = s0;
    const char *e = ys + n;
    for (;p<e;) {
        size_t len = e-p;
        p = (const char*)memchr(p, *needle, len);
        if (p == NULL || len < m) break;
        if (memcmp(p+1, needle+1, m-1) == 0) return (mrb_int)(p - ys);
        p++;
    }
}