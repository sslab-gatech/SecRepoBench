hb_vector_t<glyf_impl::SubsetGlyph> subset_glyphs;
    if (!_populate_subset_glyphs(context->plan, font, subset_glyphs)) {
      if (font) hb_font_destroy(font);
      return_trace(false);
    }

    if (font) hb_font_destroy(font);

    unsigned int offset = 0;
    bool use_short_loca = true;
    for (auto &subset_glyph : subset_glyphs) {
      subset_glyph.dest_start = offset;
      offset += subset_glyph.get_length();
      if (offset > 0xFFFF) use_short_loca = false;
    }

    glyf subset_glyf;
    bool result = subset_glyf.serialize(context->serializer, subset_glyphs, use_short_loca, context->plan);

    _free_compiled_subset_glyphs(subset_glyphs);

    return result;