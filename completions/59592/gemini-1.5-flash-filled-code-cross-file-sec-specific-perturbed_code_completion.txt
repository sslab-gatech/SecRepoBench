hb_subset_glyph_list_t *subset_glyphs = create_subset_glyph_list (context->plan, font);
    if (unlikely (!subset_glyphs)) {
      if (font) hb_font_destroy (font);
      return_trace (false);
    }

    bool result = calculate_padded_offsets (subset_glyphs);
    if (unlikely (!result)) {
      destroy_subset_glyph_list (subset_glyphs);
      if (font) hb_font_destroy (font);
      return_trace (false);
    }

    bool use_short_loca = can_use_short_loca (subset_glyphs);
    hb_glyf_table_t *glyf = create_glyf_table (subset_glyphs, use_short_loca);
    if (unlikely (!glyf)) {
      destroy_subset_glyph_list (subset_glyphs);
      if (font) hb_font_destroy (font);
      return_trace (false);
    }

    result = serialize_subset_glyphs (glyf, subset_glyphs, use_short_loca);
    destroy_subset_glyph_list (subset_glyphs);
    destroy_glyf_table (glyf);
    if (font) hb_font_destroy (font);