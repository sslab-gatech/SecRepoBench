bool result = false;
    hb_subset_glyph_list_t subset_glyphs;
    if (!generate_subset_glyphs (context, &subset_glyphs))
      goto cleanup;

    if (context->plan->normalized_coords)
    {
      hb_font_destroy (font);
      font = nullptr;
    }

    unsigned int loca_format = calculate_loca_format (subset_glyphs);
    hb_glyf_t glyf_subset;
    if (!glyf_subset.init (subset_glyphs.get_population (), loca_format))
      goto cleanup;

    if (!serialize_subset_glyphs (context, &subset_glyphs, &glyf_subset))
      goto cleanup;

    result = true;

  cleanup:
    subset_glyphs.free_compiled_bytes ();
    if (font) hb_font_destroy (font);