if (unlikely (!font)) return_trace (false);

    hb_subset_glyf_t subset_glyf;
    if (unlikely (!subset_glyf.compile (context->plan, font)))
      return_trace (false);

    hb_font_destroy (font);

    if (unlikely (!subset_glyf.calculate_padded_offsets ()))
      return_trace (false);

    bool can_use_short_loca = subset_glyf.max_offset() < 0xFFFF;

    glyf *glyf_prime = context->serializer->start_embed<glyf> ();
    if (unlikely (!glyf_prime)) return_trace (false);

    if (unlikely (!subset_glyf.serialize (glyf_prime, can_use_short_loca)))
      return_trace (false);

    subset_glyf.free_compiled_bytes ();

    bool result = true;