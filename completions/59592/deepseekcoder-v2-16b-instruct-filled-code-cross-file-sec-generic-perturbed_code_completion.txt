bool result = false;
    hb_font_t *font = context->plan->normalized_coords ? _create_font_for_instancing (context->plan) : nullptr;
    if (unlikely (!font))
      return_trace (false);

    // Generate a subset of glyphs based on the provided plan and font.
    // Populate a list of subset glyphs, checking for failure in the process.
    // Destroy the font if it was created for instancing, after using it.
    // Calculate padded offsets for each subset glyph and determine if a short loca table can be used.
    // Initialize a new glyf object for serialization.
    // Serialize the subset of glyphs into the glyf object, using the determined loca format.
    // Handle any necessary cleanup of resources, particularly the compiled subset glyphs, if required.
    // Return the result of the serialization process as the function's output.

    hb_face_t *source = context->plan->source;
    hb_face_t *subset_face = hb_face_reference (source);
    hb_face_set_index (subset_face, 0);

    hb_subset_plan_t *subset_plan = hb_subset_plan_create ();
    subset_plan->source = subset_face;
    subset_plan->flags = context->plan->flags;
    subset_plan->normalized_coords = context->plan->normalized_coords;

    hb_subset_context_t *subset_context = hb_subset_context_create (subset_plan);
    subset_context->plan = subset_plan;

    result = subset (subset_context);

    hb_subset_context_destroy (subset_context);
    hb_subset_plan_destroy (subset_plan);
    hb_face_destroy (subset_face);

    if (context->plan->normalized_coords)
      hb_font_destroy (font);

    return_trace (result);