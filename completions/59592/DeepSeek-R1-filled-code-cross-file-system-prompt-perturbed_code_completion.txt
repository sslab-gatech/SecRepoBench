auto* subsetter = hb_subset_glyf_and_locacff_subset (context->plan, font);
    if (!subsetter) {
        if (font)
            hb_font_destroy (font);
        return_trace (false);
    }

    if (font)
        hb_font_destroy (font);

    subsetter->setup_loca_and_offsets ();
    bool use_short_loca = subsetter->use_short_loca ();

    hb_serialize_context_t* serializer = context->serializer;
    auto* out = serializer->start_serialize<glyf> ();
    if (!out) {
        subsetter->destroy ();
        return_trace (false);
    }

    subsetter->serialize_subset (serializer, use_short_loca, context->plan->source);
    subsetter->destroy ();

    bool result = serializer->end_serialize ();