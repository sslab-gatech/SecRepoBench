SubsetGlyph subset_glyph;
    if (!subset_glyph.subset (context, font))
    {
      if (font) hb_font_destroy (font);
      return_trace (false);
    }

    if (!subset_glyph.populate_list (context->plan->glyph_map))
    {
      if (font) hb_font_destroy (font);
      return_trace (false);
    }

    if (font) hb_font_destroy (font);

    subset_glyph.calculate_offsets ();
    bool short_loca = _should_write_short_loca (subset_glyph.get_max_offset ());

    glyf *glyf_prime = context->serializer->start_embed<glyf> ();
    if (!glyf_prime) return_trace (false);

    bool result = subset_glyph.serialize (context->serializer, short_loca);
    subset_glyph.free_compiled_bytes ();