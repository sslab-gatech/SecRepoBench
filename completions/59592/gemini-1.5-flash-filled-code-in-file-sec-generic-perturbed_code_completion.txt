hb_vector_t<glyf_impl::SubsetGlyph> subset_glyphs;
    bool result = _populate_subset_glyphs (context->plan, font, subset_glyphs);
    if (unlikely (!result))
    {
      if (font) hb_font_destroy (font);
      return_trace (false);
    }

    unsigned int padded_offset = 0;
    bool use_short_loca = true;
    for (const auto &glyph : subset_glyphs)
    {
      padded_offset = hb_align_to (padded_offset, 2);
      glyph.padded_offset = padded_offset;
      padded_offset += glyph.get_length ();
      if (padded_offset > 0xFFFF) use_short_loca = false;
    }

    OT::glyf new_glyf;
    result = new_glyf.serialize (context->serializer, subset_glyphs.iter (), use_short_loca, context->plan);

    _free_compiled_subset_glyphs (subset_glyphs);
    if (font) hb_font_destroy (font);