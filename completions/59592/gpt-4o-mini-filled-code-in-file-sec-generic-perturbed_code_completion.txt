hb_vector_t<glyf_impl::SubsetGlyph> subset_glyphs;
    if (!_populate_subset_glyphs(context->plan, font, subset_glyphs))
    {
      if (font)
        hb_font_destroy(font);
      return_trace(false);
    }

    // Determine if we can use short loca format based on the number of glyphs
    bool use_short_loca = (context->plan->new_to_old_gid_list.length <= 65536);
    
    // Initialize a new glyf object for serialization
    glyf new_glyf;
    hb_serialize_context_t serialize_context;
    serialize_context.init();

    // Serialize the subset glyphs into the new glyf object
    if (!new_glyf.serialize(&serialize_context, subset_glyphs.begin(), use_short_loca, context->plan))
    {
      if (font)
        hb_font_destroy(font);
      return_trace(false);
    }

    // Cleanup resources
    if (font)
      hb_font_destroy(font);

    // Finalize the serialization and return the result
    result = serialize_context.finalize();