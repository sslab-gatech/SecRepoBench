bool result = false;
    hb_set_t *glyphs = hb_set_create();
    if (!glyphs) {
      if (font) hb_font_destroy(font);
      return_trace(false);
    }

    // Populate the glyphs set based on the subset plan
    if (!populate_glyphs_set(context->plan, font, glyphs)) {
      hb_set_destroy(glyphs);
      if (font) hb_font_destroy(font);
      return_trace(false);
    }

    // Calculate padded offsets and determine loca format
    bool use_short_loca = false;
    if (!calculate_padded_offsets_and_loca_format(glyphs, &use_short_loca)) {
      hb_set_destroy(glyphs);
      if (font) hb_font_destroy(font);
      return_trace(false);
    }

    // Initialize glyf object for serialization
    glyf_object_t *glyf_object = glyf_object_create();
    if (!glyf_object) {
      hb_set_destroy(glyphs);
      if (font) hb_font_destroy(font);
      return_trace(false);
    }

    // Serialize the subset of glyphs
    result = serialize_glyphs_to_glyf_object(glyphs, glyf_object, use_short_loca);

    // Cleanup
    hb_set_destroy(glyphs);
    if (font) hb_font_destroy(font);
    glyf_object_destroy(glyf_object);

    return result;