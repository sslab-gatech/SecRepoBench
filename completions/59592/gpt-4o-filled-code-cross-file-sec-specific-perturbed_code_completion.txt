bool result = false;
    hb_subset_glyph_t *subset_glyphs = nullptr;
    unsigned int num_subset_glyphs = 0;

    // Generate subset glyphs
    if (!generate_subset_glyphs(context->plan, font, &subset_glyphs, &num_subset_glyphs)) {
      DEBUG_MSG(SUBSET, nullptr, "Failed to generate subset glyphs.");
      goto cleanup;
    }

    // Calculate padded offsets and determine loca format
    if (!calculate_padded_offsets_and_loca_format(subset_glyphs, num_subset_glyphs, &context->loca_format)) {
      DEBUG_MSG(SUBSET, nullptr, "Failed to calculate padded offsets and loca format.");
      goto cleanup;
    }

    // Initialize glyf object
    hb_glyf_object_t *glyf_object = hb_glyf_object_create();
    if (!glyf_object) {
      DEBUG_MSG(SUBSET, nullptr, "Failed to create glyf object.");
      goto cleanup;
    }

    // Serialize subset glyphs
    if (!serialize_subset_glyphs(glyf_object, subset_glyphs, num_subset_glyphs, context->loca_format)) {
      DEBUG_MSG(SUBSET, nullptr, "Failed to serialize subset glyphs.");
      hb_glyf_object_destroy(glyf_object);
      goto cleanup;
    }

    // Serialization successful
    result = true;

cleanup:
    if (font) {
      hb_font_destroy(font);
    }
    if (subset_glyphs) {
      free(subset_glyphs);
    }

    return result;