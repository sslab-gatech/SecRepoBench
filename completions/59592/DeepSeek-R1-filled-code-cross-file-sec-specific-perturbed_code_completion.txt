hb_vector_t<SubsetGlyph> subset_glyphs;
    if (!hb_subset_glyphs (context, font, subset_glyphs))
    {
      if (font) hb_font_destroy (font);
      return_trace (false);
    }

    if (font) hb_font_destroy (font);

    hb_vector_t<unsigned> offsets;
    bool short_loca = _should_write_short_loca (subset_glyphs);
    if (!_calculate_padded_offsets (subset_glyphs, short_loca, offsets))
      return_trace (false);

    auto *new_glyf = hb_ot_face_build_glyf (context->plan->dest);
    if (!new_glyf)
      return_trace (false);

    bool result = new_glyf->serialize (context->serializer, subset_glyphs, offsets, short_loca);

    for (auto &glyph : subset_glyphs)
      glyph.free_compiled_bytes ();

    return_trace (result);