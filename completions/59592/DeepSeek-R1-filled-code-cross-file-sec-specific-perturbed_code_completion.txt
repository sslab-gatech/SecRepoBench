auto subset_glyph_list = SubsetGlyphList (context, font);
    if (subset_glyph_list.in_error ())
      return_trace (false);

    if (font)
      hb_font_destroy (font);

    bool use_short_loca = false;
    if (!subset_glyph_list.padded_offsets_in_loca (&use_short_loca))
      return_trace (false);

    glyf *glyf_prime = context->serializer->start_embed<glyf> ();
    if (!glyf_prime)
      return_trace (false);

    bool result = subset_glyph_list.serialize (context->serializer,
                                               use_short_loca,
                                               context->plan->flags & HB_SUBSET_FLAGS_RETRY_IF_SUBSET_FAILED);
    subset_glyph_list.free_compiled_bytes ();

    return_trace (result && context->serializer->successful ());