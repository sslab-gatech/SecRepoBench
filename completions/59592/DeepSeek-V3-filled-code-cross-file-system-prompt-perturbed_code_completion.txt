hb_vector_t<char> subset_glyphs;
    if (!_populate_subset_glyphs (context, font, &subset_glyphs))
      return_trace (false);

    if (font)
      hb_font_destroy (font);

    hb_vector_t<unsigned int> padded_offsets;
    bool use_short_loca = _calculate_padded_offsets (subset_glyphs, &padded_offsets);

    hb_serialize_context_t serializer;
    glyf *new_glyf = serializer.start_serialize<glyf> ();
    if (!new_glyf)
      return_trace (false);

    bool result = _serialize_subset_glyphs (context, subset_glyphs, padded_offsets, use_short_loca, new_glyf);

    if (context->plan->drop_hints)
      _free_compiled_subset_glyphs (subset_glyphs);

    serializer.end_serialize ();