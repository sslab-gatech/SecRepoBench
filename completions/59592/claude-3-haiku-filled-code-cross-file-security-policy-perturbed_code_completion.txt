// Generate a subset of glyphs based on the provided plan and font.
hb_codepoint_t *glyph_ids = nullptr;
unsigned int num_glyphs = 0;
if (!_generate_subset_glyph_list (context, &glyph_ids, &num_glyphs))
  return_trace (false);

// Populate a list of subset glyphs, checking for failure in the process.
hb_vector_t<SubsetGlyph> subset_glyphs;
if (!_populate_subset_glyph_list (context, glyph_ids, num_glyphs, subset_glyphs))
{
  hb_free (glyph_ids);
  return_trace (false);
}
hb_free (glyph_ids);

// Destroy the font if it was created for instancing, after using it.
if (font)
  hb_font_destroy (font);

// Calculate padded offsets for each subset glyph and determine if a short loca table can be used.
bool use_short_loca = _calculate_glyph_offsets (subset_glyphs);

// Initialize a new glyf object for serialization.
glyf glyf_prime;

// Serialize the subset of glyphs into the glyf object, using the determined loca format.
if (!_serialize_glyphs (context, subset_glyphs, use_short_loca, &glyf_prime))
{
  _free_compiled_subset_glyphs (subset_glyphs);
  return_trace (false);
}

// Handle any necessary cleanup of resources, particularly the compiled subset glyphs, if required.
_free_compiled_subset_glyphs (subset_glyphs);

// Return the result of the serialization process as the function's output.
bool result = glyf_prime.serialize (context->serializer);
return_trace (result);