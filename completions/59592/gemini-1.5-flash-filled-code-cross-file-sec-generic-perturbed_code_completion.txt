hb_subset_glyph_info_t *subset_glyphs = nullptr;
    bool result = generate_subset_glyphs (context, font, &subset_glyphs);
    if (unlikely (!result))
      goto cleanup;

    hb_vector_t<hb_offset_t> padded_offsets;
    bool use_short_loca = calculate_padded_offsets (subset_glyphs, &padded_offsets);

    hb_glyf_table_t glyf;
    result = glyf.init (context->plan->source->get_glyph_count ());
    if (unlikely (!result))
      goto cleanup;

    result = serialize_subset_glyphs (subset_glyphs, &glyf, use_short_loca, padded_offsets);
    if (unlikely (!result))
      goto cleanup;

    cleanup:
    hb_free (subset_glyphs);
    if (font)
      hb_font_destroy (font);