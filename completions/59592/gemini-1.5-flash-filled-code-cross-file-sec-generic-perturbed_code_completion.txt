hb_subset_glyph_list_t subset_glyphs;
    bool result = generate_subset_glyphs (context, &subset_glyphs, font);
    if (unlikely (!result)) {
      if (font) hb_font_destroy (font);
      return_trace (false);
    }

    unsigned int loca_format = calculate_loca_format (subset_glyphs);
    hb_glyf_t *subset_glyf = create_subset_glyf (subset_glyphs, loca_format);
    if (unlikely (!subset_glyf)) {
      if (font) hb_font_destroy (font);
      return_trace (false);
    }

    result = serialize_subset_glyf (subset_glyf, subset_glyphs, loca_format);
    destroy_subset_glyf (subset_glyf);
    if (font) hb_font_destroy (font);
    free_compiled_bytes ();