hb_vector_t<glyf_impl::SubsetGlyph> subset_glyphs;
if (!_populate_subset_glyphs (context->plan, font, subset_glyphs))
{
  hb_font_destroy (font);
  return_trace (false);
}

hb_font_destroy (font);

_pad_glyph_origins (subset_glyphs);

bool use_short_loca = _calculate_glyf_and_loca_prime_size (subset_glyphs);

glyf_impl::accelerator_t glyf;
glyf.instance_coords = context->plan->normalized_coords;
glyf.num_coords = context->plan->num_coords;

bool result = glyf.serialize (context->serializer,
                              subset_glyphs,
                              use_short_loca,
                              context->plan->source);

_free_compiled_subset_glyphs (subset_glyphs);