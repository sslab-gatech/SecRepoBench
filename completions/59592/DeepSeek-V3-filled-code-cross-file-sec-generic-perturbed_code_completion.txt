hb_vector_t<char> subset_glyphs;
    if (!_populate_subset_glyphs (context, font, &subset_glyphs))
      return_trace (false);

    if (font)
      hb_font_destroy (font);

    hb_vector_t<unsigned int> padded_offsets;
    bool use_short_loca = _calculate_padded_offsets (subset_glyphs, &padded_offsets);

    hb_serialize_context_t serializer;
    glyf *glyf_prime = serializer.start_serialize<glyf> ();
    if (!glyf_prime)
      return_trace (false);

    bool result = _serialize_subset_glyphs (context, subset_glyphs, padded_offsets, use_short_loca, glyf_prime);

    if (subset_glyphs.arrayZ)
      hb_free (subset_glyphs.arrayZ);

    return_trace (result);