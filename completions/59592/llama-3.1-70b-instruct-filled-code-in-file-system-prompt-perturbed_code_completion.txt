bool result = true;
hb_vector_t<glyf_impl::SubsetGlyph> glyphs;
if (unlikely (!_populate_subset_glyphs (context->plan, font, glyphs)))
  return_trace (false);

if (font)
  font->destroy ();

hb_vector_t<unsigned> padded_offsets;
if (unlikely (!padded_offsets.alloc (glyphs.length + 1, true)))
  return_trace (false);

unsigned int offset = 0;
for (unsigned int i = 0; i < glyphs.length; i++)
{
  padded_offsets[i] = offset;
  offset += glyphs[i].get_padded_length ();
}

bool use_short_loca = offset <= UINT16_MAX;
if (unlikely (!dataZ.resize (offset, true)))
  return_trace (false);

if (unlikely (!serialize (context->serializer, glyphs.iter (), use_short_loca, context->plan)))
  return_trace (false);

_free_compiled_subset_glyphs (glyphs);

if (unlikely (!context->serializer->get_length () == offset))
  return_trace (false);

return_trace (result);