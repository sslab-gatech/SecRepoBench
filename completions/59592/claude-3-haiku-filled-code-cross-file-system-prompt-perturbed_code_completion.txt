// Generate a subset of glyphs based on the provided plan and font.
// Populate a list of subset glyphs, checking for failure in the process.
hb_codepoint_t *glyph_ids = nullptr;
unsigned int num_glyphs = 0;
if (!context->plan->create_glyph_list (&glyph_ids, &num_glyphs))
  return_trace (false);

// Destroy the font if it was created for instancing, after using it.
hb_font_destroy (font);

// Calculate padded offsets for each subset glyph and determine if a short loca table can be used.
hb_vector_t<hb_subset_glyph_data_t> glyph_data;
bool use_short_loca = _calculate_glyph_data (glyph_ids, num_glyphs, glyph_data);

// Initialize a new glyf object for serialization.
glyf glyf_prime;

// Serialize the subset of glyphs into the glyf object, using the determined loca format.
if (!glyf_prime.serialize (context, glyph_data, use_short_loca))
  return_trace (false);

// Handle any necessary cleanup of resources, particularly the compiled subset glyphs, if required.
for (const hb_subset_glyph_data_t &data : glyph_data)
  data.glyph->free_compiled_bytes ();

// Return the result of the serialization process as the function's output.
bool result = context->serializer->add_table (HB_OT_TAG_glyf, &glyf_prime);
return_trace (result);