// Generate a subset of glyphs based on the provided plan and font.
    // Populate a list of subset glyphs, checking for failure in the process.
    // Destroy the font if it was created for instancing, after using it.
    // Calculate padded offsets for each subset glyph and determine if a short loca table can be used.
    // Initialize a new glyf object for serialization.
    // Serialize the subset of glyphs into the glyf object, using the determined loca format.
    // Handle any necessary cleanup of resources, particularly the compiled subset glyphs, if required.
    // Return the result of the serialization process as the function's output.
    bool result = true;
    hb_vector_t<glyf_impl::SubsetGlyph> subset_glyphs;
    if (!_populate_subset_glyphs(plan, font, subset_glyphs)) {
        result = false;
        if (font) hb_font_destroy(font);
        return result;
    }

    unsigned num_glyphs = subset_glyphs.length;
    bool use_short_loca = num_glyphs <= 0xFFFF;

    hb_serialize_context_t *c = hb_serialize_context_create();
    if (unlikely(!c)) {
        result = false;
        _free_compiled_subset_glyphs(subset_glyphs);
        return result;
    }

    if (!serialize(c, subset_glyphs.iter(), use_short_loca, plan)) {
        result = false;
    }

    hb_blob_t *blob = c->export_blob();
    hb_serialize_context_destroy(c);

    if (result) {
        dataZ.set(blob);
    } else {
        hb_blob_destroy(blob);
    }

    if (font) hb_font_destroy(font);
    return result;