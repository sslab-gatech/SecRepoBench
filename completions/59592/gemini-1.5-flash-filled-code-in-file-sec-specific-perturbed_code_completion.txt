hb_vector_t<glyf_impl::SubsetGlyph> subset_glyphs;
    bool result = _populate_subset_glyphs (context->plan, font, subset_glyphs);
    if (unlikely (!result))
    {
      if (font) hb_font_destroy (font);
      return_trace (false);
    }

    bool use_short_loca = subset_glyphs.is_empty () || subset_glyphs[0].source_glyph.get_length () <= 0xFFFFu;
    for (unsigned i = 1; i < subset_glyphs.length; i++)
      if (subset_glyphs[i].source_glyph.get_length () > 0xFFFFu)
      {
	use_short_loca = false;
	break;
      }

    OT::glyf new_glyf;
    result = new_glyf.serialize (context->serializer, subset_glyphs.begin (), use_short_loca, context->plan);
    _free_compiled_subset_glyphs (subset_glyphs);
    if (font) hb_font_destroy (font);