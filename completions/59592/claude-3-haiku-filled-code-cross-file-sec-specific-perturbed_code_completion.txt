// <MASK>
hb_subset_plan_t *plan = context->plan;
hb_vector_t<hb_codepoint_t> glyphs;
if (!plan->create_glyph_map (&glyphs))
  return_trace (false);

hb_blob_t *source_blob = hb_face_get_table (plan->source, HB_TAG ('g','l','y','f'));
hb_bytes_t source_bytes = hb_blob_get_bytes (source_blob, nullptr);

hb_glyf_accelerator_t glyf;
if (!glyf.init (plan->source))
  return_trace (false);

hb_glyf_table_t::glyph_header_t glyph_header;
hb_glyf_table_t::short_loca_t short_loca;
hb_glyf_table_t::long_loca_t long_loca;

hb_blob_t *new_glyf_blob = hb_glyf_table_t::serialize (&glyf,
                                                       glyphs,
                                                       source_bytes,
                                                       &glyph_header,
                                                       &short_loca,
                                                       &long_loca);

hb_blob_destroy (source_blob);
if (font)
  hb_font_destroy (font);

bool result = plan->add_table (HB_TAG ('g','l','y','f'), new_glyf_blob);
hb_blob_destroy (new_glyf_blob);

return_trace (result);