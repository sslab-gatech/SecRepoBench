hb_vector_t<unsigned int> subset_glyphs;
    if (unlikely (!context->plan->get_subset_glyphs (subset_glyphs)))
      return_trace (false);

    if (font)
      hb_font_destroy (font);

    hb_vector_t<unsigned int> padded_offsets;
    bool use_short_loca = false;
    if (unlikely (!calculate_padded_offsets (subset_glyphs, padded_offsets, use_short_loca)))
      return_trace (false);

    glyf glyf_object;
    if (unlikely (!glyf_object.init (context->serializer, use_short_loca)))
      return_trace (false);

    if (unlikely (!glyf_object.serialize (subset_glyphs, padded_offsets)))
      return_trace (false);

    free_compiled_bytes ();

    bool result = glyf_object.finalize ();