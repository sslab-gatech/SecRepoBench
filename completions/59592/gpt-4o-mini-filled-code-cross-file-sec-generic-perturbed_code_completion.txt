std::vector<glyph_t> subset_glyphs;
    if (!populate_subset_glyphs(context->plan, subset_glyphs)) {
      DEBUG_MSG(SUBSET, nullptr, "failed to populate subset glyphs.");
      if (font) {
        _destroy_font(font);
      }
      return_trace(false);
    }

    // Calculate padded offsets and determine loca format
    bool use_short_loca = should_use_short_loca(subset_glyphs);
    glyf_object_t *glyf = create_glyf_object(use_short_loca);
    if (!glyf) {
      DEBUG_MSG(SUBSET, nullptr, "failed to create glyf object.");
      if (font) {
        _destroy_font(font);
      }
      return_trace(false);
    }

    if (!serialize_subset_glyphs(glyf, subset_glyphs, use_short_loca)) {
      DEBUG_MSG(SUBSET, nullptr, "failed to serialize subset glyphs.");
      destroy_glyf_object(glyf);
      if (font) {
        _destroy_font(font);
      }
      return_trace(false);
    }

    if (font) {
      _destroy_font(font);
    }

    // Assuming result is a valid output type for the serialized glyf object
    result = glyf;