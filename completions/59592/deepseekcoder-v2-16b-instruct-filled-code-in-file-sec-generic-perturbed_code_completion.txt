// Generate a subset of glyphs based on the provided plan and font.
    // Populate a list of subset glyphs, checking for failure in the process.
    // Destroy the font if it was created for instancing, after using it.
    // Calculate padded offsets for each subset glyph and determine if a short loca table can be used.
    // Initialize a new glyf object for serialization.
    // Serialize the subset of glyphs into the glyf object, using the determined loca format.
    // Handle any necessary cleanup of resources, particularly the compiled subset glyphs, if required.
    // Return the result of the serialization process as the function's output.

    bool result = true;
    hb_vector_t<glyf_impl::SubsetGlyph> subset_glyphs;
    if (!_populate_subset_glyphs(context->plan, font, subset_glyphs)) {
        result = false;
        goto cleanup;
    }

    // Determine the loca format based on the subset glyphs
    bool use_short_loca = true;
    for (const auto& glyph : subset_glyphs) {
        if (glyph.get_length() > USHRT_MAX) {
            use_short_loca = false;
            break;
        }
    }

    // Initialize a new glyf object for serialization
    glyf subset_glyf;
    if (!subset_glyf.serialize(c, subset_glyphs.iter(), use_short_loca, context->plan)) {
        result = false;
        goto cleanup;
    }

    // Copy the serialized glyf data to the output context
    c->copy(subset_glyf.dataZ);

cleanup:
    if (font) {
        hb_font_destroy(font);
    }
    _free_compiled_subset_glyphs(subset_glyphs);
    return result;