hb_vector_t<SubsetGlyph> subset_glyphs;
bool result = false;
do {
  if (!SubsetGlyph::compile_subset_glyphs (context, font, subset_glyphs))
    break;

  hb_vector_t<uint32_t> padded_offsets;
  bool use_short_loca = false;
  if (!SubsetGlyph::calculate_padded_offsets (subset_glyphs, padded_offsets, use_short_loca))
    break;

  glyf *glyf_prime = context->serializer->start_embed<glyf> ();
  if (unlikely (!glyf_prime))
    break;

  result = glyf_prime->serialize_subset (context, subset_glyphs, padded_offsets, use_short_loca);
} while (false);

if (font)
  hb_font_destroy (font);

for (auto &g : subset_glyphs)
  g.free_compiled_bytes();