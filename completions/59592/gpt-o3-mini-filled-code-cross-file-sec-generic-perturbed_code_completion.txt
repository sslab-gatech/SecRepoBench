bool result_local = false;
do {
    // Step 1: Generate the subset glyph list using the plan (and font if needed).
    subset_glyphs_t subset;
    if (!generate_subset_glyphs(context->plan, font, &subset)) {
        DEBUG_MSG(SUBSET, nullptr, "Failed to generate subset glyph list.");
        break;
    }

    // Step 2: Calculate padded offsets for each subset glyph and determine loca table format.
    bool use_short_loca = calculate_short_loca(subset);

    // Step 3: Initialize the glyf object for serialization using the determined loca format.
    if (!this->init_serialization(context->plan, use_short_loca)) {
        DEBUG_MSG(SUBSET, nullptr, "Failed to initialize glyf serialization.");
        free_subset_glyphs(&subset);
        break;
    }

    // Step 4: Serialize the subset of glyphs into the glyf object.
    if (!this->serialize_subset_glyphs(context, subset, use_short_loca)) {
        DEBUG_MSG(SUBSET, nullptr, "Glyf serialization failed.");
        free_subset_glyphs(&subset);
        break;
    }

    result_local = true;
    free_subset_glyphs(&subset);
} while (0);

if (font)
    hb_font_destroy(font);

result = result_local;