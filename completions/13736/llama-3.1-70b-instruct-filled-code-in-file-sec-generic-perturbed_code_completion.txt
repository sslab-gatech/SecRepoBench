// Allocate memory for storing offsets of font dictionaries based on the offset size and count of font dictionaries.
if (!unlikely (c->allocate_size<HBUINT8> (offsetSize * (fdCount + 1))))
  return_trace (false);

// Initialize offset tracking variables for serialization of font dictionary offsets.
unsigned int  offset = 1;
unsigned int  i = 0;
for (; i < fontDicts.length; i++)
{
  if (fdmap.includes (i))
  {
    CFFIndexOf<COUNT, FontDict>::set_offset_at (fdmap[i], offset);
    offset += FontDict::calculate_serialized_size (fontDicts[i], opszr, privateInfos[fdmap[i]]);
  }
}
CFFIndexOf<COUNT, FontDict>::set_offset_at (fdCount, offset);