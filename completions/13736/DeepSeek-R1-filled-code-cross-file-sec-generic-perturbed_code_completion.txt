unsigned int current_offset = 0;
hb_vector_t<unsigned int> offsets;
if (unlikely (!offsets.resize (fdCount + 1))) return_trace (false);
offsets[0] = current_offset;
unsigned int new_idx = 0;
for (unsigned int i = 0; i < fontDicts.length; i++)
{
  if (fdmap.includes (i))
  {
    unsigned int size = FontDict::calculate_serialized_size (fontDicts[i], opszr, privateInfos[fdmap[i]]);
    current_offset += size;
    offsets[++new_idx] = current_offset;
  }
}
for (unsigned int j = 0; j <= fdCount; j++)
{
  unsigned int offset = offsets[j];
  for (unsigned int k = 0; k < offSize; k++)
  {
    HBUINT8 b;
    b = (offset >> (8 * (offSize - k - 1))) & 0xFF;
    if (unlikely (!c->embed (b))) return_trace (false);
  }
}