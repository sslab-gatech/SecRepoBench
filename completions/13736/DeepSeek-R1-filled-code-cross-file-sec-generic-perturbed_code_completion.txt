if (unlikely (!c->allocate_size<void> ((fdCount + 1) * offsetSize))) return_trace(false);
    char *offset_ptr = (char *) (this + 1);
    unsigned int current_offset = 1;
    unsigned int j = 0;
    for (unsigned int i = 0; i < fontDicts.length; i++)
    {
      if (fdmap.includes (i))
      {
        unsigned int size = FontDict::calculate_serialized_size (fontDicts[i], opszr, privateInfos[fdmap[i]]);
        switch (offsetSize)
        {
          case 1: 
            if (unlikely (current_offset > 0xFF)) return_trace(false);
            ((HBUINT8*)offset_ptr)[j] = current_offset;
            break;
          case 2: 
            if (unlikely (current_offset > 0xFFFF)) return_trace(false);
            ((HBUINT16*)offset_ptr)[j] = current_offset;
            break;
          case 3: 
            if (unlikely (current_offset > 0xFFFFFF)) return_trace(false);
            hb_put_24 ((uint8_t*)offset_ptr + j * 3, current_offset);
            break;
          case 4: 
            ((HBUINT32*)offset_ptr)[j] = current_offset;
            break;
          default: 
            return_trace(false);
        }
        j++;
        current_offset += size;
      }
    }
    switch (offsetSize)
    {
      case 1: 
        if (unlikely (current_offset > 0xFF)) return_trace(false);
        ((HBUINT8*)offset_ptr)[fdCount] = current_offset;
        break;
      case 2: 
        if (unlikely (current_offset > 0xFFFF)) return_trace(false);
        ((HBUINT16*)offset_ptr)[fdCount] = current_offset;
        break;
      case 3: 
        if (unlikely (current_offset > 0xFFFFFF)) return_trace(false);
        hb_put_24 ((uint8_t*)offset_ptr + fdCount * 3, current_offset);
        break;
      case 4: 
        ((HBUINT32*)offset_ptr)[fdCount] = current_offset;
        break;
      default: 
        return_trace(false);
    }