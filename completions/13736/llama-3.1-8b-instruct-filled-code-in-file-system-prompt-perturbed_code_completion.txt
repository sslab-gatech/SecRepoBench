template <typename DICTVAL, typename OP_SERIALIZER, typename PARAM>
bool serialize (hb_serialize_context_t *c,
		unsigned int offsetSize,
		const hb_vector_t<DICTVAL> &fontDicts,
		unsigned int fdCount,
		const remap_t &fdmap,
		OP_SERIALIZER& opszr,
		const hb_vector_t<table_info_t> &privateInfos)
{
  TRACE_SERIALIZE (this);
  if (unlikely (!c->extend_min (*this))) return_trace (false);
  this->count.set (fdCount);
  this->offSize.set (offsetSize);
  // Allocate memory for storing offsets of font dictionaries based on the offset size and count of font dictionaries.
  // Initialize offset tracking variables for serialization of font dictionary offsets.
  // Iterate through each font dictionary, checking if it is included in the remap.
  // For included font dictionaries, set their respective offsets in a serializable format.
  // Compute and accumulate the serialized size of each included font dictionary into the offset variable.
  // Update the last offset to mark the end of the serialized data for font dictionaries.
  for (unsigned int i = 0; i < fontDicts.length; i++)
    if (fdmap.includes (i))
    {
      FontDict *dict = c->start_embed<FontDict> ();
      if (unlikely (!dict->serialize (c, fontDicts[i], opszr, privateInfos[fdmap[i]])))
	return_trace (false);
    }
  return_trace (true);
}

template <typename OP_SERIALIZER, typename DICTVAL>
static unsigned int calculate_serialized_size (unsigned int &offSize_ /* OUT */,
					       const hb_vector_t<DICTVAL> &fontDicts,
					       unsigned int fdCount,
					       const remap_t &fdmap,
					       OP_SERIALIZER& opszr)
{
  unsigned int dictsSize = 0;
  for (unsigned int i = 0; i < fontDicts.len; i++)
    if (fdmap.includes (i))
      dictsSize += FontDict::calculate_serialized_size (fontDicts[i], opszr);

  offSize_ = calcOffSize (dictsSize);
  return CFFIndex<COUNT>::calculate_serialized_size (offSize_, fdCount, dictsSize);
}