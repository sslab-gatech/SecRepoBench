unsigned int offset = 1;
    unsigned int *offsetArray = (unsigned int *) hb_calloc (fdCount, offsetSize);
    if (unlikely (!offsetArray)) return_trace (false);

    for (unsigned int i = 0, j = 0; i < fontDicts.length; i++)
    {
      if (fdmap.includes (i))
      {
	set_offset_at (offsetArray, j++, offsetSize, offset);
	offset += FontDict::calculate_serialized_size (fontDicts[i], opszr, privateInfos[fdmap[i]]);
      }
    }
    set_offset_at (offsetArray, fdCount, offsetSize, offset);

    HBUINT8 *p = c->allocate_size<HBUINT8> (offsetSize * (fdCount + 1));
    if (unlikely (!p)) { hb_free (offsetArray); return_trace (false); }

    for (unsigned int i = 0; i < fdCount + 1; i++)
    {
      unsigned int off = get_offset_at (offsetArray, i, offsetSize);
      c->copy (p, &off, offsetSize);
      p += offsetSize;
    }
    hb_free (offsetArray);