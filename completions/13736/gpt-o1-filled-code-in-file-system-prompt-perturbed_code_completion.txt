if (unlikely (!c->allocate_size<HBUINT8>(offsetSize * (fdCount + 1))))
  return_trace(false);

unsigned int offset = 1;
unsigned int idx = 0;
for (unsigned int i = 0; i < fontDicts.length; i++)
{
  if (!fdmap.includes(i))
    continue;

  this->set_offset_at(idx, offset);
  offset += FontDict::calculate_serialized_size(fontDicts[i], opszr, privateInfos[fdmap[i]]);
  idx++;
}
this->set_offset_at(idx, offset);