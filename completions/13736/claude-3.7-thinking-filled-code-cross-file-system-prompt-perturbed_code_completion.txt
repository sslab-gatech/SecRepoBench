unsigned *offsets = c->allocate_size<unsigned> ((fdCount + 1) * offsetSize);
if (unlikely (!offsets)) return_trace (false);

unsigned int offset = 1;
for (unsigned int i = 0; i < fontDicts.length; i++)
  if (fdmap.includes (i))
    offset += FontDict::calculate_serialized_size (fontDicts[i], opszr);

for (unsigned int i = 0; i <= fdCount; i++)
{
  unsigned int off = (i == fdCount) ? offset : 1;
  if (unlikely (!CFFIndex<COUNT>::set_offset_at (offsets, i, offsetSize, off)))
    return_trace (false);
}