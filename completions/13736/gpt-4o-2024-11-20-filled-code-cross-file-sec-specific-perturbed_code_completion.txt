// Calculate the serialized size of the font dictionaries and determine the offset size.
    unsigned int totalSize = 0;
    unsigned int offSize = 0;
    totalSize = calculate_serialized_size(offSize, fontDicts, fdCount, fdmap, opszr);

    // Allocate memory for offsets based on the calculated offset size and count.
    unsigned int *offsets = (unsigned int *) malloc((fdCount + 1) * sizeof(unsigned int));
    if (!offsets) return_trace(false); // Handle memory allocation failure securely.

    // Initialize the first offset to 0.
    offsets[0] = 0;

    // Compute offsets for each font dictionary included in the remap.
    unsigned int currentOffset = 0;
    for (unsigned int i = 0, j = 0; i < fontDicts.length; i++) {
        if (fdmap.includes(i)) {
            unsigned int dictSize = FontDict::calculate_serialized_size(fontDicts[i], opszr);
            currentOffset += dictSize;
            offsets[++j] = currentOffset;
        }
    }

    // Ensure the last offset marks the end of the serialized data.
    offsets[fdCount] = currentOffset;

    // Serialize the offsets into the context.
    if (unlikely(!c->serialize_offsets(offsets, fdCount + 1, offSize))) {
        free(offsets); // Free allocated memory before returning.
        return_trace(false);
    }

    // Free the allocated memory for offsets after use.
    free(offsets);