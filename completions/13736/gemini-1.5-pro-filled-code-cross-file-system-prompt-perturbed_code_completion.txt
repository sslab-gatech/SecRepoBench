unsigned int lastOffset = offsetSize * fdCount;
    if (unlikely (!c->extend_min (lastOffset))) return_trace (false);
    unsigned char *p = c->allocate_size<unsigned char> (lastOffset);
    if (unlikely (!p)) return_trace (false);

    for (unsigned int i = 0; i < fontDicts.length; i++)
      if (fdmap.includes (i))
      {
	unsigned int offset = offsetSize * fdmap[i];
	if (offsetSize == 1)
	  p[offset] = lastOffset;
	else if (offsetSize == 2)
	  *reinterpret_cast<HBUINT16*> (&p[offset]) = lastOffset;
	else if (offsetSize == 3)
	  {
	    p[offset] = lastOffset >> 16;
	    *reinterpret_cast<HBUINT16*> (&p[offset + 1]) = lastOffset & 0xFFFFu;
	  }
	else
	  *reinterpret_cast<HBUINT32*> (&p[offset]) = lastOffset;

	lastOffset += FontDict::calculate_serialized_size (fontDicts[i], opszr);
      }