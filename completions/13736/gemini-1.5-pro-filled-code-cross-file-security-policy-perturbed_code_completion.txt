unsigned int  start = c->head;
    unsigned int *offArr = c->allocate_size<unsigned int> (fdCount);
    if (unlikely (!offArr)) return_trace (false);
    unsigned int  lastOff = 0;
    for (unsigned int i = 0; i < fdCount && i < fontDicts.length; i++) // Check index i against both fdCount and fontDicts.length
    {
      if (fdmap.includes (i))
      {
	unsigned int curOff = lastOff;
        if (offsetSize == 1)
	  c->push<HBUINT8> (curOff);
	else if (offsetSize == 2)
	  c->push<HBUINT16> (curOff);
	else
	  c->push<HBUINT32> (curOff);

	if (unlikely (!c->successful ())) return_trace (false);
	lastOff += FontDict::calculate_serialized_size (fontDicts[i], opszr, privateInfos[fdmap[i]]);
      }
    }
    if (unlikely (!c->check_assign (this->fontDicts, c->head - start))) return_trace (false);