unsigned int *offsets = c->allocate_size<unsigned int> ((fdCount + 1) * offsetSize);
if (unlikely (!offsets)) return_trace (false);

unsigned int offset = 0;
for (unsigned int i = 0; i < fdCount + 1; i++)
{
  switch (offsetSize) {
    case 1: ((HBUINT8  *) offsets)[i].set (offset); break;
    case 2: ((HBUINT16 *) offsets)[i].set (offset); break;
    case 3: ((HBUINT24 *) offsets)[i].set (offset); break;
    case 4: ((HBUINT32 *) offsets)[i].set (offset); break;
    default: return_trace (false);
  }

  if (i < fdCount)
  {
    unsigned int j = fdmap[i];
    if (j < fontDicts.length)
      offset += FontDict::calculate_serialized_size (fontDicts[j], opszr, privateInfos[i]);
  }
}