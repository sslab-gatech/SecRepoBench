unsigned int *offsets = (unsigned int *) calloc (fdCount + 1, sizeof (unsigned int));
if (unlikely (!offsets)) return_trace (false);

unsigned int offset = 0;
for (unsigned int i = 0; i < fontDicts.length; i++)
{
  if (fdmap.includes (i))
  {
    offsets[fdmap[i]] = offset;
    offset += fontDicts[i].get_size ();
  }
}
offsets[fdCount] = offset;

for (unsigned int i = 0; i < fdCount + 1; i++)
{
  if (unlikely (!c->embed (offsets[i], offsetSize))) 
  {
    free (offsets);
    return_trace (false);
  }
}

free (offsets);