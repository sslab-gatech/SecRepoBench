unsigned int *offsets = (unsigned int *) calloc (fdCount, offsetSize);
    if (unlikely (!offsets)) return_trace (false);
    unsigned int lastOffset = 0;
    for (unsigned int i = 0; i < fdCount; i++)
    {
      if (offsetSize == 2)
        ((HBUINT16 *) offsets)[i] = lastOffset;
      else
        offsets[i] = lastOffset;

      if (fdmap.includes(i))
      {
         unsigned dictSize = fontDicts[fdmap[i]].size;
         lastOffset += dictSize;
      }
    }

    if (unlikely (!c->extend_min (lastOffset)))
    {
       free (offsets);
       return_trace (false);
    }

    if (unlikely (!hb_serialize_array (c, offsets, fdCount, offsetSize))) {
       free(offsets);
       return_trace(false);
    }
    free (offsets);