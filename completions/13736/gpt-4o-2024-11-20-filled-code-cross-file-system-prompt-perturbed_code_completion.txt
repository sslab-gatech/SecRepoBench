unsigned int dictsSize = 0;
    hb_vector_t<unsigned int> offsets(fdCount + 1);
    unsigned int currentOffset = 1; // Start with 1 as per CFFIndex convention

    for (unsigned int i = 0; i < fontDicts.length; i++)
    {
      if (fdmap.includes(i))
      {
        unsigned int dictSize = FontDict::calculate_serialized_size(fontDicts[i], opszr);
        dictsSize += dictSize;
        offsets[currentOffset++] = dictsSize;
      }
    }

    this->offsets.allocate(c, fdCount + 1);
    for (unsigned int i = 0; i <= fdCount; i++)
      this->offsets[i].set(offsets[i]);