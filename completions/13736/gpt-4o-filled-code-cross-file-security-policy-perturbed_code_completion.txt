unsigned int *offsets = c->allocate_n<unsigned int> (fdCount + 1);
    if (unlikely (!offsets)) return_trace (false);

    unsigned int currentOffset = 1; // Start with 1 as per CFF specification
    for (unsigned int i = 0; i < fdCount; i++)
    {
      if (fdmap.includes (i))
      {
        if (i < fdCount) // Ensure index is within bounds
          offsets[i] = currentOffset;
        else
          return_trace (false); // Out of bounds, return false

        unsigned int dictSize = FontDict::calculate_serialized_size (fontDicts[i], opszr);
        currentOffset += dictSize;
      }
    }

    if (fdCount < fdCount + 1) // Ensure index is within bounds
      offsets[fdCount] = currentOffset; // Mark the end of the serialized data
    else
      return_trace (false); // Out of bounds, return false

    this->offsets.set (offsets, fdCount + 1);