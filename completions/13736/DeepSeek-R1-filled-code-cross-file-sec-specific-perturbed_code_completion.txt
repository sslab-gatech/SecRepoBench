if (unlikely (!c->allocate_size<void> ((fdCount + 1) * offsetSize))) return_trace (false);
    char *offset_data = (char *) c->head - (fdCount + 1) * offsetSize;
    unsigned int current_offset = (fdCount + 1) * offsetSize;

    for (unsigned int i = 0; i < fontDicts.length; i++)
    {
      if (!fdmap.includes (i)) continue;
      unsigned int j = fdmap[i];
      switch (offsetSize) {
	case 1:
	  if (unlikely (current_offset > 0xFFU)) return_trace (false);
	  ((HBUINT8*) offset_data)[j] = current_offset;
	  break;
	case 2:
	  ((HBUINT16*) offset_data)[j] = current_offset;
	  break;
	case 3:
	  ((HBUINT24*) offset_data)[j] = current_offset;
	  break;
	case 4:
	  ((HBUINT32*) offset_data)[j] = current_offset;
	  break;
	default:
	  return_trace (false);
      }

      FontDict *dict = c->start_embed<FontDict> ();
      if (unlikely (!dict->serialize (c, fontDicts[i], opszr, privateInfos[j])))
	return_trace (false);
      current_offset += c->head - (char *) dict;
    }

    switch (offsetSize) {
      case 1:
	if (unlikely (current_offset > 0xFFU)) return_trace (false);
	((HBUINT8*) offset_data)[fdCount] = current_offset;
	break;
      case 2:
	((HBUINT16*) offset_data)[fdCount] = current_offset;
	break;
      case 3:
	((HBUINT24*) offset_data)[fdCount] = current_offset;
	break;
      case 4:
	((HBUINT32*) offset_data)[fdCount] = current_offset;
	break;
      default:
	return_trace (false);
    }