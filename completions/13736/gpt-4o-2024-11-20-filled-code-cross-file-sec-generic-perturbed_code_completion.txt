// Calculate the serialized size of the font dictionaries and determine the offset size.
    unsigned int totalSize = calculate_serialized_size(this->offSize, fontDicts, fdCount, fdmap, opszr);

    // Allocate memory for offsets based on the calculated offset size and count.
    this->offsets.allocate(fdCount + 1);

    // Initialize the first offset to 0.
    this->offsets[0] = 0;

    // Track the current offset as we serialize each font dictionary.
    unsigned int currentOffset = 0;

    // Iterate through each font dictionary and set offsets for those included in the remap.
    for (unsigned int i = 0, j = 0; i < fontDicts.length; i++) {
        if (fdmap.includes(i)) {
            // Update the offset for the current font dictionary.
            currentOffset += FontDict::calculate_serialized_size(fontDicts[i], opszr);
            this->offsets[++j] = currentOffset;
        }
    }

    // Ensure the last offset matches the total serialized size.
    if (unlikely(this->offsets[fdCount] != totalSize)) {
        return_trace(false);
    }