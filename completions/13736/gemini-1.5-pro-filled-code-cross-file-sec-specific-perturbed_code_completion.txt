unsigned char *offsets = (unsigned char *) c->allocate_size<unsigned char> (fdCount * offsetSize);
    if (unlikely (!offsets)) return_trace (false);
    unsigned int lastOffset = 0;
    for (unsigned int i = 0; i < fontDicts.length; i++)
    {
      if (fdmap.includes(i))
      {
        if (offsetSize == 1)
          offsets[i] = lastOffset;
        else if (offsetSize == 2)
          *reinterpret_cast<HBUINT16 *>(&offsets[i * offsetSize]) = lastOffset;
        else if (offsetSize == 3) {
          offsets[i * offsetSize] = lastOffset >> 16;
          *reinterpret_cast<HBUINT16 *>(&offsets[i * offsetSize + 1]) = lastOffset & 0xFFFF;
        }
        else
          *reinterpret_cast<HBUINT32 *>(&offsets[i * offsetSize]) = lastOffset;

        lastOffset += FontDict::calculate_serialized_size (fontDicts[i], opszr, privateInfos[fdmap[i]]);
      }
    }
    if (unlikely (!this->offsets.serialize (c, offsets, fdCount, offsetSize))) return_trace (false);