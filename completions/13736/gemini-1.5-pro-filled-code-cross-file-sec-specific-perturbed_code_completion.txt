unsigned int offset = offsetSize * fdCount;
char *p = (char *) malloc (offset);
if (unlikely (!p)) return_trace (false);
memset (p, 0, offset);
unsigned int lastOffset = 0;

if (offsetSize == 2) {
  HBUINT16 *offsets = reinterpret_cast<HBUINT16*>(p);
  for (unsigned int i = 0; i < fontDicts.length; i++)
    if (fdmap.includes(i))
    {
      offsets[i] = lastOffset;
      lastOffset += fontDicts[i].size;
    }
} else {
  HBUINT32 *offsets = reinterpret_cast<HBUINT32*>(p);
  for (unsigned int i = 0; i < fontDicts.length; i++)
    if (fdmap.includes(i))
    {
      offsets[i] = lastOffset;
      lastOffset += fontDicts[i].size;
    }
}


if (unlikely (!c->extend_min (offset))) {
    free(p);
    return_trace (false);
}
memcpy (*c, p, offset);
free (p);