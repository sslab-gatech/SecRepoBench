unsigned int dictsSize = 0;
unsigned int *offsets = (unsigned int *) c->allocate_size (CFFIndex<COUNT>::calculate_serialized_size (offSize, fdCount, dictsSize));
if (unlikely (!offsets)) return_trace (false);

unsigned int lastOffset = 0;
for (unsigned int i = 0; i < fdCount; i++)
{
  if (fdmap.includes (i))
  {
    unsigned int dictSize = FontDict::calculate_serialized_size (fontDicts[i], opszr);
    offsets[i] = lastOffset;
    lastOffset += dictSize;
  }
  else
  {
    offsets[i] = 0; // Set offset to zero for excluded font dictionaries.
  }
}
// Ensure the allocated memory is sufficient for storing all offsets.
if (lastOffset > dictsSize) dictsSize = lastOffset;