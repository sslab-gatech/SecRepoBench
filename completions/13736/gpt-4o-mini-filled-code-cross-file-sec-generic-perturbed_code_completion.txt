unsigned int serializedSize = 0;
    hb_vector_t<unsigned int> offsets(fontDicts.length);
    
    // Calculate the serialized size of font dictionaries
    serializedSize = calculate_serialized_size(offsetSize, fontDicts, fdCount, fdmap, opszr);
    
    // Allocate memory for offsets based on the calculated size
    if (unlikely(!c->allocate_memory(serializedSize))) return_trace(false);
    
    // Initialize offset tracking
    unsigned int lastOffset = 0;
    
    // Iterate through each font dictionary
    for (unsigned int i = 0; i < fontDicts.length; i++) {
        if (fdmap.includes(i)) {
            offsets[i] = lastOffset; // Set the offset for the current font dictionary
            lastOffset += FontDict::calculate_serialized_size(fontDicts[i], opszr); // Update lastOffset
        }
    }
    
    // Store the offsets in the context
    c->store_offsets(offsets);