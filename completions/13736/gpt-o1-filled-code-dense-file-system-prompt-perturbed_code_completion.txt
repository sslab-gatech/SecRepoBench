if (unlikely (!c->allocate_size<HBUINT8> (offsetSize * (fdCount + 1))))
  return_trace (false);

unsigned int offset = 1;
unsigned int out_idx = 0;
/* Collect and record offsets for only those font dicts used by fdmap. */
for (unsigned int i = 0; i < fontDicts.length; i++)
{
  if (!fdmap.includes (i))
    continue;
  CFFIndexOf<COUNT, FontDict>::set_offset_at (out_idx, offset);
  offset += FontDict::calculate_serialized_size (fontDicts[i], opszr);
  out_idx++;
}
/* Record the last offset marking the end of the font dict data. */
CFFIndexOf<COUNT, FontDict>::set_offset_at (out_idx, offset);