{
  const unsigned int numDicts = fdCount;  // Number of included font dictionaries.
  const unsigned int offsetsTableSize = (numDicts + 1) * offsetSize;

  // Allocate memory for the offsets table securely.
  unsigned char *offsets = static_cast<unsigned char *>(c->allocate(offsetsTableSize));
  if (unlikely(!offsets))
    return_trace(false);

  // Initialize the first offset for the CFF Index (always 1).
  unsigned int currentOffset = 1;
  unsigned int offsetIndex = 0;
  for (unsigned int k = 0; k < offsetSize; k++)
    offsets[offsetIndex * offsetSize + k] = (currentOffset >> (8 * (offsetSize - 1 - k))) & 0xFF;
  offsetIndex++;

  // Iterate over all font dictionaries.
  for (unsigned int i = 0; i < fontDicts.length; i++)
  {
    if (fdmap.includes(i))
    {
      // Compute the serialized size of the current dictionary.
      unsigned int dictSize = FontDict::calculate_serialized_size(fontDicts[i], opszr);
      currentOffset += dictSize;

      // Write the updated offset into the offsets table in big-endian order.
      for (unsigned int k = 0; k < offsetSize; k++)
        offsets[offsetIndex * offsetSize + k] = (currentOffset >> (8 * (offsetSize - 1 - k))) & 0xFF;
      offsetIndex++;
    }
  }
}