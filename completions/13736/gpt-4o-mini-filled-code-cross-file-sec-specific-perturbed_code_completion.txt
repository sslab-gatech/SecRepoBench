unsigned int serializedSize = 0;
    unsigned int totalSize = calculate_serialized_size(serializedSize, fontDicts, fdCount, fdmap, opszr);
    
    // Allocate memory for offsets based on the calculated serialized size
    unsigned int *offsets = (unsigned int *)malloc(totalSize * sizeof(unsigned int));
    if (unlikely(!offsets)) return_trace(false);
    
    // Initialize offsets to zero
    memset(offsets, 0, totalSize * sizeof(unsigned int));
    
    // Track the current offset
    unsigned int currentOffset = 0;
    
    // Iterate through each font dictionary to set offsets
    for (unsigned int i = 0; i < fontDicts.length; i++) {
        if (fdmap.includes(i)) {
            offsets[i] = currentOffset;
            currentOffset += FontDict::calculate_serialized_size(fontDicts[i], opszr);
        }
    }
    
    // Store the offsets in the context
    c->set_offsets(offsets, totalSize);
    
    // Free the allocated memory after use
    free(offsets);