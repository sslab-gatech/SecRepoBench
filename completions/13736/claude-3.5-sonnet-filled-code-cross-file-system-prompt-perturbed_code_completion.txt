unsigned *offsets = (unsigned *)malloc((fdCount + 1) * sizeof(unsigned));
if (unlikely (!offsets)) return_trace (false);

unsigned int size = 0;
for (unsigned int i = 0; i < fontDicts.length; i++)
{
  if (fdmap.includes(i))
  {
    offsets[size / offsetSize] = c->start_embed<HBUINT8> () - c->head;
    size += FontDict::static_size;
  }
}
offsets[fdCount] = size;

for (unsigned int i = 0; i <= fdCount; i++)
{
  if (unlikely (!c->embed (offsets[i], offsetSize)))
  {
    free(offsets);
    return_trace (false);
  }
}

free(offsets);