if (nCompressed < 20) return EXR_ERR_CORRUPT_CHUNK;

    ptr = compressed;
    im = readUInt(ptr);
    iM = readUInt(ptr + 4);
    nBits = readUInt(ptr + 8);
    nBytes = readUInt(ptr + 12);

    if (im >= HUF_ENCSIZE || iM >= HUF_ENCSIZE || im > iM) return EXR_ERR_CORRUPT_CHUNK;

    if (nCompressed < 20 + nBytes) return EXR_ERR_CORRUPT_CHUNK;

    if (fasthuf_decode_enabled() && nRawSize >= 256)
    {
        FastHufDecoder fhd;
        rv = fasthuf_initialize(pctxt, &fhd, &compressed + 20, nCompressed - 20, im, iM, 0);
        if (rv != EXR_ERR_SUCCESS) return rv;

        rv = fasthuf_decode(pctxt, &fhd, compressed + 20, nBits, raw, nRawSize);
        return rv;
    }
    else
    {
        HufDec hdecod[HUF_DECSIZE];
        hufClearDecTable(hdecod);
        rv = hufBuildDecTable(freq, im, iM, hdecod);
        if (rv != EXR_ERR_SUCCESS) return rv;

        rv = hufDecode(freq, hdecod, compressed + 20, nBits, 0, nRawSize, raw);
        hufFreeDecTable(hdecod);
        return rv;
    }