if (nCompressed < 20)
    {
        return EXR_ERR_CORRUPT_CHUNK;
    }

    im = readUInt(compressed);
    iM = readUInt(compressed + 4);

    if (im < 0 || im >= HUF_ENCSIZE || iM < 0 || iM >= HUF_ENCSIZE)
    {
        return EXR_ERR_CORRUPT_CHUNK;
    }

    ptr = compressed + 20;
    nBytes = (nCompressed - 20);

    if (ptr - compressed + nBytes > nCompressed)
    {
        return EXR_ERR_CORRUPT_CHUNK;
    }

    if (FastHufDecoder::enabled() && nBytes > 128)
    {
        FastHufDecoder fhd(ptr, nBytes, im, iM, iM);
        fhd.decode((unsigned char*)ptr, nBytes * 8, raw, nRawSize);
    }
    else
    {
        hufClearDecTable(decode->huf_dec_table);
        hufUnpackEncTable(&ptr, nBytes, im, iM, decode->huf_freq_table);
        hufBuildDecTable(decode->huf_freq_table, im, iM, decode->huf_dec_table);
        hufDecode(decode->huf_freq_table, decode->huf_dec_table, ptr, nBytes * 8, iM, nRawSize, raw);
    }

    rv = EXR_ERR_SUCCESS;