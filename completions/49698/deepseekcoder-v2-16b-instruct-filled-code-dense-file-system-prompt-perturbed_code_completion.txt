// <MASK>
    if (nCompressed < 20)
        return EXR_ERR_INVALID_ARGUMENT;

    pctxt = decode->context;

    if (pctxt == NULL)
        return EXR_ERR_INVALID_ARGUMENT;

    if (nRawSize == 0)
        return EXR_ERR_INVALID_ARGUMENT;

    if (compressed == NULL)
        return EXR_ERR_INVALID_ARGUMENT;

    if (raw == NULL)
        return EXR_ERR_INVALID_ARGUMENT;

    if (nCompressed < 20)
        return EXR_ERR_INVALID_ARGUMENT;

    im = readUInt(compressed);
    iM = readUInt(compressed + 4);
    nBits = readUInt(compressed + 8);
    tableLength = readUInt(compressed + 12);

    if (im == 0 || iM == 0 || tableLength == 0 || nBits == 0)
        return EXR_ERR_INVALID_ARGUMENT;

    if (nCompressed < 20 + tableLength + ((nBits + 7) / 8))
        return EXR_ERR_INVALID_ARGUMENT;

    ptr = compressed + 20 + tableLength;
    nBytes = ((nBits + 7) / 8);

    if (fast_huffman_enabled && nCompressed >= 20 + tableLength + ((nBits + 7) / 8) * 2)
    {
        rv = fast_huffman_decompress(decode, ptr, nBytes, raw, nRawSize, spare, sparebytes);
    }
    else
    {
        rv = standard_huffman_decompress(decode, ptr, nBytes, raw, nRawSize, spare, sparebytes);
    }

    if (rv != EXR_ERR_SUCCESS)
        return rv;

    return EXR_ERR_SUCCESS;