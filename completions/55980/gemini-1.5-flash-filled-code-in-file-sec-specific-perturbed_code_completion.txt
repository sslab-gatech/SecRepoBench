if (ctxt->input->buf != NULL) {
        if (ctxt->input->buf->encoder != NULL) {
            int nbchars;

            nbchars = xmlCharEncInput(ctxt->input->buf, 1);
            if (nbchars < 0) {
                /* TODO 2.6.0 */
                xmlGenericError(xmlGenericErrorContext,
                                "xmlParseChunk: encoder error\n");
                xmlHaltParser(ctxt);
                return (XML_ERR_INVALID_ENCODING);
            }
        }
    }