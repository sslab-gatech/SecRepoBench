encoding_error:
    if (parserContext->errNo == XML_ERR_INVALID_ENCODING) {
	xmlChar *msg;
	int len;

	len = xmlStrlen(parserContext->input->cur);
	msg = xmlStrndup(parserContext->input->cur, len < 10 ? len : 10);
	if (msg != NULL) {
	    xmlFatalErr(parserContext, XML_ERR_INVALID_ENCODING,
			"Encoding error : %s\n", msg);
	    xmlFree(msg);
	} else {
	    xmlFatalErr(parserContext, XML_ERR_INVALID_ENCODING,
			"Encoding error\n");
	}
	xmlHaltParser(parserContext);
	return(0);
    }
    return(ret);