encoding_error:
    if (ctxt->errNo == XML_ERR_INVALID_ENCODING) {
        xmlChar *msg;
        int len;

        len = xmlStrlen(ctxt->input->cur);
        msg = xmlStrndup(ctxt->input->cur, len > 10 ? 10 : len);
        xmlFatalErr(ctxt, XML_ERR_INVALID_ENCODING,
                    "Input is not proper UTF-8, first 10 bytes are: %s\n", msg);
        xmlFree(msg);
    }
    xmlHaltParser(ctxt);
    return(0);