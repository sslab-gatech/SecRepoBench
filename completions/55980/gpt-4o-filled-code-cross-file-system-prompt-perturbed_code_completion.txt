encoding_error:
    if (ctxt->input != NULL) {
        xmlCharEncoding enc = xmlDetectCharEncoding(ctxt->input->cur, 4);
        if (enc == XML_CHAR_ENCODING_ERROR) {
            xmlFatalErrMsg(ctxt, XML_ERR_INVALID_ENCODING,
                           "Input is not proper UTF-8, indicate encoding !\n");
        } else {
            xmlFatalErrMsg(ctxt, XML_ERR_INVALID_ENCODING,
                           "Input is not proper UTF-8, bytes: 0x%02X 0x%02X 0x%02X 0x%02X\n",
                           ctxt->input->cur[0], ctxt->input->cur[1],
                           ctxt->input->cur[2], ctxt->input->cur[3]);
        }
    } else {
        xmlFatalErrMsg(ctxt, XML_ERR_INVALID_ENCODING,
                       "Input is not proper UTF-8, indicate encoding !\n");
    }
    xmlHaltParser(ctxt);
    return(0);