if (parserContext->charset != XML_CHAR_ENCODING_UTF8) {
        int len = parserContext->input->cur - parserContext->input->base;
        int res = xmlCheckUTF8(parserContext->input->base, len);
        if (res < 0) {
            xmlFatalErrMsgInt(parserContext, XML_ERR_INVALID_ENCODING,
                              "Input is not valid UTF-8, byte %d\n", -res);
            xmlHaltParser(parserContext);
            return(0);
        }
    }