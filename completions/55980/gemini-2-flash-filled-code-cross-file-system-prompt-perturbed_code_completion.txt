encoding_error:
		if (ctxt->input->buf != NULL) {
		    xmlBufPtr buf = ctxt->input->buf->buffer;
		    xmlCharEncodingHandlerPtr handler = ctxt->input->buf->encoder;
		    size_t current = ctxt->input->cur - ctxt->input->base;
		    size_t nbchars = xmlBufGetInputBase(buf, ctxt->input);
		    size_t count = 0;

		    if ((handler != NULL) && (handler->name != NULL)) {
			xmlFatalError(ctxt, XML_ERR_INVALID_ENCODING,
				"Input is not proper UTF-8, indicate encoding !\n");
			if (current > nbchars)
			    count = current - nbchars;
			xmlFatalErrMsg2(ctxt, XML_ERR_INVALID_CHAR,
				"Bytes: 0x%02X 0x%02X\n",
				((count > 0) && (nbchars < buf->use)) ?
				    buf->content[nbchars] : 0,
				((count > 1) && ((nbchars + 1) < buf->use)) ?
				    buf->content[nbchars + 1] : 0);
		    } else {
			xmlFatalError(ctxt, XML_ERR_INVALID_ENCODING,
				"Input is not proper UTF-8, no encoding indicated\n");
			if (current > nbchars)
			    count = current - nbchars;
			xmlFatalErrMsg2(ctxt, XML_ERR_INVALID_CHAR,
				"Bytes: 0x%02X 0x%02X\n",
				((count > 0) && (nbchars < buf->use)) ?
				    buf->content[nbchars] : 0,
				((count > 1) && ((nbchars + 1) < buf->use)) ?
				    buf->content[nbchars + 1] : 0);
		    }
		} else {
		    xmlFatalError(ctxt, XML_ERR_INVALID_ENCODING,
			"Input is not proper UTF-8, no encoding indicated\n");
		    xmlFatalErrMsg2(ctxt, XML_ERR_INVALID_CHAR,
			"Bytes: 0x%02X 0x%02X\n",
			(ctxt->input->cur) ? ctxt->input->cur[0] : 0,
			(ctxt->input->cur && (ctxt->input->cur + 1 < ctxt->input->end)) ?
			    ctxt->input->cur[1] : 0);
		}
		xmlHaltParser(ctxt);
		goto done;