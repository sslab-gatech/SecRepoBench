// Handle encoding errors encountered during XML parsing.
// Check if the input does not conform to UTF-8 encoding.
// Report an encoding error with details about the problematic bytes.
// Terminate the parsing process upon encountering this error.
void
encoding_error(xmlParserCtxtPtr ctxt) {
    xmlChar *ptr;
    int len;

    if (ctxt->input->cur == ctxt->input->end) {
        xmlFatalErr(ctxt, XML_ERR_INTERNAL_ERROR, "Unexpected end of input\n");
        xmlHaltParser(ctxt);
        return;
    }

    ptr = ctxt->input->cur;
    len = ctxt->input->end - ctxt->input->cur;

    xmlGenericError(xmlGenericErrorContext,
                    "encoding error: invalid UTF-8 byte sequence at offset %d\n",
                    (int)(ctxt->input->cur - ctxt->input->base));

    while (len > 0) {
        if (*ptr == 0) {
            xmlGenericError(xmlGenericErrorContext,
                            "encoding error: invalid UTF-8 byte sequence at offset %d\n",
                            (int)(ctxt->input->cur - ctxt->input->base));
            break;
        }
        ptr++;
        len--;
    }

    xmlHaltParser(ctxt);
}