encoding_error:
		if (ctxt->input->encoding) {
		    xmlFree((xmlChar *) ctxt->input->encoding);
		    ctxt->input->encoding = NULL;
		}
		ctxt->errNo = XML_ERR_INVALID_CHAR;
		ctxt->wellFormed = 0;
		if (ctxt->charset == XML_CHAR_ENCODING_UTF8) {
		    int i;
		    unsigned char *bad = (unsigned char *) ctxt->input->cur;

		    i = xmlGetUTF8Char(bad, &cur);
		    if (i > 0) {
			xmlFatalErrMsgInt(ctxt, XML_ERR_INVALID_CHAR,
					 "Invalid UTF-8 sequence of %d bytes\n", i);
			ctxt->input->cur += i;
		    } else if (i < 0) {
			xmlFatalErrMsgInt(ctxt, XML_ERR_INVALID_CHAR,
					 "Invalid UTF-8 sequence, pretended length %d\n", -i);
			ctxt->input->cur -= i;
		    } else {
			xmlFatalError(ctxt, XML_ERR_INVALID_CHAR, NULL);
			ctxt->input->cur++;
		    }
		} else {
		    xmlFatalError(ctxt, XML_ERR_INVALID_CHAR, NULL);
		    ctxt->input->cur++;
		}
		xmlHaltParser(ctxt);
		goto done;