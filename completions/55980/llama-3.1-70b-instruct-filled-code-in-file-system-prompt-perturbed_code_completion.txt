->cur < INPUT_CHUNK)) \
	xmlGROW (ctxt);

static void xmlGROW (xmlParserCtxtPtr ctxt) {
    if ((ctxt->input->buf) &&
        ((ctxt->input->buf->encoder) || (ctxt->input->buf->readcallback)))
        xmlParserInputGrow(ctxt->input, INPUT_CHUNK);
    else
        xmlParserInputBufferGrow(ctxt->input, INPUT_CHUNK);
}

#define NEXT do {							\
    if (ctxt->input->cur == ctxt->input->end)				\
        xmlParserInputGrow(ctxt->input, INPUT_CHUNK);			\
    if (ctxt->input->cur == ctxt->input->end) {				\
        xmlFatalErrMsg(ctxt, XML_ERR_INTERNAL_ERROR,			\
                       "Input buffer error");				\
        xmlHaltParser(ctxt);						\
    }									\
    if (ctxt->input->cur[0] == '&') {					\
        xmlParserHandlePEReference(ctxt);					\
    } else if (ctxt->input->cur[0] == 0x9) {				\
        ctxt->input->cur++; ctxt->input->col++;				\
    } else if (ctxt->input->cur[0] == 0xA) {				\
        ctxt->input->line++; ctxt->input->col = 1;			\
        ctxt->input->cur++;						\
    } else if (ctxt->input->cur[0] == 0xD) {				\
        if (ctxt->input->cur[1] == 0xA) {				\
            ctxt->input->line++; ctxt->input->col = 1;			\
            ctxt->input->cur += 2;					\
        } else {							\
            ctxt->input->line++; ctxt->input->col = 1;			\
            ctxt->input->cur++;						\
        }								\
    } else if (ctxt->input->cur[0] == 0xC) {				\
        ctxt->input->line++; ctxt->input->col = 1;			\
        ctxt->input->cur++;						\
    } else if (ctxt->input->cur[0] >= 0x20) {				\
        ctxt->input->cur++; ctxt->input->col++;				\
    } else {								\
        xmlFatalErrMsg(ctxt, XML_ERR_INTERNAL_ERROR,			\
                       "Input buffer error");				\
        xmlHaltParser(ctxt);						\
    }									\
} while (0)

#define NEXTL(l) do {							\
    if (ctxt->input->cur == ctxt->input->end)				\
        xmlParserInputGrow(ctxt->input, INPUT_CHUNK);			\
    if (ctxt->input->cur == ctxt->input->end) {				\
        xmlFatalErrMsg(ctxt, XML_ERR_INTERNAL_ERROR,			\
                       "Input buffer error");				\
        xmlHaltParser(ctxt);						\
    }									\
    if (ctxt->input->cur[0] == '&') {					\
        xmlParserHandlePEReference(ctxt);					\
    } else if (ctxt->input->cur[0] == 0x9) {				\
        ctxt->input->cur++; ctxt->input->col++;				\
    } else if (ctxt->input->cur[0] == 0xA) {				\
        ctxt->input->line++; ctxt->input->col = 1;			\
        ctxt->input->cur++;						\
    } else if (ctxt->input->cur[0] == 0xD) {				\
        if (ctxt->input->cur[1] == 0xA) {				\
            ctxt->input->line++; ctxt->input->col = 1;			\
            ctxt->input->cur += 2;					\
        } else {							\
            ctxt->input->line++; ctxt->input->col = 1;			\
            ctxt->input->cur++;						\
        }								\
    } else if (ctxt->input->cur[0] == 0xC) {				\
        ctxt->input->line++; ctxt->input->col = 1;			\
        ctxt->input->cur++;						\
    } else if (ctxt->input->cur[0] >= 0x20) {				\
        ctxt->input->cur++; ctxt->input->col++;				\
    } else {								\
        xmlFatalErrMsg(ctxt, XML_ERR_INTERNAL_ERROR,			\
                       "Input buffer error");				\
        xmlHaltParser(ctxt);						\
    }									\
    (l) = 1;								\
    if ((ctxt->input->cur[0] & 0x80) == 0) {				\
        if ((ctxt->input->cur[0] & 0x40) == 0) {				\
            if ((ctxt->input->cur[0] & 0x20) == 0) {			\
                if ((ctxt->input->cur[0] & 0x10) == 0) {			\
                    if ((ctxt->input->cur[0] & 0x08) == 0) {		\
                        if ((ctxt->input->cur[0] & 0x04) == 0) {		\
                            if ((ctxt->input->cur[0] & 0x02) == 0) {	\
                                if ((ctxt->input->cur[0] & 0x01) == 0) { \
                                    (l) = 1;					\
                                } else {					\
                                    (l) = 2;					\
                                    ctxt->input->cur++;			\
                                }						\
                            } else {						\
                                (l) = 3;					\
                                ctxt->input->cur += 2;			\
                            }						\
                        } else {						\
                            (l) = 4;					\
                            ctxt->input->cur += 3;			\
                        }						\
                    } else {						\
                        (l) = 5;					\
                        ctxt->input->cur += 4;			\
                    }						\
                } else {						\
                    xmlFatalErrMsg(ctxt, XML_ERR_INTERNAL_ERROR,	\
                                   "Input buffer error");		\
                    xmlHaltParser(ctxt);				\
                }							\
            } else {							\
                xmlFatalErrMsg(ctxt, XML_ERR_INTERNAL_ERROR,		\
                               "Input buffer error");			\
                xmlHaltParser(ctxt);					\
            }								\
        } else {							\
            xmlFatalErrMsg(ctxt, XML_ERR_INTERNAL_ERROR,		\
                           "Input buffer error");			\
            xmlHaltParser(ctxt);					\
        }								\
    } else {								\
        xmlFatalErrMsg(ctxt, XML_ERR_INTERNAL_ERROR,			\
                       "Input buffer error");				\
        xmlHaltParser(ctxt);						\
    }									\
} while (0)

#define CUR_CHAR(l) do {						\
    if ((ctxt->input->cur[0] & 0x80) == 0) {				\
        if ((ctxt->input->cur[0] & 0x40) == 0) {				\
            if ((ctxt->input->cur[0] & 0x20) == 0) {			\
                if ((ctxt->input->cur[0] & 0x10) == 0) {			\
                    if ((ctxt->input->cur[0] & 0x08) == 0) {		\
                        if ((ctxt->input->cur[0] & 0x04) == 0) {		\
                            if ((ctxt->input->cur[0] & 0x02) == 0) {	\
                                if ((ctxt->input->cur[0] & 0x01) == 0) { \
                                    (l) = 1;					\
                                    return(ctxt->input->cur[0]);		\
                                } else {					\
                                    (l) = 2;					\
                                    return(((ctxt->input->cur[0] & 0x1F) << 6) + \
                                           (ctxt->input->cur[1] & 0x3F));	\
                                }						\
                            } else {						\
                                (l) = 3;					\
                                return(((ctxt->input->cur[0] & 0x0F) << 12) + \
                                       ((ctxt->input->cur[1] & 0x3F) << 6) + \
                                       (ctxt->input->cur[2] & 0x3F));	\
                            }						\
                        } else {						\
                            (l) = 4;					\
                            return(((ctxt->input->cur[0] & 0x07) << 18) + \
                                   ((ctxt->input->cur[1] & 0x3F) << 12) + \
                                   ((ctxt->input->cur[2] & 0x3F) << 6) + \
                                   (ctxt->input->cur[3] & 0x3F));		\
                        }						\
                    } else {						\
                        (l) = 5;					\
                        return(((ctxt->input->cur[0] & 0x03) << 24) + \
                               ((ctxt->input->cur[1] & 0x3F) << 18) + \
                               ((ctxt->input->cur[2] & 0x3F) << 12) + \
                               ((ctxt->input->cur[3] & 0x3F) << 6) + \
                               (ctxt->input->cur[4] & 0x3F));		\
                    }						\
                } else {						\
                    xmlFatalErrMsg(ctxt, XML_ERR_INTERNAL_ERROR,	\
                                   "Input buffer error");		\
                    xmlHaltParser(ctxt);				\
                }							\
            } else {							\
                xmlFatalErrMsg(ctxt, XML_ERR_INTERNAL_ERROR,		\
                               "Input buffer error");			\
                xmlHaltParser(ctxt);					\
            }								\
        } else {							\
            xmlFatalErrMsg(ctxt, XML_ERR_INTERNAL_ERROR,		\
                           "Input buffer error");			\
            xmlHaltParser(ctxt);					\
        }								\
    } else {								\
        xmlFatalErrMsg(ctxt, XML_ERR_INTERNAL_ERROR,			\
                       "Input buffer error");				\
        xmlHaltParser(ctxt);						\
    }									\
} while (0)

#define CUR_SCHAR(l, s) do {						\
    if ((s[0] & 0x80) == 0) {					\
        if ((s[0] & 0x40) == 0) {					\
            if ((s[0] & 0x20) == 0) {				\
                if ((s[0] & 0x10) == 0) {				\
                    if ((s[0] & 0x08) == 0) {			\
                        if ((s[0] & 0x04) == 0) {			\
                            if ((s[0] & 0x02) == 0) {			\
                                if ((s[0] & 0x01) == 0) {		\
                                    (l) = 1;				\
                                    return(s[0]);			\
                                } else {				\
                                    (l) = 2;				\
                                    return(((s[0] & 0x1F) << 6) + \
                                           (s[1] & 0x3F));		\
                                }					\
                            } else {					\
                                (l) = 3;				\
                                return(((s[0] & 0x0F) << 12) + \
                                       ((s[1] & 0x3F) << 6) + \
                                       (s[2] & 0x3F));		\
                            }					\
                        } else {					\
                            (l) = 4;				\
                            return(((s[0] & 0x07) << 18) + \
                                   ((s[1] & 0x3F) << 12) + \
                                   ((s[2] & 0x3F) << 6) + \
                                   (s[3] & 0x3F));			\
                        }					\
                    } else {					\
                        (l) = 5;				\
                        return(((s[0] & 0x03) << 24) + \
                               ((s[1] & 0x3F) << 18) + \
                               ((s[2] & 0x3F) << 12) + \
                               ((s[3] & 0x3F) << 6) + \
                               (s[4] & 0x3F));			\
                    }					\
                } else {					\
                    xmlFatalErrMsg(ctxt, XML_ERR_INTERNAL_ERROR,	\
                                   "Input buffer error");		\
                    xmlHaltParser(ctxt);				\
                }							\
            } else {							\
                xmlFatalErrMsg(ctxt, XML_ERR_INTERNAL_ERROR,		\
                               "Input buffer error");			\
                xmlHaltParser(ctxt);					\
            }								\
        } else {							\
            xml