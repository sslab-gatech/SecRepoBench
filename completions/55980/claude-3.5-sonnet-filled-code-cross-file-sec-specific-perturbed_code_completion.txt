encoding_error:
    if (ctxt->input->end - ctxt->input->cur >= 4) {
        xmlChar buffer[150];
        int len;
        int c = xmlGetUTF8Char(ctxt->input->cur, &len);
        if ((c == 0) && (len == 1)) {
            xmlFatalErrMsgInt(ctxt, XML_ERR_INVALID_CHAR,
                              "Char 0x%X is not allowed in XML content\n",
                              ctxt->input->cur[0]);
        } else {
            snprintf((char *)buffer, 149, "Input is not proper UTF-8, indicate encoding !\n"
                     "Bytes: 0x%02X 0x%02X 0x%02X 0x%02X\n",
                     ctxt->input->cur[0], ctxt->input->cur[1],
                     ctxt->input->cur[2], ctxt->input->cur[3]);
            xmlFatalErrMsg(ctxt, XML_ERR_INVALID_CHAR, (const char *)buffer);
        }
    } else {
        xmlFatalErrMsg(ctxt, XML_ERR_INVALID_CHAR,
                       "Input is not proper UTF-8, indicate encoding !\n");
    }
    xmlHaltParser(ctxt);
    return(0);