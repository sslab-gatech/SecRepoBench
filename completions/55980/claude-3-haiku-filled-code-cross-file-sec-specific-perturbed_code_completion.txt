encoding_error:
    // Check if the input does not conform to UTF-8 encoding
    if (ctxt->input->buf->encoder != NULL && ctxt->input->buf->encoder->name != NULL &&
        (xmlStrcasestr(ctxt->input->buf->encoder->name, BAD_CAST "UTF-8") == NULL)) {
        // Report an encoding error with details about the problematic bytes
        int len = ctxt->input->cur - ctxt->input->base;
        xmlChar *errmsg = xmlStrdup(BAD_CAST "Encoding error: non-UTF-8 bytes found (");
        for (int i = 0; i < len && i < 10; i++) {
            char hex[3];
            sprintf(hex, "%02X", ctxt->input->base[i]);
            errmsg = xmlStrncat(errmsg, BAD_CAST hex, 2);
            if (i < len - 1)
                errmsg = xmlStrncat(errmsg, BAD_CAST " ", 1);
        }
        if (len > 10)
            errmsg = xmlStrncat(errmsg, BAD_CAST " ...", 4);
        errmsg = xmlStrncat(errmsg, BAD_CAST ").", 2);
        xmlFatalErrMsg(ctxt, XML_ERR_INVALID_ENCODING, (const char *)errmsg);
        xmlFree(errmsg);
    }
    // Terminate the parsing process upon encountering this error
    xmlHaltParser(ctxt);
    return;