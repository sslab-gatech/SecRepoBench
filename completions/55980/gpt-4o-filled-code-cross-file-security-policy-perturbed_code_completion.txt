encoding_error:
    if (ctxt->input != NULL) {
        xmlCharEncoding enc = xmlDetectCharEncoding(ctxt->input->cur, 4);
        if (enc == XML_CHAR_ENCODING_ERROR) {
            xmlFatalErrMsg(ctxt, XML_ERR_INVALID_ENCODING,
                           "Input does not conform to UTF-8 encoding\n");
        } else {
            xmlFatalErrMsg(ctxt, XML_ERR_INVALID_ENCODING,
                           "Encoding error detected\n");
        }
    } else {
        xmlFatalErrMsg(ctxt, XML_ERR_INVALID_ENCODING,
                       "Encoding error with no input available\n");
    }
    xmlHaltParser(ctxt);
    return 0;