encoding_error:
    if (ctxt->errNo == XML_ERR_INVALID_ENCODING) {
        xmlChar *msg;
        int len = ctxt->input->cur - ctxt->input->base;
        msg = xmlStrndup(ctxt->input->base, len);
        xmlFatalErr(ctxt, XML_ERR_INVALID_ENCODING,
                    "Encoding error detected: %s\n", msg);
        xmlFree(msg);
    }
    xmlHaltParser(ctxt);
    return(0);