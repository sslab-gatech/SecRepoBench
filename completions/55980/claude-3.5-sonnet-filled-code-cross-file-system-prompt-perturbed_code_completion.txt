encoding_error:
    if (ctxt->input->end - ctxt->input->cur >= 4) {
        xmlChar buffer[150];
        int len;
        int c = xmlGetUTF8Char(ctxt->input->cur, &len);
        
        if (len > 0) {
            snprintf((char *)buffer, 149, "Input is not proper UTF-8, sequence \"%.50s\" from byte %d", 
                     ctxt->input->cur, (int)(ctxt->input->cur - ctxt->input->base));
        } else {
            snprintf((char *)buffer, 149, "Input is not proper UTF-8, unexpected byte 0x%02X at byte %d", 
                     *ctxt->input->cur, (int)(ctxt->input->cur - ctxt->input->base));
        }
        xmlFatalErrMsg(ctxt, XML_ERR_INVALID_CHAR, "%s\n", buffer);
    } else {
        xmlFatalErrMsg(ctxt, XML_ERR_INVALID_CHAR, 
                       "Input is not proper UTF-8, unexpected end of input\n");
    }
    xmlHaltParser(ctxt);
    return(0);