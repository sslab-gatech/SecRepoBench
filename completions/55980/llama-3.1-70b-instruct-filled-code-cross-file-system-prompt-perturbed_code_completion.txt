// Handle encoding errors encountered during XML parsing.
// Check if the input does not conform to UTF-8 encoding.
// Report an encoding error with details about the problematic bytes.
// Terminate the parsing process upon encountering this error.
if ((parserContext->input->cur - parserContext->input->base) > XML_PARSER_BIG_BUFFER_SIZE) {
    xmlFatalErr(parserContext, XML_ERR_INTERNAL_ERROR,
                "input buffer overflow, discarding content\n");
    xmlHaltParser(parserContext);
    if ((parserContext->sax) && (parserContext->sax->endDocument!= NULL))
        parserContext->sax->endDocument(parserContext->userData);
    goto done;
}
if ((parserContext->input->end - parserContext->input->cur) < 4) {
    goto done;
}
if ((RAW == 0xFF) && (NXT(1) == 0xFE)) {
    xmlFatalErr(parserContext, XML_ERR_UNSUPPORTED_ENCODING,
                "detected encoding 'UCS-2LE', not supported\n");
    xmlHaltParser(parserContext);
    if ((parserContext->sax) && (parserContext->sax->endDocument!= NULL))
        parserContext->sax->endDocument(parserContext->userData);
    goto done;
} else if ((RAW == 0xFE) && (NXT(1) == 0xFF)) {
    xmlFatalErr(parserContext, XML_ERR_UNSUPPORTED_ENCODING,
                "detected encoding 'UCS-2BE', not supported\n");
    xmlHaltParser(parserContext);
    if ((parserContext->sax) && (parserContext->sax->endDocument!= NULL))
        parserContext->sax->endDocument(parserContext->userData);
    goto done;
} else if ((RAW == 0xEF) && (NXT(1) == 0xBB) && (NXT(2) == 0xBF)) {
    parserContext->charset = XML_CHAR_ENCODING_UTF8;
    xmlSwitchEncoding(parserContext, parserContext->charset);
    SKIPL(3);
} else if ((RAW == 0x00) && (NXT(1) == 0x00) && (NXT(2) == 0xFE) && (NXT(3) == 0xFF)) {
    xmlFatalErr(parserContext, XML_ERR_UNSUPPORTED_ENCODING,
                "detected encoding 'UCS-4BE', not supported\n");
    xmlHaltParser(parserContext);
    if ((parserContext->sax) && (parserContext->sax->endDocument!= NULL))
        parserContext->sax->endDocument(parserContext->userData);
    goto done;
} else if ((RAW == 0xFF) && (NXT(1) == 0xFE) && (NXT(2) == 0x00) && (NXT(3) == 0x00)) {
    xmlFatalErr(parserContext, XML_ERR_UNSUPPORTED_ENCODING,
                "detected encoding 'UCS-4LE', not supported\n");
    xmlHaltParser(parserContext);
    if ((parserContext->sax) && (parserContext->sax->endDocument!= NULL))
        parserContext->sax->endDocument(parserContext->userData);
    goto done;
} else if ((RAW == 0x00) && (NXT(1) == 0x3C) && (NXT(2) == 0x00) && (NXT(3) == 0x3F)) {
    xmlFatalErr(parserContext, XML_ERR_UNSUPPORTED_ENCODING,
                "detected encoding 'UCS-2BE', not supported\n");
    xmlHaltParser(parserContext);
    if ((parserContext->sax) && (parserContext->sax->endDocument!= NULL))
        parserContext->sax->endDocument(parserContext->userData);
    goto done;
} else if ((RAW == 0x3C) && (NXT(1) == 0x00) && (NXT(2) == 0x3F) && (NXT(3) == 0x00)) {
    xmlFatalErr(parserContext, XML_ERR_UNSUPPORTED_ENCODING,
                "detected encoding 'UCS-2LE', not supported\n");
    xmlHaltParser(parserContext);
    if ((parserContext->sax) && (parserContext->sax->endDocument!= NULL))
        parserContext->sax->endDocument(parserContext->userData);
    goto done;
} else if ((RAW == 0x00) && (NXT(1) == 0x00) && (NXT(2) == 0x00) && (NXT(3) == 0x3C)) {
    xmlFatalErr(parserContext, XML_ERR_UNSUPPORTED_ENCODING,
                "detected encoding 'UCS-4BE', not supported\n");
    xmlHaltParser(parserContext);
    if ((parserContext->sax) && (parserContext->sax->endDocument!= NULL))
        parserContext->sax->endDocument(parserContext->userData);
    goto done;
} else if ((RAW == 0x3C) && (NXT(1) == 0x00) && (NXT(2) == 0x00) && (NXT(3) == 0x00)) {
    xmlFatalErr(parserContext, XML_ERR_UNSUPPORTED_ENCODING,
                "detected encoding 'UCS-4LE', not supported\n");
    xmlHaltParser(parserContext);
    if ((parserContext->sax) && (parserContext->sax->endDocument!= NULL))
        parserContext->sax->endDocument(parserContext->userData);
    goto done;
} else if ((RAW == 0x4C) && (NXT(1) == 0x6F) && (NXT(2) == 0xA7) && (NXT(3) == 0x94)) {
    parserContext->charset = XML_CHAR_ENCODING_EBCDIC;
    xmlSwitchEncoding(parserContext, parserContext->charset);
    SKIPL(4);
} else {
    parserContext->charset = XML_CHAR_ENCODING_UTF8;
    xmlSwitchEncoding(parserContext, parserContext->charset);
}