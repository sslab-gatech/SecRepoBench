encoding_error:
    if (ctxt->input != NULL) {
        xmlChar badBytes[4];
        int i, len = 0;

        /* Extract up to 4 problematic bytes for error reporting */
        for (i = 0; i < 4; i++) {
            if ((ctxt->input->cur + i) < ctxt->input->end) {
                badBytes[len++] = ctxt->input->cur[i];
            } else {
                break;
            }
        }

        /* Null-terminate the byte sequence for safety */
        badBytes[len] = '\0';

        /* Report the encoding error */
        xmlFatalErrMsgStr(ctxt, XML_ERR_INVALID_ENCODING,
                          "Input is not proper UTF-8, indicate encoding! "
                          "Bytes: %.4s\n", badBytes);
    }

    /* Terminate the parsing process */
    xmlHaltParser(ctxt);
    return 0;