// Decode audio data from the bitstream based on the element type specified by the tag.
switch (tag)
{
    case ID_SCE:
        // Mono or low-frequency element
        elementInstanceTag = BitBufferReadSmall(bits, 4);
        status = DecodeMono(p, bits, sampleBuffer, channelIndex, numSamples);
        channelIndex++;
        break;
    case ID_CPE:
        // Stereo channel pair
        elementInstanceTag = BitBufferReadSmall(bits, 4);
        status = DecodeStereo(p, bits, sampleBuffer, channelIndex, numSamples);
        channelIndex += 2;
        break;
    case ID_LFE:
        // LFE channel (subwoofer)
        elementInstanceTag = BitBufferReadSmall(bits, 4);
        status = DecodeMono(p, bits, sampleBuffer, channelIndex, numSamples);
        channelIndex++;
        break;
    default:
        // Unsupported element type
        status = kALAC_UnsupportedElementType;
        goto NoMoreChannels;
}

if (status != ALAC_noErr)
{
    goto Exit;
}

p->mActiveElements++;

// Align the bitstream to byte boundaries
BitBufferByteAlign(bits, false);