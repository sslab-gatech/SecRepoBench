elementInstanceTag = BitBufferReadSmall(bits, 4);
	switch (tag)
	{
		case ID_SCE:  // Single Channel Element (Mono)
		case ID_LFE:  // Low Frequency Effects (Mono)
			// Ensure we donâ€™t write beyond the allocated channels
			if (channelIndex >= numChannels)
			{
				status = kALAC_ParamError;
				goto Exit;
			}
			// Decode a mono channel into the appropriate portion of the sample buffer.
			status = DecodeMono(p, bits, sampleBuffer + channelIndex, numSamples);
			if (status != ALAC_noErr)
				goto Exit;
			p->mActiveElements++;
			channelIndex++;
			break;

		case ID_CPE:  // Channel Pair Element (Stereo)
			// Ensure we have room for both channels
			if (channelIndex + 1 >= numChannels)
			{
				status = kALAC_ParamError;
				goto Exit;
			}
			// Decode a stereo channel pair into the sample buffer starting at channelIndex.
			status = DecodeStereo(p, bits, sampleBuffer + channelIndex, numSamples);
			if (status != ALAC_noErr)
				goto Exit;
			p->mActiveElements++;
			channelIndex += 2;
			break;

		case ID_FILL:
			{
				// Skip fill element: the 4-bit element instance tag was already read.
				// Assume next 8 bits indicate the number of bits to skip.
				uint8_t fillLength = BitBufferReadSmall(bits, 8);
				// Verify that the requested skip does not exceed the available bits.
				uint32_t availableBits = ((uint32_t)(bits->end - bits->cur) * 8) - bits->bitIndex;
				if (fillLength > availableBits)
				{
					status = kALAC_ParamError;
					goto Exit;
				}
				BitBufferSkip(bits, fillLength);
			}
			break;

		case ID_END:
			// End tag indicates no more elements.
			goto NoMoreChannels;

		default:
			status = kALAC_ParamError;
			goto Exit;
	}