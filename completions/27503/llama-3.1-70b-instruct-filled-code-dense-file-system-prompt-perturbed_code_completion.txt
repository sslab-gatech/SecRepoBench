// Decode audio data from the bitstream based on the element type specified by the tag.
// For mono or low-frequency elements, read and process header parameters, handling both compressed and uncompressed frames.
// For compressed frames, decompress data and apply prediction to reconstruct the audio samples.
// For stereo channel pairs, ensure channel limit is not exceeded and process each channel separately, similar to mono elements.
// Handle special cases such as partial frames and shifted values, reading them into appropriate buffers.
// For unsupported elements, set the status to indicate unsupported operations and ignore any fill elements.
// Finally, align the bitstream to byte boundaries and exit once all channels are processed or the frame end is reached.

switch (tag)
{
    case ID_SCE:
        // mono
        elementInstanceTag = BitBufferReadSmall (bits, 4) ;

        status = DecodeMono (p, bits, sampleBuffer, numSamples, channelIndex) ;
        RequireNoErr (status, break ;) ;

        channelIndex++ ;
        break ;

    case ID_CPE:
        // stereo
        elementInstanceTag = BitBufferReadSmall (bits, 4) ;

        // ensure channel limit is not exceeded
        RequireAction (channelIndex + 2 <= numChannels, status = kALAC_ParamError ; break ;) ;

        status = DecodeStereo (p, bits, sampleBuffer, numSamples, channelIndex) ;
        RequireNoErr (status, break ;) ;

        channelIndex += 2 ;
        break ;

    case ID_LFE:
        // LFE channel (subwoofer)
        elementInstanceTag = BitBufferReadSmall (bits, 4) ;

        status = DecodeMono (p, bits, sampleBuffer, numSamples, channelIndex) ;
        RequireNoErr (status, break ;) ;

        channelIndex++ ;
        break ;

    case ID_FIL:
        // fill element
        status = alac_data_stream_element (bits) ;
        RequireNoErr (status, break ;) ;
        break ;

    case ID_END:
        // end of frame
        status = ALAC_noErr ;
        goto Exit ;
        break ;

    default:
        // unsupported element
        status = kALAC_UnsupportedElement ;
        break ;
}

// byte-align the bitstream
BitBufferByteAlign (bits, true) ;