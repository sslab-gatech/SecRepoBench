switch (tag)
		{
			case kALAC_DataElement:
				status = alac_data_stream_element (bits) ;
				break ;

			case kALAC_FillElement:
				status = alac_fill_element (bits) ;
				break ;

			case kALAC_MonoAudioElement:
			case kALAC_LowFrequencyAudioElement:
				// read header
				headerByte = BitBufferReadSmall (bits, 8) ;
				partialFrame = (headerByte >> 7) & 0x01 ;
				extraBits = (headerByte >> 4) & 0x07 ;
				escapeFlag = (headerByte >> 3) & 0x01 ;
				mixBits = headerByte & 0x07 ;

				// read the number of coefficients
				numU = BitBufferReadSmall (bits, 5) ;
				numV = BitBufferReadSmall (bits, 5) ;

				// read the predictor modes
				modeU = BitBufferReadSmall (bits, 2) ;
				modeV = BitBufferReadSmall (bits, 2) ;

				// read the denominator shifts
				denShiftU = BitBufferReadSmall (bits, 4) ;
				denShiftV = BitBufferReadSmall (bits, 4) ;

				// read the predictor factors
				pbFactorU = BitBufferReadSmall (bits, 16) ;
				pbFactorV = BitBufferReadSmall (bits, 16) ;

				// read the coefficients
				for (i = 0 ; i < numU ; i++)
					coefsU [i] = (int16_t) BitBufferReadSmall (bits, 16) ;
				for (i = 0 ; i < numV ; i++)
					coefsV [i] = (int16_t) BitBufferReadSmall (bits, 16) ;

				// read the mix residual
				mixResiduals = (int8_t) BitBufferReadSmall (bits, mixBits) ;

				// read the unused header
				unusedHeader = BitBufferReadSmall (bits, 16) ;

				// set up the predictor parameters
				agParams.mode = modeU ;
				agParams.denShift = denShiftU ;
				agParams.pbFactor = pbFactorU ;
				agParams.coefs = coefsU ;
				agParams.numCoefs = numU ;

				// decode the samples
				out32 = sampleBuffer + channelIndex ;
				for (i = 0 ; i < numSamples ; i++)
				{
					// decode the sample
					val = alac_decode_sample (bits, &agParams, escapeFlag, extraBits, pb) ;

					// apply the mix residual
					val += mixResiduals ;

					// write the sample
					out32 [i * numChannels] = val ;
				}

				channelIndex++ ;
				break ;

			case kALAC_StereoAudioElement:
				// read header
				headerByte = BitBufferReadSmall (bits, 8) ;
				partialFrame = (headerByte >> 7) & 0x01 ;
				extraBits = (headerByte >> 4) & 0x07 ;
				escapeFlag = (headerByte >> 3) & 0x01 ;
				mixBits = headerByte & 0x07 ;

				// read the number of coefficients
				numU = BitBufferReadSmall (bits, 5) ;
				numV = BitBufferReadSmall (bits, 5) ;

				// read the predictor modes
				modeU = BitBufferReadSmall (bits, 2) ;
				modeV = BitBufferReadSmall (bits, 2) ;

				// read the denominator shifts
				denShiftU = BitBufferReadSmall (bits, 4) ;
				denShiftV = BitBufferReadSmall (bits, 4) ;

				// read the predictor factors
				pbFactorU = BitBufferReadSmall (bits, 16) ;
				pbFactorV = BitBufferReadSmall (bits, 16) ;

				// read the coefficients
				for (i = 0 ; i < numU ; i++)
					coefsU [i] = (int16_t) BitBufferReadSmall (bits, 16) ;
				for (i = 0 ; i < numV ; i++)
					coefsV [i] = (int16_t) BitBufferReadSmall (bits, 16) ;

				// read the mix residual
				mixResiduals = (int8_t) BitBufferReadSmall (bits, mixBits) ;

				// read the unused header
				unusedHeader = BitBufferReadSmall (bits, 16) ;

				// set up the predictor parameters
				agParams.mode = modeU ;
				agParams.denShift = denShiftU ;
				agParams.pbFactor = pbFactorU ;
				agParams.coefs = coefsU ;
				agParams.numCoefs = numU ;

				// decode the samples
				out32 = sampleBuffer + channelIndex ;
				for (i = 0 ; i < numSamples ; i++)
				{
					// decode the sample
					val = alac_decode_sample (bits, &agParams, escapeFlag, extraBits, pb) ;

					// apply the mix residual
					val += mixResiduals ;

					// write the sample
					out32 [i * numChannels] = val ;
				}

				channelIndex++ ;
				break ;

			default:
				status = kALAC_UnsupportedOperation ;
				break ;
		}

		if (channelIndex >= numChannels)
			goto NoMoreChannels ;