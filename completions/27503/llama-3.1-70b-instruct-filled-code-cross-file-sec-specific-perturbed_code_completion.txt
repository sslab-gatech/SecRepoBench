// decode audio data from the bitstream based on the element type specified by the tag
switch (tag)
{
    case ID_SCE:
        // decode mono channel
        status = DecodeMono (p, bits, sampleBuffer, numSamples, channelIndex, &agParams, &chanBits, &bytesShifted, &partialFrame) ;
        break ;

    case ID_CPE:
        // decode stereo channel pair
        status = DecodeStereo (p, bits, sampleBuffer, numSamples, channelIndex, &agParams, &chanBits, &bytesShifted, &partialFrame) ;
        break ;

    case ID_LFE:
        // decode LFE channel (subwoofer)
        status = DecodeMono (p, bits, sampleBuffer, numSamples, channelIndex, &agParams, &chanBits, &bytesShifted, &partialFrame) ;
        break ;

    case ID_FIL:
        // ignore fill element
        status = ALAC_noErr ;
        break ;

    case ID_END:
        // end of frame
        status = ALAC_noErr ;
        goto Exit ;

    default:
        // unsupported element
        status = kALAC_UnsupportedElement ;
        break ;
}

RequireNoErr (status, goto Exit ;) ;

// align bitstream to byte boundaries
BitBufferByteAlign (bits, true) ;

// check if we've reached the end of the frame
if (tag == ID_END)
    break ;

// increment channel index
channelIndex++ ;

// check if we've processed all channels
if (channelIndex >= numChannels)
    break ;