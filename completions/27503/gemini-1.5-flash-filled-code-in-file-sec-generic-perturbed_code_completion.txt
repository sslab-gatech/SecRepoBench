switch (tag)
		{
			case kALAC_DataElement:
				status = alac_data_stream_element (bits) ;
				break ;

			case kALAC_FillElement:
				status = alac_fill_element (bits) ;
				break ;

			case kALAC_MonoAudioElement:
			case kALAC_LowFrequencyAudioElement:
				// read header
				headerByte = BitBufferReadSmall (bits, 8) ;
				partialFrame = (headerByte >> 7) & 0x01 ;
				escapeFlag = (headerByte >> 6) & 0x01 ;
				mixBits = (headerByte >> 4) & 0x03 ;
				mixResiduals = (int8_t) ((headerByte >> 2) & 0x03) ;
				modeU = headerByte & 0x03 ;

				// read predictor coefs
				numU = BitBufferReadSmall (bits, 5) ;
				for (i = 0 ; i < numU ; i++)
					coefsU [i] = (int16_t) BitBufferReadSmall (bits, 16) ;

				// read predictor coefs
				numV = BitBufferReadSmall (bits, 5) ;
				for (i = 0 ; i < numV ; i++)
					coefsV [i] = (int16_t) BitBufferReadSmall (bits, 16) ;

				// read unused header
				unusedHeader = BitBufferReadSmall (bits, 16) ;

				// read channel bits
				chanBits = BitBufferReadSmall (bits, 16) ;

				// read shift
				shift = BitBufferReadSmall (bits, 4) ;

				// read denormalization shift
				denShiftU = BitBufferReadSmall (bits, 4) ;
				denShiftV = BitBufferReadSmall (bits, 4) ;

				// read pb factor
				pbFactorU = BitBufferReadSmall (bits, 16) ;
				pbFactorV = BitBufferReadSmall (bits, 16) ;

				// set up predictor params
				agParams.pb = pb ;
				agParams.mb = p->mConfig.mb ;
				agParams.kb = p->mConfig.kb ;
				agParams.maxRun = p->mConfig.maxRun ;
				agParams.coefsU = coefsU ;
				agParams.coefsV = coefsV ;
				agParams.numU = numU ;
				agParams.numV = numV ;
				agParams.mixBits = mixBits ;
				agParams.mixResiduals = mixResiduals ;
				agParams.modeU = modeU ;
				agParams.modeV = 0 ;
				agParams.denShiftU = denShiftU ;
				agParams.denShiftV = denShiftV ;
				agParams.pbFactorU = pbFactorU ;
				agParams.pbFactorV = pbFactorV ;

				// decode samples
				out32 = sampleBuffer + channelIndex ;
				for (i = 0 ; i < numSamples ; i++)
				{
					val = alac_decode_sample (bits, &agParams, &shiftBits, &bytesShifted, &extraBits, escapeFlag, partialFrame) ;
					*out32 = val ;
					out32 += numChannels ;
				}

				// byte align
				BitBufferByteAlign (bits, false) ;
				break ;

			case kALAC_StereoAudioElement:
				// read header
				headerByte = BitBufferReadSmall (bits, 8) ;
				partialFrame = (headerByte >> 7) & 0x01 ;
				escapeFlag = (headerByte >> 6) & 0x01 ;
				mixBits = (headerByte >> 4) & 0x03 ;
				mixResiduals = (int8_t) ((headerByte >> 2) & 0x03) ;
				modeU = headerByte & 0x03 ;
				modeV = (headerByte >> 1) & 0x01 ;

				// read predictor coefs
				numU = BitBufferReadSmall (bits, 5) ;
				for (i = 0 ; i < numU ; i++)
					coefsU [i] = (int16_t) BitBufferReadSmall (bits, 16) ;

				// read predictor coefs
				numV = BitBufferReadSmall (bits, 5) ;
				for (i = 0 ; i < numV ; i++)
					coefsV [i] = (int16_t) BitBufferReadSmall (bits, 16) ;

				// read unused header
				unusedHeader = BitBufferReadSmall (bits, 16) ;

				// read channel bits
				chanBits = BitBufferReadSmall (bits, 16) ;

				// read shift
				shift = BitBufferReadSmall (bits, 4) ;

				// read denormalization shift
				denShiftU = BitBufferReadSmall (bits, 4) ;
				denShiftV = BitBufferReadSmall (bits, 4) ;

				// read pb factor
				pbFactorU = BitBufferReadSmall (bits, 16) ;
				pbFactorV = BitBufferReadSmall (bits, 16) ;

				// set up predictor params
				agParams.pb = pb ;
				agParams.mb = p->mConfig.mb ;
				agParams.kb = p->mConfig.kb ;
				agParams.maxRun = p->mConfig.maxRun ;
				agParams.coefsU = coefsU ;
				agParams.coefsV = coefsV ;
				agParams.numU = numU ;
				agParams.numV = numV ;
				agParams.mixBits = mixBits ;
				agParams.mixResiduals = mixResiduals ;
				agParams.modeU = modeU ;
				agParams.modeV = modeV ;
				agParams.denShiftU = denShiftU ;
				agParams.denShiftV = denShiftV ;
				agParams.pbFactorU = pbFactorU ;
				agParams.pbFactorV = pbFactorV ;

				// decode samples
				out32 = sampleBuffer + channelIndex ;
				for (i = 0 ; i < numSamples ; i++)
				{
					val = alac_decode_sample (bits, &agParams, &shiftBits, &bytesShifted, &extraBits, escapeFlag, partialFrame) ;
					*out32 = val ;
					out32 += numChannels ;
				}

				// byte align
				BitBufferByteAlign (bits, false) ;
				channelIndex++ ;

				// check for more channels
				if (channelIndex < numChannels)
					goto NoMoreChannels ;
				break ;

			default:
				status = kALAC_UnsupportedOperation ;
				break ;
		}

		channelIndex++ ;
		if (channelIndex >= numChannels)
			break ;