// Decode audio data from the bitstream based on the element type specified by the tag.
switch (tag)
{
    case ID_SCE:
        // mono
        status = DecodeMono(p, bits, sampleBuffer + channelIndex, numSamples, &bytesShifted);
        channelIndex++;
        break;
    case ID_CPE:
        // stereo
        status = DecodeStereo(p, bits, sampleBuffer + channelIndex, numSamples, &bytesShifted);
        channelIndex += 2;
        break;
    case ID_LFE:
        // LFE channel (subwoofer)
        status = DecodeMono(p, bits, sampleBuffer + channelIndex, numSamples, &bytesShifted);
        channelIndex++;
        break;
    default:
        // Unsupported element type
        status = kALAC_UnsupportedElementType;
        goto NoMoreChannels;
}

if (status != ALAC_noErr)
    goto Exit;

// Align the bitstream to byte boundaries
BitBufferByteAlign(bits, false);

// Check if all channels have been processed
if (channelIndex >= numChannels)
    break;