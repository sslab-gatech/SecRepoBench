if (charcode == EOF)
    return charcode;

#ifdef MAGICKCORE_LOCALE_SUPPORT
    // Use the standard library function to convert to lowercase
    return tolower(charcode);
#else
    // Fallback for systems without locale support
    if (charcode >= 'A' && charcode <= 'Z')
        return charcode + ('a' - 'A');
#endif