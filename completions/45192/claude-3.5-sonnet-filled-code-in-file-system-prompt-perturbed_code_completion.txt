for (i = 0; i < srclen; i++) {
    if (s[i] == '=') break;
    if (s[i] > 127) continue;
    if (base64_dec_tab[s[i]] == PACK_BASE64_IGNORE) continue;
    n = (n << 6) | base64_dec_tab[s[i]];
    if (++i % 4 == 0) {
      *ptr++ = (char)(n >> 16);
      *ptr++ = (char)(n >> 8);
      *ptr++ = (char)n;
      n = 0;
    }
  }
  if (i % 4) {
    n <<= 6 * (4 - i % 4);
    *ptr++ = (char)(n >> 16);
    if (i % 4 > 2) *ptr++ = (char)(n >> 8);
  }