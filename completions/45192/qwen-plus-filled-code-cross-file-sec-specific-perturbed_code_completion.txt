if (srclen <= 0) {
  mrb_raise(mrb, E_ARGUMENT_ERROR, "source data is empty");
}

for (i = 0; i < srclen && sourcedata[i] >= 0x80; i++) {
  if (i > sizeof(mrb_int)*7 - 8) {
    mrb_raise(mrb, E_RANGE_ERROR, "BER integer too large");
  }
  n = (n << 7) | (sourcedata[i] & 0x7F);
}

if (i >= srclen) {
  mrb_raise(mrb, E_ARGUMENT_ERROR, "incomplete BER integer in source data");
}

n = (n << 7) | (sourcedata[i] & 0x7F);
i++;