if (srclen == 0) {
  mrb_raise(mrb, E_ARGUMENT_ERROR, "source data is empty");
}

for (i = 0; i < srclen; i++) {
  unsigned char byte = sourcedata[i];
  n = (n << 7) | (byte & 0x7f);
  if ((byte & 0x80) == 0) {
    break;
  }
}

if (i == srclen && (sourcedata[i-1] & 0x80) != 0) {
  mrb_raise(mrb, E_ARGUMENT_ERROR, "incomplete BER integer");
}