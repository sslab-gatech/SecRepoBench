if (srclen == 0) {
  mrb_raise(mrb, E_ARGUMENT_ERROR, "empty input");
}

i = 0;
while (i < srclen) {
  unsigned char c = sourcedata[i++];
  n = (n << 7) + (c & 0x7f);
  if ((c & 0x80) == 0) {
    break;
  }
}