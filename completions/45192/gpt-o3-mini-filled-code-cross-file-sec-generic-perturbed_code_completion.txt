{
  int finished = 0;
  for (i = 0; i < srclen; i++) {
    unsigned char byte = sourcedata[i];
    /* Check for overflow before shifting */
    if (n > ((mrb_int)~0 >> 7)) {
      mrb_raise(mrb, E_RANGE_ERROR, "BER integer overflow");
    }
    n = (n << 7) | (byte & 0x7F);
    if ((byte & 0x80) == 0) {
      finished = 1;
      i++;  /* advance i to point past the final byte read */
      break;
    }
  }
  if (!finished) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "incomplete BER integer");
  }
}