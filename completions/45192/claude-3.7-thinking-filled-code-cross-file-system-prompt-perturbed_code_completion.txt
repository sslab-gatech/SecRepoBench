i = 0;
  n = 0;
  while (i < srclen) {
    unsigned char b = sourcedata[i++];
    n = (n << 7) | (b & 0x7f);
    if (!(b & 0x80)) {
      break;  // End of BER-encoded integer
    }
  }

  // Check if we ran out of bytes but the BER integer is incomplete
  if (i == srclen && (sourcedata[i-1] & 0x80)) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "invalid BER format");
  }