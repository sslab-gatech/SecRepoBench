static int
unpack_BER(mrb_state *mrb, const unsigned char *sourcedata, int srclen, mrb_value ary, unsigned int flags)
{
  mrb_int i, n = 0;
  // This code block is responsible for unpacking a BER-compressed integer from a byte array.
  // Each byte in the source data contributes 7 bits to the final value, with the 8th bit indicating if
  // more bytes follow. If a byte's 8th bit is clear, the value is complete. The code raises an
  // exception if the integer is invalid.
  // <MASK>
  if (srclen == 0) {
    mrb_raisef(mrb, E_ARGUMENT_ERROR, "BER-compressed integer is empty");
  }
  for (i = 0; i < srclen; i++) {
    n = (n << 7) | (sourcedata[i] & 0x7f);
    if ((sourcedata[i] & 0x80) == 0) {
      break;
    }
  }
  if (flags & PACK_FLAG_SIGNED) {
    if (n >= 0x80000000) {
      n -= 0x100000000;
    }
  }
  mrb_ary_push(mrb, ary, mrb_int_value(mrb, n));
  return i;
}