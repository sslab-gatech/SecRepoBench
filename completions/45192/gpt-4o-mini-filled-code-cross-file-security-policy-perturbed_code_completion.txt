if (srclen <= 0) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "input length must be greater than zero");
}

for (i = 0; i < srclen; i++) {
    n = (n << 7) | (sourcedata[i] & 0x7F);
    if ((sourcedata[i] & 0x80) == 0) {
        break; // Stop if the 8th bit is clear
    }
}