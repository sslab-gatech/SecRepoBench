while (srcidx < srclen) {
    mrb_int x = 0;
    unsigned char byte = *(sourcedata + srcidx++);
    x = byte & 0x7F; // Get the 7 bits

    // Check if the 8th bit is set, indicating more bytes follow
    if (!(byte & 0x80)) {
      n = x; // If not, we are done
      break;
    }

    // If the 8th bit is set, continue to the next byte
    if (srcidx >= srclen) {
      mrb_raise(mrb, E_ARGUMENT_ERROR, "incomplete BER data");
    }
  }

  if (n < 0) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "invalid BER integer");
  }