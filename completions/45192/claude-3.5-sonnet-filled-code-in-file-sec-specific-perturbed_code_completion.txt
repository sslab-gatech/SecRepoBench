for (i = 0; i < srclen; i++) {
    if (s[i] == '=') break;
    if (s[i] >= sizeof(base64_dec_tab)) continue;
    n = base64_dec_tab[(int)s[i]];
    if (n == PACK_BASE64_IGNORE) continue;
    if (n == PACK_BASE64_PADDING) break;
    n <<= 18 - 6 * i % 4;
    switch (i % 4) {
      case 0:
      case 1:
        break;
      case 2:
        if (i + 1 < srclen && s[i+1] != '=') break;
        n >>= 8;
        *ptr++ = (char)n;
        goto done;
      case 3:
        n >>= 16;
        *ptr++ = (char)(n >> 8);
        *ptr++ = (char)n;
        goto done;
    }
  }
done: