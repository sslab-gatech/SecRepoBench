{
    // Handle error recovery for loops by cleaning up loop variables
    int var_frame = _yr_compiler_get_var_frame(compiler);

    // Reset the loop depth to zero
    compiler->loop_depth = 0;

    // Cleanup all loop variables associated with the current context
    loop_vars_cleanup(-1);

    // Initialize the frame for local variables in the current loop context
    // Set up necessary variables and ensure that loop nesting limits are respected.
    if (compiler->loop_for_of_var_index != -1)
    {
        compiler->loop_for_of_var_index = -1;
    }

    // Ensure the stack is properly aligned after cleanup
    fail_if_error(yr_parser_emit_with_arg(
        yyscanner, OP_CLEAR_M, var_frame + 3, NULL, NULL));

    // Ensure no lingering fixups cause issues
    while (compiler->fixup_stack_head != NULL)
    {
        YR_FIXUP* fixup = compiler->fixup_stack_head;
        compiler->fixup_stack_head = fixup->next;
        yr_free(fixup);
    }
}