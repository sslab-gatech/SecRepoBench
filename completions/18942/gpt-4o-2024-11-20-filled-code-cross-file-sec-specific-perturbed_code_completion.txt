{
    // Ensure loop depth is within allowed limits
    if (compiler->loop_depth >= YR_MAX_LOOP_NESTING)
    {
        yr_compiler_set_error_extra_info(compiler, "loop nesting limit exceeded");
        fail_if_error(ERROR_LOOP_NESTING_LIMIT_EXCEEDED);
    }

    // Cleanup loop variables for the current loop depth
    for (int i = 0; i < compiler->loop[compiler->loop_depth].vars_count; i++)
    {
        yr_free(compiler->loop[compiler->loop_depth].vars[i].identifier);
        compiler->loop[compiler->loop_depth].vars[i].identifier = NULL;
    }

    // Reset loop variables count and internal variables count
    compiler->loop[compiler->loop_depth].vars_count = 0;
    compiler->loop[compiler->loop_depth].vars_internal_count = 0;

    // Reset loop depth to zero to ensure proper cleanup
    compiler->loop_depth = 0;
}