{
    // Ensure proper cleanup of loop variables in case of an error.
    while (compiler->loop_depth > 0)
    {
        compiler->loop_depth--;
        loop_vars_cleanup(compiler->loop_depth);
    }

    // Reset loop depth to zero to ensure no lingering state.
    compiler->loop_depth = 0;

    // Initialize the frame for local variables in the current loop context.
    int var_frame = _yr_compiler_get_var_frame(compiler);

    // Ensure that the loop nesting limits are respected.
    if (compiler->loop_for_of_var_index != -1)
    {
        yr_compiler_set_error_extra_info(compiler, "nested for-of loop not allowed");
        fail_if_error(ERROR_NESTED_FOR_OF_LOOP);
    }

    // Additional initialization for local variables if necessary.
    memset(&compiler->loop[compiler->loop_depth], 0, sizeof(YR_LOOP_CONTEXT));
    compiler->loop[compiler->loop_depth].vars_internal_count = 3; // Reserve slots for internal variables.
}