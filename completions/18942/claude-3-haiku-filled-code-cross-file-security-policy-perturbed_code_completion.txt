// Handle error recovery for loops by cleaning up loop variables
// and resetting the loop depth to zero. If an error occurs while
// parsing an inner loop, the cleanup will propagate to the outer
// loops. This ensures that all resources associated with loop
// variables are properly released before handling the error.
// Additionally, initialize the frame for local variables in the
// current loop context, setting up necessary variables and ensuring
// that loop nesting limits are respected.
for (int i = 0; i < compiler->loop_depth; i++)
{
  loop_vars_cleanup(i);
}

compiler->loop_depth = 0;

int var_frame = _yr_compiler_get_var_frame(compiler);

for (int i = 0; i < compiler->loop[compiler->loop_depth].vars_internal_count; i++)
{
  fail_if_error(yr_parser_emit_with_arg(
      yyscanner, OP_CLEAR_M, var_frame + i, NULL, NULL));
}

compiler->loop[compiler->loop_depth].vars_internal_count = 0;
compiler->loop[compiler->loop_depth].vars_count = 0;