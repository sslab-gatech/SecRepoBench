{
    // Ensure loop index is within safe bounds
    int max_loop_vars = min(YR_MAX_LOOP_VARS, compiler->loop[compiler->loop_depth].vars_count);

    // Clean up loop variables
    for (int i = 0; i < max_loop_vars; i++)
    {
        yr_free(compiler->loop[compiler->loop_depth].vars[i].identifier);
        compiler->loop[compiler->loop_depth].vars[i].identifier = NULL;
    }

    // Reset loop depth to zero
    compiler->loop_depth = 0;

    // Initialize the frame for local variables in the current loop context
    int var_frame = _yr_compiler_get_var_frame(compiler);

    // Set up necessary variables and ensure loop nesting limits are respected
    yr_parser_emit_with_arg(yyscanner, OP_CLEAR_M, var_frame + 0, NULL, NULL);
    yr_parser_emit_with_arg(yyscanner, OP_CLEAR_M, var_frame + 1, NULL, NULL);
    yr_parser_emit_with_arg(yyscanner, OP_CLEAR_M, var_frame + 2, NULL, NULL);
}