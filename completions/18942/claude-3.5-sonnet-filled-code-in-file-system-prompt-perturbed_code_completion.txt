{
  int var_frame = _yr_compiler_get_var_frame(compiler);

  // Initialize the frame for local variables in the current loop context
  YR_LOOP_CONTEXT* loop_ctx = &compiler->loop[compiler->loop_depth];
  loop_ctx->vars_count = 0;
  loop_ctx->vars_internal_count = 0;

  // Set up the loop start address
  fail_if_error(yr_parser_emit(yyscanner, OP_ITER_START, &loop_ctx->start_addr));

  // Push a new fixup entry for the loop's end jump
  YR_FIXUP* fixup = (YR_FIXUP*) yr_malloc(sizeof(YR_FIXUP));
  if (fixup == NULL)
    fail_if_error(ERROR_INSUFFICIENT_MEMORY);

  fixup->address = NULL;
  fixup->next = compiler->fixup_stack_head;
  compiler->fixup_stack_head = fixup;

  // Increment the loop depth
  compiler->loop_depth++;

  // Check if we've exceeded the maximum loop nesting depth
  if (compiler->loop_depth > YR_MAX_LOOP_NESTING)
    fail_if_error(ERROR_LOOP_NESTING_LIMIT_EXCEEDED);

  // Clear the loop iteration and total counters
  fail_if_error(yr_parser_emit_with_arg(yyscanner, OP_CLEAR_M, var_frame + 1, NULL, NULL));
  fail_if_error(yr_parser_emit_with_arg(yyscanner, OP_CLEAR_M, var_frame + 2, NULL, NULL));
}