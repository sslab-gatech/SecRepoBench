{
  int parseresult = ERROR_SUCCESS;
  
  // First check if we're at the maximum loop nesting depth
  if (compiler->loop_depth >= YR_MAX_LOOP_NESTING)
    parseresult = ERROR_LOOP_NESTING_LIMIT_EXCEEDED;
  
  fail_if_error(parseresult);
  
  // Get the variable frame for the current loop context
  int var_frame = _yr_compiler_get_var_frame(compiler);
  
  // Initialize the loop context for the current nesting level
  YR_LOOP_CONTEXT* loop_ctx = &compiler->loop[compiler->loop_depth];
  
  // Reset the loop context variables
  loop_ctx->vars_count = 0;
  loop_ctx->vars_internal_count = 3; // Standard internal variables
  loop_ctx->addr = NULL;
  
  // Clear the internal variables in the frame
  yr_parser_emit_with_arg(
      yyscanner, OP_CLEAR_M, var_frame, NULL, NULL);
  
  yr_parser_emit_with_arg(
      yyscanner, OP_CLEAR_M, var_frame + 1, NULL, NULL);
  
  yr_parser_emit_with_arg(
      yyscanner, OP_CLEAR_M, var_frame + 2, NULL, NULL);
  
  // Not a for-of loop
  compiler->loop_for_of_var_index = -1;
  
  // Increment the loop depth to enter the new loop
  compiler->loop_depth++;
}