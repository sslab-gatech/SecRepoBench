{
  /*
   * If an error occurs during the parsing of a loop, especially within
   * nested loops, we need to clean up all loop variables (both for the
   * inner and outer loops) before handling the error. This ensures that
   * all resources allocated for loop variables are properly released and
   * avoids leaks or inconsistent parser state.
   *
   * We do this by walking back through all active loops (up to the current
   * compiler->loop_depth) and cleaning up each loop's variables with
   * loop_vars_cleanup(...). We then reset compiler->loop_depth to 0 to
   * indicate we've exited all loop contexts and set loop_for_of_var_index
   * to -1 to avoid dangling references to 'for ... of' loop variables.
   */

  while (compiler->loop_depth > 0)
  {
    compiler->loop_depth--;
    loop_vars_cleanup(compiler->loop_depth);
  }

  compiler->loop_for_of_var_index = -1;
}