image->colors,
          colormap_size*sizeof(*colormap));
        if (colormap == (unsigned char *) NULL)
          ThrowWriterException(ResourceLimitError,"MemoryAllocationFailed");
        for (i=0; i < (ssize_t) image->colors; i++)
        {
          colormap[i*3]=(unsigned char)
            ScaleQuantumToChar(image->colormap[i].red);
          colormap[i*3+1]=(unsigned char)
            ScaleQuantumToChar(image->colormap[i].green);
          colormap[i*3+2]=(unsigned char)
            ScaleQuantumToChar(image->colormap[i].blue);
        }
        (void) WriteBlob(image,image->colors*colormap_size,colormap);
        colormap=(unsigned char *) RelinquishMagickMemory(colormap);
      }
    else
      {
        /*
          Write image pixels.
        */
        pixels=GetImagePixels(image,0,0,image->columns,image->rows,quantum_info,
          exception);
        if (pixels == (unsigned char *) NULL)
          ThrowWriterException(ResourceLimitError,"MemoryAllocationFailed");
        switch (quantum_info->format)
        {
          case FloatingPointQuantumFormat:
          {
            double
              *p;

            p=pixels;
            for (y=0; y < (ssize_t) image->rows; y++)
            {
              for (i=0; i < (ssize_t) image->columns; i++)
              {
                SetPixelRed(image,ClampToQuantum(*p++),pixels);
                SetPixelGreen(image,ClampToQuantum(*p++),pixels);
                SetPixelBlue(image,ClampToQuantum(*p++),pixels);
                if (image->alpha_trait != UndefinedPixelTrait)
                  SetPixelAlpha(image,ClampToQuantum(*p++),pixels);
                pixels+=GetPixelChannels(image);
              }
            }
            break;
          }
          case SignedQuantumFormat:
          {
            signed short
              *p;

            p=pixels;
            for (y=0; y < (ssize_t) image->rows; y++)
            {
              for (i=0; i < (ssize_t) image->columns; i++)
              {
                SetPixelRed(image,ClampToQuantum(*p++),pixels);
                SetPixelGreen(image,ClampToQuantum(*p++),pixels);
                SetPixelBlue(image,ClampToQuantum(*p++),pixels);
                if (image->alpha_trait != UndefinedPixelTrait)
                  SetPixelAlpha(image,ClampToQuantum(*p++),pixels);
                pixels+=GetPixelChannels(image);
              }
            }
            break;
          }
          case UndefinedQuantumFormat:
          case GrayQuantumFormat:
          case RGBQuantumFormat:
          case RGBAQuantumFormat:
          case CMYKQuantumFormat:
          case CMYKAQuantumFormat:
          case HSLQuantumFormat:
          case HSLAQuantumFormat:
          case HWBQuantumFormat:
          case LABQuantumFormat:
          case LCHQuantumFormat:
          case LogQuantumFormat:
          case XYZQuantumFormat:
          case YXYQuantumFormat:
          case YCbCrQuantumFormat:
          case YCCQuantumFormat:
          case YDbDrQuantumFormat:
          case YUVQuantumFormat:
          case V210QuantumFormat:
          case V308QuantumFormat:
          case V408QuantumFormat:
          case YUV9QuantumFormat:
          case YUV12QuantumFormat:
          case YUV16QuantumFormat:
          case YUV444QuantumFormat:
          case YUV422QuantumFormat:
          case YUV411QuantumFormat:
          case YUV420QuantumFormat:
          case YUV440QuantumFormat:
          case YUV410QuantumFormat:
          case YUV422PLANARQuantumFormat:
          case YUV411PLANARQuantumFormat:
          case YUV420PLANARQuantumFormat:
          case YUV444PLANARQuantumFormat:
          case YUV422INTERLEAVEDQuantumFormat:
          case YUV411INTERLEAVEDQuantumFormat:
          case YUV420INTERLEAVEDQuantumFormat:
          case YUV444INTERLEAVEDQuantumFormat:
          case YUV422FOURCCAQuantumFormat:
          case YUV411FOURCCAQuantumFormat:
          case YUV420FOURCCAQuantumFormat:
          case YUV444FOURCCAQuantumFormat:
          case YUV422FOURCCBQuantumFormat:
          case YUV411FOURCCBQuantumFormat:
          case YUV420FOURCCBQuantumFormat:
          case YUV444FOURCCBQuantumFormat:
          case YUV422FOURCCCQuantumFormat:
          case YUV411FOURCCCQuantumFormat:
          case YUV420FOURCCCQuantumFormat:
          case YUV444FOURCCCQuantumFormat:
          case YUV422FOURCCDQuantumFormat:
          case YUV411FOURCCDQuantumFormat:
          case YUV420FOURCCDQuantumFormat:
          case YUV444FOURCCDQuantumFormat:
          case YUV422FOURCCEQuantumFormat:
          case YUV411FOURCCEQuantumFormat:
          case YUV420FOURCCEQuantumFormat:
          case YUV444FOURCCEQuantumFormat:
          case YUV422FOURCCFQuantumFormat:
          case YUV411FOURCCFQuantumFormat:
          case YUV420FOURCCFQuantumFormat:
          case YUV444FOURCCFQuantumFormat:
          case YUV422FOURCCGQuantumFormat:
          case YUV411FOURCCGQuantumFormat:
          case YUV420FOURCCGQuantumFormat:
          case YUV444FOURCCGQuantumFormat:
          case YUV422FOURCCHQuantumFormat:
          case YUV411FOURCCHQuantumFormat:
          case YUV420FOURCCHQuantumFormat:
          case YUV444FOURCCHQuantumFormat:
          case YUV422FOURCCIQuantumFormat:
          case YUV411FOURCCIQuantumFormat:
          case YUV420FOURCCIQuantumFormat:
          case YUV444FOURCCIQuantumFormat:
          case YUV422FOURCCJQuantumFormat:
          case YUV411FOURCCJQuantumFormat:
          case YUV420FOURCCJQuantumFormat:
          case YUV444FOURCCJQuantumFormat:
          case YUV422FOURCCKQuantumFormat:
          case YUV411FOURCCKQuantumFormat:
          case YUV420FOURCCKQuantumFormat:
          case YUV444FOURCCKQuantumFormat:
          case YUV422FOURCCLQuantumFormat:
          case YUV411FOURCCLQuantumFormat:
          case YUV420FOURCCLQuantumFormat:
          case YUV444FOURCCLQuantumFormat:
          case YUV422FOURCCMQuantumFormat:
          case YUV411FOURCCMQuantumFormat:
          case YUV420FOURCCMQuantumFormat:
          case YUV444FOURCCMQuantumFormat:
          case YUV422FOURCCNQuantumFormat:
          case YUV411FOURCCNQuantumFormat:
          case YUV420FOURCCNQuantumFormat:
          case YUV444FOURCCNQuantumFormat:
          case YUV422FOURCCOQuantumFormat:
          case YUV411FOURCCOQuantumFormat:
          case YUV420FOURCCOQuantumFormat:
          case YUV444FOURCCOQuantumFormat:
          case YUV422FOURCCPQuantumFormat:
          case YUV411FOURCCPQuantumFormat:
          case YUV420FOURCCPQuantumFormat:
          case YUV444FOURCCPQuantumFormat:
          case YUV422FOURCCQQuantumFormat:
          case YUV411FOURCCQQuantumFormat:
          case YUV420FOURCCQQuantumFormat:
          case YUV444FOURCCQQuantumFormat:
          case YUV422FOURCCRQuantumFormat:
          case YUV411FOURCCRQuantumFormat:
          case YUV420FOURCCRQuantumFormat:
          case YUV444FOURCCRQuantumFormat:
          case YUV422FOURCCSQuantumFormat:
          case YUV411FOURCCSQuantumFormat:
          case YUV420FOURCCSQuantumFormat:
          case YUV444FOURCCSQuantumFormat:
          case YUV422FOURCCTQuantumFormat:
          case YUV411FOURCCTQuantumFormat:
          case YUV420FOURCCTQuantumFormat:
          case YUV444FOURCCTQuantumFormat:
          case YUV422FOURCCUQuantumFormat:
          case YUV411FOURCCUQuantumFormat:
          case YUV420FOURCCUQuantumFormat:
          case YUV444FOURCCUQuantumFormat:
          case YUV422FOURCCVQuantumFormat:
          case YUV411FOURCCVQuantumFormat:
          case YUV420FOURCCVQuantumFormat:
          case YUV444FOURCCVQuantumFormat:
          case YUV422FOURCCWQuantumFormat:
          case YUV411FOURCCWQuantumFormat:
          case YUV420FOURCCWQuantumFormat:
          case YUV444FOURCCWQuantumFormat:
          case YUV422FOURCCXQuantumFormat:
          case YUV411FOURCCXQuantumFormat:
          case YUV420FOURCCXQuantumFormat:
          case YUV444FOURCCXQuantumFormat:
          case YUV422FOURCCYQuantumFormat:
          case YUV411FOURCCYQuantumFormat:
          case YUV420FOURCCYQuantumFormat:
          case YUV444FOURCCYQuantumFormat:
          case YUV422FOURCCZQuantumFormat:
          case YUV411FOURCCZQuantumFormat:
          case YUV420FOURCCZQuantumFormat:
          case YUV444FOURCCZQuantumFormat:
          case YUV422FOURCCAQuantumFormat:
          case YUV411FOURCCAQuantumFormat:
          case YUV420FOURCCAQuantumFormat:
          case YUV444FOURCCAQuantumFormat:
          case YUV422FOURCCBQuantumFormat:
          case YUV411FOURCCBQuantumFormat:
          case YUV420FOURCCBQuantumFormat:
          case YUV444FOURCCBQuantumFormat:
          case YUV422FOURCCCQuantumFormat:
          case YUV411FOURCCCQuantumFormat:
          case YUV420FOURCCCQuantumFormat:
          case YUV444FOURCCCQuantumFormat:
          case YUV422FOURCCDQuantumFormat:
          case YUV411FOURCCDQuantumFormat:
          case YUV420FOURCCDQuantumFormat:
          case YUV444FOURCCDQuantumFormat:
          case YUV422FOURCCEQuantumFormat:
          case YUV411FOURCCEQuantumFormat:
          case YUV420FOURCCEQuantumFormat:
          case YUV444FOURCCEQuantumFormat:
          case YUV422FOURCCFQuantumFormat:
          case YUV411FOURCCFQuantumFormat:
          case YUV420FOURCCFQuantumFormat:
          case YUV444FOURCCFQuantumFormat:
          case YUV422FOURCCGQuantumFormat:
          case YUV411FOURCCGQuantumFormat:
          case YUV420FOURCCGQuantumFormat:
          case YUV444FOURCCGQuantumFormat:
          case YUV422FOURCCHQuantumFormat:
          case YUV411FOURCCHQuantumFormat:
          case YUV420FOURCCHQuantumFormat:
          case YUV444FOUR