*/
      TIFFGetField(tiff,TIFFTAG_SUBFILETYPE,&value);
      if (value == FILETYPE_REDUCEDIMAGE)
        {
          TIFFGetField(tiff,TIFFTAG_IMAGEWIDTH,&width);
          TIFFGetField(tiff,TIFFTAG_IMAGELENGTH,&height);
          TIFFGetField(tiff,TIFFTAG_BITSPERSAMPLE,&bits_per_sample);
          TIFFGetField(tiff,TIFFTAG_SAMPLESPERPIXEL,&samples_per_pixel);
          TIFFGetField(tiff,TIFFTAG_PHOTOMETRIC,&photometric);
          TIFFGetField(tiff,TIFFTAG_COMPRESSION,&compress_tag);
          TIFFGetField(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip);
          TIFFGetField(tiff,TIFFTAG_RESOLUTIONUNIT,&units);
          TIFFGetField(tiff,TIFFTAG_XRESOLUTION,&x_resolution);
          TIFFGetField(tiff,TIFFTAG_YRESOLUTION,&y_resolution);
          TIFFGetField(tiff,TIFFTAG_ORIENTATION,&orientation);
          TIFFGetField(tiff,TIFFTAG_EXTRASAMPLES,&extra_samples);
          TIFFGetField(tiff,TIFFTAG_SAMPLEFORMAT,&sample_format);
          TIFFGetField(tiff,TIFFTAG_MINISBLACK,&value);
          if (value == 0)
            photometric=PHOTOMETRIC_MINISWHITE;
          TIFFGetField(tiff,TIFFTAG_MAXISWHITE,&value);
          if (value == 0)
            photometric=PHOTOMETRIC_MAXISBLACK;
          TIFFGetField(tiff,TIFFTAG_MINSAMPLEVALUE,&min_sample_value);
          TIFFGetField(tiff,TIFFTAG_MAXSAMPLEVALUE,&max_sample_value);
          TIFFGetField(tiff,TIFFTAG_YCBCRCOEFFICIENTS,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_YCBCRSUBSAMPLING,&sans[1]);
          TIFFGetField(tiff,TIFFTAG_REFERENCEBLACKWHITE,&sans[2]);
          TIFFGetField(tiff,TIFFTAG_WHITEPOINT,&sans[3]);
          TIFFGetField(tiff,TIFFTAG_PRIMARYCHROMATICITIES,&sans[4]);
          TIFFGetField(tiff,TIFFTAG_COLORMAP,&sans[5]);
          TIFFGetField(tiff,TIFFTAG_TRANSFERFUNCTION,&sans[6]);
          TIFFGetField(tiff,TIFFTAG_INKSET,&sans[7]);
          TIFFGetField(tiff,TIFFTAG_NUMBEROFINKS,&value);
          TIFFGetField(tiff,TIFFTAG_DOTRANGE,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_TARGETPRINTER,&sans[1]);
          TIFFGetField(tiff,TIFFTAG_EXTRASAMPLES,&extra_samples);
          TIFFGetField(tiff,TIFFTAG_SAMPLEFORMAT,&sample_format);
          TIFFGetField(tiff,TIFFTAG_ICCPROFILE,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_PHOTOSHOP,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_OPIIMAGEID,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGPROC,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGIFOFFSET,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGIFBYTECOUNT,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGRESTARTINTERVAL,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGLOSSLESSPREDICTORS,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGPOINTTRANSFORM,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGQTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGDCTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGACTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_YCBCRPOSITIONING,&value);
          TIFFGetField(tiff,TIFFTAG_REFBLACKWHITE,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_BADFAXLINES,&value);
          TIFFGetField(tiff,TIFFTAG_CLEANFAXDATA,&value);
          TIFFGetField(tiff,TIFFTAG_CONSECUTIVEBADFAXLINES,&value);
          TIFFGetField(tiff,TIFFTAG_GROUP3OPTIONS,&value);
          TIFFGetField(tiff,TIFFTAG_GROUP4OPTIONS,&value);
          TIFFGetField(tiff,TIFFTAG_RESOLUTIONUNIT,&units);
          TIFFGetField(tiff,TIFFTAG_XRESOLUTION,&x_resolution);
          TIFFGetField(tiff,TIFFTAG_YRESOLUTION,&y_resolution);
          TIFFGetField(tiff,TIFFTAG_PAGENUMBER,&value);
          TIFFGetField(tiff,TIFFTAG_PAGEOFFSET,&value);
          TIFFGetField(tiff,TIFFTAG_HALFTONEHINTS,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_SUBIFD,&value);
          TIFFGetField(tiff,TIFFTAG_INKNAMES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_NUMBEROFINKS,&value);
          TIFFGetField(tiff,TIFFTAG_DOTRANGE,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_TARGETPRINTER,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_EXTRASAMPLES,&extra_samples);
          TIFFGetField(tiff,TIFFTAG_SAMPLEFORMAT,&sample_format);
          TIFFGetField(tiff,TIFFTAG_ICCPROFILE,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_PHOTOSHOP,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_OPIIMAGEID,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGPROC,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGIFOFFSET,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGIFBYTECOUNT,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGRESTARTINTERVAL,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGLOSSLESSPREDICTORS,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGPOINTTRANSFORM,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGQTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGDCTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGACTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_YCBCRPOSITIONING,&value);
          TIFFGetField(tiff,TIFFTAG_REFBLACKWHITE,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_BADFAXLINES,&value);
          TIFFGetField(tiff,TIFFTAG_CLEANFAXDATA,&value);
          TIFFGetField(tiff,TIFFTAG_CONSECUTIVEBADFAXLINES,&value);
          TIFFGetField(tiff,TIFFTAG_GROUP3OPTIONS,&value);
          TIFFGetField(tiff,TIFFTAG_GROUP4OPTIONS,&value);
          TIFFGetField(tiff,TIFFTAG_RESOLUTIONUNIT,&units);
          TIFFGetField(tiff,TIFFTAG_XRESOLUTION,&x_resolution);
          TIFFGetField(tiff,TIFFTAG_YRESOLUTION,&y_resolution);
          TIFFGetField(tiff,TIFFTAG_PAGENUMBER,&value);
          TIFFGetField(tiff,TIFFTAG_PAGEOFFSET,&value);
          TIFFGetField(tiff,TIFFTAG_HALFTONEHINTS,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_SUBIFD,&value);
          TIFFGetField(tiff,TIFFTAG_INKNAMES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_NUMBEROFINKS,&value);
          TIFFGetField(tiff,TIFFTAG_DOTRANGE,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_TARGETPRINTER,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_EXTRASAMPLES,&extra_samples);
          TIFFGetField(tiff,TIFFTAG_SAMPLEFORMAT,&sample_format);
          TIFFGetField(tiff,TIFFTAG_ICCPROFILE,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_PHOTOSHOP,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_OPIIMAGEID,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGPROC,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGIFOFFSET,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGIFBYTECOUNT,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGRESTARTINTERVAL,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGLOSSLESSPREDICTORS,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGPOINTTRANSFORM,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGQTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGDCTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGACTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_YCBCRPOSITIONING,&value);
          TIFFGetField(tiff,TIFFTAG_REFBLACKWHITE,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_BADFAXLINES,&value);
          TIFFGetField(tiff,TIFFTAG_CLEANFAXDATA,&value);
          TIFFGetField(tiff,TIFFTAG_CONSECUTIVEBADFAXLINES,&value);
          TIFFGetField(tiff,TIFFTAG_GROUP3OPTIONS,&value);
          TIFFGetField(tiff,TIFFTAG_GROUP4OPTIONS,&value);
          TIFFGetField(tiff,TIFFTAG_RESOLUTIONUNIT,&units);
          TIFFGetField(tiff,TIFFTAG_XRESOLUTION,&x_resolution);
          TIFFGetField(tiff,TIFFTAG_YRESOLUTION,&y_resolution);
          TIFFGetField(tiff,TIFFTAG_PAGENUMBER,&value);
          TIFFGetField(tiff,TIFFTAG_PAGEOFFSET,&value);
          TIFFGetField(tiff,TIFFTAG_HALFTONEHINTS,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_SUBIFD,&value);
          TIFFGetField(tiff,TIFFTAG_INKNAMES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_NUMBEROFINKS,&value);
          TIFFGetField(tiff,TIFFTAG_DOTRANGE,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_TARGETPRINTER,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_EXTRASAMPLES,&extra_samples);
          TIFFGetField(tiff,TIFFTAG_SAMPLEFORMAT,&sample_format);
          TIFFGetField(tiff,TIFFTAG_ICCPROFILE,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_PHOTOSHOP,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_OPIIMAGEID,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGPROC,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGIFOFFSET,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGIFBYTECOUNT,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGRESTARTINTERVAL,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGLOSSLESSPREDICTORS,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGPOINTTRANSFORM,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGQTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGDCTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGACTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_YCBCRPOSITIONING,&value);
          TIFFGetField(tiff,TIFFTAG_REFBLACKWHITE,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_BADFAXLINES,&value);
          TIFFGetField(tiff,TIFFTAG_CLEANFAXDATA,&value);
          TIFFGetField(tiff,TIFFTAG_CONSECUTIVEBADFAXLINES,&value);
          TIFFGetField(tiff,TIFFTAG_GROUP3OPTIONS,&value);
          TIFFGetField(tiff,TIFFTAG_GROUP4OPTIONS,&value);
          TIFFGetField(tiff,TIFFTAG_RESOLUTIONUNIT,&units);
          TIFFGetField(tiff,TIFFTAG_XRESOLUTION,&x_resolution);
          TIFFGetField(tiff,TIFFTAG_YRESOLUTION,&y_resolution);
          TIFFGetField(tiff,TIFFTAG_PAGENUMBER,&value);
          TIFFGetField(tiff,TIFFTAG_PAGEOFFSET,&value);
          TIFFGetField(tiff,TIFFTAG_HALFTONEHINTS,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_SUBIFD,&value);
          TIFFGetField(tiff,TIFFTAG_INKNAMES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_NUMBEROFINKS,&value);
          TIFFGetField(tiff,TIFFTAG_DOTRANGE,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_TARGETPRINTER,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_EXTRASAMPLES,&extra_samples);
          TIFFGetField(tiff,TIFFTAG_SAMPLEFORMAT,&sample_format);
          TIFFGetField(tiff,TIFFTAG_ICCPROFILE,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_PHOTOSHOP,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_OPIIMAGEID,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGPROC,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGIFOFFSET,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGIFBYTECOUNT,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGRESTARTINTERVAL,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGLOSSLESSPREDICTORS,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGPOINTTRANSFORM,&value);
          TIFFGetField(tiff,TIFFTAG_JPEGQTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGDCTABLES,&sans[0]);
          TIFFGetField(tiff,TIFFTAG_JPEGACTABLES,&sans[0]);
          TIFFGetField(t