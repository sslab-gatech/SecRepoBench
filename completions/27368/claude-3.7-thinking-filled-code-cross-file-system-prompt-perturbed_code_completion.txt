int status;
size_t footer_start;
uint8_t *pb;
size_t out_size;
void *out_buf;
z_stream strm;
uint32_t crc;

/* 
 * Calculate the maximum required output buffer size.
 * For gzip, a safe upper bound is input_size + 0.1% + 18 bytes (header+footer)
 * We'll round up a bit to be extra safe.
 */
out_size = FLB_GZIP_HEADER_OFFSET + (size_t)(input_size * 1.01) + 12 + 8;

/* Allocate output buffer */
out_buf = flb_malloc(out_size);