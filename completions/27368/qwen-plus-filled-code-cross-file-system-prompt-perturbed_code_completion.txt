int status;
    size_t footer_size = 8; // CRC32 and ISIZE fields
    size_t max_compressed_size = deflateBound(NULL, input_size);
    size_t total_output_size = FLB_GZIP_HEADER_OFFSET + max_compressed_size + footer_size;
    uint8_t *out_buf = (uint8_t *) flb_malloc(total_output_size);
    z_stream strm;
    uint32_t crc;

    if (!out_buf) {
        flb_errno();
        flb_error("[gzip] could not allocate outgoing buffer");
        return -1;
    }