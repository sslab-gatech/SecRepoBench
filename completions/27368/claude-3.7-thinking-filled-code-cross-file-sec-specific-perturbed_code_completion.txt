int status;
    size_t footer_start;
    uint8_t *pb;
    size_t out_size;
    void *out_buf;
    z_stream strm;
    unsigned long crc;
    
    /* Determine max buffer size required for compression + headers */
    out_size = input_size + (input_size >> 12) + (input_size >> 14) + (input_size >> 25) + 13;
    out_size += FLB_GZIP_HEADER_OFFSET + 8; /* Add space for gzip header and footer */
    
    /* Allocate output buffer */
    out_buf = flb_malloc(out_size);