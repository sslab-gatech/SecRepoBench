int status = 0;
    size_t footer_start = 0;
    uint8_t *pb = NULL;
    size_t out_size = 0;
    void *out_buf = NULL;
    z_stream strm;
    mz_ulong crc = 0;

    /* Calculate worst-case size for compressed data (overhead + header + footer). */
    out_size = input_size + (input_size / 1000) + 64 + FLB_GZIP_HEADER_OFFSET + 8;

    out_buf = flb_malloc(out_size);