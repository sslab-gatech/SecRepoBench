/* Calculate the maximum size of the output buffer */
    out_size = deflateBound(&strm, input_size) + FLB_GZIP_HEADER_OFFSET + 8;

    /* Allocate memory for the output buffer */
    out_buf = flb_malloc(out_size);
    if (!out_buf) {
        flb_errno();
        flb_error("[gzip] could not allocate memory for output buffer");
        return -1;
    }