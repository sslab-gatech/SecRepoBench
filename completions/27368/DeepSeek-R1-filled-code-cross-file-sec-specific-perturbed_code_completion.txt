int status;
size_t footer_start;
uint8_t *pb;
size_t out_size;
void *out_buf = NULL;
z_stream strm;
uint32_t crc;

/* Calculate worst-case output size */
size_t max_compressed = input_size + (input_size >> 12) + (input_size >> 14) + (input_size >> 25) + 13;
if (max_compressed > SIZE_MAX - FLB_GZIP_HEADER_OFFSET - 8) {
    flb_error("[gzip] input size too large to compress");
    return -1;
}
out_size = FLB_GZIP_HEADER_OFFSET + max_compressed + 8;
out_buf = flb_malloc(out_size);