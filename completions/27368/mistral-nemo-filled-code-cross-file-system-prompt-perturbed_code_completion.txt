/* Calculate the maximum required size for the output buffer */
    out_size = input_size * 1.01 + 18; /* 1.01 is a rough estimate for worst-case size expansion */

    /* Allocate memory for the output buffer */
    out_buf = flb_malloc(out_size);
    if (!out_buf) {
        flb_errno();
        flb_error("[gzip] could not allocate outgoing buffer");
        return -1;
    }