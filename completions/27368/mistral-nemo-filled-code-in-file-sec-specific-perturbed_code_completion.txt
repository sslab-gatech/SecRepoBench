/* Calculate the maximum required size for the output buffer */
    out_size = input_size * 1.01 + 12; /* 1.01 is a rough estimate for the worst-case size expansion due to compression */
    out_buf = flb_malloc(out_size);
    if (!out_buf) {
        flb_errno();
        flb_error("[gzip] could not allocate outgoing buffer");
        return -1;
    }