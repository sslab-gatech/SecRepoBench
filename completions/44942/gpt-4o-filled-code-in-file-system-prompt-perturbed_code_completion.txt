struct ndpi_iphdr iph;
  memset(&iph, 0, sizeof(iph));

  memcpy(&iph.saddr, &ipv6_header->ip6_src, sizeof(iph.saddr));
  memcpy(&iph.daddr, &ipv6_header->ip6_dst, sizeof(iph.daddr));

  *proto = ipv6_header->ip6_hdr.ip6_un1_nxt;
  *payload_len = ntohs(ipv6_header->ip6_hdr.ip6_un1_plen);

  const u_int8_t *l4ptr = (((const u_int8_t *) ipv6_header) + sizeof(struct ndpi_ipv6hdr));
  u_int16_t ip_len = *payload_len;

  if (ndpi_handle_ipv6_extension_headers(ip_len, &l4ptr, &ip_len, proto) != 0) {
    return NULL;
  }