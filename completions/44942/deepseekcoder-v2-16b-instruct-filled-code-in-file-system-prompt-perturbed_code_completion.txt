if(src_to_dst_direction) {
    flow->tcp_flags_count_src2dst.urg |= tcp->urg;
    flow->tcp_flags_count_src2dst.ack |= tcp->ack;
    flow->tcp_flags_count_src2dst.psh |= tcp->psh;
    flow->tcp_flags_count_src2dst.rst |= tcp->rst;
    flow->tcp_flags_count_src2dst.syn |= tcp->syn;
    flow->tcp_flags_count_src2dst.fin |= tcp->fin;
  } else {
    flow->tcp_flags_count_dst2src.urg |= tcp->urg;
    flow->tcp_flags_count_dst2src.ack |= tcp->ack;
    flow->tcp_flags_count_dst2src.psh |= tcp->psh;
    flow->tcp_flags_count_dst2src.rst |= tcp->rst;
    flow->tcp_flags_count_dst2src.syn |= tcp->syn;
    flow->tcp_flags_count_dst2src.fin |= tcp->fin;
  }
}

/* ****************************************************** */

void update_udp_checksum_count(struct ndpi_flow_info* flow, struct ndpi_udphdr* udp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->udp_checksum_count_src2dst.valid |= udp->check == 0;
    flow->udp_checksum_count_src2dst.invalid |= udp->check != 0;
  } else {
    flow->udp_checksum_count_dst2src.valid |= udp->check == 0;
    flow->udp_checksum_count_dst2src.invalid |= udp->check != 0;
  }
}

/* ****************************************************** */

void update_tcp_checksum_count(struct ndpi_flow_info* flow, struct ndpi_tcphdr* tcp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->tcp_checksum_count_src2dst.valid |= tcp->check == 0;
    flow->tcp_checksum_count_src2dst.invalid |= tcp->check != 0;
  } else {
    flow->tcp_checksum_count_dst2src.valid |= tcp->check == 0;
    flow->tcp_checksum_count_dst2src.invalid |= tcp->check != 0;
  }
}

/* ****************************************************** */

void update_tcp_window_count(struct ndpi_flow_info* flow, struct ndpi_tcphdr* tcp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->tcp_window_count_src2dst.zero |= tcp->window == 0;
    flow->tcp_window_count_src2dst.non_zero |= tcp->window != 0;
  } else {
    flow->tcp_window_count_dst2src.zero |= tcp->window == 0;
    flow->tcp_window_count_dst2src.non_zero |= tcp->window != 0;
  }
}

/* ****************************************************** */

void update_tcp_mss_count(struct ndpi_flow_info* flow, struct ndpi_tcphdr* tcp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->tcp_mss_count_src2dst.zero |= tcp->mss == 0;
    flow->tcp_mss_count_src2dst.non_zero |= tcp->mss != 0;
  } else {
    flow->tcp_mss_count_dst2src.zero |= tcp->mss == 0;
    flow->tcp_mss_count_dst2src.non_zero |= tcp->mss != 0;
  }
}

/* ****************************************************** */

void update_tcp_timestamp_count(struct ndpi_flow_info* flow, struct ndpi_tcphdr* tcp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->tcp_timestamp_count_src2dst.zero |= tcp->timestamp == 0;
    flow->tcp_timestamp_count_src2dst.non_zero |= tcp->timestamp != 0;
  } else {
    flow->tcp_timestamp_count_dst2src.zero |= tcp->timestamp == 0;
    flow->tcp_timestamp_count_dst2src.non_zero |= tcp->timestamp != 0;
  }
}

/* ****************************************************** */

void update_tcp_sack_count(struct ndpi_flow_info* flow, struct ndpi_tcphdr* tcp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->tcp_sack_count_src2dst.present |= tcp->sack_permitted;
    flow->tcp_sack_count_src2dst.not_present |= !tcp->sack_permitted;
  } else {
    flow->tcp_sack_count_dst2src.present |= tcp->sack_permitted;
    flow->tcp_sack_count_dst2src.not_present |= !tcp->sack_permitted;
  }
}

/* ****************************************************** */

void update_tcp_ws_count(struct ndpi_flow_info* flow, struct ndpi_tcphdr* tcp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->tcp_ws_count_src2dst.present |= tcp->window_scale != 0;
    flow->tcp_ws_count_src2dst.not_present |= tcp->window_scale == 0;
  } else {
    flow->tcp_ws_count_dst2src.present |= tcp->window_scale != 0;
    flow->tcp_ws_count_dst2src.not_present |= tcp->window_scale == 0;
  }
}

/* ****************************************************** */

void update_tcp_paws_count(struct ndpi_flow_info* flow, struct ndpi_tcphdr* tcp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->tcp_paws_count_src2dst.present |= tcp->paws_window_scale != 0;
    flow->tcp_paws_count_src2dst.not_present |= tcp->paws_window_scale == 0;
  } else {
    flow->tcp_paws_count_dst2src.present |= tcp->paws_window_scale != 0;
    flow->tcp_paws_count_dst2src.not_present |= tcp->paws_window_scale == 0;
  }
}

/* ****************************************************** */

void update_tcp_sack_permitted_count(struct ndpi_flow_info* flow, struct ndpi_tcphdr* tcp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->tcp_sack_permitted_count_src2dst.present |= tcp->sack_permitted;
    flow->tcp_sack_permitted_count_src2dst.not_present |= !tcp->sack_permitted;
  } else {
    flow->tcp_sack_permitted_count_dst2src.present |= tcp->sack_permitted;
    flow->tcp_sack_permitted_count_dst2src.not_present |= !tcp->sack_permitted;
  }
}

/* ****************************************************** */

void update_tcp_timestamp_echo_count(struct ndpi_flow_info* flow, struct ndpi_tcphdr* tcp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->tcp_timestamp_echo_count_src2dst.present |= tcp->timestamp != 0;
    flow->tcp_timestamp_echo_count_src2dst.not_present |= tcp->timestamp == 0;
  } else {
    flow->tcp_timestamp_echo_count_dst2src.present |= tcp->timestamp != 0;
    flow->tcp_timestamp_echo_count_dst2src.not_present |= tcp->timestamp == 0;
  }
}

/* ****************************************************** */

void update_tcp_window_scale_count(struct ndpi_flow_info* flow, struct ndpi_tcphdr* tcp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->tcp_window_scale_count_src2dst.present |= tcp->window_scale != 0;
    flow->tcp_window_scale_count_src2dst.not_present |= tcp->window_scale == 0;
  } else {
    flow->tcp_window_scale_count_dst2src.present |= tcp->window_scale != 0;
    flow->tcp_window_scale_count_dst2src.not_present |= tcp->window_scale == 0;
  }
}

/* ****************************************************** */

void update_tcp_paws_count(struct ndpi_flow_info* flow, struct ndpi_tcphdr* tcp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->tcp_paws_count_src2dst.present |= tcp->paws_window_scale != 0;
    flow->tcp_paws_count_src2dst.not_present |= tcp->paws_window_scale == 0;
  } else {
    flow->tcp_paws_count_dst2src.present |= tcp->paws_window_scale != 0;
    flow->tcp_paws_count_dst2src.not_present |= tcp->paws_window_scale == 0;
  }
}

/* ****************************************************** */

void update_tcp_sack_echo_count(struct ndpi_flow_info* flow, struct ndpi_tcphdr* tcp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->tcp_sack_echo_count_src2dst.present |= tcp->sack_echo;
    flow->tcp_sack_echo_count_src2dst.not_present |= !tcp->sack_echo;
  } else {
    flow->tcp_sack_echo_count_dst2src.present |= tcp->sack_echo;
    flow->tcp_sack_echo_count_dst2src.not_present |= !tcp->sack_echo;
  }
}

/* ****************************************************** */

void update_tcp_sack_is_selective_count(struct ndpi_flow_info* flow, struct ndpi_tcphdr* tcp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->tcp_sack_is_selective_count_src2dst.selective |= tcp->sack_is_selective;
    flow->tcp_sack_is_selective_count_src2dst.not_selective |= !tcp->sack_is_selective;
  } else {
    flow->tcp_sack_is_selective_count_dst2src.selective |= tcp->sack_is_selective;
    flow->tcp_sack_is_selective_count_dst2src.not_selective |= !tcp->sack_is_selective;
  }
}

/* ****************************************************** */

void update_tcp_sack_blocks_count(struct ndpi_flow_info* flow, struct ndpi_tcphdr* tcp, u_int8_t src_to_dst_direction){
  if(src_to_dst_direction) {
    flow->tcp_sack_blocks_count_src2dst.present |= tcp->sack_blocks_count != 0;
    flow->tcp_sack_blocks_count_src2dst.not_present |= tcp->sack_blocks_count == 0;
  } else {
    flow->tcp_sack_blocks_count_dst2src.present |= tcp->sack_blocks_count != 0;
    flow->tcp_sack_blocks_count_dst2src.not_present |= tcp->sack_blocks_count == 0;
  }
}

/* ****************************************************** */

void update_tcp_sack_base_count(struct