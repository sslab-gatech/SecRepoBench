struct ndpi_ipv4hdr iph;
memset(&iph, 0, sizeof(iph)); // Initialize the IPv4 header structure to zero

iph.src_ip = ipv6_header->src_ip; // Extract source IP from IPv6 header
iph.dst_ip = ipv6_header->dst_ip; // Extract destination IP from IPv6 header
iph.payload_len = ipsize - ip_offset; // Calculate the payload length
iph.protocol = l4proto; // Set the protocol

// Ensure that the payload pointer is valid and does not exceed the allocated size
if (payload_len && *payload_len > 0) {
    *payload = (u_int8_t *)((const u_int8_t *)ipv6_header + ip_offset);
} else {
    *payload = NULL; // Handle case where payload length is invalid
}