struct ndpi_iphdr iph;
  const u_int8_t *l4ptr;
  u_int16_t ip_len, l4proto;

  memset(&iph, 0, sizeof(iph));
  iph.version = IPVERSION;
  iph.ihl = 5;
  iph.tot_len = htons(ipsize);
  memcpy(&iph.saddr, &ipv6_header->ip6_src, 4);
  memcpy(&iph.daddr, &ipv6_header->ip6_dst, 4);

  l4ptr = (((const u_int8_t *) ipv6_header) + sizeof(struct ndpi_ipv6hdr));
  l4proto = proto;

  if(ndpi_handle_ipv6_extension_headers(ipsize - sizeof(struct ndpi_ipv6hdr), &l4ptr, &ip_len, &proto) != 0) {
    return(NULL);
  }