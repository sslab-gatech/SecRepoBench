// <MASK>
// Extract source and destination addresses from the IPv6 header
// and assign them to the corresponding fields in the IPv4 header structure.
// Retrieve the protocol type and payload length from the IPv6 header.
// Determine the pointer to the layer 4 protocol data by offsetting
// from the start of the IPv6 header.
// Handle IPv6 extension headers, adjusting the protocol data pointer,
// and update the protocol and payload length accordingly.
iph.saddr = ipv6_header->src_addr;
iph.daddr = ipv6_header->dst_addr;
iph.protocol = ipv6_header->next_header;
iph.tot_len = ipv6_header->payload_len;

// Determine the protocol data pointer
l4ptr = (const u_int8_t *)ipv6_header + ipv6_header->payload_len;

// Check for IPv6 extension headers
while (iph.protocol == 0) {
  // Check for Hop-by-Hop Options header
  if (iph.next_header == IPPROTO_HOPOPTS) {
    // Skip the Hop-by-Hop Options header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for Routing header
  else if (iph.next_header == IPPROTO_ROUTING) {
    // Skip the Routing header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for Fragment header
  else if (iph.next_header == IPPROTO_FRAGMENT) {
    // Skip the Fragment header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for Destination Options header
  else if (iph.next_header == IPPROTO_DSTOPTS) {
    // Skip the Destination Options header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for Authentication header
  else if (iph.next_header == IPPROTO_AUTH) {
    // Skip the Authentication header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for Encapsulating Security Payload header
  else if (iph.next_header == IPPROTO_ESP) {
    // Skip the Encapsulating Security Payload header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for Authentication Header
  else if (iph.next_header == IPPROTO_AH) {
    // Skip the Authentication Header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for Destination Options header
  else if (iph.next_header == IPPROTO_DSTOPTS) {
    // Skip the Destination Options header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for Mobility header
  else if (iph.next_header == IPPROTO_MOBILITY) {
    // Skip the Mobility header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 header
    l4ptr += ipv6_header->payload_len;
    iph.tot_len += ipv6_header->payload_len;
    iph.next_header = ipv6_header->next_header;
  }
  // Check for ICMPv6 header
  else if (iph.next_header == IPPROTO_ICMPV6) {
    // Skip the ICMPv6 heade