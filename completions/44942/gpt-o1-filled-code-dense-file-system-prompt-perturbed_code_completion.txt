struct ndpi_iphdr iph;
  memset(&iph, 0, sizeof(iph));

  u_int16_t ip_len = ntohs(ipv6_header->ip6_hdr.ip6_un1_plen);
  u_int8_t l4proto = ipv6_header->ip6_hdr.ip6_un1_nxt;
  const u_int8_t *l4ptr = (const u_int8_t *)ipv6_header + sizeof(*ipv6_header);

  if(ndpi_handle_ipv6_extension_headers(ipsize - sizeof(*ipv6_header), &l4ptr, &ip_len, &l4proto) != 0)
    return(NULL);

  iph.saddr = NDPI_IPV6_ADDR32(&ipv6_header->ip6_src, 3);
  iph.daddr = NDPI_IPV6_ADDR32(&ipv6_header->ip6_dst, 3);