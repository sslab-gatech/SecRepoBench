struct ndpi_iphdr iph = {0};
  u_int8_t l4proto = 0;

  // Extract source and destination addresses from the IPv6 header
  iph.saddr = iph6->ip6_src;
  iph.daddr = iph6->ip6_dst;

  // Retrieve the protocol type and payload length from the IPv6 header
  l4proto = iph6->ip6_hdr.ip6_un1_nxt;
  ip_len = ntohs(iph6->ip6_hdr.ip6_un1_plen;

  // Determine the pointer to the layer 4 protocol data by offsetting
  // from the start of the IPv6 header.
  const u_int8_t *l4ptr = (((const u_int8_t *) iph6) + sizeof(struct ndpi_ipv6hdr));
  u_int16_t ipsize = header->caplen - ip_offset;

  // Handle IPv6 extension headers, adjusting the protocol data pointer,
  // and update the protocol and payload length accordingly.
  if(ndpi_handle_ipv6_extension_headers(ipsize - sizeof(struct ndpi_ipv6hdr), &l4ptr, &ip_len, &l4proto) != 0) {
    return NULL;
  }