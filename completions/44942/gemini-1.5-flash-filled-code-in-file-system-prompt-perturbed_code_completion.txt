struct ndpi_iphdr iph;
  const u_int8_t *l4ptr;
  u_int16_t ip_len;
  u_int8_t l4proto;

  memset(&iph, 0, sizeof(iph));
  iph.version = IPVERSION;
  iph.ihl = 5;
  iph.tos = 0;
  iph.tot_len = htons(ipsize);
  iph.id = 0;
  iph.frag_off = 0;
  iph.ttl = 64;
  memcpy(&iph.saddr, &ipv6_header->ip6_src, sizeof(iph.saddr));
  memcpy(&iph.daddr, &ipv6_header->ip6_dst, sizeof(iph.daddr));
  l4ptr = (((const u_int8_t *) ipv6_header) + sizeof(struct ndpi_ipv6hdr));
  l4proto = ndpi_handle_ipv6_extension_headers(ipsize - sizeof(struct ndpi_ipv6hdr), &l4ptr, &ip_len, proto);
  if(l4proto == 0) return NULL;