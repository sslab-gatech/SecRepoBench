struct ndpi_ipv4hdr iph;
memset(&iph, 0, sizeof(iph));
iph.saddr = ipv6_header->saddr.u6_addr32[3];
iph.daddr = ipv6_header->daddr.u6_addr32[3];
l4proto = ipv6_header->nexthdr;
ip_len = ((const u_int16_t *)ipv6_header)[2] << 2;
l4ptr = ((const u_int8_t *)ipv6_header) + ip_offset;

if(ipv6_ext_hdr(l4proto)) {
  l4proto = ndpi_handle_ipv6_extension_headers((const u_int8_t *)l4proto, (const u_int8_t *)ipv6_header, &l4ptr, &ip_len);
  if(l4proto == 0) {
    return(NULL);
  }
}