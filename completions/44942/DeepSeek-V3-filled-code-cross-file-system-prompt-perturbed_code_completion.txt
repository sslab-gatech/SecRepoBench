struct ndpi_iphdr iph;
  memset(&iph, 0, sizeof(iph));
  
  memcpy(&iph.saddr, &ipv6_header->saddr, sizeof(iph.saddr));
  memcpy(&iph.daddr, &ipv6_header->daddr, sizeof(iph.daddr));
  
  u_int8_t l4proto = ipv6_header->ip6_ctlun.ip6_un1.ip6_un1_nxt;
  u_int16_t ip_len = ntohs(ipv6_header->ip6_ctlun.ip6_un1.ip6_un1_plen);
  
  const u_int8_t *l4ptr = (const u_int8_t *)ipv6_header + sizeof(struct ndpi_ipv6hdr);
  
  while(ndpi_is_ipv6_extension_header_type(l4proto)) {
    struct ndpi_ipv6_ext *ext = (struct ndpi_ipv6_ext *)l4ptr;
    l4proto = ext->ip6e_nxt;
    l4ptr += (ext->ip6e_len + 1) << 3;
    ip_len -= (ext->ip6e_len + 1) << 3;
  }