struct ndpi_ipv4hdr iph;
  u_int32_t ip_len = ntohs(ipv6_header->payload_len) + sizeof(struct ndpi_ipv6hdr);
  u_int8_t l4proto;
  const u_int8_t *l4ptr;

  memset(&iph, 0, sizeof(iph));
  memcpy(&iph.saddr, &ipv6_header->saddr, 4);
  memcpy(&iph.daddr, &ipv6_header->daddr, 4);

  l4proto = ndpi_get_ipv6_proto(workflow->ndpi_struct,
				(const u_int8_t *)ipv6_header,
				ip_len, &l4ptr, &iph.ttl,
				payload, payload_len);