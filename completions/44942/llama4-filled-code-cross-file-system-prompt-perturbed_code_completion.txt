struct ndpi_iphdr iph;
memset(&iph, 0, sizeof(iph));

iph.saddr = ipv6_header->saddr.s6_addr[0] << 24 |
            ipv6_header->saddr.s6_addr[1] << 16 |
            ipv6_header->saddr.s6_addr[2] << 8  |
            ipv6_header->saddr.s6_addr[3];

iph.daddr = ipv6_header->daddr.s6_addr[0] << 24 |
            ipv6_header->daddr.s6_addr[1] << 16 |
            ipv6_header->daddr.s6_addr[2] << 8  |
            ipv6_header->daddr.s6_addr[3];

iph.ihl = 5; /* Assuming 20 bytes for the IPv4 header */
iph.version = 4; /* IPv4 */
iph.ttl = 64; /* Assuming a default TTL */

u_int8_t l4proto = ipv6_header->nexthdr;
const u_int8_t *l4ptr = (const u_int8_t *)ipv6_header + ip_offset;

iph.protocol = l4proto;

u_int16_t ip_len = ipsize;