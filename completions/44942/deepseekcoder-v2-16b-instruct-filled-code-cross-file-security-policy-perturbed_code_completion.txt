u_int8_t l4proto = ipv6_header->nexthdr;
  const u_int8_t *l4ptr = ipv6_header + 1;
  u_int16_t ip_len = ipsize;

  // Create an IPv4 header structure and initialize it to zero.
  struct ndpi_iphdr iph = {0};

  // Extract source and destination addresses from the IPv6 header
  // and assign them to the corresponding fields in the IPv4 header structure.
  memcpy(iph.ip_src.s6_addr, ipv6_header->src, sizeof(ipv6_header->src));
  memcpy(iph.ip_dst.s6_addr, ipv6_header->dst, sizeof(ipv6_header->dst));

  // Retrieve the protocol type and payload length from the IPv6 header.
  iph.protocol = l4proto;
  ip_len = ipsize;

  // Determine the pointer to the layer 4 protocol data by offsetting
  // from the start of the IPv6 header.
  l4ptr = (const u_int8_t *)ipv6_header + ip_offset;

  // Handle IPv6 extension headers, adjusting the protocol data pointer,
  // and update the protocol and payload length accordingly.
  // This part is more complex and typically involves parsing the IPv6 header
  // to handle any extension headers. For simplicity, we assume no extension headers.

  // <MASK>
  iph.protocol = l4proto;