);
                }
              }
          }
      }
    if (planar_configuration == PLANARCONFIG_SEPARATE)
      image->endian=image->endian == MSBEndian ? LSBEndian : MSBEndian;
    if (planar_configuration == PLANARCONFIG_CONTIG)
      image->endian=MSBEndian;
    if (planar_configuration == PLANARCONFIG_SEPARATE)
      image->storage_class=PseudoClass;
    if (planar_configuration == PLANARCONFIG_CONTIG)
      image->storage_class=DirectClass;
    if (planar_configuration == PLANARCONFIG_SEPARATE)
      image->number_channels=samples_per_pixel;
    if (planar_configuration == PLANARCONFIG_CONTIG)
      image->number_channels=1;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_EXTRASAMPLES,&extra_samples,
        &sample_info) == 1)
      {
        for (i=0; i < (ssize_t) extra_samples; i++)
        {
          if (sample_info[i] == EXTRASAMPLE_ASSOCALPHA)
            image->alpha_trait=OpaquePixelTrait;
          if (sample_info[i] == EXTRASAMPLE_UNASSALPHA)
            image->alpha_trait=TransparentPixelTrait;
        }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SAMPLESPERPIXEL,&value) == 1)
      samples_per_pixel=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) == 1)
      image->rows_per_strip=(size_t) rows_per_strip;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&value) == 1)
      orientation=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&value) == 1)
      units=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&value) == 1)
      x_resolution=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&value) == 1)
      y_resolution=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&value,&pages,sans) == 1)
      image->scene=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SUBFILETYPE,&value) == 1)
      {
        if (value & FILETYPE_REDUCEDIMAGE)
          (void) SetImageProperty(image,"tiff:subfiletype","REDUCEDIMAGE",
            exception);
        if (value & FILETYPE_PAGE)
          (void) SetImageProperty(image,"tiff:subfiletype","PAGE",exception);
        if (value & FILETYPE_MASK)
          (void) SetImageProperty(image,"tiff:subfiletype","MASK",exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MINSAMPLEVALUE,&value) == 1)
      min_sample_value=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MAXSAMPLEVALUE,&value) == 1)
      max_sample_value=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XPOSITION,&value) == 1)
      x_position=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YPOSITION,&value) == 1)
      y_position=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_WHITEPOINT,&chromaticity) == 1)
      {
        if ((chromaticity != (float *) NULL) && (*chromaticity != 0.0))
          {
            image->chromaticity.white_point.x=chromaticity[0];
            image->chromaticity.white_point.y=chromaticity[1];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PRIMARYCHROMATICITIES,&chromaticity) == 1)
      {
        if ((chromaticity != (float *) NULL) && (*chromaticity != 0.0))
          {
            image->chromaticity.red_primary.x=chromaticity[0];
            image->chromaticity.red_primary.y=chromaticity[1];
            image->chromaticity.green_primary.x=chromaticity[2];
            image->chromaticity.green_primary.y=chromaticity[3];
            image->chromaticity.blue_primary.x=chromaticity[4];
            image->chromaticity.blue_primary.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YCBCRSUBSAMPLING,&horizontal,
        &vertical) == 1)
      {
        (void) FormatLocaleString(sampling_factor,MagickPathExtent,
          "%dx%d",horizontal,vertical);
        (void) SetImageProperty(image,"jpeg:sampling-factor",
          sampling_factor,exception);
        (void) LogMagickEvent(CoderEvent,GetMagickModule(),
          "Sampling Factors: %s",sampling_factor);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&value) == 1)
      image->orientation=(OrientationType) value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&value) == 1)
      image->units=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&value) == 1)
      image->resolution.x=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&value) == 1)
      image->resolution.y=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&value,&pages,sans) == 1)
      image->scene=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SUBFILETYPE,&value) == 1)
      {
        if (value & FILETYPE_REDUCEDIMAGE)
          (void) SetImageProperty(image,"tiff:subfiletype","REDUCEDIMAGE",
            exception);
        if (value & FILETYPE_PAGE)
          (void) SetImageProperty(image,"tiff:subfiletype","PAGE",exception);
        if (value & FILETYPE_MASK)
          (void) SetImageProperty(image,"tiff:subfiletype","MASK",exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MINSAMPLEVALUE,&value) == 1)
      min_sample_value=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MAXSAMPLEVALUE,&value) == 1)
      max_sample_value=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XPOSITION,&value) == 1)
      x_position=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YPOSITION,&value) == 1)
      y_position=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_WHITEPOINT,&chromaticity) == 1)
      {
        if ((chromaticity != (float *) NULL) && (*chromaticity != 0.0))
          {
            image->chromaticity.white_point.x=chromaticity[0];
            image->chromaticity.white_point.y=chromaticity[1];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PRIMARYCHROMATICITIES,&chromaticity) == 1)
      {
        if ((chromaticity != (float *) NULL) && (*chromaticity != 0.0))
          {
            image->chromaticity.red_primary.x=chromaticity[0];
            image->chromaticity.red_primary.y=chromaticity[1];
            image->chromaticity.green_primary.x=chromaticity[2];
            image->chromaticity.green_primary.y=chromaticity[3];
            image->chromaticity.blue_primary.x=chromaticity[4];
            image->chromaticity.blue_primary.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YCBCRSUBSAMPLING,&horizontal,
        &vertical) == 1)
      {
        (void) FormatLocaleString(sampling_factor,MagickPathExtent,
          "%dx%d",horizontal,vertical);
        (void) SetImageProperty(image,"jpeg:sampling-factor",
          sampling_factor,exception);
        (void) LogMagickEvent(CoderEvent,GetMagickModule(),
          "Sampling Factors: %s",sampling_factor);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&value) == 1)
      image->orientation=(OrientationType) value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&value) == 1)
      image->units=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&value) == 1)
      image->resolution.x=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&value) == 1)
      image->resolution.y=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&value,&pages,sans) == 1)
      image->scene=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SUBFILETYPE,&value) == 1)
      {
        if (value & FILETYPE_REDUCEDIMAGE)
          (void) SetImageProperty(image,"tiff:subfiletype","REDUCEDIMAGE",
            exception);
        if (value & FILETYPE_PAGE)
          (void) SetImageProperty(image,"tiff:subfiletype","PAGE",exception);
        if (value & FILETYPE_MASK)
          (void) SetImageProperty(image,"tiff:subfiletype","MASK",exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MINSAMPLEVALUE,&value) == 1)
      min_sample_value=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MAXSAMPLEVALUE,&value) == 1)
      max_sample_value=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XPOSITION,&value) == 1)
      x_position=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YPOSITION,&value) == 1)
      y_position=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_WHITEPOINT,&chromaticity) == 1)
      {
        if ((chromaticity != (float *) NULL) && (*chromaticity != 0.0))
          {
            image->chromaticity.white_point.x=chromaticity[0];
            image->chromaticity.white_point.y=chromaticity[1];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PRIMARYCHROMATICITIES,&chromaticity) == 1)
      {
        if ((chromaticity != (float *) NULL) && (*chromaticity != 0.0))
          {
            image->chromaticity.red_primary.x=chromaticity[0];
            image->chromaticity.red_primary.y=chromaticity[1];
            image->chromaticity.green_primary.x=chromaticity[2];
            image->chromaticity.green_primary.y=chromaticity[3];
            image->chromaticity.blue_primary.x=chromaticity[4];
            image->chromaticity.blue_primary.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YCBCRSUBSAMPLING,&horizontal,
        &vertical) == 1)
      {
        (void) FormatLocaleString(sampling_factor,MagickPathExtent,
          "%dx%d",horizontal,vertical);
        (void) SetImageProperty(image,"jpeg:sampling-factor",
          sampling_factor,exception);
        (void) LogMagickEvent(CoderEvent,GetMagickModule(),
          "Sampling Factors: %s",sampling_factor);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&value) == 1)
      image->orientation=(OrientationType) value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&value) == 1)
      image->units=value;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&value) == 1)
      image->resolution.x=