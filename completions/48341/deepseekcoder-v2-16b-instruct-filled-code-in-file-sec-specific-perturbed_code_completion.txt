image->colormap[i].green=ClampToQuantum(((double)
                    QuantumRange*green_colormap[i])/range);
                  image->colormap[i].blue=ClampToQuantum(((double)
                    QuantumRange*blue_colormap[i])/range);
                }
              }
          }
      }
    if (photometric == PHOTOMETRIC_SEPARATED)
      {
        size_t
          channels;

        channels=3;
        if (image->colorspace == CMYKColorspace)
          channels=4;
        if (AcquireImagePixelCache(image,channels,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_YCBCR)
      {
        size_t
          channels;

        channels=3;
        if (image->colorspace == YCbCrColorspace)
          channels=3;
        if (AcquireImagePixelCache(image,channels,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_CIELAB)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_LOGL)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_LOGLUV)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_PALETTE)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_RGB)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_MINISBLACK)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_MINISWHITE)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_CMYK)
      {
        if (AcquireImagePixelCache(image,4,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_MASK)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_YCBCR)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_CIELAB)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_LOGL)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_LOGLUV)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_PALETTE)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_RGB)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_MINISBLACK)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_MINISWHITE)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_CMYK)
      {
        if (AcquireImagePixelCache(image,4,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_MASK)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_YCBCR)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_CIELAB)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_LOGL)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_LOGLUV)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_PALETTE)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_RGB)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_MINISBLACK)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_MINISWHITE)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_CMYK)
      {
        if (AcquireImagePixelCache(image,4,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_MASK)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_YCBCR)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_CIELAB)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_LOGL)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_LOGLUV)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_PALETTE)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_RGB)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_MINISBLACK)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_MINISWHITE)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_CMYK)
      {
        if (AcquireImagePixelCache(image,4,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_MASK)
      {
        if (AcquireImagePixelCache(image,1,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_YCBCR)
      {
        if (AcquireImagePixelCache(image,3,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (photometric == PHOTOMETRIC_CIELAB)
      {
        if (AcquireImagePixelCache(image,3,exception) ==