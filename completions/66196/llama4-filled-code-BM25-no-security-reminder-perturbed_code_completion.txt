if (version == 3) {
    lidx = (layer == 1) ? 0 : layer - 1;
    if (lidx > 2) {
        GF_LOG(GF_LOG_ERROR, GF_LOG_CODEC, ("Invalid layer index for MPEG-1\n"));
        return 0;
    }
} else {
    lidx = (layer == 1) ? 1 : layer;
    if (lidx > 2) {
        GF_LOG(GF_LOG_ERROR, GF_LOG_CODEC, ("Invalid layer index for MPEG-2/2.5\n"));
        return 0;
    }
}

static const u32 bitrates[3][3][16] = {
    /* MPEG-1 */
    {
        {0, 32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, -1}, // Layer 1
        {0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, -1}, // Layer 2
        {0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, -1} // Layer 3
    },
    /* MPEG-2, 2.5 */
    {
        {0, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, -1}, // Layer 1
        {0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, -1}, // Layer 2
        {0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, -1} // Layer 3
    },
    /* MPEG-2.5 */
    {
        {0, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, -1}, // Layer 1
        {0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, -1}, // Layer 2
        {0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, -1} // Layer 3
    }
};

if (bitrateIdx == 0xF) {
    // Bad bitrate index
    GF_LOG(GF_LOG_ERROR, GF_LOG_CODEC, ("Invalid bitrate index\n"));
    return 0;
}

return bitrates[lidx][version == 3 ? 0 : (version == 2 ? 1 : 2)][bitrateIdx];