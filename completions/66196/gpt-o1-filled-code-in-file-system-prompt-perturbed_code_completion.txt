if (version == 1) {
    GF_LOG(GF_LOG_ERROR, GF_LOG_CODING, ("[MPEG] Reserved MPEG version (1) found, invalid.\n"));
    return 0;
}

if (bitrateIdx == 0 || bitrateIdx == 0xF) {
    GF_LOG(GF_LOG_ERROR, GF_LOG_CODING, ("[MPEG] Invalid or free bitrate index %u\n", bitrateIdx));
    return 0;
}

switch (version) {
case 3: /* MPEG-1 */
    switch (layer) {
    case 1: lidx = 0; break; /* Layer I   -> table row 0 */
    case 2: lidx = 1; break; /* Layer II  -> table row 1 */
    case 3: lidx = 2; break; /* Layer III -> table row 2 */
    default:
        GF_LOG(GF_LOG_ERROR, GF_LOG_CODING, ("[MPEG] Invalid layer %u for MPEG-1\n", layer));
        return 0;
    }
    break;

case 2: /* MPEG-2 */
case 0: /* MPEG-2.5 */
    if (layer == 1) {
        /* Layer I -> table row 3 */
        lidx = 3;
    } else {
        /* Layer II or III -> table row 4 */
        lidx = 4;
    }
    break;

default:
    /* Version is reserved or unsupported */
    GF_LOG(GF_LOG_ERROR, GF_LOG_CODING, ("[MPEG] Invalid or reserved version %u\n", version));
    return 0;
}

/* Return the corresponding bitrate from the pre-defined table */
return bitrate_table[lidx][bitrateIdx];