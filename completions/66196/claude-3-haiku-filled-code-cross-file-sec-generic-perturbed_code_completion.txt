// Determine the appropriate layer index based on the MPEG version and layer information.
if (version == 3) {
    if (layer == 1) {
        lidx = 0;
    } else if (layer == 2) {
        lidx = 1;
    } else if (layer == 3) {
        lidx = 2;
    } else {
        GF_LOG(GF_LOG_ERROR, GF_LOG_PARSER, ("[MP3] Invalid layer %d for MPEG-1\n", layer));
        return 0;
    }
} else { // MPEG-2 or MPEG-2.5
    if (layer == 1) {
        lidx = 3;
    } else if (layer == 2) {
        lidx = 4;
    } else if (layer == 3) {
        lidx = 5;
    } else {
        GF_LOG(GF_LOG_ERROR, GF_LOG_PARSER, ("[MP3] Invalid layer %d for MPEG-2/2.5\n", layer));
        return 0;
    }
}

// Validate the calculated layer index, logging an error and returning 0 if invalid.
if (lidx >= 6) {
    GF_LOG(GF_LOG_ERROR, GF_LOG_PARSER, ("[MP3] Invalid layer index %d\n", lidx));
    return 0;
}

// Return the bitrate value from a pre-defined bitrate table using the layer and bitrate index.
static const u32 bitrates[6][16] = {
    {0, 32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, 0},
    {0, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, 0},
    {0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 0},
    {0, 32, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256, 0},
    {0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, 0},
    {0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, 0}
};

return bitrates[lidx][bitrateIdx];