// <MASK>
u32 lidx;
if (version == 3) {
    if (layer == 1) {
        lidx = bitrateIdx;
    } else if (layer == 2) {
        lidx = bitrateIdx + 4;
    } else if (layer == 3) {
        lidx = bitrateIdx + 8;
    } else {
        GF_LOG(GF_LOG_ERROR, GF_LOG_PARSER, ("[MP3] Invalid layer %d for MPEG-1\n", layer));
        return 0;
    }
} else {
    if (layer == 1) {
        lidx = bitrateIdx + 16;
    } else if (layer == 2) {
        lidx = bitrateIdx + 20;
    } else if (layer == 3) {
        lidx = bitrateIdx + 24;
    } else {
        GF_LOG(GF_LOG_ERROR, GF_LOG_PARSER, ("[MP3] Invalid layer %d for MPEG-2/2.5\n", layer));
        return 0;
    }
}

if (lidx > 27) {
    GF_LOG(GF_LOG_ERROR, GF_LOG_PARSER, ("[MP3] Invalid bitrate index %d\n", bitrateIdx));
    return 0;
}

return mp3_bitrate_table[lidx];