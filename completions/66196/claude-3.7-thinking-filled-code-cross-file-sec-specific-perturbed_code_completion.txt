if (version == 3) {
    /*MPEG-1*/
    if (layer == 1) lidx = 0;
    else if (layer == 2) lidx = 1;
    else if (layer == 3) lidx = 2;
    else {
        GF_LOG(GF_LOG_ERROR, GF_LOG_CODING, ("[MP3] Invalid layer %d for MPEG-1\n", layer));
        return 0;
    }
} else if ((version == 2) || (version == 0)) {
    /*MPEG-2 or MPEG-2.5*/
    if (layer == 1) lidx = 3;
    else if (layer == 2 || layer == 3) lidx = 4;
    else {
        GF_LOG(GF_LOG_ERROR, GF_LOG_CODING, ("[MP3] Invalid layer %d for MPEG-2/2.5\n", layer));
        return 0;
    }
} else {
    GF_LOG(GF_LOG_ERROR, GF_LOG_CODING, ("[MP3] Invalid MPEG version %d\n", version));
    return 0;
}

if (bitrateIdx == 0 || bitrateIdx == 15) return 0;
if (bitrateIdx > 14) {
    GF_LOG(GF_LOG_ERROR, GF_LOG_CODING, ("[MP3] Invalid bitrate index %d\n", bitrateIdx));
    return 0;
}

/*bitrate table for MPEG-1, MPEG-2 and MPEG-2.5
  first dimension: 0: MPEG-1 layer 1, 1: MPEG-1 layer 2, 2: MPEG-1 layer 3,
                   3: MPEG-2/2.5 layer 1, 4: MPEG-2/2.5 layer 2/3
  second dimension: bitrate index from header (1-14)
*/
static const u16 bitRateTable[5][14] = {
    {32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448}, /*MPEG-1 Layer 1*/
    {32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384},    /*MPEG-1 Layer 2*/
    {32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320},     /*MPEG-1 Layer 3*/
    {32, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256},    /*MPEG-2/2.5 Layer 1*/
    {8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160}          /*MPEG-2/2.5 Layer 2/3*/
};

return bitRateTable[lidx][bitrateIdx-1];