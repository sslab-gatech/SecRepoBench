u32 gf_mp3_bit_rate(u32 hdr)
{
	u8 version = gf_mp3_version(hdr);
	u8 layer = gf_mp3_layer(hdr);
	u8 bitrateIdx = (hdr >> 12) & 0xF;
	u32 lidx;

	// Determine the appropriate layer index based on the MPEG version and layer information.
	if (version == 3) {
		if (layer == 3) lidx = 0;
		else if (layer == 2) lidx = 1;
		else if (layer == 1) lidx = 2;
		else if (layer == 0) lidx = 3;
		else lidx = 0;
	}
	else {
		if (layer == 3) lidx = 0;
		else if (layer == 2) lidx = 1;
		else if (layer == 1) lidx = 2;
		else if (layer == 0) lidx = 3;
		else lidx = 0;
	}

	// Validate the calculated layer index, logging an error and returning 0 if invalid.
	if (lidx < 0 || lidx > 3) {
		// Log an error
		return 0;
	}

	// Calculate the bitrate value from a pre-defined bitrate table using the layer and bitrate index.
	u32 bitrate = 0;
	switch (lidx) {
	case 0:
		switch (bitrateIdx) {
		case 0: bitrate = 32; break;
		case 1: bitrate = 40; break;
		case 2: bitrate = 48; break;
		case 3: bitrate = 56; break;
		case 4: bitrate = 64; break;
		case 5: bitrate = 80; break;
		case 6: bitrate = 96; break;
		case 7: bitrate = 112; break;
		case 8: bitrate = 128; break;
		case 9: bitrate = 160; break;
		case 10: bitrate = 192; break;
		case 11: bitrate = 224; break;
		case 12: bitrate = 256; break;
		case 13: bitrate = 320; break;
		case 14: bitrate = 384; break;
		case 15: bitrate = 448; break;
		}
		break;
	case 1:
		switch (bitrateIdx) {
		case 0: bitrate = 32; break;
		case 1: bitrate = 40; break;
		case 2: bitrate = 48; break;
		case 3: bitrate = 56; break;
		case 4: bitrate = 64; break;
		case 5: bitrate = 80; break;
		case 6: bitrate = 96; break;
		case 7: bitrate = 112; break;
		case 8: bitrate = 128; break;
		case 9: bitrate = 160; break;
		case 10: bitrate = 192; break;
		case 11: bitrate = 224; break;
		case 12: bitrate = 256; break;
		case 13: bitrate = 320; break;
		case 14: bitrate = 384; break;
		case 15: bitrate = 448; break;
		}
		break;
	case 2:
		switch (bitrateIdx) {
		case 0: bitrate = 32; break;
		case 1: bitrate = 40; break;
		case 2: bitrate = 48; break;
		case 3: bitrate = 56; break;
		case 4: bitrate = 64; break;
		case 5: bitrate = 80; break;
		case 6: bitrate = 96; break;
		case 7: bitrate = 112; break;
		case 8: bitrate = 128; break;
		case 9: bitrate = 160; break;
		case 10: bitrate = 192; break;
		case 11: bitrate = 224; break;
		case 12: bitrate = 256; break;
		case 13: bitrate = 320; break;
		case 14: bitrate = 384; break;
		case 15: bitrate = 448; break;
		}
		break;
	case 3:
		switch (bitrateIdx) {
		case 0: bitrate = 32; break;
		case 1: bitrate = 40; break;
		case 2: bitrate = 48; break;
		case 3: bitrate = 56; break;
		case 4: bitrate = 64; break;
		case 5: bitrate = 80; break;
		case 6: bitrate = 96; break;
		case 7: bitrate = 112; break;
		case 8: bitrate = 128; break;
		case 9: bitrate = 160; break;
		case 10: bitrate = 192; break;
		case 11: bitrate = 224; break;
		case 12: bitrate = 256; break;
		case 13: bitrate = 320; break;
		case 14: bitrate = 384; break;
		case 15: bitrate = 448; break;
		}
		break;
	}

	// Return the bitrate value
	return bitrate;
}