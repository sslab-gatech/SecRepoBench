if (version == 1 || layer == 0 || bitrateIdx == 0 || bitrateIdx == 15) {
    // Invalid header
    return 0;
}

if (version == 3) {
    // MPEG-1
    lidx = 3 - layer;
} else {
    // MPEG-2 or MPEG-2.5
    if (layer == 1) {
        lidx = 3;
    } else {
        lidx = 4;
    }
}

static const u16 bitrates[5][16] = {
    {0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 0}, // Layer III
    {0, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, 0}, // Layer II
    {0, 32, 64, 96, 128, 160, 192, 224, 256, 320, 384, 448, 512, 576, 640, 0}, // Layer I
    {0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256}, // MPEG-2/2.5 Layer III
    {0, 32, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256, 320}  // MPEG-2/2.5 Layer II
};

if (lidx >= 5 || bitrateIdx >= 16) {
    // Invalid layer index or bitrate index
    return 0;
}

return bitrates[lidx][bitrateIdx] * 1000;