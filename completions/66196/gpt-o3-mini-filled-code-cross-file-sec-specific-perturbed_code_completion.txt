if (bitrateIdx == 0 || bitrateIdx == 15) {
    gf_log(GF_LOG_ERROR, "Invalid bitrate index: %u", bitrateIdx);
    return 0;
}

static const u32 bitrateTabMPEG1[3][16] = {
    {0, 32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, 0},
    {0, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, 0},
    {0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 0}
};

static const u32 bitrateTabMPEG2[3][16] = {
    {0, 32, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256, 0},
    {0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, 0},
    {0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, 0}
};

if (version == 3) {
    switch (layer) {
        case 3:
            lidx = 0;
            break;
        case 2:
            lidx = 1;
            break;
        case 1:
            lidx = 2;
            break;
        default:
            gf_log(GF_LOG_ERROR, "Invalid MPEG layer: %u", layer);
            return 0;
    }
    return bitrateTabMPEG1[lidx][bitrateIdx] * 1000;
} else if (version == 2 || version == 0) {
    switch (layer) {
        case 3:
            lidx = 0;
            break;
        case 2:
            lidx = 1;
            break;
        case 1:
            lidx = 2;
            break;
        default:
            gf_log(GF_LOG_ERROR, "Invalid MPEG layer: %u", layer);
            return 0;
    }
    return bitrateTabMPEG2[lidx][bitrateIdx] * 1000;
} else {
    gf_log(GF_LOG_ERROR, "Unsupported MPEG version: %u", version);
    return 0;
}