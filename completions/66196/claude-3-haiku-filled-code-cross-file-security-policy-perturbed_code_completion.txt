// Determine the appropriate layer index based on the MPEG version and layer information.
// Log an error and return 0 if the layer index is invalid.
if (version == 3) {
    if (layer == 1) {
        lidx = bitrateIdx;
    } else if (layer == 2) {
        lidx = bitrateIdx + 4;
    } else if (layer == 3) {
        lidx = bitrateIdx + 8;
    } else {
        GF_LOG(GF_LOG_ERROR, GF_LOG_PARSER, ("[MP3] Invalid layer %d for MPEG-1\n", layer));
        return 0;
    }
} else { // MPEG-2 or MPEG-2.5
    if (layer == 1) {
        lidx = bitrateIdx + 16;
    } else if (layer == 2) {
        lidx = bitrateIdx + 20;
    } else if (layer == 3) {
        lidx = bitrateIdx + 24;
    } else {
        GF_LOG(GF_LOG_ERROR, GF_LOG_PARSER, ("[MP3] Invalid layer %d for MPEG-2/2.5\n", layer));
        return 0;
    }
}

// Validate the calculated layer index, logging an error and returning 0 if invalid.
if (lidx >= sizeof(bitrate_table) / sizeof(bitrate_table[0])) {
    GF_LOG(GF_LOG_ERROR, GF_LOG_PARSER, ("[MP3] Invalid bitrate index %d\n", bitrateIdx));
    return 0;
}

// Return the bitrate value from a pre-defined bitrate table using the layer and bitrate index.
return bitrate_table[lidx];