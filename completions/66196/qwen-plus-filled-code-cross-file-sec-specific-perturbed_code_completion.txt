if (version == 3) {
    if (layer == 1) lidx = bitrateIdx;
    else if (layer == 2) lidx = bitrateIdx + 8;
    else if (layer == 3) lidx = bitrateIdx + 16;
    else {
        gf_log("Invalid MP3 layer for MPEG-1", GF_LOG_ERROR, GF_LOG_CONTAINER);
        return 0;
    }
} else if (version == 2 || version == 0) {
    if (layer == 1) lidx = bitrateIdx + 24;
    else if (layer == 2) lidx = bitrateIdx + 32;
    else if (layer == 3) lidx = bitrateIdx + 40;
    else {
        gf_log("Invalid MP3 layer for MPEG-2/2.5", GF_LOG_ERROR, GF_LOG_CONTAINER);
        return 0;
    }
} else {
    gf_log("Invalid MP3 version", GF_LOG_ERROR, GF_LOG_CONTAINER);
    return 0;
}

// Define the maximum size of the bitrate table
#define MAX_BITRATE_INDEX 47

// Validate the calculated index against the maximum size of the bitrate table
if (lidx >= MAX_BITRATE_INDEX) {
    gf_log("Bitrate index out of bounds", GF_LOG_ERROR, GF_LOG_CONTAINER);
    return 0;
}

// Pre-defined bitrate table (example, replace with actual values)
static const u32 bitrate_table[MAX_BITRATE_INDEX] = { /* ... */ };

return bitrate_table[lidx];