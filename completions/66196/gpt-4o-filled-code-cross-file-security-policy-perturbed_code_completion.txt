if (version == 1 || layer == 0 || bitrateIdx == 0 || bitrateIdx == 15) {
		// Invalid version, layer, or bitrate index
		fprintf(stderr, "Invalid MP3 header: version=%d, layer=%d, bitrateIdx=%d\n", version, layer, bitrateIdx);
		return 0;
	}

	// Determine layer index
	if (version == 3) {
		// MPEG-1
		lidx = 3 - layer;
	} else {
		// MPEG-2 or MPEG-2.5
		if (layer == 1) {
			lidx = 3;
		} else if (layer == 2) {
			lidx = 4;
		} else {
			lidx = 5;
		}
	}

	// Validate layer index
	if (lidx > 5) {
		fprintf(stderr, "Invalid layer index: %d\n", lidx);
		return 0;
	}

	// Bitrate table for MPEG-1 and MPEG-2/2.5
	static const u16 bitrate_table[6][16] = {
		{0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 0},  // Layer I
		{0, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, 0}, // Layer II
		{0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 0},  // Layer III
		{0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256}, // MPEG-2 Layer I
		{0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, 0},      // MPEG-2 Layer II
		{0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, 0}       // MPEG-2 Layer III
	};

	// Validate bitrate index
	if (bitrateIdx >= 16) {
		fprintf(stderr, "Invalid bitrate index: %d\n", bitrateIdx);
		return 0;
	}

	return bitrate_table[lidx][bitrateIdx] * 1000;