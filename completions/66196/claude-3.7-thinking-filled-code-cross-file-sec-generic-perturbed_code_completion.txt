/*MPEG-1*/
if (version == 3) {
    if (layer == 0) {
        GF_LOG(GF_LOG_ERROR, GF_LOG_MEDIA, ("[MP3] Invalid Layer 0 in MPEG-1\n"));
        return 0;
    }
    // For MPEG-1: Layer I -> lidx 0, Layer II -> lidx 1, Layer III -> lidx 2
    lidx = 3 - layer;
} else if (version == 2 || version == 0) {
    if (layer == 0) {
        GF_LOG(GF_LOG_ERROR, GF_LOG_MEDIA, ("[MP3] Invalid Layer 0 in MPEG-2/2.5\n"));
        return 0;
    }
    // For MPEG-2/2.5: Layer I -> lidx 3, Layer II/III -> lidx 4
    lidx = (layer == 3) ? 3 : 4;
} else {
    GF_LOG(GF_LOG_ERROR, GF_LOG_MEDIA, ("[MP3] Invalid MPEG version %d\n", version));
    return 0;
}

if (lidx > 4) {
    GF_LOG(GF_LOG_ERROR, GF_LOG_MEDIA, ("[MP3] Invalid Layer Index %d\n", lidx));
    return 0;
}

// Bitrate tables for different MPEG versions and layers (in kbps)
static const u16 bitrate_table[5][16] = {
    {0, 32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, 0}, /* MPEG-1, Layer I */
    {0, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, 0},    /* MPEG-1, Layer II */
    {0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 0},     /* MPEG-1, Layer III */
    {0, 32, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256, 0},    /* MPEG-2/2.5, Layer I */
    {0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, 0}          /* MPEG-2/2.5, Layer II/III */
};

// Return bitrate in bits per second
return bitrate_table[lidx][bitrateIdx] * 1000;