if (layer < 1 || layer > 3) {
    gf_log(GF_LOG_ERROR, "Invalid MP3 layer %d\n", layer);
    return 0;
}
if (bitrateIdx == 0 || bitrateIdx == 0xF) {
    gf_log(GF_LOG_ERROR, "Invalid MP3 bitrate index %d\n", bitrateIdx);
    return 0;
}

/* Set the table row based on MPEG version and layer */
if (version == 3) {
    /* MPEG-1 */
    lidx = layer - 1;
} else if (version == 2 || version == 0) {
    /* MPEG-2 / 2.5 */
    lidx = (layer - 1) + 3;
} else {
    gf_log(GF_LOG_ERROR, "Invalid MP3 version %d\n", version);
    return 0;
}

/* Make sure our table lookup won't overflow */
if (lidx > 5) {
    gf_log(GF_LOG_ERROR, "Invalid layer index %d\n", lidx);
    return 0;
}

/* Return the bitrate from our table */
return gf_mpeg_bitrate_table[lidx][bitrateIdx];