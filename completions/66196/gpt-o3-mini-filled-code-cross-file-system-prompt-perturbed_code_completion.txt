if (version == 3) {
        if (layer == 3)
            lidx = 0; /* MPEG-1, Layer I */
        else if (layer == 2)
            lidx = 1; /* MPEG-1, Layer II */
        else if (layer == 1)
            lidx = 2; /* MPEG-1, Layer III */
        else {
            fprintf(stderr, "gf_mp3_bit_rate: Invalid MPEG layer %d for MPEG-1\n", layer);
            return 0;
        }
    } else {
        if (layer == 3)
            lidx = 3; /* MPEG-2/2.5, Layer I */
        else if (layer == 2 || layer == 1)
            lidx = 4; /* MPEG-2/2.5, Layer II & III share the same table */
        else {
            fprintf(stderr, "gf_mp3_bit_rate: Invalid MPEG layer %d for MPEG-2/2.5\n", layer);
            return 0;
        }
    }

    if (bitrateIdx == 0 || bitrateIdx == 15) {
        fprintf(stderr, "gf_mp3_bit_rate: Invalid bitrate index %d\n", bitrateIdx);
        return 0;
    }

    static const u32 bitrates[5][16] = {
        /* MPEG-1 Layer I */
        {0, 32000, 64000, 96000, 128000, 160000, 192000, 224000, 256000, 288000, 320000, 352000, 384000, 416000, 448000, 0},
        /* MPEG-1 Layer II */
        {0, 32000, 48000, 56000, 64000, 80000, 96000, 112000, 128000, 160000, 192000, 224000, 256000, 320000, 384000, 0},
        /* MPEG-1 Layer III */
        {0, 32000, 40000, 48000, 56000, 64000, 80000, 96000, 112000, 128000, 160000, 192000, 224000, 256000, 320000, 0},
        /* MPEG-2/2.5 Layer I */
        {0, 32000, 48000, 56000, 64000, 80000, 96000, 112000, 128000, 144000, 160000, 176000, 192000, 224000, 256000, 0},
        /* MPEG-2/2.5 Layer II & III */
        {0, 8000, 16000, 24000, 32000, 40000, 48000, 56000, 64000, 80000, 96000, 112000, 128000, 144000, 160000, 0}
    };

    return bitrates[lidx][bitrateIdx];