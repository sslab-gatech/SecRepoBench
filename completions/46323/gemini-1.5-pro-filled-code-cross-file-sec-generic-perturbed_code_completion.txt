if (copy == NULL) {
                xmlFreeNode(copyNode);
                return NULL;
            }
            if (copy->type == XML_TEXT_NODE) {
                if (insert->last != NULL && insert->last->type == XML_TEXT_NODE) {
                    // Merge text nodes
                    int len = xmlStrlen(insert->last->content);
                    int len2 = xmlStrlen(copy->content);

                    if (len2 > 0) {
                        xmlChar *new_content = (xmlChar *) xmlRealloc(insert->last->content,
                                                                    (len + len2 + 1) * sizeof(xmlChar));
                        if (new_content == NULL) {
                            xmlFreeNode(copyNode);
                            xmlTreeErrMemory("copying node");
                            return NULL;
                        }
                        insert->last->content = new_content;
                        memcpy(&insert->last->content[len], copy->content, len2 * sizeof(xmlChar));
                        insert->last->content[len + len2] = 0;
                    }
                    xmlFreeNode(copy);
                    continue;
                }
            }
            if (insert->children == NULL) {
                insert->children = copy;
            } else {
                insert->last->next = copy;
                copy->prev = insert->last;
            }
            insert->last = copy;