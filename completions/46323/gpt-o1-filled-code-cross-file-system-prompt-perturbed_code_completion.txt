if (copy == NULL) {
    /* The node couldn't be copied, skip it. */
} else {
    copy->parent = insert;
    if (insert->last == NULL) {
        insert->children = copy;
    } else {
        insert->last->next = copy;
        copy->prev = insert->last;
    }
    while (copy->next != NULL) {
        copy->next->parent = insert;
        copy = copy->next;
    }
    insert->last = copy;
}