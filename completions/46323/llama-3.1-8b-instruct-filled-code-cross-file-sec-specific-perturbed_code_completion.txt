if (cur->children!= NULL) {
    xmlNodePtr copy = xmlStaticCopyNode(cur, doc, insert, 2);
    if (copy!= NULL) {
        xmlAddChild(insert, copy);
    }
} else {
    cur = cur->parent;
    insert = insert->parent;
    if (cur == node) {
        cur = NULL;
    }
}