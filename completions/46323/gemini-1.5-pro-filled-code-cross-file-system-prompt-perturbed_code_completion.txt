if (copy == NULL) {
                cur = cur->next;
                continue;
            }
            if (copy->type == XML_TEXT_NODE) {
                if (insert->last != NULL && insert->last->type == XML_TEXT_NODE) {
                    // Merge text nodes
                    int len = xmlStrlen(insert->last->content);
                    int len2 = xmlStrlen(copy->content);
                    xmlChar *new_content = xmlRealloc(insert->last->content, len + len2 + 1);
                    if (new_content) {
                        memcpy(&new_content[len], copy->content, len2);
                        new_content[len + len2] = '\0';
                        insert->last->content = new_content;
                        xmlFree(copy->content);
                        xmlFree(copy);
                        copy = NULL;
                    } else {
                        xmlTreeErrMemory("merging text nodes");
                    }
                }
            }
            if (copy != NULL) {
                if (insert->children == NULL) {
                    insert->children = copy;
                }
                if (insert->last == NULL) {
                    insert->last = copy;
                } else {
                    insert->last->next = copy;
                    copy->prev = insert->last;
                    insert->last = copy;
                }
            }