if (copy == NULL) {
    continue;
}

if (copy->type == XML_ELEMENT_NODE) {
    if (insert->last != NULL) {
        insert->last->next = copy;
        copy->prev = insert->last;
        insert->last = copy;
    } else {
        insert->children = copy;
        insert->last = copy;
    }
} else {
    if (insert->children == NULL) {
        insert->children = copy;
        insert->last = copy;
    } else {
        insert->last->next = copy;
        copy->prev = insert->last;
        insert->last = copy;
    }
}