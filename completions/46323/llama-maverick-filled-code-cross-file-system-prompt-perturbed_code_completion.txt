if (copy == NULL) {
    /*
     * Skip the node and its subtree. Walk to the next sibling or
     * to the next node in a depth-first traversal.
     */
    while (1) {
        if (cur->next != NULL) {
            cur = cur->next;
            break;
        }

        cur = cur->parent;
        insert = insert->parent;
        if (cur == node) {
            cur = NULL;
            break;
        }
    }
    continue;
}
xmlAddChild(insert, copy);