if (copy == NULL) {
    return(NULL);
}
if (cur->type == XML_TEXT_NODE || cur->type == XML_CDATA_SECTION_NODE) {
    copy->content = xmlStrdup(cur->content);
} else if (cur->type == XML_ELEMENT_NODE) {
    copy->children = xmlCopyNode(cur->children, doc, extended);
    if (copy->children != NULL) {
        copy->last = copy->children;
        while (copy->children->next != NULL) {
            copy->children = copy->children->next;
        }
        copy->children->next = NULL;
    }
} else if (cur->type == XML_ENTITY_REF_NODE) {
    copy->children = xmlGetDocEntity(doc, cur->name);
    if (copy->children != NULL) {
        copy->last = copy->children;
        while (copy->children->next != NULL) {
            copy->children = copy->children->next;
        }
        copy->children->next = NULL;
    }
} else if (cur->type == XML_XINCLUDE_START || cur->type == XML_XINCLUDE_END) {
    copy->children = xmlCopyNode(cur->children, doc, extended);
    if (copy->children != NULL) {
        copy->last = copy->children;
        while (copy->children->next != NULL) {
            copy->children = copy->children->next;
        }
        copy->children->next = NULL;
    }
}