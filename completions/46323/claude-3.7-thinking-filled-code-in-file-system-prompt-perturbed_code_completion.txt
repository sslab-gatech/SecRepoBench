if (copy == NULL) {
    /* Skip this node on error */
    continue;
}

/* Link the copy to its parent */
if (insert->children == NULL) {
    insert->children = copy;
} else {
    xmlNodePtr tmp = insert->children;
    while (tmp->next != NULL)
        tmp = tmp->next;
    tmp->next = copy;
    copy->prev = tmp;
}
insert->last = copy;