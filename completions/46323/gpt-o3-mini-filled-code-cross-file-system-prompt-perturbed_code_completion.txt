if (copy == NULL) {
    /* If the node copy failed, skip processing its children and
       continue the depth-first traversal with the next sibling */
    while (cur != NULL) {
        if (cur->next != NULL) {
            cur = cur->next;
            break;
        }
        cur = cur->parent;
        insert = insert->parent;
        if (cur == node) {
            cur = NULL;
            break;
        }
    }
    continue;
}