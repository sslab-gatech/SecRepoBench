if (copy != NULL) {
    if (copy->parent != NULL) {
        if (copy->parent->children == copy)
            copy->parent->children = copy->next;
        if (copy->parent->last == copy)
            copy->parent->last = copy->prev;
    }
    if (copy->prev != NULL)
        copy->prev->next = copy->next;
    if (copy->next != NULL)
        copy->next->prev = copy->prev;
    copy->parent = insert;
    copy->prev = NULL;
    copy->next = NULL;
    if (insert->children == NULL) {
        insert->children = copy;
        insert->last = copy;
    } else {
        insert->last->next = copy;
        copy->prev = insert->last;
        insert->last = copy;
    }
}