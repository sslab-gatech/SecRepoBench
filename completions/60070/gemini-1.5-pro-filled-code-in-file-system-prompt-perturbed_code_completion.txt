if (method_length > 0 && thrift_validate_method(method, method_length)) {
    if (method_length <= sizeof(flow->protos.thrift.method)) {
      strncpy(flow->protos.thrift.method, method, method_length);
      flow->protos.thrift.method[method_length] = '\0'; // Null-terminate
    } else {
      // Method name is too long to store, handle appropriately (e.g., truncate or ignore)
      strncpy(flow->protos.thrift.method, method, sizeof(flow->protos.thrift.method) - 1);
      flow->protos.thrift.method[sizeof(flow->protos.thrift.method) - 1] = '\0';
      ndpi_set_risk(ndpi_struct, flow, NDPI_APPLICATION_RISK, "Thrift method name truncated");
    }
  } else {
    flow->protos.thrift.method[0] = '\0'; // Clear method field
    ndpi_set_risk(ndpi_struct, flow, NDPI_MALFORMED_PACKET, "Invalid Thrift method");
  }