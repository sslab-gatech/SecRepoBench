if (thrift_validate_method(method, methodlen)) {
    if (methodlen < sizeof(flow->protos.thrift.method)) {
      memcpy(flow->protos.thrift.method, method, methodlen);
      flow->protos.thrift.method[methodlen] = '\0'; // Null-terminate the string
    } else {
      ndpi_set_risk(ndpi_struct, flow, NDPI_MALFORMED_PACKET, "Method name too long");
      memset(flow->protos.thrift.method, 0, sizeof(flow->protos.thrift.method));
    }
  } else {
    ndpi_set_risk(ndpi_struct, flow, NDPI_MALFORMED_PACKET, "Invalid method name");
    memset(flow->protos.thrift.method, 0, sizeof(flow->protos.thrift.method));
  }