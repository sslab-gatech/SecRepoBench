if (method == NULL || methodlen == 0 || methodlen >= sizeof(flow->method)) {
    // Invalid method, set risk flag and clear the method field
    flow->risk |= NDPI_THREAT_INVALID_METHOD;
    memset(flow->method, 0, sizeof(flow->method));
  } else {
    // Valid method, copy it into the flow's method field
    strncpy(flow->method, method, methodlen);
    flow->method[methodlen] = '\0'; // Ensure null termination
  }