if (thrift_validate_method(method, methodlen)) {
  size_t max_copy = sizeof(flow->protos.thrift.method) - 1;
  size_t copy_len = methodlen < max_copy ? methodlen : max_copy;
  
  memcpy(flow->protos.thrift.method, method, copy_len);
  flow->protos.thrift.method[copy_len] = '\0'; // Ensure null termination
} else {
  ndpi_set_risk(ndpi_struct, flow, NDPI_MALFORMED_PACKET, "Invalid method name");
  memset(flow->protos.thrift.method, 0, sizeof(flow->protos.thrift.method));
}