static void thrift_set_method(struct ndpi_detection_module_struct *ndpi_struct,
                              struct ndpi_flow_struct *flow,
                              char const * const method, size_t methodlen)
{
  if (methodlen > NDPI_MAX_METHOD_LENGTH) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  if (thrift_validate_method(method, methodlen) == 0) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  if (flow->detected_protocol_stack[0] == NDPI_PROTOCOL_THRIFT) {
    /* Update the method field of the flow's protocol stack. */
    flow->detected_protocol_stack[1] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[2] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[3] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[4] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[5] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[6] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[7] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[8] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[9] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[10] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[11] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[12] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[13] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[14] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[15] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[16] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[17] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[18] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[19] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[20] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[21] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[22] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[23] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[24] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[25] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[26] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[27] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[28] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[29] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[30] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[31] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[32] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[33] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[34] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[35] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[36] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[37] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[38] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[39] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[40] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[41] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[42] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[43] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[44] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[45] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[46] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[47] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[48] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[49] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[50] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[51] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[52] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[53] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[54] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[55] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[56] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[57] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[58] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[59] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[60] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[61] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[62] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[63] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[64] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[65] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[66] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[67] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[68] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[69] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[70] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[71] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[72] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[73] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[74] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[75] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[76] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[77] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[78] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[79] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[80] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[81] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[82] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[83] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[84] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[85] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[86] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[87] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[88] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[89] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[90] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[91] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[92] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[93] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[94] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[95] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[96] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[97] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[98] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[99] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[100] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[101] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[102] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[103] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[104] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[105] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[106] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[107] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[108] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[109] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[110] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[111] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[112] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[113] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[114] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[115] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[116] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[117] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[118] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[119] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[120] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[121] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[122] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[123] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[124] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[125] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[126] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[127] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[128] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[129] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[130] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[131] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[132] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[133] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[134] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[135] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[136] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[137] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[138] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[139] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[140] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[141] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[142] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[143] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[144] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[145] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[146] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[147] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[148] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[149] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[150] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[151] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[152] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[153] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[154] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[155] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[156] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[157] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[158] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[159] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[160] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[161] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[162] = NDPI_PROTOCOL_THRIFT;
    flow->detected_protocol_stack[163] = NDPI_PROTOCOL_TH