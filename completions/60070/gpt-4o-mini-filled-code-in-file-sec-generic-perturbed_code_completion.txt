if (thrift_validate_method(method, methodlen)) {
    // Allocate memory for the method and copy it to the flow structure
    flow->protos.thrift.method = (char *)ndpi_malloc(methodlen + 1);
    if (flow->protos.thrift.method != NULL) {
      memcpy(flow->protos.thrift.method, method, methodlen);
      flow->protos.thrift.method[methodlen] = '\0'; // Null-terminate the string
    } else {
      ndpi_set_risk(ndpi_struct, flow, NDPI_MEMORY_ALLOCATION_ERROR, "Failed to allocate memory for method");
    }
  } else {
    ndpi_set_risk(ndpi_struct, flow, NDPI_INVALID_METHOD, "Invalid method name");
    flow->protos.thrift.method = NULL; // Clear the method field
  }