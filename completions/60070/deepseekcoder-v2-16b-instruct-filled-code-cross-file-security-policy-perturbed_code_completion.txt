if (methodlen > 0 && methodlen <= NDPI_MAX_METHOD_LEN) {
    char method_copy[NDPI_MAX_METHOD_LEN + 1];
    strncpy(method_copy, method, methodlen);
    method_copy[methodlen] = '\0';
    flow->method = strdup(method_copy);
  } else {
    flow->risk |= NDPI_BITMASK_PROTOCOL_RISK_INVALID_METHOD;
    flow->method = NULL;
  }