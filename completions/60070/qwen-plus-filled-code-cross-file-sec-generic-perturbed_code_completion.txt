if (methodlen > 0 && methodlen < 256) { // Assuming 256 is a safe upper limit for method names
    ndpi_set_field_string(flow, NDPI_FIELD_METHOD, method, methodlen);
} else {
    ndpi_set_risk(ndpi_struct, flow, NDPI_RISK_INVALID_THRIFT_METHOD);
    ndpi_clear_field_string(flow, NDPI_FIELD_METHOD);
}