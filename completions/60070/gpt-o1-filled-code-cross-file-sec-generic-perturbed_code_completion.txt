if (method == NULL || methodlen == 0 || methodlen >= sizeof(flow->thrift_method)) {
  /* Invalid method: set a risk flag and clear the field */
  flow->risk |= NDPI_RISK_THIFT_INVALID_METHOD;
  flow->thrift_method[0] = '\0';
} else {
  /* Valid method: safely copy and null-terminate */
  memcpy(flow->thrift_method, method, methodlen);
  flow->thrift_method[methodlen] = '\0';
}