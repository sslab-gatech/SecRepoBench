if (method != NULL && methodlen > 0) {
    size_t copy_len = (methodlen < sizeof(flow->method)) ? methodlen : sizeof(flow->method) - 1;
    strncpy(flow->method, method, copy_len);
    flow->method[copy_len] = '\0'; // Ensure null-termination
  } else {
    flow->risk |= NDPI_THREAT_INVALID_METHOD;
    flow->method[0] = '\0'; // Clear the method field
  }