if (method && methodlen > 0) {
    size_t copy_len = methodlen < sizeof(flow->protos.thrift.method) - 1 ? methodlen : sizeof(flow->protos.thrift.method) - 1;
    memcpy(flow->protos.thrift.method, method, copy_len);
    flow->protos.thrift.method[copy_len] = '\0';
} else {
    ndpi_set_risk(ndpi_struct, flow, NDPI_MALFORMED_PACKET);
    memset(flow->protos.thrift.method, 0, sizeof(flow->protos.thrift.method));
}