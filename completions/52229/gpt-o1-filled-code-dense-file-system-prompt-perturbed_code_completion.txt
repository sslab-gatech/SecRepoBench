{
  char version_buf[32];
  int major = 0, minor = 0, patch = 0;
  const char *prefix = (strncasecmp(http_server_name, "Apache/", 7) == 0) ? "Apache/" : "nginx/";
  u_int prefix_len = (prefix[0] == 'A') ? 7 : 6;
  
  /* Copy the version substring into a buffer */
  memset(version_buf, 0, sizeof(version_buf));
  if((server_len - prefix_len) < 1) return;
  strncpy(version_buf, http_server_name + prefix_len, NDPI_MIN(server_len - prefix_len, (u_int)sizeof(version_buf) - 1));
  
  /* Parse the version (e.g. "2.4.43" => 2, 4, 43) */
  if(sscanf(version_buf, "%d.%d.%d", &major, &minor, &patch) >= 2) {
    if(prefix[0] == 'A') {
      /* Check Apache minimum version: 2.4.x */
      if(major < 2 || (major == 2 && minor < 4)) {
        char str[64];
        snprintf(str, sizeof(str), "Outdated Apache v%d.%d.%d (min required 2.4.x)", major, minor, patch);
        ndpi_set_risk(ndpi_struct, flow, NDPI_POSSIBLE_EXPLOIT, str);
      }
    } else {
      /* Check nginx minimum version: 1.14.x */
      if(major < 1 || (major == 1 && minor < 14)) {
        char str[64];
        snprintf(str, sizeof(str), "Outdated nginx v%d.%d.%d (min required 1.14.x)", major, minor, patch);
        ndpi_set_risk(ndpi_struct, flow, NDPI_POSSIBLE_EXPLOIT, str);
      }
    }
  }
}