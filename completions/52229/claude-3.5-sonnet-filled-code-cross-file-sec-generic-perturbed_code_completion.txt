char version[16];
u_int8_t major, minor, patch;

if(sscanf(http_server_name + off, "%15[0-9.]", version) == 1) {
  if(sscanf(version, "%hhu.%hhu.%hhu", &major, &minor, &patch) == 3) {
    if((strncasecmp(http_server_name, "Apache/", 7) == 0 && 
        (major < 2 || (major == 2 && minor < 4))) ||
       (strncasecmp(http_server_name, "nginx/", 6) == 0 && 
        (major < 1 || (major == 1 && minor < 18)))) {
      char risk_str[128];
      snprintf(risk_str, sizeof(risk_str), "Obsolete %s web server detected (%s)", 
               strncasecmp(http_server_name, "Apache/", 7) == 0 ? "Apache" : "nginx", 
               version);
      ndpi_set_risk(ndpi_struct, flow, NDPI_HTTP_OBSOLETE_SERVER, risk_str);
    }
  }
}