char version[16];
u_int8_t i, j = 0;
u_int8_t min_version[] = {off == 7 ? 2 : 1, 18, 0}; // Apache 2.18.0 or nginx 1.18.0

for(i = off; i < server_len && j < sizeof(version) - 1; i++) {
  if(http_server_name[i] == ' ' || http_server_name[i] == '/') break;
  version[j++] = http_server_name[i];
}
version[j] = '\0';

u_int8_t v[3] = {0};
if(sscanf(version, "%hhu.%hhu.%hhu", &v[0], &v[1], &v[2]) >= 2) {
  if(v[0] < min_version[0] || (v[0] == min_version[0] && v[1] < min_version[1])) {
    char risk_str[64];
    snprintf(risk_str, sizeof(risk_str), "Obsolete %s server detected (%s)",
             off == 7 ? "Apache" : "nginx", version);
    ndpi_set_risk(ndpi_struct, flow, NDPI_HTTP_OBSOLETE_SERVER, risk_str);
  }
}