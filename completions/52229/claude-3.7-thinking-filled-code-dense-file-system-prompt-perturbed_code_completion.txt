const char *version_ptr = http_server_name + off;
int major = 0, minor = 0, patch = 0;
int parsed;

parsed = sscanf(version_ptr, "%d.%d.%d", &major, &minor, &patch);
if(parsed < 2) {
  parsed = sscanf(version_ptr, "%d.%d", &major, &minor);
  patch = 0;
}

if(parsed >= 2) {
  char message[64];
  
  if(strncasecmp(http_server_name, "Apache/", 7) == 0) {
    if(major < 2 || (major == 2 && minor < 4)) {
      if(parsed == 3)
        snprintf(message, sizeof(message), "Obsolete Apache version %d.%d.%d", major, minor, patch);
      else
        snprintf(message, sizeof(message), "Obsolete Apache version %d.%d", major, minor);
      ndpi_set_risk(ndpi_struct, flow, NDPI_POSSIBLE_EXPLOIT, message);
    }
  } else { // Must be nginx
    if(major < 1 || (major == 1 && minor < 18)) {
      if(parsed == 3)
        snprintf(message, sizeof(message), "Obsolete nginx version %d.%d.%d", major, minor, patch);
      else
        snprintf(message, sizeof(message), "Obsolete nginx version %d.%d", major, minor);
      ndpi_set_risk(ndpi_struct, flow, NDPI_POSSIBLE_EXPLOIT, message);
    }
  }
}