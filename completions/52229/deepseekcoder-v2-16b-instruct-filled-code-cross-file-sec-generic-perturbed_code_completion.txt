// Extract the version number from the server string after the "Apache/" or "nginx/" prefix.
// Convert the version string into a numeric format.
// Check if the version is below a predefined minimum version threshold for either Apache or nginx.
// If the server version is obsolete, set a risk indicator with a message specifying the outdated server.

char version[10];
int version_len = server_len - 7; // Adjust for the "Apache/" or "nginx/" prefix
if (version_len > 0) {
    strncpy(version, http_server_name + 7, version_len);
    version[version_len] = '\0';

    // Predefined minimum version thresholds
    const char *apache_min_version = "2.2.0";
    const char *nginx_min_version = "1.10.0";

    // Convert version strings to numeric format for comparison
    double apache_version = atof(apache_min_version);
    double nginx_version = atof(nginx_min_version);
    double server_version = atof(version);

    // Check if the server version is below the predefined minimum version threshold
    if ((strncasecmp(http_server_name, "Apache/", 7) == 0 && server_version < apache_version) ||
        (strncasecmp(http_server_name, "nginx/", 6) == 0 && server_version < nginx_version)) {
        // Set a risk indicator with a message specifying the outdated server
        char message[100];
        snprintf(message, sizeof(message), "Obsolete server version detected: %s", version);
        ndpi_set_risk(ndpi_struct, flow, NDPI_RISK_OBSOLETE_SERVER, message);
    }
}