// Extract the version number from the server string after the "Apache/" or "nginx/" prefix.
// Convert the version string into a numeric format.
// Check if the version is below a predefined minimum version threshold for either Apache or nginx.
// If the server version is obsolete, set a risk indicator with a message specifying the outdated server.
u_int32_t version = 0;
char *dot, *dot2;

if ((dot = strchr((char*)http_server_name + off, '.'))!= NULL) {
  if ((dot2 = strchr(dot + 1, '.'))!= NULL) {
    version = (u_int32_t)atoi((char*)http_server_name + off) * 10000;
    version += (u_int32_t)atoi(dot + 1) * 100;
    version += (u_int32_t)atoi(dot2 + 1);
  }
}

if (version < MIN_APACHE_VERSION && strncmp((const char *)http_server_name, "Apache/", off) == 0) {
  char str[64];

  snprintf(str, sizeof(str), "Outdated Apache version %u", version);
  ndpi_set_risk(ndpi_struct, flow, NDPI_OUTDATED_SERVER, str);
} else if (version < MIN_NGINX_VERSION && strncmp((const char *)http_server_name, "nginx/", off) == 0) {
  char str[64];

  snprintf(str, sizeof(str), "Outdated Nginx version %u", version);
  ndpi_set_risk(ndpi_struct, flow, NDPI_OUTDATED_SERVER, str);
}