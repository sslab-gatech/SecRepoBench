u_int16_t version = 0;
char version_str[16] = {0}; // Ensure the buffer is large enough to hold the version string and null terminator
u_int len = server_len - off;

// Safely extract the version number using strncpy to avoid buffer overflow
if(len > sizeof(version_str) - 1) {
    len = sizeof(version_str) - 1; // Limit the length to prevent overflow
}
strncpy(version_str, http_server_name + off, len);
version_str[len] = '\0'; // Null-terminate the string

// Convert the version string into a numeric format (e.g., "2.4.1" -> 20401)
char *dot;
u_int16_t major = 0, minor = 0, patch = 0;
dot = strchr(version_str, '.');
if(dot != NULL) {
    *dot = '\0';
    major = atoi(version_str);
    minor = atoi(dot + 1);
    dot = strchr(dot + 1, '.');
    if(dot != NULL) {
        *dot = '\0';
        patch = atoi(dot + 1);
    }
}
version = (major * 10000) + (minor * 100) + patch;

// Define minimum version thresholds for Apache and nginx
#define MIN_APACHE_VERSION 20200 // Example: 2.2.0
#define MIN_NGINX_VERSION 10800  // Example: 1.8.0

// Check if the version is below the predefined minimum version threshold
if((off == 7 && version < MIN_APACHE_VERSION) || 
   (off == 6 && version < MIN_NGINX_VERSION)) {
    char message[128];
    snprintf(message, sizeof(message), "Outdated HTTP server detected: %s%s", 
             http_server_name, version_str);

    NDPI_SET_RISK(flow, NDPI_HTTP_OUTDATED_SERVER, message);
}