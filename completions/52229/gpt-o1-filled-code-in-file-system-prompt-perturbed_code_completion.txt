{
  /* Extract the version substring starting from the slash character. */
  const char *ver_start = (http_server_name + off);
  char version_buf[64] = {0};
  int major = 0, minor = 0, patch = 0;
  long ver_num = 0;
  char *p;
  size_t i = 0;

  /* Copy up to any whitespace or string terminator. */
  while((i < (sizeof(version_buf) - 1)) && ver_start[i] &&
        (ver_start[i] != ' ') && (ver_start[i] != '\t') &&
        (ver_start[i] != '\r') && (ver_start[i] != '\n')) {
    version_buf[i] = ver_start[i];
    i++;
  }
  version_buf[i] = '\0';

  /* Parse version in the form major.minor.patch. Extra fields are ignored. */
  if(sscanf(version_buf, "%d.%d.%d", &major, &minor, &patch) >= 2) {
    /* Convert the parsed version to a numeric format to compare with threshold. */
    ver_num = (long)major * 1000000L + (long)minor * 1000L + (long)patch;

    if(!strncasecmp(http_server_name, "Apache/", 7)) {
      /* Check if it's below the minimum Apache threshold. */
      if(ver_num > 0 && ver_num < MIN_APACHE_VERSION) {
        char r[64];
        snprintf(r, sizeof(r), "Apache version %s is outdated", version_buf);
        ndpi_set_risk(ndpi_struct, flow, NDPI_SERVER_SOFTWARE_OBSOLETE, r);
      }
    } else {
      /* It's nginx. Check if it's below the minimum Nginx threshold. */
      if(ver_num > 0 && ver_num < MIN_NGINX_VERSION) {
        char r[64];
        snprintf(r, sizeof(r), "Nginx version %s is outdated", version_buf);
        ndpi_set_risk(ndpi_struct, flow, NDPI_SERVER_SOFTWARE_OBSOLETE, r);
      }
    }
  }
}