{
  size_t ver_len;
  char ver_buf[32];
  int major = 0, minor = 0, patch = 0;

  ver_len = server_len - off;
  if (ver_len >= sizeof(ver_buf))
    ver_len = sizeof(ver_buf) - 1;
  memcpy(ver_buf, http_server_name + off, ver_len);
  ver_buf[ver_len] = '\0';

  if (sscanf(ver_buf, "%d.%d.%d", &major, &minor, &patch) < 2)
    patch = 0;

  if (strncasecmp(http_server_name, "Apache/", 7) == 0) {
    /* Define minimum required Apache version: 2.4.0 */
    if (major < 2 || (major == 2 && minor < 4)) {
      char risk_msg[128];
      snprintf(risk_msg, sizeof(risk_msg),
               "Obsolete Apache server version %d.%d.%d detected", major, minor, patch);
      ndpi_set_risk(ndpi_struct, flow, NDPI_RISK_OBSOLETE_SERVER, risk_msg);
    }
  } else if (strncasecmp(http_server_name, "nginx/", 6) == 0) {
    /* Define minimum required nginx version: 1.10.0 */
    if (major < 1 || (major == 1 && minor < 10)) {
      char risk_msg[128];
      snprintf(risk_msg, sizeof(risk_msg),
               "Obsolete nginx server version %d.%d.%d detected", major, minor, patch);
      ndpi_set_risk(ndpi_struct, flow, NDPI_RISK_OBSOLETE_SERVER, risk_msg);
    }
  }
}