{
  char version[32];
  size_t prefix_len = (strncasecmp(http_server_name, "Apache/", 7) == 0) ? 7 : 6;
  size_t cpy_len = server_len - prefix_len;
  if(cpy_len >= sizeof(version)) cpy_len = sizeof(version) - 1;

  /* Safely copy the version substring */
  strncpy(version, http_server_name + prefix_len, cpy_len);
  version[cpy_len] = '\0';

  /* Parse the version as major.minor.patch (at least major.minor is needed) */
  int major = 0, minor = 0, patch = 0;
  if(sscanf(version, "%d.%d.%d", &major, &minor, &patch) < 2) {
    /* Not a recognizable version format, skip */
    return;
  }

  /* Define some minimum version thresholds */
  if(strncasecmp(http_server_name, "Apache/", 7) == 0) {
    /* For example, consider 2.4.x as minimum acceptable Apache version */
    if((major < 2) || (major == 2 && minor < 4)) {
      char msg[64];
      snprintf(msg, sizeof(msg), "Outdated Apache version detected: %s", version);
      ndpi_set_risk(ndpi_struct, flow, NDPI_HTTP_OBSOLETE_SERVER, msg);
    }
  } else {
    /* For example, consider 1.18.x as minimum acceptable nginx version */
    if((major < 1) || (major == 1 && minor < 18)) {
      char msg[64];
      snprintf(msg, sizeof(msg), "Outdated nginx version detected: %s", version);
      ndpi_set_risk(ndpi_struct, flow, NDPI_HTTP_OBSOLETE_SERVER, msg);
    }
  }
}