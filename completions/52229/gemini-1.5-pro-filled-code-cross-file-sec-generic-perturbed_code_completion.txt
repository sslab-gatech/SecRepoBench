char *version_start = (char *)http_server_name + off;
      char *version_end = strchr(version_start, ' ');
      size_t version_len = version_end ? (size_t)(version_end - version_start) : strlen(version_start);

      if (version_len > 0) {
          char version_str[version_len + 1];
          strncpy(version_str, version_start, version_len);
          version_str[version_len] = '\0';

          int major = 0, minor = 0, patch = 0;
          if (sscanf(version_str, "%d.%d.%d", &major, &minor, &patch) >= 2) {
              if (off == 7 && (major < 2 || (major == 2 && minor < 4))) {
                  char risk_message[128];
                  snprintf(risk_message, sizeof(risk_message), "Obsolete Apache server: %s", version_str);
                  ndpi_set_risk(ndpi_struct, flow, NDPI_OBSOLETE_SERVER, risk_message);
              } else if (off == 6 && (major < 1 || (major == 1 && minor < 18))) {
                  char risk_message[128];
                  snprintf(risk_message, sizeof(risk_message), "Obsolete nginx server: %s", version_str);
                  ndpi_set_risk(ndpi_struct, flow, NDPI_OBSOLETE_SERVER, risk_message);
              }
          }
      }