char version_buf[32];
u_int version_len = server_len - off;
version_len = (version_len < sizeof(version_buf)-1) ? version_len : sizeof(version_buf)-1;
strncpy(version_buf, http_server_name + off, version_len);
version_buf[version_len] = '\0';

unsigned int major = 0, minor = 0, patch = 0;
sscanf(version_buf, "%u.%u.%u", &major, &minor, &patch);

u_int32_t version = (major << 16) | (minor << 8) | patch;
u_int32_t min_version = (off == 7) ? (2 << 16 | 4 << 8 | 50) : (1 << 16 | 20 << 8 | 0);

if(version < min_version) {
    char risk_msg[128];
    const char *server = (off == 7) ? "Apache" : "nginx";
    snprintf(risk_msg, sizeof(risk_msg), "Outdated %s server version %u.%u.%u", server, major, minor, patch);
    ndpi_set_risk(ndpi_struct, flow, NDPI_OBSOLETE_SERVER_VERSION, risk_msg);
}