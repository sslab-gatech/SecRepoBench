/* Extract the version number from the server string after the "Apache/" or "nginx/" prefix.
 * Convert the version string into a numeric format.
 * Check if the version is below a predefined minimum version threshold for either Apache or nginx.
 * If the server version is obsolete, set a risk indicator with a message specifying the outdated server.
 */
char *version_start = http_server_name + off;
char *version_end = strchr(version_start, ' ');
if (version_end) {
    *version_end = '\0';
    int major, minor, patch;
    if (sscanf(version_start, "%d.%d.%d", &major, &minor, &patch) == 3) {
        int version = (major * 1000000) + (minor * 1000) + patch;
        if (strncasecmp(http_server_name, "Apache/", off) == 0) {
            if (version < MIN_APACHE_VERSION) {
                char str[64];
                snprintf(str, sizeof(str), "Obsolete Apache version %d.%d.%d", major, minor, patch);
                ndpi_set_risk(ndpi_struct, flow, NDPI_KNOWN_PROTOCOL_ON_NON_STANDARD_PORT, str);
            }
        } else if (strncasecmp(http_server_name, "nginx/", off) == 0) {
            if (version < MIN_NGINX_VERSION) {
                char str[64];
                snprintf(str, sizeof(str), "Obsolete nginx version %d.%d.%d", major, minor, patch);
                ndpi_set_risk(ndpi_struct, flow, NDPI_KNOWN_PROTOCOL_ON_NON_STANDARD_PORT, str);
            }
        }
    }
}