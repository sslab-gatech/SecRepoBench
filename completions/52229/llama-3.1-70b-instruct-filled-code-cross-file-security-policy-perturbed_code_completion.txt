char version[32];
u_int ver_len = server_len - off;
if(ver_len > 31) ver_len = 31;

// Copy the version string into a buffer, accounting for the null-terminator
strncpy(version, http_server_name + off, ver_len);
version[ver_len] = '\0';

// Extract the version number from the version string
char *dot = strchr(version, '.');
if(dot!= NULL) {
  char *dot2 = strchr(dot + 1, '.');
  if(dot2!= NULL) {
    // Convert the version string into a numeric format
    int major = atoi(version);
    int minor = atoi(dot + 1);
    int patch = atoi(dot2 + 1);

    // Check if the version is below a predefined minimum version threshold for either Apache or nginx
    if(strncasecmp(http_server_name, "Apache/", off) == 0) {
      if(major < 2 || (major == 2 && minor < 4) || (major == 2 && minor == 4 && patch < 7)) {
        // Set a risk indicator with a message specifying the outdated server
        char str[64];
        snprintf(str, sizeof(str), "Outdated Apache server version %d.%d.%d", major, minor, patch);
        ndpi_set_risk(ndpi_struct, flow, NDPI_HTTP_OUTDATED_SERVER, str);
      }
    } else if(strncasecmp(http_server_name, "nginx/", off) == 0) {
      if(major < 1 || (major == 1 && minor < 14) || (major == 1 && minor == 14 && patch < 2)) {
        // Set a risk indicator with a message specifying the outdated server
        char str[64];
        snprintf(str, sizeof(str), "Outdated nginx server version %d.%d.%d", major, minor, patch);
        ndpi_set_risk(ndpi_struct, flow, NDPI_HTTP_OUTDATED_SERVER, str);
      }
    }
  }
}