{
  char version_str[32] = {0};
  size_t prefix_len = (strncasecmp(http_server_name, "Apache/", 7) == 0) ? 7 : 6;
  size_t copy_len = server_len - prefix_len;
  if(copy_len >= sizeof(version_str))
    copy_len = sizeof(version_str) - 1;

  strncpy(version_str, http_server_name + prefix_len, copy_len);

  int major = 0, minor = 0, patch = 0;
  sscanf(version_str, "%d.%d.%d", &major, &minor, &patch);

  int min_major, min_minor, min_patch;
  if(strncasecmp(http_server_name, "Apache/", 7) == 0) {
    min_major = 2; min_minor = 4; min_patch = 0;
  } else {
    min_major = 1; min_minor = 18; min_patch = 0;
  }

  if((major < min_major) ||
     (major == min_major && minor < min_minor) ||
     (major == min_major && minor == min_minor && patch < min_patch)) {
    char msg[128];
    snprintf(msg, sizeof(msg), "Outdated %s version: %s",
             (strncasecmp(http_server_name, "Apache/", 7) == 0) ? "Apache" : "nginx",
             version_str);
    ndpi_set_risk(ndpi_struct, flow, NDPI_HTTP_OUTDATED_SERVER, msg);
  }
}