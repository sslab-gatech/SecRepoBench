u_int8_t major = 0, minor = 0; // Major and minor version components
char version_str[16]; // Buffer to store the version string
u_int i = off, j = 0;

// Extract version string
while(i < server_len && http_server_name[i] != ' ' && j < sizeof(version_str) - 1) {
  version_str[j++] = http_server_name[i++];
}
version_str[j] = '\0';

// Parse major and minor version components (X.Y)
if(sscanf(version_str, "%hhu.%hhu", &major, &minor) >= 2) {
  // Define version thresholds
  u_int8_t apache_min_major = 2;
  u_int8_t apache_min_minor = 4;
  u_int8_t nginx_min_major = 1;
  u_int8_t nginx_min_minor = 18;
  
  // Check if the server version is obsolete
  if((strncasecmp(http_server_name, "Apache/", 7) == 0 &&
      (major < apache_min_major || (major == apache_min_major && minor < apache_min_minor))) ||
     (strncasecmp(http_server_name, "nginx/", 6) == 0 &&
      (major < nginx_min_major || (major == nginx_min_major && minor < nginx_min_minor)))) {
    
    // Server is obsolete, set risk indicator
    char str[64];
    snprintf(str, sizeof(str), "Obsolete %s Server %s", 
             (strncasecmp(http_server_name, "Apache/", 7) == 0) ? "Apache" : "nginx",
             version_str);
    
    ndpi_set_risk(ndpi_struct, flow, NDPI_OBSOLETE_HTTP_SERVER, str);
  }
}