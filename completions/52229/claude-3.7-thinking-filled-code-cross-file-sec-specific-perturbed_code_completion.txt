char version[16];
unsigned int major = 0, minor = 0;
u_int version_len = server_len - off;

if (version_len > 0 && version_len < sizeof(version)) {
  // Copy the version string safely
  strncpy(version, &http_server_name[off], sizeof(version) - 1);
  version[sizeof(version) - 1] = '\0'; // Ensure null termination
  
  // Parse major.minor version
  if (sscanf(version, "%u.%u", &major, &minor) >= 1) { // At least major version parsed
    char risk_str[64];
    
    // Check for obsolete Apache versions
    if (strncasecmp(http_server_name, "Apache/", 7) == 0 && 
        (major < 2 || (major == 2 && minor < 4))) {
      snprintf(risk_str, sizeof(risk_str), "Obsolete Apache web server v%s", version);
      ndpi_set_risk(ndpi_struct, flow, NDPI_OBSOLETE_SERVER_VERSION, risk_str);
    }
    // Check for obsolete nginx versions
    else if (strncasecmp(http_server_name, "nginx/", 6) == 0 && 
             (major < 1 || (major == 1 && minor < 18))) {
      snprintf(risk_str, sizeof(risk_str), "Obsolete nginx web server v%s", version);
      ndpi_set_risk(ndpi_struct, flow, NDPI_OBSOLETE_SERVER_VERSION, risk_str);
    }
  }
}