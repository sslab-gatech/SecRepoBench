const char *version_str = NULL;
float version = 0.0f;
int is_apache = (strncasecmp(http_server_name, "Apache/", 7) == 0);
int is_nginx = (strncasecmp(http_server_name, "nginx/", 6) == 0);

if(is_apache) {
  version_str = http_server_name + 7;
} else if(is_nginx) {
  version_str = http_server_name + 6;
}

if(version_str && isdigit((unsigned char)version_str[0])) {
  char ver_buf[16] = {0};
  size_t i = 0;
  // Copy up to first non-digit/non-dot character or buffer full
  while(i < sizeof(ver_buf)-1 && (isdigit((unsigned char)version_str[i]) || version_str[i] == '.')) {
    ver_buf[i] = version_str[i];
    i++;
  }
  ver_buf[i] = '\0';
  version = atof(ver_buf);

  // Define minimum supported versions
  float min_apache = 2.4f;
  float min_nginx = 1.18f;

  if((is_apache && version > 0 && version < min_apache) ||
     (is_nginx && version > 0 && version < min_nginx)) {
    char msg[128];
    snprintf(msg, sizeof(msg), "Obsolete %s version detected: %s",
             is_apache ? "Apache" : "nginx", ver_buf);
    ndpi_set_risk(ndpi_struct, flow, NDPI_HTTP_OBSOLETE_SERVER, msg);
  }
}