char version[16];
      int version_num = 0;
      int i = 0;

      if (strncasecmp(http_server_name, "Apache/", off) == 0) {
        strncpy(version, http_server_name + off, sizeof(version) - 1);
        version[strcspn(version, "/")] = '\0'; //remove trailing slash if present

        for (i = 0; i < strlen(version); i++) {
          if (isdigit(version[i])) {
            version_num = version_num * 10 + (version[i] - '0');
          } else {
            break;
          }
        }
        if (version_num < 2004) {
          ndpi_set_risk(ndpi_struct, flow, NDPI_HTTP_OBSOLETE_APACHE, "Obsolete Apache version detected");
        }
      } else if (strncasecmp(http_server_name, "nginx/", off) == 0) {
        strncpy(version, http_server_name + off, sizeof(version) - 1);
        version[strcspn(version, "/")] = '\0'; //remove trailing slash if present

        for (i = 0; i < strlen(version); i++) {
          if (isdigit(version[i])) {
            version_num = version_num * 10 + (version[i] - '0');
          } else {
            break;
          }
        }
        if (version_num < 1000) {
          ndpi_set_risk(ndpi_struct, flow, NDPI_HTTP_OBSOLETE_NGINX, "Obsolete Nginx version detected");
        }
      }