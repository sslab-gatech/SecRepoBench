0)
        return(QuantumScale*pixel.red);
      break;
    }
    case 'S':
    case 's':
    {
      if (LocaleCompare(symbol,"saturation") == 0)
        {
          double
            hue,
            lightness,
            saturation;

          ConvertRGBToHSL(pixel.red,pixel.green,pixel.blue,&hue,&saturation,
            &lightness);
          return(saturation);
        }
      if (LocaleCompare(symbol,"skewness") == 0)
        return(FxChannelStatistics(fx_info,image,channel,symbol,exception));
      if (LocaleCompare(symbol,"size") == 0)
        return((double) (image->columns*image->rows));
      if (LocaleCompare(symbol,"s") == 0)
        return((double) image->columns);
      break;
    }
    case 'T':
    case 't':
    {
      if (LocaleCompare(symbol,"t") == 0)
        return((double) image->rows);
      break;
    }
    case 'U':
    case 'u':
    {
      if (LocaleCompare(symbol,"u") == 0)
        return((double) x);
      break;
    }
    case 'V':
    case 'v':
    {
      if (LocaleCompare(symbol,"v") == 0)
        return((double) y);
      break;
    }
    case 'X':
    case 'x':
    {
      if (LocaleCompare(symbol,"x") == 0)
        return((double) x);
      break;
    }
    case 'Y':
    case 'y':
    {
      if (LocaleCompare(symbol,"y") == 0)
        return((double) y);
      break;
    }
    case 'Z':
    case 'z':
    {
      if (LocaleCompare(symbol,"z") == 0)
        return((double) image->depth);
      break;
    }
    default:
      break;
  }
  if (LocaleCompare(symbol,"depth") == 0)
    return((double) image->depth);
  if (LocaleCompare(symbol,"k") == 0)
    {
      if (image->colorspace != CMYKColorspace)
        {
          (void) ThrowMagickException(exception,GetMagickModule(),
            OptionError,"ColorSeparatedImageRequired","`%s'",
            image->filename);
          return(0.0);
        }
      return(QuantumScale*pixel.black);
    }
  if (LocaleCompare(symbol,"intensity") == 0)
    {
      Quantum
        quantum_pixel[MaxPixelChannels];

      SetPixelViaPixelInfo(image,&pixel,quantum_pixel);
      return(QuantumScale*GetPixelIntensity(image,quantum_pixel));
    }
  if (LocaleCompare(symbol,"luma") == 0)
    {
      double
        luma;

      luma=0.212656*pixel.red+0.715158*pixel.green+0.072186*pixel.blue;
      return(QuantumScale*luma);
    }
  if (LocaleCompare(symbol,"luminance") == 0)
    {
      double
        luminence;

      luminence=0.212656*pixel.red+0.715158*pixel.green+0.072186*pixel.blue;
      return(QuantumScale*luminence);
    }
  if (LocaleCompare(symbol,"max") == 0)
    {
      double
        maxima,
        minima;

      (void) GetImageRange(image,&minima,&maxima,exception);
      return(QuantumScale*maxima);
    }
  if (LocaleCompare(symbol,"min") == 0)
    {
      double
        maxima,
        minima;

      (void) GetImageRange(image,&minima,&maxima,exception);
      return(QuantumScale*minima);
    }
  if (LocaleCompare(symbol,"mean") == 0)
    {
      double
        mean,
        standard_deviation;

      (void) GetImageMean(image,&mean,&standard_deviation,exception);
      return(QuantumScale*mean);
    }
  if (LocaleCompare(symbol,"median") == 0)
    {
      double
        median;

      (void) GetImageMedian(image,&median,exception);
      return(QuantumScale*median);
    }
  if (LocaleCompare(symbol,"mode") == 0)
    {
      double
        mode;

      (void) GetImageMode(image,&mode,exception);
      return(QuantumScale*mode);
    }
  if (LocaleCompare(symbol,"standard_deviation") == 0)
    {
      double
        mean,
        standard_deviation;

      (void) GetImageMean(image,&mean,&standard_deviation,exception);
      return(QuantumScale*standard_deviation);
    }
    // Add more cases for other symbols as needed
    // <MASK>
  }
  value=(const char *) GetValueFromSplayTree(fx_info->symbols,symbol);
  if (value != (const char *) NULL)
    return(QuantumScale*StringToDouble(value,(char **) NULL));
  (void) DeleteNodeFromSplayTree(fx_info->symbols,symbol);
  if (LocaleCompare(symbol,"depth") == 0)
    return((double) image->depth);
  if (LocaleCompare(symbol,"k") == 0)
    {
      if (image->colorspace != CMYKColorspace)
        {
          (void) ThrowMagickException(exception,GetMagickModule(),
            OptionError,"ColorSeparatedImageRequired","`%s'",
            image->filename);
          return(0.0);
        }
      return(QuantumScale*pixel.black);
    }
  if (LocaleCompare(symbol,"intensity") == 0)
    {
      Quantum
        quantum_pixel[MaxPixelChannels];

      SetPixelViaPixelInfo(image,&pixel,quantum_pixel);
      return(QuantumScale*GetPixelIntensity(image,quantum_pixel));
    }
  if (LocaleCompare(symbol,"luma") == 0)
    {
      double
        luma;

      luma=0.212656*pixel.red+0.715158*pixel.green+0.072186*pixel.blue;
      return(QuantumScale*luma);
    }
  if (LocaleCompare(symbol,"luminance") == 0)
    {
      double
        luminence;

      luminence=0.212656*pixel.red+0.715158*pixel.green+0.072186*pixel.blue;
      return(QuantumScale*luminence);
    }
  if (LocaleCompare(symbol,"max") == 0)
    {
      double
        maxima,
        minima;

      (void) GetImageRange(image,&minima,&maxima,exception);
      return(QuantumScale*maxima);
    }
  if (LocaleCompare(symbol,"min") == 0)
    {
      double
        maxima,
        minima;

      (void) GetImageRange(image,&minima,&maxima,exception);
      return(QuantumScale*minima);
    }
  if (LocaleCompare(symbol,"mean") == 0)
    {
      double
        mean,
        standard_deviation;

      (void) GetImageMean(image,&mean,&standard_deviation,exception);
      return(QuantumScale*mean);
    }
  if (LocaleCompare(symbol,"median") == 0)
    {
      double
        median;

      (void) GetImageMedian(image,&median,exception);
      return(QuantumScale*median);
    }
  if (LocaleCompare(symbol,"mode") == 0)
    {
      double
        mode;

      (void) GetImageMode(image,&mode,exception);
      return(QuantumScale*mode);
    }
  if (LocaleCompare(symbol,"standard_deviation") == 0)
    {
      double
        mean,
        standard_deviation;

      (void) GetImageMean(image,&mean,&standard_deviation,exception);
      return(QuantumScale*standard_deviation);
    }
  (void) AddValueToSplayTree(fx_info->symbols,ConstantString(symbol),
    ConstantString(StringToDouble(pixel.description,(char **) NULL)));
  return(QuantumScale*StringToDouble(pixel.description,(char **) NULL));
}

static double FxEvaluateSubexpression(FxInfo *fx_info,const PixelChannel channel,
  const ssize_t x,const ssize_t y,const char *expression,const size_t depth,
  double *alpha,ExceptionInfo *exception)
{
  char
    *p,
    *q,
    *subexpression;

  double
    beta;

  size_t
    level;

  subexpression=AcquireString(expression);
  p=subexpression;
  level=0;
  while ((*p != '\0') &&
         ((level != 1) || (strchr(")",(int) *p) == (char *) NULL)))
  {
    if (strchr("(",(int) *p) != (char *) NULL)
      level++;
    else
      if (strchr(")",(int) *p) != (char *) NULL)
        level--;
    p++;
  }
  if (*p == '\0')
    {
      (void) ThrowMagickException(exception,GetMagickModule(),OptionError,
        "UnbalancedParenthesis","`%s'",expression);
      return(0.0);
    }
  *p='\0';
  p++;
  beta=FxEvaluateExpression(fx_info,p,alpha,exception);
  if (LocaleCompare(subexpression,"-") == 0)
    return(-beta);
  if (LocaleCompare(subexpression,"+") == 0)
    return(beta);
  if (LocaleCompare(subexpression,"*") == 0)
    return(beta);
  if (LocaleCompare(subexpression,"/") == 0)
    return(1.0/beta);
  if (LocaleCompare(subexpression,"%") == 0)
    return(fmod(beta,1.0));
  if (LocaleCompare(subexpression,"^") == 0)
    return(pow(beta,1.0));
  if (LocaleCompare(subexpression,"sqrt") == 0)
    return(sqrt(beta));
  if (LocaleCompare(subexpression,"cbrt") == 0)
    return(cbrt(beta));
  if (LocaleCompare(subexpression,"log") == 0)
    return(log10(beta));
  if (LocaleCompare(subexpression,"ln") == 0)
    return(log(beta));
  if (LocaleCompare(subexpression,"log2") == 0)
    return(log2(beta));
  if (LocaleCompare(subexpression,"exp") == 0)
    return(exp(beta));
  if (LocaleCompare(subexpression,"sin") == 0)
    return(sin(beta));
  if (LocaleCompare(subexpression,"cos") == 0)
    return(cos(beta));
  if (LocaleCompare(subexpression,"tan") == 0)
    return(tan(beta));
  if (LocaleCompare(subexpression,"asin") == 0)
    return(asin(beta));
  if (LocaleCompare(subexpression,"acos") == 0)
    return(acos(beta));
  if (LocaleCompare(subexpression,"atan") == 0)
    return(atan(beta));
  if (LocaleCompare(subexpression,"sinh") == 0)
    return(sinh(beta));
  if (LocaleCompare(subexpression,"cosh") == 0)
    return(cosh(beta));
  if (LocaleCompare(subexpression,"tanh") == 0)
    return(tanh(beta));
  if (LocaleCompare(subexpression,"asinh") == 0)
    return(asinh(beta));
  if (LocaleCompare(subexpression,"acosh") == 0)
    return(acosh(beta));
  if (LocaleCompare(subexpression,"atanh") == 0)
    return(atanh(beta));
  if (LocaleCompare(subexpression,"ceil") == 0)
    return(ceil(beta));
  if (LocaleCompare(subexpression,"floor") == 0)
    return(floor(beta));
  if (LocaleCompare(subexpression,"round")