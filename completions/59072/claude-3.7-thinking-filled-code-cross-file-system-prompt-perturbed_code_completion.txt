if (op1_string == op2_string) {
    // op1_string and op2_string are the same
    // Create a copy of op2_string before we modify op1_string
    op2_string = zend_string_copy(op1_string);
    free_op2_string = true;
}

// Extend the memory allocation of op1_string to fit the concatenated result
result_str = zend_string_extend(op1_string, result_len, 0);

// Now that op1_string has been extended and incorporated into result_str,
// we don't need to free it separately
shouldfreeopstring = false;