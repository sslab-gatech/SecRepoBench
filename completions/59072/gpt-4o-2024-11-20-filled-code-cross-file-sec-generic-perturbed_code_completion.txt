result_str = zend_string_extend(op1_string, result_len, 0);
memcpy(ZSTR_VAL(result_str) + op1_len, ZSTR_VAL(op2_string), op2_len);
ZSTR_VAL(result_str)[result_len] = '\0';

if (shouldfreeopstring) {
    // If op1_string was dynamically allocated, we already extended it, so no need to free it again.
    shouldfreeopstring = false;
} else {
    // If op1_string was not dynamically allocated, we need to ensure the result_str is properly managed.
    zend_string_addref(result_str);
}

if (free_op2_string) {
    // Release op2_string if it was dynamically allocated.
    zend_string_release(op2_string);
    free_op2_string = false;
}

op2_string = result_str; // Update op2_string to point to the new extended string.