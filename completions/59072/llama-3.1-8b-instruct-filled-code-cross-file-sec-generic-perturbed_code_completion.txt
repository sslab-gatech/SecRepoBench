if (result == op1) {
    // Extend the memory allocation of op1_string to accommodate the concatenated result.
    // Assign the extended string to result_str, which will hold the final concatenated string.
    // If op1_string is being used as the result, ensure it is not prematurely freed.
    // Handle the case where op1_string and op2_string are the same, preventing double release.
    // Update op2_string to point to the new extended string if necessary.
    result_str = zend_string_extend(op1_string, op2_len);
    if (result_str == NULL) {
        if (shouldfreeopstring) zend_string_release(op1_string);
        if (free_op2_string) zend_string_release(op2_string);
        zend_throw_error(NULL, "String size overflow");
        if (orig_op1!= result) {
            ZVAL_UNDEF(result);
        }
        return FAILURE;
    }
    if (op1_string == op2_string) {
        zend_string_release(op2_string);
        op2_string = result_str;
    } else {
        zend_string_release(op1_string);
        op1_string = result_str;
    }
}