if (op1_string == op2_string) {
    op2_string = zend_string_copy(op2_string);
    free_op2_string = true;
}
result_str = zend_string_extend(op1_string, result_len, 0);
if (result_str == op1_string) {
    memcpy(ZSTR_VAL(result_str) + op1_len, ZSTR_VAL(op2_string), op2_len + 1);
} else {
    memcpy(ZSTR_VAL(result_str), ZSTR_VAL(op1_string), op1_len);
    memcpy(ZSTR_VAL(result_str) + op1_len, ZSTR_VAL(op2_string), op2_len + 1);
    if (shouldfreeopstring) {
        zend_string_release(op1_string);
    }
}