if (UNEXPECTED(op1_string == op2_string)) {
    // op1_string and op2_string point to the same memory - create a copy of op2_string
    op2_string = zend_string_copy(op2_string);
    free_op2_string = true;
}

// Extend the op1_string to hold both strings
result_str = zend_string_extend(op1_string, result_len, 0);
// Update op1_string since we're extending it
op1_string = result_str;
// We've taken ownership of op1_string, so it shouldn't be freed later
shouldfreeopstring = false;