if (result == op1) {
    // Extend the memory allocation of op1_string to accommodate the concatenated result.
    // Assign the extended string to result_str, which will hold the final concatenated string.
    // If op1_string is being used as the result, ensure it is not prematurely freed.
    // Handle the case where op1_string and op2_string are the same, preventing double release.
    // Update op2_string to point to the new extended string if necessary.
    zend_string *result_str = zend_string_extend(op1_string, Z_STRLEN_P(op1) + Z_STRLEN_P(op2), 0);
    if (op1_string!= op2_string) {
        memcpy(ZSTR_VAL(result_str) + Z_STRLEN_P(op1), Z_STRVAL_P(op2), Z_STRLEN_P(op2));
    } else {
        memcpy(ZSTR_VAL(result_str) + Z_STRLEN_P(op1), ZSTR_VAL(result_str), Z_STRLEN_P(op2));
    }
    ZSTR_VAL(result_str)[Z_STRLEN_P(op1) + Z_STRLEN_P(op2)] = '\0';
    ZVAL_NEW_STR(result, result_str);
} else {
    result_str = zend_string_alloc(Z_STRLEN_P(op1) + Z_STRLEN_P(op2), 0);
    memcpy(ZSTR_VAL(result_str), Z_STRVAL_P(op1), Z_STRLEN_P(op1));
    memcpy(ZSTR_VAL(result_str) + Z_STRLEN_P(op1), Z_STRVAL_P(op2), Z_STRLEN_P(op2));
    ZSTR_VAL(result_str)[Z_STRLEN_P(op1) + Z_STRLEN_P(op2)] = '\0';
    ZVAL_NEW_STR(result, result_str);
}