if (op1_string == op2_string) {
    /* If we're concatenating the same string onto itself, we need a copy to avoid
       overwriting as we extend. */
    op2_string = zend_string_copy(op2_string);
}
result_str = zend_string_extend(op1_string, result_len, 0);
/* Update the length to reflect the extended size. */
ZSTR_LEN(result_str) = result_len;
/* Copy in the second string contents right after the first string data. */
memcpy(ZSTR_VAL(result_str) + op1_len, ZSTR_VAL(op2_string), op2_len);
/* Null-terminate and release if we had to copy op2_string. */
ZSTR_VAL(result_str)[result_len] = '\0';
if (op1_string == op2_string) {
    zend_string_release(op2_string);
}