if (result == op1) {
    op1_string = zend_string_realloc(op1_string, result_len, 0);
    result_str = op1_string;
    if (op1_string == op2_string) {
        op2_string = result_str;
    }
} else {
    result_str = zend_string_alloc(result_len, 0);
    memcpy(ZSTR_VAL(result_str), ZSTR_VAL(op1_string), op1_len);
    if (result == orig_op1) {
        i_zval_ptr_dtor(result);
    }
}