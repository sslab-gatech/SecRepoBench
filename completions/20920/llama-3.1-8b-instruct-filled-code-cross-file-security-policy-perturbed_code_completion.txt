#if defined(TIFFTAG_RICHTIFFIPTC)
  if ((TIFFGetField(tiff,TIFFTAG_RICHTIFFIPTC,&length,&profile) == 1) &&
      (profile!= (unsigned char *) NULL))
    {
      // Check if the TIFF file is byte-swapped and, if so, swap the byte order of the IPTC profile data.
      // Read the IPTC profile into the image.
      ssize_t
        size;

      size=TIFFFieldLength(tiff,TIFFTAG_RICHTIFFIPTC);
      if (size > 0)
      {
        unsigned char
          *buffer = (unsigned char *) AcquireQuantumMemory(size,
            sizeof(*buffer));

        if (buffer == (unsigned char *) NULL)
          ThrowTIFFException(ResourceLimitError,"MemoryAllocationFailed");
        TIFFReadEncodedField(tiff,TIFFTAG_RICHTIFFIPTC,buffer,size);
        if (TIFFIsByteSwapped(tiff)!= MagickFalse)
          {
            size_t
              i;

            for (i=0; i < size; i++)
              buffer[i]=buffer[size-1-i];
          }
        status=ReadProfile(img,"iptc",buffer,size,exception);
        buffer=(unsigned char *) RelinquishMagickMemory(buffer);
      }
    }
#endif