if (TIFFGetField(tiff,TIFFTAG_RICHTIFFIPTC,&length,&profile) == 1)
      {
        // Ensure the length is valid to prevent buffer overflow
        if (length > 0 && length <= MAX_IPTC_LENGTH) // MAX_IPTC_LENGTH should be defined appropriately
        {
          // Allocate memory for the IPTC profile data
          unsigned char *iptc_data = (unsigned char *) malloc(length);
          if (iptc_data != NULL)
          {
            // Copy the profile data safely
            memcpy(iptc_data, profile, length);
            // Set the IPTC profile in the image
            status = ReadProfile(img, "iptc", iptc_data, (ssize_t)length, exception);
            free(iptc_data); // Free the allocated memory
          }
          else
          {
            // Handle memory allocation failure
            ThrowBinaryException(ResourceLimitError, "MemoryAllocationFailed", img->filename);
          }
        }
      }