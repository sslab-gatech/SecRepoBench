p = b;
		while (step > 0) {
			size_t dr_len;

			/* Ensure there's enough data for a directory record. */
			if (step < 34 || p[0] < 34 || p[0] > step) {
				/* Invalid or incomplete directory record. */
				step = 0;
				break;
			}

			dr_len = p[0];
			if (dr_len == 0) {
				/* Padding at the end of the directory block. */
				step = 0;
				break;
			}

			/* Parse the directory record. */
			struct file_info *file = parse_file_info(iso9660, p, dr_len, parent);
			if (file == NULL) {
				/* Skip invalid or unsupported directory entries. */
				p += dr_len;
				step -= dr_len;
				continue;
			}

			/* Skip '.' and '..' entries. */
			if (file->name.length == 1 && file->name.s[0] == '.') {
				free(file);
				p += dr_len;
				step -= dr_len;
				continue;
			}
			if (file->name.length == 2 && file->name.s[0] == '.' && file->name.s[1] == '.') {
				free(file);
				p += dr_len;
				step -= dr_len;
				continue;
			}

			/* Handle multi-extent files. */
			if (multi != NULL) {
				if (multi->offset + multi->size == file->offset) {
					/* Append this extent to the multi-extent file. */
					multi->size += file->size;
					free(file);
					p += dr_len;
					step -= dr_len;
					continue;
				} else {
					/* Finalize the previous multi-extent file. */
					add_entry_to_archive(iso9660, multi);
					multi = NULL;
				}
			}
			if (file->multi_extent) {
				/* Start a new multi-extent file. */
				multi = file;
				p += dr_len;
				step -= dr_len;
				continue;
			}

			/* Add the file to the archive. */
			add_entry_to_archive(iso9660, file);

			/* Move to the next directory record. */
			p += dr_len;
			step -= dr_len;
		}

		/* Finalize any remaining multi-extent file. */
		if (multi != NULL) {
			add_entry_to_archive(iso9660, multi);
			multi = NULL;
		}