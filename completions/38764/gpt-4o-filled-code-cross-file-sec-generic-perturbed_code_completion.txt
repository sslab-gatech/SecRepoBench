p = b;
		while (step > 0) {
			struct file_info *file;
			size_t dr_len;

			/* Check if there is enough data for a directory record. */
			if (step < 34) {
				/* Not enough data for a directory record. */
				break;
			}

			/* Length of the directory record. */
			dr_len = p[0];
			if (dr_len < 34 || dr_len > step) {
				/* Invalid directory record length. */
				break;
			}

			/* Skip '.' and '..' entries. */
			if (p[0] == 0 || p[0] == 1) {
				p += dr_len;
				step -= dr_len;
				continue;
			}

			/* Parse the directory record. */
			file = parse_file_info(archivereader, iso9660, parent, p, dr_len);
			if (file == NULL) {
				/* Failed to parse file info. */
				return (ARCHIVE_FATAL);
			}

			/* Handle multi-extent files. */
			if (file->multi_extent) {
				if (multi == NULL) {
					multi = file;
				} else {
					multi->next = file;
					multi = file;
				}
			} else {
				/* Add the file to the archive structure. */
				if (add_file_to_archive(iso9660, file) != ARCHIVE_OK) {
					return (ARCHIVE_FATAL);
				}
			}

			/* Move to the next directory record. */
			p += dr_len;
			step -= dr_len;
		}