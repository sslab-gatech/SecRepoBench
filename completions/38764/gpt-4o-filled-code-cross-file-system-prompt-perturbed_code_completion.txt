p = b;
		while (step > 0) {
			struct file_info *file;
			int r;

			/* Check if the directory entry length is valid. */
			if (p[0] == 0 || p[0] > step)
				break;

			/* Parse the directory entry. */
			file = parse_file_info(archivereader, p, parent);
			if (file == NULL) {
				archive_set_error(&archivereader->archive,
				    ARCHIVE_ERRNO_FILE_FORMAT,
				    "Invalid directory entry");
				return (ARCHIVE_FATAL);
			}

			/* Skip '.' and '..' entries. */
			if (file->name.length == 1 &&
			    (file->name.s[0] == '.' ||
			     (file->name.s[0] == '.' && file->name.s[1] == '.'))) {
				p += p[0];
				step -= p[0];
				continue;
			}

			/* Handle multi-extent files. */
			if (multi != NULL) {
				if (multi->offset + multi->size == file->offset) {
					multi->size += file->size;
					free(file);
					p += p[0];
					step -= p[0];
					continue;
				} else {
					/* Add the multi-extent file to the list. */
					add_file_to_list(iso9660, multi);
					multi = NULL;
				}
			}

			/* Check if this is a multi-extent file. */
			if (file->multi_extent) {
				multi = file;
			} else {
				/* Add the file to the list. */
				add_file_to_list(iso9660, file);
			}

			p += p[0];
			step -= p[0];
		}