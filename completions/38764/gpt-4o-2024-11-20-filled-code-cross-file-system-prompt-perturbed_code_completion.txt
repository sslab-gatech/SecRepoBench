p = b;
		while (step > 0) {
			struct file_info *file;
			size_t dr_len;

			/* Check if there's enough data for a directory record. */
			if (step < 34 || p[0] == 0) {
				/* Skip padding or invalid entries. */
				step--;
				p++;
				continue;
			}

			/* Length of the directory record. */
			dr_len = p[0];
			if (dr_len > step || dr_len < 34) {
				/* Invalid record length, skip this entry. */
				step--;
				p++;
				continue;
			}

			/* Parse the directory record. */
			file = parse_file_info(iso9660, p, dr_len, parent);
			if (file == NULL) {
				/* Parsing failed, skip this entry. */
				step -= dr_len;
				p += dr_len;
				continue;
			}

			/* Skip '.' and '..' entries. */
			if (file->name.length == 1 &&
			    (file->name.s[0] == '.' ||
			     (file->name.s[0] == '.' && file->name.s[1] == '.'))) {
				release_file(file);
				step -= dr_len;
				p += dr_len;
				continue;
			}

			/* Handle multi-extent files. */
			if (multi != NULL) {
				if (multi->offset + multi->size == file->offset) {
					/* Append this extent to the multi-extent file. */
					multi->size += file->size;
					release_file(file);
					step -= dr_len;
					p += dr_len;
					continue;
				} else {
					/* Finalize the previous multi-extent file. */
					add_entry(iso9660, multi);
					multi = NULL;
				}
			}

			if (file->multi_extent) {
				/* Start a new multi-extent file. */
				multi = file;
			} else {
				/* Add a regular file or directory entry. */
				add_entry(iso9660, file);
			}

			step -= dr_len;
			p += dr_len;
		}

		/* Finalize any remaining multi-extent file. */
		if (multi != NULL) {
			add_entry(iso9660, multi);
			multi = NULL;
		}