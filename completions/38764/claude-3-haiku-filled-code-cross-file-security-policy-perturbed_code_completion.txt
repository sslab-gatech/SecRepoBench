while (step) {
    b = __archive_read_ahead(archivereader, iso9660->logical_block_size, NULL);
    if (b == NULL) {
        archive_set_error(&archivereader->archive, ARCHIVE_ERRNO_MISC,
            "Failed to read full block when scanning ISO9660 directory list");
        return (ARCHIVE_FATAL);
    }

    p = b;
    while (p < b + iso9660->logical_block_size) {
        if (p[0] == 0) {
            skip_size = iso9660->logical_block_size - (p - b);
            break;
        }

        multi = calloc(1, sizeof(*multi));
        if (multi == NULL) {
            archive_set_error(&archivereader->archive, ENOMEM,
                "Can't allocate file info");
            return (ARCHIVE_FATAL);
        }

        if (parse_file_entry(archivereader, iso9660, multi, p) != ARCHIVE_OK) {
            free(multi);
            return (ARCHIVE_FATAL);
        }

        if (strcmp(multi->name.s, ".") == 0 || strcmp(multi->name.s, "..") == 0) {
            free(multi);
        } else if (multi->number != -1) {
            if (multi->contents.first == NULL) {
                cache_add_entry(iso9660, multi);
            } else {
                multi->next = multi_list;
                multi_list = multi;
            }
        } else {
            free(multi);
        }

        p += multi->size;
        step -= multi->size;
    }

    iso9660->current_position += iso9660->logical_block_size;
    __archive_read_consume(archivereader, iso9660->logical_block_size);
}