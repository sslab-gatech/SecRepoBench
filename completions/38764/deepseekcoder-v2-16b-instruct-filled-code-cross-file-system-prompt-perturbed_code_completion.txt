// Iterate over directory entries in the buffer while there is data to process.
// For each directory entry, parse its file information, and handle special cases:
// - Skip entries for '.' and '..' directories.
// - Manage multi-extent files by collecting their contents into a list.
// - For each valid directory entry, add it to the archive structure.
// - Handle memory allocation and error management for multi-extent file handling.

const unsigned char *entry_data = b;
size_t entry_data_size = step;
size_t processed_size = 0;

while (processed_size < entry_data_size) {
    struct iso9660_entry *entry = (struct iso9660_entry *)entry_data;
    size_t entry_size = get_entry_size(entry);

    if (entry_size == 0) {
        break;
    }

    if (is_dot_or_dotdot(entry)) {
        entry_data += entry_size;
        processed_size += entry_size;
        continue;
    }

    struct file_info *new_file = parse_entry(entry, iso9660);
    if (new_file == NULL) {
        archive_set_error(&archivereader->archive, ARCHIVE_ERRNO_MISC,
            "Failed to parse directory entry");
        return (ARCHIVE_FATAL);
    }

    if (is_multi_extent_entry(new_file)) {
        manage_multi_extent_entry(new_file, iso9660);
    } else {
        add_file_to_archive(archivereader, parent, new_file);
    }

    entry_data += entry_size;
    processed_size += entry_size;
}