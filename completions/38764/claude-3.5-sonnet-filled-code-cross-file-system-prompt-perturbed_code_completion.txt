p = b;
while (step) {
    struct file_info *file;
    size_t dr_len;

    if (p >= b + step)
        break;

    dr_len = p[0];
    if (dr_len == 0) {
        /* Zero-length directory record indicates end of directory */
        p += iso9660->logical_block_size;
        step -= iso9660->logical_block_size;
        continue;
    }
    if (p + dr_len > b + step) {
        archive_set_error(&archivereader->archive, ARCHIVE_ERRNO_MISC,
            "Invalid directory record length");
        return (ARCHIVE_FATAL);
    }

    file = parse_file_info(archivereader, iso9660, parent, p, dr_len);
    if (file == NULL) {
        return (ARCHIVE_FATAL);
    }

    if (file->cl_offset) {
        if (multi == NULL) {
            multi = file;
        } else {
            multi->next = file;
        }
    } else {
        if (file->name.s[0] == '\0') {
            /* Skip '.' and '..' entries */
            free(file);
        } else {
            add_entry(iso9660, file);
        }
    }

    p += dr_len;
    step -= dr_len;
}

if (multi) {
    while (multi) {
        struct file_info *next = multi->next;
        add_entry(iso9660, multi);
        multi = next;
    }
}