p = b;
		while (step > 0) {
			struct file_info *file;
			size_t dr_len;

			/* Check if there is enough data for a directory record. */
			if (step < 34 || p[0] == 0) {
				step = 0;
				break;
			}

			/* Length of directory record. */
			dr_len = p[0];
			if (dr_len > step) {
				archive_set_error(&archivereader->archive, ARCHIVE_ERRNO_MISC,
				    "Invalid length of directory record");
				return (ARCHIVE_FATAL);
			}

			/* Skip '.' and '..' entries. */
			if (p[33] == 0 || (p[33] == 1 && p[34] == 0)) {
				p += dr_len;
				step -= dr_len;
				continue;
			}

			/* Parse the directory record. */
			file = parse_file_info(iso9660, p, dr_len, parent);
			if (file == NULL) {
				archive_set_error(&archivereader->archive, ARCHIVE_ERRNO_MISC,
				    "Failed to parse file information");
				return (ARCHIVE_FATAL);
			}

			/* Handle multi-extent files. */
			if (multi != NULL) {
				if (multi->offset + multi->size == file->offset) {
					multi->size += file->size;
					free(file);
				} else {
					multi->next = file;
					multi = file;
				}
			} else if (file->multi_extent) {
				multi = file;
			} else {
				/* Add the file to the archive structure. */
				if (add_file_to_archive(iso9660, file) != ARCHIVE_OK) {
					free(file);
					return (ARCHIVE_FATAL);
				}
			}

			p += dr_len;
			step -= dr_len;
		}