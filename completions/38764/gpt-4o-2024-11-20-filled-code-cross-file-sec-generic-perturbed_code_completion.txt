p = b;
		while (step > 0) {
			struct file_info *file;
			size_t dr_len;

			/* Check if there's enough data for a directory record. */
			if (step < 34 || p[0] == 0) {
				/* Skip padding or invalid entries. */
				step--;
				p++;
				continue;
			}

			/* Length of the directory record. */
			dr_len = p[0];
			if (dr_len > step || dr_len < 34) {
				/* Invalid record length, skip it. */
				step--;
				p++;
				continue;
			}

			/* Parse the directory record. */
			file = parse_file_info(iso9660, p, dr_len, parent);
			if (file == NULL) {
				/* Parsing failed, skip this record. */
				step -= dr_len;
				p += dr_len;
				continue;
			}

			/* Skip '.' and '..' entries. */
			if (file->name.length == 1 && file->name.s[0] == '.') {
				release_file(file);
			} else if (file->name.length == 2 && file->name.s[0] == '.' &&
			           file->name.s[1] == '.') {
				release_file(file);
			} else {
				/* Handle multi-extent files. */
				if (multi != NULL) {
					if (add_multi_extent_file(multi, file) != ARCHIVE_OK) {
						release_file(file);
						return (ARCHIVE_FATAL);
					}
					if (file->multi_extent == 0)
						multi = NULL;
				} else if (file->multi_extent) {
					multi = file;
				}

				/* Add valid directory entry to the archive structure. */
				if (multi == NULL) {
					if (add_entry(iso9660, file) != ARCHIVE_OK) {
						release_file(file);
						return (ARCHIVE_FATAL);
					}
				}
			}

			/* Move to the next directory record. */
			step -= dr_len;
			p += dr_len;
		}