// Extract the response type and TTL (Time-To-Live) from the DNS response section.
// Set a risk flag if the TTL is zero, indicating suspicious DNS traffic.
// Output debug information about TTL and response type if DNS debugging is enabled.
// Perform a check on the DNS response type to further analyze the response.

u_int16_t responsetype;
u_int32_t rsp_ttl;

responsetype = get16(&x, packet->payload);
x += 2; // Move past the response type field

rsp_ttl = get32(&x, packet->payload);
x += 4; // Move past the TTL field

if (rsp_ttl == 0) {
    ndpi_set_risk(ndpi_struct, flow, NDPI_SUSPICIOUS_DNS_TRAFFIC, "Zero TTL in DNS response");
}

#ifdef DNS_DEBUG
NDPI_LOG_DBG2(ndpi_struct, "DNS Response Type: %u, TTL: %u\n", responsetype, rsp_ttl);
#endif

// Check the DNS response type
if (responsetype == 0x05 /* CNAME */) {
    // Skip CNAME
    x += data_len;
    continue;
}

if (((responsetype == 0x01) && (data_len == 4)) /* A */
    || ((responsetype == 0x1c) && (data_len == 16)) /* AAAA */) {
    memcpy(&flow->protos.dns.rsp_addr, packet->payload + x, data_len);
}