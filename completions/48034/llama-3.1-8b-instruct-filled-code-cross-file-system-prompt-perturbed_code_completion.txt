if(responsetype == 0x05 /* CNAME */) {
  x += data_len;
  continue; /* Skip CNAME */
}

if((((responsetype == 0x1) && (data_len == 4)) /* A */
    || ((responsetype == 0x1c) && (data_len == 16)) /* AAAA */
    )) {
  memcpy(&flow->protos.dns.rsp_addr, packet->payload + x, data_len);
  rsp_ttl = get32(&x, packet->payload);
  if(rsp_ttl == 0) {
    ndpi_set_risk(ndpi_struct, flow, NDPI_RISKY_DNS_TTL, "DNS Response with TTL=0");
  } else {
    flow->protos.dns.rsp_ttl = rsp_ttl;
  }
  flow->protos.dns.rsp_type = responsetype;
  if(DNS_DEBUG) {
    NDPI_LOG_DBG2(ndpi_struct, "rsp_type=%2d, rsp_ttl=%u\n", flow->protos.dns.rsp_type, flow->protos.dns.rsp_ttl);
    printf("[DNS] [response] rsp_type=%d, rsp_ttl=%u\n", flow->protos.dns.rsp_type, flow->protos.dns.rsp_ttl);
  }
  if(responsetype == 0x05 /* CNAME */) {
    x += data_len;
    continue; /* Skip CNAME */
  }
  if(responsetype == 0x1 /* A */) {
    if(data_len == 4) {
      flow->protos.dns.rsp_addr = ntohl(*((u_int32_t*)packet->payload + x));
    }
  } else if(responsetype == 0x1c /* AAAA */) {
    if(data_len == 16) {
      flow->protos.dns.rsp_addr = ntohl(*((u_int128_t*)packet->payload + x));
    }
  }
}