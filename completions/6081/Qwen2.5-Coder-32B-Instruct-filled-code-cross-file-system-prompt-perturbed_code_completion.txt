c=xml;
    while (*c != '\0')
    {
      if (strncmp(c,"<!ENTITY",8) == 0)
      {
        c+=8;
        while (isspace((int) *c))
          c++;
        v=c;
        while (*c != '\0' && !isspace((int) *c) && *c != '"')
          c++;
        q=*c;
        *c='\0';
        t=v;
        c++;
        while (*c != '\0' && *c != q)
          c++;
        *c='\0';
        entities=(char **) AcquireMagickMemory(3*sizeof(*entities));
        if (entities == (char **) NULL)
          ThrowFatalException(ResourceLimitError,"MemoryAllocationFailed");
        entities[0]=ConstantString(t);
        entities[1]=ConstantString(v);
        entities[2]=(char *) NULL;
        predefined_entitites=(char **) RelinquishMagickMemory(predefined_entitites);
        predefined_entitites=entities;
        c++;
      }
      else if (strncmp(c,"<!ATTLIST",9) == 0)
      {
        c+=9;
        while (isspace((int) *c))
          c++;
        v=c;
        while (*c != '\0' && !isspace((int) *c))
          c++;
        q=*c;
        *c='\0';
        t=v;
        c++;
        ParseOpenTag(root,t,(char **) NULL);
        while (*c != '\0' && *c != '>')
        {
          while (isspace((int) *c))
            c++;
          v=c;
          while (*c != '\0' && !isspace((int) *c) && *c != '=')
            c++;
          q=*c;
          *c='\0';
          t=v;
          c++;
          while (isspace((int) *c))
            c++;
          if (*c == '"')
          {
            c++;
            v=c;
            while (*c != '\0' && *c != '"')
              c++;
            q=*c;
            *c='\0';
            t=v;
            c++;
          }
          else if (*c == '\'')
          {
            c++;
            v=c;
            while (*c != '\0' && *c != '\'')
              c++;
            q=*c;
            *c='\0';
            t=v;
            c++;
          }
          else
          {
            v=c;
            while (*c != '\0' && !isspace((int) *c) && *c != '>')
              c++;
            q=*c;
            *c='\0';
            t=v;
          }
          ParseCharacterContent(root,t,strlen(t),'\0');
        }
        c++;
      }
      else if (strncmp(c,"<!--",4) == 0)
      {
        c+=4;
        while (*c != '\0' && !(c[0] == '-' && c[1] == '-' && c[2] == '>'))
          c++;
        if (*c != '\0')
          c+=3;
      }
      else if (strncmp(c,"<?",2) == 0)
      {
        c+=2;
        while (*c != '\0' && !(c[0] == '?' && c[1] == '>'))
          c++;
        if (*c != '\0')
          c+=2;
      }
      else
        c++;
    }