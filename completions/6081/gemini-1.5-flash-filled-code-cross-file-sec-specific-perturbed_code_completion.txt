c=xml;
    while (*c != '\0')
    {
      if (*c == '<')
        {
          c++;
          if (*c == '!')
            {
              c++;
              if ((strncmp(c,"--",2) == 0) &&
                  ((index=SearchString(c,"-->")) != -1))
                {
                  c+=index+3;
                  continue;
                }
              if (strncmp(c,"DOCTYPE",7) == 0)
                {
                  c+=7;
                  while ((*c != '[') && (*c != '\0'))
                    c++;
                  if (*c == '[')
                    {
                      c++;
                      while ((*c != ']') && (*c != '\0'))
                        c++;
                      if (*c == ']')
                        c++;
                      else
                        ThrowException(exception,OptionError,
                          "ImproperlyTerminatedDocTypeDeclaration");
                    }
                  while ((*c != '>') && (*c != '\0'))
                    c++;
                  if (*c == '>')
                    c++;
                  else
                    ThrowException(exception,OptionError,
                      "ImproperlyTerminatedDocTypeDeclaration");
                  break;
                }
              ThrowException(exception,OptionError,
                "UnrecognizedXMLDeclaration");
            }
          else if (*c == '?')
            {
              c++;
              if ((index=SearchString(c,"?>")) != -1)
                c+=index+2;
              else
                ThrowException(exception,OptionError,
                  "UnrecognizedXMLDeclaration");
            }
          else if (*c == '/')
            {
              c++;
              if ((index=SearchString(c,">")) != -1)
                c+=index+1;
              else
                ThrowException(exception,OptionError,
                  "UnrecognizedXMLDeclaration");
            }
          else if (isalpha(*c) != 0)
            {
              t=c;
              while (isalnum(*c) != 0)
                c++;
              *c='\0';
              if (strcasecmp(t,"ENTITY") == 0)
                {
                  c++;
                  while (isspace(*c) != 0)
                    c++;
                  n=c;
                  while (isalnum(*c) != 0)
                    c++;
                  q=*c;
                  *c='\0';
                  c++;
                  while (isspace(*c) != 0)
                    c++;
                  if (*c == '"')
                    {
                      c++;
                      v=c;
                      while (*c != '"')
                        c++;
                      *c='\0';
                      c++;
                    }
                  else if (*c == '\'')
                    {
                      c++;
                      v=c;
                      while (*c != '\'')
                        c++;
                      *c='\0';
                      c++;
                    }
                  else
                    ThrowException(exception,OptionError,
                      "ImproperlyFormedEntityDeclaration");
                  entities=(char **) AcquireMagickMemory(sizeof(*entities)*
                    (root->number_entities+2));
                  if (entities == (char **) NULL)
                    ThrowFatalException(ResourceLimitError,
                      "MemoryAllocationFailed");
                  (void) CopyMagickMemory(entities,root->entities,
                    sizeof(*entities)*root->number_entities);
                  entities[root->number_entities]=AcquireString(n);
                  entities[root->number_entities+1]=AcquireString(v);
                  root->entities=entities;
                  root->number_entities+=2;
                }
              else if (strcasecmp(t,"ATTLIST") == 0)
                {
                  c++;
                  while ((*c != '>') && (*c != '\0'))
                    c++;
                  if (*c == '>')
                    c++;
                  else
                    ThrowException(exception,OptionError,
                      "ImproperlyTerminatedAttlistDeclaration");
                }
              else
                {
                  while ((*c != '>') && (*c != '\0'))
                    c++;
                  if (*c == '>')
                    c++;
                  else
                    ThrowException(exception,OptionError,
                      "UnrecognizedXMLDeclaration");
                }
            }
        }
      else
        c++;
    }
    xml=c;