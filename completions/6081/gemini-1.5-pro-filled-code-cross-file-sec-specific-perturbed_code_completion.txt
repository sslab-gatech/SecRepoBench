c=xml;
    while (isspace((int) ((unsigned char) *c)) != 0)
      c++;
    xml=c;
    if (*xml == '\0')
      break;
    if (strncmp(xml,"<!DOCTYPE",9) == 0)
      {
        char
          *p,
          target[MagickPathExtent];

        (void) memset(target,0,sizeof(target));
        xml+=9;
        while (isspace((int) ((unsigned char) *xml)) != 0)
          xml++;
        c=xml;
        while (!isspace((int) ((unsigned char) *c)) && (*c != '['))
          c++;
        (void) CopyMagickString(target,xml,c-xml+1);
        while (isspace((int) ((unsigned char) *xml)) != 0)
          xml++;
        if (*xml == '[')
          {
            /*
              Parse an internal subset.
            */
            xml++;
            for ( ; xml != (char *) NULL; )
            {
              while (isspace((int) ((unsigned char) *xml)) != 0)
                xml++;
              if (*xml == '\0')
                break;
              t=xml;
              if (strncmp(xml,"<!ENTITY",8) == 0)
                {
                  /*
                    Parse ENTITY declaration.
                  */
                  xml+=8;
                  while (isspace((int) ((unsigned char) *xml)) != 0)
                    xml++;
                  if (*xml == '%')
                    {
                      /*
                        Parameter entity.
                      */
                      xml++;
                      while (isspace((int) ((unsigned char) *xml)) != 0)
                        xml++;
                    }
                  n=xml;
                  while (isalnum((int) ((unsigned char) *xml)) != 0)
                    xml++;
                  if ((c=xml) != (char *) NULL)
                    {
                      while (isspace((int) ((unsigned char) *xml)) != 0)
                        xml++;
                      v=xml;
                      q=(*v == '"' || *v == '\'') ? *v++ : '\0';
                      if (q != '\0')
                        while ((*xml != q) && (*xml != '\0'))
                          xml++;
                      if (*xml != '\0')
                        xml++;
                      entities=(char **) ResizeMagickMemory(predefined_entitites,
                        (size_t) (index+2)*sizeof(*entities));
                      if (entities == (char **) NULL)
                        {
                          predefined_entitites=(char **)
                            RelinquishMagickMemory(predefined_entitites);
                          ThrowFatalException(ResourceLimitError,
                            "MemoryAllocationFailed");
                        }
                      predefined_entitites=entities;
                      entities[index]=AcquireString(n);
                      entities[index+1]=AcquireString(v);
                      entities[index+2]=NULL;
                      index+=2;
                      (void) SubstituteString(&entities[index-1],"&","&amp;");
                      (void) SubstituteString(&entities[index-1],"<","&lt;");
                      (void) SubstituteString(&entities[index-1],">","&gt;");
                      if (q != '\0')
                        entities[index-1][xml-v-1]='\0';
                      root->entities=predefined_entitites;
                    }
                }
              else
                if (strncmp(xml,"<!ATTLIST",9) == 0)
                  {
                    /*
                      Parse ATTLIST declaration.
                    */
                    xml+=9;
                    while (isspace((int) ((unsigned char) *xml)) != 0)
                      xml++;
                    n=xml;
                    while (!isspace((int) ((unsigned char) *xml)) != 0)
                      xml++;
                    if ((c=xml) != (char *) NULL)
                      {
                        while (isspace((int) ((unsigned char) *xml)) != 0)
                          xml++;
                        while (!isspace((int) ((unsigned char) *xml)) != 0)
                          xml++;
                        if ((c=xml) != (char *) NULL)
                          {
                            while (isspace((int) ((unsigned char) *xml)) != 0)
                              xml++;
                            while (!isspace((int) ((unsigned char) *xml)) &&
                                   (*xml != '>'))
                              xml++;
                            if (*xml == '>')
                              xml++;
                          }
                      }
                  }
              else
                if (strncmp(xml,"<!--",4) == 0)
                  {
                    /*
                      Parse comment.
                    */
                    xml+=4;
                    while ((strncmp(xml,"-->",3) != 0) && (*xml != '\0'))
                      xml++;
                    if (*xml != '\0')
                      xml+=3;
                  }
              else
                if (strncmp(xml,"<?",2) == 0)
                  {
                    /*
                      Parse processing instructions.
                    */
                    xml+=2;
                    while ((strncmp(xml,"?>",2) != 0) && (*xml != '\0'))
                      xml++;
                    if (*xml != '\0')
                      xml+=2;
                  }
              else
                if (*xml == ']')
                  {
                    xml++;
                    break;
                  }
              else
                xml++;
            }
          }
        while (isspace((int) ((unsigned char) *xml)) != 0)
          xml++;
        if (*xml == '>')
          xml++;
        break;
      }
    if (strncmp(xml,"<!--",4) == 0)
      {
        /*
          Skip over comment.
        */
        xml+=4;
        while ((xml != (char *) NULL) && (strncmp(xml,"-->",3) != 0))
          xml++;
        if (xml != (char *) NULL)
          xml+=3;
        continue;
      }
    if (strncmp(xml,"<?",2) == 0)
      {
        /*
          Skip over processing instructions.
        */
        xml+=2;
        while ((xml != (char *) NULL) && (strncmp(xml,"?>",2) != 0))
          xml++;
        if (xml != (char *) NULL)
          xml+=2;
        continue;
      }
    break;