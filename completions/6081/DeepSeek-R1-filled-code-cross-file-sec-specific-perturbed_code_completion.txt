c=xml;
    while (*c != '\0')
    {
      if (strncmp(c,"<!ENTITY",8) == 0)
      {
        char *entity_name,*entity_value;
        c+=8;
        while (isspace((unsigned char)*c) != 0)
          c++;
        if (*c == '%')
        {
          c++;
          while (isspace((unsigned char)*c) != 0)
            c++;
        }
        for (entity_name=c; (*c != ' ') && (*c != '>'); c++) ;
        entity_name=ConstantStringN(entity_name,(size_t)(c-entity_name));
        while ((*c != '\'') && (*c != '"') && (*c != '>') && (*c != '\0'))
          c++;
        if (*c == '\0')
          break;
        q=*c++;
        for (entity_value=c; (*c != q) && (*c != '>') && (*c != '\0'); c++) ;
        entity_value=ConstantStringN(entity_value,(size_t)(c-entity_value));
        for (i=0; predefined_entitites[i] != (char *) NULL; i+=2)
          if (strcmp(predefined_entitites[i],entity_name) == 0)
            break;
        if (predefined_entitites[i] == (char *) NULL)
        {
          predefined_entitites=(char **) ResizeMagickMemory(
            predefined_entitites,(i+3)*sizeof(*predefined_entitites));
          if (predefined_entitites == (char **) NULL)
            ThrowFatalException(ResourceLimitError,"MemoryAllocationFailed");
          predefined_entitites[i]=entity_name;
          predefined_entitites[i+1]=entity_value;
          predefined_entitites[i+2]=(char *) NULL;
        }
        else
        {
          entity_name=DestroyString(entity_name);
          entity_value=DestroyString(entity_value);
        }
      }
      if (strncmp(c,"<!ATTLIST",9) == 0)
      {
        char **attributes;
        ssize_t
          j;
        
        c+=9;
        attributes=root->node->attributes;
        for (j=0; attributes[j] != (char *) NULL; j+=4) ;
        attributes=(char **) ResizeMagickMemory(attributes,(j+5)*sizeof(*attributes));
        if (attributes == (char **) NULL)
          ThrowFatalException(ResourceLimitError,"MemoryAllocationFailed");
        root->node->attributes=attributes;
        while (isspace((unsigned char)*c) != 0)
          c++;
        for (v=c; (*c != ' ') && (*c != '>'); c++) ;
        attributes[j]=ConstantStringN(v,(size_t)(c-v));
        attributes[j+3]=(char *) NULL;
      }
      if (strncmp(c,"<!--",4) == 0)
      {
        c+=4;
        while ((*c != '\0') && (strncmp(c,"-->",3) != 0))
          c++;
        if (*c != '\0')
          c+=3;
      }
      if (strncmp(c,"<?",2) == 0)
      {
        c+=2;
        while ((*c != '\0') && (strncmp(c,"?>",2) != 0))
          c++;
        if (*c != '\0')
          c+=2;
      }
      if (*c == '>')
      {
        c++;
        break;
      }
      c++;
    }
    xml=c;