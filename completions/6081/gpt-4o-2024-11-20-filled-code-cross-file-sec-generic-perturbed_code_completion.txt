c = xml;
    while (*c != '\0')
    {
      // Skip whitespace
      while (isspace((int) *c))
        c++;

      // Check for ENTITY declaration
      if (strncmp(c, "<!ENTITY", 8) == 0)
      {
        c += 8;
        while (isspace((int) *c))
          c++;

        // Parse entity name
        t = c;
        while (isalnum((int) *c) || *c == '_' || *c == '-')
          c++;
        *c = '\0';
        n = ConstantString(t);
        c++;

        // Skip whitespace
        while (isspace((int) *c))
          c++;

        // Parse entity value
        if (*c == '"' || *c == '\'')
        {
          q = *c;
          c++;
          t = c;
          while (*c != q && *c != '\0')
            c++;
          if (*c == '\0')
          {
            ThrowException(exception, OptionError, "MalformedEntity", n);
            break;
          }
          *c = '\0';
          v = ConstantString(t);
          c++;

          // Store the entity
          index = 0;
          while (predefined_entitites[index] != (char *) NULL)
            index++;
          entities = (char **) ResizeQuantumMemory(predefined_entitites, index + 2, sizeof(*entities));
          if (entities == (char **) NULL)
          {
            ThrowFatalException(ResourceLimitError, "MemoryAllocationFailed");
            break;
          }
          predefined_entitites = entities;
          predefined_entitites[index] = n;
          predefined_entitites[index + 1] = v;
          predefined_entitites[index + 2] = (char *) NULL;
        }
        else
        {
          ThrowException(exception, OptionError, "MalformedEntity", n);
          break;
        }
      }
      else if (strncmp(c, "<!ATTLIST", 9) == 0)
      {
        // Handle ATTLIST declarations (simplified for brevity)
        c += 9;
        while (*c != '>' && *c != '\0')
          c++;
        if (*c == '\0')
        {
          ThrowException(exception, OptionError, "MalformedAttlist", "Incomplete ATTLIST declaration");
          break;
        }
        c++;
      }
      else if (strncmp(c, "<!--", 4) == 0)
      {
        // Handle comments
        c += 4;
        while (strncmp(c, "-->", 3) != 0 && *c != '\0')
          c++;
        if (*c == '\0')
        {
          ThrowException(exception, OptionError, "MalformedComment", "Unterminated comment");
          break;
        }
        c += 3;
      }
      else if (strncmp(c, "<?", 2) == 0)
      {
        // Handle processing instructions
        c += 2;
        while (strncmp(c, "?>", 2) != 0 && *c != '\0')
          c++;
        if (*c == '\0')
        {
          ThrowException(exception, OptionError, "MalformedProcessingInstruction", "Unterminated processing instruction");
          break;
        }
        c += 2;
      }
      else
      {
        // Skip unknown or unsupported declarations
        while (*c != '>' && *c != '\0')
          c++;
        if (*c == '\0')
        {
          ThrowException(exception, OptionError, "MalformedDeclaration", "Unterminated declaration");
          break;
        }
        c++;
      }
    }