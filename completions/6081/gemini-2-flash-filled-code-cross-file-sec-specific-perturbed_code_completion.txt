c=xml;
    while ((c < (xml+length)) && (*c != '\0'))
    {
      if (*c == '<')
        {
          c++;
          if (*c == '!')
            {
              c++;
              if (strncmp(c,"DOCTYPE",7) == 0)
                {
                  c+=7;
                  while ((c < (xml+length)) && (*c != '['))
                    c++;
                  if (c >= (xml+length))
                    break;
                  c++;
                }
              else if (strncmp(c,"--",2) == 0)
                {
                  c+=2;
                  while ((c < (xml+length-2)) &&
                         (strncmp(c,"--",2) != 0))
                    c++;
                  if (c < (xml+length-2))
                    c+=2;
                  if (c < (xml+length) && (*c == '>'))
                    c++;
                }
              else
                {
                  /*
                    Malformed comment.
                  */
                  c++;
                }
            }
          else if (*c == '?')
            {
              c++;
              while ((c < (xml+length-1)) &&
                     (strncmp(c,"?>",2) != 0))
                c++;
              if (c < (xml+length-1))
                c+=2;
            }
          else if (*c == '/')
            {
              c++;
              while ((c < (xml+length)) && (*c != '>'))
                c++;
              if (c < (xml+length))
                c++;
            }
          else
            {
              while ((c < (xml+length)) && (*c != '>'))
                c++;
              if (c < (xml+length))
                c++;
            }
        }
      else
        c++;