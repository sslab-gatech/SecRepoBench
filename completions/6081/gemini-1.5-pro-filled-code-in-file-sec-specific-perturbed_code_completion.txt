while (isspace((int) ((unsigned char) *xml)) != 0)
  xml++;
t=xml;
c=(*t);
if ((c == '\'') || (c == '"'))
  {
    q=c;
    xml++;
    while ((*xml != '\0') && (*xml != q))
      xml++;
    if (*xml == '\0')
      break;
    xml++;
  }
while (isspace((int) ((unsigned char) *xml)) != 0)
  xml++;
if (strncmp(xml,"<!ENTITY",8) == 0)
  {
    /*
      Parse ENTITY declaration.
    */
    xml+=8;
    while (isspace((int) ((unsigned char) *xml)) != 0)
      xml++;
    if (strncmp(xml,"% ",2) == 0)
      state='%';
    else
      state='&';
    if (state == '%')
      xml+=2;
    while (isspace((int) ((unsigned char) *xml)) != 0)
      xml++;
    n=xml;
    xml+=strcspn(n,XMLWhitespace ">");
    if (*xml != '\0')
      *xml++='\0';
    while (isspace((int) ((unsigned char) *xml)) != 0)
      xml++;
    if (*xml == '\0')
      break;
    c=(*xml);
    if ((c == '\'') || (c == '"'))
      {
        q=c;
        xml++;
        while ((*xml != '\0') && (*xml != q))
          xml++;
        if (*xml == '\0')
          break;
        *xml++='\0';
      }
    v=xml;
    xml+=strcspn(xml,XMLWhitespace ">");
    if (*xml != '\0')
      *xml++='\0';
    while (isspace((int) ((unsigned char) *xml)) != 0)
      xml++;
    if (state == '&')
      {
        if (ValidateEntities(n,v,0,predefined_entitites) == MagickFalse)
          {
            (void) ThrowMagickException(exception,GetMagickModule(),
              OptionWarning,"ParseError","circular entity declaration");
            predefined_entitites=(char **) RelinquishMagickMemory(
              predefined_entitites);
            return(MagickFalse);
          }
      }
    /*
      Predefined entity.
    */
    index=0;
    entities=predefined_entitites;
    while (entities[index] != (char *) NULL)
      index++;
    entities=(char **) ResizeQuantumMemory(entities,(size_t) (index+4),
      sizeof(*entities));
    if (entities == (char **) NULL)
      ThrowFatalException(ResourceLimitFatalError,"MemoryAllocationFailed");
    entities[index+2]=(char *) NULL;
    entities[index+1]=(char *) NULL;
    entities[index]=ConstantString(n);
    entities[index+1]=ConstantString(v);
    predefined_entitites=entities;
    if (root->entities != sentinel)
      root->entities=(char **) RelinquishMagickMemory(root->entities);
    root->entities=predefined_entitites;
    continue;
  }
if (strncmp(xml,"<!ATTLIST",9) == 0)
  {
    /*
      Parse default attribute.
    */
    xml+=9;
    while (isspace((int) ((unsigned char) *xml)) != 0)
      xml++;
    t=xml;
    xml+=strcspn(t,XMLWhitespace ">");
    if (*xml != '\0')
      *xml++='\0';
    while (isspace((int) ((unsigned char) *xml)) != 0)
      xml++;
    if (*xml == '\0')
      break;
    n=xml;
    xml+=strcspn(n,XMLWhitespace ">");
    if (*xml != '\0')
      *xml++='\0';
    while (isspace((int) ((unsigned char) *xml)) != 0)
      xml++;
    if (*xml == '\0')
      break;
    /*
      Default attribute tag.
    */
    i=0;
    while ((root->attributes[i] != (char **) NULL) &&
           (strcmp(root->attributes[i][0],t) != 0))
      i++;
    if (root->attributes[i] == (char **) NULL)
      {
        if (root->attributes == sentinel)
          {
            root->attributes=(char ***) AcquireCriticalMemory(2*
              sizeof(*root->attributes));
            root->attributes[1]=(char **) NULL;
          }
        else
          root->attributes=(char ***) ResizeQuantumMemory(root->attributes,
            (size_t) (i+2),sizeof(*root->attributes));
        if (root->attributes == (char ***) NULL)
          ThrowFatalException(ResourceLimitFatalError,"MemoryAllocationFailed");
        root->attributes[i]=(char **) AcquireQuantumMemory(4,
          sizeof(**root->attributes));
        if (root->attributes[i] == (char **) NULL)
          ThrowFatalException(ResourceLimitFatalError,"MemoryAllocationFailed");
        root->attributes[i+1]=(char **) NULL;
        root->attributes[i][0]=ConstantString(t);
        root->attributes[i][1]=(char *) NULL;
        root->attributes[i][2]=ConstantString("");
        root->attributes[i][3]=ConstantString("");
      }
    j=1;
    while ((root->attributes[i][j] != (char *) NULL) &&
           (strcmp(root->attributes[i][j],n) != 0))
      j+=3;
    if (root->attributes[i][j] == (char *) NULL)
      {
        root->attributes[i]=(char **) ResizeQuantumMemory(root->attributes[i],
          (size_t) (j+4),sizeof(**root->attributes));
        if (root->attributes[i] == (char **) NULL)
          ThrowFatalException(ResourceLimitFatalError,"MemoryAllocationFailed");
        root->attributes[i][j+3]=(char *) NULL;
        root->attributes[i][j+2]=(char *) NULL;
        root->attributes[i][j+1]=(char *) NULL;
        root->attributes[i][j]=ConstantString(n);
      }
    v=xml;
    xml+=strcspn(xml,XMLWhitespace ">");
    if (*xml != '\0')
      *xml++='\0';
    while (isspace((int) ((unsigned char) *xml)) != 0)
      xml++;
    c=(*xml);
    if ((c == '\'') || (c == '"'))
      {
        q=c;
        xml++;
        v=xml;
        while ((*xml != '\0') && (*xml != q))
          xml++;
        if (*xml == '\0')
          break;
        *xml++='\0';
      }
    if (root->attributes[i][j+1] != (char *) NULL)
      root->attributes[i][j+1]=DestroyString(root->attributes[i][j+1]);
    root->attributes[i][j+1]=ConstantString(v);
    t=xml;
    xml+=strcspn(t,XMLWhitespace ">");
    if (*xml != '\0')
      *xml++='\0';
    while (isspace((int) ((unsigned char) *xml)) != 0)
      xml++;
    if (root->attributes[i][j+2] != (char *) NULL)
      root->attributes[i][j+2]=DestroyString(root->attributes[i][j+2]);
    root->attributes[i][j+2]=ConstantString(t);
    continue;
  }
if (strncmp(xml,"<!--",4) == 0)
  {
    /*
      Comment.
    */
    xml=strstr(xml,"-->");
    if (xml != (char *) NULL)
      xml+=2;
    continue;
  }
if (strncmp(xml,"<?",2) == 0)
  {
    /*
      Processing instructions.
    */
    xml=strstr(xml,"?>");
    if (xml != (char *) NULL)
      xml++;
    continue;
  }
if (*xml == '>')
  {
    xml++;
    continue;
  }
break;