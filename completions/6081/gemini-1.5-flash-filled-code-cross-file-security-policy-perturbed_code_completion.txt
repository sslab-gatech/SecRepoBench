c=xml;
    while ((c != (char *) NULL) && (*c != '<'))
      c++;
    if (c == (char *) NULL)
      break;
    if (strncmp(c,"<!DOCTYPE",9) == 0)
      {
        c+=9;
        while ((c != (char *) NULL) && (isspace((int) *c) != 0))
          c++;
        if (c == (char *) NULL)
          break;
        t=c;
        while ((c != (char *) NULL) && (isspace((int) *c) == 0) &&
               (*c != '['))
          c++;
        if (c == (char *) NULL)
          break;
        *c='\0';
        (void) SetLogEventMask(0);
        root->doctype=ConstantString(t);
        (void) SetLogEventMask(root->debug);
        if (*c == '[')
          {
            c++;
            while ((c != (char *) NULL) && (*c != ']'))
              c++;
            if (c == (char *) NULL)
              break;
            c++;
          }
        while ((c != (char *) NULL) && (isspace((int) *c) != 0))
          c++;
        if (c == (char *) NULL)
          break;
        while ((c != (char *) NULL) && (*c != '>'))
          {
            if (strncmp(c,"ENTITY",6) == 0)
              {
                c+=6;
                while ((c != (char *) NULL) && (isspace((int) *c) != 0))
                  c++;
                if (c == (char *) NULL)
                  break;
                t=c;
                while ((c != (char *) NULL) && (isspace((int) *c) == 0) &&
                       (*c != '%') && (*c != '>') && (*c != '='))
                  c++;
                if (c == (char *) NULL)
                  break;
                q=*c;
                *c='\0';
                while ((c != (char *) NULL) && (isspace((int) *c) != 0))
                  c++;
                if (c == (char *) NULL)
                  break;
                if (*c == '=')
                  {
                    c++;
                    while ((c != (char *) NULL) &&
                           (isspace((int) *c) != 0))
                      c++;
                    if (c == (char *) NULL)
                      break;
                    v=c;
                    while ((c != (char *) NULL) && (*c != '>'))
                      c++;
                    if (c == (char *) NULL)
                      break;
                    *c='\0';
                    entities=(char **) AcquireMagickMemory(sizeof(*entities)*
                      (root->number_entities+2));
                    if (entities == (char **) NULL)
                      ThrowFatalException(ResourceLimitError,
                        "MemoryAllocationFailed");
                    (void) CopyMagickMemory(entities,root->entities,
                      sizeof(*entities)*root->number_entities);
                    entities[root->number_entities]=t;
                    entities[root->number_entities+1]=v;
                    root->entities=entities;
                    root->number_entities+=2;
                  }
              }
            else if (strncmp(c,"ATTLIST",7) == 0)
              {
                /*
                  Handle ATTLIST declarations.
                */
              }
            else if (strncmp(c,"<!--",4) == 0)
              {
                /*
                  Handle comments.
                */
              }
            else if (strncmp(c,"<?",2) == 0)
              {
                /*
                  Handle processing instructions.
                */
              }
            while ((c != (char *) NULL) && (*c != '>'))
              c++;
            if (c == (char *) NULL)
              break;
            c++;
          }
        xml=c;
      }
    else
      break;