c=xml;
    while (*c != '\0')
    {
      if (*c == '<')
        {
          c++;
          if (*c == '!')
            {
              c++;
              if ((strncmp(c,"--",2) == 0) ||
                  (strncmp(c,"DOCTYPE",7) == 0))
                {
                  while ((*c != '\0') && (*c != '>'))
                    c++;
                  if (*c == '\0')
                    break;
                  c++;
                }
              else
                if (strncmp(c,"[CDATA[",7) == 0)
                  {
                    c+=7;
                    while ((*c != '\0') && (strncmp(c,"]]>",3) != 0))
                      c++;
                    if (*c == '\0')
                      break;
                    c+=3;
                  }
                else
                  {
                    while ((*c != '\0') && (*c != '>'))
                      c++;
                    if (*c == '\0')
                      break;
                    c++;
                  }
            }
          else
            if (*c == '?')
              {
                c++;
                while ((*c != '\0') && (*c != '>'))
                  c++;
                if (*c == '\0')
                  break;
                c++;
              }
            else
              if (*c == '/')
                {
                  c++;
                  while ((*c != '\0') && (*c != '>'))
                    c++;
                  if (*c == '\0')
                    break;
                  c++;
                }
              else
                {
                  t=c;
                  while ((*c != '\0') && (*c != ' ') && (*c != '>'))
                    c++;
                  q=*c;
                  *c='\0';
                  c++;
                  entities=ParseAttributes(c,&c);
                  if (strcasecmp(t,"ENTITY") == 0)
                    {
                      if (entities == (char **) NULL)
                        ThrowFatalException(OptionError,"MissingEntityName");
                      v=entities[0];
                      n=entities[1];
                      if (n == (char *) NULL)
                        ThrowFatalException(OptionError,"MissingEntityValue");
                      index=ParseEntities(v,predefined_entitites,0);
                      if (index != -1)
                        {
                          predefined_entitites=(char **) RelinquishMagickMemory(
                            predefined_entitites);
                          ThrowFatalException(OptionError,"DuplicateEntity");
                        }
                      predefined_entitites=(char **) ResizeMagickMemory(
                        predefined_entitites,
                        (size_t) (sizeof(*predefined_entitites)*(index+2)),
                        sizeof(*predefined_entitites));
                      if (predefined_entitites == (char **) NULL)
                        ThrowFatalException(ResourceLimitError,
                          "MemoryAllocationFailed");
                      predefined_entitites[index+1]=ConstantString(n);
                      predefined_entitites[index+2]=(char *) NULL;
                    }
                  else
                    if (strcasecmp(t,"ATTLIST") == 0)
                      {
                        if (entities == (char **) NULL)
                          ThrowFatalException(OptionError,"MissingAttlist");
                      }
                  if (entities != (char **) NULL)
                    entities=(char **) RelinquishMagickMemory(entities);
                  if (q == '>')
                    break;
                }
        }
      else
        c++;
    }