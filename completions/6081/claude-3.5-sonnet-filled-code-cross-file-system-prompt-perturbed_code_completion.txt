for (c=xml; *c != '\0'; )
{
  while ((*c == ' ') || (*c == '\t') || (*c == '\n') || (*c == '\r'))
    c++;
  if (*c == '\0')
    break;
  if ((*c == '<') && (*(c+1) == '!') && (*(c+2) == '-') && (*(c+3) == '-'))
    {
      c+=4;
      for (t=c; (*t != '\0') && !((t[0] == '-') && (t[1] == '-') &&
           (t[2] == '>')); t++) ;
      if (*t == '\0')
        break;
      c=t+3;
      continue;
    }
  if ((*c == '<') && (*(c+1) == '?'))
    {
      c+=2;
      for (t=c; (*t != '\0') && !((t[0] == '?') && (t[1] == '>')); t++) ;
      if (*t == '\0')
        break;
      c=t+2;
      continue;
    }
  if (strncmp(c,"<!ENTITY",8) == 0)
    {
      c+=8;
      while ((*c == ' ') || (*c == '\t') || (*c == '\n') || (*c == '\r'))
        c++;
      n=c;
      while ((*c != ' ') && (*c != '\t') && (*c != '\n') && (*c != '\r') &&
             (*c != '\0'))
        c++;
      if (*c == '\0')
        break;
      *c='\0';
      v=c+1;
      while ((*v == ' ') || (*v == '\t') || (*v == '\n') || (*v == '\r'))
        v++;
      q=(*v);
      v++;
      if ((q != '"') && (q != '\''))
        break;
      for (t=v; (*t != '\0') && (*t != q); t++) ;
      if (*t == '\0')
        break;
      *t='\0';
      for (i=0; predefined_entitites[i] != (char *) NULL; i+=2)
      {
        if (LocaleCompare(n,predefined_entitites[i]) == 0)
          {
            v=(char *) predefined_entitites[i+1];
            break;
          }
      }
      entities=(char **) ResizeQuantumMemory(root->entities,
        (i=root->entities_length+2),sizeof(*root->entities));
      if (entities == (char **) NULL)
        break;
      root->entities=entities;
      root->entities[i-2]=ConstantString(n);
      root->entities[i-1]=ConstantString(v);
      root->entities[i]=(char *) NULL;
      root->entities_length=i;
      c=t+1;
      while ((*c == ' ') || (*c == '\t') || (*c == '\n') || (*c == '\r'))
        c++;
      if (*c != '>')
        break;
      c++;
    }
  else
    if (strncmp(c,"<!ATTLIST",9) == 0)
      {
        c+=9;
        while ((*c == ' ') || (*c == '\t') || (*c == '\n') || (*c == '\r'))
          c++;
        n=c;
        while ((*c != ' ') && (*c != '\t') && (*c != '\n') && (*c != '\r') &&
               (*c != '\0'))
          c++;
        if (*c == '\0')
          break;
        *c='\0';
        index=0;
        for (i=0; root->attributes[i] != (char **) NULL; i++)
          if (LocaleCompare(root->attributes[i][0],n) == 0)
            {
              index=i;
              break;
            }
        if (root->attributes[index] == (char **) NULL)
          {
            char
              ***attributes;

            attributes=(char ***) ResizeQuantumMemory(root->attributes,
              (i+2),sizeof(*root->attributes));
            if (attributes == (char ***) NULL)
              break;
            root->attributes=attributes;
            root->attributes[i]=(char **) AcquireQuantumMemory(3,
              sizeof(**root->attributes));
            if (root->attributes[i] == (char **) NULL)
              break;
            root->attributes[i][0]=ConstantString(n);
            root->attributes[i][1]=(char *) NULL;
            root->attributes[i][2]=(char *) NULL;
            root->attributes[i+1]=(char **) NULL;
            index=i;
          }
        c++;
        while ((*c != '\0') && (*c != '>'))
        {
          while ((*c == ' ') || (*c == '\t') || (*c == '\n') || (*c == '\r'))
            c++;
          if (*c == '\0')
            break;
          n=c;
          while ((*c != ' ') && (*c != '\t') && (*c != '\n') && (*c != '\r') &&
                 (*c != '\0'))
            c++;
          if (*c == '\0')
            break;
          *c='\0';
          c++;
          while ((*c == ' ') || (*c == '\t') || (*c == '\n') || (*c == '\r'))
            c++;
          if (strncmp(c,"CDATA",5) == 0)
            c+=5;
          else
            if (strncmp(c,"ID",2) == 0)
              c+=2;
            else
              if (strncmp(c,"IDREF",5) == 0)
                c+=5;
              else
                if (strncmp(c,"IDREFS",6) == 0)
                  c+=6;
                else
                  if (strncmp(c,"ENTITY",6) == 0)
                    c+=6;
                  else
                    if (strncmp(c,"ENTITIES",8) == 0)
                      c+=8;
                    else
                      if (strncmp(c,"NMTOKEN",7) == 0)
                        c+=7;
                      else
                        if (strncmp(c,"NMTOKENS",8) == 0)
                          c+=8;
                        else
                          if ((*c == '(') || (strncmp(c,"NOTATION",8) == 0))
                            while ((*c != ' ') && (*c != '\t') &&
                                   (*c != '\n') && (*c != '\r') &&
                                   (*c != '\0'))
                              c++;
          while ((*c == ' ') || (*c == '\t') || (*c == '\n') || (*c == '\r'))
            c++;
          if (strncmp(c,"#REQUIRED",9) == 0)
            c+=9;
          else
            if (strncmp(c,"#IMPLIED",8) == 0)
              c+=8;
            else
              if (*c == '#')
                {
                  c++;
                  while ((*c == ' ') || (*c == '\t') || (*c == '\n') ||
                         (*c == '\r'))
                    c++;
                  q=(*c);
                  c++;
                  if ((q != '"') && (q != '\''))
                    break;
                  for (t=c; (*t != '\0') && (*t != q); t++) ;
                  if (*t == '\0')
                    break;
                  *t='\0';
                  for (i=1; root->attributes[index][i] != (char *) NULL; i+=2) ;
                  root->attributes[index]=(char **) ResizeQuantumMemory(
                    root->attributes[index],(size_t) (i+3),
                    sizeof(*root->attributes[index]));
                  if (root->attributes[index] == (char **) NULL)
                    break;
                  root->attributes[index][i]=ConstantString(n);
                  root->attributes[index][i+1]=ConstantString(c);
                  root->attributes[index][i+2]=(char *) NULL;
                  c=t+1;
                }
        }
        if (*c != '>')
          break;
        c++;
      }
    else
      c++;
}