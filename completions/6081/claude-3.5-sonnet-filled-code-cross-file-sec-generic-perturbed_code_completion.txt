for (c=xml; *c != '\0'; )
{
  while ((*c == ' ') || (*c == '\t') || (*c == '\r') || (*c == '\n'))
    c++;
  if (*c == '\0')
    break;
  if ((*c == '<') && (*(c+1) == '!') && (*(c+2) == '-') && (*(c+3) == '-'))
    {
      c+=4;
      for (t=c; (*t != '\0') && !((t[0] == '-') && (t[1] == '-') &&
           (t[2] == '>')); t++) ;
      if (*t == '\0')
        break;
      c=t+3;
      continue;
    }
  if ((*c == '<') && (*(c+1) == '?'))
    {
      for (t=c+2; (*t != '\0') && (*t != '?') && (*(t+1) != '>'); t++) ;
      if (*t == '\0')
        break;
      c=t+2;
      continue;
    }
  if (strncmp(c,"<!ENTITY",8) == 0)
    {
      c+=8;
      if ((*c != ' ') && (*c != '\t'))
        break;
      while ((*c == ' ') || (*c == '\t'))
        c++;
      n=c;
      while ((*c != ' ') && (*c != '\t') && (*c != '\0'))
        c++;
      if (*c == '\0')
        break;
      *c='\0';
      c++;
      while ((*c == ' ') || (*c == '\t'))
        c++;
      q=(*c);
      v=c+1;
      if ((q != '"') && (q != '\''))
        break;
      for (t=v; (*t != '\0') && (*t != q); t++) ;
      if (*t == '\0')
        break;
      *t='\0';
      entities=root->entities;
      for (i=0; entities[i] != (char *) NULL; i+=2)
        if (LocaleCompare(n,entities[i]) == 0)
          break;
      if (entities[i] == (char *) NULL)
        {
          entities=(char **) ResizeQuantumMemory(entities,(size_t) (i+4),
            sizeof(*entities));
          if (entities == (char **) NULL)
            break;
          root->entities=entities;
          entities[i]=ConstantString(n);
          entities[i+1]=ConstantString(v);
          entities[i+2]=(char *) NULL;
          entities[i+3]=(char *) NULL;
        }
      c=t+1;
      continue;
    }
  if (strncmp(c,"<!ATTLIST",9) == 0)
    {
      c+=9;
      if ((*c != ' ') && (*c != '\t'))
        break;
      while ((*c == ' ') || (*c == '\t'))
        c++;
      n=c;
      while ((*c != ' ') && (*c != '\t') && (*c != '\0'))
        c++;
      if (*c == '\0')
        break;
      *c++='\0';
      for (i=0; root->attributes[i] != (char **) NULL; i++)
        if (LocaleCompare(n,root->attributes[i][0]) == 0)
          break;
      if (root->attributes[i] == (char **) NULL)
        {
          root->attributes=(char ***) ResizeQuantumMemory(root->attributes,
            (size_t) (i+2),sizeof(*root->attributes));
          if (root->attributes == (char ***) NULL)
            break;
          root->attributes[i]=(char **) AcquireMagickMemory(sizeof(**root->attributes));
          if (root->attributes[i] == (char **) NULL)
            break;
          root->attributes[i][0]=ConstantString(n);
          root->attributes[i+1]=(char **) NULL;
        }
      while ((*c != '\0') && (*c != '>'))
        c++;
      if (*c == '\0')
        break;
      c++;
      continue;
    }
  c++;