c=xml;
    while (*c != '\0')
    {
      /* Skip leading whitespace */
      while (isspace((unsigned char) *c))
        c++;
      /* Break if at end of DOCTYPE section */
      if ((*c == ']') || (*c == '>'))
      {
        c++;
        break;
      }
      /* Check for comment: <!-- ... --> */
      if (strncmp(c,"<!--",4) == 0)
      {
        char *comment_end=strstr(c+4,"-->");
        if (comment_end == (char *) NULL)
          {
            ThrowMagickException(exception,GetMagickModule(),XMLWarning,
              "UnterminatedComment","`%.32s'",c);
            break;
          }
        c=comment_end+3; /* skip '-->' */
        continue;
      }
      /* Check for processing instruction: <? ... ?> */
      if (strncmp(c,"<?",2) == 0)
      {
        char *pi_end=strstr(c+2,"?>");
        if (pi_end == (char *) NULL)
          {
            ThrowMagickException(exception,GetMagickModule(),XMLWarning,
              "UnterminatedProcessingInstruction","`%.32s'",c);
            break;
          }
        c=pi_end+2; /* skip '?>' */
        continue;
      }
      /* Check for ENTITY declaration: <!ENTITY ...> */
      if (strncasecmp(c,"<!ENTITY",8) == 0)
      {
        c+=8;
        /* Skip whitespace before entity name */
        while (isspace((unsigned char) *c))
          c++;
        /* Track parameter/general entity: if next char is '%', skip it */
        MagickBooleanType param_entity=MagickFalse;
        if (*c == '%')
          {
            param_entity=MagickTrue;
            c++;
            while (isspace((unsigned char) *c))
              c++;
          }
        /* Read the entity name */
        t=c;
        while ((*c != '\0') && !isspace((unsigned char) *c) &&
               (*c != '"') && (*c != '\'') && (*c != '>'))
          c++;
        if (c == t)
          {
            ThrowMagickException(exception,GetMagickModule(),XMLWarning,
              "MissingEntityName","`%.32s'",t);
            break;
          }
        *c++='\0';
        n=AcquireString(t);
        /* Skip whitespace before quoted value */
        while (isspace((unsigned char) *c))
          c++;
        q=(*c);
        if ((q != '\'') && (q != '"'))
          {
            ThrowMagickException(exception,GetMagickModule(),XMLWarning,
              "MissingEntityValue","`%.32s'",c);
            n=DestroyString(n);
            break;
          }
        c++;
        t=c;
        /* Find closing quote for entity value */
        while ((*c != '\0') && (*c != q))
          c++;
        if (*c == '\0')
          {
            ThrowMagickException(exception,GetMagickModule(),XMLWarning,
              "UnterminatedEntityValue","`%.32s'",t);
            n=DestroyString(n);
            break;
          }
        *c++='\0';
        v=AcquireString(t);
        /* Store the new entity in our predefined_entitites array */
        for (index=0; predefined_entitites[index] != (char *) NULL; index+=2)
          ;
        predefined_entitites[index]=n;
        predefined_entitites[index+1]=v;
        predefined_entitites[index+2]=(char *) NULL;
        predefined_entitites[index+3]=(char *) NULL;
        continue;
      }
      /* Check for ATTLIST declaration: <!ATTLIST ...> */
      if (strncasecmp(c,"<!ATTLIST",9) == 0)
      {
        c+=9;
        /* Simplified example: skip entire ATTLIST block for now */
        while ((*c != '\0') && (*c != '>'))
          c++;
        if (*c == '>')
          c++;
        continue;
      }
      /* Move to the next character if no recognized declaration found */
      c++;
    }
    /* Update caller's pointer to reflect parsing progress */
    xml=c;