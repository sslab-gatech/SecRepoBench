if (xml[0] == '\0')
      break;
    if (LocaleNCompare(xml,"<!DOCTYPE",9) == 0)
      {
        xml+=9;
        while (isspace((int) ((unsigned char) *xml)) != 0)
          xml++;
        n=xml;
        t=n;
        while ((*t != '\0') && (*t != '['))
          t++;
        if (*t == '[')
          {
            //
            // Parse an internal subset.
            //
            *t='\0';
            xml=t+1;
            for (i=0; predefined_entitites[i] != (char *) NULL; i++)
              predefined_entitites[i]=DestroyString(predefined_entitites[i]);
            predefined_entitites=(char **) RelinquishMagickMemory(
              predefined_entitites);
            entities=ParseEntities(xml,predefined_entitites,'>');
            if (entities != (char **) NULL)
              {
                predefined_entitites=entities;
                while (entities[i] != (char *) NULL)
                  i++;
                predefined_entitites=(char **) ResizeQuantumMemory(entities,
                  (size_t) (i+1),sizeof(*predefined_entitites));
                if (predefined_entitites == (char **) NULL)
                  ThrowFatalException(ResourceLimitError,"MemoryAllocationFailed");
              }
            root->entities=predefined_entitites;
            while (isspace((int) ((unsigned char) *xml)) != 0)
              xml++;
            continue;
          }
        if (*xml != '\0')
          {
            while (isspace((int) ((unsigned char) *xml)) != 0)
              xml++;
            if (*xml != '>')
              continue;
          }
        break;
      }
    if (LocaleNCompare(xml,"<!--",4) == 0)
      {
        //
        // Parse a comment.
        //
        xml+=4;
        t=xml;
        while ((*t != '\0') && (LocaleNCompare(t,"-->",3) != 0))
          t++;
        if (*t == '\0')
          break;
        *t='\0';
        (void) ParseComment(root,xml);
        xml=t+3;
        continue;
      }
    if (LocaleNCompare(xml,"<?",2) == 0)
      {
        /*
          Parse a processing instruction.
        */
        xml+=2;
        t=xml;
        while ((*t != '\0') && (*t != '>'))
          t++;
        if (*t == '\0')
          break;
        *t='\0';
        (void) ParseProcessingInstructions(root,xml);
        xml=t+1;
        continue;
      }
    break;