// <MASK>
  while (xml != (char *) NULL)
  {
    c=strchr(xml,'<');
    if (c == (char *) NULL)
      break;
    if (c > xml)
      ParseCharacterContent(root,xml,(size_t)(c-xml),'\0');
    if (c[1] == '!')
      {
        if ((c[2] == 'D') && (c[3] == 'O') && (c[4] == 'C') && (c[5] == 'T') && (c[6] == 'Y') && (c[7] == 'P') && (c[8] == 'E'))
          {
            c=strchr(c,'>');
            if (c == (char *) NULL)
              {
                ThrowException(exception,CorruptImageError,"UnableToParseXMLDirective",xml);
                break;
              }
            c++;
            ParseInternalDoctype(root,c,(size_t)(c-xml),exception);
          }
        else if ((c[2] == 'E') && (c[3] == 'N') && (c[4] == 'T') && (c[5] == 'I') && (c[6] == 'T') && (c[7] == 'Y'))
          {
            c=strchr(c,'>');
            if (c == (char *) NULL)
              {
                ThrowException(exception,CorruptImageError,"UnableToParseXMLDirective",xml);
                break;
              }
            c++;
            ParseEntityDeclaration(root,c,(size_t)(c-xml),predefined_entitites,exception);
          }
        else if ((c[2] == 'A') && (c[3] == 'T') && (c[4] == 'T') && (c[5] == 'L') && (c[6] == 'I') && (c[7] == 'S') && (c[8] == 'T'))
          {
            c=strchr(c,'>');
            if (c == (char *) NULL)
              {
                ThrowException(exception,CorruptImageError,"UnableToParseXMLDirective",xml);
                break;
              }
            c++;
            ParseAttributeList(root,c,(size_t)(c-xml),exception);
          }
        else if ((c[2] == '-') && (c[3] == '-'))
          {
            c=strstr(c,"-->");
            if (c == (char *) NULL)
              {
                ThrowException(exception,CorruptImageError,"UnableToParseXMLDirective",xml);
                break;
              }
            c+=3;
            ParseComment(root,c,(size_t)(c-xml),exception);
          }
        else
          {
            c=strchr(c,'>');
            if (c == (char *) NULL)
              {
                ThrowException(exception,CorruptImageError,"UnableToParseXMLDirective",xml);
                break;
              }
            c++;
            ParseProcessingInstruction(root,c,(size_t)(c-xml),exception);
          }
      }
    else if (c[1] == '?')
      {
        c=strstr(c,"?>");
        if (c == (char *) NULL)
          {
            ThrowException(exception,CorruptImageError,"UnableToParseXMLDirective",xml);
            break;
          }
        c+=2;
        ParseProcessingInstruction(root,xml,(size_t)(c-xml),exception);
      }
    else if (c[1] == '/')
      {
        c=strchr(c,'>');
        if (c == (char *) NULL)
          {
            ThrowException(exception,CorruptImageError,"UnableToParseXMLDirective",xml);
            break;
          }
        c++;
        ParseCloseTag(root,xml+2,(size_t)(c-xml-2));
      }
    else
      {
        c=strchr(c,'>');
        if (c == (char *) NULL)
          {
            ThrowException(exception,CorruptImageError,"UnableToParseXMLDirective",xml);
            break;
          }
        c++;
        q=strchr(xml+1,' ');
        if ((q == (char *) NULL) || (q > c))
          ParseOpenTag(root,xml+1,(char **) NULL);
        else
          {
            *q='\0';
            ParseOpenTag(root,xml+1,ParseAttributes(q+1));
            *q=' ';
          }
      }
    xml=c;
  }