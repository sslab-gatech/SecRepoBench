#ifdef _WIN32
    const char delimiter = '\\';
#else
    const char delimiter = '/';
#endif

    if (input_string.empty()) {
        return;
    }

    // Remove leading whitespace
    size_t first_nonspace = input_string.find_first_not_of(" \n\r\t");
    if (first_nonspace != std::string::npos) {
        input_string.erase(0, first_nonspace);
    } else {
        // All whitespace
        input_string.clear();
        return;
    }

    std::string result;
    result.reserve(input_string.size());

    for (size_t i = 0; i < input_string.size(); ++i) {
        // Handle "://" or "\\\\" by copying them as-is
        if ((i + 2 < input_string.size()) &&
            ((input_string[i] == ':' && (input_string[i + 1] == '/' && input_string[i + 2] == '/')) ||
             (input_string[i] == '\\' && (input_string[i + 1] == '\\' && input_string[i + 2] == '\\')))) {
            result.push_back(input_string[i]);
            result.push_back(input_string[i + 1]);
            result.push_back(input_string[i + 2]);
            i += 2;
            continue;
        }

        // Replace slash or backslash with delimiter
        if (input_string[i] == '/' || input_string[i] == '\\') {
            // Avoid doubling the delimiter unless it's part of a special sequence
            if (!result.empty() && result.back() == delimiter) {
                continue;
            }
            result.push_back(delimiter);
            continue;
        }

        // Decode percent-encoded characters if valid (% followed by two hex digits)
        if (input_string[i] == '%' && (i + 2 < input_string.size())) {
            auto hex1 = input_string[i + 1];
            auto hex2 = input_string[i + 2];
            auto isHex = [](char c) {
                return (c >= '0' && c <= '9') ||
                       (c >= 'A' && c <= 'F') ||
                       (c >= 'a' && c <= 'f');
            };
            if (isHex(hex1) && isHex(hex2)) {
                unsigned int decodedChar = 0;
                std::stringstream ss;
                ss << std::hex << std::string{hex1, hex2};
                ss >> decodedChar;
                result.push_back(static_cast<char>(decodedChar));
                i += 2;
                continue;
            }
        }

        result.push_back(input_string[i]);
    }

    input_string = result;