if (input_string.empty()) {
    return;
}

// Remove leading spaces or newlines
size_t start = input_string.find_first_not_of(" \n\r\t");
if (start != std::string::npos) {
    input_string = input_string.substr(start);
}

std::string out;
out.reserve(input_string.length() + 1);
bool inUri = false;

for (size_t i = 0; i < input_string.length(); ++i) {
    if (input_string[i] == '/' || input_string[i] == '\\') {
        if (i > 0 && (input_string[i - 1] == '/' || input_string[i - 1] == '\\')) {
            continue;
        }
        if (i == 0 && input_string.length() > 2 && input_string[1] == '/' && input_string[2] == '/') {
            out += "//";
            i += 2;
            inUri = true;
            continue;
        }
        if (i == 0 && input_string.length() > 2 && input_string[1] == '\\' && input_string[2] == '\\') {
            out += "\\\\";
            i += 2;
            continue;
        }
        out += mSep;
    } else if (inUri && input_string[i] == '%' && i + 2 < input_string.length() && 
               IsHex(input_string[i + 1]) && IsHex(input_string[i + 2])) {
        char hex[3] = {input_string[i + 1], input_string[i + 2], 0};
        char c = static_cast<char>(strtol(hex, nullptr, 16));
        out += c;
        i += 2;
    } else {
        out += input_string[i];
    }
}

input_string = out;