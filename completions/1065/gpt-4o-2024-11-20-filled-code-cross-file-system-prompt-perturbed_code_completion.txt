#ifdef USE_C_LOCALE
	locale_t old_lc_ctype = uselocale(regex->c_lc_ctype);
	assert(old_lc_ctype != NULL);
#else
	const char *old_lc_ctype = setlocale(LC_CTYPE, regex->old_lc_ctype);
#endif

	int result = regexec(&regex->rx, str, nmatch, pmatch, eflags);

#ifdef USE_C_LOCALE
	uselocale(old_lc_ctype);
#else
	setlocale(LC_CTYPE, old_lc_ctype);
#endif

	return result;