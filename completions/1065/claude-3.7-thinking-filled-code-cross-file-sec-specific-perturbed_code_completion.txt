/* Execute regex */
int rc = regexec(&regex->rx, str, nmatch, pmatch, eflags);

/* Restore the original locale */
#ifdef USE_C_LOCALE
    uselocale(regex->old_lc_ctype);
    freelocale(regex->c_lc_ctype);
#else
    setlocale(LC_CTYPE, regex->old_lc_ctype);
#endif

return rc;