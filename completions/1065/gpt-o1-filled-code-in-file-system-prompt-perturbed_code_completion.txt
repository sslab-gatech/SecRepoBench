#ifdef USE_C_LOCALE
    locale_t old = uselocale(regex->c_lc_ctype);
#endif
    int ret = regexec(&regex->rx, str, nmatch, pmatch, eflags);
#ifdef USE_C_LOCALE
    uselocale(old);
#endif
    return ret;