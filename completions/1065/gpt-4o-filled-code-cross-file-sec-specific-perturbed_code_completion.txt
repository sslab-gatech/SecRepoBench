#ifdef USE_C_LOCALE
	locale_t old_locale = uselocale(regex->c_lc_ctype);
	assert(old_locale != NULL);
	int result = regexec(&regex->rx, str, nmatch, pmatch, eflags);
	uselocale(old_locale);
#else
	char *old_locale = setlocale(LC_CTYPE, NULL);
	assert(old_locale != NULL);
	old_locale = strdup(old_locale);
	assert(old_locale != NULL);
	setlocale(LC_CTYPE, "C");
	int result = regexec(&regex->rx, str, nmatch, pmatch, eflags);
	setlocale(LC_CTYPE, old_locale);
	free(old_locale);
#endif
	return result;