int rc;

#ifdef USE_C_LOCALE
	rx->c_lc_ctype = newlocale(LC_CTYPE_MASK, "C", 0);
	assert(rx->c_lc_ctype != NULL);
	rx->old_lc_ctype = uselocale(rx->c_lc_ctype);
	assert(rx->old_lc_ctype != NULL);
#else
	rx->old_lc_ctype = setlocale(LC_CTYPE, "C");
#endif
        rc = regexec(&regex->rx, str, nmatch, pmatch, eflags);

#ifdef USE_C_LOCALE
	uselocale(rx->old_lc_ctype);
	freelocale(rx->c_lc_ctype);
#else
	setlocale(LC_CTYPE, rx->old_lc_ctype);
#endif
	return rc;