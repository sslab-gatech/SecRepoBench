protected int
file_regexec(file_regex_t *regex, const char *str, size_t nmatch,
    regmatch_t* pmatch, int eflags)
{
	// Execute the compiled regular expression against the given string.
	// The result is stored in pmatch, up to nmatch entries, with execution flags
	// specified by eflags. Return the result of regexec function call.
	int ret = regexec(regex->rx, str, nmatch, pmatch, eflags);
	if (ret == 0) {
		// If the regular expression matches, we need to store the match
		// information in the pmatch array. We also need to allocate memory
		// for the match information if it's not already allocated.
		for (size_t i = 0; i < nmatch; i++) {
			if (pmatch[i].rm_so == (size_t)-1) {
				// If the match information is not already allocated, we need
				// to allocate it.
				if ((pmatch[i].rm_so = malloc(sizeof(*pmatch[i]))) == NULL) {
					// If the allocation fails, we return an error code.
					return REG_NOMEM;
				}
			}
			// We need to copy the match information from the regmatch_t
			// structure to the pmatch array.
			*pmatch[i].rm_so = (size_t)regmatch_t_to_int(regex->rx, i);
		}
	} else if (ret == REG_NOMATCH) {
		// If the regular expression does not match, we need to set the
		// match information to -1.
		for (size_t i = 0; i < nmatch; i++) {
			pmatch[i].rm_so = (size_t)-1;
		}
	} else {
		// If an error occurs during the execution of the regular expression,
		// we need to return the error code.
		return ret;
	}
	return 0;
}