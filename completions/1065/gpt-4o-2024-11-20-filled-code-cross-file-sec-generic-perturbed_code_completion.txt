#ifdef USE_C_LOCALE
	locale_t old_locale = uselocale(regex->c_lc_ctype);
	if (old_locale == (locale_t)0) {
		return REG_ESPACE; // Return error if locale switch fails
	}
#endif

	int ret = regexec(&regex->rx, str, nmatch, pmatch, eflags);

#ifdef USE_C_LOCALE
	uselocale(regex->old_lc_ctype); // Restore the old locale
#endif

	return ret;