int rc;

#ifdef USE_C_LOCALE
	locale_t old = uselocale(regex->c_lc_ctype);
	rc = regexec(&regex->rx, str, nmatch, pmatch, eflags);
	uselocale(old);
#else
	char *old = setlocale(LC_CTYPE, "C");
	rc = regexec(&regex->rx, str, nmatch, pmatch, eflags);
	setlocale(LC_CTYPE, old);
#endif

	return rc;