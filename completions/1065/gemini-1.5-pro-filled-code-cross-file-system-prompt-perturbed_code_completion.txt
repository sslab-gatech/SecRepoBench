int rc;

#ifdef USE_C_LOCALE
	regex->c_lc_ctype = newlocale(LC_CTYPE_MASK, "C", 0);
	assert(regex->c_lc_ctype != NULL);
	regex->old_lc_ctype = uselocale(regex->c_lc_ctype);
	assert(regex->old_lc_ctype != NULL);
#else
	regex->old_lc_ctype = setlocale(LC_CTYPE, "C");
#endif
	rc = regexec(&regex->rx, str, nmatch, pmatch, eflags);

#ifdef USE_C_LOCALE
	uselocale(regex->old_lc_ctype);
	freelocale(regex->c_lc_ctype);
#else
	setlocale(LC_CTYPE, regex->old_lc_ctype);
#endif
	return rc;