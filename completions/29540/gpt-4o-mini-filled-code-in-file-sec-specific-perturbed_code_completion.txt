if (nfields < 1) {
                free(fields);
                return; // Early return if no fields
            }

            matvar->data_size = sizeof(matvar_t*);
            err = Mat_MulDims(matvar, &matvar->nbytes);
            if (err) {
                free(fields);
                Mat_Critical("Integer multiplication overflow");
                return;
            }

            matvar->data = malloc(matvar->nbytes);
            if (NULL == matvar->data) {
                free(fields);
                Mat_Critical("Error allocating memory for matvar->data");
                return;
            }

            for (hsize_t i = 0; i < nfields; i++) {
                fields[i] = (matvar_t*)malloc(sizeof(matvar_t));
                if (NULL == fields[i]) {
                    for (hsize_t j = 0; j < i; j++) {
                        free(fields[j]);
                    }
                    free(fields);
                    free(matvar->data);
                    Mat_Critical("Error allocating memory for fields");
                    return;
                }
            }
            matvar->data = fields; // Assign the allocated fields to matvar->data