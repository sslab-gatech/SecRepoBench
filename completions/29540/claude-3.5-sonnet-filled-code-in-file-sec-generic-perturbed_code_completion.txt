if ( nelems < 1 || matvar->internal->num_fields < 1 ) {
    return MATIO_E_EMPTY_VARIABLE;
}

err = Mul(&matvar->nbytes, nelems, matvar->internal->num_fields);
if ( err ) {
    Mat_Critical("Integer multiplication overflow");
    return err;
}
err = Mul(&matvar->nbytes, matvar->nbytes, sizeof(matvar_t *));
if ( err ) {
    Mat_Critical("Integer multiplication overflow");
    return err;
}

matvar->data = malloc(matvar->nbytes);
if ( NULL == matvar->data ) {
    Mat_Critical("Couldn't allocate memory for the data");
    return MATIO_E_OUT_OF_MEMORY;
}

fields = (matvar_t **)matvar->data;