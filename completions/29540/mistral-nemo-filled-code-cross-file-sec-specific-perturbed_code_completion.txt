if ( nfields > 0 ) {
        hsize_t nbytes = 0;
        size_t  k;
        for ( k = 0; k < nfields; k++ ) {
            nbytes += sizeof(matvar_t*);
        }
        fields = (matvar_t**)malloc(nbytes);
        if ( NULL != fields ) {
            for ( k = 0; k < nfields; k++ ) {
                fields[k] = Mat_VarCalloc();
                fields[k]->name = strdup(data_variable->internal->fieldnames[k]);
            }
            data_variable->internal->fields = fields;
            data_variable->internal->num_fields = nfields;
        } else {
            Mat_Critical("Error allocating memory for fields");
            return;
        }
    }