if (nelems < 1 || nfields < 1) {
    return;
}

size_t nbytes = 0;
if (fields_are_variables) {
    nbytes = nfields * sizeof(matvar_t *);
} else {
    nbytes = nelems * nfields * sizeof(matvar_t *);
}

fields = (matvar_t **)calloc(nbytes, 1);
if (NULL == fields) {
    Mat_Critical("Error allocating memory for fields");
    return;
}

data_variable->data = fields;