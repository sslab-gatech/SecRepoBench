if ( nelems < 1 || nfields < 1 ) {
    Mat_VarFree(matvar);
    return -1;
}

err = Mul(&matvar->nbytes, nelems, nfields);
if ( err ) {
    Mat_Critical("Integer multiplication overflow");
    Mat_VarFree(matvar);
    return -1;
}
err = Mul(&matvar->nbytes, matvar->nbytes, sizeof(*fields));
if ( err ) {
    Mat_Critical("Integer multiplication overflow");
    Mat_VarFree(matvar);
    return -1;
}

fields = (matvar_t**)malloc(matvar->nbytes);
if ( NULL == fields ) {
    Mat_Critical("Couldn't allocate memory for fields");
    Mat_VarFree(matvar);
    return -1;
}
matvar->data = fields;