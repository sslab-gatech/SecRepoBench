if (nelems < 1 || NULL == matvar->data) {
    err = Mat_VarWriteEmpty(id, matvar, name, ClassNames[matvar->class_type]);
} else {
    size_t nbytes = 1;
    int k;
    for (k = 0; k < matvar->rank; k++) {
        err = Mul(&nbytes, nbytes, matvar->dims[k]);
        if (err) {
            Mat_Critical("Integer multiplication overflow");
            return err;
        }
    }
    matvar->nbytes = nbytes * matvar->data_size;
    matvar->data = malloc(matvar->nbytes);
    if (NULL == matvar->data) {
        Mat_Critical("Error allocating memory for matvar->data");
        return MATIO_E_OUT_OF_MEMORY;
    }
}