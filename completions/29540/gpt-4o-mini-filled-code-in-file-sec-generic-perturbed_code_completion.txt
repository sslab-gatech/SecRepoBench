if ( nfields < 1 ) {
                H5Gclose(struct_id);
                return MATIO_E_OUTPUT_BAD_DATA;
            }

            matvar->data_size = sizeof(matvar_t*) * nelems;
            matvar->data = malloc(matvar->data_size);
            if ( NULL == matvar->data ) {
                H5Gclose(struct_id);
                return MATIO_E_OUT_OF_MEMORY;
            }

            for ( hsize_t i = 0; i < nelems; i++ ) {
                fields[i] = Mat_VarCalloc();
                if ( NULL == fields[i] ) {
                    err = MATIO_E_OUT_OF_MEMORY;
                    break;
                }
            }

            if ( err ) {
                for ( hsize_t i = 0; i < nelems; i++ ) {
                    if ( fields[i] != NULL ) {
                        Mat_VarFree(fields[i]);
                    }
                }
                free(matvar->data);
                H5Gclose(struct_id);
                return err;
            }