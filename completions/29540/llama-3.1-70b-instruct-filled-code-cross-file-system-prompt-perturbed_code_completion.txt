if ( nelems < 1 || nfields < 1 ) {
    return;
}

size_t nbytes = 0;
if ( data_variable->class_type == MAT_C_STRUCT ) {
    if ( fields_are_variables ) {
        nbytes = nfields * sizeof(matvar_t *);
    } else {
        nbytes = nelems * nfields * sizeof(matvar_t *);
    }
} else if ( data_variable->class_type == MAT_C_CELL ) {
    nbytes = nelems * sizeof(matvar_t *);
}

data_variable->data = malloc(nbytes);
if ( NULL == data_variable->data ) {
    Mat_Critical("Error allocating memory for matvar->data");
    return;
}

fields = (matvar_t **)data_variable->data;