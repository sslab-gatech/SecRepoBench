if ( nelems < 1 || nfields < 1 ) {
    return;
}

data_variable->internal->num_fields = (unsigned)nfields;

/* Check for potential overflow in nbytes calculation */
if ( nfields > 0 && nelems > SIZE_MAX / nfields ) {
    Mat_Critical("Integer overflow in nbytes calculation");
    return;
}
size_t total_elements = nelems * nfields;
if ( total_elements > SIZE_MAX / sizeof(*fields) ) {
    Mat_Critical("Integer overflow in nbytes calculation");
    return;
}
data_variable->nbytes = total_elements * sizeof(*fields);

fields = (matvar_t**)calloc(total_elements, sizeof(*fields));
if (fields == NULL) {
    Mat_Critical("Error allocating memory for matvar->data");
    return;
}
data_variable->data = fields;