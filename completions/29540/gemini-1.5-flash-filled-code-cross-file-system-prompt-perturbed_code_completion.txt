size_t nbytes = 0;
    fields = (matvar_t**)malloc(nfields * sizeof(*fields));
    if ( NULL == fields ) {
        Mat_Critical("Error allocating memory for fields");
        return;
    }
    for ( size_t k = 0; k < nfields; k++ ) {
        H5O_INFO_T object_info;
        object_info.type = H5O_TYPE_UNKNOWN;
        H5OGET_INFO_BY_NAME(dset_id, data_variable->internal->fieldnames[k], &object_info, H5P_DEFAULT);
        if ( object_info.type == H5O_TYPE_DATASET || object_info.type == H5O_TYPE_GROUP ) {
            fields[k] = Mat_VarCalloc();
            if ( NULL == fields[k] ) {
                Mat_Critical("Error allocating memory for fields[%d]",(int)k);
                for ( size_t j = 0; j < k; j++ ) {
                    Mat_VarFree(fields[j]);
                }
                free(fields);
                return;
            }
            fields[k]->name = strdup(data_variable->internal->fieldnames[k]);
            if ( NULL == fields[k]->name ) {
                Mat_Critical("Error allocating memory for fields[%d]->name",(int)k);
                for ( size_t j = 0; j <= k; j++ ) {
                    Mat_VarFree(fields[j]);
                }
                free(fields);
                return;
            }
            nbytes += fields[k]->nbytes;
        }
    }
    data_variable->data = fields;
    data_variable->nbytes = nbytes;