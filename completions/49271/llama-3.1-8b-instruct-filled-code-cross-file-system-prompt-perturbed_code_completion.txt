if (((intptr_t)dst | (intptr_t)src | stride_dst | stride_src) & 15) {
    uint8_t *dst16 = (uint8_t *)((intptr_t)dst & ~15);
    uint8_t *src16 = (uint8_t *)((intptr_t)src & ~15);
    ptrdiff_t stride_dst16 = (ptrdiff_t)(stride_dst & ~15);
    ptrdiff_t stride_src16 = (ptrdiff_t)(stride_src & ~15);
    int i, j;

    for (i = 0; i < height; i++) {
        for (j = 0; j < w; j += 16) {
            uint8_t *dst16_ptr = dst16 + j;
            uint8_t *src16_ptr = src16 + j;
            uint8_t *dst_end = dst16_ptr + 16;
            uint8_t *src_end = src16_ptr + 16;

            while (dst16_ptr < dst_end) {
                uint8_t *dst_ptr = dst16_ptr;
                uint8_t *src_ptr = src16_ptr;
                uint8_t *dst_end_ptr = dst_end;
                uint8_t *src_end_ptr = src_end;

                if (dst_ptr >= dst_end_ptr) {
                    dst_ptr = dst_end_ptr;
                    src_ptr = src_end_ptr;
                }

                if (src_ptr >= src_end_ptr) {
                    src_ptr = src_end_ptr;
                    dst_ptr = dst_end_ptr;
                }

                uint8_t *dst_ptr_end = dst_ptr + 16;
                uint8_t *src_ptr_end = src_ptr + 16;

                if (dst_ptr_end > dst_end_ptr) {
                    dst_ptr_end = dst_end_ptr;
                }

                if (src_ptr_end > src_end_ptr) {
                    src_ptr_end = src_end_ptr;
                }

                AV_COPY128(dst_ptr, src_ptr);
                dst_ptr += 16;
                src_ptr += 16;
            }

            dst16_ptr += stride_dst16;
            src16_ptr += stride_src16;
        }
        dst16 += stride_dst16;
        src16 += stride_src16;
    }
}