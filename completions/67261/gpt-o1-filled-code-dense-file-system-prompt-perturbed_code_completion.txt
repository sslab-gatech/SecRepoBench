char *dst = NULL;
	char *res = NULL;
	GF_Err e;
	u32 res_size = buffer_length;

	// Convert input data based on BOM
	e = gf_utf_get_string_from_bom(data, buffer_length, &dst, &res, &res_size);
	if (e) return NULL;
	data = (const u8*)res;

	// Strip leading whitespace
	while (res_size && data[0] && strchr("\n\r\t ", (char)data[0])) {
		data++;
		res_size--;
	}

	// Define macro to unify cleanup and return
	#define PROBE_OK(_score, _mime) \
		do { \
			*score = _score; \
			if (dst) gf_free(dst); \
			return _mime; \
		} while(0)