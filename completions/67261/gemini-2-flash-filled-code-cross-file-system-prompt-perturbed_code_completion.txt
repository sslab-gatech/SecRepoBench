u32 res_size = MIN(buffer_length, 2048);
	u8 *dst = NULL;

	if (data[0] == 0xEF && data[1] == 0xBB && data[2] == 0xBF) {
		dst = gf_strdup((char*)data);
	} else if (data[0] == 0xFE && data[1] == 0xFF) {
		dst = gf_utf16be_to_utf8((u16*)data, res_size/2, NULL);
	} else if (data[0] == 0xFF && data[1] == 0xFE) {
		dst = gf_utf16le_to_utf8((u16*)data, res_size/2, NULL);
	} else {
		dst = gf_strdup((char*)data);
	}

	if (!dst) return NULL;

	data = (u8*)dst;
	/*strip leading spaces*/
	while (*data == ' ' || *data == '\r' || *data == '\n' || *data == '\t') data++;

#define PROBE_OK(score_val, mime) \
{ \
	if (score) score->value = score_val; \
	if (dst) gf_free(dst); \
	return mime; \
}