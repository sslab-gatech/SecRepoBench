const char *mime_type = NULL;
char *dst = NULL;
char *res = NULL;
u32 res_size = buffer_length;
GF_Err e;

e = gf_utf_get_string_from_bom(data, buffer_length, &dst, &res, &res_size);
if (e) return NULL;
data = res;

//strip all spaces and \r\n
while (res_size && data[0] && strchr("\n\r\t ", (char) data[0])) {
    data ++;
    res_size--;
}

#define PROBE_OK(score, mime) {mime_type = mime; *score = score; goto exit;}

// Rest of the function remains the same