s32 uni_type;
u32 res_size;
char *dst = NULL;
const char *res = NULL;
unsigned char BOM[5];

#define PROBE_OK(_score, _mime) { \
    *score = _score; \
    res = _mime; \
    if (dst) gf_free(dst); \
    return res; \
}

uni_type = gf_text_get_utf_type(NULL, (FILE *)data);
if (uni_type > 1) {
    const u16 *sptr;
    char szUTF[1024];
    u32 read = (u32) gf_fread(szUTF, 1023, (FILE *)data);
    if ((s32) read < 0) return NULL;
    szUTF[read] = 0;
    sptr = (u16 *)szUTF;
    gf_utf8_wcstombs((char *)data, read, &sptr);
} else {
    res_size = (u32) strlen((const char *)data);
}

dst = (char *)data;
while (dst[0] && strchr("\n\r\t ", (char)dst[0])) dst++;