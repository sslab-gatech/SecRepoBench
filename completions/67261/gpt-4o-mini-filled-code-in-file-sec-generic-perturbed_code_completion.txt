char *dst = NULL;
u32 res_size = buffer_length;
if (buffer_length < 4) return NULL;

if (data[0] == 0xFF && data[1] == 0xFE) {
    // UTF-16 LE BOM
    dst = gf_utf16_to_utf8(data, buffer_length);
    if (!dst) return NULL;
    res_size = strlen(dst);
} else if (data[0] == 0xFE && data[1] == 0xFF) {
    // UTF-16 BE BOM
    dst = gf_utf16be_to_utf8(data, buffer_length);
    if (!dst) return NULL;
    res_size = strlen(dst);
} else if (data[0] == 0xEF && data[1] == 0xBB && data[2] == 0xBF) {
    // UTF-8 BOM
    dst = gf_strdup((const char *)data + 3);
    res_size -= 3;
} else {
    dst = gf_strdup((const char *)data);
}

if (gf_strmemstr(dst, res_size, "WEBVTT")) {
    gf_free(dst);
    return "subtitle/vtt";
}
if (gf_strmemstr(dst, res_size, " --> ")) {
    gf_free(dst);
    return "subtitle/srt";
}
if (gf_strmemstr(dst, res_size, "[Script Info]")) {
    gf_free(dst);
    return "subtitle/ssa";
}
if (gf_strmemstr(dst, res_size, "<x-quicktime-tx3g") || gf_strmemstr(dst, res_size, "<text3GTrack")) {
    gf_free(dst);
    return "quicktime/text";
}
if (gf_strmemstr(dst, res_size, "<tt ") || gf_strmemstr(dst, res_size, ":tt ")) {
    gf_free(dst);
    return "subtitle/ttml";
}
gf_free(dst);
return NULL;