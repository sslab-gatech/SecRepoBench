u32 res_size = buffer_length;
	u8 *dst = NULL;
	char *mime = NULL;
	if (score) score->score = 0;

#define PROBE_OK(s, m) { \
		if (score) score->score = s; \
		if (dst) gf_free(dst); \
		return m; \
	}

	// Convert the input data to UTF-8 for consistent processing.
	dst = gf_utf8_convert((char *)data, &res_size, GF_ENDIAN_BIG);
	if (!dst) return NULL;
	data = (u8 *)dst;

	// Skip leading whitespace characters.
	while (res_size && (data[0] == ' ' || data[0] == '\t' || data[0] == '\n' || data[0] == '\r')) {
		data++;
		res_size--;
	}