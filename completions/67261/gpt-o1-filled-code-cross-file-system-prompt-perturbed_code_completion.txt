#define PROBE_OK(_score, _mime) \
	do { \
		*score = _score; \
		if (dst) gf_free(dst); \
		return _mime; \
	} while(0)

u8 *dst = NULL;
u32 res_size = buffer_length;

/* Convert input data to UTF string using BOM if present */
dst = gf_charset_bom_process((const char *)data, &res_size);
if (dst) {
	data = dst;
}

/* Strip leading whitespace (spaces, tabs, newlines, etc.) */
{
	u32 off = 0;
	while (off < res_size && (data[off] == ' ' || data[off] == '\t' || data[off] == '\n' || data[off] == '\r')) {
		off++;
	}
	if (off) {
		res_size -= off;
		memmove((void *)data, data + off, res_size);
		((u8 *)data)[res_size] = 0;
	}
}