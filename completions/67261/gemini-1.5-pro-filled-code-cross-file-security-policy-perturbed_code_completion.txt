#define PROBE_OK(score_val, mime_type) {*score = score_val; return mime_type;}

	char *dst = NULL;
	u32 res_size = buffer_length;
	if (buffer_length>2048) res_size = 2048;

	dst = gf_malloc(sizeof(char) * (res_size+1));
	memcpy(dst, data, res_size);
	dst[res_size]=0;

	while (res_size) {
		char c = dst[res_size-1];
		if ((c!=' ') && (c!='\t') && (c!='\n') && (c!='\r')) break;
		dst[res_size-1] = 0;
		res_size--;
	}
	data = dst;