u32 res_size = buffer_length;
	char *dst = NULL;
	const char *data_str = (const char *)data;

	// Try to convert to UTF-8 if BOM is present
	dst = gf_utf8_from_bom(data, buffer_length, &res_size);
	if (dst) {
		data_str = dst;
	}

	// Strip leading whitespace
	while (res_size && (*data_str==' ' || *data_str=='\n' || *data_str=='\r' || *data_str=='\t')) {
		data_str++;
		res_size--;
	}

#define PROBE_OK(_score, _mime) \
	{ \
		if (score) *score = _score; \
		if (dst) gf_free(dst); \
		return _mime; \
	}