u8 *dst = NULL;
    u32 res_size = buffer_length;

    /* if we have no data, bail out */
    if (!data || !buffer_length)
        return NULL;

    /* define a helper macro to assign a score, free temp buffer if any, and return the detected MIME */
#define PROBE_OK(_score, _mime) \
    do {                        \
        *score = _score;        \
        if (dst) gf_free(dst);  \
        return _mime;           \
    } while (0)

    /* skip leading whitespace */
    while (res_size && (data[0] == ' ' || data[0] == '\t' || data[0] == '\r' || data[0] == '\n')) {
        data++;
        res_size--;
    }

    /* if needed, BOM or UTF checks could be done here, possibly converting data to UTF-8
       and storing in dst, adjusting res_size.

       for now, we simply pass data along, but the function must keep track of dst if allocated */