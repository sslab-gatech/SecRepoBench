// Initialize variables for processing the data buffer and storing results.
u32 res_size = buffer_length;
char *dst = NULL;
GF_FilterProbeScore score = GF_FPROBE_NOT_SUPPORTED;

// Convert the input data into a UTF string using its byte order mark (BOM).
if (buffer_length >= 3 && data[0] == (char) 0xef && data[1] == (char) 0xbb && data[2] == (char) 0xbf) {
    dst = gf_strdup((const char *) data + 3);
} else if (buffer_length >= 2 && data[0] == (char) 0xfe && data[1] == (char) 0xff) {
    dst = gf_strdup((const char *) data + 2);
} else if (buffer_length >= 2 && data[0] == (char) 0xff && data[1] == (char) 0xfe) {
    dst = gf_strdup((const char *) data + 2);
} else {
    dst = gf_strdup((const char *) data);
}

// Assign pointers to the processed data and allocate memory as needed.
if (!dst) {
    return NULL;
}

// Strip leading whitespace characters, including spaces, newlines, and tabs, from the processed data.
while (*dst && (*dst =='' || *dst == '\n' || *dst == '\t')) {
    dst++;
}

// Define a macro to facilitate returning a MIME type and freeing allocated memory when a format is identified.
#define PROBE_OK(score, mime) do { \
    if (dst) gf_free(dst); \
    *score = score; \
    return mime; \
} while (0)