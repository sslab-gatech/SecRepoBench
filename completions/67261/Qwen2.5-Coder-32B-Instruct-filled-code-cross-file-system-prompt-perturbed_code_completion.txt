const char *dst = NULL;
	u32 res_size = buffer_length;
	*score = GF_FPROBE_NOT_SUPPORTED;

	// Convert the input data into a UTF string using its byte order mark (BOM).
	if (buffer_length >= 3 && data[0] == 0xEF && data[1] == 0xBB && data[2] == 0xBF) {
		dst = (const char *)(data + 3);
		res_size -= 3;
	} else if (buffer_length >= 2 && data[0] == 0xFE && data[1] == 0xFF) {
		dst = (const char *)(data + 2);
		res_size -= 2;
	} else if (buffer_length >= 2 && data[0] == 0xFF && data[1] == 0xFE) {
		dst = (const char *)(data + 2);
		res_size -= 2;
	} else {
		dst = (const char *)data;
	}

	// Strip leading whitespace characters, including spaces, newlines, and tabs, from the processed data.
	while (res_size && (*dst == ' ' || *dst == '\n' || *dst == '\t')) {
		dst++;
		res_size--;
	}

	#define PROBE_OK(s, mime) \
		do { \
			*score = s; \
			if (dst) gf_free((void*)dst); \
			return mime; \
		} while (0)