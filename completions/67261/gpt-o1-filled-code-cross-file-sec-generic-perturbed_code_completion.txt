{
	u32 res_size = 0;
	char *dst = NULL;

	#define PROBE_OK(_score, _mime_type) \
		do { \
			if (dst) gf_free(dst); \
			*score = _score; \
			return _mime_type; \
		} while (0)

	/* Convert data using byte-order mark (BOM) if present */
	dst = gf_text_new_from_bom((const char *)data, buffer_length, &res_size);
	if (dst) {
		data = (const u8 *)dst;
	} else {
		res_size = buffer_length;
	}

	/* Strip leading whitespace */
	while (res_size && (data[0] == ' ' || data[0] == '\t' || data[0] == '\n' || data[0] == '\r')) {
		data++;
		res_size--;
	}
}