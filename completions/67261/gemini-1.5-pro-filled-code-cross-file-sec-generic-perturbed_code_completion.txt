#define PROBE_OK(score_val, mime_type) {*score = score_val; if(dst) gf_free(dst); return mime_type;}

	u32 res_size = buffer_length;
	char *dst = NULL;
	if (buffer_length>2048) res_size = 2048;

	if (data[0]==(char)0xEF && data[1]==(char)0xBB && data[2]==(char)0xBF) {
		data += 3;
		res_size -= 3;
	}
	//strip leading spaces/newlines/tabs
	while (res_size) {
		if ((*data==' ') || (*data=='\t') || (*data=='\n') || (*data=='\r') ) {
			data++;
			res_size--;
		} else {
			break;
		}
	}
	if (!res_size) return NULL;