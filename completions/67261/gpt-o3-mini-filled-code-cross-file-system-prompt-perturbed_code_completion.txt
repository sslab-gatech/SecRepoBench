u32 res_size = buffer_length;
    char *src = gf_malloc(buffer_length + 1);
    if (!src)
        return NULL;
    memcpy(src, data, buffer_length);
    src[buffer_length] = '\0';

    /* Convert input data to a UTF string by detecting and skipping a UTF-8 BOM */
    char *txt = src;
    if (res_size >= 3 && (unsigned char)txt[0] == 0xEF &&
        (unsigned char)txt[1] == 0xBB && (unsigned char)txt[2] == 0xBF) {
        txt += 3;
        res_size -= 3;
    }

    /* Strip leading whitespace (spaces, newlines, carriage returns, tabs) */
    while (res_size && (*txt == ' ' || *txt == '\n' || *txt == '\r' || *txt == '\t')) {
        txt++;
        res_size--;
    }

    /* Update the data pointer to point to the processed text */
    data = (u8 *)txt;

    /* Define the macro to return a MIME type and free the allocated memory */
    #define PROBE_OK(sc, mime) do { gf_free(src); *score = sc; return mime; } while(0)