char *tmp = NULL;
		  char *dNSNamePtr = (char*)&packet->payload[i + 2];

		  dNSName[0] = '\0';
		  strncpy(dNSName, dNSNamePtr, len);
		  dNSName[len] = '\0';

		  if(general_name_type == 0x87) { /* ipAddress */
		    char ip_address[INET6_ADDRSTRLEN];
		    struct in_addr ipv4_addr;
		    struct in6_addr ipv6_addr;

		    if (len == 4) {
		      memcpy(&ipv4_addr, dNSNamePtr, len);
		      inet_ntop(AF_INET, &ipv4_addr, ip_address, sizeof(ip_address));
		      strncpy(dNSName, ip_address, sizeof(dNSName) - 1);
		      dNSName[sizeof(dNSName) - 1] = '\0';
		    } else if (len == 16) {
		      memcpy(&ipv6_addr, dNSNamePtr, len);
		      inet_ntop(AF_INET6, &ipv6_addr, ip_address, sizeof(ip_address));
		      strncpy(dNSName, ip_address, sizeof(dNSName) - 1);
		      dNSName[sizeof(dNSName) - 1] = '\0';
		    } else {
		      dNSName[0] = '\0';
		    }
		  }

		  /* Cleanup the extracted DNS name */
		  ndpi_str_trim(dNSName);
		  if(ndpi_is_printable_string(dNSName, strlen(dNSName)) == 0) {
		    ndpi_set_risk(ndpi_struct, connection, NDPI_INVALID_CHARACTERS);
		  }

		  if((connection->host_server_name[0] != '\0') && (strcasestr(dNSName, connection->host_server_name) != NULL)) {
		    matched_name = 1;
#ifdef DEBUG_TLS
		    printf("******* [TLS] Matched subjectAltName %s with host_server_name %s\n",
			   dNSName, connection->host_server_name);
#endif
		  }

		  if(connection->server_names == NULL)
		    ndpi_init_list(&connection->server_names);

		  if(dNSName[0] != '\0') {
		    if(connection->server_names != NULL) {
		      if(connection->server_names->len > 0) {
			/* Append the current DNS name to the existing list */
			ndpi_append_string_to_list(connection->server_names, ",");
			ndpi_append_string_to_list(connection->server_names, dNSName);
		      } else {
			/* Create a new entry for the current DNS name */
			ndpi_append_string_to_list(connection->server_names, dNSName);
		      }
		    }

		    /* Detect subprotocol based on the DNS name */
		    if(connection->detected_protocol_stack[0] == NDPI_PROTOCOL_UNKNOWN) {
		      u_int32_t protocol_id;

		      if(ndpi_match_string_value(ndpi_struct->domain_names_automa.ac_automa,
						   dNSName, strlen(dNSName), &protocol_id) == 0) {
			ndpi_protocol ret = { NDPI_PROTOCOL_TLS, (u_int16_t)protocol_id, NDPI_PROTOCOL_CATEGORY_UNSPECIFIED };

			connection->detected_protocol_stack[0] = (u_int16_t)protocol_id;
			connection->detected_protocol_stack[1] = NDPI_PROTOCOL_TLS;

			connection->category = ndpi_get_proto_category(ndpi_struct, ret);
			ndpi_check_subprotocol_risk(ndpi_struct, connection, (u_int16_t)protocol_id);
		      }
		    }
		  }