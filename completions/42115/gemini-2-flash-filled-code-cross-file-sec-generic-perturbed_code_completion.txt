strncpy(dNSName, (const char*)&packet->payload[i + 2], len);
						  dNSName[len] = '\0';

						  if(general_name_type == 0x87) {
							/* Convert IP Address to string */
							if(len == 4) {
							  snprintf(dNSName, sizeof(dNSName), "%u.%u.%u.%u",
								   packet->payload[i + 2 + 0],
								   packet->payload[i + 2 + 1],
								   packet->payload[i + 2 + 2],
								   packet->payload[i + 2 + 3]);
							} else if (len == 16) {
							  snprintf(dNSName, sizeof(dNSName), "%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x",
								   packet->payload[i + 2 + 0], packet->payload[i + 2 + 1],
								   packet->payload[i + 2 + 2], packet->payload[i + 2 + 3],
								   packet->payload[i + 2 + 4], packet->payload[i + 2 + 5],
								   packet->payload[i + 2 + 6], packet->payload[i + 2 + 7],
								   packet->payload[i + 2 + 8], packet->payload[i + 2 + 9],
								   packet->payload[i + 2 + 10], packet->payload[i + 2 + 11],
								   packet->payload[i + 2 + 12], packet->payload[i + 2 + 13],
								   packet->payload[i + 2 + 14], packet->payload[i + 2 + 15]);
							} else {
							  dNSName[0] = '\0';
							}
						  }

						  /* Clean up the extracted DNS name */
						  ndpi_str_trim(dNSName);

						  if(ndpi_is_printable_string(dNSName, strlen(dNSName)) == 0) {
							ndpi_set_risk(ndpi_struct, connection, NDPI_INVALID_CHARACTERS);
						  }

						  if(connection->host_server_name[0] != '\0') {
							if(strstr(dNSName, connection->host_server_name) != NULL)
							  matched_name = 1;
							else if(strstr(connection->host_server_name, dNSName) != NULL)
							  matched_name = 1;
						  } else
							matched_name = 1;

						  if(matched_name) {
							if(connection->server_names == NULL) {
							  connection->server_names = ndpi_strdup(dNSName);
							} else {
							  char *new_server_names;
							  size_t current_len = strlen(connection->server_names);
							  size_t dns_name_len = strlen(dNSName);

							  new_server_names = (char*)realloc(connection->server_names, current_len + dns_name_len + 2); // +1 for comma, +1 for null terminator
							  if (new_server_names != NULL) {
								connection->server_names = new_server_names;
								snprintf(connection->server_names + current_len, dns_name_len + 2, ",%s", dNSName);
							  } else {
								/* Handle realloc failure, possibly by logging an error */
								NDPI_LOG_ERROR(ndpi_struct, "Failed to reallocate memory for server names.\n");
							  }
							}

							ndpi_detect_subprotocol_from_string(ndpi_struct, connection, dNSName);
						  }
						}