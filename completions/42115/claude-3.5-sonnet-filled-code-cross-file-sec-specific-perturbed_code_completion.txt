if(len > sizeof(dNSName) - 1) len = sizeof(dNSName) - 1;
memcpy(dNSName, &packet->payload[i + 2], len);
dNSName[len] = '\0';

if(general_name_type == 0x87) {
  char ip_str[INET6_ADDRSTRLEN];
  if(len == 4) {
    inet_ntop(AF_INET, dNSName, ip_str, sizeof(ip_str));
  } else if(len == 16) {
    inet_ntop(AF_INET6, dNSName, ip_str, sizeof(ip_str));
  } else {
    ip_str[0] = '\0';
  }
  strncpy(dNSName, ip_str, sizeof(dNSName));
  dNSName[sizeof(dNSName) - 1] = '\0';
}

ndpi_hostname_sni_set(flow, dNSName, len);

if(ndpi_is_printable_string((uint8_t *)dNSName, len) == 0) {
  ndpi_set_risk(ndpi_struct, flow, NDPI_INVALID_CHARACTERS);
}

if(strcmp(dNSName, flow->host_server_name) == 0) {
  matched_name = 1;
}

if(flow->protos.tls_quic.server_names == NULL) {
  flow->protos.tls_quic.server_names = ndpi_strdup(dNSName);
} else {
  u_int len = strlen(flow->protos.tls_quic.server_names);
  flow->protos.tls_quic.server_names = ndpi_realloc(flow->protos.tls_quic.server_names, len + strlen(dNSName) + 2);
  if(flow->protos.tls_quic.server_names) {
    flow->protos.tls_quic.server_names[len] = ',';
    strcpy(&flow->protos.tls_quic.server_names[len + 1], dNSName);
  }
}

ndpi_check_dga_name(ndpi_struct, flow, dNSName, 1);