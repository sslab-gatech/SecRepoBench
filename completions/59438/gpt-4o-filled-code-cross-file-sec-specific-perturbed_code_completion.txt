size_t record_count = 0;
    size_t tapemark_count = 0;
    const unsigned char *current = uc;

    while (current < end_pointer) {
        if (end_pointer - current < 4) {
            return 0; // Not enough data for a length field
        }

        uint32_t length = getlen(current);
        current += 4;

        if (length == 0xFFFFFFFF) {
            // End of Medium (EOM) marker
            return 1;
        }

        if (length == 0) {
            // Tapemark
            tapemark_count++;
            if (tapemark_count >= SIMH_TAPEMARKS) {
                return 1;
            }
            continue;
        }

        if (end_pointer - current < length + 4) {
            return 0; // Not enough data for the record and its complement
        }

        const unsigned char *record_end = current + length;
        uint32_t complement_length = getlen(record_end);

        if (complement_length != length) {
            return 0; // Lengths do not match
        }

        current = record_end + 4;
        record_count++;
    }

    return 0; // If we exit the loop without finding EOM