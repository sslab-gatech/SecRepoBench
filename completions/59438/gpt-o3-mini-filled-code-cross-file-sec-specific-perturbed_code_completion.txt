{
	const unsigned char *p = uc;
	uint32_t rec_len;
	size_t tapemark_count = 0;

	while (p < end_pointer) {
		/* Get the record length. */
		rec_len = getlen(&p, end_pointer);

		/* Check for End Of Medium marker. */
		if (rec_len == 0xffffffffU)
			break;

		/* A zero length indicates a tapemark. */
		if (rec_len == 0) {
			tapemark_count++;
			if (tapemark_count >= SIMH_TAPEMARKS)
				break;
			continue;
		}

		/* Ensure the record data is within bounds. */
		if (p + rec_len > end_pointer)
			return 0;
		p += rec_len;

		/* Read the trailing record length and verify it matches. */
		if (getlen(&p, end_pointer) != rec_len)
			return 0;
	}
	return 1;
}