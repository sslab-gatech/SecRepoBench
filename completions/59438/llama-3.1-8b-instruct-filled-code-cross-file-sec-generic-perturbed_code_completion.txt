static int
simh_parse(const unsigned char *uc, const unsigned char *end_pointer)
{
    int records = 0;
    int tapemarks = 0;
    int eom_found = 0;
    int len_valid = 1;

    while (uc < end_pointer) {
        // Check for End of Medium (EOM) marker
        if (memcmp(uc, "\xFF\xFF\xFF\xFF", 4) == 0) {
            eom_found = 1;
            break;
        }

        // Get the length of the record
        int len = getlen(uc);
        uc += 4; // Move past the length

        // Check if the length is valid
        if (len < 0 || len > end_pointer - uc) {
            len_valid = 0;
            break;
        }

        // Check if the length matches its complementary length
        int compl_len = getlen(uc);
        uc += 4; // Move past the complementary length
        if (len!= compl_len) {
            len_valid = 0;
            break;
        }

        // Increment the record count
        records++;

        // Check for tapemarks
        if (memcmp(uc, "\xFF\xFF\xFF\xFF", 4) == 0) {
            tapemarks++;
            if (tapemarks >= SIMH_TAPEMARKS) {
                break;
            }
        }

        // Move past the record data
        uc += len;
    }

    // Check if the End of Medium (EOM) marker was found
    if (eom_found) {
        return 1;
    }

    // Check if the length was valid
    if (len_valid) {
        return 1;
    }

    // If we reach here, the data is invalid
    return 0;
}