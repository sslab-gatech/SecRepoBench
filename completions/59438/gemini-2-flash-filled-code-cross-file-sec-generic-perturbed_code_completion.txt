{
	uint32_t len, len2;
	int records = 0;
	int tapemarks = 0;
	const unsigned char *p = uc;

	while (p < end_pointer) {
		len = getlen(p);
		p += 4;

		if (len == 0xFFFFFFFF) {
			return 1; /* End of Medium */
		}

		if (len == 0) {
			tapemarks++;
			if (tapemarks > SIMH_TAPEMARKS) {
				return 1;
			}
			continue;
		}

		if ((p + len) > end_pointer) {
			return 0; /* Data extends beyond buffer */
		}

		p += len;
		len2 = getlen(p);
		p += 4;

		if (len != (~len2 & 0xFFFFFFFF)) {
			return 0; /* Length mismatch */
		}
		records++;
	}

	return 1;
}