// <MASK>
int tapemarks = 0;
const unsigned char *p = uc;
while (p < end_pointer) {
    int len = getlen(&p, end_pointer);
    if (len == 0xFFFFFFFF) {
        // End of Medium (EOM) marker found, stop parsing
        return 1;
    }
    if (len != getlen(&p, end_pointer)) {
        // Length mismatch, invalid data
        return 0;
    }
    p += len;
    if (len == 0) {
        // Tapemark found
        tapemarks++;
        if (tapemarks >= SIMH_TAPEMARKS) {
            // Reached the maximum number of tapemarks, stop processing
            return 1;
        }
    }
}
return 1;
// </MASK>