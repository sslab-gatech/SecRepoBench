// Function to parse SIMH tape files by examining records and tapemarks.
// Iterates through the byte data, extracting
// lengths using the `getlen` function and counting records and tapemarks.
// Checks for the End of Medium (EOM) marker (0xFFFFFFFF) to terminate
// parsing. If a data record length does not match its complementary
// length, it returns 0 indicating invalid data. If the number of
// tapemarks reaches the predefined limit `SIMH_TAPEMARKS`, it stops
// processing further. Returns 1 if valid SIMH data is found, otherwise 0.

int records = 0, tapemarks = 0;
while (uc < end_pointer) {
    // Check for the End of Medium (EOM) marker
    if (uc + 4 <= end_pointer && *(uint32_t *)uc == 0xFFFFFFFF) {
        break;
    }

    // Extract the record length
    uint16_t len = getlen(uc, end_pointer);
    if (len == 0 || uc + len + 2 > end_pointer) {
        return 0;  // Invalid data
    }

    // Check for tapemarks
    if (len == 1 && *uc == 0x00) {
        tapemarks++;
        if (tapemarks >= SIMH_TAPEMARKS) {
            break;
        }
    } else {
        records++;
    }

    // Move to the next record
    uc += len + 2;
}

// Check if valid SIMH data is found
return records > 0;