int records = 0, tapemarks = 0;

while (uc < end_pointer) {
    uint32_t len = getlen(&uc);
    
    if (len == 0xffffffff) {
        DPRINTF("EOM at %td\n", uc - (const unsigned char *)b->fbuf);
        return 1;  // End of Medium found, valid SIMH data
    }
    
    if (uc + len + sizeof(uint32_t) > end_pointer)
        return 0;  // Incomplete record, invalid data
    
    uint32_t complement_len = getlen(&uc);
    
    if (len != (complement_len ^ 0xffffff))
        return 0;  // Length mismatch, invalid data
    
    if (len == 0) {
        tapemarks++;
        DPRINTF("TM %d at %td\n", tapemarks,
                uc - (const unsigned char *)b->fbuf);
        if (SIMH_TAPEMARKS && tapemarks >= SIMH_TAPEMARKS)
            return 1;  // Reached tapemark limit, consider it valid
    } else {
        records++;
        DPRINTF("REC %d len %u at %td\n", records, len,
                uc - (const unsigned char *)b->fbuf);
        uc += len;
    }
}

return 1;  // Reached end of data without issues, valid SIMH data