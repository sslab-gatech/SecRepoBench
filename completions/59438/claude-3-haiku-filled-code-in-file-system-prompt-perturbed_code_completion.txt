int simh_parse(const unsigned char *uc, const unsigned char *end_pointer) {
    int records = 0;
    int tapemarks = 0;

    while (uc < end_pointer) {
        uint32_t len = getlen(&uc);
        if (len == 0xffffffff) { // End of Medium
            return 1;
        }

        // Check if the record length matches its complement
        uint32_t clen = getlen(&uc);
        if (len != (clen ^ 0xffffff)) {
            return 0; // Invalid data
        }

        uc += len;
        records++;

        if (len == 0) { // Tapemark
            tapemarks++;
            if (tapemarks >= SIMH_TAPEMARKS) {
                return 1; // Reached the limit of tapemarks
            }
        }
    }

    return 1; // Valid SIMH data
}