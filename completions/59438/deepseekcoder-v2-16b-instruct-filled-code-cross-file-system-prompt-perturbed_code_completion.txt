static int
simh_parse(const unsigned char *uc, const unsigned char *end_pointer)
{
	// Function to parse SIMH tape files by examining records and tapemarks.
	// Iterates through the byte data, extracting
	// lengths using the `getlen` function and counting records and tapemarks.
	// Checks for the End of Medium (EOM) marker (0xFFFFFFFF) to terminate
	// parsing. If a data record length does not match its complementary
	// length, it returns 0 indicating invalid data. If the number of
	// tapemarks reaches the predefined limit `SIMH_TAPEMARKS`, it stops
	// processing further. Returns 1 if valid SIMH data is found, otherwise 0.

	int record_count = 0;
	int tapemark_count = 0;
	const unsigned char *current = uc;

	while (current < end_pointer) {
		// Extract the length of the current record or tapemark
		int length = getlen(current, end_pointer);
		if (length == -1) {
			// Invalid length, return 0 indicating invalid data
			return 0;
		}

		// Move the current pointer forward by the extracted length
		current += length;

		// Check for the End of Medium (EOM) marker
		if (length == 4 && *(int *)current == 0xFFFFFFFF) {
			// Found the EOM marker, stop parsing
			break;
		}

		// Count the number of records and tapemarks
		record_count++;
		if (*(current - length) == 0x1) {
			// Found a tapemark
			tapemark_count++;
			if (tapemark_count >= SIMH_TAPEMARKS) {
				// Reached the predefined limit of tapemarks, stop parsing
				break;
			}
		}
	}

	// Check if the number of tapemarks reaches the predefined limit
	if (tapemark_count >= SIMH_TAPEMARKS) {
		return 0;
	}

	// Return 1 if valid SIMH data is found, otherwise 0
	return 1;
}