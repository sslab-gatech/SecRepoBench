const unsigned char *uc_start = uc;
uint32_t rec_len, rec_len2;
int rec_count = 0, tapemark_count = 0;

while (uc < end_pointer) {
    rec_len = getlen(&uc);
    if (rec_len == 0xffffffff) {
        // End of Medium (EOM) marker found, stop parsing
        break;
    }
    if (uc + rec_len > end_pointer) {
        // Record length exceeds remaining data, invalid data
        return 0;
    }
    if (rec_len == 0) {
        // Tapemark found, increment count
        tapemark_count++;
        if (tapemark_count >= SIMH_TAPEMARKS) {
            // Reached predefined tapemark limit, stop processing
            break;
        }
    } else {
        // Data record found, increment count
        rec_count++;
        // Check for complementary length
        rec_len2 = getlen(&uc);
        if (rec_len!= rec_len2) {
            // Record length mismatch, invalid data
            return 0;
        }
    }
    uc += rec_len;
}

// Check if any records or tapemarks were found
if (rec_count == 0 && tapemark_count == 0) {
    // No valid SIMH data found
    return 0;
}

// Valid SIMH data found
return 1;