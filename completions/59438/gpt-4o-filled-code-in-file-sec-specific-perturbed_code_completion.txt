int tapemarks = 0;
    while (uc < end_pointer) {
        uint32_t len = getlen(&uc);
        if (len == 0xffffffff) { // End of Medium
            DPRINTF("EOM found\n");
            return 1;
        }
        if (uc + len > end_pointer) {
            DPRINTF("Invalid length: %u\n", len);
            return 0;
        }
        if (len == 0) { // Tapemark
            tapemarks++;
            DPRINTF("Tapemark %d\n", tapemarks);
            if (tapemarks >= SIMH_TAPEMARKS) {
                DPRINTF("Reached tapemark limit: %d\n", SIMH_TAPEMARKS);
                return 1;
            }
        } else {
            DPRINTF("Record length: %u\n", len);
            uc += len;
            uint32_t comp_len = getlen(&uc);
            if (comp_len != len) {
                DPRINTF("Mismatched length: %u != %u\n", len, comp_len);
                return 0;
            }
        }
    }
    return 0;