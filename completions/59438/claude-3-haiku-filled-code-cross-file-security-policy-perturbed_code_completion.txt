int tapemarks = 0;
const unsigned char *current_pointer = uc;

while (current_pointer < end_pointer) {
    int record_length = getlen(&current_pointer, end_pointer);
    if (record_length == 0xFFFFFFFF) {
        // End of Medium (EOM) marker found, stop parsing
        return 1;
    }
    if (record_length != getlen(&current_pointer, end_pointer)) {
        // Record length does not match its complement, invalid data
        return 0;
    }
    if (++tapemarks >= SIMH_TAPEMARKS) {
        // Reached the maximum number of tapemarks, stop processing
        return 1;
    }
    current_pointer += record_length;
}