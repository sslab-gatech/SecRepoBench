static int
simh_parse(const unsigned char *uc, const unsigned char *end_pointer)
{
    int tapemarks = 0;
    int records = 0;

    while (uc < end_pointer) {
        uint32_t len = getlen(&uc);
        if (len == 0xffffffff) { // End of Medium
            return 1;
        }
        if (len == 0) { // Tapemark
            tapemarks++;
            if (tapemarks >= SIMH_TAPEMARKS) {
                return 1;
            }
        } else {
            uint32_t clen = getlen(&uc);
            if (clen != len) {
                return 0; // Invalid data
            }
            uc += len;
            records++;
        }
    }

    return 1;
}