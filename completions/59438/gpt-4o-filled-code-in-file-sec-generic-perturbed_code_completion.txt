int tapemarks = 0;

    while (uc < end_pointer) {
        uint32_t len = getlen(&uc);

        if (len == 0xffffffff) { // End of Medium
            tapemarks++;
            if (tapemarks >= SIMH_TAPEMARKS)
                return 1;
            continue;
        }

        if (uc + len > end_pointer) // Check for buffer overflow
            return 0;

        const unsigned char *next_record = uc + len;
        uint32_t next_len = getlen(&next_record);

        if (next_len != len) // Check if lengths match
            return 0;

        uc = next_record;
    }

    return tapemarks > 0;