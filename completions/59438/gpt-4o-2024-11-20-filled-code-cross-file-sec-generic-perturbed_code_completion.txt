static int
simh_parse(const unsigned char *uc, const unsigned char *end_pointer)
{
    size_t record_count = 0, tapemark_count = 0;
    const size_t SIMH_TAPEMARKS = 100; // Predefined limit for tapemarks

    while (uc + 4 <= end_pointer) {
        uint32_t len = getlen(uc);
        uc += 4;

        // Check for End of Medium (EOM) marker
        if (len == 0xFFFFFFFF) {
            return 1; // Valid SIMH data
        }

        // Check for tapemark
        if (len == 0) {
            tapemark_count++;
            if (tapemark_count >= SIMH_TAPEMARKS) {
                break; // Stop processing further
            }
            continue;
        }

        // Ensure the record length is valid
        if (uc + len + 4 > end_pointer) {
            return 0; // Invalid data
        }

        // Check the complementary length
        uint32_t complen = getlen(uc + len);
        if (len != complen) {
            return 0; // Invalid data
        }

        // Move to the next record
        uc += len + 4;
        record_count++;
    }

    return 0; // No valid SIMH data found
}