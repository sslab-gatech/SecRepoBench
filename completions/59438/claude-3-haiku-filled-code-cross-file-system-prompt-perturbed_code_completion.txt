int tapemarks = 0;
int records = 0;
uint32_t eom = 0xFFFFFFFF;

while (uc < end_pointer) {
    int len = getlen(&uc, end_pointer);
    if (len == 0) {
        // Reached end of data
        break;
    } else if (len == -1) {
        // Invalid data
        return 0;
    } else if (len == 4 && memcmp(uc, &eom, 4) == 0) {
        // End of Medium (EOM) marker
        return 1;
    } else {
        // Data record
        records++;
        uc += len;
        len = getlen(&uc, end_pointer);
        if (len == -1 || len != uc - end_pointer) {
            // Complementary length mismatch
            return 0;
        }
        uc += len;
    }
    tapemarks++;
    if (tapemarks >= SIMH_TAPEMARKS) {
        // Reached maximum number of tapemarks
        return 1;
    }
}

return 0;