unsigned int records = 0, tapemarks = 0;
unsigned int length, complement;

while (uc < end_pointer) {
    if (uc + 4 > end_pointer) {
        return 0;  // Not enough data for a complete record
    }

    length = getlen(uc);
    uc += 4;

    if (length == 0xFFFFFFFF) {
        // End of Medium marker
        return 1;
    }

    if (length == 0) {
        // Tapemark
        tapemarks++;
        if (tapemarks >= SIMH_TAPEMARKS) {
            return 1;
        }
        continue;
    }

    // Data record
    records++;

    if (uc + length + 4 > end_pointer) {
        return 0;  // Not enough data for the record and its complement
    }

    uc += length;
    complement = getlen(uc);
    uc += 4;

    if (length != (~complement & 0xFFFFFFFF)) {
        return 0;  // Invalid data: length doesn't match complement
    }
}

return (records > 0 || tapemarks > 0);