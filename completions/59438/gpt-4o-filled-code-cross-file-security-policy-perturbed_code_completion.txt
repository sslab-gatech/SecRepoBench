size_t record_count = 0;
    size_t tapemark_count = 0;
    const size_t SIMH_TAPEMARKS = 2; // Example limit for tapemarks
    const unsigned char *current = uc;

    while (current < end_pointer) {
        if (end_pointer - current < 4) {
            // Not enough bytes to read a full length
            return 0;
        }

        uint32_t length = getlen(current);
        current += 4;

        if (length == 0xFFFFFFFF) {
            // End of Medium marker
            return 1;
        }

        if (end_pointer - current < length + 4) {
            // Not enough bytes to read the data and its complementary length
            return 0;
        }

        current += length;

        uint32_t comp_length = getlen(current);
        current += 4;

        if (length != comp_length) {
            // Lengths do not match
            return 0;
        }

        if (length == 0) {
            // Tapemark
            tapemark_count++;
            if (tapemark_count >= SIMH_TAPEMARKS) {
                return 1;
            }
        } else {
            // Data record
            record_count++;
        }
    }

    return 0;