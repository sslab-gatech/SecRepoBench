static int
simh_parse(const unsigned char *uc, const unsigned char *ue)
{
	// Function to parse SIMH tape files by examining records and tapemarks.
	// Iterates through the byte data, extracting
	// lengths using the `getlen` function and counting records and tapemarks.
	// Checks for the End of Medium (EOM) marker (0xFFFFFFFF) to terminate
	// parsing. If a data record length does not match its complementary
	// length, it returns 0 indicating invalid data. If the number of
	// tapemarks reaches the predefined limit `SIMH_TAPEMARKS`, it stops
	// processing further. Returns 1 if valid SIMH data is found, otherwise 0.

	size_t records = 0, tapemarks = 0;

	while (uc < ue) {
		uint32_t len = getlen(&uc);
		if (len == 0xffffffff)
			break;
		if (len == 0)
			return 0;
		uc += len;
		records++;
		if (tapemarks >= SIMH_TAPEMARKS)
			break;
		if (uc < ue && *uc == 0x00) {
			tapemarks++;
			uc++;
		}
	}

	return records > 0 && tapemarks > 0;
}