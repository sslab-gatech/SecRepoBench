const unsigned char *p = uc;
int records = 0, tapemarks = 0;
uint32_t length, complength;

while (p < end_pointer) {
    if (end_pointer - p < 4) {
        return 0;  // Not enough data for a complete record
    }

    length = getlen(p);
    p += 4;

    if (length == 0xFFFFFFFF) {
        // End of Medium marker
        return 1;
    }

    if (length == 0) {
        // Tapemark
        tapemarks++;
        if (tapemarks >= SIMH_TAPEMARKS) {
            return 1;
        }
        continue;
    }

    // Data record
    records++;

    if (end_pointer - p < length + 4) {
        return 0;  // Not enough data for the record and its complement
    }

    p += length;
    complength = getlen(p);
    p += 4;

    if (length != complength) {
        return 0;  // Invalid record
    }
}

return (records > 0 || tapemarks > 0);