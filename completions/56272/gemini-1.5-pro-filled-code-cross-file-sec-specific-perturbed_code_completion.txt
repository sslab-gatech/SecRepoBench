if (payload == NULL) {
    return 1;
  }
  if (payload_len < 2) {
    return 1;
  }

  tuple_count = ntohs(*(u_int16_t const *)payload);
  payload += 2;
  payload_len -= 2;

  if (tuple_count == 0 || tuple_count * 4 > payload_len) {
    return 1;
  }

  if (payload_len < 2) {
    return 1;
  }

  while (tuple_count > 0 && payload_len > 0) {
    u_int16_t type = ntohs(*(u_int16_t const *)payload);
    u_int16_t value_len;
    payload += 2;
    payload_len -= 2;

    if (payload_len < 2) {
      return 1;
    }

    value_len = ntohs(*(u_int16_t const *)payload);
    payload += 2;
    payload_len -= 2;

    if (value_len > payload_len) {
      return 1;
    }

    if (type == 1 && value_len < NDPI_SOFTETHER_MAX_HOST_LEN) {
      memcpy(ndpiflow->protos.softether.hostname, payload, value_len);
      ndpiflow->protos.softether.hostname[value_len] = '\0';
    } else if (type == 2 && value_len < NDPI_SOFTETHER_MAX_HOST_LEN) {
      memcpy(ndpiflow->protos.softether.fqdn, payload, value_len);
      ndpiflow->protos.softether.fqdn[value_len] = '\0';
    }

    payload += value_len;
    payload_len -= value_len;
    tuple_count--;
  }

  if (payload_len != 0 || tuple_count != 0) {
    return 1;
  }