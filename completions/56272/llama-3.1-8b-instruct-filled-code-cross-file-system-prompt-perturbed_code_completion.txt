// Check if the payload length is sufficient and retrieve the tuple count from the payload.
if (payload_len < 4) {
  return -1; // Error: Insufficient payload length
}

tuple_count = ndpi_ntohs(*((u_int16_t *)(payload)));

// Validate the tuple count and adjust the payload and its length accordingly.
if (tuple_count > payload_len / 4) {
  return -1; // Error: Invalid tuple count
}

payload += 4;
payload_len -= 4;

// Extract the first value from the payload to determine if it contains a "host_name" identifier.
if (ndpi_match_strprefix(payload, payload_len, "host_name")) {
  // Prepare to store the hostname value in the flow structure's hostname field.
  flow->protos.softether.hostname = ndpi_malloc(payload_len);
  if (flow->protos.softether.hostname == NULL) {
    return -1; // Error: Memory allocation failed
  }
  memcpy(flow->protos.softether.hostname, payload, payload_len);
  flow->protos.softether.hostname[payload_len] = '\0';
  payload += payload_len;
  payload_len = 0;
}

// Iterate over each tuple in the payload, extracting values and checking their types and identifiers.
while (payload_len >= 4 && tuple_count > 0) {
  u_int32_t tuple_len = ndpi_ntohs(*((u_int16_t *)(payload)));
  if (tuple_len > payload_len - 4) {
    return -1; // Error: Invalid tuple length
  }
  payload += 4;
  payload_len -= 4;

  if (ndpi_match_strprefix(payload, tuple_len, "ddns_fqdn")) {
    // Prepare to store the FQDN value in the flow structure's fqdn field.
    flow->protos.softether.fqdn = ndpi_malloc(tuple_len);
    if (flow->protos.softether.fqdn == NULL) {
      return -1; // Error: Memory allocation failed
    }
    memcpy(flow->protos.softether.fqdn, payload, tuple_len);
    flow->protos.softether.fqdn[tuple_len] = '\0';
    payload += tuple_len;
    payload_len -= tuple_len;
  } else {
    payload += tuple_len;
    payload_len -= tuple_len;
  }
  tuple_count--;
}

// If any unprocessed data remains or tuple count is not exhausted, return an error code.
if (payload_len > 0 || tuple_count > 0) {
  return -1; // Error: Unprocessed data or invalid tuple count
}

return 0;