u_int16_t value_type, value_length;
  u_int32_t i;
  int host_name_found = 0, fqdn_found = 0;

  if (payload_len < 4)
    return -1;

  tuple_count = ndpi_read_32(payload);
  payload += 4;
  payload_len -= 4;

  if (tuple_count > 20)
    return -1;

  i = tuple_count;
  while ((payload_len > 4) && (i > 0)) {
    u_int16_t identifier;

    identifier = ndpi_read_16(payload);
    value_type = ndpi_read_16(payload + 2);

    payload += 4;
    payload_len -= 4;

    if (payload_len < 2)
      return -1;

    value_length = ndpi_read_16(payload);
    payload += 2;
    payload_len -= 2;

    if (payload_len < value_length)
      return -1;

    if (identifier == 0x0101) { /* host_name */
      if (value_type == 0x0002) {
        if (value_length < sizeof(ndpiflow->protos.softether.hostname)) {
          memcpy(ndpiflow->protos.softether.hostname, payload, value_length);
          ndpiflow->protos.softether.hostname[value_length] = '\0';
          host_name_found = 1;
        }
      }
    } else if (identifier == 0x0104) { /* ddns_fqdn */
      if (value_type == 0x0002) {
        if (value_length < sizeof(ndpiflow->protos.softether.fqdn)) {
          memcpy(ndpiflow->protos.softether.fqdn, payload, value_length);
          ndpiflow->protos.softether.fqdn[value_length] = '\0';
          fqdn_found = 1;
        }
      }
    }

    payload += value_length;
    payload_len -= value_length;
    i--;
  }

  if ((payload_len > 0) || (i != 0))
    return -1;

  if(host_name_found && fqdn_found)
    return 0;
  else
    return -1;