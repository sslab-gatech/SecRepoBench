// Initialize variables for processing and flags for hostname and FQDN detection.
int hostname_detected = 0, fqdn_detected = 0;
char *hostname = flow->protos.softether.hostname;
char *fqdn = flow->protos.softether.fqdn;

// Check if the payload length is sufficient and retrieve the tuple count from the payload.
if (payload_len < 4)
    return 1;
tuple_count = ntohl(get_u_int32_t(payload, 0));
payload += 4;
payload_len -= 4;

// Validate the tuple count and adjust the payload and its length accordingly.
if (tuple_count == 0 || tuple_count > 100)
    return 1;

// Extract the first value from the payload to determine if it contains a "host_name" identifier.
struct softether_value first_value, second_value;
size_t value_size = dissect_softether_tuples(payload, payload_len, &first_value, &second_value);
if (value_size == 0)
    return 1;

payload += value_size;
payload_len -= value_size;

// Iterate over each tuple in the payload, extracting values and checking their types and identifiers.
while (tuple_count > 0) {
    if (first_value.type == VALUE_STR && strcmp(first_value.value.ptr.value_str, "host_name") == 0) {
        if (second_value.type == VALUE_STR) {
            strncpy(hostname, second_value.value.ptr.value_str, sizeof(flow->protos.softether.hostname) - 1);
            hostname[sizeof(flow->protos.softether.hostname) - 1] = '\0';
            hostname_detected = 1;
        }
    } else if (first_value.type == VALUE_STR && strcmp(first_value.value.ptr.value_str, "ddns_fqdn") == 0) {
        if (second_value.type == VALUE_STR) {
            strncpy(fqdn, second_value.value.ptr.value_str, sizeof(flow->protos.softether.fqdn) - 1);
            fqdn[sizeof(flow->protos.softether.fqdn) - 1] = '\0';
            fqdn_detected = 1;
        }
    }

    value_size = dissect_softether_tuples(payload, payload_len, &first_value, &second_value);
    if (value_size == 0)
        return 1;

    payload += value_size;
    payload_len -= value_size;
    tuple_count--;
}

// If any unprocessed data remains or tuple count is not exhausted, return an error code.
if (payload_len > 0 || tuple_count > 0)
    return 1;

// If a "host_name" is detected, prepare to store its value in the flow structure's hostname field.
// If a "ddns_fqdn" identifier is detected, prepare to store its value in the flow structure's fqdn field.
if (hostname_detected || fqdn_detected)
    return 0;
else
    return 1;