if (payload_len < 4)
    return -1;

  tuple_count = ndpi_read_32(payload);

  payload += 4;
  payload_len -= 4;

  if (tuple_count > 10)
    return -1;

  while (tuple_count > 0) {
    u_int16_t value_type, value_len;
    const u_int8_t *value_ptr;

    if (payload_len < 4)
      return -1;

    value_type = ndpi_read_16(payload);
    value_len = ndpi_read_16(payload + 2);

    payload += 4;
    payload_len -= 4;

    if (payload_len < value_len)
      return -1;

    value_ptr = payload;

    payload += value_len;
    payload_len -= value_len;

    switch (value_type) {
    case 0x0001: /* host_name */
      if (value_len < sizeof(flow->protos.softether.hostname)) {
        memcpy(flow->protos.softether.hostname, value_ptr, value_len);
        flow->protos.softether.hostname[value_len] = '\0';
      }
      break;

    case 0x0002: /* ddns_fqdn */
      if (value_len < sizeof(flow->protos.softether.fqdn)) {
        memcpy(flow->protos.softether.fqdn, value_ptr, value_len);
        flow->protos.softether.fqdn[value_len] = '\0';
      }
      break;

    default:
      break;
    }

    tuple_count--;
  }

  if (payload_len != 0 || tuple_count != 0)
    return -1;