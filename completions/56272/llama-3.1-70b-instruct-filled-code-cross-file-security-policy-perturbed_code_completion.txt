// Store the hostname and FQDN values in temporary pointers to avoid potential NULL pointer dereferences.
char *hostname_tmp = NULL;
char *fqdn_tmp = NULL;

// Check if the hostname and FQDN values are valid before storing them in the flow structure.
if (hostname!= NULL && hostname_len > 0) {
  hostname_tmp = (char *)malloc(hostname_len + 1);
  if (hostname_tmp!= NULL) {
    memcpy(hostname_tmp, hostname, hostname_len);
    hostname_tmp[hostname_len] = '\0';
  }
}

if (fqdn!= NULL && fqdn_len > 0) {
  fqdn_tmp = (char *)malloc(fqdn_len + 1);
  if (fqdn_tmp!= NULL) {
    memcpy(fqdn_tmp, fqdn, fqdn_len);
    fqdn_tmp[fqdn_len] = '\0';
  }
}

// Store the hostname and FQDN values in the flow structure.
if (hostname_tmp!= NULL) {
  strncpy(ndpiflow->protos.softether.hostname, hostname_tmp, sizeof(ndpiflow->protos.softether.hostname) - 1);
  free(hostname_tmp);
}

if (fqdn_tmp!= NULL) {
  strncpy(ndpiflow->protos.softether.fqdn, fqdn_tmp, sizeof(ndpiflow->protos.softether.fqdn) - 1);
  free(fqdn_tmp);
}