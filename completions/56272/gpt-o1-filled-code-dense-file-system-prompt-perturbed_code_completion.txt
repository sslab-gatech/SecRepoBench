int i;
  struct softether_value first_value, second_value;
  size_t consumed;
  const size_t min_len_for_tuple_count = 4;

  if (payload_len < min_len_for_tuple_count) {
    return 1; /* Not enough data to read tuple count */
  }

  tuple_count = ntohl(get_u_int32_t(payload, 0));
  payload += min_len_for_tuple_count;
  payload_len -= min_len_for_tuple_count;

  /* Iterate over each tuple pair */
  for (i = 0; i < (int)tuple_count; i++) {
    memset(&first_value, 0, sizeof(first_value));
    memset(&second_value, 0, sizeof(second_value));

    consumed = dissect_softether_tuples(payload, payload_len, &first_value, &second_value);
    if (consumed == 0 || consumed > payload_len) {
      return 2; /* Failed to dissect tuple or out of bounds */
    }

    payload += consumed;
    payload_len -= consumed;

    /* Check for host_name or ddns_fqdn keywords in the first_value */
    if (first_value.type == NDPI_SE_STRING && first_value.value.ptr) {
      if (!strncmp((char *)first_value.value.ptr, "host_name", first_value.len)) {
        /* Store in hostname if second_value is also a valid string */
        if (second_value.type == NDPI_SE_STRING && second_value.value.ptr) {
          size_t copy_len = ndpi_min(sizeof(ndpiflow->protos.softether.hostname) - 1, second_value.len);
          strncpy(ndpiflow->protos.softether.hostname, (char *)second_value.value.ptr, copy_len);
          ndpiflow->protos.softether.hostname[copy_len] = '\0';
        }
      } else if (!strncmp((char *)first_value.value.ptr, "ddns_fqdn", first_value.len)) {
        /* Store in fqdn if second_value is also a valid string */
        if (second_value.type == NDPI_SE_STRING && second_value.value.ptr) {
          size_t copy_len = ndpi_min(sizeof(ndpiflow->protos.softether.fqdn) - 1, second_value.len);
          strncpy(ndpiflow->protos.softether.fqdn, (char *)second_value.value.ptr, copy_len);
          ndpiflow->protos.softether.fqdn[copy_len] = '\0';
        }
      }
    }
  }

  /* If there's leftover data we didn't process, return error */
  if (payload_len != 0) {
    return 3;
  }