if (payload_len < sizeof(tuple_count)) {
    return 1;
  }

  tuple_count = ntohl(*(u_int32_t const *)payload);
  payload += sizeof(tuple_count);
  payload_len -= sizeof(tuple_count);

  if (tuple_count == 0 || tuple_count * 8 > payload_len) {
    return 1;
  }

  for (u_int32_t i = 0; i < tuple_count; i++) {
    if (payload_len < 8) {
      return 1;
    }

    u_int32_t type = ntohl(*(u_int32_t const *)payload);
    u_int32_t len = ntohl(*(u_int32_t const *)(payload + 4));
    payload += 8;
    payload_len -= 8;

    if (len > payload_len) {
      return 1;
    }

    if (i == 0 && type == 0x0000000b) { // host_name
      if (len >= sizeof(ndpiflow->protos.softether.hostname)) {
        return 1;
      }
      memcpy(ndpiflow->protos.softether.hostname, payload, len);
      ndpiflow->protos.softether.hostname[len] = '\0';

    } else if (type == 0x0000000c) { // ddns_fqdn
      if (len >= sizeof(ndpiflow->protos.softether.fqdn)) {
        return 1;
      }
      memcpy(ndpiflow->protos.softether.fqdn, payload, len);
      ndpiflow->protos.softether.fqdn[len] = '\0';
    }

    payload += len;
    payload_len -= len;
  }

  if (payload_len != 0) {
    return 1;
  }