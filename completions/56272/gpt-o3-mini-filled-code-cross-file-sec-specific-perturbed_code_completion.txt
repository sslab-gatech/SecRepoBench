if(ndpiflow == NULL || packet == NULL || packet->payload == NULL) {
    return -1;
}

/* At this point, all tuples in the payload should have been processed.
   If there is any remaining unparsed data or if the expected tuple count
   (tuple_count) has not been fully consumed, then the packet format
   is invalid.
*/
if(tuple_count != 0 || payload_len != 0) {
    return -1;
}