(image,&affine);
                    active=MagickFalse;
                  }
                (void) WriteBlobString(image,"<g>\n");
                break;
              }
            if (LocaleCompare("pattern",token) == 0)
              {
                GetNextToken(q,&q,extent,token);
                (void) CopyMagickString(name,token,MagickPathExtent);
                GetNextToken(q,&q,extent,token);
                svg_info.pattern.x=StringToDouble(token,&next_token);
                GetNextToken(q,&q,extent,token);
                if (*token == ',')
                  GetNextToken(q,&q,extent,token);
                svg_info.pattern.y=StringToDouble(token,&next_token);
                GetNextToken(q,&q,extent,token);
                if (*token == ',')
                  GetNextToken(q,&q,extent,token);
                svg_info.pattern.width=StringToDouble(token,&next_token);
                GetNextToken(q,&q,extent,token);
                if (*token == ',')
                  GetNextToken(q,&q,extent,token);
                svg_info.pattern.height=StringToDouble(token,&next_token);
                (void) FormatLocaleString(message,MagickPathExtent,
                  "<pattern id=\"%s\" x=\"%g\" y=\"%g\" width=\"%g\" "
                  "height=\"%g\">\n",name,svg_info.pattern.x,
                  svg_info.pattern.y,svg_info.pattern.width,
                  svg_info.pattern.height);
                (void) WriteBlobString(image,message);
                break;
              }
            status=MagickFalse;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'r':
      case 'R':
      {
        if (LocaleCompare("rectangle",keyword) == 0)
          {
            primitive_type=RectanglePrimitive;
            break;
          }
        if (LocaleCompare("rotate",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            affine.rx=StringToDouble(token,&next_token);
            affine.ry=StringToDouble(token,&next_token);
            break;
          }
        if (LocaleCompare("roundRectangle",keyword) == 0)
          {
            primitive_type=RoundRectanglePrimitive;
            break;
          }
        status=MagickFalse;
        break;
      }
      case 's':
      case 'S':
      {
        if (LocaleCompare("scale",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            affine.sx=StringToDouble(token,&next_token);
            GetNextToken(q,&q,extent,token);
            if (*token == ',')
              GetNextToken(q,&q,extent,token);
            affine.sy=StringToDouble(token,&next_token);
            break;
          }
        if (LocaleCompare("skewX",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            affine.ry=StringToDouble(token,&next_token);
            break;
          }
        if (LocaleCompare("skewY",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            affine.rx=StringToDouble(token,&next_token);
            break;
          }
        if (LocaleCompare("stop-color",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(message,MagickPathExtent,
              "<stop offset=\"%s\" style=\"stop-color:%s\" />\n",
              token,token);
            (void) WriteBlobString(image,message);
            break;
          }
        if (LocaleCompare("stroke",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(message,MagickPathExtent,"stroke:%s;",
              token);
            (void) WriteBlobString(image,message);
            break;
          }
        if (LocaleCompare("stroke-antialias",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(message,MagickPathExtent,
              "stroke-antialias:%s;",token);
            (void) WriteBlobString(image,message);
            break;
          }
        if (LocaleCompare("stroke-dasharray",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(message,MagickPathExtent,
              "stroke-dasharray:%s;",token);
            (void) WriteBlobString(image,message);
            break;
          }
        if (LocaleCompare("stroke-dashoffset",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(message,MagickPathExtent,
              "stroke-dashoffset:%s;",token);
            (void) WriteBlobString(image,message);
            break;
          }
        if (LocaleCompare("stroke-linecap",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(message,MagickPathExtent,
              "stroke-linecap:%s;",token);
            (void) WriteBlobString(image,message);
            break;
          }
        if (LocaleCompare("stroke-linejoin",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(message,MagickPathExtent,
              "stroke-linejoin:%s;",token);
            (void) WriteBlobString(image,message);
            break;
          }
        if (LocaleCompare("stroke-miterlimit",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(message,MagickPathExtent,
              "stroke-miterlimit:%s;",token);
            (void) WriteBlobString(image,message);
            break;
          }
        if (LocaleCompare("stroke-opacity",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(message,MagickPathExtent,
              "stroke-opacity:%s;",token);
            (void) WriteBlobString(image,message);
            break;
          }
        if (LocaleCompare("stroke-width",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(message,MagickPathExtent,
              "stroke-width:%s;",token);
            (void) WriteBlobString(image,message);
            break;
          }
        status=MagickFalse;
        break;
      }
      case 't':
      case 'T':
      {
        if (LocaleCompare("text",keyword) == 0)
          {
            primitive_type=TextPrimitive;
            break;
          }
        if (LocaleCompare("text-antialias",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(message,MagickPathExtent,
              "text-antialias:%s;",token);
            (void) WriteBlobString(image,message);
            break;
          }
        if (LocaleCompare("text-undercolor",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(message,MagickPathExtent,
              "text_undercolor:%s;",token);
            (void) WriteBlobString(image,message);
            break;
          }
        if (LocaleCompare("translate",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            affine.tx=StringToDouble(token,&next_token);
            GetNextToken(q,&q,extent,token);
            if (*token == ',')
              GetNextToken(q,&q,extent,token);
            affine.ty=StringToDouble(token,&next_token);
            break;
          }
        status=MagickFalse;
        break;
      }
      case 'v':
      case 'V':
      {
        if (LocaleCompare("viewbox",keyword) == 0)
          {
            GetNextToken(q,&q,extent,token);
            (void) FormatLocaleString(message,MagickPathExtent,
              "viewBox=\"%s\" ",token);
            (void) WriteBlobString(image,message);
            break;
          }
        status=MagickFalse;
        break;
      }
      default:
        status=MagickFalse;
        break;
    }
    if (status == MagickFalse)
      break;
    if (active == MagickFalse)
      {
        (void) FormatLocaleString(message,MagickPathExtent,
          "<g transform=\"matrix(%.20g,%.20g,%.20g,%.20g,%.20g,%.20g)\">\n",
          affine.sx,affine.ry,affine.rx,affine.sy,affine.tx,affine.ty);
        (void) WriteBlobString(image,message);
        active=MagickTrue;
      }
    switch (primitive_type)
    {
      case PointPrimitive:
      {
        (void) FormatLocaleString(message,MagickPathExtent,
          "<circle cx=\"%g\" cy=\"%g\" r=\"0\" />\n",
          primitive_info[i].point.x,primitive_info[i].point.y);
        (void) WriteBlobString(image,message);
        break;
      }
      case LinePrimitive:
      {
        (void) FormatLocaleString(message,MagickPathExtent,
          "<line x1=\"%g\" y1=\"%g\" x2=\"%g\" y2=\"%g\" />\n",
          primitive_info[i].point.x,primitive_info[i].point.y,
          primitive_info[i+1].point.x,primitive_info[i+1].point.y);
        (void) WriteBlobString(image,message);
        break;
      }
      case RectanglePrimitive:
      {
        (void) FormatLocaleString(message,MagickPathExtent,
          "<rect x=\"%g\" y=\"%g\" width=\"%g\" height=\"%g\" />\n",
          primitive_info[i].point.x,primitive_info[i].point.y,
          primitive_info[i+1].point.x,primitive_info[i+1].point.y);
        (void) WriteBlobString(image,message);
        break;
      }
      case RoundRectanglePrimitive:
      {
        (void) FormatLocaleString(message,MagickPathExtent,
          "<rect x=\"%g\" y=\"%g\" width=\"%g\" height=\"%g\" rx=\"%g\" "
          "ry=\"%g\" />\n",primitive_info[i].point.x,primitive_info[i].point.y,
          primitive_info[i+1].point.x,primitive_info[i+1].point.y,
          primitive_info[i+2].point.x,primitive_info[i+2].point.y);
        (void) WriteBlobString(image,message);
        break;
      }
      case ArcPrimitive:
      {
        (void) FormatLocaleString(message,MagickPathExtent,
          "<path d=\"M %g %g A %g %g %g %g %g %g %g\" />\n",
          primitive_info[i].point.x,primitive_info[i].point.y,
          primitive_info[i+1].point.x,primitive_info[i+1].point.y,
          primitive_info[i+2].point.x,primitive_info[i+2].point.y,
          primitive_info[i+3].point.x,primitive_info[i+3].point.y,
          primitive_info[i+4].point.x,primitive_info[i+4].point.y);
        (void) WriteBlobString(image,message);
        break;
      }
      case EllipsePrimitive:
      {
        (void) FormatLocaleString(message,MagickPathExtent,
          "<ellipse cx=\"%g\" cy=\"%g\" rx=\"%g\" ry=\"%g\" />\n",
          primitive_info[i].point.x,primitive_info[i].point.y,
          primitive_info[i+1].point.x,primitive_info[i+1].point.y);
        (void) WriteBlobString(image,message);
        break;
      }
      case CirclePrimitive:
      {
        (void) FormatLocaleString(message,MagickPathExtent,
          "<circle cx=\"%g\" cy=\"%g\" r=\"%g\" />\n",
          primitive_info[i].point.x,primitive_info[i].point.y,
          primitive_info[i+1].point.x);
        (void) WriteBlobString(image,message);
        break;
      }
      case PolylinePrimitive:
      {
        (void) FormatLocaleString(message,MagickPathExtent,
          "<polyline points=\"");
        for (x=0; x < (ssize_t) primitive_info[i].coordinates; x++)
          (void) FormatLocaleString(message,MagickPathExtent,
            "%g,%g ",primitive_info[i+x].point.x,primitive_info[i+x].point.y);
        (void) WriteBlobString(image,message);
        (void) WriteBlobString(image,"\" />\n");
        break;
      }
      case PolygonPrimitive:
      {
        (void) FormatLocaleString(message,MagickPathExtent,
          "<polygon points=\"");
        for (x=0; x < (ssize_t) primitive_info[i].coordinates; x++)
          (void) FormatLocaleString(message,MagickPathExtent,
            "%g,%g ",primitive_info[i+x].point.x,primitive_info[i+x].point.y);
        (void) WriteBlobString(image,message);
        (void) WriteBlobString(image,"\" />\n");
        break;
      }
      case BezierPrimitive:
      {
        (void) FormatLocaleString(message,MagickPathExtent,
          "<path d=\"M %g %g ",primitive_info[i].point.x,
          primitive_info[i].point.y);
        for (x=1; x < (ssize_t) primitive_info[i].coordinates; x++)
          (void) FormatLocaleString(message,MagickPathExtent,
            "C %g %g %g %g %g %g ",primitive_info[i+x].point.x,
            primitive_info[i+x].point.y,primitive_info[i+x].point.x,
            primitive_info[i+x].point.y,primitive_info[i+x].point.x,
            primitive_info[i+x].point.y);
        (void) WriteBlobString(image,message);
        (void) WriteBlobString(image,"\" />\n");
        break;
      }
      case PathPrimitive:
      {
        (void) FormatLocaleString(message,MagickPathExtent,
          "<path d=\"%s\" />\n",primitive_info[i].text);
        (void) WriteBlobString(image,message);
        break;
      }