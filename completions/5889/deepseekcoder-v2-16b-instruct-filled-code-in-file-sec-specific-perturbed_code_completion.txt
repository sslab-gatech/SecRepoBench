-floor(value+0.5)) < DrawEpsilon) && (p == (char *) NULL));
}

static inline MagickBooleanType IsVector(const char *vector)
{
  char
    *p;

  double
    x,
    y;

  x=StringToDouble(vector,&p);
  if (p == (char *) NULL)
    return(MagickFalse);
  y=StringToDouble(p,&p);
  return((fabs(x) < DrawEpsilon) && (fabs(y) < DrawEpsilon) && (p == (char *) NULL));
}

static MagickBooleanType DrawImagePrimitive(Image *image,
  const DrawInfo *draw_info,const PrimitiveInfo *primitive_info,
  ExceptionInfo *exception)
{
  MagickBooleanType
    status;

  switch (primitive_info->primitive)
  {
    case ArcPrimitive:
      status=DrawArc(image,draw_info,primitive_info,exception);
      break;
    case CirclePrimitive:
      status=DrawCircle(image,draw_info,primitive_info,exception);
      break;
    case EllipsePrimitive:
      status=DrawEllipse(image,draw_info,primitive_info,exception);
      break;
    case LinePrimitive:
      status=DrawLine(image,draw_info,primitive_info,exception);
      break;
    case PathPrimitive:
      status=DrawPath(image,draw_info,primitive_info,exception);
      break;
    case PointPrimitive:
      status=DrawPoint(image,draw_info,primitive_info,exception);
      break;
    case PolygonPrimitive:
      status=DrawPolygon(image,draw_info,primitive_info,exception);
      break;
    case PolylinePrimitive:
      status=DrawPolyline(image,draw_info,primitive_info,exception);
      break;
    case RectanglePrimitive:
      status=DrawRectangle(image,draw_info,primitive_info,exception);
      break;
    case RoundRectanglePrimitive:
      status=DrawRoundRectangle(image,draw_info,primitive_info,exception);
      break;
    case TextPrimitive:
      status=DrawText(image,draw_info,primitive_info,exception);
      break;
    case ArcPrimitive:
    case CirclePrimitive:
    case EllipsePrimitive:
    case LinePrimitive:
    case PathPrimitive:
    case PointPrimitive:
    case PolygonPrimitive:
    case PolylinePrimitive:
    case RectanglePrimitive:
    case RoundRectanglePrimitive:
    case TextPrimitive:
      status=MagickFalse;
      break;
    default:
      status=MagickFalse;
      break;
  }
  return(status);
}

MagickExport MagickBooleanType DrawImage(Image *image,const DrawInfo *draw_info,
  ExceptionInfo *exception)
{
  MagickBooleanType
    status;

  PrimitiveInfo
    *primitive_info;

  register ssize_t
    i;

  status=MagickTrue;
  if (draw_info->primitive != (char *) NULL)
    {
      primitive_info=(PrimitiveInfo *) AcquireQuantumMemory(16UL,
        sizeof(*primitive_info));
      if (primitive_info == (PrimitiveInfo *) NULL)
        return(MagickFalse);
      i=0;
      while (ReadNextPrimitive(draw_info->primitive,&primitive_info[i]) !=
        MagickFalse)
        {
          if (primitive_info[i].primitive == UndefinedPrimitive)
            break;
          i++;
          if (i == 16)
            {
              primitive_info=(PrimitiveInfo *) ResizeQuantumMemory(
                primitive_info,(size_t) (i+16),sizeof(*primitive_info));
              if (primitive_info == (PrimitiveInfo *) NULL)
                return(MagickFalse);
            }
        }
      status=DrawPrimitive(image,draw_info,primitive_info,exception);
      primitive_info=(PrimitiveInfo *) RelinquishMagickMemory(primitive_info);
    }
  return(status);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w P r i m i t i v e                                                 %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawPrimitive() draws a graphic primitive on your image.  The primitive
%  may be represented as a string or filename.  Precede the filename with an
%  "at" sign (@) and the contents of the file are drawn on the image.  You
%  can affect how text is drawn by setting one or more members of the draw
%  info structure.
%
%  The format of the DrawPrimitive method is:
%
%      MagickBooleanType DrawPrimitive(Image *image,const DrawInfo *draw_info,
%        const PrimitiveInfo *primitive_info,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o primitive_info: Specifies a pointer to an PrimitiveInfo structure.
%
%    o exception: return any errors or warnings in this structure.
%
*/
static MagickBooleanType DrawPrimitive(Image *image,const DrawInfo *draw_info,
  const PrimitiveInfo *primitive_info,ExceptionInfo *exception)
{
  MagickBooleanType
    status;

  status=MagickTrue;
  if (IsPoint(primitive_info->primitive))
    status=DrawPoint(image,draw_info,primitive_info,exception);
  else
  if (IsVector(primitive_info->primitive))
    status=DrawLine(image,draw_info,primitive_info,exception);
  else
    status=DrawImagePrimitive(image,draw_info,primitive_info,exception);
  return(status);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w P o l y g o n                                                     %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawPolygon() draws a filled polygon on the image.
%
%  The format of the DrawPolygon method is:
%
%      MagickBooleanType DrawPolygon(Image *image,const DrawInfo *draw_info,
%        const PrimitiveInfo *primitive_info,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o primitive_info: Specifies a pointer to an PrimitiveInfo structure.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType DrawPolygon(Image *image,const DrawInfo *draw_info,
  const PrimitiveInfo *primitive_info,ExceptionInfo *exception)
{
  MagickBooleanType
    status;

  PrimitiveInfo
    *polygon_info;

  register ssize_t
    i;

  status=MagickTrue;
  if (draw_info->fill_rule == WindingRule)
    {
      for (i=0; primitive_info[i].primitive != UndefinedPrimitive; i++) ;
      polygon_info=(PrimitiveInfo *) AcquireQuantumMemory((size_t) (2UL*i+1UL),
        sizeof(*polygon_info));
      if (polygon_info == (PrimitiveInfo *) NULL)
        return(MagickFalse);
      (void) CopyMagickMemory(polygon_info,primitive_info,
        (size_t) (2UL*i)*sizeof(*polygon_info));
      polygon_info[i].primitive=UndefinedPrimitive;
      status=DrawStrokePolygon(image,draw_info,polygon_info,exception);
      polygon_info=(PrimitiveInfo *) RelinquishMagickMemory(polygon_info);
    }
  else
    {
      status=DrawDashPolygon(draw_info,primitive_info,image,exception);
    }
  return(status);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w P o l y l i n e                                                   %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawPolyline() draws a polyline on the image.
%
%  The format of the DrawPolyline method is:
%
%      MagickBooleanType DrawPolyline(Image *image,const DrawInfo *draw_info,
%        const PrimitiveInfo *primitive_info,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o primitive_info: Specifies a pointer to an PrimitiveInfo structure.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType DrawPolyline(Image *image,const DrawInfo *draw_info,
  const PrimitiveInfo *primitive_info,ExceptionInfo *exception)
{
  MagickBooleanType
    status;

  PrimitiveInfo
    *polyline_info;

  register ssize_t
    i;

  status=MagickTrue;
  for (i=0; primitive_info[i].primitive != UndefinedPrimitive; i++) ;
  polyline_info=(PrimitiveInfo *) AcquireQuantumMemory((size_t) (2UL*i+1UL),
    sizeof(*polyline_info));
  if (polyline_info == (PrimitiveInfo *) NULL)
    return(MagickFalse);
  (void) CopyMagickMemory(polyline_info,primitive_info,
    (size_t) (2UL*i)*sizeof(*polyline_info));
  polyline_info[i].primitive=UndefinedPrimitive;
  status=DrawStrokePolygon(image,draw_info,polyline_info,exception);
  polyline_info=(PrimitiveInfo *) RelinquishMagickMemory(polyline_info);
  return(status);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w R e c t a n g l e                                                 %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawRectangle() draws a rectangle on the image.
%
%  The format of the DrawRectangle method is:
%
%      MagickBooleanType DrawRectangle(Image *image,const DrawInfo *draw_info,
%        const PrimitiveInfo *primitive_info,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o primitive_info: Specifies a pointer to an PrimitiveInfo structure.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType DrawRectangle(Image *image,const DrawInfo *draw_info,
  const PrimitiveInfo *primitive_info,ExceptionInfo *exception)
{
  MagickBooleanType
    status;

  PrimitiveInfo
    rectangle_info;

  assert(primitive_info != (const PrimitiveInfo *) NULL);
  rectangle_info=*primitive_info;
  rectangle_info.primitive=RectanglePrimitive;
  status=DrawImagePrimitive(image,draw_info,&rectangle_info,exception);
  return(status);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w R o u n d R e c t a n g l e                                       %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawRoundRectangle() draws a rounded rectangle on the image.
%
%  The format of the DrawRoundRectangle method is:
%
%      MagickBooleanType DrawRoundRectangle(Image *image,const DrawInfo *draw_info,
%        const PrimitiveInfo *primitive_info,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o primitive_info: Specifies a pointer to an PrimitiveInfo structure.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType DrawRoundRectangle(Image *image,
  const DrawInfo *draw_info,const PrimitiveInfo *primitive_info,
  ExceptionInfo *exception)
{
  MagickBooleanType
    status;

  PrimitiveInfo
    round_rectangle_info;

  assert(primitive_info != (const PrimitiveInfo *) NULL);
  round_rectangle_info=*primitive_info;
  round_rectangle_