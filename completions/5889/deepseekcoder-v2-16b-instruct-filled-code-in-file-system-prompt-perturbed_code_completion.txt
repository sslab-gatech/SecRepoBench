}

static inline void TracePoints(PrimitiveInfo *primitive_info,
  const PointInfo *points,const size_t number_points)
{
  primitive_info->coordinates=(size_t) number_points;
  (void) CopyMagickMemory(primitive_info->points,points,number_points*
    sizeof(*points));
}

static MagickBooleanType DrawImage(Image *image,const DrawInfo *draw_info,
  ExceptionInfo *exception)
{
  MagickBooleanType
    status;

  PrimitiveInfo
    primitive_info[16];

  register ssize_t
    i;

  size_t
    number_primitives;

  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(draw_info != (const DrawInfo *) NULL);
  assert(draw_info->signature == MagickCoreSignature);
  if (draw_info->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"...");
  number_primitives=0;
  for (i=0; primitive_info[i].primitive != UndefinedPrimitive; i++) ;
  number_primitives=(size_t) i;
  if (draw_info->primitive != (char *) NULL)
    {
      size_t
        length;

      length=strlen(draw_info->primitive)+1;
      if (length > MaxTextExtent)
        length=MaxTextExtent;
      (void) CopyMagickString(primitive_info[0].primitive,draw_info->primitive,
        length);
      status=TracePath(primitive_info,draw_info->primitive);
      if (status == MagickFalse)
        return(MagickFalse);
      number_primitives++;
    }
  for (i=1; i < (ssize_t) number_primitives; i++)
    primitive_info[i].primitive=UndefinedPrimitive;
  status=MagickTrue;
  for (i=0; i < (ssize_t) number_primitives; i++)
  {
    if (primitive_info[i].primitive == UndefinedPrimitive)
      continue;
    if (IsPoint(primitive_info[i].primitive))
      {
        PointInfo
          point;

        char
          *p;

        double
          x,
          y;

        p=primitive_info[i].primitive;
        x=StringToDouble(&p);
        y=StringToDouble(&p);
        point.x=x;
        point.y=y;
        TracePoint(&primitive_info[i],point);
        continue;
      }
    if (strcmp(primitive_info[i].primitive,"arc") == 0)
      {
        PointInfo
          start,
          end,
          extent;

        double
          angle;

        MagickBooleanType
          large_arc_flag,
          sweep_flag;

        char
          *p;

        p=primitive_info[i].primitive;
        start.x=StringToDouble(&p);
        start.y=StringToDouble(&p);
        end.x=StringToDouble(&p);
        end.y=StringToDouble(&p);
        angle=StringToDouble(&p);
        large_arc_flag=(MagickBooleanType) StringToLong(&p);
        sweep_flag=(MagickBooleanType) StringToLong(&p);
        extent.x=StringToDouble(&p);
        extent.y=StringToDouble(&p);
        TraceArc(&primitive_info[i],start,end,extent,angle,large_arc_flag,
          sweep_flag);
        continue;
      }
    if (strcmp(primitive_info[i].primitive,"arcpath") == 0)
      {
        PointInfo
          start,
          end,
          extent;

        double
          angle;

        MagickBooleanType
          large_arc_flag,
          sweep_flag;

        char
          *p;

        p=primitive_info[i].primitive;
        start.x=StringToDouble(&p);
        start.y=StringToDouble(&p);
        end.x=StringToDouble(&p);
        end.y=StringToDouble(&p);
        angle=StringToDouble(&p);
        large_arc_flag=(MagickBooleanType) StringToLong(&p);
        sweep_flag=(MagickBooleanType) StringToLong(&p);
        extent.x=StringToDouble(&p);
        extent.y=StringToDouble(&p);
        TraceArcPath(&primitive_info[i],start,end,extent,angle,large_arc_flag,
          sweep_flag);
        continue;
      }
    if (strcmp(primitive_info[i].primitive,"bezier") == 0)
      {
        size_t
          number_points;

        char
          *p;

        p=primitive_info[i].primitive;
        number_points=StringToSizeT(&p);
        TraceBezier(&primitive_info[i],number_points);
        continue;
      }
    if (strcmp(primitive_info[i].primitive,"circle") == 0)
      {
        PointInfo
          center;

        double
          radius;

        char
          *p;

        p=primitive_info[i].primitive;
        center.x=StringToDouble(&p);
        center.y=StringToDouble(&p);
        radius=StringToDouble(&p);
        TraceCircle(&primitive_info[i],center,radius);
        continue;
      }
    if (strcmp(primitive_info[i].primitive,"ellipse") == 0)
      {
        PointInfo
          center,
          radii;

        char
          *p;

        p=primitive_info[i].primitive;
        center.x=StringToDouble(&p);
        center.y=StringToDouble(&p);
        radii.x=StringToDouble(&p);
        radii.y=StringToDouble(&p);
        TraceEllipse(&primitive_info[i],center,radii,radii);
        continue;
      }
    if (strcmp(primitive_info[i].primitive,"line") == 0)
      {
        PointInfo
          start,
          end;

        char
          *p;

        p=primitive_info[i].primitive;
        start.x=StringToDouble(&p);
        start.y=StringToDouble(&p);
        end.x=StringToDouble(&p);
        end.y=StringToDouble(&p);
        TraceLine(&primitive_info[i],start,end);
        continue;
      }
    if (strcmp(primitive_info[i].primitive,"rectangle") == 0)
      {
        PointInfo
          start,
          end;

        char
          *p;

        p=primitive_info[i].primitive;
        start.x=StringToDouble(&p);
        start.y=StringToDouble(&p);
        end.x=StringToDouble(&p);
        end.y=StringToDouble(&p);
        TraceRectangle(&primitive_info[i],start,end);
        continue;
      }
    if (strcmp(primitive_info[i].primitive,"roundrectangle") == 0)
      {
        PointInfo
          start,
          end,
          radii;

        char
          *p;

        p=primitive_info[i].primitive;
        start.x=StringToDouble(&p);
        start.y=StringToDouble(&p);
        end.x=StringToDouble(&p);
        end.y=StringToDouble(&p);
        radii.x=StringToDouble(&p);
        radii.y=StringToDouble(&p);
        TraceRoundRectangle(&primitive_info[i],start,end,radii);
        continue;
      }
    if (strcmp(primitive_info[i].primitive,"squarelinecap") == 0)
      {
        size_t
          number_points;

        char
          *p;

        p=primitive_info[i].primitive;
        number_points=StringToSizeT(&p);
        TraceSquareLinecap(&primitive_info[i],number_points,
          draw_info->stroke_width);
        continue;
      }
    status=DrawPrimitive(image,draw_info,primitive_info+i,exception);
    if (status == MagickFalse)
      return(MagickFalse);
  }
  return(MagickTrue);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w P r i m i t i v e                                                 %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawPrimitive() draws a graphic primitive on your image.  The primitive
%  may be represented as a string or filename.  Precede the filename with an
%  "at" sign (@) and the contents of the file are drawn on the image.  You
%  can affect how text is drawn by setting one or more members of the draw
%  info structure.
%
%  The format of the DrawPrimitive method is:
%
%      MagickBooleanType DrawPrimitive(Image *image,const DrawInfo *draw_info,
%        const PrimitiveInfo *primitive_info,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o primitive_info: Specifies a pointer to a PrimitiveInfo structure.
%
%    o exception: return any errors or warnings in this structure.
%
*/
static MagickBooleanType DrawPrimitive(Image *image,const DrawInfo *draw_info,
  const PrimitiveInfo *primitive_info,ExceptionInfo *exception)
{
  MagickBooleanType
    status;

  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(draw_info != (const DrawInfo *) NULL);
  assert(draw_info->signature == MagickCoreSignature);
  if (draw_info->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"...");
  assert(primitive_info != (const PrimitiveInfo *) NULL);
  assert(primitive_info->primitive != (char *) NULL);
  status=MagickFalse;
  switch (primitive_info->primitive[0])
  {
    case 'a':
      if (strcmp(primitive_info->primitive,"arc") == 0)
        status=TraceArc(primitive_info,primitive_info->point,
          primitive_info[1].point,primitive_info[2].point,
          primitive_info[3].point.x,primitive_info[3].point.y != 0.0,
          primitive_info[3].point.y != 0.0);
      if (strcmp(primitive_info->primitive,"arcpath") == 0)
        status=TraceArcPath(primitive_info,primitive_info->point,
          primitive_info[1].point,primitive_info[2].point,
          primitive_info[3].point.x,primitive_info[3].point.y != 0.0,
          primitive_info[3].point.y != 0.0);
      break;
    case 'b':
      if (strcmp(primitive_info->primitive,"bezier") == 0)
        status=TraceBezier(primitive_info,primitive_info->coordinates);
      break;
    case 'c':
      if (strcmp(primitive_info->primitive,"circle") == 0)
        status=TraceCircle(primitive_info,primitive_info->point,
          primitive_info[1].point);
      break;
    case 'e':
      if (strcmp(primitive_info->primitive,"ellipse") == 0)
        status=TraceEllipse(primitive_info,primitive_info->point,
          primitive_info[1].point,primitive_info[2].point);
      break;
    case 'l':
      if (strcmp(primitive_info->primitive,"line") == 0)
        status=TraceLine(primitive_info,primitive_info->point,
          primitive_info[1].point);
      break;
    case 'r':
      if (strcmp(primitive_info->primitive,"rectangle") == 0)
        status=TraceRectangle(primitive_info,primitive_info->point,
          primitive_info[1].point);
      if (strcmp(primitive_info->primitive,"roundrectangle") == 0)
        status=