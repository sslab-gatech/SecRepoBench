/*
  DrawPolygonPrimitive() draws a stroked polygon (line, rectangle, ellipse) on
  the image while respecting the line cap and join attributes.

  The format of the DrawStrokePolygon method is:

      MagickBooleanType DrawStrokePolygon(const DrawInfo *draw_info,
        const PrimitiveInfo *primitive_info,Image *image,
        ExceptionInfo *exception)

  A description of each parameter follows:

    o draw_info: the draw info.

    o primitive_info: Specifies a pointer to a PrimitiveInfo structure.

    o image: the image.

    o exception: return any errors or warnings in this structure.

*/

static MagickBooleanType DrawStrokePolygon(const DrawInfo *draw_info,
  const PrimitiveInfo *primitive_info,Image *image,
  ExceptionInfo *exception)
{
  DrawInfo *clone_info;
  MagickBooleanType status;
  PrimitiveInfo *stroke_polygon;
  register const PrimitiveInfo *p, *q;

  /*
    Draw stroked polygon.
  */
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(DrawEvent,GetMagickModule(),
      "    begin draw-stroke-polygon");
  clone_info = CloneDrawInfo((ImageInfo *) NULL, draw_info);
  clone_info->fill = draw_info->stroke;
  if (clone_info->fill_pattern != (Image *) NULL)
    clone_info->fill_pattern = DestroyImage(clone_info->fill_pattern);
  if (clone_info->stroke_pattern != (Image *) NULL)
    clone_info->fill_pattern = CloneImage(clone_info->stroke_pattern, 0, 0,
      MagickTrue, exception);
  clone_info->stroke.alpha = (MagickRealType) TransparentAlpha;
  clone_info->stroke_width = 0.0;
  clone_info->fill_rule = NonZeroRule;
  status = MagickTrue;
  for (p = primitive_info; p->primitive != UndefinedPrimitive; p += p->coordinates) {
    stroke_polygon = TraceStrokePolygon(draw_info, p);
    if (stroke_polygon == (PrimitiveInfo *) NULL) {
      status = 0;
      break;
    }
    status &= DrawPolygonPrimitive(image, clone_info, stroke_polygon, exception);
    if (status == 0)
      break;
    stroke_polygon = (PrimitiveInfo *) RelinquishMagickMemory(stroke_polygon);
  }
  clone_info = DestroyDrawInfo(clone_info);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(DrawEvent,GetMagickModule(),
      "    end draw-stroke-polygon");
  return(status != 0 ? MagickTrue : MagickFalse);
}