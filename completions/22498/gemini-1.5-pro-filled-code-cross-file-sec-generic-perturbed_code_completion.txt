for (a = 0; a < packet->payload_packet_len; a++) {
    if (packet->payload[a] == '\r') {
      if (packet->payload_packet_len > a + 1 && packet->payload[a + 1] == '\n') {
        packet->line[packet->parsed_lines].len =
          (u_int16_t)(&packet->payload[a] - packet->line[packet->parsed_lines].ptr);

        if (packet->line[packet->parsed_lines].len > 0) {
          packet->parsed_lines++;
        } else if (packet->empty_line_position == 0) {
          packet->empty_line_position = packet->parsed_lines;
        }

        if (packet->parsed_lines >= NDPI_MAX_PACKET_LINES) {
          break;
        }

        packet->line[packet->parsed_lines].ptr = &packet->payload[a + 2];
        packet->line[packet->parsed_lines].len = 0;

        if (packet->payload_packet_len > a + 3 && packet->payload[a + 2] == '\r' && packet->payload[a + 3] == '\n') {
          if (packet->payload_packet_len > a + 4) {
            packet->initial_binary_bytes_pos = a + 4;
            packet->initial_binary_bytes_len = packet->payload_packet_len - packet->initial_binary_bytes_pos;
          }
          break;
        }

        a++;
      }
    }
  }