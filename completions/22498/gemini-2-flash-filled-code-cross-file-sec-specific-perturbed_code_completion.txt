for(a = 0; a < packet->payload_packet_len; a++) {
    if(packet->parsed_lines >= NDPI_MAX_PACKET_LINE_NUM)
      break;

    if((a + 1) < packet->payload_packet_len &&
       packet->payload[a] == '\r' && packet->payload[a + 1] == '\n') {
      /* Line end */
      packet->line[packet->parsed_lines].len =
	(u_int16_t)(((unsigned long) &packet->payload[a]) -
		    ((unsigned long) packet->line[packet->parsed_lines].ptr));

      NDPI_LOG_DBG3(ndpi_str, "line %u len: %u\n", packet->parsed_lines, packet->line[packet->parsed_lines].len);

      packet->parsed_lines++;

      if((a + 3) < packet->payload_packet_len &&
	 packet->payload[a + 2] == '\r' && packet->payload[a + 3] == '\n') {
	/* End of header */
	if((a + 4) < packet->payload_packet_len) {
	  u_int bytes_to_copy = MIN(NDPI_FLOW_INITIAL_BYTES, packet->payload_packet_len - (a + 4));
	  memcpy(dataflow->initial_binary_bytes, &packet->payload[a + 4], bytes_to_copy);
	  dataflow->initial_binary_bytes_len = bytes_to_copy;
	}
	a += 3;
	break;
      } else {
	if(packet->parsed_lines < NDPI_MAX_PACKET_LINE_NUM) {
	  packet->line[packet->parsed_lines].ptr = &packet->payload[a + 2];
	  packet->line[packet->parsed_lines].len = 0;
	  a++;
	} else {
	  break;
	}
      }
    }
  }