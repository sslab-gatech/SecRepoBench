for(a = 0; a < packet->payload_packet_len - 1; a++) {
  if((a + 1 < packet->payload_packet_len) && (packet->payload[a] == 0x0d) && (packet->payload[a+1] == 0x0a)) {
    packet->line[packet->parsed_lines].len = (u_int16_t)(((unsigned long) &packet->payload[a]) -
                                             ((unsigned long) packet->line[packet->parsed_lines].ptr));
    if(packet->parsed_lines == 0 && packet->line[0].len >= 9) {
      if(ndpi_mem_cmp(&packet->payload[0], "HTTP/1.", 7) == 0) {
        if(packet->payload[7] == '0' || packet->payload[7] == '1') {
          packet->http_response.ptr = &packet->payload[8];
          packet->http_response.len = packet->line[0].len - 9;
        }
      }
    }
    if((a + 3 < packet->payload_packet_len) && (packet->payload[a+2] == 0x0d) && (packet->payload[a+3] == 0x0a)) {
      a += 2;
      packet->empty_line_position = a;
      if(a + 2 < packet->payload_packet_len) {
        packet->http_response.ptr = &packet->payload[a + 2];
        packet->http_response.len = packet->payload_packet_len - (a + 2);
        dataflow->initial_binary_bytes_len = packet->payload_packet_len - (a + 2);
        if(dataflow->initial_binary_bytes_len > 0)
          memcpy(dataflow->initial_binary_bytes, packet->http_response.ptr, 
                 ndpi_min(dataflow->initial_binary_bytes_len, sizeof(dataflow->initial_binary_bytes)));
      }
    }
    if(packet->parsed_lines >= (NDPI_MAX_PARSE_LINES_PER_PACKET - 1)) {
      return;
    }
    packet->parsed_lines++;
    packet->line[packet->parsed_lines].ptr = &packet->payload[a+2];
    packet->line[packet->parsed_lines].len = 0;
    if((a + 2 < packet->payload_packet_len) && 
       (ndpi_mem_cmp(&packet->payload[a+2], "Server:", 7) == 0)) {
      packet->server_line.ptr = &packet->payload[a+2];
      packet->server_line.len = 0;
      packet->http_num_headers++;
    } else if((a + 2 < packet->payload_packet_len) && 
              (ndpi_mem_cmp(&packet->payload[a+2], "Host:", 5) == 0)) {
      packet->host_line.ptr = &packet->payload[a+2];
      packet->host_line.len = 0;
      packet->http_num_headers++;
    } else if((a + 2 < packet->payload_packet_len) && 
              (ndpi_mem_cmp(&packet->payload[a+2], "Content-Type:", 13) == 0)) {
      packet->content_line.ptr = &packet->payload[a+2];
      packet->content_line.len = 0;
      packet->http_num_headers++;
    } else if((a + 2 < packet->payload_packet_len) && 
              (ndpi_mem_cmp(&packet->payload[a+2], "Accept:", 7) == 0)) {
      packet->accept_line.ptr = &packet->payload[a+2];
      packet->accept_line.len = 0;
      packet->http_num_headers++;
    } else {
      packet->http_num_headers++;
    }
    a++;
  }
}