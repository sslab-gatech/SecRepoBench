for (a = 0; a < packet->payload_packet_len; a++) {
    if (packet->payload[a] == '\n') {
      if (a > 0 && packet->payload[a - 1] == '\r') {
        if (packet->line[packet->parsed_lines].len > 0) {
          if (packet->parsed_lines < NDPI_MAX_PACKET_LINES - 1) {
            packet->parsed_lines++;
          } else {
            break;
          }
        }
        packet->line[packet->parsed_lines].ptr = &packet->payload[a + 1];
        packet->line[packet->parsed_lines].len = 0;

        if (a + 2 < packet->payload_packet_len && packet->payload[a + 1] == '\r' && packet->payload[a + 2] == '\n') {
          if (packet->payload_packet_len > a + 3) {
            u_int32_t len = packet->payload_packet_len - (a + 3);
            if (len > dataflow->initial_binary_bytes_max_len)
              len = dataflow->initial_binary_bytes_max_len;
            memcpy(dataflow->initial_binary_bytes, packet->payload + a + 3, len);
            dataflow->initial_binary_bytes_len = len;
          }
          break;
        }
      }
    } else {
      if (packet->line[packet->parsed_lines].len < NDPI_MAX_LINE_LENGTH - 1)
        packet->line[packet->parsed_lines].len++;
    }
  }