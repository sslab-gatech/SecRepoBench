for(a = 0; a < packet->payload_packet_len; a++) {
    if(packet->parsed_lines >= NDPI_MAX_PACKET_LINES)
      break;

    if(a > 0 && packet->payload[a-1] == '\r' && packet->payload[a] == '\n') {
      packet->line[packet->parsed_lines].len =
	(u_int16_t)(((unsigned long) &packet->payload[a-1]) -
		    ((unsigned long) packet->line[packet->parsed_lines].ptr));
      packet->parsed_lines++;

      if((a + 1) < packet->payload_packet_len) {
	packet->line[packet->parsed_lines].ptr = &packet->payload[a+1];
	packet->line[packet->parsed_lines].len = 0;
      }
    } else if (a > 1 && packet->payload[a-3] == '\r' && packet->payload[a-2] == '\n' &&
	       packet->payload[a-1] == '\r' && packet->payload[a] == '\n') {
      /* \r\n\r\n */
      u_int32_t bytes_left = packet->payload_packet_len - (a + 1);

      if(bytes_left > 0) {
	if(bytes_left > NDPI_FLOW_INITIAL_BINARY_BYTES)
	  bytes_left = NDPI_FLOW_INITIAL_BINARY_BYTES;

	memcpy(dataflow->initial_binary_bytes, &packet->payload[a + 1], bytes_left);
	dataflow->initial_binary_bytes_len = bytes_left;
      }
      a = packet->payload_packet_len; /* Exit loop */
    }
  }