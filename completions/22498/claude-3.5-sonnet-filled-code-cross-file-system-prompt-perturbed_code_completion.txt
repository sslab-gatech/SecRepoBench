for(a = 0; a < packet->payload_packet_len; a++) {
  if((a + 1) < packet->payload_packet_len && packet->payload[a] == 0x0d && packet->payload[a+1] == 0x0a) {
    packet->line[packet->parsed_lines].len = (u_int16_t)(((unsigned long) &packet->payload[a]) - ((unsigned long) packet->line[packet->parsed_lines].ptr));

    if(packet->parsed_lines == 0 && packet->line[0].len >= 9) {
      if(strncasecmp((const char *)packet->line[0].ptr, "HTTP/1.", 7) == 0) {
        if(packet->line[0].ptr[7] == '0' || packet->line[0].ptr[7] == '1')
          packet->http_response.ptr = packet->line[0].ptr;
      }
    }

    if((a + 3) < packet->payload_packet_len && packet->payload[a+2] == 0x0d && packet->payload[a+3] == 0x0a) {
      a += 2;
      packet->empty_line_position = a;
      packet->empty_line_position_set = 1;
      dataflow->initial_binary_bytes_len = packet->payload_packet_len - a - 2;
      if(dataflow->initial_binary_bytes_len > 0)
        memcpy(dataflow->initial_binary_bytes, &packet->payload[a + 2], dataflow->initial_binary_bytes_len);
    }

    packet->parsed_lines++;
    if(packet->parsed_lines >= NDPI_MAX_PARSE_LINES_PER_PACKET)
      return;

    packet->line[packet->parsed_lines].ptr = &packet->payload[a + 2];
    packet->line[packet->parsed_lines].len = 0;

    a++;
  } else if(packet->parsed_lines == 0) {
    if(packet->line[packet->parsed_lines].len >= (NDPI_MAX_PARSE_LINES_PER_PACKET - 1))
      return;

    packet->line[packet->parsed_lines].len++;

    if(a == 0) {
      packet->packet_lines_parsed_complete = 0;
    }
  } else {
    if(packet->line[packet->parsed_lines].len >= (NDPI_MAX_PARSE_LINES_PER_PACKET - 1))
      return;

    packet->line[packet->parsed_lines].len++;

    if((packet->line[packet->parsed_lines].len == 6 &&
        strncasecmp((const char *)&packet->payload[a - 5], "server", 6) == 0) ||
       (packet->line[packet->parsed_lines].len == 4 &&
        strncasecmp((const char *)&packet->payload[a - 3], "host", 4) == 0) ||
       (packet->line[packet->parsed_lines].len == 10 &&
        strncasecmp((const char *)&packet->payload[a - 9], "connection", 10) == 0) ||
       (packet->line[packet->parsed_lines].len == 10 &&
        strncasecmp((const char *)&packet->payload[a - 9], "user-agent", 10) == 0) ||
       (packet->line[packet->parsed_lines].len == 12 &&
        strncasecmp((const char *)&packet->payload[a - 11], "content-type", 12) == 0)) {
      packet->line[packet->parsed_lines].ptr = &packet->payload[a - packet->line[packet->parsed_lines].len];
      packet->header_line[packet->parsed_lines].ptr = packet->line[packet->parsed_lines].ptr;
      packet->header_line[packet->parsed_lines].len = packet->line[packet->parsed_lines].len;
      packet->header_line[packet->parsed_lines].is_complete = 0;
      packet->num_parsed_headers++;
    }
  }
}