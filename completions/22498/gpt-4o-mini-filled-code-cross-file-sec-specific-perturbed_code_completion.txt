const char *line_start = packet->payload;
  const char *line_end;
  size_t max_lines = sizeof(packet->line) / sizeof(packet->line[0]);

  while (packet->parsed_lines < max_lines && (line_end = (const char *)memmem(line_start, packet->payload_packet_len - (line_start - (const char *)packet->payload), "\r\n", 2)) != NULL) {
    packet->line[packet->parsed_lines].ptr = line_start;
    packet->line[packet->parsed_lines].len = line_end - line_start;

    // Move past the end of the current line
    line_start = line_end + 2; // Skip "\r\n"
    packet->parsed_lines++;
  }

  // Handle any remaining data after the last line
  if (line_start < (const char *)packet->payload + packet->payload_packet_len) {
    packet->line[packet->parsed_lines].ptr = line_start;
    packet->line[packet->parsed_lines].len = (const char *)packet->payload + packet->payload_packet_len - line_start;
    packet->parsed_lines++;
  }