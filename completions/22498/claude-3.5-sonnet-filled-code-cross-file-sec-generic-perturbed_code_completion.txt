for (a = 0; a < packet->payload_packet_len - 1; a++) {
  if ((a + 1) < packet->payload_packet_len && packet->payload[a] == 0x0d && packet->payload[a + 1] == 0x0a) {
    packet->line[packet->parsed_lines].len = (u_int16_t)(((unsigned long) &packet->payload[a]) - ((unsigned long) packet->line[packet->parsed_lines].ptr));

    if (packet->parsed_lines == 0 && packet->line[0].len >= 9) {
      if (memcmp(packet->line[0].ptr, "HTTP/1.", 7) == 0) {
        u_int16_t status_code = ndpi_bytestream_to_number(&packet->payload[8], 3);
        packet->http_response.status_code = status_code;
      }
    }

    if (packet->parsed_lines >= (NDPI_MAX_PARSE_LINES_PER_PACKET - 1)) {
      return;
    }

    packet->parsed_lines++;
    packet->line[packet->parsed_lines].ptr = &packet->payload[a + 2];
    packet->line[packet->parsed_lines].len = 0;

    if ((a + 3) < packet->payload_packet_len && packet->payload[a + 2] == 0x0d && packet->payload[a + 3] == 0x0a) {
      packet->empty_line_position = a + 2;
      packet->empty_line_position_set = 1;
      dataflow->initial_binary_bytes_len = packet->payload_packet_len - (a + 4);
      memcpy(dataflow->initial_binary_bytes, &packet->payload[a + 4], dataflow->initial_binary_bytes_len);
      return;
    }

    if (packet->parsed_lines >= 1) {
      const u_int16_t line_len = packet->line[packet->parsed_lines - 1].len;
      const u_int8_t *line_ptr = packet->line[packet->parsed_lines - 1].ptr;

      if (line_len >= 6 && memcmp(line_ptr, "Host:", 5) == 0) {
        packet->host_line.ptr = &line_ptr[6];
        packet->host_line.len = line_len - 6;
      } else if (line_len >= 11 && memcmp(line_ptr, "User-Agent:", 11) == 0) {
        packet->user_agent_line.ptr = &line_ptr[12];
        packet->user_agent_line.len = line_len - 12;
      } else if (line_len >= 8 && memcmp(line_ptr, "Server:", 7) == 0) {
        packet->server_line.ptr = &line_ptr[8];
        packet->server_line.len = line_len - 8;
      } else if (line_len >= 14 && memcmp(line_ptr, "Content-Type:", 13) == 0) {
        packet->content_type_line.ptr = &line_ptr[14];
        packet->content_type_line.len = line_len - 14;
      }

      packet->http_num_headers++;
    }
  }
}