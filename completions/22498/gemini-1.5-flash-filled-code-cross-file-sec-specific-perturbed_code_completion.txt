u_int8_t *ptr = packet->payload;
  u_int8_t *end = packet->payload + packet->payload_packet_len;
  u_int16_t line_len = 0;
  while(ptr < end) {
    if(*ptr == '\r' && ptr + 1 < end && ptr[1] == '\n') {
      packet->line[packet->parsed_lines].len = line_len;
      ptr += 2;
      line_len = 0;
      packet->parsed_lines++;
      if(ptr < end && *ptr == '\r' && ptr + 1 < end && ptr[1] == '\n') {
        ptr += 2;
        break;
      }
      if(packet->parsed_lines >= NDPI_MAX_PACKET_LINES-1)
        break;
      packet->line[packet->parsed_lines].ptr = ptr;
    } else {
      ptr++;
      line_len++;
    }
  }