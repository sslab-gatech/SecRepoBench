if (utf8) {
    const char* p;
    const char* wordp = word.c_str();
    for (p = wordp + len - 1; p > wordp && (*p & 0xc0) == 0x80; p--)
        ;
    size_t min_char_index = p - wordp;
    for (p = wordp + len - 1; p >= wordp && (*p & 0xc0) == 0x80; p--)
        ;
    size_t max_char_index = p - wordp + 1;
    min_char_index += cpdmin;
    *mincharindex = min_char_index;
    *cmax = max_char_index;
} else {
    *mincharindex = cpdmin;
    *cmax = len;
}