if (utf8) {
  size_t mincharindex = 0;
  size_t cmax = 0;
  const char* p;
  const char* wordp = word;
  for (p = wordp; p < wordp + len; p++) {
    if ((*p & 0xc0)!= 0x80) {
      if (mincharindex == 0) {
        mincharindex = p - wordp;
      }
      cmax = p - wordp + 1;
    }
  }
  if (cpdmin > 0) {
    size_t utf8charcount = 0;
    for (size_t i = 0; i < mincharindex; i++) {
      if ((word[i] & 0xc0)!= 0x80) {
        utf8charcount++;
      }
    }
    mincharindex = std::max(mincharindex, utf8charcount + cpdmin);
  }
  *mincharindex = mincharindex;
  *cmax = cmax;
} else {
  *mincharindex = 0;
  *cmax = len;
}