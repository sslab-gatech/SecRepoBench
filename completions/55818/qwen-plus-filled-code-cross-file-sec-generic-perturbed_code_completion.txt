if (utf8) {
    size_t pos = 0;
    *mincharindex = 0;
    *cmax = len;

    // Calculate the min char index as the starting position
    while (pos < len && ((word[pos] & 0xC0) != 0x80)) {
        ++(*mincharindex);
        if ((word[pos] & 0xE0) == 0xC0) {
            pos += 2;
        } else if ((word[pos] & 0xF0) == 0xE0) {
            pos += 3;
        } else if ((word[pos] & 0xF8) == 0xF0) {
            pos += 4;
        } else {
            ++pos;
        }
    }

    // Adjust the max char index to exclude trailing continuation bytes
    pos = len - 1;
    while (pos > 0 && ((word[pos] & 0xC0) == 0x80)) {
        --(*cmax);
        --pos;
    }

    // Increment min char index by the number of UTF-8 characters specified by cpdmin
    size_t cpdmin_count = cpdmin;
    pos = 0;
    while (cpdmin_count > 0 && pos < len) {
        if ((word[pos] & 0xC0) != 0x80) {
            --cpdmin_count;
        }
        if ((word[pos] & 0xE0) == 0xC0) {
            pos += 2;
        } else if ((word[pos] & 0xF0) == 0xE0) {
            pos += 3;
        } else if ((word[pos] & 0xF8) == 0xF0) {
            pos += 4;
        } else {
            ++pos;
        }
    }
    *mincharindex += pos;
} else {
    // Adjust min char index and max char index for non-UTF8
    *mincharindex = cpdmin;
    *cmax = len - 1;
}