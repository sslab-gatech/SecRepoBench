if (utf8) {
    // Calculate minimum index by skipping cpdmin UTF-8 characters
    size_t pos = 0;
    int charsSkipped = 0;
    while (pos < len && charsSkipped < cpdmin) {
        // Check if this byte starts a new UTF-8 character
        if ((static_cast<unsigned char>(word[pos]) & 0xC0) != 0x80) {
            ++charsSkipped;
        }
        ++pos;
    }
    *mincharindex = pos;

    // Calculate maximum index by cutting off trailing UTF-8 continuation bytes
    size_t end_pos = len;
    while (end_pos > 0 &&
           (static_cast<unsigned char>(word[end_pos - 1]) & 0xC0) == 0x80) {
        --end_pos;
    }
    *cmax = end_pos;
} else {
    // Non-UTF-8 case
    *mincharindex = (cpdmin < len) ? cpdmin : len;
    *cmax = len;
}