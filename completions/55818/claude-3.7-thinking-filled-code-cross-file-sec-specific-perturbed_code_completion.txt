if (utf8) {
  // Start at the beginning of the word
  *mincharindex = 0;
  
  // Increment mincharindex by cpdmin UTF-8 characters
  for (size_t i = 0; i < cpdmin && *mincharindex < len; i++) {
    (*mincharindex)++;
    // Skip UTF-8 continuation bytes (bytes starting with 10xxxxxx, or 0x80-0xBF)
    while (*mincharindex < len && (word[*mincharindex] & 0xC0) == 0x80)
      (*mincharindex)++;
  }
  
  // Set cmax to the end of the word
  *cmax = len;
  
  // Exclude trailing UTF-8 continuation bytes from cmax
  while (*cmax > *mincharindex && (word[*cmax - 1] & 0xC0) == 0x80)
    (*cmax)--;
} else {
  // For non-UTF8, simply set mincharindex and cmax based on character positions
  *mincharindex = cpdmin;
  *cmax = len;
  
  // Make sure mincharindex is not greater than the length of the word
  if (*mincharindex > len)
    *mincharindex = len;
}

// Ensure that cmax is not less than mincharindex
if (*cmax < *mincharindex)
  *cmax = *mincharindex;