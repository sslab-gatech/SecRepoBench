if (utf8) {
    size_t start = 0;
    // Skip cpdmin UTF-8 characters from the start
    for (int i = 0; i < cpdmin && start < len; i++) {
        unsigned char c = static_cast<unsigned char>(word[start]);
        if ((c & 0x80) == 0) {
            // 1-byte character
            start += 1;
        } else if ((c & 0xE0) == 0xC0 && start + 1 < len) {
            // 2-byte character
            start += 2;
        } else if ((c & 0xF0) == 0xE0 && start + 2 < len) {
            // 3-byte character
            start += 3;
        } else if ((c & 0xF8) == 0xF0 && start + 3 < len) {
            // 4-byte character
            start += 4;
        } else {
            // Fallback: move one byte
            start += 1;
        }
        if (start > len) {
            start = len;
            break;
        }
    }
    *mincharindex = start;

    // Exclude trailing UTF-8 continuation bytes
    size_t end = len;
    while (end > 0 && (static_cast<unsigned char>(word[end - 1]) & 0xC0) == 0x80) {
        --end;
    }
    *cmax = end;
} else {
    *mincharindex = cpdmin;
    *cmax = len;
}