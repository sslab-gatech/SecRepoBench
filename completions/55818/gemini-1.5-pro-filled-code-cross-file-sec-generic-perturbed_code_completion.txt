if (utf8) {
    const char* start = word;
    const char* end = word + len;
    *mincharindex = start - word;
    *cmax = end - word;

    // Adjust mincharindex based on cpdmin
    for (int i = 0; i < cpdmin && start < end; ++i) {
      start += utf8_seqlen(start);
      (*mincharindex) += 1;
    }

    // Adjust cmax to exclude trailing continuation bytes
    while (end > word && (end[-1] & 0xc0) == 0x80) {
      --end;
      (*cmax) -= 1;
    }

  } else {
    *mincharindex += cpdmin;
    *cmax -= cpdmax;
  }