if (utf8) {
  // For UTF-8 encoding
  *mincharindex = 0;  // Start at the beginning of the word
  size_t charcount = 0;
  
  // Increment mincharindex by cpdmin UTF-8 characters
  size_t i = 0;
  while (i < len && charcount < cpdmin) {
    if ((word[i] & 0xc0) != 0x80) { // Not a continuation byte, so it's a new character
      charcount++;
    }
    i++;
  }
  *mincharindex = i;
  
  // Calculate cmax by ensuring it doesn't point to a continuation byte
  *cmax = len;  // Start at the end of the word
  if (*cmax > 0) {
    size_t j = *cmax - 1;
    while (j > *mincharindex && (word[j] & 0xc0) == 0x80) {
      j--;
      (*cmax)--;
    }
  }
} else {
  // For non-UTF-8 encoding
  *mincharindex = cpdmin;
  *cmax = len;
}