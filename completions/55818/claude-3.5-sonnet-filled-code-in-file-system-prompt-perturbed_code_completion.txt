// If utf8 is set, calculate the min char index as the starting position
// and max char index as the ending position based on UTF-8 character boundaries.
if (utf8) {
  for (*mincharindex = 0; (*mincharindex < len) && 
       ((*mincharindex + cpdmin) < len) &&
       ((word[*mincharindex] & 0xc0) == 0xc0); (*mincharindex)++)
    ;
  for (*cmax = len; (*cmax > *mincharindex) && ((word[*cmax - 1] & 0xc0) == 0x80); (*cmax)--)
    ;
  *mincharindex += cpdmin;
} else {
  *mincharindex = cpdmin;
  *cmax = len;
}

// Exclude trailing UTF-8 continuation bytes while adjusting max char index.
if (utf8) {
  while ((*cmax > *mincharindex) && ((word[*cmax - 1] & 0xc0) == 0x80))
    (*cmax)--;
}