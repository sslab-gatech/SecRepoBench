if (utf8) {
    const char* p = word;
    size_t char_count = 0;
    *mincharindex = 0;
    *cmax = len;

    // Calculate mincharindex based on UTF-8 character boundaries
    while (char_count < cpdmin && *p) {
      if ((*p & 0xc0) != 0x80) {
        char_count++;
      }
      p++;
    }
    *mincharindex = p - word;

    // Calculate cmax excluding trailing UTF-8 continuation bytes
    p = word + len;
    while (p > word && (*(p - 1) & 0xc0) == 0x80) {
      p--;
    }
    *cmax = p - word;
  } else {
    // Non-UTF-8 case
    *mincharindex = cpdmin;
    *cmax = len;
  }