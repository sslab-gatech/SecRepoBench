if (utf8) {
    *mincharindex = 0;
    const char* p = word + len - 1;
    while (p > word && (*p & 0xc0) == 0x80)
      p--;
    *cmax = p - word + 1;
    size_t i = 0;
    for (size_t j = 0; j < len; j++) {
      if (((word[j] & 0xc0) != 0x80))
        i++;
      if (i == cpdmin) {
        *mincharindex = j + 1;
        break;
      }
    }
  } else {
    *mincharindex = cpdmin;
    *cmax = len;
  }