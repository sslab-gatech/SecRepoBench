if (utf8) {
    // Find the start of the first character (mincharindex)
    *mincharindex = 0;
    size_t chars = 0;
    size_t i = 0;
    // Advance by cpdmin UTF-8 characters
    while (i < len && chars < cpdmin) {
        // Skip continuation bytes
        if ((word[i] & 0xc0) != 0x80) {
            chars++;
        }
        i++;
    }
    *mincharindex = i;

    // Find the end of the last character (cmax)
    // Exclude trailing continuation bytes
    size_t end = len;
    while (end > *mincharindex && (word[end - 1] & 0xc0) == 0x80) {
        end--;
    }
    *cmax = end;
} else {
    *mincharindex = cpdmin;
    *cmax = len;
}