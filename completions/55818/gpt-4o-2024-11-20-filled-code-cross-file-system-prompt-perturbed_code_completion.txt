if (utf8) {
    size_t char_count = 0;
    const char* p = word;
    const char* end = word + len;

    // Calculate mincharindex based on UTF-8 character boundaries
    while (p < end && char_count < cpdmin) {
        if ((*p & 0xc0) != 0x80) { // Start of a UTF-8 character
            char_count++;
        }
        p++;
    }
    *mincharindex = p - word;

    // Calculate cmax excluding trailing UTF-8 continuation bytes
    p = end - 1;
    while (p > word && (*p & 0xc0) == 0x80) {
        p--;
    }
    *cmax = p - word + 1;
} else {
    // Non-UTF-8 case
    *mincharindex = cpdmin;
    *cmax = len;
}