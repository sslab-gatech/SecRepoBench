if (utf8) {
    *mincharindex = 0;
    *cmax = len;
    size_t i = 0;
    while (i < len && i < cpdmin) {
        size_t charlen = 1;
        while (i + charlen < len && (word[i + charlen] & 0xC0) == 0x80) {
            charlen++;
        }
        *mincharindex += charlen;
        i += charlen;
    }
    while (*cmax > *mincharindex && (word[*cmax - 1] & 0xC0) == 0x80) {
        (*cmax)--;
    }
} else {
    *mincharindex = cpdmin;
    *cmax = len;
}