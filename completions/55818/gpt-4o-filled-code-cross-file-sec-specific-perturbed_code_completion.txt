if (utf8) {
    size_t char_count = 0;
    size_t i = 0;
    while (i < len && char_count < cpdmin) {
      if ((word[i] & 0xc0) != 0x80) {
        char_count++;
      }
      i++;
    }
    *mincharindex = i;

    i = len;
    while (i > 0 && (word[i - 1] & 0xc0) == 0x80) {
      i--;
    }
    *cmax = i;
  } else {
    *mincharindex = cpdmin;
    *cmax = len;
  }