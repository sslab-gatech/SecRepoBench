if (utf8) {
    size_t mincharindex = 0;
    size_t maxcharindex = len - 1;
    while (mincharindex < len && (word[mincharindex] & 0xc0) == 0x80) mincharindex++;
    while (maxcharindex >= 0 && (word[maxcharindex] & 0xc0) == 0x80) maxcharindex--;
    *mincharindex = mincharindex + cpdmin;
    *maxcharindex = maxcharindex + 1;
  } else {
    *mincharindex = cpdmin;
    *maxcharindex = len - 1;
  }