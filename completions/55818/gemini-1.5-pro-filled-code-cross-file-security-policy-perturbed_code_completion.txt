if (utf8) {
    *mincharindex = utf8_cpdmin;
    *cmax = len;
    for (size_t i = len; i > 0; --i) { // Fix: prevent i from becoming negative
      if ((word[i - 1] & 0xc0) != 0x80) break;
      (*cmax)--;
    }
  } else {
    *mincharindex += cpdmin;
    *cmax -= cpdmax;
  }