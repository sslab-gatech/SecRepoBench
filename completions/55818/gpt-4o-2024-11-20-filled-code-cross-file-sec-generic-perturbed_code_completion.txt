if (utf8) {
    // Calculate mincharindex based on UTF-8 character boundaries
    size_t utf8_char_count = 0;
    const char* p = word;
    *mincharindex = 0;

    // Increment mincharindex by the number of UTF-8 characters specified by cpdmin
    while (utf8_char_count < cpdmin && *p) {
        if ((*p & 0xC0) != 0x80) { // Start of a new UTF-8 character
            utf8_char_count++;
        }
        p++;
        (*mincharindex)++;
    }

    // Calculate cmax as the ending position excluding trailing continuation bytes
    *cmax = len;
    while (*cmax > 0 && (word[*cmax - 1] & 0xC0) == 0x80) {
        (*cmax)--;
    }
} else {
    // Non-UTF-8 case: simply adjust mincharindex and cmax
    *mincharindex = cpdmin;
    *cmax = len;
}