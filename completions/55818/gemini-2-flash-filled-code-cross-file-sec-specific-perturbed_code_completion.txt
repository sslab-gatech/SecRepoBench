if (utf8) {
    *mincharindex = 0;
    *cmax = len;
    for (size_t i = 0; i < cpdmin; i++) {
      size_t next_char_pos = *mincharindex;
      if (next_char_pos >= len) break;
      // Increment to the next UTF-8 character
      next_char_pos++;
      while (next_char_pos < len && (word[next_char_pos] & 0xc0) == 0x80) {
        next_char_pos++;
      }
      *mincharindex = next_char_pos;
    }
    while (*cmax > *mincharindex && (*cmax > 0) && ((word[*cmax - 1] & 0xc0) == 0x80)) {
      (*cmax)--;
    }
  } else {
    *mincharindex = cpdmin;
    *cmax = len;
  }