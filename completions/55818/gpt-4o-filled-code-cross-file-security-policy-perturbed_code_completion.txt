if (utf8) {
    size_t char_count = 0;
    const char* p = word;
    while (p < word + len && char_count < cpdmin) {
      if ((*p & 0xc0) != 0x80) {
        char_count++;
      }
      p++;
    }
    *mincharindex = p - word;

    p = word + len;
    while (p > word && ((*p & 0xc0) == 0x80 || char_count < cpdmin)) {
      p--;
    }
    *cmax = p - word;
  } else {
    *mincharindex = cpdmin;
    *cmax = len;
  }