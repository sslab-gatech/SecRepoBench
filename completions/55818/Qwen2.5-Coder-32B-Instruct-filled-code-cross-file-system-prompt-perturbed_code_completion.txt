if (utf8) {
    *mincharindex = cpdmin;
    *cmax = len;
    // Adjust cmax to exclude trailing UTF-8 continuation bytes
    while (*cmax > *mincharindex && ((*word + *cmax - 1) & 0xc0) == 0x80) {
        (*cmax)--;
    }
} else {
    *mincharindex = cpdmin;
    *cmax = len;
}