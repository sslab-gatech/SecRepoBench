case DW_FORM_ref1:
    {
        Dwarf_Byte_Ptr ptr = attribute->ar_debug_ptr;
        Dwarf_Small localoffset = 0;

        if ((ptr + 1) > section_end) {
            _dwarf_error(dbg, error, DW_DLE_ATTR_FORM_OFF_END);
            return DW_DLV_ERROR;
        }
        localoffset = *(Dwarf_Small *) ptr;
        offset = localoffset;

        fixoffset: /* we have a local offset, make it global */

        /* check legality of offset */
        if (offset >= cu_context->cc_length +
            cu_context->cc_length_size +
            cu_context->cc_extension_size) {
            _dwarf_error(dbg, error, DW_DLE_ATTR_FORM_OFFSET_BAD);
            return DW_DLV_ERROR;
        }

        /* globalize the offset */
        offset += cu_context->cc_debug_offset;
    }
    break;

case DW_FORM_ref2:
    {
        Dwarf_Byte_Ptr ptr = attribute->ar_debug_ptr;
        Dwarf_Half localoffset = 0;

        if ((ptr + 2) > section_end) {
            _dwarf_error(dbg, error, DW_DLE_ATTR_FORM_OFF_END);
            return DW_DLV_ERROR;
        }
        READ_UNALIGNED(dbg, localoffset, Dwarf_Half, ptr, 2);
        offset = localoffset;

        goto fixoffset;
    }
    break;

case DW_FORM_ref4:
    {
        Dwarf_Byte_Ptr ptr = attribute->ar_debug_ptr;
        Dwarf_Unsigned localoffset = 0;

        if ((ptr + 4) > section_end) {
            _dwarf_error(dbg, error, DW_DLE_ATTR_FORM_OFF_END);
            return DW_DLV_ERROR;
        }
        READ_UNALIGNED(dbg, localoffset, Dwarf_Unsigned, ptr, 4);
        offset = localoffset;

        goto fixoffset;
    }
    break;