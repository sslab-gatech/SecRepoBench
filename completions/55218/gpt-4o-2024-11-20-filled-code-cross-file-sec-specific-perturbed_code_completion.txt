if(packet->payload_packet_len > 0) {
        // Ensure the payload length is within a safe range to prevent buffer overflows
        if(packet->payload_packet_len <= MAX_PAYLOAD_SIZE) {
          // Check for known BitTorrent patterns in the payload
          if(ndpi_strnstr((const char *)packet->payload, bt_search, packet->payload_packet_len) ||
             ndpi_strnstr((const char *)packet->payload, bt_search1, packet->payload_packet_len)) {
            NDPI_LOG_INFO(detectionmodule, "found BT: search pattern\n");
            ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
            return;
          }

          // Check for uTP-specific patterns
          if(packet->payload_packet_len >= 20 && 
             (packet->payload[0] == 0x13) && 
             ndpi_strnstr((const char *)&packet->payload[1], "BitTorrent protocol", 19)) {
            NDPI_LOG_INFO(detectionmodule, "found BT: uTP pattern\n");
            ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
            return;
          }
        } else {
          NDPI_LOG_WARN(detectionmodule, "Payload size exceeds maximum allowed size\n");
        }
      }