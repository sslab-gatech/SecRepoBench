// Check if the UDP packet payload indicates a BitTorrent connection by examining specific patterns.
if (ndpi_strnstr((const char *)packet->payload, bt_search, packet->payload_packet_len)
    || ndpi_strnstr((const char *)packet->payload, bt_search1, packet->payload_packet_len)) {
  goto bittorrent_found;
}

// For protocol v0, analyze certain packet fields to determine if they fit the characteristics of BitTorrent.
if (packet->payload_packet_len > 20 && ntohs(packet->udp->source) >= 1024 && ntohs(packet->udp->dest) >= 1024) {
  u_int8_t *payload = (u_int8_t *)packet->payload;
  if (payload[0] == 'u' && payload[1] == 't' && payload[2] == 'p' && payload[3] == '\0') {
    // If the packet appears to be uTP (Micro Transport Protocol), check for the BitTorrent protocol string.
    if (ndpi_strnstr((const char *)packet->payload, "utp", packet->payload_packet_len)) {
      goto bittorrent_found;
    }
  }
}

// Apply heuristics to further identify potential BitTorrent connections based on specific byte patterns.
if (packet->payload_packet_len > 16 && packet->payload[0] == 0x13 && packet->payload[1] == 0x00) {
  goto bittorrent_found;
}