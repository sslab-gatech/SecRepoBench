if(packet->payload_packet_len >= 20) {
  if(memcmp(packet->payload, bt_search, strlen(bt_search)) == 0 ||
     memcmp(packet->payload, bt_search1, strlen(bt_search1)) == 0) {
    goto bittorrent_found;
  }

  if(packet->payload[0] == 0x13) { /* uTP protocol v0 */
    if((packet->payload[1] == 0) && (packet->payload_packet_len >= 23) &&
       (packet->payload[2] < 6) && (packet->payload[3] == 0) &&
       (ntohs(*((u_int16_t*)&packet->payload[12])) == packet->payload_packet_len - 20)) {
      goto bittorrent_found;
    }
  } else if((packet->payload[0] == 0x41) && (packet->payload_packet_len >= 22)) {
    /* uTP protocol v1 */
    if((packet->payload[1] == 1) && (packet->payload[2] < 6) &&
       (packet->payload[3] == 0) &&
       (ntohs(*((u_int16_t*)&packet->payload[16])) == packet->payload_packet_len - 20)) {
      if((bt_proto = ndpi_strnstr((const char *)&packet->payload[20], BITTORRENT_PROTO_STRING,
                                  packet->payload_packet_len - 20)) != NULL) {
        goto bittorrent_found;
      }
    }
  }

  /* Check for BitTorrent heuristics */
  if((packet->payload[0] == 'd') && (packet->payload[packet->payload_packet_len - 1] == 'e')) {
    if(ndpi_strnstr((const char *)packet->payload, "5:peers", packet->payload_packet_len) != NULL) {
      goto bittorrent_found;
    }
  }
}