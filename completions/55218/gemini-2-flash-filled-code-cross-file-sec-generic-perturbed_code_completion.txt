if(packet->payload_packet_len > 12) {
	if(memcmp(packet->payload, bt_search, MIN(packet->payload_packet_len, strlen(bt_search))) == 0) {
	  NDPI_LOG_INFO(detectionmodule, "found BT: BT-SEARCH\n");
	  ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	  return;
	} else if(memcmp(packet->payload, bt_search1, MIN(packet->payload_packet_len, strlen(bt_search1))) == 0) {
	  NDPI_LOG_INFO(detectionmodule, "found BT: d1:ad2:id20:\n");
	  ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	  return;
	} else if(packet->payload[0] == 0x01) { /* uTP */
	  const char *bittorrent_string = "BitTorrent protocol";

	  if(ndpi_strnstr((const char *)&packet->payload[3],
			  bittorrent_string,
			  packet->payload_packet_len - 3) != NULL) {
	    NDPI_LOG_INFO(detectionmodule, "found BT: uTP\n");
	    ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	    return;
	  }
	} else if((packet->payload[0] == 0xFE) && (packet->payload[1] == 0xFD)) {
	  /*
	   * 0xFE 0xFD [request type] [session id] [magic number] [message size]
	   */
	  NDPI_LOG_INFO(detectionmodule, "found BT: v0\n");
	  if((packet->payload_packet_len > 8) && (packet->payload[4] == 0x00) && (packet->payload[5] == 0x00)
	     && (packet->payload[6] == 0x00) && (packet->payload[7] == 0x00)) {
	    NDPI_LOG_INFO(detectionmodule, "found BT: v0\n");
	    ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	    return;
	  }
	} else if((packet->payload[0] == 0x67) && (packet->payload[1] == 0x65)) {
	  /* gE */
	  NDPI_LOG_INFO(detectionmodule, "found BT: gE\n");
	  ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	  return;
	} else if((packet->payload[0] == 0x80) && (packet->payload[1] == 0x82)) {
	  /* 0x80 0x82 */
	  NDPI_LOG_INFO(detectionmodule, "found BT: 0x80 0x82\n");
	  ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	  return;
	}
      }