if(packet->payload_packet_len > 15 && ndpi_strnstr((const char *)packet->payload, bt_search, packet->payload_packet_len)) {
	NDPI_LOG_INFO(detectionmodule, "found BT-SEARCH\n");
	ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	return;
      }

      if(packet->payload_packet_len > 15 && ndpi_strnstr((const char *)packet->payload, bt_search1, packet->payload_packet_len)) {
	NDPI_LOG_INFO(detectionmodule, "found BT-d1:ad2:id20:\n");
	ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	return;
      }

      /* Check for BitTorrent protocol header v0 */
      if(packet->payload_packet_len > 20) {
	u_int8_t first_byte = packet->payload[0];

	if(first_byte > 0 && first_byte <= 19) {
	  if(packet->payload[first_byte] == first_byte && packet->payload[first_byte + 1] == 0) {
	    goto bittorrent_found;
	  }
	}
      }

      /* Check for uTP */
      if(packet->payload_packet_len > 4 && packet->payload[0] == 0x00 && packet->payload[1] == 0x10 && packet->payload[2] == 0x00 && packet->payload[3] == 0x00) {
	if(ndpi_strnstr((const char *)packet->payload, BITTORRENT_PROTO_STRING, packet->payload_packet_len)) {
	  goto bittorrent_found;
	}
      }

      /* Heuristics */
      if(packet->payload_packet_len > 20 && packet->payload[0] == 0x13 && packet->payload[1] == 'B' && packet->payload[2] == 'i' && packet->payload[3] == 't' && packet->payload[4] == 'T' && packet->payload[5] == 'o' && packet->payload[6] == 'r' && packet->payload[7] == 'r' && packet->payload[8] == 'e' && packet->payload[9] == 'n' && packet->payload[10] == 't' && packet->payload[11] == ' ' && packet->payload[12] == 'p' && packet->payload[13] == 'r' && packet->payload[14] == 'o' && packet->payload[15] == 't' && packet->payload[16] == 'o' && packet->payload[17] == 'c' && packet->payload[18] == 'o' && packet->payload[19] == 'l') {
	goto bittorrent_found;
      }