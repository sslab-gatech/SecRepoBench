if(packet->payload_packet_len >= strlen(bt_search)
         && memcmp(packet->payload, bt_search, strlen(bt_search)) == 0) {
        NDPI_LOG_INFO(detectionmodule, "found BT: BT-SEARCH\n");
        ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
        return;
      }

      if(packet->payload_packet_len >= strlen(bt_search1)
         && memcmp(packet->payload, bt_search1, strlen(bt_search1)) == 0) {
        NDPI_LOG_INFO(detectionmodule, "found BT: DHT\n");
        ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
        return;
      }

      /* uTP detection: first byte is version (1-4), second byte is type (1-4), then connection id, timestamp, etc. */
      if(packet->payload_packet_len > 20) {
        u_int8_t ver = ((u_int8_t*)packet->payload)[0];
        u_int8_t typ = ((u_int8_t*)packet->payload)[1];
        if(ver >= 1 && ver <= 4 && typ >= 1 && typ <= 4) {
          /* Heuristic: look for BitTorrent protocol string in the payload */
          bt_proto = ndpi_strnstr((const char *)packet->payload, BITTORRENT_PROTO_STRING, packet->payload_packet_len);
          if(bt_proto != NULL) goto bittorrent_found;
        }
      }

      /* Heuristic: look for DHT or tracker messages */
      if(packet->payload_packet_len > 19) {
        if(ndpi_strnstr((const char *)packet->payload, "d1:ad2:id20:", packet->payload_packet_len)
           || ndpi_strnstr((const char *)packet->payload, ":find_node1:", packet->payload_packet_len)
           || ndpi_strnstr((const char *)packet->payload, ":get_peers1:", packet->payload_packet_len)
           || ndpi_strnstr((const char *)packet->payload, ":announce_peer1:", packet->payload_packet_len)
           || ndpi_strnstr((const char *)packet->payload, ":info_hash20:", packet->payload_packet_len)
           || ndpi_strnstr((const char *)packet->payload, ":target20:", packet->payload_packet_len)
           || ndpi_strnstr((const char *)packet->payload, "d1:rd2:id20:", packet->payload_packet_len)
           || ndpi_strnstr((const char *)packet->payload, ":filter64", packet->payload_packet_len)
           ) {
          goto bittorrent_found;
        }
      }