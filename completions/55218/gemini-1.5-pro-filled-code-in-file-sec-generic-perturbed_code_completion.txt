if(packet->payload_packet_len > 19 &&
	 (memcmp(packet->payload, bt_search, 19) == 0 ||
	  memcmp(packet->payload, bt_search1, 12) == 0)) {
	NDPI_LOG_INFO(detectionmodule, "found BT: UDP bt-search\n");
	ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 1, NDPI_CONFIDENCE_DPI);
	return;
      }

      if(packet->payload[0] == 0x00 || packet->payload[0] == 0x01 || packet->payload[0] == 0x02 || packet->payload[0] == 0x03) {
	if(packet->payload[0] == 0) {
	  if(packet->payload_packet_len < 2) {
	    ndpi_skip_bittorrent(detectionmodule, flow, packet);
	    return;
	  }
	  if(packet->payload[1] != 0x00) {
	    ndpi_skip_bittorrent(detectionmodule, flow, packet);
	    return;
	  }
	}
	if(packet->payload_packet_len > 27 && memcmp(&packet->payload[1], BITTORRENT_PROTO_STRING, 19) == 0)
	  goto bittorrent_found;
      }

      if(is_utpv1_pkt(packet->payload, packet->payload_packet_len)) {
	if(packet->payload_packet_len > 27 && memcmp(&packet->payload[1], BITTORRENT_PROTO_STRING, 19) == 0)
	  goto bittorrent_found;

	if(packet->payload_packet_len > 27 && memcmp(&packet->payload[20], "\x00\x00\x04\x17\x27\x10\x19\x80", 8) == 0) {
	  NDPI_LOG_INFO(detectionmodule, "found BT: uTP DHT\n");
	  ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	  return;
	}
      } else if(packet->payload_packet_len > 2 && packet->payload[0] == 0x13) {
	if(packet->payload_packet_len > 27 && memcmp(&packet->payload[1], BITTORRENT_PROTO_STRING, 19) == 0)
	  goto bittorrent_found;
      } else if(packet->payload_packet_len > 2 && packet->payload[0] == 0x04 && packet->payload[1] == 0x17 && packet->payload[2] == 0x27 && packet->payload[3] == 0x10 && packet->payload[4] == 0x19 && packet->payload[5] == 0x80) {
	NDPI_LOG_INFO(detectionmodule, "found BT: UDP DHT\n");
	ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	return;
      }