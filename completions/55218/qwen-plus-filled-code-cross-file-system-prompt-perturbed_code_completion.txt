if (packet->payload_packet_len >= 20 && packet->payload[0] == 0x13) {
  /* Check for uTP BitTorrent protocol */
  if (memcmp(packet->payload, "\x13BitTorrent protocol", 20) == 0) {
    NDPI_LOG_INFO(detectionmodule, "found BT: uTP\n");
    ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
    return;
  }
}

/* Check for DHT search strings */
if (packet->payload_packet_len > strlen(bt_search)) {
  if (ndpi_strnstr((const char *)packet->payload, bt_search, packet->payload_packet_len) != NULL ||
      ndpi_strnstr((const char *)packet->payload, bt_search1, packet->payload_packet_len) != NULL) {
    goto bittorrent_found;
  }
}

/* Additional heuristic checks */
if (packet->payload_packet_len >= 68) {
  u_int8_t *payload_ptr = packet->payload;

  /* Check for specific byte patterns in the payload */
  if ((payload_ptr[0] == 0x00 && payload_ptr[1] == 0x00 && payload_ptr[2] == 0x00 && payload_ptr[3] == 0x00 &&
       payload_ptr[4] == 0x00 && payload_ptr[5] == 0x10 && payload_ptr[6] == 0x00 && payload_ptr[7] == 0x00) ||
      (payload_ptr[8] == 0x00 && payload_ptr[9] == 0x00 && payload_ptr[10] == 0x00 && payload_ptr[11] == 0x01)) {
    goto bittorrent_found;
  }
}