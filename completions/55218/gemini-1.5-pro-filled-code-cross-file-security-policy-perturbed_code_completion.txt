if (packet->payload_packet_len > 35 && ndpi_strnstr((const char *)packet->payload, bt_search, packet->payload_packet_len)) {
	NDPI_LOG_INFO(detectionmodule, "found BT-SEARCH\n");
	ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	return;
      }

      if (packet->payload_packet_len > 22 && ndpi_strnstr((const char *)packet->payload, bt_search1, packet->payload_packet_len)) {
	NDPI_LOG_INFO(detectionmodule, "found BT-d1:ad2:id20:\n");
	ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	return;
      }

      /* Protocol v0. */
      if (packet->payload_packet_len > 67 && packet->payload[0] == 0x13 && packet->payload[1] == 'B' &&
	  packet->payload[2] == 'i' && packet->payload[3] == 't' && packet->payload[4] == 'T' &&
	  packet->payload[5] == 'o' && packet->payload[6] == 'r' && packet->payload[7] == 'r' &&
	  packet->payload[8] == 'e' && packet->payload[9] == 'n' && packet->payload[10] == 't' &&
	  packet->payload[11] == ' ' && packet->payload[12] == 'p' && packet->payload[13] == 'r' &&
	  packet->payload[14] == 'o' && packet->payload[15] == 't' && packet->payload[16] == 'o' &&
	  packet->payload[17] == 'c' && packet->payload[18] == 'o' && packet->payload[19] == 'l') {
	goto bittorrent_found;
      }

      /* uTP */
      if (packet->payload_packet_len > 217 && packet->payload[0] == 0x00 && packet->payload[1] == 0x00 &&
          packet->payload[2] == 0x04 && packet->payload[3] == 0x17 && packet->payload[4] == 0x27 &&
          packet->payload[5] == 0x10 && packet->payload[6] == 0x19 && packet->payload[7] == 0x80 &&
	  ndpi_strnstr((const char *)packet->payload, BITTORRENT_PROTO_STRING, packet->payload_packet_len)) {
	goto bittorrent_found;
      }

      /*
       * Heuristics to find bittorrent connection.
       * by Vincent Damiens <vincent.damiens@gmail.com>
       */
      if (packet->payload_packet_len > 219 && packet->payload[0] == 0x00 && packet->payload[1] == 0x00 &&
	  packet->payload[2] == 0x04 && packet->payload[3] == 0x17 && packet->payload[4] == 0x27 &&
	  packet->payload[5] == 0x10 && packet->payload[6] == 0x19 && packet->payload[7] == 0x80 &&
	  packet->payload[20] == 0x3f && packet->payload[21] == 0x3f && packet->payload[22] == 0x00 &&
	  packet->payload[23] == 0x00 && packet->payload[24] == 0x00 && packet->payload[25] == 0x00 &&
	  packet->payload[26] == 0x00 && packet->payload[27] == 0x00 && packet->payload[28] == 0x10 &&
	  packet->payload[29] == 0x00 && packet->payload[30] == 0x01 && packet->payload[31] == 0x00 &&
	  packet->payload[32] == 0x00 && packet->payload[33] == 0x00 && packet->payload[34] == 0x00 &&
	  packet->payload[35] == 0x00 && packet->payload[36] == 0x00 && packet->payload[37] == 0x00 &&
	  packet->payload[38] == 0x00 && packet->payload[39] == 0x00 && packet->payload[40] == 0x00 &&
	  packet->payload[41] == 0x00 && packet->payload[42] == 0x00 && packet->payload[43] == 0x00 &&
	  packet->payload[44] == 0x00 && packet->payload[45] == 0x00 && packet->payload[46] == 0x00 &&
	  packet->payload[47] == 0x00 && packet->payload[48] == 0x00 && packet->payload[49] == 0x00 &&
	  packet->payload[50] == 0x00 && packet->payload[51] == 0x00 && packet->payload[52] == 0x00 &&
	  packet->payload[53] == 0x00 && packet->payload[54] == 0x00 && packet->payload[55] == 0x00 &&
	  packet->payload[56] == 0x00 && packet->payload[57] == 0x00 && packet->payload[58] == 0x00 &&
	  packet->payload[59] == 0x00 && packet->payload[60] == 0x00 && packet->payload[61] == 0x00 &&
	  packet->payload[62] == 0x00 && packet->payload[63] == 0x00 && packet->payload[64] == 0x00 &&
	  packet->payload[65] == 0x00 && packet->payload[66] == 0x00 && packet->payload[67] == 0x00) {
	goto bittorrent_found;
      }