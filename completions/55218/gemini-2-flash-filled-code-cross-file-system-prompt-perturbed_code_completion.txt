if(packet->payload_packet_len > 12) {
	if(memcmp(packet->payload, bt_search, MIN(packet->payload_packet_len, strlen(bt_search))) == 0) {
	  NDPI_LOG_INFO(detectionmodule, "found BT: BT-SEARCH\n");
	  ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	  return;
	} else if(memcmp(packet->payload, bt_search1, MIN(packet->payload_packet_len, strlen(bt_search1))) == 0) {
	  NDPI_LOG_INFO(detectionmodule, "found BT: d1:ad2:id20:\n");
	  ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	  return;
	} else if((packet->payload[0] == 0x01) && (packet->payload[3] == 0xfa)) { /* Protocol v0 */
	  u_int16_t connection_id = ntohs(*((u_int16_t *)&packet->payload[1]));
	  u_int8_t  message_type  = packet->payload[0];
	  u_int8_t  version       = packet->payload[2];

	  if((connection_id > 0) && (connection_id < 0x4000) && (message_type == 0x01) && (version == 0x00)) {
	    NDPI_LOG_INFO(detectionmodule, "found BT: uTP v0\n");
	    ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	    return;
	  }
	} else if(packet->payload_packet_len > 4 &&
		  memcmp(packet->payload, "\x00\x00\x00\x00", 4) != 0 &&
		  ndpi_strnstr((const char *)packet->payload, "BitTorrent protocol", packet->payload_packet_len)) {
	  goto bittorrent_found;
	} else if(packet->payload_packet_len > 10 &&
		  (packet->payload[0] & 0xF0) == 0x20 && /* BEP 5 UDP Tracker Protocol */
		  (packet->payload[8] == 0x01 || packet->payload[8] == 0x02)) {
	  /*
	   * Offset 0: Transaction ID (4 bytes)
	   * Offset 4: Action (4 bytes)
	   * Offset 8: Action = 1 for connect, 2 for announce
	   */
	  NDPI_LOG_INFO(detectionmodule, "found BT: BEP 5 UDP Tracker Protocol\n");
	  ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	  return;
	}
      }