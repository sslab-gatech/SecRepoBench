if (packet->payload_packet_len > 15 && ndpi_strnstr((const char *)packet->payload, bt_search, packet->payload_packet_len)) {
	NDPI_LOG_INFO(detectionmodule, "found BT-SEARCH\n");
	ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	return;
      }

      if (packet->payload_packet_len > 15 && ndpi_strnstr((const char *)packet->payload, bt_search1, packet->payload_packet_len)) {
	NDPI_LOG_INFO(detectionmodule, "found BT-d1:ad2:id20:\n");
	ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	return;
      }

      /*
       * Protocol v0
       */
      if (packet->payload_packet_len > 4 && packet->payload[0] == 0x00 && packet->payload[1] == 0x00 && packet->payload[2] == 0x04 &&
	  packet->payload[3] == 0x17 && packet->payload[4] == 0x27 && packet->payload[5] == 0x10 && packet->payload[6] == 0x19 &&
	  packet->payload[7] == 0x80) {
	NDPI_LOG_INFO(detectionmodule, "found bittorrent v0\n");
	ndpi_add_connection_as_bittorrent(detectionmodule, flow, -1, 0, NDPI_CONFIDENCE_DPI);
	return;
      }

      /* Check for uTP http://www.bittorrent.org/beps/bep_0029.html */
      if (packet->payload_packet_len > 2 && packet->payload[0] == 0x00 && packet->payload[1] == 0x00) {
	if (packet->payload_packet_len > 20 && ndpi_strnstr((const char *)&packet->payload[2], BITTORRENT_PROTO_STRING, packet->payload_packet_len - 2)) {
	  goto bittorrent_found;
	}

	if (packet->payload_packet_len > 2 && packet->payload[0] == 0 && packet->payload[1] == 0) {
	  /*
	   *  Heuristics to find bittorrent over uTP
	   */
	  if (packet->payload_packet_len > 4 && packet->payload[2] == 0x00 && packet->payload[3] == 0x01) {
	    if (packet->payload_packet_len > 6 && packet->payload[4] == 0x00 && packet->payload[5] == 0x00 && packet->payload[6] == 0x00 &&
		packet->payload[7] == 0x00) {
	      goto bittorrent_found;
	    }
	  }
	}
      }