// Calculate MP3 frame size from header
size = gf_mp3_frame_size(ctx->hdr);

// Check if we have enough data to read the full frame
if (!size || (offsetskipped + size > remain)) {
    if (!pck) break; // If end of stream, just break
    if (ctx->is_sync) {
        GF_LOG(GF_LOG_WARNING, GF_LOG_MEDIA, ("[MP3Dmx] Invalid frame size %d or not enough data (remain %d) - resyncing\n", size, remain-offsetskipped));
        ctx->is_sync = GF_FALSE;
    }
    bytes_to_drop = 1;
    goto drop_byte;
}

// Check for ID3v1 tag ("TAG") - 128 bytes long, follows this frame
if ((offsetskipped + size + 3 <= remain) && (sync[size] == 'T') && (sync[size+1] == 'A') && (sync[size+2] == 'G')) {
    skip_id3v1 = GF_TRUE;
}
// Check if the next frame has a valid sync pattern to validate this frame
else if ((offsetskipped + size + 2 <= remain) && ((sync[size] != 0xFF) || ((sync[size+1] & 0xF0) != 0xF0))) {
    if (ctx->is_sync) {
        GF_LOG(GF_LOG_WARNING, GF_LOG_MEDIA, ("[MP3Dmx] Invalid next frame sync %02X-%02X, resyncing\n", sync[size], sync[size+1]));
        ctx->is_sync = GF_FALSE;
    }
    bytes_to_drop = 1;
    goto drop_byte;
}