size = gf_mp3_frame_size(ctx->hdr);
if (remain < size + 1) {
    // Not enough data to check next byte, wait for more
    break;
}

if (sync[size] == 0xFF) {
    // Next frame starts with sync word, packet is ready
    break;
}

if (remain >= size + 3 && sync[size] == 'T' && sync[size+1] == 'A' && sync[size+2] == 'G') {
    // ID3v1 tag detected, skip it
    skip_id3v1 = GF_TRUE;
    break;
}

// Invalid frame, try to resync
GF_LOG(GF_LOG_WARNING, GF_LOG_MEDIA, ("[MP3Dmx] Invalid frame at offset %d, trying to resync\n", (u32)(sync - ctx->mp3_buffer)));
bytes_to_drop = 1;
continue;