if (iterator.is_null()) {
      starting_glyph_index = 0;
      class_value_length = 0;
      return true;
    }

    auto it = hb_iter (iterator);
    glyph_count = it.end() - it.begin();
    starting_glyph_index = it.begin().glyph_index();
    if (unlikely (!c->extend_min (glyph_count))) return false;

    if (!c->serialize (class_value, glyph_count)) return false;

    for (auto it = hb_iter (iterator); it != hb_iter_end (iterator); ++it) {
      it->set_class (it->glyph_index() - starting_glyph_index);
    }

    return true;