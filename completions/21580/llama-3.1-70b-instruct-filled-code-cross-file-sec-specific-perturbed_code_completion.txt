if (unlikely (!iterator)) {
  if (unlikely (!c->extend_min (0))) return_trace (false);
  if (unlikely (!c->extend_min (0))) return_trace (false);
  return_trace (true);
}

hb_codepoint_t min_glyph = iterator->first;
hb_codepoint_t max_glyph = min_glyph;
for (; iterator; ++iterator) {
  if (min_glyph > iterator->first) min_glyph = iterator->first;
  if (max_glyph < iterator->first) max_glyph = iterator->first;
}

unsigned int glyph_count = max_glyph - min_glyph + 1;
if (unlikely (!c->extend_min (min_glyph))) return_trace (false);
if (unlikely (!c->extend_min (glyph_count))) return_trace (false);

hb_codepoint_t *class_values = c->allocate_size<hb_codepoint_t> (glyph_count);
if (unlikely (!class_values)) return_trace (false);

for (unsigned int i = 0; i < glyph_count; i++)
  class_values[i] = 0;

for (Iterator it = iterator; it; ++it)
  class_values[it->first - min_glyph] = it->second;

if (unlikely (!c->embed (class_values, glyph_count))) return_trace (false);

return_trace (true);