if (unlikely (!it))
{
  classValue.len = 0;
  return_trace (true);
}

hb_codepoint_t min_gid = HB_SET_VALUE_INVALID;
hb_codepoint_t max_gid = 0;
for (const auto gid_klass_pair : it)
{
  hb_codepoint_t gid = gid_klass_pair.first;
  if (min_gid == HB_SET_VALUE_INVALID || gid < min_gid)
    min_gid = gid;
  if (gid > max_gid)
    max_gid = gid;
}

startGlyph = min_gid;
classValue.len = max_gid - min_gid + 1;
if (unlikely (!c->allocate_size<HBUINT16> (classValue.get_size ())))
  return_trace (false);

unsigned int i = 0;
for (const auto gid_klass_pair : it)
{
  hb_codepoint_t gid = gid_klass_pair.first;
  unsigned int klass = gid_klass_pair.second;
  classValue[gid - startGlyph] = klass;
  i++;
}

return_trace (true);