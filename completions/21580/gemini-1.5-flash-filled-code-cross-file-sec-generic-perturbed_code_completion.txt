if (unlikely (!iterator)) {
      if (unlikely (!c->extend (0))) return_trace (false);
      return_trace (true);
    }

    hb_codepoint_t min_glyph_index = iterator.min_glyph_index ();
    hb_codepoint_t max_glyph_index = iterator.max_glyph_index ();
    unsigned glyph_count = max_glyph_index - min_glyph_index + 1;

    if (unlikely (!c->extend (glyph_count))) return_trace (false);

    if (unlikely (!c->serialize (glyph_count))) return_trace (false);

    for (hb_codepoint_t glyph_index = min_glyph_index; glyph_index <= max_glyph_index; ++glyph_index) {
      hb_codepoint_t class_value = iterator.get_class_value (glyph_index);
      if (unlikely (!c->serialize (class_value))) return_trace (false);
    }

    return_trace (true);