if (!iterator)
{
  this->start_glyph_index = 0;
  this->class_values_length = 0;
  return_trace(true);
}

hb_codepoint_t min_glyph = HB_CODEPOINT_MAX;
hb_codepoint_t max_glyph = 0;

// Determine min and max glyph indices
{
  auto it = iterator;
  for (; it; ++it)
  {
    hb_codepoint_t g = it->first;
    if (g < min_glyph) min_glyph = g;
    if (g > max_glyph) max_glyph = g;
  }
}

// If no glyphs were found, set everything to zero
if (min_glyph == HB_CODEPOINT_MAX)
{
  this->start_glyph_index = 0;
  this->class_values_length = 0;
  return_trace(true);
}

// Calculate glyph count
unsigned glyph_count = max_glyph - min_glyph + 1;
this->start_glyph_index = min_glyph;
this->class_values_length = glyph_count;

// Serialize the class values
if (unlikely (!serialize (c, glyph_count)))
  return_trace(false);

// Assign class values for each glyph
{
  auto it = iterator;
  for (; it; ++it)
  {
    arrayZ[it->first - min_glyph] = it->second;
  }
}

return_trace(true);