if (iterator.is_null())
    {
      c->set_starting_glyph_index(0);
      c->set_class_value_length(0);
      return_trace(true);
    }

    hb_codepoint_t min_glyph = iterator.min_glyph();
    hb_codepoint_t max_glyph = iterator.max_glyph();
    unsigned int glyph_count = max_glyph - min_glyph + 1;

    c->set_starting_glyph_index(min_glyph);

    if (unlikely (!c->serialize_class_value(glyph_count)))
      return_trace(false);

    for (auto pair : iterator)
    {
      hb_codepoint_t glyph_index = pair.first - min_glyph;
      c->assign_class_value(glyph_index, pair.second);
    }

    return_trace(true);