if (unlikely (!iterator)) {
      if (unlikely (!c->extend_min (*this))) return_trace (false);
      return_trace (true);
    }

    hb_codepoint_t min_glyph_index = iterator.min_glyph_index ();
    hb_codepoint_t max_glyph_index = iterator.max_glyph_index ();
    unsigned glyph_count = max_glyph_index - min_glyph_index + 1;

    if (unlikely (!c->extend_min (*this, glyph_count))) return_trace (false);

    hb_codepoint_t start_glyph_index = min_glyph_index;

    if (unlikely (!c->serialize_class_value (glyph_count))) return_trace (false);

    for (unsigned i = 0; i < glyph_count; ++i) {
      hb_codepoint_t glyph_index = start_glyph_index + i;
      hb_codepoint_t class_value = iterator[glyph_index];
      if (unlikely (!c->assign_class_value (glyph_index, class_value))) return_trace (false);
    }

    return_trace (true);