if (!iterator) {
      startGlyphIndex = 0;
      classValueLen = 0;
      return_trace (true);
    }

    hb_codepoint_t min_glyph = HB_SET_VALUE_INVALID;
    hb_codepoint_t max_glyph = HB_SET_VALUE_INVALID;
    for (auto g : +iterator) {
      hb_codepoint_t glyph = g.first;
      if (min_glyph == HB_SET_VALUE_INVALID || glyph < min_glyph)
        min_glyph = glyph;
      if (max_glyph == HB_SET_VALUE_INVALID || glyph > max_glyph)
        max_glyph = glyph;
    }

    if (min_glyph == HB_SET_VALUE_INVALID) {
      startGlyphIndex = 0;
      classValueLen = 0;
      return_trace (true);
    }

    startGlyphIndex = min_glyph;
    unsigned glyph_count = max_glyph - min_glyph + 1;
    if (!classValue.serialize (c, glyph_count)) return_trace (false);

    for (auto g : +iterator) {
      hb_codepoint_t glyph = g.first;
      unsigned idx = glyph - startGlyphIndex;
      classValue[idx] = g.second;
    }

    return_trace (true);