if (!iterator) {
      startGlyphIndex = 0;
      classValueLen = 0;
      return_trace (true);
    }

    hb_codepoint_t min_glyph = HB_SET_VALUE_INVALID;
    hb_codepoint_t max_glyph = HB_SET_VALUE_INVALID;
    for (auto g : +iterator) {
      if (g.first < min_glyph || min_glyph == HB_SET_VALUE_INVALID)
        min_glyph = g.first;
      if (g.first > max_glyph || max_glyph == HB_SET_VALUE_INVALID)
        max_glyph = g.first;
    }

    if (min_glyph == HB_SET_VALUE_INVALID || max_glyph == HB_SET_VALUE_INVALID)
      return_trace (false);

    unsigned glyphCount = max_glyph - min_glyph + 1;
    startGlyphIndex = min_glyph;

    if (!classValue.serialize (c, glyphCount))
      return_trace (false);

    for (auto g : +iterator) {
      unsigned idx = g.first - min_glyph;
      classValue[idx] = g.second;
    }

    return_trace (true);