if (!iterator) {
  if (unlikely (!c->extend_min (2))) return_trace (false);
  c->serializer->embed_uint16 (0);
  c->serializer->embed_uint16 (0);
  return_trace (true);
}

hb_codepoint_t min_glyph = iterator->first;
hb_codepoint_t max_glyph = min_glyph;
for (; iterator; ++iterator) {
  if (min_glyph > iterator->first) min_glyph = iterator->first;
  if (max_glyph < iterator->first) max_glyph = iterator->first;
}

unsigned int glyph_count = max_glyph - min_glyph + 1;
if (unlikely (!c->extend_min (2 + glyph_count))) return_trace (false);
c->serializer->embed_uint16 (min_glyph);
c->serializer->embed_uint16 (glyph_count);

for (hb_codepoint_t glyph = min_glyph; glyph <= max_glyph; glyph++) {
  c->serializer->embed_uint16 (0);
}

for (iterator = iterator.begin(); iterator; ++iterator) {
  c->serializer->embed_uint16_at (iterator->first - min_glyph, iterator->second);
}

return_trace (true);