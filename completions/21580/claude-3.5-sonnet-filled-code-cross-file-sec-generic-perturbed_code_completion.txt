if (!iterator)
{
  startGlyphID = 0;
  classValueArray.len = 0;
  return_trace (true);
}

hb_codepoint_t minGlyphID = HB_SET_VALUE_INVALID;
hb_codepoint_t maxGlyphID = 0;
for (auto it = iterator; it; it++)
{
  hb_codepoint_t glyphID = (*it).first;
  minGlyphID = hb_min (minGlyphID, glyphID);
  maxGlyphID = hb_max (maxGlyphID, glyphID);
}

startGlyphID = minGlyphID;
unsigned int glyphCount = maxGlyphID - minGlyphID + 1;

if (unlikely (!classValueArray.serialize (c, glyphCount)))
  return_trace (false);

for (auto it = iterator; it; it++)
{
  hb_codepoint_t glyphID = (*it).first;
  HBUINT8 classValue = (*it).second;
  unsigned int index = glyphID - minGlyphID;
  classValueArray[index] = classValue;
}

return_trace (true);