if (iterator == nullptr) {
      c->set_starting_glyph_index(0);
      c->set_class_value_length(0);
      return true;
    }

    unsigned int min_glyph_index = UINT_MAX;
    unsigned int max_glyph_index = 0;

    for (auto it = iterator.begin(); it != iterator.end(); ++it) {
      unsigned int glyph_index = it->first;
      if (glyph_index < min_glyph_index) min_glyph_index = glyph_index;
      if (glyph_index > max_glyph_index) max_glyph_index = glyph_index;
    }

    unsigned int glyph_count = max_glyph_index - min_glyph_index + 1;
    c->set_starting_glyph_index(min_glyph_index);

    if (!c->serialize_class_value(glyph_count)) return false;

    for (auto it = iterator.begin(); it != iterator.end(); ++it) {
      unsigned int glyph_index = it->first;
      unsigned int class_value = it->second;
      c->assign_class_value(glyph_index - min_glyph_index, class_value);
    }

    return true;