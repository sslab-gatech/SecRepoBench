// If the iterator is null, set the starting glyph index and class value length to zero, and return true.
if (unlikely (iterator == nullptr))
{
  c->start_glyph_index = 0;
  c->class_values_length = 0;
  return_trace (true);
}

// Determine the minimum and maximum glyph indices from the iterator to calculate the glyph count.
hb_codepoint_t min_glyph = HB_SET_VALUE_INVALID;
hb_codepoint_t max_glyph = 0;
for (hb_codepoint_t glyph : iterator)
{
  if (min_glyph == HB_SET_VALUE_INVALID || glyph < min_glyph)
    min_glyph = glyph;
  if (glyph > max_glyph)
    max_glyph = glyph;
}
unsigned glyph_count = max_glyph - min_glyph + 1;

// Set the starting glyph index to the minimum glyph index.
c->start_glyph_index = min_glyph;

// Serialize the class value using the serialization context and the calculated glyph count.
if (unlikely (!c->allocate_size<HBUINT16> (glyph_count)))
  return_trace (false);
for (hb_codepoint_t glyph : iterator)
{
  c->embed<HBUINT16> (glyph - min_glyph);
}
c->class_values_length = glyph_count;

// Iterate over the glyph-class pairs in the iterator, and assign the class value to each glyph index relative to the starting glyph index.
return_trace (true);