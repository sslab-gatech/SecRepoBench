if (!iterator) {
      c->start_glyph_index = 0;
      c->class_value_length = 0;
      return true;
    }

    hb_codepoint_t min_glyph = HB_CODEPOINT_MAX;
    hb_codepoint_t max_glyph = HB_CODEPOINT_MIN;

    for (auto it = iterator; it; ++it) {
      hb_codepoint_t glyph = it->first;
      if (glyph < min_glyph) min_glyph = glyph;
      if (glyph > max_glyph) max_glyph = glyph;
    }

    unsigned glyph_count = max_glyph - min_glyph + 1;
    c->start_glyph_index = min_glyph;

    if (unlikely(!c->serialize_class_value(glyph_count))) return false;

    for (auto it = iterator; it; ++it) {
      hb_codepoint_t glyph = it->first;
      unsigned class_value = it->second;
      c->assign_class_value(glyph - min_glyph, class_value);
    }

    return true;