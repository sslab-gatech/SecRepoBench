if (!iterator)
{
  this->start_glyph_index = 0;
  this->class_value_length = 0;
  return_trace(true);
}

hb_codepoint_t min_g = UINT_MAX;
hb_codepoint_t max_g = 0;
{
  auto it_copy = iterator;
  for (; it_copy; ++it_copy)
  {
    if (it_copy->glyph < min_g) min_g = it_copy->glyph;
    if (it_copy->glyph > max_g) max_g = it_copy->glyph;
  }
}

if (min_g > max_g)
{
  this->start_glyph_index = 0;
  this->class_value_length = 0;
  return_trace(true);
}

this->start_glyph_index = min_g;
unsigned glyph_count = max_g - min_g + 1;
this->class_value_length = glyph_count;

if (unlikely(!serialize(c, glyph_count))) return_trace(false);

for (auto it_copy = iterator; it_copy; ++it_copy)
{
  unsigned offset = it_copy->glyph - min_g;
  if (offset < glyph_count)
    arrayZ[offset] = it_copy->class_value;
}

return_trace(true);