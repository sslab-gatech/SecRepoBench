if (unlikely (!iterator))
    {
      startGlyph = 0;
      classValue.len = 0;
      return true;
    }

    hb_codepoint_t glyph_min = + iterator | hb_map (hb_first) | hb_reduce (hb_min, HB_SET_VALUE_INVALID);
    hb_codepoint_t glyph_max = + iterator | hb_map (hb_first) | hb_reduce (hb_max, 0u);

    unsigned int glyph_count = glyph_max - glyph_min + 1;
    startGlyph = glyph_min;

    if (unlikely (!classValue.serialize (c, glyph_count)))
      return false;

    for (const auto &pair : iterator)
    {
      hb_codepoint_t glyph = pair.first;
      unsigned int klass = pair.second;
      classValue[glyph - startGlyph] = klass;
    }

    return true;