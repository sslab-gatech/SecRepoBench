if (unlikely (!iterator))
{
  startGlyph = 0;
  classValue.len = 0;
  return_trace(true);
}

// Determine the minimum and maximum glyph indices
hb_codepoint_t min_gid = (*iterator).first;
hb_codepoint_t max_gid = min_gid;

{
  auto it_copy = iterator;
  for (; it_copy; ++it_copy)
  {
    const auto &pair = *it_copy;
    if (pair.first < min_gid) min_gid = pair.first;
    if (pair.first > max_gid) max_gid = pair.first;
  }
}

startGlyph = min_gid;
unsigned int count = max_gid - min_gid + 1;
if (unlikely (!classValue.serialize (c, count))) return_trace (false);

// Initialize class values to zero
for (unsigned int i = 0; i < count; i++)
  classValue[i] = 0;

// Assign class values from iterator
for (auto it_copy = iterator; it_copy; ++it_copy)
{
  const auto &pair = *it_copy;
  classValue[pair.first - min_gid] = pair.second;
}

return_trace(true);