if (!iterator) {
  startGlyphIndex = 0;
  classValueLength = 0;
  return true;
}

hb_codepoint_t minGlyphIndex = iterator.get_min_glyph();
hb_codepoint_t maxGlyphIndex = iterator.get_max_glyph();
unsigned int glyphCount = (maxGlyphIndex - minGlyphIndex) + 1;
startGlyphIndex = minGlyphIndex;

if (unlikely (!c->allocate_size(glyphCount * sizeof(ClassValue)))) return false;

ClassValue *classValues = c->allocate_array<ClassValue>(glyphCount);
if (unlikely (!classValues)) return false;

while (iterator.has_next()) {
  hb_codepoint_t glyphIndex;
  uint16_t classValue;
  iterator.next(&glyphIndex, &classValue);
  if (glyphIndex >= minGlyphIndex && glyphIndex <= maxGlyphIndex) {
    classValues[glyphIndex - minGlyphIndex] = classValue;
  }
}

return true;