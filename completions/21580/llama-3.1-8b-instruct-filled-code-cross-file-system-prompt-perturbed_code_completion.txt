bool serialize (hb_serialize_context_t *c,
                  Iterator iterator)
  {
    TRACE_SERIALIZE (this);
    if (unlikely (!c->extend_min (*this))) return_trace (false);

    if (iterator == nullptr) {
      c->set_starting_glyph_index(0);
      c->set_class_value_length(0);
      return true;
    }

    uint32_t min_glyph_index = iterator->get_min_glyph_index();
    uint32_t max_glyph_index = iterator->get_max_glyph_index();
    uint32_t glyph_count = max_glyph_index - min_glyph_index + 1;

    c->set_starting_glyph_index(min_glyph_index);
    c->serialize_class_value(c->get_serialization_context(), glyph_count);

    for (uint32_t i = 0; i < glyph_count; ++i) {
      uint32_t glyph_index = c->get_starting_glyph_index() + i;
      iterator->assign_class_value(glyph_index);
    }

    return true;
}