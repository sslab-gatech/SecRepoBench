// If the iterator is null, set the starting glyph index and class value length to zero, and return true.
if (!iterator) {
  starting_glyph_index = 0;
  class_value_length = 0;
  return true;
}

// Determine the minimum and maximum glyph indices from the iterator to calculate the glyph count.
hb_codepoint_t min_glyph_index = iterator->min_glyph_index();
hb_codepoint_t max_glyph_index = iterator->max_glyph_index();
glyph_count = max_glyph_index - min_glyph_index + 1;

// Set the starting glyph index to the minimum glyph index.
starting_glyph_index = min_glyph_index;

// Serialize the class value using the serialization context and the calculated glyph count.
if (!c->extend_min(class_value)) return_trace(false);
if (!c->extend_max(class_value, glyph_count)) return_trace(false);

// Iterate over the glyph-class pairs in the iterator, and assign the class value to each glyph index relative to the starting glyph index.
for (hb_codepoint_t i = 0; i < glyph_count; i++) {
  hb_codepoint_t glyph_index = starting_glyph_index + i;
  if (!c->extend_min(class_value[glyph_index])) return_trace(false);
}

return_trace(true);