if (unlikely (!iterator)) {
      if (unlikely (!c->extend (0))) return_trace (false);
      return_trace (true);
    }

    hb_codepoint_t min_glyph_index = iterator.min_glyph_index ();
    hb_codepoint_t max_glyph_index = iterator.max_glyph_index ();
    unsigned glyph_count = max_glyph_index - min_glyph_index + 1;

    if (unlikely (!c->extend (glyph_count))) return_trace (false);

    unsigned class_value_size = iterator.class_value_size ();
    if (unlikely (!c->extend (class_value_size))) return_trace (false);

    c->align (sizeof (unsigned));
    c->write (min_glyph_index);
    c->write (glyph_count);
    c->write (class_value_size);


    for (unsigned i = 0; i < glyph_count; ++i) {
      hb_codepoint_t glyph_index = min_glyph_index + i;
      unsigned class_value = iterator[glyph_index];
      c->write (class_value);
    }

    return_trace (true);