if (iterator.is_null())
    {
      start_glyph_index = 0;
      class_value_length = 0;
      return_trace(true);
    }

    hb_codepoint_t min_glyph = HB_SET_VALUE_INVALID, max_glyph = HB_SET_VALUE_INVALID;
    for (auto it = iterator; it; ++it)
    {
      hb_codepoint_t glyph = it->first;
      if (min_glyph == HB_SET_VALUE_INVALID || glyph < min_glyph)
        min_glyph = glyph;
      if (max_glyph == HB_SET_VALUE_INVALID || glyph > max_glyph)
        max_glyph = glyph;
    }

    if (min_glyph == HB_SET_VALUE_INVALID || max_glyph == HB_SET_VALUE_INVALID)
      return_trace(false);

    start_glyph_index = min_glyph;
    unsigned glyph_count = max_glyph - min_glyph + 1;

    if (unlikely(!c->serialize(glyph_count)))
      return_trace(false);

    for (auto it = iterator; it; ++it)
    {
      hb_codepoint_t glyph = it->first;
      unsigned class_value = it->second;
      c->assign(glyph - start_glyph_index, class_value);
    }

    return_trace(true);