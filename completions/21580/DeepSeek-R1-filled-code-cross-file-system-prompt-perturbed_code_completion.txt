if (iterator.is_empty ())
{
  startGlyphIndex = 0;
  classValueCount = 0;
  return_trace (true);
}

hb_codepoint_t min_glyph = HB_SET_VALUE_INVALID;
hb_codepoint_t max_glyph = HB_SET_VALUE_INVALID;
hb_vector_t<hb_pair_t<hb_codepoint_t, HBUINT16>> pairs;

for (const auto& pair : iterator)
{
  pairs.push (pair);
  hb_codepoint_t g = pair.first;
  if (g < min_glyph || min_glyph == HB_SET_VALUE_INVALID)
    min_glyph = g;
  if (g > max_glyph || max_glyph == HB_SET_VALUE_INVALID)
    max_glyph = g;
}

if (min_glyph == HB_SET_VALUE_INVALID)
{
  startGlyphIndex = 0;
  classValueCount = 0;
  return_trace (true);
}

unsigned glyph_count = max_glyph - min_glyph + 1;
startGlyphIndex = min_glyph;

if (unlikely (!classValue.serialize (c, glyph_count))) return_trace (false);

for (unsigned i = 0; i < glyph_count; i++)
  classValue[i] = 0;

for (const auto& pair : pairs)
{
  unsigned idx = pair.first - min_glyph;
  classValue[idx] = pair.second;
}

return_trace (true);