template<typename Iterator,
	 hb_requires (hb_is_iterator (Iterator))>
bool serialize (hb_serialize_context_t *c,
                Iterator iterator)
{
    TRACE_SERIALIZE (this);
    if (unlikely (!c->extend_min (*this))) return_trace (false);

    // If the iterator is null, set the starting glyph index and class value length to zero, and return true.
    if (!iterator)
    {
        startGlyph = 0;
        classValue.len = 0;
        return_trace (true);
    }

    // Determine the minimum and maximum glyph indices from the iterator to calculate the glyph count.
    hb_codepoint_t min_gid = (*iterator).first;
    hb_codepoint_t max_gid = min_gid;
    for (const auto gid_klass_pair : iterator)
    {
        if (gid_klass_pair.first < min_gid) min_gid = gid_klass_pair.first;
        if (gid_klass_pair.first > max_gid) max_gid = gid_klass_pair.first;
    }
    unsigned int glyph_count = max_gid - min_gid + 1;

    // Set the starting glyph index to the minimum glyph index.
    startGlyph = min_gid;

    // Serialize the class value using the serialization context and the calculated glyph count.
    if (unlikely (!classValue.serialize (c, glyph_count))) return_trace (false);

    // Iterate over the glyph-class pairs in the iterator, and assign the class value to each glyph index relative to the starting glyph index.
    for (const auto gid_klass_pair : iterator)
    {
        classValue[gid_klass_pair.first - min_gid] = gid_klass_pair.second;
    }

    return_trace (true);
}