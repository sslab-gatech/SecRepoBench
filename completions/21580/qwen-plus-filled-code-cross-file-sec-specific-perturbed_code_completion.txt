if (!iterator) {
  starting_glyph_index = 0;
  class_value_length = 0;
  return_trace (true);
}

hb_codepoint_t min_glyph, max_glyph;
if (!iterator->get_range(&min_glyph, &max_glyph)) return_trace (false);

unsigned int glyph_count = (max_glyph - min_glyph) + 1;
starting_glyph_index = min_glyph;

if (unlikely (!c->allocate_size (sizeof (ClassValue) + glyph_count * sizeof (GlyphID)))) return_trace (false);

ClassValue *class_value = c->allocate_type<ClassValue>();
class_value->glyph_count = glyph_count;

GlyphID *glyph_array = class_value->glyphs;

for (auto pair : iterator) {
  hb_codepoint_t glyph_index = pair.glyph - starting_glyph_index;
  if (glyph_index < glyph_count)
    glyph_array[glyph_index] = pair.class_value;
}

return_trace (true);