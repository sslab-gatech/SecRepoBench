if (!iterator) {
  startGlyph = 0;
  classValue.len = 0;
  return_trace (true);
}

// Determine the minimum and maximum glyph indices
hb_codepoint_t start = + iterator
                      | hb_map(hb_first)
                      | hb_reduce(hb_min, HB_CODEPOINT_MAX);

hb_codepoint_t end = + iterator
                    | hb_map(hb_first)
                    | hb_reduce(hb_max, 0u);

// Set the starting glyph index to the minimum glyph index.
startGlyph = start;

// Calculate the glyph count and allocate the array
unsigned int glyph_count = end - start + 1;
if (unlikely (!classValue.serialize (c, glyph_count))) return_trace (false);

// Initialize all class values to 0
for (unsigned int i = 0; i < glyph_count; i++)
  classValue[i] = 0;

// Assign class values
for (const auto item : iterator) {
  unsigned int index = item.first - start;
  classValue[index] = item.second;
}

return_trace (true);