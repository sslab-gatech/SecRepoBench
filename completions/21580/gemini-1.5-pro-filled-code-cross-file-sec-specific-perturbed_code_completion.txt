if (!iterator.init)
    {
      DEBUG_MSG (SUBSET, this, "Serializing null iterator");

      if (unlikely (!c->extend_min (2))) return_trace (false);
      c->add_u16 (0); /* start */
      c->add_u16 (0); /* count */
      return_trace (true);
    }

    unsigned int min_glyph = iterator.first_glyph ();
    unsigned int max_glyph = min_glyph;
    while (iterator.move_to_next ())
    {
      unsigned this_glyph = iterator.current_glyph ();
      if (this_glyph < min_glyph) min_glyph = this_glyph;
      if (this_glyph > max_glyph) max_glyph = this_glyph;
    }

    unsigned count = max_glyph - min_glyph + 1;

    DEBUG_MSG (SUBSET, this, "Serializing iterator, start %u count %u", min_glyph, count);

    if (unlikely (!c->extend_min (2 + count))) return_trace (false);

    c->add_u16 (min_glyph);
    c->add_u16 (count);

    unsigned int last_glyph = min_glyph - 1;
    unsigned int last_class = 0;
    iterator.reset ();
    do
    {
      unsigned int this_glyph = iterator.current_glyph ();
      unsigned int this_class = iterator.current_class ();

      if (this_glyph > last_glyph + 1)
      {
        unsigned int zeros = this_glyph - last_glyph - 1;
        memset (c->allocate_size<unsigned char> (zeros), last_class, zeros);
      }

      if (this_glyph > last_glyph)
      {
        c->add_u8 (this_class);
        last_glyph = this_glyph;
        last_class = this_class;
      }
    } while (iterator.move_to_next ());

    if (last_glyph < max_glyph)
    {
      memset (c->allocate_size<unsigned char> (max_glyph - last_glyph), last_class, max_glyph - last_glyph);
    }

    return_trace (true);