template<typename Iterator>
static inline void
Coverage_serialize (hb_serialize_context_t *c,
                    Iterator it)
{
  if (unlikely (!c->extend_min (*this))) return_trace (false);

  unsigned count = 0;
  unsigned num_ranges = 0;
  hb_codepoint_t last = (hb_codepoint_t) -2;
  for (auto g: glyphs)
  {
    if (last + 1!= g)
      num_ranges++;
    last = g;
    count++;
  }

  if (unlikely (!rangeRecord.serialize (c, num_ranges))) return_trace (false);

  unsigned range = (unsigned) -1;
  last = (hb_codepoint_t) -2;
  for (auto g: glyphs)
  {
    if (last + 1!= g)
    {
      range++;
      rangeRecord[range].first = g;
      rangeRecord[range].value = count;
    }
    rangeRecord[range].last = g;
    last = g;
    count++;
  }

  return_trace (true);
}