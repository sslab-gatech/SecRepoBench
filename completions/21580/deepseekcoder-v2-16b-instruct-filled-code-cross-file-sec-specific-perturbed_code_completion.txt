if (iterator == nullptr) {
        c->set_start_glyph_index(0);
        c->set_class_value_length(0);
        return true;
    }

    hb_codepoint_t min_glyph_index = std::numeric_limits<hb_codepoint_t>::max();
    hb_codepoint_t max_glyph_index = std::numeric_limits<hb_codepoint_t>::min();

    for (const auto& pair : iterator) {
        min_glyph_index = std::min(min_glyph_index, pair.first);
        max_glyph_index = std::max(max_glyph_index, pair.first);
    }

    c->set_start_glyph_index(min_glyph_index);

    unsigned glyph_count = max_glyph_index - min_glyph_index + 1;
    if (unlikely (!c->serialize_class_value(glyph_count))) return_trace(false);

    for (const auto& pair : iterator) {
        hb_codepoint_t glyph_index = pair.first - min_glyph_index;
        if (unlikely (!c->serialize_class_value(pair.second, glyph_index))) return_trace(false);
    }

    return true;