bool serialize (hb_serialize_context_t *c,
                  Iterator iterator)
  {
    TRACE_SERIALIZE (this);
    if (unlikely (!c->extend_min (*this))) return_trace (false);

    // If the iterator is null, set the starting glyph index and class value length to zero, and return true.
    if (iterator.is_null ())
    {
      COUNT *dest = c->allocate_min<COUNT> ();
      if (unlikely (dest == nullptr)) return_trace (false);
      *dest = 0;
      return_trace (true);
    }

    // Determine the minimum and maximum glyph indices from the iterator to calculate the glyph count.
    // Set the starting glyph index to the minimum glyph index.
    // Serialize the class value using the serialization context and the calculated glyph count.
    // Iterate over the glyph-class pairs in the iterator, and assign the class value to each glyph index relative to the starting glyph index.
    // Return true to indicate successful serialization.
    else
    {
      unsigned int min_glyph_index = iterator.min_glyph_index ();
      unsigned int max_glyph_index = iterator.max_glyph_index ();
      unsigned int glyph_count = max_glyph_index - min_glyph_index + 1;

      // Set the starting glyph index
      COUNT *start_glyph_index = c->allocate_min<COUNT> ();
      if (unlikely (start_glyph_index == nullptr)) return_trace (false);
      *start_glyph_index = min_glyph_index;

      // Serialize the class value using the serialization context and the calculated glyph count
      if (unlikely (!c->extend_min (*this))) return_trace (false);
      if (unlikely (!c->check_assign (glyph_count, iterator.len ()))) return_trace (false);

      // Iterate over the glyph-class pairs in the iterator, and assign the class value to each glyph index relative to the starting glyph index
      for (const auto& pair : iterator)
      {
        unsigned int glyph_index = pair.first;
        unsigned int class_value = pair.second;
        unsigned int relative_glyph_index = glyph_index - min_glyph_index;

        // Assign the class value to each glyph index relative to the starting glyph index
        if (unlikely (!c->check_assign (class_value, relative_glyph_index))) return_trace (false);
      }
    }

    return_trace (true);
  }