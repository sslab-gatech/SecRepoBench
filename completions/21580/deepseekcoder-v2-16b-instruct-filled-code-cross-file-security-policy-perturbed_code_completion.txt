if (iterator.is_null ()) {
      c->set_start_glyph_index (0);
      c->set_class_value_length (0);
      return true;
    }

    hb_codepoint_t min_glyph_index = iterator.min_glyph_index ();
    hb_codepoint_t max_glyph_index = iterator.max_glyph_index ();
    unsigned glyph_count = max_glyph_index - min_glyph_index + 1;

    c->set_start_glyph_index (min_glyph_index);

    if (!c->serialize (class_value, glyph_count)) return false;

    for (const auto& pair : iterator) {
      hb_codepoint_t glyph_index = pair.first;
      hb_codepoint_t class_value = pair.second;
      c->set_class_value_at_index (class_value, glyph_index - min_glyph_index);
    }

    return true;