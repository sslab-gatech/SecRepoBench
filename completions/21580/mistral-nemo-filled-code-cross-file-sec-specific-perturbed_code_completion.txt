if (!iterator) {
      c->start_glyph_index = 0;
      c->class_value_length = 0;
      return true;
    }

    hb_codepoint_t min_glyph = HB_CODEPOINT_MAX;
    hb_codepoint_t max_glyph = HB_CODEPOINT_MIN;

    for (auto it = iterator.begin(); it != iterator.end(); ++it) {
      hb_codepoint_t glyph = it->first;
      min_glyph = std::min(min_glyph, glyph);
      max_glyph = std::max(max_glyph, glyph);
    }

    c->start_glyph_index = min_glyph;
    c->glyph_count = max_glyph - min_glyph + 1;

    if (!c->serialize_class_value(c, c->glyph_count)) return false;

    for (auto it = iterator.begin(); it != iterator.end(); ++it) {
      hb_codepoint_t glyph = it->first;
      hb_codepoint_t class_value = it->second;
      c->assign_class_value(glyph - c->start_glyph_index, class_value);
    }

    return true;