if (!iterator)
{
  startGlyph = 0;
  classValue.len = 0;
  return_trace (true);
}

hb_codepoint_t minGlyph = HB_SET_VALUE_INVALID;
hb_codepoint_t maxGlyph = 0;

for (const auto& pair : iterator)
{
  hb_codepoint_t glyph = pair.first;
  if (minGlyph == HB_SET_VALUE_INVALID || glyph < minGlyph)
    minGlyph = glyph;
  if (glyph > maxGlyph)
    maxGlyph = glyph;
}

if (minGlyph == HB_SET_VALUE_INVALID)
{
  startGlyph = 0;
  classValue.len = 0;
  return_trace (true);
}

unsigned glyphCount = maxGlyph - minGlyph + 1;
startGlyph = minGlyph;

if (!classValue.serialize (c, glyphCount))
  return_trace (false);

for (const auto& pair : iterator)
{
  hb_codepoint_t glyph = pair.first;
  unsigned idx = glyph - startGlyph;
  classValue[idx] = pair.second;
}

return_trace (true);