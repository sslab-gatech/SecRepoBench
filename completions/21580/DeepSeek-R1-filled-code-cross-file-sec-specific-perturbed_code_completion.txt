if (iterator.is_empty())
    {
      this->starting_glyph = 0;
      this->classValue.len = 0;
      return_trace (true);
    }

    hb_codepoint_t min_glyph = HB_SET_VALUE_INVALID, max_glyph = HB_SET_VALUE_INVALID;
    for (const auto& pair : iterator)
    {
      hb_codepoint_t g = pair.glyph;
      if (g < min_glyph) min_glyph = g;
      if (g > max_glyph) max_glyph = g;
    }

    this->starting_glyph = min_glyph;
    unsigned glyph_count = max_glyph - min_glyph + 1;

    if (!this->classValue.serialize (c, glyph_count)) return_trace (false);

    for (const auto& pair : iterator)
    {
      unsigned idx = pair.glyph - this->starting_glyph;
      if (unlikely (idx >= glyph_count)) return_trace (false);
      this->classValue.arrayZ[idx] = pair.cls;
    }

    return_trace (true);