if (iterator.is_empty ())
    {
      startGlyphIndex = 0;
      classValueLen = 0;
      return_trace (true);
    }

    hb_codepoint_t min_glyph = HB_SET_VALUE_INVALID;
    hb_codepoint_t max_glyph = HB_SET_VALUE_INVALID;
    for (const auto& pair : iterator)
    {
      hb_codepoint_t g = pair.first;
      min_glyph = hb_min (g, min_glyph);
      max_glyph = hb_max (g, max_glyph);
    }

    if (min_glyph == HB_SET_VALUE_INVALID || max_glyph == HB_SET_VALUE_INVALID)
      return_trace (false);

    unsigned glyph_count = max_glyph - min_glyph + 1;
    startGlyphIndex = min_glyph;

    if (unlikely (!classValue.serialize (c, glyph_count)))
      return_trace (false);

    for (const auto& pair : iterator)
    {
      unsigned idx = pair.first - startGlyphIndex;
      if (unlikely (idx >= glyph_count))
        return_trace (false);
      classValue[idx] = pair.second;
    }

    return_trace (true);