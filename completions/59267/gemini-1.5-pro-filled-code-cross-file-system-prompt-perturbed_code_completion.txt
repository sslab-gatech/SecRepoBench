if (iSize < headerSize) return EXR_ERR_CORRUPT_CHUNK;

    memset (uncompressed_data, 0, uncompressed_size);

    for (int i = 0; i < NUM_SIZES_SINGLE; ++i)
    {
        counters[i] = one_from_native64 (*((uint64_t*) inPtr));
        inPtr += sizeof (uint64_t);
    }

    version                  = counters[VERSION];
    unknownUncompressedSize = counters[UNKNOWN_UNCOMPRESSED_SIZE];
    unknownCompressedSize   = counters[UNKNOWN_COMPRESSED_SIZE];
    acCompressedSize        = counters[AC_COMPRESSED_BYTES];
    dcCompressedBytes       = counters[DC_COMPRESSED_BYTES];
    rleCompressedSize       = counters[RLE_COMPRESSED_BYTES];
    rleUncompressedSize     = counters[RLE_UNCOMPRESSED_BYTES];
    rleRawSize              = counters[RLE_UNCOMPRESSED_RAW_BYTES];
    totalAcUncompressedCount = counters[TOTAL_AC_UNCOMPRESSED_COUNT];
    totalDcUncompressedCount = counters[TOTAL_DC_UNCOMPRESSED_COUNT];
    acCompression           = counters[AC_COMPRESSION];

    compressedSize = unknownCompressedSize + acCompressedSize +
                     dcCompressedBytes + rleCompressedSize;

    dataPtr  = inPtr;
    dataLeft = iSize - headerSize;

    if (dataLeft < compressedSize) { return EXR_ERR_CORRUPT_CHUNK; }

    if (version >= 2)
    {
        uint64_t nWritten = 0;
        uint64_t nAvail   = dataLeft;
        rv = DwaCompressor_readChannelRules (
            me, (uint8_t**) &dataPtr, nAvail, &nWritten);
        if (rv != EXR_ERR_SUCCESS) return rv;
        dataLeft -= nWritten;
        compressedSize -= nWritten;
    }

    outBufferSize = uncompressed_size;

    outBufferEnd = (uint8_t*) uncompressed_data;

    const uint8_t* compressedUnknownBuf = dataPtr;
    dataPtr += unknownCompressedSize;
    dataLeft -= unknownCompressedSize;

    const uint8_t* compressedAcBuf = dataPtr;
    dataPtr += acCompressedSize;
    dataLeft -= acCompressedSize;

    const uint8_t* compressedDcBuf = dataPtr;
    dataPtr += dcCompressedBytes;
    dataLeft -= dcCompressedBytes;

    const uint8_t* compressedRleBuf = dataPtr;
    dataPtr += rleCompressedSize;
    dataLeft -= rleCompressedSize;

    if (me->_packedAcBuffer)
        packedAcBufferEnd = me->_packedAcBuffer;
    else
        packedAcBufferEnd = NULL;

    if (me->_packedDcBuffer)
        packedDcBufferEnd = me->_packedDcBuffer;
    else
        packedDcBufferEnd = NULL;