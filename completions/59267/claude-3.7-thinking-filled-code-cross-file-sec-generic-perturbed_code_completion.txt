const uint8_t* compressedUnknownBuf = NULL;
const uint8_t* compressedAcBuf = NULL;
const uint8_t* compressedDcBuf = NULL;
const uint8_t* compressedRleBuf = NULL;

// Verify that the input size is adequate for the expected header size
if (iSize < headerSize)
    return EXR_ERR_CORRUPT_CHUNK;

// Initialize the uncompressed data buffer to zero
if (uncompressed_size > 0 && uncompressed_data)
    memset(uncompressed_data, 0, uncompressed_size);

// Copy header information into an array and convert from XDR format to native format
for (int i = 0; i < NUM_SIZES_SINGLE; ++i)
{
    counters[i] = one_to_native64(((const uint64_t*) inPtr)[i]);
}

// Extract various sizes and counters related to compression from the header
version = counters[VERSION];
unknownUncompressedSize = counters[UNKNOWN_UNCOMPRESSED_SIZE];
unknownCompressedSize = counters[UNKNOWN_COMPRESSED_SIZE];
acCompressedSize = counters[AC_COMPRESSED_SIZE];
dcCompressedBytes = counters[DC_COMPRESSED_SIZE];
rleCompressedSize = counters[RLE_COMPRESSED_SIZE];
rleUncompressedSize = counters[RLE_UNCOMPRESSED_SIZE];
rleRawSize = counters[RLE_RAW_SIZE];

totalAcUncompressedCount = counters[AC_UNCOMPRESSED_COUNT];
totalDcUncompressedCount = counters[DC_UNCOMPRESSED_COUNT];

acCompression = counters[AC_COMPRESSION];

// Calculate the total size of compressed data sections
compressedSize = unknownCompressedSize + acCompressedSize + dcCompressedBytes + rleCompressedSize;

// Adjust the data pointer to skip the header and calculate the remaining data size
dataPtr = inPtr + headerSize;
dataLeft = iSize - headerSize;

// Verify that compressed data sizes do not exceed the input size to prevent overflow
if (dataLeft < compressedSize)
    return EXR_ERR_CORRUPT_CHUNK;

// Initialize the output buffer
outBufferSize = uncompressed_size;
outBufferEnd = (uint8_t*) uncompressed_data;

// Determine buffer pointers for AC and DC data, if available
if (totalAcUncompressedCount > 0)
    packedAcBufferEnd = (uint8_t*) me->_packedAcBuffer;
else
    packedAcBufferEnd = NULL;

if (totalDcUncompressedCount > 0)
    packedDcBufferEnd = (uint8_t*) me->_packedDcBuffer;
else
    packedDcBufferEnd = NULL;

// Set pointers to the start of each compressed data section
compressedUnknownBuf = dataPtr;
compressedAcBuf = compressedUnknownBuf + unknownCompressedSize;
compressedDcBuf = compressedAcBuf + acCompressedSize;
compressedRleBuf = compressedDcBuf + dcCompressedBytes;