//
    // Copy header information into an array and convert it from XDR format to native format.
    //

    if (EXR_ERR_SUCCESS != exr_xdr_to_native (
                           me->_decode->context,
                           inPtr,
                           iSize,
                           header,
                           sizeof (header)))
    {
        return EXR_ERR_CORRUPT_CHUNK;
    }

    //
    // Extract various sizes and counters related to compression from the header information.
    //

    headerSize = header[0];
    version    = header[1];
    unknownUncompressedSize = header[2];
    unknownCompressedSize   = header[3];
    acCompressedSize        = header[4];
    dcCompressedBytes       = header[5];
    rleCompressedSize       = header[6];
    rleUncompressedSize     = header[7];
    rleRawSize              = header[8];
    totalAcUncompressedCount = header[9];
    totalDcUncompressedCount = header[10];
    acCompression           = header[11];

    //
    // Calculate the total size of compressed data sections.
    //

    compressedSize = unknownCompressedSize + acCompressedSize + dcCompressedBytes + rleCompressedSize;

    //
    // Adjust the data pointer to skip the header and calculate the remaining data size.
    //

    dataPtr   = inPtr + headerSize;
    dataLeft  = iSize - headerSize;

    //
    // Verify that compressed data sizes do not exceed the input size to prevent overflow.
    //

    if (unknownCompressedSize > dataLeft ||
        acCompressedSize > dataLeft ||
        dcCompressedBytes > dataLeft ||
        rleCompressedSize > dataLeft)
    {
        return EXR_ERR_CORRUPT_CHUNK;
    }

    //
    // Check version information to determine channel rules, updating them if necessary.
    //

    if (version > 2) { return EXR_ERR_BAD_CHUNK_LEADER; }

    rv = DwaCompressor_setupChannelData (me);

    //
    // Initialize buffers and allocate the output buffer for uncompressed data.
    //

    outBufferSize = me->_outBufferSize;
    outBufferEnd  = me->_outBuffer + outBufferSize;

    packedAcBufferEnd = me->_packedAcBuffer;
    packedDcBufferEnd = me->_packedDcBuffer;

    //
    // Set pointers to the start of each compressed data section: UNKNOWN, AC, DC, and RLE.
    //

    compressedUnknownBuf = dataPtr;
    compressedAcBuf     = compressedUnknownBuf + unknownCompressedSize;
    compressedDcBuf     = compressedAcBuf + acCompressedSize;
    compressedRleBuf    = compressedDcBuf + dcCompressedBytes;