char* endptr = nullptr;
const char* p = src;
for (int i = 0; i < len; ++i) {
  // parse the next number
  int val = strtol(p, &endptr, 10);

  // check range
  if (af != NULL && val >= DEFAULTFLAGS) {
    HUNSPELL_WARNING(stderr, "error: line %d: flag id %d is too large (max: %d)\n",
                     af->getlinenum(), val, DEFAULTFLAGS - 1);
    val = 0;
  }
  if (val == 0 && af != NULL) {
    HUNSPELL_WARNING(stderr, "error: line %d: 0 is wrong flag id\n",
                     af->getlinenum());
  }

  // store the flag
  *dest++ = static_cast<unsigned short>(val);

  // advance to next number if there is another comma
  if (*endptr == ',')
    ++endptr;
  p = endptr;
}