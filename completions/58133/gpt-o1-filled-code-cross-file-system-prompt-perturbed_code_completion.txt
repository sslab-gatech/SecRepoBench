{
    unsigned short* dest = *result;
    for (int i = 0; i < len; i++) {
        // Skip leading whitespace
        while (*src && isspace((unsigned char)*src)) {
            src++;
        }

        int val = atoi(src);

        if (val >= DEFAULTFLAGS && af != NULL) {
            HUNSPELL_WARNING(stderr,
                             "error: line %d: flag id %d is too large (max: %d)\n",
                             af->getlinenum(), val, DEFAULTFLAGS - 1);
            val = 0;
        }
        if (val == 0 && af != NULL) {
            HUNSPELL_WARNING(stderr,
                             "error: line %d: 0 is wrong flag id\n",
                             af->getlinenum());
        }

        dest[i] = (unsigned short)val;

        // Advance 'src' until the next comma or end of string
        while (*src && *src != ',') {
            src++;
        }
        // Skip comma if present
        if (*src == ',') {
            src++;
        }
    }
}