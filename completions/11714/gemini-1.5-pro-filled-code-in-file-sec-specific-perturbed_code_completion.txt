unsigned int numBlends = interp_env.pop_arg ().to_int ();
unsigned int valueIndex = interp_env.pop_arg ().to_int ();
unsigned int numValues = interp_env.pop_arg ().to_int ();

if (unlikely (!numValues || !numBlends || numBlends > CFF2_MAX_BLEND_STACK))
{
  interp_env.set_error ();
  return;
}

interp_env.process_blend ();
unsigned int region_count = interp_env.get_region_count ();

if (unlikely (numBlends > region_count))
{
  interp_env.set_error ();
  return;
}

BlendArg *blend_values = &interp_env.argStack[interp_env.argStack.len - numValues];
for (unsigned int i = 0; i < numValues; i++)
{
  if (blend_values[i].blending ())
  {
    interp_env.set_error ();
    return;
  }
  unsigned int n = numBlends;
  if (n > region_count)
    n = region_count;

  BlendArg blends[CFF2_MAX_BLEND_STACK];
  for (unsigned int j = 0; j < n; j++)
     blends[j] = interp_env.pop_arg ();

  blend_values[i].set_blends (numValues, i, n, blends);
}
interp_env.seen_blend = true;