xmlIDPtr existing_id = (xmlIDPtr) xmlHashLookup(table, value);
if (existing_id != NULL) {
    if (existing_id->attr == NULL || existing_id->attr == (xmlAttrPtr) doc) {
        // The existing ID is from streaming mode or has no associated attribute.
        // Associate the new attribute with the existing ID.
        existing_id->attr = attribute;
        attribute->atype = XML_ATTRIBUTE_ID;
        attribute->id = existing_id;
    } else {
        // The ID already exists and is associated with another attribute.
        // Update the attribute type to indicate it is an ID.
        attribute->atype = XML_ATTRIBUTE_ID;
    }
    if (id != NULL)
        *id = existing_id;
    return 0;
}