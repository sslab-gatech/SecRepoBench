xmlIDPtr existingID = xmlHashLookup(table, value);
        if (existingID != NULL) {
            if (existingID->attr != attribute) {
                /*
                 * ID already exists, update the attribute
                 * and attribute type.
                 */
                attribute->atype = XML_ATTRIBUTE_ID;
                if (!streaming)
                    attribute->id = existingID;
		/*
		 * if the existing ID was streamed, then existingID->name
		 * is in the dictionary, so we need to copy attribute->name
		 * into the dictionary too.
		 */
		if ((existingID->attr == NULL) && (doc->dict != NULL)) {
		    xmlDictAddString(doc->dict, attribute->name, -1);
		}
                if (id != NULL)
                    *id = existingID;
                return 0;
            } else {
                /*
                 * The attribute is already associated with this ID.
                 * This can happen when reparsing a document.
                 */
                if (id != NULL)
                    *id = existingID;
                return 0;
            }
        }