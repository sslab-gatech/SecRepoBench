// Close the file pointer if it is open.
// If there was an error, free the allocated chunk if necessary and return the error code.
// If successful, return the size of the lazy chunk.
if (fp!= NULL) {
  fclose(fp);
}
if (*needs_free) {
  free(*chunk);
}
return lazy_chunk_bytes;