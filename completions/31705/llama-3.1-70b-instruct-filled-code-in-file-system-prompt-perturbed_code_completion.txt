if (frame->cframe == NULL) {
  free(data_chunk);
  if (!frame->sframe) {
    fclose(fp);
  }
}
free(offsets);

if (acc_nbytes!= nbytes || acc_cbytes!= cbytes) {
  blosc2_schunk_free(schunk);
  return NULL;
}

out:
rc = frame_get_metalayers(frame, schunk);
if (rc < 0) {
  blosc2_schunk_free(schunk);
  BLOSC_TRACE_ERROR("Cannot access the metalayers.");
  return NULL;
}

rc = frame_get_vlmetalayers(frame, schunk);
if (rc < 0) {
  blosc2_schunk_free(schunk);
  BLOSC_TRACE_ERROR("Cannot access the vlmetalayers.");
  return NULL;
}

return schunk;