end:
    if (fp != NULL) {
        fclose(fp);
    }
    if (rc < 0) {
        if (*needs_free) {
            free(*chunk);
            *chunk = NULL;
            *needs_free = false;
        }
        return rc;
    }
    return lazy_chunk_bytes;