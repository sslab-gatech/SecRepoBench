// Close the file pointer if it is open.
if (fp!= NULL) {
  fclose(fp);
}

// If there was an error, free the allocated chunk if necessary and return the error code.
if (rc < 0) {
  if (*needs_free) {
    free(*chunk);
  }
  return rc;
}

// If successful, return the size of the lazy chunk.
return lazy_chunk_bytes;