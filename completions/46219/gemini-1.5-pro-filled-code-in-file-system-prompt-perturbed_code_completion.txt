{
  const StringInfo
    *profile;

  cmsHPROFILE
    icc_profile;

  iccProfileFlags
    flags;

  int
    num_channels;

  /*
    Retrieve the ICC profile from the image.
  */
  profile=GetImageProfile(image,"icc");
  if (profile == (StringInfo *) NULL)
    profile=GetImageProfile(image,"icm");
  if (profile == (StringInfo *) NULL)
    return((const char *) NULL);
  if (GetStringInfoLength(profile) < 128)
    return((const char *) NULL);
#if defined(MAGICKCORE_LCMS_DELEGATE)
  icc_profile=cmsOpenProfileFromMem(GetStringInfoDatum(profile),
    (cmsUInt32Number) GetStringInfoLength(profile));
  if (icc_profile != (cmsHPROFILE *) NULL)
    {
      char
        info[MagickPathExtent];

      /*
        Extract profile information.
      */
      flags=cmsGetProfileInfoASCII(icc_profile,cmsInfoDescription,"en","US",
        info,MagickPathExtent);
      if (flags != 0)
        (void) SetImageProperty((Image *) image,key,(const char *) info,
          exception_info);
      flags=cmsGetProfileInfoASCII(icc_profile,cmsInfoManufacturer,"en","US",
        info,MagickPathExtent);
      if (flags != 0)
        (void) SetImageProperty((Image *) image,"icc:manufacturer",(const char *)
          info,exception_info);
      flags=cmsGetProfileInfoASCII(icc_profile,cmsInfoModel,"en","US",info,
        MagickPathExtent);
      if (flags != 0)
        (void) SetImageProperty((Image *) image,"icc:model",(const char *) info,
          exception_info);
      flags=cmsGetProfileInfoASCII(icc_profile,cmsInfoCopyright,"en","US",info,
        MagickPathExtent);
      if (flags != 0)
        (void) SetImageProperty((Image *) image,"icc:copyright",(const char *)
          info,exception_info);
      num_channels=cmsGetColorSpace(icc_profile);
      if (num_channels != 0)
        {
          (void) FormatLocaleString(info,MagickPathExtent,"%d",num_channels);
          (void) SetImageProperty((Image *) image,"icc:colorspace",(const char *)
            info,exception_info);
        }
      (void) cmsCloseProfile(icc_profile);
    }
#endif
  return(GetImageProperty(image,key,exception_info));
}