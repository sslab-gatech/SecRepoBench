const StringInfo
  *profile;

const char
  *value;

profile=GetImageProfile(image,"icc");
if (profile == (StringInfo *) NULL)
  profile=GetImageProfile(image,"icm");
if (profile == (StringInfo *) NULL)
  return((const char *) NULL);

/* Check if the property is already set */
value=GetImageProperty(image,key,exception_info);
if (value != (const char *) NULL)
  return(value);

/* Check if profile length is adequate */
if (GetStringInfoLength(profile) < 128)
  return((const char *) NULL);

#if defined(MAGICKCORE_LCMS_DELEGATE)
{
  cmsHPROFILE
    icc_profile;

  char
    *name;

  const char
    *tag;

  /* Parse the key to get the tag name */
  if (LocaleNCompare(key,"icc:",4) == 0)
    tag=key+4;
  else
    tag=key+4;

  icc_profile=cmsOpenProfileFromMem(GetStringInfoDatum(profile),
    (cmsUInt32Number) GetStringInfoLength(profile));
  if (icc_profile == (cmsHPROFILE) NULL)
    return((const char *) NULL);

  name=(char *) NULL;
  if (LocaleCompare(tag,"description") == 0)
    {
      cmsUInt32Number
        bytes;

      bytes=cmsGetProfileInfoASCII(icc_profile,cmsInfoDescription,"en","US",NULL,0);
      if (bytes > 0)
        {
          name=(char *) AcquireQuantumMemory(bytes,sizeof(*name));
          if (name != (char *) NULL)
            (void) cmsGetProfileInfoASCII(icc_profile,cmsInfoDescription,"en",
              "US",name,bytes);
        }
    }
  else if (LocaleCompare(tag,"manufacturer") == 0)
    {
      cmsUInt32Number
        bytes;

      bytes=cmsGetProfileInfoASCII(icc_profile,cmsInfoManufacturer,"en","US",NULL,0);
      if (bytes > 0)
        {
          name=(char *) AcquireQuantumMemory(bytes,sizeof(*name));
          if (name != (char *) NULL)
            (void) cmsGetProfileInfoASCII(icc_profile,cmsInfoManufacturer,"en",
              "US",name,bytes);
        }
    }
  else if (LocaleCompare(tag,"model") == 0)
    {
      cmsUInt32Number
        bytes;

      bytes=cmsGetProfileInfoASCII(icc_profile,cmsInfoModel,"en","US",NULL,0);
      if (bytes > 0)
        {
          name=(char *) AcquireQuantumMemory(bytes,sizeof(*name));
          if (name != (char *) NULL)
            (void) cmsGetProfileInfoASCII(icc_profile,cmsInfoModel,"en",
              "US",name,bytes);
        }
    }
  else if (LocaleCompare(tag,"copyright") == 0)
    {
      cmsUInt32Number
        bytes;

      bytes=cmsGetProfileInfoASCII(icc_profile,cmsInfoCopyright,"en","US",NULL,0);
      if (bytes > 0)
        {
          name=(char *) AcquireQuantumMemory(bytes,sizeof(*name));
          if (name != (char *) NULL)
            (void) cmsGetProfileInfoASCII(icc_profile,cmsInfoCopyright,"en",
              "US",name,bytes);
        }
    }

  icc_profile=cmsCloseProfile(icc_profile);
  if (name != (char *) NULL)
    {
      (void) SetImageProperty((Image *) image,key,(const char *) name,
        exception_info);
      name=DestroyString(name);
      return(GetImageProperty(image,key,exception_info));
    }
}
#endif
return((const char *) NULL);