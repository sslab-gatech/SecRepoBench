static const char *GetICCProperty(const Image *image,const char *key,
  ExceptionInfo *exception_info)
{
  const StringInfo
    *profile;

  const char
    *property;

  /* First, check if the property already exists */
  property=GetImageProperty(image,key,exception_info);
  if (property != (const char *) NULL)
    return(property);

  /* Try to get the ICC profile */
  profile=GetImageProfile(image,"icc");
  if (profile == (StringInfo *) NULL)
    profile=GetImageProfile(image,"icm");
  if (profile == (StringInfo *) NULL)
    return((const char *) NULL);

  /* Ensure the profile has adequate length for processing */
  if (GetStringInfoLength(profile) < 16)
    return((const char *) NULL);

#if defined(MAGICKCORE_LCMS_DELEGATE)
  {
    cmsHPROFILE
      icc_profile;

    /* Open the ICC profile */
    icc_profile=cmsOpenProfileFromMem(GetStringInfoDatum(profile),
      (cmsUInt32Number) GetStringInfoLength(profile));
    if (icc_profile != (cmsHPROFILE) NULL)
      {
        char
          info[MagickPathExtent];

        /* Extract profile information based on the requested key */
        *info='\0';
#if defined(LCMS_VERSION) && (LCMS_VERSION < 2000)
        if (LocaleCompare("description",key) == 0)
          (void) CopyMagickString(info,cmsTakeProductDesc(icc_profile),
            MagickPathExtent);
        else if (LocaleCompare("manufacturer",key) == 0)
          (void) CopyMagickString(info,cmsTakeManufacturer(icc_profile),
            MagickPathExtent);
        else if (LocaleCompare("model",key) == 0)
          (void) CopyMagickString(info,cmsTakeModel(icc_profile),
            MagickPathExtent);
        else if (LocaleCompare("copyright",key) == 0)
          (void) CopyMagickString(info,cmsTakeCopyright(icc_profile),
            MagickPathExtent);
#else
        if (LocaleCompare("description",key) == 0)
          (void) cmsGetProfileInfoASCII(icc_profile,cmsInfoDescription,"en",
            "US",info,MagickPathExtent);
        else if (LocaleCompare("manufacturer",key) == 0)
          (void) cmsGetProfileInfoASCII(icc_profile,cmsInfoManufacturer,"en",
            "US",info,MagickPathExtent);
        else if (LocaleCompare("model",key) == 0)
          (void) cmsGetProfileInfoASCII(icc_profile,cmsInfoModel,"en",
            "US",info,MagickPathExtent);
        else if (LocaleCompare("copyright",key) == 0)
          (void) cmsGetProfileInfoASCII(icc_profile,cmsInfoCopyright,"en",
            "US",info,MagickPathExtent);
#endif
        (void) cmsCloseProfile(icc_profile);
        
        /* Set the property if information was found */
        if (*info != '\0')
          {
            (void) SetImageProperty((Image *) image,key,info,exception_info);
            return(GetImageProperty(image,key,exception_info));
          }
      }
  }
#endif
  return((const char *) NULL);
}