const char
  *icc_profile,
  *property_value;

size_t
  profile_length;

icc_profile = GetImageProfile(image, "icc", &profile_length, exception);
if (icc_profile == (const char *) NULL)
{
  icc_profile = GetImageProfile(image, "icm", &profile_length, exception);
  if (icc_profile == (const char *) NULL)
    return((const char *) NULL);
}

if (profile_length < 128)
{
  (void) ThrowMagickException(exception, GetMagickModule(), CorruptImageError,
    "ICCProfileIsIncomplete", image->filename);
  return((const char *) NULL);
}

#ifdef LCMS
cmsHPROFILE
  h_profile;

h_profile = cmsOpenProfileFromMem(const_cast<void *>(static_cast<const void *>(icc_profile)), profile_length);
if (h_profile == NULL)
{
  (void) ThrowMagickException(exception, GetMagickModule(), ResourceLimitError,
    "UnableToOpenICMProfile", image->filename);
  return((const char *) NULL);
}

char
  buffer[512];

memset(buffer, 0, sizeof(buffer));
cmsGetProfileInfo(h_profile, cmsInfoDescription, cmsAnyLanguage, cmsNoCountry, buffer, sizeof(buffer));
if (strlen(buffer) > 0)
{
  property_value = ConstantString(buffer);
  SetImageProperty(image, "icc:description", property_value);
  property_value = DestroyString(property_value);
}

memset(buffer, 0, sizeof(buffer));
cmsGetProfileInfo(h_profile, cmsInfoManufacturer, cmsAnyLanguage, cmsNoCountry, buffer, sizeof(buffer));
if (strlen(buffer) > 0)
{
  property_value = ConstantString(buffer);
  SetImageProperty(image, "icc:manufacturer", property_value);
  property_value = DestroyString(property_value);
}

memset(buffer, 0, sizeof(buffer));
cmsGetProfileInfo(h_profile, cmsInfoModel, cmsAnyLanguage, cmsNoCountry, buffer, sizeof(buffer));
if (strlen(buffer) > 0)
{
  property_value = ConstantString(buffer);
  SetImageProperty(image, "icc:model", property_value);
  property_value = DestroyString(property_value);
}

memset(buffer, 0, sizeof(buffer));
cmsGetProfileCopyright(h_profile, cmsAnyLanguage, cmsNoCountry, buffer, sizeof(buffer));
if (strlen(buffer) > 0)
{
  property_value = ConstantString(buffer);
  SetImageProperty(image, "icc:copyright", property_value);
  property_value = DestroyString(property_value);
}

cmsCloseProfile(h_profile);
#endif

return(GetImageProperty(image, key, exception));