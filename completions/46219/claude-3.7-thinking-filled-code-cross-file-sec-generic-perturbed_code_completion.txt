static const char *GetICCProperty(const Image *image,const char *key,
  ExceptionInfo *exception_info)
{
  const StringInfo
    *profile;
  
  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  
  /* Try to get the property directly if it exists already */
  if (GetImageProperty(image,key,exception_info) != (const char *) NULL)
    return(GetImageProperty(image,key,exception_info));

  /* First, try to get the ICC profile using "icc" or "icm" keys */
  profile=GetImageProfile(image,"icc");
  if (profile == (StringInfo *) NULL)
    profile=GetImageProfile(image,"icm");
  
  if (profile == (StringInfo *) NULL)
    return((const char *) NULL);  /* No ICC profile found */
  
  /* Check if the profile size is adequate for processing */
  if (GetStringInfoLength(profile) < 128)
    return((const char *) NULL);  /* Profile too small to be valid */
  
#if defined(MAGICKCORE_LCMS_DELEGATE)
  {
    cmsHPROFILE
      icc_profile;
    
    char
      info[MagickPathExtent];
    
    /* Open the ICC profile */
    icc_profile=cmsOpenProfileFromMem(GetStringInfoDatum(profile),
      (cmsUInt32Number) GetStringInfoLength(profile));
    if (icc_profile != (cmsHPROFILE) NULL)
      {
        /* Extract profile description */
        if (cmsGetProfileInfoASCII(icc_profile,cmsInfoDescription,"en","US",
              info,MagickPathExtent) > 0)
          (void) SetImageProperty((Image *) image,"icc:description",info,
            exception_info);
            
        /* Extract profile manufacturer */
        if (cmsGetProfileInfoASCII(icc_profile,cmsInfoManufacturer,"en","US",
              info,MagickPathExtent) > 0)
          (void) SetImageProperty((Image *) image,"icc:manufacturer",info,
            exception_info);
            
        /* Extract profile model */
        if (cmsGetProfileInfoASCII(icc_profile,cmsInfoModel,"en","US",
              info,MagickPathExtent) > 0)
          (void) SetImageProperty((Image *) image,"icc:model",info,
            exception_info);
            
        /* Extract profile copyright */
        if (cmsGetProfileInfoASCII(icc_profile,cmsInfoCopyright,"en","US",
              info,MagickPathExtent) > 0)
          (void) SetImageProperty((Image *) image,"icc:copyright",info,
            exception_info);
            
        /* Close the profile */
        cmsCloseProfile(icc_profile);
      }
  }
#endif
  
  /* Return the requested property */
  return(GetImageProperty(image,key,exception_info));
}