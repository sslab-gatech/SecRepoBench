const StringInfo
  *profile;

cmsHPROFILE
  icc_profile;

cmsMLU
  *description,
  *manufacturer,
  *model,
  *copyright;

profile=GetImageProfile(image,"icc");
if (profile == (StringInfo *) NULL)
  profile=GetImageProfile(image,"icm");
if (profile == (StringInfo *) NULL)
  return((const char *) NULL);
if (GetStringInfoLength(profile) < 128)
  return((const char *) NULL);  /* minimum ICC profile length */
#if defined(LCMS_VERSION)
/*
  Open the ICC profile and report some info.  If LCMS is not available, then
  we will simply report the profile as a blob.
*/
icc_profile=cmsOpenProfileFromMem(GetStringInfoDatum(profile),
  (cmsUInt32Number) GetStringInfoLength(profile));
if (icc_profile != (cmsHPROFILE *) NULL)
  {
    description=cmsReadTag(icc_profile,cmsSigProfileDescriptionTag);
    if (description != (cmsMLU *) NULL)
      {
        (void) SetImageProperty(image,"icc:description",cmsMLUgetASCII(
          description,cmsNoLanguage,cmsNoCountry,NULL),exception_info);
      }
    manufacturer=cmsReadTag(icc_profile,cmsSigDeviceMfgDescTag);
    if (manufacturer != (cmsMLU *) NULL)
      {
        (void) SetImageProperty(image,"icc:manufacturer",cmsMLUgetASCII(
          manufacturer,cmsNoLanguage,cmsNoCountry,NULL),exception_info);
      }
    model=cmsReadTag(icc_profile,cmsSigDeviceModelDescTag);
    if (model != (cmsMLU *) NULL)
      {
        (void) SetImageProperty(image,"icc:model",cmsMLUgetASCII(model,
          cmsNoLanguage,cmsNoCountry,NULL),exception_info);
      }
    copyright=cmsReadTag(icc_profile,cmsSigCopyrightTag);
    if (copyright != (cmsMLU *) NULL)
      {
        (void) SetImageProperty(image,"icc:copyright",cmsMLUgetASCII(copyright,
          cmsNoLanguage,cmsNoCountry,NULL),exception_info);
      }
    (void) cmsCloseProfile(icc_profile);
  }
#endif
/* Return the profile as a blob */
return((const char *) GetStringInfoDatum(profile));