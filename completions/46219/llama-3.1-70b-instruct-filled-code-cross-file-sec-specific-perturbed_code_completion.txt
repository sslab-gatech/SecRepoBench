const char *icc_profile = NULL;
const char *icc_key = NULL;

// Retrieve ICC profile from image
icc_profile = GetImageProperty(image, "icc", exception_info);
if (icc_profile == NULL)
  icc_profile = GetImageProperty(image, "icm", exception_info);

if (icc_profile!= NULL) {
  size_t icc_length = strlen(icc_profile);
  if (icc_length < 128) {
    // ICC profile length is inadequate for processing
    return NULL;
  }

  // Open ICC profile and extract profile information
  //...

  // Store profile information as properties in the image
  //...

  // Set ICC profile property
  icc_key = "icc-profile";
  SetImageProperty(image, icc_key, icc_profile, exception_info);
}

// Return ICC profile property
return GetImageProperty(image, icc_key, exception_info);