const char *icc_profile = NULL;
const char *icc_key = NULL;

// Check if the image is valid
if (image == (Image *) NULL)
{
    (void) ThrowMagickException(exception, GetMagickModule(), OptionWarning,
        "NoImageForProperty", "icc");
    return ((const char *) NULL);
}

// Attempt to get the ICC profile from the image using "icc" or "icm" profile keys
icc_profile = GetImageProperty(image, "icc", exception);
if (icc_profile == (const char *) NULL)
{
    icc_profile = GetImageProperty(image, "icm", exception);
}

// If the ICC profile is found, ensure the profile length is adequate for processing
if (icc_profile!= (const char *) NULL)
{
    size_t icc_length = strlen(icc_profile);
    if (icc_length < 128)
    {
        (void) ThrowMagickException(exception, GetMagickModule(), OptionWarning,
            "InsufficientICCProfile", "icc");
        return ((const char *) NULL);
    }
}

// If LCMS is defined, open the ICC profile and extract profile information
#ifdef LIBLCMS
cmsHPROFILE hProfile = cmsOpenProfileFromMem((cmsUInt8Number *)icc_profile, icc_length);
if (hProfile == (cmsHPROFILE)NULL)
{
    (void) ThrowMagickException(exception, GetMagickModule(), OptionWarning,
        "UnableToOpenICCProfile", "icc");
    return ((const char *) NULL);
}

// Extract profile information such as description, manufacturer, model, and copyright
cmsInfoType infoType = cmsInfoDescription;
char *icc_info = cmsTakeProductDesc(hProfile);
if (icc_info!= (char *)NULL)
{
    icc_key = "icc-description";
    SetImageProperty(image, icc_key, icc_info, exception);
    cmsFree(icc_info);
}

infoType = cmsInfoManufacturer;
icc_info = cmsTakeProductDesc(hProfile);
if (icc_info!= (char *)NULL)
{
    icc_key = "icc-manufacturer";
    SetImageProperty(image, icc_key, icc_info, exception);
    cmsFree(icc_info);
}

infoType = cmsInfoModel;
icc_info = cmsTakeProductDesc(hProfile);
if (icc_info!= (char *)NULL)
{
    icc_key = "icc-model";
    SetImageProperty(image, icc_key, icc_info, exception);
    cmsFree(icc_info);
}

infoType = cmsInfoCopyright;
icc_info = cmsTakeProductDesc(hProfile);
if (icc_info!= (char *)NULL)
{
    icc_key = "icc-copyright";
    SetImageProperty(image, icc_key, icc_info, exception);
    cmsFree(icc_info);
}

cmsCloseProfile(hProfile);
#endif

// Return the ICC profile property
if (key!= (const char *)NULL)
{
    return GetImageProperty(image, key, exception);
}
else
{
    return icc_profile;
}