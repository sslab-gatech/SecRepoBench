// Retrieve ICC profile properties from an image. First, attempt to get the
// ICC profile from the image using "icc" or "icm" profile keys. If found,
// ensure the profile length is adequate for processing. If LCMS is defined,
// open the ICC profile and extract profile information such as description,
// manufacturer, model, and copyright. Store these as properties in the image.
const char *icc_profile = GetImageProperty(image, "icc", exception);
if (icc_profile != NULL) {
    size_t icc_profile_length = strlen(icc_profile);
    if (icc_profile_length >= 128) {
#ifdef MAGICKCORE_LCMS_DELEGATE
        cmsHPROFILE icc_handle = cmsOpenProfileFromMem(icc_profile, icc_profile_length);
        if (icc_handle != NULL) {
            const char *description = cmsGetProfileInfoASCII(icc_handle, cmsInfoDescription, "en", "US", NULL);
            const char *manufacturer = cmsGetProfileInfoASCII(icc_handle, cmsInfoManufacturer, "en", "US", NULL);
            const char *model = cmsGetProfileInfoASCII(icc_handle, cmsInfoModel, "en", "US", NULL);
            const char *copyright = cmsGetProfileInfoASCII(icc_handle, cmsInfoCopyright, "en", "US", NULL);
            if (description != NULL) {
                (void)SetImageProperty(image, "icc:description", description);
            }
            if (manufacturer != NULL) {
                (void)SetImageProperty(image, "icc:manufacturer", manufacturer);
            }
            if (model != NULL) {
                (void)SetImageProperty(image, "icc:model", model);
            }
            if (copyright != NULL) {
                (void)SetImageProperty(image, "icc:copyright", copyright);
            }
            cmsCloseProfile(icc_handle);
        }
#endif
    }
}