length -= 8;
if (length > p->buf_size - i) {
    return 0; // Return 0 to indicate failure if the length exceeds the buffer size
}