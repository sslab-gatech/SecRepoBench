if (i + 8 > p->buf_size || length > p->buf_size - i - 8)
    return 0;
i += 8;