// Check the validity of the buffer.
        // If invalid, return 0 to indicate failure. 
        // Move the index past the header.
        if (length < 0 || i + length > p->buf_size) {
            return 0;
        }
        i += 8;