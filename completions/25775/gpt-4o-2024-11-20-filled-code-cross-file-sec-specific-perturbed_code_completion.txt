// Ensure we do not read out of bounds
        if (i + 8 > p->buf_size)
            return 0;

        // Validate the length field to prevent buffer over-read
        if (length < 8 || i + length > p->buf_size)
            return 0;

        i += 8;