if (p->buf_size < i + 8)
            return 0;
        if (length < 8)
            return 0;