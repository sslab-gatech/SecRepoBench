// Check the validity of the buffer.
// If invalid, return 0 to indicate failure. 
// Move the index past the header.
if (length < 8) {
    return 0;
}
length -= 8;