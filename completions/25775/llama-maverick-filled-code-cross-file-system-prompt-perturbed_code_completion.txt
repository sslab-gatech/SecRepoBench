if (length > p->buf_size - i - 8 || length < 0)
    return 0;
i += 8;