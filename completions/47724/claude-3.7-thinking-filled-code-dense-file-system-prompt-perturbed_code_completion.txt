case 'A':
  if(packet->line[i].len > 14 && strncasecmp((const char *)&packet->line[i].ptr[1], "uthorization:", 13) == 0) {
    /* Check for Basic Authentication which might expose credentials */
    const u_int8_t *auth_data = &packet->line[i].ptr[14];
    u_int16_t auth_data_len = packet->line[i].len - 14;
    
    while(auth_data_len > 0 && *auth_data == ' ') { auth_data++; auth_data_len--; }
    
    if(auth_data_len > 6 && strncasecmp((const char *)auth_data, "Basic ", 6) == 0) {
      char msg[256];
      snprintf(msg, sizeof(msg), "HTTP Basic authentication");
      ndpi_set_risk(ndpi_struct, ndpiflow, NDPI_CLEAR_TEXT_CREDENTIALS, msg);
      return;
    }
  }
  break;

case 'P':
  if(packet->line[i].len > 16 && strncasecmp((const char *)&packet->line[i].ptr[1], "roxy-Connection:", 16) == 0) {
    char msg[256];
    snprintf(msg, sizeof(msg), "HTTP Proxy-Connection header");
    ndpi_set_risk(ndpi_struct, ndpiflow, NDPI_SUSPICIOUS_HEADER, msg);
    return;
  }
  break;

case 'U':
  if(packet->line[i].len > 11 && strncasecmp((const char *)&packet->line[i].ptr[1], "ser-Agent:", 10) == 0) {
    /* Check for suspicious User-Agent strings */
    const u_int8_t *ua_data = &packet->line[i].ptr[11];
    u_int16_t ua_data_len = packet->line[i].len - 11;
    
    while(ua_data_len > 0 && *ua_data == ' ') { ua_data++; ua_data_len--; }
    
    if(ua_data_len > 4 && 
       (strncasecmp((const char *)ua_data, "curl", 4) == 0 ||
        strncasecmp((const char *)ua_data, "wget", 4) == 0 ||
        strncasecmp((const char *)ua_data, "python", 6) == 0)) {
      char msg[256];
      snprintf(msg, sizeof(msg), "Suspicious User-Agent (%.*s)", (int)ua_data_len, (char*)ua_data);
      ndpi_set_risk(ndpi_struct, ndpiflow, NDPI_SUSPICIOUS_HEADER, msg);
      return;
    }
  }
  break;

case 'X':
  if(packet->line[i].len > 15 && strncasecmp((const char *)&packet->line[i].ptr[1], "-Forwarded-For:", 15) == 0) {
    char msg[256];
    snprintf(msg, sizeof(msg), "HTTP X-Forwarded-For header");
    ndpi_set_risk(ndpi_struct, ndpiflow, NDPI_SUSPICIOUS_HEADER, msg);
    return;
  } else if(packet->line[i].len > 16 && strncasecmp((const char *)&packet->line[i].ptr[1], "-Requested-With:", 16) == 0) {
    char msg[256];
    snprintf(msg, sizeof(msg), "HTTP X-Requested-With header");
    ndpi_set_risk(ndpi_struct, ndpiflow, NDPI_SUSPICIOUS_HEADER, msg);
    return;
  }
  break;

default:
  /* No suspicious header found */
  break;