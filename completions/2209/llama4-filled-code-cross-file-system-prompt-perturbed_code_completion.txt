HEVCFrame *ref = find_ref_idx(s, pictureordercount);
if (ref == s->ref) {
    av_log(s->avctx, AV_LOG_ERROR, "Attempt to add duplicate reference\n");
    return AVERROR_INVALIDDATA;
}
if (!ref) {
    int nb_refs = ff_hevc_frame_nb_refs(s);
    if (nb_refs >= MAX_REFS) {
        av_log(s->avctx, AV_LOG_ERROR, "Overflow in add_candidate_ref\n");
        return AVERROR_INVALIDDATA;
    }
    ref = generate_missing_reference(s, pictureordercount);
    if (!ref)
        return AVERROR_INVALIDDATA;
}