HEVCFrame *ref;
int i;

ref = find_ref_idx(s, pictureordercount);
if (!ref) {
    return AVERROR_INVALIDDATA;
}

// Check if we already have this reference in the list
for (i = 0; i < list->nb_refs; i++) {
    if (list->list[i] == ref->poc) {
        return AVERROR_INVALIDDATA;  // Duplicate reference
    }
}