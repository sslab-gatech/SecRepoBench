HEVCFrame *ref = find_ref_idx(s, pictureordercount);
if (!ref) {
    // Attempt to generate a missing reference frame for the given POC.
    ref = generate_missing_ref(s, pictureordercount);
    if (!ref)
        return -1; // Error: unable to generate missing reference frame
}

if (list->nb_refs > 0 && list->list[list->nb_refs - 1] == ref->poc) {
    av_log(s->avctx, AV_LOG_ERROR, "Duplicate reference frame with POC %d\n", pictureordercount);
    return -1; // Error: duplicate reference frame
}