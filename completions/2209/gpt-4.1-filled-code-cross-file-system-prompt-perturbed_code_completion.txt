HEVCFrame *ref = find_ref_idx(s, pictureordercount);
if (!ref) {
    // Try to generate a missing reference frame for the given POC
    int ret = ff_hevc_generate_missing_ref(s, pictureordercount);
    if (ret < 0)
        return ret;
    ref = find_ref_idx(s, pictureordercount);
    if (!ref)
        return AVERROR_INVALIDDATA;
}

// Prevent adding duplicate or overflow
if (list->nb_refs >= HEVC_MAX_REFS)
    return AVERROR_INVALIDDATA;
for (int i = 0; i < list->nb_refs; i++) {
    if (list->ref[i] == ref)
        return AVERROR_INVALIDDATA;
}