HEVCFrame *ref = NULL;
int i;

// Search for a reference frame with the given POC in the DPB
for (i = 0; i < FF_ARRAY_ELEMS(s->DPB); i++) {
    if (s->DPB[i].poc == pictureordercount) {
        ref = &s->DPB[i];
        break;
    }
}

// If no reference is found, return an error
if (!ref)
    return AVERROR_INVALIDDATA;

// Prevent adding the same reference twice or if the list is full
if (ref == s->ref)
    return AVERROR_INVALIDDATA;