HEVCFrame *ref = find_ref_idx(s, pictureordercount);
if (!ref) {
    av_log(s->avctx, AV_LOG_ERROR, "No reference found for POC %d\n", pictureordercount);
    return AVERROR_INVALIDDATA;
}

if (list->nb_refs >= MAX_REF_PICS) {
    av_log(s->avctx, AV_LOG_ERROR, "Reference count overflow\n");
    return AVERROR_INVALIDDATA;
}

for (int i = 0; i < list->nb_refs; i++) {
    if (list->list[i] == ref->poc) {
        av_log(s->avctx, AV_LOG_ERROR, "Duplicate reference POC %d\n", ref->poc);
        return AVERROR_INVALIDDATA;
    }
}