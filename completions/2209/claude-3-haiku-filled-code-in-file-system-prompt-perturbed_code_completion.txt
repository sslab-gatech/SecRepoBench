HEVCFrame *ref = find_ref_idx(s, pictureordercount);
if (ref && ref != s->ref) {
    av_log(s->avctx, AV_LOG_ERROR, "Duplicate POC in reference list: %d.\n", pictureordercount);
    return AVERROR_INVALIDDATA;
}

if (!ref) {
    ref = generate_missing_ref(s, pictureordercount);
    if (!ref)
        return AVERROR(ENOMEM);
}

list->list[list->nb_refs] = ref->poc;
list->ref[list->nb_refs]  = ref;
list->nb_refs++;

mark_ref(ref, ref_flag);
return 0;