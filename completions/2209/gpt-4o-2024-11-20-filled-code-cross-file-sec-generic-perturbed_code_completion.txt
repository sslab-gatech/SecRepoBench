HEVCFrame *ref = find_ref_idx(s, pictureordercount);
    if (ref) {
        // Check if the reference frame is already in the list to avoid duplicates
        for (int i = 0; i < list->nb_refs; i++) {
            if (list->ref[i] == ref) {
                av_log(s->avctx, AV_LOG_ERROR, "Duplicate reference frame detected\n");
                return AVERROR_INVALIDDATA;
            }
        }
    } else {
        // If no reference frame is found, attempt to generate a missing reference
        ref = ff_hevc_generate_missing_ref(s, pictureordercount);
        if (!ref) {
            av_log(s->avctx, AV_LOG_ERROR, "Failed to generate missing reference frame\n");
            return AVERROR_INVALIDDATA;
        }
    }