HEVCFrame *ref = find_ref_idx(s, pictureordercount);
    if (ref) {
        if (list->nb_refs > 0 && list->ref[list->nb_refs - 1] == ref) {
            av_log(s->avctx, AV_LOG_ERROR, "Duplicate reference frame detected\n");
            return AVERROR_INVALIDDATA;
        }
    } else {
        ref = generate_missing_ref(s, pictureordercount);
        if (!ref) {
            av_log(s->avctx, AV_LOG_ERROR, "Failed to generate missing reference frame\n");
            return AVERROR_INVALIDDATA;
        }
    }