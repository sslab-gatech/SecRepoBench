RefPic *ref = NULL;
int i;

// Attempt to find a reference frame in the DPB with a given POC (picture order count).
for (i = 0; i < FF_ARRAY_ELEMS(s->DPB); i++) {
    if (s->DPB[i].poc == pictureordercount) {
        ref = &s->DPB[i];
        break;
    }
}

// If the found reference is the same as the current reference, 
// return an error to prevent adding a duplicate or overflow.
if (ref && ref == s->ref) {
    return -1;
}

// If no reference is found, attempt to generate a missing reference frame for the given POC.
if (!ref) {
    ref = generate_missing_ref(s, pictureordercount);
    if (!ref) {
        return -1;
    }
}