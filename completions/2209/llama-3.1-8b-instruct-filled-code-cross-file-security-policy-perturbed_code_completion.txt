// Attempt to find a reference frame in the DPB with a given POC (picture order count).
// If the found reference is the same as the current reference, 
// return an error to prevent adding a duplicate or overflow.
// If no reference is found, attempt to generate a missing reference frame for the given POC.
if (find_ref_idx(s, pictureordercount)) {
    if (find_ref_idx(s, pictureordercount) == ref) {
        av_log(s->avctx, AV_LOG_ERROR, "Duplicate reference frame found\n");
        return AVERROR_INVALIDDATA;
    }
    return 0;
}

// If no reference is found, attempt to generate a missing reference frame for the given POC.
if (pictureordercount < s->seq_decode->first_pic_num + s->seq_decode->num_poc_stamps) {
    av_log(s->avctx, AV_LOG_ERROR, "No reference frame found for POC %d\n", pictureordercount);
    return AVERROR_INVALIDDATA;
}

// Generate a missing reference frame for the given POC.
// This is a simplified example and may need to be adapted to your specific use case.
HEVCFrame *ref = av_malloc(sizeof(HEVCFrame));
ref->poc = pictureordercount;
ref->sequence = s->seq_decode;
// Initialize other fields as needed
list->list[list->nb_refs] = pictureordercount;
list->ref[list->nb_refs]  = ref;
list->nb_refs++;

mark_ref(ref, ref_flag);
return 0;