HEVCFrame *ref = find_ref_idx(s, pictureordercount);
if (ref) {
    int i;
    for (i = 0; i < list->nb_refs; i++) {
        if (list->ref[i] == ref) {
            av_log(s->avctx, AV_LOG_ERROR, "Duplicate reference frame (POC %d) detected\n", pictureordercount);
            return AVERROR_INVALIDDATA;
        }
    }
} else {
    ref = ff_hevc_generate_missing_ref(s, pictureordercount);
    if (!ref) {
        av_log(s->avctx, AV_LOG_ERROR, "Failed to generate missing reference frame for POC %d\n", pictureordercount);
        return AVERROR_INVALIDDATA;
    }
}