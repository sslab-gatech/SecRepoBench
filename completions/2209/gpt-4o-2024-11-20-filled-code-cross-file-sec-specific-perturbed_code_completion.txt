// Validate the input parameters
    if (!s || !list || list->nb_refs >= MAX_REFS) {
        av_log(s->avctx, AV_LOG_ERROR, "Invalid input or reference list overflow\n");
        return AVERROR_INVALIDDATA;
    }

    // Attempt to find the reference frame in the DPB
    HEVCFrame *ref = find_ref_idx(s, pictureordercount);
    if (!ref) {
        av_log(s->avctx, AV_LOG_ERROR, "Reference frame with POC %d not found\n", pictureordercount);
        return AVERROR_INVALIDDATA;
    }

    // Check for duplicate references
    for (int i = 0; i < list->nb_refs; i++) {
        if (list->ref[i] == ref) {
            av_log(s->avctx, AV_LOG_ERROR, "Duplicate reference frame detected\n");
            return AVERROR_INVALIDDATA;
        }
    }