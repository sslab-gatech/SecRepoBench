HEVCFrame *ref = find_ref_idx(s, pictureordercount);
if (!ref) {
    ref = generate_missing_ref(s, pictureordercount);
    if (!ref)
        return AVERROR(ENOMEM);
}

if (list->nb_refs >= HEVC_MAX_REFS) {
    av_log(s->avctx, AV_LOG_ERROR, "Too many references in the frame RPS.\n");
    return AVERROR_INVALIDDATA;
}

if (ref == s->ref) {
    av_log(s->avctx, AV_LOG_ERROR, "Invalid reference: same as current frame.\n");
    return AVERROR_INVALIDDATA;
}