HEVCFrame *ref = find_ref_idx(s, pictureordercount);
if (ref && ref == list->ref[list->nb_refs - 1]) {
    av_log(s->avctx, AV_LOG_ERROR, "Duplicate reference frame found\n");
    return AVERROR_INVALIDDATA;
}

if (!ref) {
    // Attempt to generate a missing reference frame for the given POC.
    ref = generate_missing_ref(s, pictureordercount);
    if (!ref) {
        av_log(s->avctx, AV_LOG_ERROR, "Failed to generate missing reference frame\n");
        return AVERROR_INVALIDDATA;
    }
}