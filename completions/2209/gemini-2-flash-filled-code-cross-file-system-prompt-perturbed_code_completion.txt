HEVCFrame *ref = find_ref_idx(s, pictureordercount);

    if (list->nb_refs && list->ref[list->nb_refs - 1] == ref) {
        av_log(s->avctx, AV_LOG_ERROR, "Trying to add the same ref %p twice\n", ref);
        return AVERROR_INVALIDDATA;
    }

    if (!ref) {
        if (s->avctx->err_recognition & AV_EF_TRY_REPAIR) {
            ref = ff_hevc_get_missing_frame(s, pictureordercount);
            if (!ref) {
                av_log(s->avctx, AV_LOG_ERROR, "Could not generate missing reference frame.\n");
                return AVERROR_INVALIDDATA;
            }
        } else {
            av_log(s->avctx, AV_LOG_ERROR, "Missing reference picture, POC %d\n",
                   pictureordercount);
            return AVERROR_INVALIDDATA;
        }
    }

    if (list->nb_refs >= MAX_REFS) {
        av_log(s->avctx, AV_LOG_ERROR, "Too many refs %d\n",
               list->nb_refs);
        return AVERROR_INVALIDDATA;
    }