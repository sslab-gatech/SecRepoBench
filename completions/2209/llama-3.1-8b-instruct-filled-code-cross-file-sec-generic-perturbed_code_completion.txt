// <MASK>
    HEVCFrame *ref = find_ref_idx(s, pictureordercount);
    if (ref && ref->poc == pictureordercount) {
        // If the found reference is the same as the current reference, 
        // return an error to prevent adding a duplicate or overflow.
        return AVERROR_INVALIDDATA;
    }

    if (!ref) {
        // If no reference is found, attempt to generate a missing reference frame for the given POC.
        // This is a simplified example and actual implementation may vary based on the specific requirements.
        // For simplicity, let's assume we are generating a reference frame with a random poc.
        ref = av_malloc(sizeof(HEVCFrame));
        ref->poc = pictureordercount;
        // Add the generated reference frame to the DPB.
        list->list[list->nb_refs] = ref->poc;
        list->ref[list->nb_refs]  = ref;
        list->nb_refs++;
    }

    mark_ref(ref, ref_flag);
    return 0;
// <MASK>