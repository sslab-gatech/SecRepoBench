// Attempt to find a reference frame in the DPB with a given POC (picture order count).
    // If the found reference is the same as the current reference, 
    // return an error to prevent adding a duplicate or overflow.
    // If no reference is found, attempt to generate a missing reference frame for the given POC.
    RefPicList *ref_list = ff_hevc_get_ref_list(s, s->ref, 0, 0);
    RefPicList *ref = ref_list;
    while (ref) {
        if (ref->poc == pictureordercount) {
            if (ref == s->ref) {
                return AVERROR_INVALIDDATA; // Duplicate reference
            }
            break;
        }
        ref = ref->next;
    }

    if (!ref) {
        // Attempt to generate a missing reference frame for the given POC.
        // This part of the code is not implemented here, as it depends on the specific implementation
        // of how to generate a missing reference frame.
        // For now, we assume that a missing reference frame can be generated and added.
        ref = generate_missing_reference_frame(s, pictureordercount);
        if (!ref) {
            return AVERROR_INVALIDDATA; // Failed to generate a missing reference frame
        }
    }

    list->list[list->nb_refs] = ref->poc;
    list->ref[list->nb_refs]  = ref;
    list->nb_refs++;

    mark_ref(ref, ref_flag);
    return 0;