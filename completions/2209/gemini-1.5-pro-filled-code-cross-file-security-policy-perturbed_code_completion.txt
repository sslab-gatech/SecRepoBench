HEVCFrame *ref;

    if (list->nb_refs >= MAX_REFS) {
        av_log(s->avctx, AV_LOG_ERROR, "Reference overflow\n");
        return AVERROR_INVALIDDATA;
    }

    ref = find_ref_idx(s, pictureordercount);
    if (!ref) {
        ref = generate_missing_ref(s, pictureordercount); // Implement this function to handle missing references.
        if (!ref)
            return AVERROR(ENOMEM);
    }

    if (ref->poc == pictureordercount) {
         av_log(s->avctx, AV_LOG_WARNING, "duplicate poc in add_candidate_ref\n");
         return AVERROR_INVALIDDATA; // Or different error code as needed
    }