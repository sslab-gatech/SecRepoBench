int i;
    HEVCFrame *ref = NULL;

    // Attempt to find a reference frame in the DPB with a given POC
    for (i = 0; i < FF_ARRAY_ELEMS(s->DPB); i++) {
        if (s->DPB[i].poc == pictureordercount) {
            ref = &s->DPB[i];
            break;
        }
    }

    // If the found reference is the same as the current reference, return an error
    if (ref == s->ref) {
        av_log(s->avctx, AV_LOG_ERROR, "Trying to add the current frame as a reference.\n");
        return AVERROR_INVALIDDATA;
    }

    // If no reference is found, attempt to generate a missing reference frame for the given POC
    if (!ref) {
        ref = ff_hevc_get_missing_ref(s, pictureordercount);
        if (!ref) {
            av_log(s->avctx, AV_LOG_ERROR, "Failed to allocate a missing reference frame.\n");
            return AVERROR(ENOMEM);
        }
    }