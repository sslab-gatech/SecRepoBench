HEVCFrame *ref = find_ref_idx(s, pictureordercount);
    if (!ref) {
        if (s->nal_unit_type == HEVC_NAL_IDR_W_RADL_NUT ||
            s->nal_unit_type == HEVC_NAL_IDR_N_LP_NUT ||
            s->nal_unit_type == HEVC_NAL_CRA_NUT || IS_BLA(s)) {
            ref = generate_missing_ref(s, pictureordercount);
            if (!ref)
                return AVERROR(ENOMEM);
        } else {
            return AVERROR_INVALIDDATA;
        }
    }

    if (ref == s->ref)
        return AVERROR_INVALIDDATA;