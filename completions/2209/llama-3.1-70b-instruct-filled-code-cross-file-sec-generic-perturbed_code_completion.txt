HEVCFrame *ref = find_ref_idx(s, pictureordercount);
if (ref && ref->poc == list->list[0]) {
    av_log(s->avctx, AV_LOG_ERROR, "Duplicate reference frame with POC %d\n", pictureordercount);
    return AVERROR_INVALIDDATA;
}

if (!ref) {
    // Attempt to generate a missing reference frame for the given POC.
    ref = generate_missing_ref(s, pictureordercount);
    if (!ref) {
        av_log(s->avctx, AV_LOG_ERROR, "Could not generate missing reference frame with POC %d\n", pictureordercount);
        return AVERROR_INVALIDDATA;
    }
}