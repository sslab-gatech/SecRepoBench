HEVCFrame *ref = find_ref_idx(s, pictureordercount);
    if (ref) {
        // Check if the reference is already in the list to avoid duplicates
        for (int i = 0; i < list->nb_refs; i++) {
            if (list->ref[i] == ref) {
                return AVERROR_INVALIDDATA; // Duplicate reference
            }
        }
    } else {
        // If no reference is found, generate a missing reference frame
        ref = generate_missing_ref(s, pictureordercount);
        if (!ref) {
            return AVERROR(ENOMEM); // Memory allocation error
        }
    }