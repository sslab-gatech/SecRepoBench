HEVCFrame *ref = find_ref_idx(s, pictureordercount);
    int i;

    // If no reference is found, attempt to generate a missing reference frame
    if (!ref) {
        ref = ff_hevc_get_missing_ref(s, pictureordercount); // Hypothetical helper for missing refs
        if (!ref) {
            av_log(s->avctx, AV_LOG_ERROR, "Failed to create missing reference frame for POC %d\n",
                   pictureordercount);
            return AVERROR_INVALIDDATA;
        }
    }

    // Check if this reference is already in the list (duplicate)
    for (i = 0; i < list->nb_refs; i++) {
        if (list->ref[i] == ref) {
            av_log(s->avctx, AV_LOG_ERROR, "Attempt to add a duplicate reference for POC %d\n",
                   pictureordercount);
            return AVERROR_INVALIDDATA;
        }
    }