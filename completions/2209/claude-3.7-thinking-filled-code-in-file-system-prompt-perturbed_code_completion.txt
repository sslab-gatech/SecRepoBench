HEVCFrame *ref = find_ref_idx(s, pictureordercount);
if (!ref) {
    ref = generate_missing_ref(s, pictureordercount);
    if (!ref)
        return AVERROR(ENOMEM);
}

if (list->nb_refs >= HEVC_MAX_REFS)
    return AVERROR_INVALIDDATA;

// Check for duplicate reference
for (int i = 0; i < list->nb_refs; i++)
    if (list->ref[i] == ref)
        return 0; // Skip this reference as it's already in the list