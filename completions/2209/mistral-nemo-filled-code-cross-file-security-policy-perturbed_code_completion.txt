HEVCFrame *ref = find_ref_idx(s, pictureordercount);
if (ref) {
    if (ref->poc == list->list[list->nb_refs - 1]) {
        av_log(s->avctx, AV_LOG_ERROR, "Duplicate reference frame found\n");
        return AVERROR_INVALIDDATA;
    }
    if (list->nb_refs >= FF_ARRAY_ELEMS(list->list)) {
        av_log(s->avctx, AV_LOG_ERROR, "Reference list overflow\n");
        return AVERROR_INVALIDDATA;
    }
    list->list[list->nb_refs] = ref->poc;
    list->ref[list->nb_refs]  = ref;
    list->nb_refs++;
} else {
    // Generate a missing reference frame for the given POC.
    // ...
}