HEVCFrame *ref = find_ref_idx(s, pictureordercount);
if (!ref) {
    // Cannot find reference and no way to generate it
    return AVERROR_INVALIDDATA;
}

// Check for invalid reference count
if (list->nb_refs < 0)
    return AVERROR_INVALIDDATA;

// Check for overflow
// Assuming a reasonable upper limit for HEVC reference frames
if (list->nb_refs >= 16)
    return AVERROR_INVALIDDATA;

// Check for duplicates by comparing POCs
for (int i = 0; i < list->nb_refs; i++) {
    if (list->list[i] == ref->poc)
        return AVERROR_INVALIDDATA;
}