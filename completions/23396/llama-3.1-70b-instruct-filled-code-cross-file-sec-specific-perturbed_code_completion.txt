// Check if a sequence of two consecutive CR+LF ("\r\n\r\n") is present in the payload
// after the current CR+LF position. If found, calculate the remaining payload length
// beyond the sequence. Limit this length to the size of the initial_binary_bytes
// buffer and copy the data into it. Update the length of the copied data in
// initial_binary_bytes_len.
u_int32_t remaining_payload_len = packet->payload_packet_len - (a + 2);
u_int32_t crlf_crlf_pos = 0;

if (remaining_payload_len >= 2) {
  crlf_crlf_pos = ndpi_mem_search(packet->payload + a + 2, remaining_payload_len, "\r\n", 2, 0);
}

if (crlf_crlf_pos!= NDPI_NOT_FOUND) {
  u_int32_t initial_binary_bytes_len = packet->payload_packet_len - (a + 2 + crlf_crlf_pos + 2);
  initial_binary_bytes_len = MIN(initial_binary_bytes_len, sizeof(packet->initial_binary_bytes));

  // Use a safe function to copy the data into the initial_binary_bytes buffer
  // to prevent a potential heap overflow (CWE-122).
  memcpy(packet->initial_binary_bytes, packet->payload + a + 2 + crlf_crlf_pos + 2, initial_binary_bytes_len);
  packet->initial_binary_bytes_len = initial_binary_bytes_len;
}