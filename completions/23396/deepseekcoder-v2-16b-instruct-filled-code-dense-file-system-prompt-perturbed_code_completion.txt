if(after) {
          strftime(notAfter, sizeof(notAfter), "%F %T", after);
          ndpi_serialize_string_string(serializer, "notafter", notAfter);
        }

	ndpi_serialize_end_of_block(serializer);
      } else {
	ndpi_serialize_start_of_block(serializer, "tls_unknown");
	ndpi_serialize_string_string(serializer, "version", version);
	ndpi_serialize_end_of_block(serializer);
      }

      free(version);
    }
    break;

  case NDPI_PROTOCOL_STUN:
    ndpi_serialize_start_of_block(serializer, "stun");
    ndpi_serialize_string_string(serializer, "username", flow->protos.stun.username);
    ndpi_serialize_string_string(serializer, "realm", flow->protos.stun.realm);
    ndpi_serialize_string_string(serializer, "nonce", flow->protos.stun.nonce);
    ndpi_serialize_string_string(serializer, "password", flow->protos.stun.password);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_OOKLA:
    ndpi_serialize_start_of_block(serializer, "ookla");
    ndpi_serialize_string_string(serializer, "client_id", flow->protos.ookla.client_id);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_NTP:
    ndpi_serialize_start_of_block(serializer, "ntp");
    ndpi_serialize_string_string(serializer, "version", flow->protos.ntp.version);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_RADIUS:
    ndpi_serialize_start_of_block(serializer, "radius");
    ndpi_serialize_string_string(serializer, "user", flow->protos.radius.user);
    ndpi_serialize_string_string(serializer, "password", flow->protos.radius.password);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_DHCP:
    ndpi_serialize_start_of_block(serializer, "dhcp");
    ndpi_serialize_string_string(serializer, "fingerprint", flow->protos.dhcp.fingerprint);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_SNMP:
    ndpi_serialize_start_of_block(serializer, "snmp");
    ndpi_serialize_string_string(serializer, "community", flow->protos.snmp.community);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_SYSLOG:
    ndpi_serialize_start_of_block(serializer, "syslog");
    ndpi_serialize_string_string(serializer, "facility", flow->protos.syslog.facility);
    ndpi_serialize_string_string(serializer, "severity", flow->protos.syslog.severity);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_DNS_OVER_TLS:
    ndpi_serialize_start_of_block(serializer, "dot");
    ndpi_serialize_string_string(serializer, "hostname", flow->protos.dot.hostname);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_DNS_OVER_HTTPS:
    ndpi_serialize_start_of_block(serializer, "doh");
    ndpi_serialize_string_string(serializer, "hostname", flow->protos.doh.hostname);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_MQTT:
    ndpi_serialize_start_of_block(serializer, "mqtt");
    ndpi_serialize_string_string(serializer, "client_id", flow->protos.mqtt.client_id);
    ndpi_serialize_string_string(serializer, "username", flow->protos.mqtt.username);
    ndpi_serialize_string_string(serializer, "password", flow->protos.mqtt.password);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_COAP:
    ndpi_serialize_start_of_block(serializer, "coap");
    ndpi_serialize_string_string(serializer, "path", flow->protos.coap.path);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_NTP_OVER_TLS:
    ndpi_serialize_start_of_block(serializer, "ntp_tls");
    ndpi_serialize_string_string(serializer, "hostname", flow->protos.ntp_tls.hostname);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_NTP_OVER_HTTPS:
    ndpi_serialize_start_of_block(serializer, "ntp_doh");
    ndpi_serialize_string_string(serializer, "hostname", flow->protos.ntp_doh.hostname);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_HTTP_PROXY:
    ndpi_serialize_start_of_block(serializer, "http_proxy");
    ndpi_serialize_string_string(serializer, "hostname", flow->http_proxy.hostname);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_HTTP_CONNECT:
    ndpi_serialize_start_of_block(serializer, "http_connect");
    ndpi_serialize_string_string(serializer, "hostname", flow->http_connect.hostname);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_OAUTH:
    ndpi_serialize_start_of_block(serializer, "oauth");
    ndpi_serialize_string_string(serializer, "client_id", flow->protos.oauth.client_id);
    ndpi_serialize_string_string(serializer, "client_secret", flow->protos.oauth.client_secret);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_LDAP:
    ndpi_serialize_start_of_block(serializer, "ldap");
    ndpi_serialize_string_string(serializer, "user", flow->protos.ldap.user);
    ndpi_serialize_string_string(serializer, "password", flow->protos.ldap.password);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_RADIUS_OVER_TLS:
    ndpi_serialize_start_of_block(serializer, "radius_tls");
    ndpi_serialize_string_string(serializer, "user", flow->protos.radius_tls.user);
    ndpi_serialize_string_string(serializer, "password", flow->protos.radius_tls.password);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_RADIUS_OVER_HTTPS:
    ndpi_serialize_start_of_block(serializer, "radius_doh");
    ndpi_serialize_string_string(serializer, "user", flow->protos.radius_doh.user);
    ndpi_serialize_string_string(serializer, "password", flow->protos.radius_doh.password);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_MQTT_OVER_TLS:
    ndpi_serialize_start_of_block(serializer, "mqtt_tls");
    ndpi_serialize_string_string(serializer, "client_id", flow->protos.mqtt_tls.client_id);
    ndpi_serialize_string_string(serializer, "username", flow->protos.mqtt_tls.username);
    ndpi_serialize_string_string(serializer, "password", flow->protos.mqtt_tls.password);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_MQTT_OVER_HTTPS:
    ndpi_serialize_start_of_block(serializer, "mqtt_doh");
    ndpi_serialize_string_string(serializer, "client_id", flow->protos.mqtt_doh.client_id);
    ndpi_serialize_string_string(serializer, "username", flow->protos.mqtt_doh.username);
    ndpi_serialize_string_string(serializer, "password", flow->protos.mqtt_doh.password);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_MQTT_OVER_WS:
    ndpi_serialize_start_of_block(serializer, "mqtt_ws");
    ndpi_serialize_string_string(serializer, "client_id", flow->protos.mqtt_ws.client_id);
    ndpi_serialize_string_string(serializer, "username", flow->protos.mqtt_ws.username);
    ndpi_serialize_string_string(serializer, "password", flow->protos.mqtt_ws.password);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_MQTT_OVER_WSS:
    ndpi_serialize_start_of_block(serializer, "mqtt_wss");
    ndpi_serialize_string_string(serializer, "client_id", flow->protos.mqtt_wss.client_id);
    ndpi_serialize_string_string(serializer, "username", flow->protos.mqtt_wss.username);
    ndpi_serialize_string_string(serializer, "password", flow->protos.mqtt_wss.password);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_COAP_OVER_TLS:
    ndpi_serialize_start_of_block(serializer, "coap_tls");
    ndpi_serialize_string_string(serializer, "path", flow->protos.coap_tls.path);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_COAP_OVER_HTTPS:
    ndpi_serialize_start_of_block(serializer, "coap_doh");
    ndpi_serialize_string_string(serializer, "path", flow->protos.coap_doh.path);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_COAP_OVER_WS:
    ndpi_serialize_start_of_block(serializer, "coap_ws");
    ndpi_serialize_string_string(serializer, "path", flow->protos.coap_ws.path);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_COAP_OVER_WSS:
    ndpi_serialize_start_of_block(serializer, "coap_wss");
    ndpi_serialize_string_string(serializer, "path", flow->protos.coap_wss.path);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_NTP_OVER_WS:
    ndpi_serialize_start_of_block(serializer, "ntp_ws");
    ndpi_serialize_string_string(serializer, "hostname", flow->protos.ntp_ws.hostname);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_NTP_OVER_WSS:
    ndpi_serialize_start_of_block(serializer, "ntp_wss");
    ndpi_serialize_string_string(serializer, "hostname", flow->protos.ntp_wss.hostname);
    ndpi_serialize_end_of_block(serializer);
    break;

  case NDPI_PROTOCOL_SNMP_TRAP:
    ndpi_serialize_start_of_block(serializer, "snmp_trap");
    ndpi_serialize_string_string(serializer, "enterprise_oid", flow->protos.