do {
    char filename[max_filename_length];
    unz_file_info64 file_info;
    if (unzGetCurrentFileInfo64(m_ZipFileHandle, &file_info, filename, sizeof(filename), nullptr, 0, nullptr) != UNZ_OK)
        continue;

    // Skip directories
    if (filename[strlen(filename) - 1] == '/')
        continue;

    // Simplify the filename
    std::string full_path(filename);
    SimplifyFilename(full_path);

    // Add to the map
    m_ArchiveMap[full_path] = ZipFileInfo(m_ZipFileHandle, file_info.uncompressed_size);
} while (unzGoToNextFile(m_ZipFileHandle) != UNZ_END_OF_LIST_OF_FILE);