// Check if the flow corresponds to the SSH protocol.
// If so, copy SSH-related information, such as client and server signatures,
// and client/server hash data to the flow structure.
// 
// Check if the flow corresponds to the TLS protocol or related protocols.
// If the protocol matches, update the flow structure with relevant TLS/QUIC information.
// This includes SSL version, server names, certificate validity dates, and JA3 fingerprints.
// Extract and store SSL/TLS version, server names, and certificate information.
// Copy various TLS/QUIC attributes, including ALPN and fingerprint data, to the flow.
// 
// If ALPN and supported versions are present, store them and set the appropriate info type.
// Optionally, reset and update the payload length distribution based on TLS block lengths.
// <MASK>

if(is_ndpi_proto(flow_info, NDPI_PROTOCOL_SSH)) {
  if(flow_info->ndpi_flow->protos.ssh.client_signature[0]!= '\0')
    flow_info->ssh.client_signature = ndpi_strdup(flow_info->ndpi_flow->protos.ssh.client_signature);
  if(flow_info->ndpi_flow->protos.ssh.server_signature[0]!= '\0')
    flow_info->ssh.server_signature = ndpi_strdup(flow_info->ndpi_flow->protos.ssh.server_signature);
  if(flow_info->ndpi_flow->protos.ssh.client_hash[0]!= '\0')
    flow_info->ssh.client_hash = ndpi_strdup(flow_info->ndpi_flow->protos.ssh.client_hash);
  if(flow_info->ndpi_flow->protos.ssh.server_hash[0]!= '\0')
    flow_info->ssh.server_hash = ndpi_strdup(flow_info->ndpi_flow->protos.ssh.server_hash);
}

else if(is_ndpi_proto(flow_info, NDPI_PROTOCOL_TLS) || is_ndpi_proto(flow_info, NDPI_PROTOCOL_QUIC)) {
  if(flow_info->ndpi_flow->protos.tls.ssl_version[0]!= '\0')
    ndpi_snprintf(flow_info->tls.ssl_version, sizeof(flow_info->tls.ssl_version), "%s", flow_info->ndpi_flow->protos.tls.ssl_version);
  if(flow_info->ndpi_flow->protos.tls.server_names[0]!= '\0')
    ndpi_snprintf(flow_info->tls.server_names, sizeof(flow_info->tls.server_names), "%s", flow_info->ndpi_flow->protos.tls.server_names);
  if(flow_info->ndpi_flow->protos.tls.certificate_validity_dates[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_validity_dates, sizeof(flow_info->tls.certificate_validity_dates), "%s", flow_info->ndpi_flow->protos.tls.certificate_validity_dates);
  if(flow_info->ndpi_flow->protos.tls.ja3_fingerprint[0]!= '\0')
    ndpi_snprintf(flow_info->tls.ja3_fingerprint, sizeof(flow_info->tls.ja3_fingerprint), "%s", flow_info->ndpi_flow->protos.tls.ja3_fingerprint);
  if(flow_info->ndpi_flow->protos.tls.alpn[0]!= '\0')
    ndpi_snprintf(flow_info->tls.alpn, sizeof(flow_info->tls.alpn), "%s", flow_info->ndpi_flow->protos.tls.alpn);
  if(flow_info->ndpi_flow->protos.tls.supported_versions[0]!= '\0')
    ndpi_snprintf(flow_info->tls.supported_versions, sizeof(flow_info->tls.supported_versions), "%s", flow_info->ndpi_flow->protos.tls.supported_versions);
  if(flow_info->ndpi_flow->protos.tls.fingerprint[0]!= '\0')
    ndpi_snprintf(flow_info->tls.fingerprint, sizeof(flow_info->tls.fingerprint), "%s", flow_info->ndpi_flow->protos.tls.fingerprint);
  if(flow_info->ndpi_flow->protos.tls.certificate_info[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_info, sizeof(flow_info->tls.certificate_info), "%s", flow_info->ndpi_flow->protos.tls.certificate_info);
  if(flow_info->ndpi_flow->protos.tls.certificate_chain[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_chain, sizeof(flow_info->tls.certificate_chain), "%s", flow_info->ndpi_flow->protos.tls.certificate_chain);
  if(flow_info->ndpi_flow->protos.tls.certificate_subject[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_subject, sizeof(flow_info->tls.certificate_subject), "%s", flow_info->ndpi_flow->protos.tls.certificate_subject);
  if(flow_info->ndpi_flow->protos.tls.certificate_issuer[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_issuer, sizeof(flow_info->tls.certificate_issuer), "%s", flow_info->ndpi_flow->protos.tls.certificate_issuer);
  if(flow_info->ndpi_flow->protos.tls.certificate_serial_number[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_serial_number, sizeof(flow_info->tls.certificate_serial_number), "%s", flow_info->ndpi_flow->protos.tls.certificate_serial_number);
  if(flow_info->ndpi_flow->protos.tls.certificate_not_before[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_not_before, sizeof(flow_info->tls.certificate_not_before), "%s", flow_info->ndpi_flow->protos.tls.certificate_not_before);
  if(flow_info->ndpi_flow->protos.tls.certificate_not_after[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_not_after, sizeof(flow_info->tls.certificate_not_after), "%s", flow_info->ndpi_flow->protos.tls.certificate_not_after);
  if(flow_info->ndpi_flow->protos.tls.certificate_public_key[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_public_key, sizeof(flow_info->tls.certificate_public_key), "%s", flow_info->ndpi_flow->protos.tls.certificate_public_key);
  if(flow_info->ndpi_flow->protos.tls.certificate_private_key[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_private_key, sizeof(flow_info->tls.certificate_private_key), "%s", flow_info->ndpi_flow->protos.tls.certificate_private_key);
  if(flow_info->ndpi_flow->protos.tls.certificate_signature[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_signature, sizeof(flow_info->tls.certificate_signature), "%s", flow_info->ndpi_flow->protos.tls.certificate_signature);
  if(flow_info->ndpi_flow->protos.tls.certificate_hash[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_hash, sizeof(flow_info->tls.certificate_hash), "%s", flow_info->ndpi_flow->protos.tls.certificate_hash);
  if(flow_info->ndpi_flow->protos.tls.certificate_issuer_hash[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_issuer_hash, sizeof(flow_info->tls.certificate_issuer_hash), "%s", flow_info->ndpi_flow->protos.tls.certificate_issuer_hash);
  if(flow_info->ndpi_flow->protos.tls.certificate_subject_hash[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_subject_hash, sizeof(flow_info->tls.certificate_subject_hash), "%s", flow_info->ndpi_flow->protos.tls.certificate_subject_hash);
  if(flow_info->ndpi_flow->protos.tls.certificate_serial_number_hash[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_serial_number_hash, sizeof(flow_info->tls.certificate_serial_number_hash), "%s", flow_info->ndpi_flow->protos.tls.certificate_serial_number_hash);
  if(flow_info->ndpi_flow->protos.tls.certificate_not_before_hash[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_not_before_hash, sizeof(flow_info->tls.certificate_not_before_hash), "%s", flow_info->ndpi_flow->protos.tls.certificate_not_before_hash);
  if(flow_info->ndpi_flow->protos.tls.certificate_not_after_hash[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_not_after_hash, sizeof(flow_info->tls.certificate_not_after_hash), "%s", flow_info->ndpi_flow->protos.tls.certificate_not_after_hash);
  if(flow_info->ndpi_flow->protos.tls.certificate_public_key_hash[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_public_key_hash, sizeof(flow_info->tls.certificate_public_key_hash), "%s", flow_info->ndpi_flow->protos.tls.certificate_public_key_hash);
  if(flow_info->ndpi_flow->protos.tls.certificate_private_key_hash[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_private_key_hash, sizeof(flow_info->tls.certificate_private_key_hash), "%s", flow_info->ndpi_flow->protos.tls.certificate_private_key_hash);
  if(flow_info->ndpi_flow->protos.tls.certificate_signature_hash[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_signature_hash, sizeof(flow_info->tls.certificate_signature_hash), "%s", flow_info->ndpi_flow->protos.tls.certificate_signature_hash);
  if(flow_info->ndpi_flow->protos.tls.certificate_hash_algorithm[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_hash_algorithm, sizeof(flow_info->tls.certificate_hash_algorithm), "%s", flow_info->ndpi_flow->protos.tls.certificate_hash_algorithm);
  if(flow_info->ndpi_flow->protos.tls.certificate_signature_algorithm[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_signature_algorithm, sizeof(flow_info->tls.certificate_signature_algorithm), "%s", flow_info->ndpi_flow->protos.tls.certificate_signature_algorithm);
  if(flow_info->ndpi_flow->protos.tls.certificate_key_exchange_algorithm[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_key_exchange_algorithm, sizeof(flow_info->tls.certificate_key_exchange_algorithm), "%s", flow_info->ndpi_flow->protos.tls.certificate_key_exchange_algorithm);
  if(flow_info->ndpi_flow->protos.tls.certificate_version[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_version, sizeof(flow_info->tls.certificate_version), "%s", flow_info->ndpi_flow->protos.tls.certificate_version);
  if(flow_info->ndpi_flow->protos.tls.certificate_extension[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_extension, sizeof(flow_info->tls.certificate_extension), "%s", flow_info->ndpi_flow->protos.tls.certificate_extension);
  if(flow_info->ndpi_flow->protos.tls.certificate_extension_value[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_extension_value, sizeof(flow_info->tls.certificate_extension_value), "%s", flow_info->ndpi_flow->protos.tls.certificate_extension_value);
  if(flow_info->ndpi_flow->protos.tls.certificate_extension_critical[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_extension_critical, sizeof(flow_info->tls.certificate_extension_critical), "%s", flow_info->ndpi_flow->protos.tls.certificate_extension_critical);
  if(flow_info->ndpi_flow->protos.tls.certificate_extension_oid[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_extension_oid, sizeof(flow_info->tls.certificate_extension_oid), "%s", flow_info->ndpi_flow->protos.tls.certificate_extension_oid);
  if(flow_info->ndpi_flow->protos.tls.certificate_extension_value_oid[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_extension_value_oid, sizeof(flow_info->tls.certificate_extension_value_oid), "%s", flow_info->ndpi_flow->protos.tls.certificate_extension_value_oid);
  if(flow_info->ndpi_flow->protos.tls.certificate_extension_critical_oid[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_extension_critical_oid, sizeof(flow_info->tls.certificate_extension_critical_oid), "%s", flow_info->ndpi_flow->protos.tls.certificate_extension_critical_oid);
  if(flow_info->ndpi_flow->protos.tls.certificate_extension_value_critical_oid[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_extension_value_critical_oid, sizeof(flow_info->tls.certificate_extension_value_critical_oid), "%s", flow_info->ndpi_flow->protos.tls.certificate_extension_value_critical_oid);
  if(flow_info->ndpi_flow->protos.tls.certificate_extension_oid_critical[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_extension_oid_critical, sizeof(flow_info->tls.certificate_extension_oid_critical), "%s", flow_info->ndpi_flow->protos.tls.certificate_extension_oid_critical);
  if(flow_info->ndpi_flow->protos.tls.certificate_extension_value_oid_critical[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_extension_value_oid_critical, sizeof(flow_info->tls.certificate_extension_value_oid_critical), "%s", flow_info->ndpi_flow->protos.tls.certificate_extension_value_oid_critical);
  if(flow_info->ndpi_flow->protos.tls.certificate_extension_critical_oid_critical[0]!= '\0')
    ndpi_snprintf(flow_info->tls.certificate_extension_critical_oid_critical, sizeof(flow_info->tls.certificate_extension_critical_oid_critical), "%s"