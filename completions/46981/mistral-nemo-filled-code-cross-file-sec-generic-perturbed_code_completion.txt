PixelBlue(current_image,q)),q);
                        SetPixelAlpha(current_image,ScaleShortToQuantum(
                          GetPixelAlpha(current_image,q)),q);
                        q+=GetPixelChannels(current_image);
                     }

                     if (SyncAuthenticPixels(current_image,exception) == MagickFalse)
                       break;
                   }
                }
#endif
                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Rescale pixels to Quantum");

                if (mng_info->magn_methx == 1)
                  {
                    crop_box.left=mng_info->magn_ml;
                    crop_box.right=mng_info->magn_mr;
                    crop_box.top=mng_info->magn_mt;
                    crop_box.bottom=mng_info->magn_mb;
                  }

                else
                  {
                    crop_box.left=0;
                    crop_box.right=0;
                    crop_box.top=0;
                    crop_box.bottom=0;
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Crop image to %.20gx%.20g+%.20g+%.20g",
                    (double) crop_box.left,(double) crop_box.right,
                    (double) crop_box.top,(double) crop_box.bottom);

                if (crop_box.left || crop_box.right || crop_box.top || crop_box.bottom)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Crop image");

                    current_image=CropImage(current_image,&crop_box,exception);
                    if (current_image == (Image *) NULL)
                      {
                        current_image=DestroyImageList(current_image);
                        ThrowReaderException(CorruptImageError,
                          "ImproperImageHeader");
                      }
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Resize image to %.20gx%.20g",
                    (double) current_image->columns,(double) current_image->rows);

                if (current_image->columns != mng_info->magn_mx ||
                    current_image->rows != mng_info->magn_my)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Resize image");

                    current_image=ResizeImage(current_image,mng_info->magn_mx,
                      mng_info->magn_my,exception);
                    if (current_image == (Image *) NULL)
                      {
                        current_image=DestroyImageList(current_image);
                        ThrowReaderException(CorruptImageError,
                          "ImproperImageHeader");
                      }
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Resize image to %.20gx%.20g",
                    (double) current_image->columns,(double) current_image->rows);

                if (current_image->columns != mng_info->magn_mx ||
                    current_image->rows != mng_info->magn_my)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Resize image");

                    current_image=ResizeImage(current_image,mng_info->magn_mx,
                      mng_info->magn_my,exception);
                    if (current_image == (Image *) NULL)
                      {
                        current_image=DestroyImageList(current_image);
                        ThrowReaderException(CorruptImageError,
                          "ImproperImageHeader");
                      }
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Resize image to %.20gx%.20g",
                    (double) current_image->columns,(double) current_image->rows);

                if (current_image->columns != mng_info->magn_mx ||
                    current_image->rows != mng_info->magn_my)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Resize image");

                    current_image=ResizeImage(current_image,mng_info->magn_mx,
                      mng_info->magn_my,exception);
                    if (current_image == (Image *) NULL)
                      {
                        current_image=DestroyImageList(current_image);
                        ThrowReaderException(CorruptImageError,
                          "ImproperImageHeader");
                      }
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Resize image to %.20gx%.20g",
                    (double) current_image->columns,(double) current_image->rows);

                if (current_image->columns != mng_info->magn_mx ||
                    current_image->rows != mng_info->magn_my)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Resize image");

                    current_image=ResizeImage(current_image,mng_info->magn_mx,
                      mng_info->magn_my,exception);
                    if (current_image == (Image *) NULL)
                      {
                        current_image=DestroyImageList(current_image);
                        ThrowReaderException(CorruptImageError,
                          "ImproperImageHeader");
                      }
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Resize image to %.20gx%.20g",
                    (double) current_image->columns,(double) current_image->rows);

                if (current_image->columns != mng_info->magn_mx ||
                    current_image->rows != mng_info->magn_my)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Resize image");

                    current_image=ResizeImage(current_image,mng_info->magn_mx,
                      mng_info->magn_my,exception);
                    if (current_image == (Image *) NULL)
                      {
                        current_image=DestroyImageList(current_image);
                        ThrowReaderException(CorruptImageError,
                          "ImproperImageHeader");
                      }
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Resize image to %.20gx%.20g",
                    (double) current_image->columns,(double) current_image->rows);

                if (current_image->columns != mng_info->magn_mx ||
                    current_image->rows != mng_info->magn_my)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Resize image");

                    current_image=ResizeImage(current_image,mng_info->magn_mx,
                      mng_info->magn_my,exception);
                    if (current_image == (Image *) NULL)
                      {
                        current_image=DestroyImageList(current_image);
                        ThrowReaderException(CorruptImageError,
                          "ImproperImageHeader");
                      }
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Resize image to %.20gx%.20g",
                    (double) current_image->columns,(double) current_image->rows);

                if (current_image->columns != mng_info->magn_mx ||
                    current_image->rows != mng_info->magn_my)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Resize image");

                    current_image=ResizeImage(current_image,mng_info->magn_mx,
                      mng_info->magn_my,exception);
                    if (current_image == (Image *) NULL)
                      {
                        current_image=DestroyImageList(current_image);
                        ThrowReaderException(CorruptImageError,
                          "ImproperImageHeader");
                      }
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Resize image to %.20gx%.20g",
                    (double) current_image->columns,(double) current_image->rows);

                if (current_image->columns != mng_info->magn_mx ||
                    current_image->rows != mng_info->magn_my)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Resize image");

                    current_image=ResizeImage(current_image,mng_info->magn_mx,
                      mng_info->magn_my,exception);
                    if (current_image == (Image *) NULL)
                      {
                        current_image=DestroyImageList(current_image);
                        ThrowReaderException(CorruptImageError,
                          "ImproperImageHeader");
                      }
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Resize image to %.20gx%.20g",
                    (double) current_image->columns,(double) current_image->rows);

                if (current_image->columns != mng_info->magn_mx ||
                    current_image->rows != mng_info->magn_my)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Resize image");

                    current_image=ResizeImage(current_image,mng_info->magn_mx,
                      mng_info->magn_my,exception);
                    if (current_image == (Image *) NULL)
                      {
                        current_image=DestroyImageList(current_image);
                        ThrowReaderException(CorruptImageError,
                          "ImproperImageHeader");
                      }
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Resize image to %.20gx%.20g",
                    (double) current_image->columns,(double) current_image->rows);

                if (current_image->columns != mng_info->magn_mx ||
                    current_image->rows != mng_info->magn_my)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Resize image");

                    current_image=ResizeImage(current_image,mng_info->magn_mx,
                      mng_info->magn_my,exception);
                    if (current_image == (Image *) NULL)
                      {
                        current_image=DestroyImageList(current_image);
                        ThrowReaderException(CorruptImageError,
                          "ImproperImageHeader");
                      }
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Resize image to %.20gx%.20g",
                    (double) current_image->columns,(double) current_image->rows);

                if (current_image->columns != mng_info->magn_mx ||
                    current_image->rows != mng_info->magn_my)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Resize image");

                    current_image=ResizeImage(current_image,mng_info->magn_mx,
                      mng_info->magn_my,exception);
                    if (current_image == (Image *) NULL)
                      {
                        current_image=DestroyImageList(current_image);
                        ThrowReaderException(CorruptImageError,
                          "ImproperImageHeader");
                      }
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Resize image to %.20gx%.20g",
                    (double) current_image->columns,(double) current_image->rows);

                if (current_image->columns != mng_info->magn_mx ||
                    current_image->rows != mng_info->magn_my)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Resize image");

                    current_image=ResizeImage(current_image,mng_info->magn_mx,
                      mng_info->magn_my,exception);
                    if (current_image == (Image *) NULL)
                      {
                        current_image=DestroyImageList(current_image);
                        ThrowReaderException(CorruptImageError,
                          "ImproperImageHeader");
                      }
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Resize image to %.20gx%.20g",
                    (double) current_image->columns,(double) current_image->rows);

                if (current_image->columns != mng_info->magn_mx ||
                    current_image->rows != mng_info->magn_my)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Resize image");

                    current_image=ResizeImage(current_image,mng_info->magn_mx,
                      mng_info->magn_my,exception);
                    if (current_image == (Image *) NULL)
                      {
                        current_image=DestroyImageList(current_image);
                        ThrowReaderException(CorruptImageError,
                          "ImproperImageHeader");
                      }
                  }

                if (logging != MagickFalse)
                  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                    "    Resize image to %.20gx%.20g",
                    (double) current_image->columns,(double) current_image->rows);

                if (current_image->columns != mng_info->magn_mx ||
                    current_image->rows != mng_info->magn_my)
                  {
                    if (logging != MagickFalse)
                      (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                        "    Resize image");

                    current_image=ResizeImage(current_image,mng_info->magn_mx,
                      mng_info->magn_my,exception);
                    if