unsigned int uloca_size;
      unsigned int uglyf_size;

      face = faceptr;
      const OT::head *head = hb_face_get_table<OT::head> (face);
      if (unlikely (!head))
        return;
      if (head->indexToLocFormat > 1)
        return;

      short_offset = head->indexToLocFormat == 0;

      hb_blob_t *loca_blob = hb_sanitize_context_get_blob (hb_face_get_sanitize_context (face), HB_TAG ('l','o','c','a'));
      hb_blob_t *glyf_blob = hb_sanitize_context_get_blob (hb_face_get_sanitize_context (face), HB_TAG ('g','l','y','f'));

      if (unlikely (!loca_blob || !glyf_blob))
      {
         loca_table = nullptr;
         glyf_table = nullptr;
         num_glyphs = 0;
         return;
      }

      loca_table = hb_blob_get_data (loca_blob, &uloca_size);
      glyf_table = hb_blob_get_data (glyf_blob, &uglyf_size);

      unsigned int loca_len = uloca_size / sizeof (short);
      if (short_offset)
        num_glyphs = loca_len - 1;
      else
        num_glyphs = loca_len / 2 - 1;

      if (unlikely (!loca_table || !glyf_table || num_glyphs == 0)) {
        loca_table = nullptr;
        glyf_table = nullptr;
        num_glyphs = 0;
        return;
      }