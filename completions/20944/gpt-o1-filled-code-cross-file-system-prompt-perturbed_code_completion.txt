{
  // Assign the input face to our member variable
  this->face = faceptr;

  // Retrieve the 'head' table
  hb_blob_t* head_blob = hb_face_reference_table(faceptr, HB_OT_TAG_head);
  if (!head_blob)
    return;

  // Parse the 'head' table
  unsigned int length;
  const head* head_table = (const head*)hb_blob_get_data(head_blob, &length);
  if (!head_table || length < sizeof(head))
  {
    hb_blob_destroy(head_blob);
    return;
  }

  // Check for expected magic number or format
  if (head_table->magicNumber != 0x5F0F) // typical HEAD magic number
  {
    hb_blob_destroy(head_blob);
    return;
  }

  // Determine offset format
  short_offset = (head_table->indexToLocFormat == 0);

  hb_blob_destroy(head_blob);

  // Reference 'loca' and 'glyf' tables
  loca_table = hb_face_reference_table(faceptr, HB_OT_TAG_loca);
  glyf_table = hb_face_reference_table(faceptr, HB_OT_TAG_glyf);

  // Calculate num_glyphs from loca table
  if (loca_table)
  {
    unsigned int loca_len = hb_blob_get_length(loca_table);
    if (short_offset)
      num_glyphs = (loca_len / 2) - 1;
    else
      num_glyphs = (loca_len / 4) - 1;
  }
}