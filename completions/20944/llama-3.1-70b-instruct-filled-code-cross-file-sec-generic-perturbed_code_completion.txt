// Assign the input face to the face member variable.
face = faceptr;

// Retrieve the 'head' table from the face and check format values.
hb_ot_head_table_t *head_table = hb_ot_layout_get_head_table (face);
if (head_table->indexToLocFormat!= 0 && head_table->indexToLocFormat!= 1) {
  // If format values indicate an unknown format, exit without further processing.
  return;
}

// Determine the short_offset based on the indexToLocFormat from the 'head' table.
short_offset = (head_table->indexToLocFormat == 0)? 1 : 2;

// Reference the 'loca' and 'glyf' tables from the face using a sanitize context.
hb_blob_t *loca_table = hb_sanitize_context_create_blob (face->reference_table ('loca'));
hb_blob_t *glyf_table = hb_sanitize_context_create_blob (face->reference_table ('glyf'));

// Calculate num_glyphs using the length of the loca_table, adjusting for offset format.
num_glyphs = (loca_table->length - short_offset) / (short_offset * 2);