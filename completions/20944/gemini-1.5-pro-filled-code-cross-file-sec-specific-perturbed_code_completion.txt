face = faceptr;

      unsigned int upem = hb_face_get_upem (face);
      scale_x = scale_y = upem;

      hb_blob_t *hb_blob = hb_face_reference_blob (face);
      unsigned int blob_length;
      const char *blob_data = hb_blob_get_data (hb_blob, &blob_length);

      hb_blob_destroy (hb_blob);


      if (!blob_data)
        return;

      const OT::head *head = hb_sanitize_context_t ().reference_table<OT::head> (blob_data, blob_length);
      unsigned int format = head->indexToLocFormat;

      if (format > 1)
      {
        head->destroy ();
        return;
      }

      short_offset = format == 0;

      const OT::loca *loca_table_ = hb_sanitize_context_t ().reference_table<OT::loca> (blob_data, blob_length);
      loca_table = loca_table_->get_location_data ();

      const OT::glyf *glyf_table_ = hb_sanitize_context_t ().reference_table<OT::glyf> (blob_data, blob_length);
      glyf_table = glyf_table_->get_glyf_data ();

      num_glyphs = loca_table_->get_length () / (short_offset ? 2 : 4) - 1;

      head->destroy ();
      loca_table_->destroy ();
      glyf_table_->destroy ();