face = faceptr;

      short_offset = 0;
      num_glyphs = 0;
      loca_table = hb_blob_get_empty ();
      glyf_table = hb_blob_get_empty ();

      hb_blob_ptr_t<head> head_table = hb_sanitize_context_t ().reference_table<head> (face);
      if (unlikely (!head_table->sanitize (&hb_sanitize_context_t ())))
	return;

      unsigned int format = head_table->indexToLocFormat;
      if (unlikely (format > 1))
	return;

      short_offset = format == 0;

      loca_table = hb_sanitize_context_t ().reference_table<loca> (face);
      glyf_table = hb_sanitize_context_t ().reference_table<glyf> (face);
      if (unlikely (!loca_table->sanitize (&hb_sanitize_context_t ()) ||
		    !glyf_table->sanitize (&hb_sanitize_context_t ())))
	return;

      num_glyphs = loca_table.get_length () / (short_offset ? 2 : 4) - 1;