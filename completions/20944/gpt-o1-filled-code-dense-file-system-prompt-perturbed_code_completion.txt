{
  this->face = faceptr;

  /* Retrieve and validate the 'head' table. */
  auto head_ref = hb_sanitize_context_t().reference_table<head>(faceptr);
  if (!head_ref ||
      hb_blob_get_length(head_ref.get_blob()) < sizeof(head))
    return;

  const head *head_table = reinterpret_cast<const head*>(
    hb_blob_get_data(head_ref.get_blob(), nullptr));
  if (!head_table)
    return;

  /* If indexToLocFormat is not 0 or 1, we don't handle it here. */
  if (head_table->indexToLocFormat > 1)
    return;

  /* Determine short_offset (true if indexToLocFormat == 0). */
  this->short_offset = (head_table->indexToLocFormat == 0);

  /* Reference 'loca' and 'glyf' tables. */
  this->loca_table = hb_sanitize_context_t().reference_table<LOCA>(faceptr);
  this->glyf_table = hb_sanitize_context_t().reference_table<GLYF>(faceptr);

  /* Calculate num_glyphs using the length of the loca_table. */
  unsigned int loca_len = hb_blob_get_length(this->loca_table.get_blob());
  if (this->short_offset)
    this->num_glyphs = loca_len / 2 - 1;
  else
    this->num_glyphs = loca_len / 4 - 1;
}