hb_face_t *hb_face = hb_face_reference(faceptr);
      hb_face_ensure_version(hb_face, HB_VERSION_FACE_VERSION_1_7_0);

      const hb_head_table_t *head_table = hb_face_reference_table(hb_face, HB_TAG('h', 'e', 'a', 'd'));
      if (head_table->version != HB_MAKE_TAG('h', 'e', 'a', 'd') || head_table->font_revision != 0x00010000) {
        // Unsupported format
        return;
      }

      hb_bool_t is_offset_short = (head_table->indexToLocFormat == 0);
      hb_uint_t num_glyphs = 0;

      if (is_offset_short) {
        const hb_loca_table_t *loca_table = hb_face_reference_table(hb_face, HB_TAG('l', 'o', 'c', 'a'));
        num_glyphs = loca_table->num_glyphs;
      } else {
        const hb_loca_table_t *loca_table = hb_face_reference_table(hb_face, HB_TAG('l', 'o', 'c', 'a'));
        num_glyphs = loca_table->num_glyphs;
      }

      this->face = faceptr;
      this->short_offset = is_offset_short;
      this->num_glyphs = hb_min(num_glyphs, hb_face_get_glyph_count(hb_face));
      this->loca_table = loca_table;
      this->glyf_table = hb_face_reference_table(hb_face, HB_TAG('g', 'l', 'y', 'f'));