face = faceptr;

      hb_blob_t *head_blob = hb_sanitize_context_t().reference_table<head>(face);
      const head *head_table = (const head *)hb_blob_get_data(head_blob, nullptr);
      if (unlikely(!head_table)) {
        hb_blob_destroy(head_blob);
        return;
      }

      short_offset = head_table->indexToLocFormat == 0;
      hb_blob_destroy(head_blob);

      hb_sanitize_context_t sanitize_context;
      loca_table = sanitize_context.reference_table<loca>(face);
      glyf_table = sanitize_context.reference_table<glyf>(face);

      if (short_offset) {
        num_glyphs = loca_table->dataZ.length / 2 - 1;
      } else {
        num_glyphs = loca_table->dataZ.length / 4 - 1;
      }