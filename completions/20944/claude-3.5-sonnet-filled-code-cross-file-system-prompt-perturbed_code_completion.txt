face = faceptr;

hb_blob_t *head_blob = face->reference_table (HB_OT_TAG_head);
const HeadTable *head_table = reinterpret_cast<const HeadTable *> (hb_blob_get_data (head_blob, nullptr));

if (head_table->indexToLocFormat > 1 || head_table->glyphDataFormat != 0)
{
  hb_blob_destroy (head_blob);
  return;
}

short_offset = 0 == head_table->indexToLocFormat;
hb_blob_destroy (head_blob);

hb_sanitize_context_t sanitizer;
sanitizer.set_num_glyphs (face->get_num_glyphs ());
sanitizer.set_max_ops (HB_SANITIZE_MAX_OPS_DEFAULT);

loca_table = sanitizer.reference_table<LocaTable> (face, HB_OT_TAG_loca);
glyf_table = sanitizer.reference_table<GlyfTable> (face, HB_OT_TAG_glyf);

num_glyphs = loca_table.get_length () / (short_offset ? 2 : 4) - 1;