void init (hb_face_t *faceptr)
{
  face = faceptr;
  short_offset = false;
  num_glyphs = 0;

  hb_blob_t *head_blob = hb_sanitize_context_t ().reference_table<head> (face);
  const head *head_table = head_blob->as<head> ();
  if (unlikely (head_table->indexToLocFormat > 1)) // Unknown format
  {
    hb_blob_destroy (head_blob);
    return;
  }

  short_offset = head_table->indexToLocFormat == 0;

  loca_table.init ();
  glyf_table.init ();

  loca_table.blob = hb_sanitize_context_t ().reference_table<loca> (face);
  glyf_table.blob = hb_sanitize_context_t ().reference_table<glyf> (face);

  if (short_offset)
    num_glyphs = loca_table->dataZ.len / 2 - 1;
  else
    num_glyphs = loca_table->dataZ.len / 4 - 1;

  hb_blob_destroy (head_blob);
}