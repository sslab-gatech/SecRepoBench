this->face = faceptr;

      hb_blob_t *head_table = hb_face_reference_table (faceptr, HB_TAG ('h', 'e', 'a', 'd'));
      if (!head_table)
        return;

      const char *head = hb_blob_get_data (head_table, NULL);
      unsigned int head_length = hb_blob_get_length (head_table);

      if (head_length < 50)
      {
        hb_blob_destroy (head_table);
        return;
      }

      unsigned int magic_number = hb_read_u32 (head + 16);
      unsigned int indexToLocFormat = hb_read_u16 (head + 50);

      hb_blob_destroy (head_table);

      if (magic_number != 0x5F0F3CF5)
        return;

      if (indexToLocFormat > 1)
        return;

      this->short_offset = indexToLocFormat;

      hb_sanitize_context_t *sanitize_context = hb_sanitize_context_create ();
      sanitize_context->max_ops = 1024u * 1024u;

      this->loca_table = hb_face_reference_table (faceptr, HB_TAG ('l', 'o', 'c', 'a'));
      this->glyf_table = hb_face_reference_table (faceptr, HB_TAG ('g', 'l', 'y', 'f'));

      hb_sanitize_context_destroy (sanitize_context);

      if (!this->loca_table || !this->glyf_table)
      {
        if (this->loca_table) hb_blob_destroy (this->loca_table);
        if (this->glyf_table) hb_blob_destroy (this->glyf_table);
        this->num_glyphs = 0;
        return;
      }

      this->num_glyphs = hb_blob_get_length (this->loca_table) / (this->short_offset ? 2 : 4) - 1;