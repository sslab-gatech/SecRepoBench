unsigned int loca_blob_length = hb_blob_get_length(this->loca_table);
unsigned int entry_size = this->short_offset ? sizeof(uint16_t) : sizeof(uint32_t);

// Verify that the loca table length is valid: it must be a multiple of entry_size and contain at least two entries.
if (loca_blob_length % entry_size != 0 || loca_blob_length < entry_size * 2)
{
  // The loca table is malformed. Invalidate table references.
  this->loca_table = nullptr;
  this->glyf_table = nullptr;
  this->num_glyphs = 0;
  return;
}

// Calculate the number of glyphs.
// The loca table contains (num_glyphs + 1) entries.
this->num_glyphs = loca_blob_length / entry_size - 1;