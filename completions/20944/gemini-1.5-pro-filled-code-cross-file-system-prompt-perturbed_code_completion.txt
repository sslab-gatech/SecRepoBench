face = faceptr;

      unsigned int head_offset = hb_ot_tag_to_offset (face->table_tags, HB_OT_TAG_head);
      if (head_offset == 0)
        return;
      const hb_ot_head_table_t *head =
        (const hb_ot_head_table_t *) hb_face_reference_table (face, head_offset);

      unsigned int indexToLocFormat = head->indexToLocFormat;
      if (unlikely (indexToLocFormat > 1))
        return;

      short_offset = indexToLocFormat == 0;

      unsigned int loca_offset = hb_ot_tag_to_offset (face->table_tags, HB_OT_TAG_loca);
      unsigned int glyf_offset = hb_ot_tag_to_offset (face->table_tags, HB_OT_TAG_glyf);

      if (unlikely (!loca_offset || !glyf_offset))
        return;

      hb_blob_t *loca_blob = hb_sanitize_context_t ().reference_table  (face, loca_offset);
      loca_table = hb_blob_get_data (loca_blob, NULL);

      hb_blob_t *glyf_blob = hb_sanitize_context_t ().reference_table  (face, glyf_offset);
      glyf_table = hb_blob_get_data (glyf_blob, NULL);

      num_glyphs = hb_blob_get_length (loca_blob) / (short_offset ? 2 : 4) - 1;

      hb_blob_destroy (glyf_blob);
      hb_blob_destroy (loca_blob);