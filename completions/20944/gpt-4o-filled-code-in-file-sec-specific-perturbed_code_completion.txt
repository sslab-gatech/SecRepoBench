face = faceptr;
      hb_blob_t *head_blob = hb_sanitize_context_t().reference_table<head>(face);
      const head *head_table = head_blob->as<head>();
      if (unlikely (!head_table)) {
        hb_blob_destroy(head_blob);
        return;
      }

      short_offset = head_table->indexToLocFormat == 0;
      hb_blob_destroy(head_blob);

      loca_table = hb_sanitize_context_t().reference_table<loca>(face);
      glyf_table = hb_sanitize_context_t().reference_table<glyf>(face);

      if (short_offset) {
        num_glyphs = loca_table->length / 2 - 1;
      } else {
        num_glyphs = loca_table->length / 4 - 1;
      }