this->face = faceptr;

const OT::head *head = faceptr->table.head.get ();
if (!head || (head->indexToLocFormat != 0 && head->indexToLocFormat != 1))
  return;

this->short_offset = (head->indexToLocFormat == 0);

hb_sanitize_context_t c;
this->loca_table = faceptr->table.loca.get (&c);
this->glyf_table = faceptr->table.glyf.get (&c);

if (this->loca_table.length)
{
  if (this->short_offset)
    this->num_glyphs = this->loca_table.length / 2 - 1;
  else
    this->num_glyphs = this->loca_table.length / 4 - 1;
}
else
  this->num_glyphs = 0;