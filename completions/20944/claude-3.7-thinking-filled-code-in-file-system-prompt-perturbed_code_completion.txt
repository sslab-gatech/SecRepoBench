face = faceptr;

hb_blob_t *head_blob = hb_sanitize_context_t().reference_table<head> (face);
const head *head_table = head_blob->as<head> ();
if (head_table->indexToLocFormat > 1 || head_table->indexToLocFormat < 0)
{
  hb_blob_destroy (head_blob);
  return;
}

short_offset = 0 == head_table->indexToLocFormat;
hb_blob_destroy (head_blob);

loca_table = hb_sanitize_context_t().reference_table<loca> (face);
glyf_table = hb_sanitize_context_t().reference_table<glyf> (face);

if (loca_table->get_length () < (short_offset ? 2 : 4))
  num_glyphs = 0;
else
  num_glyphs = (loca_table->get_length () / (short_offset ? 2 : 4)) - 1;