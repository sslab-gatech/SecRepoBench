face = faceptr;

hb_blob_t *head_blob = face->reference_table (HB_OT_TAG_head);
if (!head_blob || hb_blob_get_length (head_blob) < sizeof (HeadTable))
{
  if (head_blob) hb_blob_destroy (head_blob);
  return;
}
const HeadTable *head = (const HeadTable *) hb_blob_get_data (head_blob, nullptr);
if (head->indexToLocFormat > 1)
{
  hb_blob_destroy (head_blob);
  return;
}
short_offset = head->indexToLocFormat == 0;
hb_blob_destroy (head_blob);

loca_table = face->reference_table (HB_OT_TAG_loca);
glyf_table = face->reference_table (HB_OT_TAG_glyf);

if (loca_table)
{
  unsigned int loca_len = hb_blob_get_length (loca_table);
  num_glyphs = loca_len / (short_offset ? 2 : 4);
  if (num_glyphs > 0)
    num_glyphs--;
  else
    num_glyphs = 0;
}
else
  num_glyphs = 0;