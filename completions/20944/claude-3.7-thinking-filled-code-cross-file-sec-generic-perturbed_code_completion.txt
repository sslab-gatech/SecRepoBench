face = faceptr;

hb_blob_t *head_blob = hb_face_reference_table (face, HB_TAG ('h','e','a','d'));
const head *head_table = (const head *) hb_blob_get_data (head_blob, nullptr);
if (head_table->indexToLocFormat > 1 || head_table->glyphDataFormat > 0)
{
  hb_blob_destroy (head_blob);
  return;
}

short_offset = 0 == head_table->indexToLocFormat;
hb_blob_destroy (head_blob);

hb_sanitize_context_t c = {};
loca_table = face->reference_table (HB_TAG ('l','o','c','a'));
glyf_table = face->reference_table (HB_TAG ('g','l','y','f'));

const loca *loca = (const loca *) hb_blob_get_data (loca_table, nullptr);
num_glyphs = hb_max (1u, short_offset ? 
                     (unsigned int) (hb_blob_get_length (loca_table) / 2 - 1) :
                     (unsigned int) (hb_blob_get_length (loca_table) / 4 - 1));