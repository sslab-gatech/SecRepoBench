{
  face = faceptr;
  short_offset = false;
  num_glyphs = 0;

  hb_sanitize_context_t c;

  hb_blob_ptr_t<OT::head> head_blob = c.reference_table<OT::head> (face);
  if (!head_blob)
    return;
  const OT::head *head_table = head_blob.get ();
  if (head_table->indexToLocFormat > 1)
    return;
  short_offset = (head_table->indexToLocFormat == 0);

  loca_table = c.reference_table<OT::loca> (face);
  if (!loca_table)
    return;

  {
    size_t loca_len = hb_blob_get_length (loca_table);
    if (short_offset)
    {
      if (loca_len < 2) return;
      num_glyphs = (unsigned int) (loca_len / 2) - 1;
    }
    else
    {
      if (loca_len < 4) return;
      num_glyphs = (unsigned int) (loca_len / 4) - 1;
    }
  }

  glyf_table = c.reference_table<OT::glyf> (face);
}