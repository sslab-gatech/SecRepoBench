if (hb_face_get_table(faceptr, HB_TAG('h', 'e', 'a', 'd'), 0, &head_table) !=
          HB_OK) {
        return;
      }

      if (head_table->version != HB_VERSION_MAKE(1, 0, 0, 0) &&
          head_table->version != HB_VERSION_MAKE(1, 1, 0, 0)) {
        return;
      }

      short_offset = (head_table->indexToLocFormat == 0) ? 0 : 1;

      if (hb_face_get_table(faceptr, HB_TAG('l', 'o', 'c', 'a'), 0, &loca_table) !=
          HB_OK) {
        return;
      }

      if (hb_face_get_table(faceptr, HB_TAG('g', 'l', 'y', 'f'), 0, &glyf_table) !=
          HB_OK) {
        return;
      }

      num_glyphs = 0;
      unsigned int offset = 0;
      while (offset < loca_table->num_glyphs * (short_offset ? 2 : 1)) {
        num_glyphs++;
        offset += (short_offset ? 2 : 1);
      }