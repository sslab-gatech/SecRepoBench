// Retrieve the 'head' table from the face
      const head_table_t *head_table = (const head_table_t *) hb_face_reference_table(faceptr, HB_OT_TAG_head);
      if (!head_table) return;

      // Check the indexToLocFormat to determine short_offset
      short_offset = head_table->indexToLocFormat == 0;

      // Reference the 'loca' and 'glyf' tables
      loca_table = hb_face_reference_table(faceptr, HB_OT_TAG_loca);
      glyf_table = hb_face_reference_table(faceptr, HB_OT_TAG_glyf);

      if (!loca_table || !glyf_table) return;

      // Calculate num_glyphs using the length of the loca_table
      unsigned int loca_length = hb_blob_get_length(loca_table);
      num_glyphs = short_offset ? loca_length / 2 : loca_length / 4;

      // Ensure num_glyphs does not exceed the actual number of glyphs available
      unsigned int max_glyphs = hb_face_get_glyph_count(faceptr);
      num_glyphs = hb_min(num_glyphs, max_glyphs);