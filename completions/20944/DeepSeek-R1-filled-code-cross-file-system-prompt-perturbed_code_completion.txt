face = faceptr;

hb_blob_t *head_blob = hb_face_reference_table(face, HB_OT_TAG_head);
if (!head_blob || hb_blob_get_length(head_blob) < sizeof(OT::head)) {
  hb_blob_destroy(head_blob);
  return;
}
const OT::head *head_table = (const OT::head *) hb_blob_get_data(head_blob, nullptr);
if (head_table->indexToLocFormat > 1) {
  hb_blob_destroy(head_blob);
  return;
}
short_offset = (head_table->indexToLocFormat == 0);
hb_blob_destroy(head_blob);

hb_sanitize_context_t c;
c.set_face(face);
loca_table = c.reference_table<OT::loca>(face);
glyf_table = c.reference_table<OT::glyf>(face);

num_glyphs = (hb_blob_get_length(loca_table.get()) / (short_offset ? 2 : 4)) - 1;