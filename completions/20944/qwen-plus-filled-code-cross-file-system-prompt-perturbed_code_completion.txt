head_table = faceptr->reference_table[HBC_TAG('h', 'e', 'a', 'd')];
if (!head_table || head_table->indexToLocFormat > 1)
{
    return; // Unknown format, exit without further processing.
}

short_offset = (head_table->indexToLocFormat == 0); // Determine short/long offset based on indexToLocFormat.

loca_table = faceptr->reference_table[HBC_TAG('l', 'o', 'c', 'a')];
glyf_table = faceptr->reference_table[HBC_TAG('g', 'l', 'y', 'f')];

hb_sanitize_context_t sanitize_ctx;
if (!loca_table->sanitize(&sanitize_ctx) || !glyf_table->sanitize(&sanitize_ctx))
{
    return; // Tables are not valid, exit without further processing.
}

num_glyphs = loca_table->get_length() / (short_offset + 1); // Calculate number of glyphs adjusting for offset format.
this->face = faceptr; // Assign the input face to the face member variable.