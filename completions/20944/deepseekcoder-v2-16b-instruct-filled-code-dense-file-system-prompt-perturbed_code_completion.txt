num_glyphs = face->get_num_glyphs ();
      const hb_head_table_t *head = hb_face_reference_table (face, HB_OT_TAG_head);
      if (head->indexToLocFormat != 0 && head->indexToLocFormat != 1) {
        // Handle unknown indexToLocFormat
        return;
      }
      short_offset = head->indexToLocFormat == 0 ? 0 : 1;
      loca_table = hb_sanitize_context_t().reference_table<hb_loca_table_t>(face);
      glyf_table = hb_sanitize_context_t().reference_table<hb_glyf_table_t>(face);
      num_glyphs = loca_table->get_num_glyphs(short_offset);