{
  // Initialize member variables
  this->face = faceptr;
  this->short_offset = false;
  this->num_glyphs   = 0;
  this->loca_blob    = nullptr;
  this->glyf_blob    = nullptr;
  this->loca_table   = nullptr;
  this->glyf_table   = nullptr;

  // Retrieve 'head' table
  hb_blob_t* head_blob = hb_face_reference_table (this->face, HB_OT_TAG_head);
  unsigned int head_len = 0;
  const char* head_data = hb_blob_get_data (head_blob, &head_len);
  if (!head_data || head_len < 54) {
    // 'head' table too small or invalid; exit
    hb_blob_destroy (head_blob);
    return;
  }

  // Check indexToLocFormat (byte offset: 50 in 'head' table)
  // If unknown format, exit
  unsigned short indexToLocFormat = (unsigned short)((head_data[50] << 8) | (unsigned char)head_data[51]);
  if (indexToLocFormat > 1) {
    hb_blob_destroy (head_blob);
    return;
  }
  this->short_offset = (indexToLocFormat == 0);

  // Retrieve 'loca' table
  this->loca_blob = hb_face_reference_table (this->face, HB_OT_TAG_loca);
  unsigned int loca_len = 0;
  this->loca_table = hb_blob_get_data (this->loca_blob, &loca_len);
  // Check that loca table is large enough for at least one offset
  if (!this->loca_table || loca_len < (this->short_offset ? 2U : 4U)) {
    hb_blob_destroy (head_blob);
    hb_blob_destroy (this->loca_blob);
    this->loca_blob = nullptr;
    return;
  }

  // Calculate num_glyphs
  unsigned int offsets_count = this->short_offset ? (loca_len / 2U) : (loca_len / 4U);
  if (offsets_count == 0) {
    hb_blob_destroy (head_blob);
    hb_blob_destroy (this->loca_blob);
    this->loca_blob = nullptr;
    return;
  }
  this->num_glyphs = offsets_count - 1;

  // Retrieve 'glyf' table
  this->glyf_blob = hb_face_reference_table (this->face, HB_OT_TAG_glyf);
  unsigned int glyf_len = 0;
  this->glyf_table = hb_blob_get_data (this->glyf_blob, &glyf_len);
  if (!this->glyf_table) {
    hb_blob_destroy (head_blob);
    hb_blob_destroy (this->loca_blob);
    hb_blob_destroy (this->glyf_blob);
    this->loca_blob = nullptr;
    this->glyf_blob = nullptr;
    return;
  }

  // Keep 'head' blob alive until this object is finalized
  this->head_blob = head_blob;
}