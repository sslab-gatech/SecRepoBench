{
    // Assign the input face to the member variable
    this->face = faceptr;

    // Retrieve and inspect the 'head' table
    hb_blob_t *head_blob = hb_face_reference_table(this->face, HB_TAG('h','e','a','d'));
    unsigned int head_length;
    const unsigned char *head_data = (const unsigned char *)hb_blob_get_data(head_blob, &head_length);

    // Ensure 'head' table is valid and large enough to read indexToLocFormat (2 bytes at offset 50)
    if (!head_data || head_length < 52)
    {
      hb_blob_destroy(head_blob);
      return;
    }

    // Extract indexToLocFormat
    uint16_t indexToLocFormat = (head_data[50] << 8) | head_data[51];
    if (indexToLocFormat > 1)
    {
      hb_blob_destroy(head_blob);
      return;
    }

    // Determine if we're using a short offset
    this->short_offset = (indexToLocFormat == 0);
    hb_blob_destroy(head_blob);

    // Reference the 'loca' table
    this->loca_table = hb_face_reference_table(this->face, HB_TAG('l','o','c','a'));
    unsigned int loca_length = 0;
    hb_blob_get_data(this->loca_table, &loca_length);
    if (!loca_length)
    {
      hb_blob_destroy(this->loca_table);
      this->loca_table = nullptr;
      return;
    }

    // Reference the 'glyf' table
    this->glyf_table = hb_face_reference_table(this->face, HB_TAG('g','l','y','f'));

    // Calculate the number of glyphs based on the loca table length
    if (this->short_offset)
      this->num_glyphs = (loca_length / 2) - 1;
    else
      this->num_glyphs = (loca_length / 4) - 1;
}