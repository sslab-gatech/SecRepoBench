face = faceptr;

      hb_blob_t *head_blob = hb_face_reference_table(face, HB_TAG('h','e','a','d'));
      const OT::head *head_table = OT::sanitize<head> (hb_blob_get_data(head_blob, nullptr));
      if (head_table->indexToLocFormat > 1)
      {
        hb_blob_destroy(head_blob);
        return;
      }
      short_offset = head_table->indexToLocFormat == 0;

      hb_blob_t *loca_blob = hb_face_reference_table(face, HB_TAG('l','o','c','a'));
      loca_table = OT::sanitize<loca> (hb_blob_get_data(loca_blob, nullptr));
      hb_blob_t *glyf_blob = hb_face_reference_table(face, HB_TAG('g','l','y','f'));
      glyf_table = OT::sanitize<glyf> (hb_blob_get_data(glyf_blob, nullptr));

      num_glyphs = hb_blob_get_length(loca_blob) / (short_offset ? 2 : 4) - 1;
      if (num_glyphs > 0xFFFF)
        num_glyphs = 0xFFFF;

      hb_blob_destroy(head_blob);
      hb_blob_destroy(loca_blob);
      hb_blob_destroy(glyf_blob);