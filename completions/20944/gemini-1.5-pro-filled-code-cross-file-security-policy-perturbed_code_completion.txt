unsigned int loca_len = hb_blob_get_length (loca_table);
      unsigned int glyf_len = hb_blob_get_length (glyf_table);

      face = faceptr;

      hb_blob_make_immutable (loca_table);
      hb_blob_make_immutable (glyf_table);

      unsigned int u16_loca_len = loca_len / 2;

      /* Some fonts have loca tables that are too short.  We don't allow this,
       * but cope it here by setting num_glyphs to what can be
       * accommodated by the size of the loca table.  We don't trust
       * numGlyphs field in 'maxp' table either, since it's optional.
       */
      if (short_offset)
        num_glyphs = hb_min (u16_loca_len, face->get_num_glyphs () + 1);
      else
        num_glyphs = hb_min ((u16_loca_len + 1) / 2, face->get_num_glyphs () + 1);

      if (unlikely (!loca_len || !glyf_len))
        num_glyphs = 0;

      sanitized = true;