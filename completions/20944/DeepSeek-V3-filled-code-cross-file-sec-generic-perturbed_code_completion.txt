face = faceptr;
      hb_blob_t *head_blob = hb_sanitize_context_t().reference_table<head> (face);
      if (unlikely (!head_blob))
        return;

      const head *head_table = head_blob->as<head> ();
      if (unlikely (!head_table->check_format ()))
      {
        hb_blob_destroy (head_blob);
        return;
      }

      short_offset = head_table->indexToLocFormat;
      hb_blob_destroy (head_blob);

      loca_table = hb_sanitize_context_t().reference_table<loca> (face);
      glyf_table = hb_sanitize_context_t().reference_table<glyf> (face);

      if (unlikely (!loca_table || !glyf_table))
        return;

      unsigned int loca_length = hb_blob_get_length (loca_table);
      num_glyphs = short_offset ? loca_length / 2 - 1 : loca_length / 4 - 1;