// Determine the short_offset based on the indexToLocFormat from the 'head' table.
uint32_t short_offset = 0;
if (faceptr->head->indexToLocFormat == 0) {
    short_offset = faceptr->head->offset;
} else if (faceptr->head->indexToLocFormat == 1) {
    short_offset = faceptr->head->offset + faceptr->head->sizeOfLoca;
}

// Reference the 'loca' and 'glyf' tables from the face using a sanitize context.
hb_blob_t *loca_blob = hb_face_get_table(faceptr, HB_TAG('l', 'o', 'c', 'a'));
hb_blob_t *glyf_blob = hb_face_get_table(faceptr, HB_TAG('g', 'l', 'y', 'f'));

// Calculate num_glyphs using the length of the loca_table, adjusting for offset format.
uint32_t num_glyphs = (loca_blob->length + short_offset - 1) / short_offset;