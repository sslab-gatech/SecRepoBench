Dwarf_Unsigned subprog_format_count = 0;
Dwarf_Unsigned *subprog_entry_types = NULL;
Dwarf_Unsigned *subprog_entry_forms = NULL;
Dwarf_Unsigned subprogs_count = 0;

if (line_ptr >= line_ptr_end) {
    _dwarf_error(dbg, err, DW_DLE_LINE_NUMBER_HEADER_ERROR);
    return DW_DLV_ERROR;
}
subprog_format_count = *(unsigned char *) line_ptr;
line_ptr = line_ptr + sizeof(Dwarf_Small);

subprog_entry_types = malloc(sizeof(Dwarf_Unsigned) *
    subprog_format_count);
if (subprog_entry_types == NULL) {
    _dwarf_error_string(dbg, err, DW_DLE_ALLOC_FAIL,
        "DW_DLE_ALLOC_FAIL allocating subprog_entry_types");
    return DW_DLV_ERROR;
}

if (subprog_format_count > total_length) {
    IssueExpError(dbg,err,
        "Subprog format count Count too "
        "large to be real",
        subprog_format_count);
    free(subprog_entry_types);
    return DW_DLV_ERROR;
}

subprog_entry_forms = malloc(sizeof(Dwarf_Unsigned) *
    subprog_format_count);
if (subprog_entry_forms == NULL) {
    free(subprog_entry_types);
    _dwarf_error_string(dbg, err, DW_DLE_ALLOC_FAIL,
        "DW_DLE_ALLOC_FAIL allocating subprog_entry_forms");
    return DW_DLV_ERROR;
}

for (index = 0; index < subprog_format_count; index++) {
    int dres = 0;

    dres=read_uword_de(&line_ptr,subprog_entry_types+index,
        dbg,err,line_ptr_end);
    if (dres != DW_DLV_OK) {
        free(subprog_entry_types);
        free(subprog_entry_forms);
        return dres;
    }
    if (subprog_entry_types[index] > total_length) {
        IssueExpError(dbg,err,
            "Subprog entry_types[i] count Count too "
            "large to be real",
            subprog_entry_types[index]);
        free(subprog_entry_types);
        free(subprog_entry_forms);
        return DW_DLV_ERROR;
    }
    dres=read_uword_de(&line_ptr,subprog_entry_forms+index,
        dbg,err,line_ptr_end);
    if (dres != DW_DLV_OK) {
        free(subprog_entry_types);
        free(subprog_entry_forms);
        return dres;
    }
    if (subprog_entry_forms[index] > total_length) {
        IssueExpError(dbg,err,
            "Subprog entry_forms[i] count Count too "
            "large to be real",
            subprog_entry_forms[index]);
        free(subprog_entry_types);
        free(subprog_entry_forms);
        return DW_DLV_ERROR;
    }
}

dres=read_uword_de(&line_ptr,&subprogs_count,
    dbg,err,line_ptr_end);
if (dres != DW_DLV_OK) {
    free(subprog_entry_types);
    free(subprog_entry_forms);
    return dres;
}
if (subprogs_count > total_length) {
    IssueExpError(dbg,err,
        "Subprogs Count too large to be real",
        subprogs_count);
    free(subprog_entry_types);
    free(subprog_entry_forms);
    return DW_DLV_ERROR;
}

line_context->lc_subprogs =
    malloc(sizeof(struct Dwarf_Subprog_Entry_s) *
        subprogs_count);
if (line_context->lc_subprogs == NULL) {
    free(subprog_entry_types);
    free(subprog_entry_forms);
    _dwarf_error(dbg, err, DW_DLE_ALLOC_FAIL);
    return DW_DLV_ERROR;
}
memset(line_context->lc_subprogs, 0,
    sizeof(struct Dwarf_Subprog_Entry_s) * subprogs_count);