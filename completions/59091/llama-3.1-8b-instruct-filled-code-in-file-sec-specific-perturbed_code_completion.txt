static int
read_line_table_program(Dwarf_Debug dbg,
    Dwarf_Small *line_ptr,
    Dwarf_Small *line_ptr_end,
    Dwarf_Small *orig_line_ptr,
    Dwarf_Small *section_start,
    Dwarf_Line_Context line_context,
    Dwarf_Half address_size,
    Dwarf_Bool doaddrs, /* Only true if SGI IRIX rqs calling. */
    Dwarf_Bool dolines,
    Dwarf_Bool is_single_table,
    Dwarf_Bool is_actuals_table,
    Dwarf_Error *error,
    int *err_count_out)
{
    //... (rest of the code remains the same)

    /* Experimental two-level line tables */
    /*  DW_LNS_set_address_from_logical and
        DW_LNS_set_subprogram
        share the same opcode. Disambiguate by checking
        is_actuals_table. */
    case DW_LNS_set_subprogram:

        if (is_actuals_table) {
            /* DW_LNS_set_address_from_logical */
            Dwarf_Signed stmp = 0;
            int atres = 0;

            atres =  read_sword_de( &line_ptr,&stmp,
                dbg,error,line_ptr_end);
            if (atres == DW_DLV_ERROR) {
                _dwarf_free_chain_entries(dbg,head_chain,
                    line_count);
                if (curr_line) {
                    dwarf_dealloc(dbg,curr_line,DW_DLA_LINE);
                }
                return DW_DLV_ERROR;
            }
            advance_line = (Dwarf_Signed) stmp;
            regs.lr_line = regs.lr_line + advance_line;
            if ((Dwarf_Signed)regs.lr_line < 0) {
                dwarfstring m;

                dwarfstring_constructor(&m);
                dwarfstring_append_printf_i(&m,
                    "\nERROR: DW_DLE_LINE_TABLE_LINENO_ERROR"
                    " The line number is %d "
                    "and negative line numbers after "
                    "DW_LNS_set_subprogram ",
                    (Dwarf_Signed)regs.lr_line);
                dwarfstring_append_printf_i(&m,
                    " of %d applied "
                    "are not correct.",stmp);
                _dwarf_error_string(dbg, error,
                    DW_DLE_LINE_TABLE_LINENO_ERROR,
                    dwarfstring_string(&m));
                dwarfstring_destructor(&m);
                regs.lr_line = 0;
                _dwarf_free_chain_entries(dbg,
                    head_chain,line_count);
                if (curr_line) {
                    dwarf_dealloc(dbg,curr_line,DW_DLA_LINE);
                }
                return DW_DLV_ERROR;

            }
            if (regs.lr_line >= 1 &&
                regs.lr_line - 1 < logicals_count) {
                regs.lr_address =
                    logicals[regs.lr_line - 1]->li_address;
                regs.lr_op_index = 0;
#ifdef PRINTING_DETAILS /* block 1 print */
                dwarfstring_constructor(&mb);
                dwarfstring_append_printf_i(&mb,
                    "DW_LNS_set_address_from"
                    "_logical "
                    "%" DW_PR_DSd,
                    stmp);
                dwarfstring_append_printf_u(&mb,
                    " 0x%" DW_PR_XZEROS DW_PR_DSx,
                    stmp);
                dwarfstring_append_printf_u(&mb,
                    "  newaddr="
                    " 0x%" DW_PR_XZEROS DW_PR_DUx ".\n",
                    regs.lr_address);
                _dwarf_printf(dbg,
                    dwarfstring_string(&mb));
                dwarfstring_destructor(&mb);
#endif /* PRINTING_DETAILS */
            } else {
#ifdef PRINTING_DETAILS /* block 2 print */
                dwarfstring_constructor(&mb);
                dwarfstring_append_printf_i(&mb,
                    "DW_LNS_set_address_from_logical line"
                    " is %" DW_PR_DSd,
                    regs.lr_line);
                dwarfstring_append_printf_u(&mb,
                    " 0x%" DW_PR_XZEROS DW_PR_DSx ".\n",
                    regs.lr_line);
                _dwarf_printf(dbg,
                    dwarfstring_string(&mb));
                dwarfstring_destructor(&mb);
#endif /* PRINTING_DETAILS */
            }
        } else {
            /*  DW_LNS_set_subprogram,
                building logicals table.  */
            Dwarf_Unsigned utmp2 = 0;
            int spres = 0;

            regs.lr_call_context = 0;
            spres =  read_uword_de( &line_ptr,&utmp2,
                dbg,error,line_ptr_end);
            if (spres == DW_DLV_ERROR) {
                _dwarf_free_chain_entries(dbg,head_chain,
                    line_count);
                if (curr_line) {
                    dwarf_dealloc(dbg,curr_line,DW_DLA_LINE);
                }
                return DW_DLV_ERROR;
            }
            regs.lr_subprogram = utmp2;
#ifdef PRINTING_DETAILS /* block 3 print */
            dwarfstring_constructor(&mb);
            dwarfstring_append_printf_i(&mb,
                "DW_LNS_set_subprogram "
                "%" DW_PR_DSd,
                utmp2);
            dwarfstring_append_printf_u(&mb,
                " 0x%" DW_PR_XZEROS DW_PR_DSx "\n",
                utmp2);
            _dwarf_printf(dbg,
                dwarfstring_string(&mb));
            dwarfstring_destructor(&mb);
#endif /* PRINTING_DETAILS */
        }
        break;

    /* Experimental two-level line tables */
    case DW_LNS_set_address_from_logical: {
        Dwarf_Signed stmp = 0;
        int atres = 0;

        atres =  read_sword_de( &line_ptr,&stmp,
            dbg,error,line_ptr_end);
        if (atres == DW_DLV_ERROR) {
            _dwarf_free_chain_entries(dbg,head_chain,
                line_count);
            if (curr_line) {
                dwarf_dealloc(dbg,curr_line,DW_DLA_LINE);
            }
            return DW_DLV_ERROR;
        }
        advance_line = (Dwarf_Signed) stmp;
        regs.lr_line = regs.lr_line + advance_line;
        if ((Dwarf_Signed)regs.lr_line < 0) {
            dwarfstring m;

            dwarfstring_constructor(&m);
            dwarfstring_append_printf_i(&m,
                "\nERROR: DW_DLE_LINE_TABLE_LINENO_ERROR"
                " The line number is %d "
                "and negative line numbers after "
                "DW_LNS_set_address_from_logical ",
                (Dwarf_Signed)regs.lr_line);
            dwarfstring_append_printf_i(&m,
                " of %d applied "
                "are not correct.",stmp);
            _dwarf_error_string(dbg, error,
                DW_DLE_LINE_TABLE_LINENO_ERROR,
                dwarfstring_string(&m));
            dwarfstring_destructor(&m);
            regs.lr_line = 0;
            _dwarf_free_chain_entries(dbg,
                head_chain,line_count);
            if (curr_line) {
                dwarf_dealloc(dbg,curr_line,DW_DLA_LINE);
            }
            return DW_DLV_ERROR;

        }
        if (regs.lr_line >= 1 &&
            regs.lr_line - 1 < logicals_count) {
            regs.lr_address =
                logicals[regs.lr_line - 1]->li_address;
            regs.lr_op_index = 0;
#ifdef PRINTING_DETAILS /* block 1 print */
            dwarfstring_constructor(&mb);
            dwarfstring_append_printf_i(&mb,
                "DW_LNS_set_address_from"
                "_logical "
                "%" DW_PR_DSd,
                stmp);
            dwarfstring_append_printf_u(&mb,
                " 0x%" DW_PR_XZEROS DW_PR_DSx,
                stmp);
            dwarfstring_append_printf_u(&mb,
                "  newaddr="
                " 0x%" DW_PR_XZEROS DW_PR_DUx ".\n",
                regs.lr_address);
            _dwarf_printf(dbg,
                dwarfstring_string(&mb));
            dwarfstring_destructor(&mb);
#endif /* PRINTING_DETAILS */
        } else {
#ifdef PRINTING_DETAILS /* block 2 print */
            dwarfstring_constructor(&mb);
            dwarfstring_append_printf_i(&mb,
                "DW_LNS_set_address_from_logical line"
                " is %" DW_PR_DSd,
                regs.lr_line);
            dwarfstring_append_printf_u(&mb,
                " 0x%" DW_PR_XZEROS DW_PR_DSx ".\n",
                regs.lr_line);
            _dwarf_printf(dbg,
                dwarfstring_string(&mb));
            dwarfstring_destructor(&mb);
#endif /* PRINTING_DETAILS */
        }
        break;
    }
    /* Experimental two-level line tables */
    case DW_LNS_set_subprogram:
    case DW_LNS_set_address_from_logical:
        break;
    /*... (rest of the code remains the same) */