#include <algorithm> // for std::find_if

bool find_table_index (hb_tag_t hb_tag, unsigned int *table_index) const
{
  // Determine the index of the table entry corresponding to the given tag.
  // Use the appropriate search method based on table entry size.
  if (tables.len < 10) { // Use linear search for smaller collections
    for (unsigned int i = 0; i < tables.len; i++) {
      if (tables.arrayZ[i].tag == hb_tag) {
        *table_index = i;
        return true;
      }
    }
  } else { // Use binary search for larger collections
    auto it = std::find_if(tables.arrayZ, tables.arrayZ + tables.len, [hb_tag](const TableRecord &rec) {
      return rec.tag == hb_tag;
    });
    if (it != tables.arrayZ + tables.len) {
      *table_index = it - tables.arrayZ;
      return true;
    }
  }
  return false;
}