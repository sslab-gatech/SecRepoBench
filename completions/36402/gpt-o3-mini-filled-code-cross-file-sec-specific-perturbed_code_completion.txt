// Ensure the output pointer is valid.
  if (!table_index)
    return false;

  // Get the number of table entries. Validate that it is a reasonable quantity.
  const unsigned int num_entries = tables.len;
  if (num_entries == 0)
    return false;

  // If the number of entries is small, use linear search.
  const unsigned int LINEAR_SEARCH_THRESHOLD = 8;
  if (num_entries <= LINEAR_SEARCH_THRESHOLD)
  {
    for (unsigned int i = 0; i < num_entries; i++)
    {
      if (tables.arrayZ[i].tag == hb_tag)
      {
        *table_index = i;
        return true;
      }
    }
  }
  else
  {
    // Use binary search on the sorted table entries.
    int low = 0;
    int high = static_cast<int>(num_entries) - 1;
    while (low <= high)
    {
      int mid = low + ((high - low) / 2);
      hb_tag_t mid_tag = tables.arrayZ[mid].tag;
      if (mid_tag < hb_tag)
      {
        low = mid + 1;
      }
      else if (mid_tag > hb_tag)
      {
        high = mid - 1;
      }
      else
      {
        *table_index = mid;
        return true;
      }
    }
  }
  return false;