{
  // Use a small threshold to decide whether to do a linear or binary search:
  static const unsigned SMALL_TABLE_THRESHOLD = 4;

  if (num_tables <= SMALL_TABLE_THRESHOLD)
  {
    // Linear search
    for (unsigned int i = 0; i < num_tables; i++)
    {
      if (table_records[i].Tag == hb_tag)
      {
        *table_index = i;
        return true;
      }
    }
    return false;
  }
  else
  {
    // Binary search
    unsigned int low = 0, high = num_tables;
    while (low < high)
    {
      unsigned int mid = (low + high) >> 1;
      hb_tag_t mid_tag = table_records[mid].Tag;

      if (hb_tag < mid_tag)
        high = mid;
      else if (hb_tag > mid_tag)
        low = mid + 1;
      else
      {
        *table_index = mid;
        return true;
      }
    }
    return false;
  }
}