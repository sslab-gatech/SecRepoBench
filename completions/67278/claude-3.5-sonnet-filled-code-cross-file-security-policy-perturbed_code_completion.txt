u32 hdr, frame_len;
u32 pos = (u32) gf_bs_get_position(bs);
hdr = gf_bs_read_u32(bs);
if (hdr & 0x80000000) {
    frame_len = ((hdr>>13) & 0x3FFF) + 3;
    if (frame_len > size - pos) break;
    if (!gf_m4a_get_config_from_latm(data + pos, frame_len, &acfg)) {
        if ((acfg.samplingFrequencyIndex <= 12) && acfg.samplingFrequencyIndex) {
            numframes++;
        }
        gf_bs_skip_bytes(bs, frame_len - 4);
    } else {
        gf_bs_seek(bs, pos+1);
        nb_skip++;
    }
} else {
    gf_bs_seek(bs, pos+1);
    nb_skip++;
}
if (gf_bs_available(bs) < 4) break;