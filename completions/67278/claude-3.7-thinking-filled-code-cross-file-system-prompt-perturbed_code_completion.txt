u32 sync;
u32 frame_size;
u32 pos;

if (gf_bs_available(bs) < 3) break;
pos = (u32) gf_bs_get_position(bs);

sync = gf_bs_read_int(bs, 11);
if (sync != 0x2B7) {
    gf_bs_seek(bs, pos+1);
    nb_skip++;
    if (nb_skip>4096) break;
    continue;
}

frame_size = gf_bs_read_int(bs, 13);
if (!frame_size || (frame_size > gf_bs_available(bs))) {
    gf_bs_seek(bs, pos+1);
    nb_skip++;
    continue;
}

memset(&acfg, 0, sizeof(GF_M4ADecSpecInfo));
if (gf_m4a_parse_config_buf(data + pos, frame_size + 3, &acfg, NULL, NULL) == GF_OK) {
    if (acfg.base_sr) {
        numframes++;
    }
} else {
    gf_bs_seek(bs, pos+1);
    nb_skip++;
    continue;
}

gf_bs_seek(bs, pos + frame_size + 3);
if (gf_bs_available(bs) < 3) break;