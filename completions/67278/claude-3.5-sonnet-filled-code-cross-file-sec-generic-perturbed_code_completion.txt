u32 hdr, frame_size;
u32 pos = (u32) gf_bs_get_position(bs);
if (pos + 3 > size) break;
hdr = gf_bs_read_u24(bs);
if (hdr & 0x800000) {
    frame_size = gf_latm_get_value(bs);
    if (frame_size == 0xFFF)
        frame_size = 0;
} else {
    frame_size = 0;
}
if (!frame_size) {
    gf_bs_seek(bs, pos+1);
    nb_skip++;
    continue;
}
if (pos + frame_size > size) break;

if (!gf_m4a_get_config(bs, &acfg)) {
    if ((acfg.base_sr_index >= 0) && (acfg.base_sr_index <= 12)) {
        numframes++;
    }
}
gf_bs_seek(bs, pos + frame_size);