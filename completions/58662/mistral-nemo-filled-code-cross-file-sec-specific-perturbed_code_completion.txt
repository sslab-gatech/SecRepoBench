for (; iterator.hasNext(); ++iterator)
    {
      hb_codepoint_t curr_gid = (*iterator).first;
      unsigned curr_klass = (*iterator).second;

      if (curr_gid != prev_gid + 1 || curr_klass != prev_klass)
      {
        range_rec.last = prev_gid;
        auto *record = c->copy (range_rec);
        if (unlikely (!record)) return_trace (false);
        num_ranges++;
      }

      prev_gid = curr_gid;
      prev_klass = curr_klass;

      range_rec.first = curr_gid;
      range_rec.last = curr_gid;
      range_rec.value = curr_klass;
    }

    range_rec.last = prev_gid;
    auto *record = c->copy (range_rec);
    if (unlikely (!record)) return_trace (false);
    num_ranges++;

    rangeRecord.len = num_ranges;
    std::sort (rangeRecord.begin(), rangeRecord.end());
    return_trace (true);