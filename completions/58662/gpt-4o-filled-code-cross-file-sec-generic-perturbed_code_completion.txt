for (++iterator; iterator; ++iterator) {
      hb_codepoint_t curr_gid = (*iterator).first;
      unsigned curr_klass = (*iterator).second;

      if (curr_gid == prev_gid + 1 && curr_klass == prev_klass) {
        // Continuation of the current range
        range_rec.last = curr_gid;
      } else {
        // Finalize the current range and start a new one
        record->last = range_rec.last;
        record = c->serialize_append<RangeRecord<Types>>(c);
        if (unlikely (!record)) return_trace (false);

        range_rec.first = curr_gid;
        range_rec.last = curr_gid;
        range_rec.value = curr_klass;
        *record = range_rec;
        num_ranges++;
      }

      prev_gid = curr_gid;
      prev_klass = curr_klass;
    }

    // Finalize the last range
    record->last = range_rec.last;
    rangeRecord.len = num_ranges;

    // Sort the range records if necessary
    // Assuming a function `sort_range_records` exists to sort the records
    // sort_range_records(c, rangeRecord, num_ranges);

    return_trace (true);