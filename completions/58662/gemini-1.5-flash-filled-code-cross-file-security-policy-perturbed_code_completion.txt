for (auto it = ++iterator; it; ++it) {
      hb_codepoint_t gid = (*it).first;
      unsigned klass = (*it).second;

      if (klass == prev_klass && gid == prev_gid + 1) {
        range_rec.last = gid;
      } else {
        record->last = prev_gid;
        if (unlikely (!c->copy(range_rec))) return_trace(false);
        num_ranges++;
        range_rec.first = gid;
        range_rec.last = gid;
        range_rec.value = klass;
        record = c->copy(range_rec);
        if (unlikely (!record)) return_trace(false);
      }
      prev_gid = gid;
      prev_klass = klass;
    }
    record->last = prev_gid;
    rangeRecord.len = num_ranges;
    classFormat = 2;
    return_trace (true);