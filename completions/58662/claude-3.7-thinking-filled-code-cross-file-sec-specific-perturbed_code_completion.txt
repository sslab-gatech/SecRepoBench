iterator++;
for (; iterator; iterator++)
{
  hb_codepoint_t gid = (*iterator).first;
  unsigned klass = (*iterator).second;

  if (klass == prev_klass && gid == prev_gid + 1)
  {
    prev_gid = gid;
    continue;
  }

  record->last = prev_gid;
  
  if (klass != prev_klass || gid != prev_gid + 1)
  {
    num_ranges++;
    range_rec.first = gid;
    range_rec.value = klass;
    
    record = c->copy (range_rec);
    if (unlikely (!record)) return_trace (false);
  }
  
  prev_gid = gid;
  prev_klass = klass;
}

record->last = prev_gid;
classFormat = 2;
rangeRecord.len = num_ranges;

c->sort_array (rangeRecord.arrayZ, num_ranges);
return_trace (true);