for (++iterator; iterator; ++iterator)
    {
      hb_codepoint_t gid = (*iterator).first;
      unsigned klass = (*iterator).second;

      if (gid == prev_gid + 1 && klass == prev_klass)
      {
        // Continuation of the current range
        prev_gid = gid;
        continue;
      }

      // Finalize the current range
      record->last = prev_gid;

      // Create a new range record for the new pair
      range_rec.first = gid;
      range_rec.last = gid;
      range_rec.value = klass;

      record = c->copy(range_rec);
      if (unlikely(!record)) return_trace(false);

      prev_gid = gid;
      prev_klass = klass;
      num_ranges++;
    }

    // Finalize the last range record
    record->last = prev_gid;

    // Update the range record length
    rangeRecord.len = num_ranges;

    // Sort the range records to handle any unsorted glyph order
    c->sort(rangeRecord);

    return_trace(true);