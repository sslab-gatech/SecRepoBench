for (++iterator; iterator; ++iterator)
    {
      hb_codepoint_t gid = (*iterator).first;
      unsigned klass = (*iterator).second;

      if (gid == prev_gid + 1 && klass == prev_klass)
      {
        range_rec.last = gid;
      }
      else
      {
        record->last = range_rec.last;
        record = c->serialize_append<RangeRecord<Types>>(c);
        if (unlikely (!record)) return_trace (false);

        range_rec.first = gid;
        range_rec.last = gid;
        range_rec.value = klass;
        *record = range_rec;
        num_ranges++;
      }

      prev_gid = gid;
      prev_klass = klass;
    }

    record->last = range_rec.last;
    rangeRecord.len = num_ranges;

    // Assuming a sort function is available to sort the range records
    c->sort<RangeRecord<Types>>(rangeRecord.array, num_ranges);

    return_trace (true);