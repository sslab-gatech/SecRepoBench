for (const auto& gid_klass_pair : + iterator)
    {
      unsigned cur_gid = gid_klass_pair.first;
      unsigned cur_klass = gid_klass_pair.second;

      if (cur_gid != prev_gid + 1 || cur_klass != prev_klass)
      {
        rangeRecord.len++;
        rangeRecord.last = prev_gid;
        rangeRecord.value = prev_klass;

        auto *record = c->copy (rangeRecord);
        if (unlikely (!record)) return_trace (false);

        rangeRecord.first = cur_gid;
        rangeRecord.last = cur_gid;
        rangeRecord.value = cur_klass;
      }
      else
      {
        rangeRecord.last = cur_gid;
      }

      prev_gid = cur_gid;
      prev_klass = cur_klass;
    }

    rangeRecord.last = prev_gid;

    // Finalize the last range record
    auto *record = c->copy (rangeRecord);
    if (unlikely (!record)) return_trace (false);

    // Sort the range records to ensure they are in order
    rangeRecord.sort();

    return_trace (true);