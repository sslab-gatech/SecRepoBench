for (const auto gid_klass_pair : it) {
      hb_codepoint_t cur_gid = gid_klass_pair.first;
      unsigned cur_klass = gid_klass_pair.second;

      if (cur_gid != prev_gid + 1 || cur_klass != prev_klass) {
        record->last = prev_gid;
        record = c->copy(range_rec);
        if (unlikely(!record)) return_trace(false);
        num_ranges++;
        range_rec.first = cur_gid;
        range_rec.value = cur_klass;
      }
      prev_gid = cur_gid;
      prev_klass = cur_klass;
    }

    record->last = prev_gid;
    rangeRecord.len = num_ranges;
    rangeRecord.sort();
    return_trace(true);