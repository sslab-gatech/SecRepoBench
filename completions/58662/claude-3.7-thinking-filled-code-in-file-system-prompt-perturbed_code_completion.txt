for (iterator++; iterator; iterator++)
{
  hb_codepoint_t gid = (*iterator).first;
  unsigned klass = (*iterator).second;

  if (gid != prev_gid + 1 || klass != prev_klass)
  {
    // This pair is not a continuation; finalize the current range
    record->last = prev_gid;
    
    // Create a new range record
    range_rec.first = gid;
    range_rec.last = gid;
    range_rec.value = klass;
    
    // Copy the new range record
    record = c->copy (range_rec);
    if (unlikely (!record)) return_trace (false);
    
    // Increment number of ranges
    num_ranges++;
  }
  
  // Update previous values
  prev_gid = gid;
  prev_klass = klass;
}

// Finalize the last range
record->last = prev_gid;

// Update the range record length
rangeRecord.len = num_ranges;

// Sort the records to handle any unsorted glyph order
rangeRecord.as_array ().qsort ();

return_trace (true);