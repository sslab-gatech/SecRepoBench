for (const auto gid_klass_pair : it)
{
  hb_codepoint_t cur_gid = gid_klass_pair.first;
  unsigned cur_klass = gid_klass_pair.second;
  num_glyphs++;
  if (cur_gid == glyph_min) continue;
  if (cur_gid > glyph_max) glyph_max = cur_gid;
  if (cur_gid!= prev_gid + 1 ||
      cur_klass!= prev_klass)
  {
    if (unlikely (!record.serialize (c, range_rec)))
      return_trace (false);
    range_rec.first = cur_gid;
    range_rec.last = cur_gid;
    range_rec.value = cur_klass;
  }
  else
  {
    range_rec.last = cur_gid;
  }
  prev_gid = cur_gid;
  prev_klass = cur_klass;
}
if (unlikely (!record.serialize (c, range_rec)))
  return_trace (false);