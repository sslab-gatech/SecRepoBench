for (++iterator; iterator; ++iterator)
{
  hb_codepoint_t gid = (*iterator).first;
  unsigned klass = (*iterator).second;

  if (gid == prev_gid + 1 && klass == prev_klass)
  {
    // Continuation of the current range.
    range_rec.last = gid;
  }
  else
  {
    // Finalize the current range and start a new one.
    num_ranges++;
    range_rec.first = gid;
    range_rec.last = gid;
    range_rec.value = klass;
    auto *new_record = c->copy(range_rec);
    if (unlikely(!new_record))
      return_trace(false);
  }

  prev_gid = gid;
  prev_klass = klass;
}

// Update the overall range record length.
rangeRecord.len = num_ranges;

// Sort the range records by their starting glyph ID.
std::sort(reinterpret_cast<RangeRecord<Types>*>(c->base),
          reinterpret_cast<RangeRecord<Types>*>(c->base) + num_ranges,
          [](const RangeRecord<Types> &a, const RangeRecord<Types> &b)
          {
            return a.first < b.first;
          });

return_trace(true);