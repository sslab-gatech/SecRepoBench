for (const hb_pair_t<hb_codepoint_t, uint32_t> gid_klass_pair : it)
    {
      hb_codepoint_t cur_gid = gid_klass_pair.first;
      unsigned cur_klass = gid_klass_pair.second;

      if (cur_gid != prev_gid + 1 || cur_klass != prev_klass)
      {
        record->last = prev_gid;
        record = c->copy (range_rec);
        if (unlikely (!record)) return_trace (false);

        range_rec.first = cur_gid;
        range_rec.value = cur_klass;
        num_ranges++;
      }

      prev_gid = cur_gid;
      prev_klass = cur_klass;
    }

    record->last = prev_gid;
    rangeRecord.len = num_ranges;

    // Sort the range records to handle any unsorted glyph order
    rangeRecord.sort ();

    return_trace (true);