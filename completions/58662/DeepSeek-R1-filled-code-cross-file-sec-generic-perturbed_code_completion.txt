for (; iterator; ++iterator)
{
    hb_codepoint_t cur_gid = (*iterator).first;
    unsigned cur_klass = (*iterator).second;

    if (cur_gid == prev_gid + 1 && cur_klass == prev_klass)
    {
        range_rec.last = cur_gid;
        prev_gid = cur_gid;
    }
    else
    {
        auto *new_record = c->copy (range_rec);
        if (unlikely (!new_record)) return_trace (false);
        num_ranges++;

        range_rec.first = cur_gid;
        range_rec.last = cur_gid;
        range_rec.value = cur_klass;
        prev_gid = cur_gid;
        prev_klass = cur_klass;
    }
}

auto *new_record = c->copy (range_rec);
if (unlikely (!new_record)) return_trace (false);
num_ranges++;

rangeRecord.len = num_ranges;
rangeRecord.qsort ();

return_trace (true);