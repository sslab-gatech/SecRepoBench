for (auto it_ = iterator; it_; ++it_)
    {
      hb_codepoint_t cur_gid = (*it_).first;
      unsigned cur_klass = (*it_).second;
      if (cur_gid != prev_gid + 1 ||
	  cur_klass != prev_klass)
      {
	range_rec.last = prev_gid;
	record = c->copy (range_rec);
	if (unlikely (!record)) return_trace (false);
	num_ranges++;
	range_rec.first = cur_gid;
	range_rec.last = cur_gid;
	range_rec.value = cur_klass;
      }
      prev_gid = cur_gid;
      prev_klass = cur_klass;
    }
    range_rec.last = prev_gid;
    record = c->copy (range_rec);
    if (unlikely (!record)) return_trace (false);
    rangeRecord.len = num_ranges;
    rangeRecord.sort ();
    return_trace (true);