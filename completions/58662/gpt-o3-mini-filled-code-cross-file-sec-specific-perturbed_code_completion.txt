for (++iterator; iterator; ++iterator)
{
  hb_codepoint_t cur_gid = iterator->first;
  unsigned cur_klass = iterator->second;
  if (cur_gid == prev_gid + 1 && cur_klass == prev_klass)
  {
    // Continuation of the current range; update the last glyph ID in the serialized record.
    record->last = cur_gid;
  }
  else
  {
    // Discontinuity: finalize the current range and start a new one.
    RangeRecord<Types> new_range;
    new_range.first = cur_gid;
    new_range.last  = cur_gid;
    new_range.value = cur_klass;
    auto *new_record = c->copy(new_range);
    if (unlikely(!new_record))
      return_trace(false);
    record = new_record;
    ++num_ranges;
  }
  prev_gid   = cur_gid;
  prev_klass = cur_klass;
}

// Finalize the range record count.
rangeRecord.len = num_ranges;

// Sort the range records in ascending order by their starting glyph ID.
std::sort(rangeRecord.records, rangeRecord.records + num_ranges,
          [](const RangeRecord<Types> &a, const RangeRecord<Types> &b) {
            return a.first < b.first;
          });

return_trace(true);