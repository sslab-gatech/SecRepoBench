for (++iterator; iterator; ++iterator)
{
  hb_codepoint_t cur_gid = (*iterator).first;
  unsigned cur_klass = (*iterator).second;

  if (cur_gid == prev_gid || (cur_gid == prev_gid + 1 && cur_klass == prev_klass))
  {
    range_rec.last = cur_gid;
  }
  else
  {
    num_ranges++;
    record = c->copy (range_rec);
    if (unlikely (!record)) return_trace (false);

    range_rec.first = cur_gid;
    range_rec.last = cur_gid;
    range_rec.value = cur_klass;
  }

  prev_gid = cur_gid;
  prev_klass = cur_klass;
}

record = c->copy (range_rec);
if (unlikely (!record)) return_trace (false);

classFormat = 2;
rangeRecord.len = num_ranges;

return_trace (true);