iterator++;
    while (iterator.more()) {
      const auto& current = *iterator;
      hb_codepoint_t current_gid = current.first;
      unsigned current_klass = current.second;

      if (current_gid != prev_gid + 1 || current_klass != prev_klass) {
        range_rec.last = prev_gid;
        auto *record = c->copy(range_rec);
        if (unlikely(!record)) return_trace(false);
        range_rec.first = current_gid;
        range_rec.last = current_gid;
        range_rec.value = current_klass;
        prev_gid = current_gid;
        prev_klass = current_klass;
      } else {
        prev_gid = current_gid;
        prev_klass = current_klass;
        range_rec.last = current_gid;
      }
      iterator++;
    }
    range_rec.last = prev_gid;
    auto *record = c->copy(range_rec);
    if (unlikely(!record)) return_trace(false);
    range_rec.len = num_ranges;
    return_trace(true);