for (; iterator; ++iterator)
{
    hb_codepoint_t gid = (*iterator).first;
    unsigned klass = (*iterator).second;

    if (gid == prev_gid + 1 && klass == prev_klass)
    {
        record->last = gid;
    }
    else
    {
        range_rec.first = gid;
        range_rec.last = gid;
        range_rec.value = klass;
        record = c->copy (range_rec);
        if (unlikely (!record)) return_trace (false);
        num_ranges++;
    }

    prev_gid = gid;
    prev_klass = klass;
}

rangeRecord.len = num_ranges;
rangeRecord.as_array (num_ranges).qsort ();

return_trace (true);