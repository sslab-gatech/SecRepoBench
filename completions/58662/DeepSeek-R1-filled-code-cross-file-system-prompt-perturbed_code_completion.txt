for (++iterator; iterator; ++iterator)
{
    hb_codepoint_t current_gid = (*iterator).first;
    unsigned current_klass = (*iterator).second;

    if (current_gid == prev_gid + 1 && current_klass == prev_klass)
    {
        record->last = current_gid;
    }
    else
    {
        num_ranges++;
        RangeRecord<Types> new_range;
        new_range.first = current_gid;
        new_range.last = current_gid;
        new_range.value = current_klass;
        record = c->copy (new_range);
        if (unlikely (!record)) return_trace (false);
    }

    prev_gid = current_gid;
    prev_klass = current_klass;
}

rangeRecord.len = num_ranges;
rangeRecord.qsort ();

return_trace (true);