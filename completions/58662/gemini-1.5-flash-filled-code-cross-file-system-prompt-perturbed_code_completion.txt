for (++iterator; iterator; ++iterator) {
      hb_codepoint_t gid = (*iterator).first;
      unsigned klass = (*iterator).second;

      if (klass == prev_klass && gid == prev_gid + 1) {
	range_rec.last = gid;
      } else {
	record->last = prev_gid;
	record = c->copy (range_rec);
	if (unlikely (!record)) return_trace (false);
	range_rec.first = gid;
	range_rec.last = gid;
	range_rec.value = klass;
	num_ranges++;
      }
      prev_gid = gid;
      prev_klass = klass;
    }
    record->last = prev_gid;
    rangeRecord.len = num_ranges;
    rangeRecord.arrayZ = c->copy (rangeRecord.arrayZ, num_ranges);
    if (unlikely (!rangeRecord.arrayZ)) return_trace (false);
    classFormat = 2;
    return_trace (true);