for (++iterator; iterator; ++iterator) {
      hb_codepoint_t cur_gid = (*iterator).first;
      unsigned cur_klass = (*iterator).second;

      if (cur_gid == range_rec.last + 1 && cur_klass == range_rec.value) {
        range_rec.last = cur_gid;
      } else {
        num_ranges++;
        auto *new_record = c->copy (range_rec);
        if (unlikely (!new_record)) return_trace (false);
        range_rec.first = cur_gid;
        range_rec.last = cur_gid;
        range_rec.value = cur_klass;
      }
    }

    auto *last_record = c->copy (range_rec);
    if (unlikely (!last_record)) return_trace (false);

    rangeRecord.len = num_ranges;
    classFormat = 1;
    return_trace (true);