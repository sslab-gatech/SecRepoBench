iterator++;
for (; iterator; iterator++)
{
  hb_codepoint_t cur_gid = (*iterator).first;
  unsigned cur_klass = (*iterator).second;
  
  if (cur_gid != prev_gid + 1 || cur_klass != prev_klass)
  {
    // This glyph starts a new range
    
    // Create a new range record
    range_rec.first = cur_gid;
    range_rec.last = cur_gid;
    range_rec.value = cur_klass;
    
    record = c->copy (range_rec);
    if (unlikely (!record)) return_trace (false);
    
    num_ranges++;
  }
  
  prev_gid = cur_gid;
  prev_klass = cur_klass;
}

// Finalize the last range
record->last = prev_gid;

classFormat = 2;
rangeRecord.len = num_ranges;

// Sort the range records
rangeRecord.sort (c);

return_trace (true);