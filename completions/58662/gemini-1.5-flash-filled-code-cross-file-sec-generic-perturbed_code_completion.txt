for (++iterator; iterator; ++iterator) {
      hb_codepoint_t cur_gid = (*iterator).first;
      unsigned cur_klass = (*iterator).second;

      if (cur_klass != prev_klass || cur_gid != prev_gid + 1) {
        record->last = prev_gid;
        auto *new_record = c->copy (RangeRecord<Types>{cur_gid, cur_gid, cur_klass});
        if (unlikely (!new_record)) return_trace (false);
        record = new_record;
        num_ranges++;
      }
      prev_gid = cur_gid;
      prev_klass = cur_klass;
    }
    record->last = prev_gid;
    rangeRecord.len = num_ranges;
    rangeRecord.ranges = c->sort (num_ranges);
    return_trace (true);