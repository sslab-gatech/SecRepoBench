if (!ip_port_separator) {
  return 1;
}

{
  const char *start_of_ip = (const char *)packet_data->payload + NDPI_STATICSTRING_LEN("IP=");
  ip_len = ip_port_separator - start_of_ip;
  ip_len = ndpi_min(ip_len, sizeof(flow->protos.softether.ip) - 1);

  strncpy(flow->protos.softether.ip, start_of_ip, ip_len);
  flow->protos.softether.ip[ip_len] = '\0';
}