if (tlvDataBasePtr == NULL || tlvDataLength == 0) 
{
    TLVRecordType nullRec;
    nullRec.assign(NULL);
    return nullRec;
}

size_t len = 0;
uint8_t tag = tlvDataBasePtr[0];
if (tag & 0x80) 
{
    // two bytes tag
    if (tlvDataLength < 2) 
        return TLVRecordType();
    len = 2;
    tag = ((tag & 0x3F) << 8) + tlvDataBasePtr[1];
} 
else 
{
    len = 1;
}

if (tlvDataLength < len + 1) 
    return TLVRecordType();

size_t length = tlvDataBasePtr[len];
if (tag & 0x20) 
{
    // two bytes length
    if (tlvDataLength < len + 2) 
        return TLVRecordType();
    length = ((length & 0x0F) << 8) + tlvDataBasePtr[len + 1];
    len += 1;
} 
else 
{
    len += 1;
}

if (tlvDataLength < len + length) 
    return TLVRecordType();

TLVRecordType rec;
rec.assign(tlvDataBasePtr + len, length);
return rec;