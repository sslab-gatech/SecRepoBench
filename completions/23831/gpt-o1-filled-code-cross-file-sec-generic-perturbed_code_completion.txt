packetlength = packet->payload_packet_len;

if(packetlength == 12) {
  NDPI_LOG_DBG2(ndpi_struct, "IAX detected: payload length is 12\n");
  ndpi_set_detected_protocol(ndpi_struct, flow, NDPI_PROTOCOL_IAX);
  return;
} else {
  i = 12;
  while((i + 2) <= packetlength) {
    u_int8_t ie_type = packet->payload[i];
    u_int8_t ie_len = packet->payload[i + 1];
    if((i + 2 + ie_len) > packetlength) {
      /* Not a valid IAX packet if we exceed payload length */
      break;
    }
    i += 2 + ie_len;
    if(i == packetlength) {
      NDPI_LOG_DBG2(ndpi_struct, "IAX detected via information elements\n");
      ndpi_set_detected_protocol(ndpi_struct, flow, NDPI_PROTOCOL_IAX);
      return;
    }
  }
}