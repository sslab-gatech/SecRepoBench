if (packet->payload_packet_len == 12) {
    NDPI_LOGDetection(ndpi_struct, flow, NDPI_PROTOCOL_IAX, "IAX packet detected (length 12)");
    ndpi_add_connection(ndpi_struct, flow);
} else {
    u_int16_t next_pos = 12;
    while (next_pos < packet->payload_packet_len) {
        u_int16_t current_len = get_u_int16_t(packet->payload, next_pos);
        if (next_pos + current_len > packet->payload_packet_len) {
            break;
        }
        next_pos += current_len;
    }
    if (next_pos == packet->payload_packet_len) {
        NDPI_LOGDetection(ndpi_struct, flow, NDPI_PROTOCOL_IAX, "IAX packet detected (full parse)");
        ndpi_add_connection(ndpi_struct, flow);
    }
}