packetlength = packet->payload_packet_len;

if (packetlength == 12) {
  NDPI_LOG_INFO(ndpi_struct, "Detected IAX with payload length of 12\n");
  ndpi_int_add_connection(ndpi_struct, flow, NDPI_PROTOCOL_IAX, NDPI_REAL_PROTOCOL);
} else {
  u_int8_t *current_pos = packet->payload + 12;
  u_int8_t *end_pos = packet->payload + packetlength;

  while (current_pos < end_pos) {
    u_int8_t elem_length = current_pos[1];
    u_int8_t *next_elem = current_pos + elem_length;

    if (next_elem == end_pos) {
      NDPI_LOG_INFO(ndpi_struct, "Detected IAX by iterating through information elements\n");
      ndpi_int_add_connection(ndpi_struct, flow, NDPI_PROTOCOL_IAX, NDPI_REAL_PROTOCOL);
      break;
    }

    current_pos = next_elem;
  }
}