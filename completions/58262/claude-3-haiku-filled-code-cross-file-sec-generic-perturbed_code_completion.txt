if ( fieldnames_vl == NULL ) {
    hsize_t nfields;
    herr_t herr;

    // Open the attribute "MATLAB_fields" from the dataset to retrieve its dataspace
    attr_id = H5Aopen_by_name(dsethandle, ".", "MATLAB_fields", H5P_DEFAULT, H5P_DEFAULT);
    if (attr_id < 0) {
        H5Sclose(space_id);
        return MATIO_E_GENERIC_READ_ERROR;
    }

    // Get the dataspace associated with the attribute to determine the number of fields
    space_id = H5Aget_space(attr_id);
    nfields = H5Sget_simple_extent_npoints(space_id);
    if (nfields == 0) {
        H5Sclose(space_id);
        H5Aclose(attr_id);
        return MATIO_E_GENERIC_READ_ERROR;
    }

    // Allocate memory to store the field names as variable-length structures
    fieldnames_vl = (hvl_t *)malloc(nfields * sizeof(hvl_t));
    if (fieldnames_vl == NULL) {
        H5Sclose(space_id);
        H5Aclose(attr_id);
        return MATIO_E_OUT_OF_MEMORY;
    }

    // Read the field names from the attribute
    field_id = H5Aget_type(attr_id);
    herr = H5Aread(attr_id, field_id, fieldnames_vl);
    if (herr < 0) {
        free(fieldnames_vl);
        H5Sclose(space_id);
        H5Aclose(attr_id);
        H5Tclose(field_id);
        return MATIO_E_GENERIC_READ_ERROR;
    }

    *nfields = nfields;
}