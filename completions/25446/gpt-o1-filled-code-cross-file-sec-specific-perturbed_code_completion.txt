u_int16_t realm_offset = name_offset + 1 + cname_len;

  /* Check if this cname string looks like a hostname (ends with '$') or a username. */
  if(cname_len && cname_str[cname_len-1] == '$') {
    cname_str[cname_len-1] = '\0';
    snprintf(flow->protos.kerberos.hostname, sizeof(flow->protos.kerberos.hostname), "%s", cname_str);
  } else {
    snprintf(flow->protos.kerberos.username, sizeof(flow->protos.kerberos.username), "%s", cname_str);
  }

  /* Increment realm_offset by scanning up to 20 bytes for the ASN.1 identifier 0x1b
     or until we reach the packet boundary. */
  for(i = 0; i < 20 && realm_offset < flow_packet->payload_packet_len; i++) {
    if(flow_packet->payload[realm_offset] == 0x1b) {
      break;
    }
    realm_offset++;
  }

#ifdef KERBEROS_DEBUG
  if((realm_offset + 1) < flow_packet->payload_packet_len) {
    printf("realm_offset=%u [%02X %02X] [byte 0 must be 0x1b]\n",
           realm_offset,
           flow_packet->payload[realm_offset],
           flow_packet->payload[realm_offset+1]);
  }
#endif