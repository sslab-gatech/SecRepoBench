{
  /* Determine if cname_str represents a hostname or a username */
  if (cname_len > 0 && cname_str[cname_len - 1] == '$') {
    /* Strip the trailing '$' and store as hostname */
    cname_str[cname_len - 1] = '\0';
    snprintf(flow->protos.kerberos.hostname, sizeof(flow->protos.kerberos.hostname), "%s", cname_str);
  } else {
    /* Otherwise, store as username */
    snprintf(flow->protos.kerberos.username, sizeof(flow->protos.kerberos.username), "%s", cname_str);
  }

  /* Calculate the offset for the Kerberos realm data by scanning forward 
     from the end of the cname field until we find the ASN.1 identifier 0x1b,
     or until a maximum of 20 iterations to ensure we don't run past the payload */
  realm_offset = name_offset + 1 + cname_len;
  for (i = 0; realm_offset < flow_packet->payload_packet_len && i < 20; i++) {
    if (flow_packet->payload[realm_offset] == 0x1b)
      break;
    realm_offset++;
  }
}