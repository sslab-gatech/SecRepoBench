if(cname_len > 0 && cname_str[cname_len - 1] == '$') {
  /* Remove trailing '$' and store as hostname */
  cname_str[cname_len - 1] = '\0';
  snprintf(flow->protos.kerberos.hostname, sizeof(flow->protos.kerberos.hostname), "%s", cname_str);
} else {
  /* Otherwise, store as username */
  snprintf(flow->protos.kerberos.username, sizeof(flow->protos.kerberos.username), "%s", cname_str);
}

/* Calculate the offset for the Kerberos realm data.
 * We assume that immediately after the cname string (preceded by its length byte)
 * the realm ASN.1 field appears. However, to be safe, we scan forward until we find
 * the expected ASN.1 identifier (0x1b), but we limit the number of iterations.
 */
realm_offset = name_offset + 1 + cname_len;  // Start just after the cname string data
{
  unsigned int scan_count = 0;
  while(realm_offset < flow_packet->payload_packet_len && scan_count < 20) {
    if(flow_packet->payload[realm_offset] == 0x1b)
      break;
    realm_offset++;
    scan_count++;
  }
}