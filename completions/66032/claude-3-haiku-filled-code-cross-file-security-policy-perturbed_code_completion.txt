//probe_data is now the first element of the document, if XML
//we should refine by getting the xmlns attribute value rather than searching for its value...
const char *xmlns = NULL;
const char *p = probe_data;
while (probelength) {
    //skip leading whitespace
    while (probelength && strchr(" \t\r\n", *p)) {
        p++;
        probelength--;
    }
    if (!probelength) break;

    //check for xmlns attribute
    if (!strncmp(p, "xmlns=", 6)) {
        p += 6;
        probelength -= 6;
        if (*p == '"') {
            p++;
            probelength--;
            const char *end = strchr(p, '"');
            if (end) {
                xmlns = gf_strdup_until(p, end);
                probelength -= (u32)(end - p + 1);
                p = end + 1;
            } else {
                probelength = 0;
            }
        }
    } else {
        //skip to next space or end of line
        while (probelength && *p && !strchr(" \t\r\n", *p)) {
            p++;
            probelength--;
        }
    }
}

if (xmlns) {
    if (!strcmp(xmlns, "http://www.w3.org/1999/XSL/Transform")) {
        mime_type = "application/xslt+xml";
    } else if (!strcmp(xmlns, "http://www.w3.org/2000/svg")) {
        mime_type = "image/svg+xml";
    } else if (!strcmp(xmlns, "http://www.w3.org/1999/xhtml")) {
        mime_type = "application/xhtml+xml";
    } else if (!strcmp(xmlns, "http://www.w3.org/1998/Math/MathML")) {
        mime_type = "application/mathml+xml";
    }
    gf_free((void*)xmlns);
}