while (probelength) {
	/* Skip leading whitespace and newline characters */
	while (probelength && (probe_data[0] == ' ' || probe_data[0] == '\t' || probe_data[0] == '\n' || probe_data[0] == '\r')) {
		probe_data++;
		probelength--;
	}
	if (!probelength) break;

	/* Skip XML comment <!-- ... --> */
	if (probelength >= 4 && !strncmp((const char *)probe_data, "<!--", 4)) {
		const char *end = my_strstr(probe_data + 4, "-->", probelength - 4);
		if (!end) {
			/* no closing comment found, skip everything */
			probe_data += probelength;
			probelength = 0;
			break;
		}
		u32 skip_count = (u32)((end - (const char *)probe_data) + 3);
		probe_data += skip_count;
		probelength -= skip_count;
		continue;
	}

	/* Skip XML declaration <?xml ... ?> */
	if (probelength >= 5 && !strncmp((const char *)probe_data, "<?xml", 5)) {
		const char *end = my_strstr(probe_data + 5, "?>", probelength - 5);
		if (!end) {
			/* no closing ?> found, skip everything */
			probe_data += probelength;
			probelength = 0;
			break;
		}
		u32 skip_count = (u32)((end - (const char *)probe_data) + 2);
		probe_data += skip_count;
		probelength -= skip_count;
		continue;
	}

	/* Skip DOCTYPE <!DOCTYPE ... > */
	if (probelength >= 9 && !strncmp((const char *)probe_data, "<!DOCTYPE", 9)) {
		const char *end = my_strstr(probe_data + 9, ">", probelength - 9);
		if (!end) {
			/* no closing > found, skip everything */
			probe_data += probelength;
			probelength = 0;
			break;
		}
		u32 skip_count = (u32)((end - (const char *)probe_data) + 1);
		probe_data += skip_count;
		probelength -= skip_count;
		continue;
	}

	/* No more recognizable patterns */
	break;
}