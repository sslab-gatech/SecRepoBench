// Strip leading whitespace and newline
while (probelength && strchr("\n\r\t ", (char) probe_data[0])) {
    probe_data++;
    probelength--;
}

// Skip XML declaration if present
if (probelength > 5 && !strncmp((const char*)probe_data, "<?xml", 5)) {
    const u8 *end = (const u8*)my_strstr((const char*)probe_data, "?>", probelength);
    if (end) {
        u32 skip_len = (u32)(end - probe_data) + 2; // +2 for ?>
        if (skip_len < probelength) {
            probe_data += skip_len;
            probelength -= skip_len;
            
            // After XML declaration, strip whitespace again
            while (probelength && strchr("\n\r\t ", (char) probe_data[0])) {
                probe_data++;
                probelength--;
            }
        }
    }
}

// Skip DOCTYPE declaration if present
if (probelength > 9 && !strncmp((const char*)probe_data, "<!DOCTYPE", 9)) {
    const u8 *end = NULL;
    u32 i = 9;
    u32 depth = 1;
    
    while (i < probelength) {
        if (probe_data[i] == '>') {
            depth--;
            if (depth == 0) {
                end = &probe_data[i];
                break;
            }
        } else if (probe_data[i] == '<') {
            depth++;
        }
        i++;
    }
    
    if (end) {
        u32 skip_len = (u32)(end - probe_data) + 1; // +1 for >
        if (skip_len < probelength) {
            probe_data += skip_len;
            probelength -= skip_len;
            
            // After DOCTYPE, strip whitespace again
            while (probelength && strchr("\n\r\t ", (char) probe_data[0])) {
                probe_data++;
                probelength--;
            }
        }
    }
}

// Skip comments
while (probelength > 4 && !strncmp((const char*)probe_data, "<!--", 4)) {
    const u8 *end = (const u8*)my_strstr((const char*)probe_data, "-->", probelength);
    if (end) {
        u32 skip_len = (u32)(end - probe_data) + 3; // +3 for -->
        if (skip_len < probelength) {
            probe_data += skip_len;
            probelength -= skip_len;
            
            // After a comment, strip whitespace again
            while (probelength && strchr("\n\r\t ", (char) probe_data[0])) {
                probe_data++;
                probelength--;
            }
        } else {
            break;
        }
    } else {
        break;
    }
}