char *tmp_data = (char *)probe_data;
	while (probelength && tmp_data[0] && strchr("\n\r\t ", (char) tmp_data[0])) {
		tmp_data ++;
		probelength--;
	}
	probe_data = (const u8 *)tmp_data;

	if (probelength > 5 && !strncmp((char*)probe_data, "<?xml", 5)) {
		char *doctype_start = my_strstr(probe_data, "<!DOCTYPE", probelength);
		if (doctype_start) {
			char *doctype_end = my_strstr(doctype_start, ">", probelength - (u32)(doctype_start - (char*)probe_data));
			if (doctype_end) {
				ptrdiff_t offset = doctype_end - (char*)probe_data + 1;
				if (offset >= 0 && offset <= (ptrdiff_t)probelength) {
					probe_data = (const u8 *)doctype_end + 1;
					probelength -= (u32)offset;

					// Remove leading whitespace after DOCTYPE
					tmp_data = (char *)probe_data;
					while (probelength && tmp_data[0] && strchr("\n\r\t ", (char) tmp_data[0])) {
						tmp_data ++;
						probelength--;
					}
					probe_data = (const u8 *)tmp_data;
				}
			}
		}

		//remove XML header
		char *xml_header_end = my_strstr(probe_data, "?>", probelength);
		if (xml_header_end && ((char*)probe_data == my_strstr(probe_data, "<?xml", probelength))) {
			ptrdiff_t offset = xml_header_end - (char*)probe_data + 2;
			if (offset >= 0 && offset <= (ptrdiff_t)probelength) {
				probe_data = (const u8 *)xml_header_end + 2;
				probelength -= (u32)offset;

				// Remove leading whitespace after XML header
				tmp_data = (char *)probe_data;
				while (probelength && tmp_data[0] && strchr("\n\r\t ", (char) tmp_data[0])) {
					tmp_data ++;
					probelength--;
				}
				probe_data = (const u8 *)tmp_data;
			}
		}

		//remove XML comments
		char *comment_start = my_strstr(probe_data, "<!--", probelength);
		while (comment_start) {
			char *comment_end = my_strstr(comment_start, "-->", probelength - (u32)(comment_start - (char*)probe_data));
			if (!comment_end) break;

			ptrdiff_t start_offset = comment_start - (char*)probe_data;
			ptrdiff_t end_offset = comment_end - (char*)probe_data + 3;

			if (start_offset >= 0 && start_offset <= (ptrdiff_t)probelength && end_offset >= 0 && end_offset <= (ptrdiff_t)probelength) {
				memmove((char*)probe_data + start_offset, (char*)probe_data + end_offset, probelength - (u32)end_offset);
				probelength -= (u32)(end_offset - start_offset);
				// Null-terminate the string to prevent reading beyond the buffer
				((char*)probe_data)[probelength] = '\0';
			} else {
				break; // Prevent infinite loop if offsets are invalid
			}
			comment_start = my_strstr(probe_data, "<!--", probelength);
		}
	}