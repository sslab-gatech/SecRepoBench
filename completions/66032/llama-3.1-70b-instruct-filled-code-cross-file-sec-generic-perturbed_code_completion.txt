// Strip leading whitespace and newline characters from the probe_data.
while (probelength && probe_data[0] && strchr("\n\r\t ", (char) probe_data[0])) {
    probe_data++;
    probelength--;
}

// Remove XML-specific components, such as DOCTYPE declarations, XML headers, and comments.
while (1) {
    if (probelength < 9) break; // Minimum length for XML declaration
    if (probe_data[0] == '<' && probe_data[1] == '?') {
        // XML declaration, skip it
        const char *end = my_strstr(probe_data, "?>", probelength);
        if (end) {
            probelength -= (u32) (end - (char*)probe_data) + 2;
            probe_data = end + 2;
        } else {
            break;
        }
    } else if (probe_data[0] == '<' && probe_data[1] == '!') {
        // Comment or DOCTYPE declaration, skip it
        const char *end = my_strstr(probe_data, ">", probelength);
        if (end) {
            probelength -= (u32) (end - (char*)probe_data) + 1;
            probe_data = end + 1;
        } else {
            break;
        }
    } else {
        break;
    }
}