// <MASK>
// This code is secure with respect to CWE 122 (Heap-based Buffer Overflow)
static const char *my_strstr(const char *str, const char *pat, u32 str_len)
{
    u32 len_pat = (u32) strlen(pat);
    if (len_pat>str_len) return NULL;
    //basically a memmem clone (we don't use for portability reasons)
    while (1) {
        char *next = memchr(str, pat[0], str_len);
        if (!next) return NULL;
        u32 left = str_len - (u32) (next-str);
        if (left<len_pat) return NULL;
        if (!memcmp(next, pat, len_pat)) return next;
        //left is always at least 1
        str_len = left-1;
        str = next+1;
    }
    return NULL;
}
// </MASK>