{
    /* Strip any leading whitespace characters */
    while (probelength && strchr("\n\r\t ", (char)probe_data[0])) {
        probe_data++;
        probelength--;
    }

    /* If the document starts with an XML declaration, skip it */
    if (probelength >= 5 && !strncmp((const char *)probe_data, "<?xml", 5)) {
        const char *end_decl = my_strstr(probe_data, "?>", probelength);
        if (end_decl) {
            u32 skip = (u32)((end_decl - (const char *)probe_data) + 2);
            probe_data += skip;
            probelength -= skip;
        }
    }

    /* Continue skipping any DOCTYPE declarations */
    while (probelength) {
        /* Skip leading whitespace */
        while (probelength && strchr("\n\r\t ", (char)probe_data[0])) {
            probe_data++;
            probelength--;
        }
        /* Skip DOCTYPE if present */
        if (probelength >= 9 && !strncmp((const char *)probe_data, "<!DOCTYPE", 9)) {
            const char *end_doctype = my_strstr(probe_data, ">", probelength);
            if (end_doctype) {
                u32 skip = (u32)((end_doctype - (const char *)probe_data) + 1);
                probe_data += skip;
                probelength -= skip;
                continue;
            }
        }
        /* Skip XML comments */
        if (probelength >= 4 && !strncmp((const char *)probe_data, "<!--", 4)) {
            const char *end_comment = my_strstr(probe_data, "-->", probelength);
            if (end_comment) {
                u32 skip = (u32)((end_comment - (const char *)probe_data) + 3);
                probe_data += skip;
                probelength -= skip;
                continue;
            }
        }
        break;
    }
}