if (aux[0] == 'R' && aux[1] == 'G') {
    brg = sam_hrecs_find_rg(filedescriptor->header->hrecs, aux+3);
    if (!brg) {
        hts_log_warning("RG:Z:%s header line is missing", aux+3);
    }
}

if (aux[0] == 'M' && aux[1] == 'D' && aux[2] == 'Z') {
    if (verbatim_MD) {
        if (CRAM_MAJOR_VERS(filedescriptor->version) >= 4)
            BLOCK_APPEND_CHAR(td_b, '*');
    } else {
        BLOCK_APPEND_CHAR(td_b, 'M');
        BLOCK_APPEND_CHAR(td_b, 'D');
        BLOCK_APPEND_CHAR(td_b, 'Z');
    }
} else if (aux[0] == 'N' && aux[1] == 'M') {
    if (verbatim_NM) {
        if (CRAM_MAJOR_VERS(filedescriptor->version) >= 4)
            BLOCK_APPEND_CHAR(td_b, '*');
    } else {
        BLOCK_APPEND_CHAR(td_b, 'N');
        BLOCK_APPEND_CHAR(td_b, 'M');
        BLOCK_APPEND_CHAR(td_b, aux[2]);
    }
} else {
    BLOCK_APPEND(td_b, aux, 3);
}

key = c->comp_hdr->TD_keys + BLOCK_SIZE(td_b);
k = kh_put(m_s2i, c->comp_hdr->TD_hash, key, &r);
if (r < 0) {
    return NULL;
}

if (r != 0) {
    kh_val(c->comp_hdr->TD_hash, k) = c->comp_hdr->nTL;
    c->comp_hdr->nTL++;
}

if (!(tm = cram_codec_init(c->comp_hdr, aux[2], CRAM_EXTERNAL, 
                           kh_val(c->comp_hdr->TD_hash, k),
                           filedescriptor->version))) {
    return NULL;
}

r |= tm->store(s, tm, aux+3, aux_end - (aux+3));
if (r) return NULL;

aux = aux_end;