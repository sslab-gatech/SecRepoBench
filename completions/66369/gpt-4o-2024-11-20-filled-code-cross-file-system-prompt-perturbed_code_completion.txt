// Extract the tag name and type
        char tag[3];
        tag[0] = aux[0];
        tag[1] = aux[1];
        tag[2] = aux[2];
        aux += 3;

        // Handle RG:Z (Read Group) tag
        if (tag[0] == 'R' && tag[1] == 'G' && tag[2] == 'Z') {
            if (!brg) {
                brg = sam_hrecs_find_rg(filedescriptor->header->hrecs, aux);
                if (!brg) {
                    hts_log_warning("RG tag refers to unknown read group '%s'", aux);
                }
            }
        }

        // Handle MD:Z (Mismatch Description) tag
        if (tag[0] == 'M' && tag[1] == 'D' && tag[2] == 'Z') {
            if (verbatim_MD) {
                BLOCK_APPEND(td_b, tag, 3);
                BLOCK_APPEND(td_b, aux, strlen(aux) + 1);
            } else {
                // Skip MD tag if not verbatim
                aux += strlen(aux) + 1;
                continue;
            }
        }

        // Handle NM:i (Number of Mismatches) tag
        if (tag[0] == 'N' && tag[1] == 'M' && tag[2] == 'i') {
            if (verbatim_NM) {
                BLOCK_APPEND(td_b, tag, 3);
                BLOCK_APPEND(td_b, aux, 4); // Assuming NM is a 4-byte integer
            } else {
                // Skip NM tag if not verbatim
                aux += 4;
                continue;
            }
        }

        // Add the tag to the tag dictionary block
        BLOCK_APPEND(td_b, tag, 3);

        // Determine the type of the tag and append its value
        switch (tag[2]) {
        case 'A': // Character
            BLOCK_APPEND(td_b, aux, 1);
            aux += 1;
            break;
        case 'i': // Integer
        case 'I': // Unsigned integer
            BLOCK_APPEND(td_b, aux, 4);
            aux += 4;
            break;
        case 'f': // Float
            BLOCK_APPEND(td_b, aux, 4);
            aux += 4;
            break;
        case 'Z': // String
        case 'H': // Hex string
            BLOCK_APPEND(td_b, aux, strlen(aux) + 1);
            aux += strlen(aux) + 1;
            break;
        case 'B': // Array
            {
                int32_t len;
                memcpy(&len, aux + 1, 4);
                len = le_int4(len);
                BLOCK_APPEND(td_b, aux, 5 + len);
                aux += 5 + len;
            }
            break;
        default:
            hts_log_warning("Unknown aux type '%c' for tag %.2s", tag[2], tag);
            goto err;
        }