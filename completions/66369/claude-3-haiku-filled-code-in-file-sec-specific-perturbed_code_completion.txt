// <MASK>
khash_t(map) *pmap = h->preservation_map;
int r;
k = kh_put(map, pmap, "RN", &r);
if (-1 == r) return NULL;
kh_val(pmap, k).i = !fd->lossy_read_names;

k = kh_put(map, pmap, "SM", &r);
if (-1 == r) return NULL;
kh_val(pmap, k).i = 0;

k = kh_put(map, pmap, "TD", &r);
if (-1 == r) return NULL;
kh_val(pmap, k).i = 0;

k = kh_put(map, pmap, "AP", &r);
if (-1 == r) return NULL;
kh_val(pmap, k).i = h->AP_delta;

if (CRAM_MAJOR_VERS(fd->version) >= 4) {
    k = kh_put(map, pmap, "QO", &r);
    if (-1 == r) return NULL;
    kh_val(pmap, k).i = h->qs_seq_orient;
}

if (no_ref || embed_ref>0) {
    k = kh_put(map, pmap, "RR", &r);
    if (-1 == r) return NULL;
    kh_val(pmap, k).i = 0;
}