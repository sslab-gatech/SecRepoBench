// Ensure the auxiliary tag is null-terminated before processing
        if (aux_end - aux < 3 || aux[2] != 0) {
            goto err;
        }

        // Check for RG:Z tag
        if (aux[0] == 'R' && aux[1] == 'G' && aux[2] == 'Z') {
            char *rg = aux + 3;
            size_t rg_len = strnlen(rg, aux_end - rg);
            if (rg_len >= aux_end - rg) {
                goto err;
            }
            rg += rg_len + 1; // Move past the null terminator
            if (rg >= aux_end) {
                goto err;
            }
            aux = rg;
            continue;
        }

        // Check for MD:Z tag
        if (aux[0] == 'M' && aux[1] == 'D' && aux[2] == 'Z') {
            char *md = aux + 3;
            size_t md_len = strnlen(md, aux_end - md);
            if (md_len >= aux_end - md) {
                goto err;
            }
            md += md_len + 1; // Move past the null terminator
            if (md >= aux_end) {
                goto err;
            }
            aux = md;
            continue;
        }

        // Check for NM:i tag
        if (aux[0] == 'N' && aux[1] == 'M' && aux[2] == 'i') {
            aux += 6; // Move past the NM:i tag and its integer value
            if (aux > aux_end) {
                goto err;
            }
            continue;
        }

        // Process other tags
        aux += 3; // Move past the tag identifier
        switch (aux[-1]) {
            case 'A': case 'c': case 'C':
                aux++;
                break;
            case 's': case 'S':
                aux += 2;
                break;
            case 'i': case 'I': case 'f':
                aux += 4;
                break;
            case 'Z': case 'H':
                while (aux < aux_end && *aux)
                    aux++;
                if (aux >= aux_end) {
                    goto err;
                }
                aux++;
                break;
            case 'B': {
                int type = *aux++;
                int len = le_to_i32(aux);
                aux += 4;
                switch (type) {
                    case 'c': case 'C':
                        aux += len;
                        break;
                    case 's': case 'S':
                        aux += len * 2;
                        break;
                    case 'i': case 'I': case 'f':
                        aux += len * 4;
                        break;
                    default:
                        goto err;
                }
                break;
            }
            default:
                goto err;
        }