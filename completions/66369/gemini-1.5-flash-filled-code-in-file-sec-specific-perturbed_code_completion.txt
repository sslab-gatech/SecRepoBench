key = kh_key(c->tags_used, k);
        tm = kh_val(c->tags_used, k);
        if (!tm->blk) {
            tm->blk = cram_new_block(EXTERNAL, tm->content_id);
            if (!tm->blk)
                goto err;
        }
        if (tm->type == 'Z') {
            BLOCK_APPEND(tm->blk, aux + 2, aux[1]);
            aux += 2 + aux[1];
        } else if (tm->type == 'i') {
            int32_t i32;
            memcpy(&i32, aux + 2, 4);
            i32 = le_to_i32(&i32);
            if (cram_stats_add(tm->m, i32) < 0)
                goto err;
            tm->blk->m = tm->m;
            BLOCK_APPEND(tm->blk, aux + 2, 4);
            aux += 6;
        } else if (tm->type == 'f') {
            float f32;
            memcpy(&f32, aux + 2, 4);
            f32 = le_to_float(&f32);
            if (cram_stats_add(tm->m, f32) < 0)
                goto err;
            tm->blk->m = tm->m;
            BLOCK_APPEND(tm->blk, aux + 2, 4);
            aux += 6;
        } else if (tm->type == 'd') {
            double f64;
            memcpy(&f64, aux + 2, 8);
            f64 = le_to_double(&f64);
            if (cram_stats_add(tm->m, f64) < 0)
                goto err;
            tm->blk->m = tm->m;
            BLOCK_APPEND(tm->blk, aux + 2, 8);
            aux += 10;
        } else if (tm->type == 'c') {
            int8_t i8;
            memcpy(&i8, aux + 2, 1);
            if (cram_stats_add(tm->m, i8) < 0)
                goto err;
            tm->blk->m = tm->m;
            BLOCK_APPEND(tm->blk, aux + 2, 1);
            aux += 3;
        } else if (tm->type == 'C') {
            uint8_t i8;
            memcpy(&i8, aux + 2, 1);
            if (cram_stats_add(tm->m, i8) < 0)
                goto err;
            tm->blk->m = tm->m;
            BLOCK_APPEND(tm->blk, aux + 2, 1);
            aux += 3;
        } else if (tm->type == 's') {
            int16_t i16;
            memcpy(&i16, aux + 2, 2);
            i16 = le_to_i16(&i16);
            if (cram_stats_add(tm->m, i16) < 0)
                goto err;
            tm->blk->m = tm->m;
            BLOCK_APPEND(tm->blk, aux + 2, 2);
            aux += 4;
        } else if (tm->type == 'S') {
            uint16_t i16;
            memcpy(&i16, aux + 2, 2);
            i16 = le_to_u16(&i16);
            if (cram_stats_add(tm->m, i16) < 0)
                goto err;
            tm->blk->m = tm->m;
            BLOCK_APPEND(tm->blk, aux + 2, 2);
            aux += 4;
        } else if (tm->type == 'i') {
            int32_t i32;
            memcpy(&i32, aux + 2, 4);
            i32 = le_to_i32(&i32);
            if (cram_stats_add(tm->m, i32) < 0)
                goto err;
            tm->blk->m = tm->m;
            BLOCK_APPEND(tm->blk, aux + 2, 4);
            aux += 6;
        } else if (tm->type == 'I') {
            uint32_t i32;
            memcpy(&i32, aux + 2, 4);
            i32 = le_to_u32(&i32);
            if (cram_stats_add(tm->m, i32) < 0)
                goto err;
            tm->blk->m = tm->m;
            BLOCK_APPEND(tm->blk, aux + 2, 4);
            aux += 6;
        } else {
            hts_log_warning("Unknown aux type '%c'", tm->type);
        }

        if (cram_stats_add(c->stats[DS_aux], key[0]) < 0)
            goto err;
        if (cram_stats_add(c->stats[DS_aux_oz], key[1]) < 0)
            goto err;
        if (cram_stats_add(c->stats[DS_aux_oz], tm->type) < 0)
            goto err;

        // Add to tag map
        k = kh_put(m_s2i, c->comp_hdr->tags_used, key, &new);
        if (new < 0)
            goto err;
        else if (new == 0) {
            // Already present
        } else {
            kh_val(c->comp_hdr->tags_used, k) = tm;
        }
        
        if (tm->blk2) {
            BLOCK_APPEND(tm->blk2, aux + 2, aux[1]);
            aux += 2 + aux[1];
        }

        
        if (strcmp(key, "RG") == 0) {
            brg = sam_hrec_rg_parse(aux + 2, aux[1]);
            if (!brg)
                goto err;
            cr->rg = brg->id;
        }
        
        if (strcmp(key, "MD") == 0 && !verbatim_MD) {
            memcpy(MD->s, aux + 2, aux[1]);
            MD->l = aux[1];
        } else if (strcmp(key, "NM") == 0 && !verbatim_NM) {
            NM = bam_aux2i(aux);
        }
        aux += 2 + aux[1];
    }