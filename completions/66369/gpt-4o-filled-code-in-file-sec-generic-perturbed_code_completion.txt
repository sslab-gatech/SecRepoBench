if (aux[0] == 'R' && aux[1] == 'G' && aux[2] == 'Z') {
            if (!(brg = sam_hrecs_find_rg(filedescriptor->header->hrecs, aux+3))) {
                hts_log_warning("Read group %s not found in header", aux+3);
            }
        }

        if (aux[0] == 'M' && aux[1] == 'D' && aux[2] == 'Z') {
            if (!verbatim_MD) {
                aux += 3;
                while (isdigit(*aux)) aux++;
                if (*aux == '^') {
                    aux++;
                    while (isalpha(*aux)) aux++;
                }
                while (isalpha(*aux)) aux++;
                continue;
            }
        }

        if (aux[0] == 'N' && aux[1] == 'M' && aux[2] == 'i') {
            if (!verbatim_NM) {
                aux += 3;
                while (isdigit(*aux)) aux++;
                continue;
            }
        }

        int aux_key = (aux[0] << 16) | (aux[1] << 8) | aux[2];
        k = kh_put(m_s2i, c->tags_used, aux_key, &new);
        if (-1 == new) goto err;

        cram_tag_map *tm;
        if (new) {
            tm = kh_val(c->tags_used, k) = malloc(sizeof(*tm));
            if (!tm) goto err;
            tm->blk = cram_new_block(EXTERNAL, aux_key);
            if (!tm->blk) goto err;
            tm->blk2 = NULL;
            tm->codec = NULL;
            tm->m = 0;
        } else {
            tm = kh_val(c->tags_used, k);
        }

        if (aux[2] == 'Z' || aux[2] == 'H') {
            int len = strlen(aux+3) + 1;
            BLOCK_APPEND(tm->blk, aux, 3);
            BLOCK_APPEND(tm->blk, aux+3, len);
            aux += 3 + len;
        } else {
            int len = bam_aux_type2size(aux[2]);
            if (len < 0 || aux_end - aux < len + 3) goto err;
            BLOCK_APPEND(tm->blk, aux, len + 3);
            aux += len + 3;
        }

        if (new) {
            cram_codec *codec = cram_encoder_init(E_EXTERNAL, NULL, E_BYTE_ARRAY, (void *)(intptr_t)aux_key, filedescriptor->version, &filedescriptor->vv);
            if (!codec) goto err;
            tm->codec = codec;
        }