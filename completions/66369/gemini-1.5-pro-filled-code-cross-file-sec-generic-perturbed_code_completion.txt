key = (char *)aux;
        if (aux_end - aux < 3)
            goto err;

        if (key[0] == 'R' && key[1] == 'G' && key[2] == 'Z') {
            if (!brg) {
                brg = filedescriptor->header->hrecs->rg[cr->rg];
                if (!brg) {
                    if (cram_add_rg(filedescriptor, cr->rg, (char *)aux + 3))
                        goto err;
                    brg = filedescriptor->header->hrecs->rg[cr->rg];
                    if (!brg)
                        goto err;
                }
            }
        }

        if (key[0] == 'M' && key[1] == 'D' && verbatim_MD) {
            if (verbatim_MD < 0) {
                key[2] = '*';
            } else if (MD) {
                aux = (char *)MD->s;
                aux_size = MD->l;
                aux_end = aux + aux_size;
            }
        }

        if (key[0] == 'N' && key[1] == 'M' && verbatim_NM) {
            if (verbatim_NM < 0) {
                key[2] = '*';
            } else if (NM) {
                char tmp[12], *tp = tmp;
                int l = sprintf(tp, "i%d", NM);
                aux = tp;
                aux_size = l;
                aux_end = aux + aux_size;
            }
        }

        cram_tag_map *tm = cram_new_tag_map(filedescriptor, (char *)aux);
        if (!tm)
            goto err;

        BLOCK_APPEND(td_b, aux, 3);
        TD_blk_size += 3;

        if (tm->codec) {
            if (cram_store_aux_data(filedescriptor, s, tm, aux+3,
                                    aux_end - (aux+3)))
                goto err;
        } else {
            BLOCK_APPEND(td_b, aux+3, aux_end - (aux+3));
            TD_blk_size += aux_end - (aux+3);
        }

        aux = (char *)aux_end;