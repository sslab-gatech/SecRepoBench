/*
    Allocate memory for coefficients and points based on the number of coordinates
    and a preliminary "quantum" value that accounts for the spacing among them.
    Then ensure there's enough space in the primitive array via CheckPrimitiveExtent.
  */
  if (number_coordinates < 2)
    {
      primitive_info->coordinates=0;
      return(MagickTrue);
    }

  /* Determine an upper bound for the number of segments to evaluate. */
  quantum=number_coordinates;
  for (i=0; i < (ssize_t) number_coordinates; i++)
    {
      for (j=i+1; j < (ssize_t) number_coordinates; j++)
        {
          alpha=fabs(primitive_info[j].point.x - primitive_info[i].point.x);
          if (alpha > (double) quantum)
            quantum=(size_t) alpha;
          alpha=fabs(primitive_info[j].point.y - primitive_info[i].point.y);
          if (alpha > (double) quantum)
            quantum=(size_t) alpha;
        }
    }

  /* Use a "control_points" count based on quantum and the number of segments. */
  control_points=quantum*(number_coordinates-1);
  if (control_points < number_coordinates)
    control_points=number_coordinates;  /* ensure at least number_coordinates */

  points=(PointInfo *) AcquireQuantumMemory((size_t) control_points,
    sizeof(*points));
  coefficients=(double *) AcquireQuantumMemory((size_t) number_coordinates,
    sizeof(*coefficients));
  if ((points == (PointInfo *) NULL) || (coefficients == (double *) NULL))
    {
      if (points != (PointInfo *) NULL)
        points=(PointInfo *) RelinquishMagickMemory(points);
      if (coefficients != (double *) NULL)
        coefficients=(double *) RelinquishMagickMemory(coefficients);
      (void) ThrowMagickException(bezierinfo->exception,GetMagickModule(),
        ResourceLimitError,"MemoryAllocationFailed","`%s'","");
      return(MagickFalse);
    }

  /* Ensure the underlying primitive array can accommodate all new coordinates. */
  if (CheckPrimitiveExtent(bezierinfo,control_points) == MagickFalse)
    {
      points=(PointInfo *) RelinquishMagickMemory(points);
      coefficients=(double *) RelinquishMagickMemory(coefficients);
      return(MagickFalse);
    }