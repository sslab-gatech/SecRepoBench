FxInfo
  *fx_info;

MagickStatusType
  status;

PixelInfo
  pixel;

// Retrieve pixel information from the image.
if (image == (Image *) NULL)
{
  (void) ThrowMagickException(exception,GetMagickModule(),
    OptionWarning,"NoImageForProperty","\"%%[%s]\"",lookup_pattern);
  continue; /* else no image to retrieve artifact */
}
GetPixelInfo(image,&pixel);

// Acquire a new FxInfo instance using the specified pattern starting after the prefix "hex:".
fx_info=AcquireFxInfo(image,lookup_pattern+4,exception);

// Evaluate the red, green, and blue channel expressions, storing the results in respective pixel channels.
status=FxEvaluateChannelExpression(fx_info,RedPixelChannel,0,0,
  &pixel.red,exception);
status&=FxEvaluateChannelExpression(fx_info,GreenPixelChannel,0,0,
  &pixel.green,exception);
status&=FxEvaluateChannelExpression(fx_info,BluePixelChannel,0,0,
  &pixel.blue,exception);

// Scale the evaluated channel values to the QuantumRange and assign them to the pixel structure.
pixel.red *= QuantumRange;
pixel.green *= QuantumRange;
pixel.blue *= QuantumRange;

fx_info=DestroyFxInfo(fx_info);
if (status != MagickFalse)
{
  char
    hex[MagickPathExtent];

  // Format the pixel values as a hexadecimal string
  (void) FormatLocaleString(hex,MagickPathExtent,"#%02X%02X%02X",
    ScaleQuantumToChar(ClampToQuantum(pixel.red)),
    ScaleQuantumToChar(ClampToQuantum(pixel.green)),
    ScaleQuantumToChar(ClampToQuantum(pixel.blue)));
  AppendString2Text(hex);
}