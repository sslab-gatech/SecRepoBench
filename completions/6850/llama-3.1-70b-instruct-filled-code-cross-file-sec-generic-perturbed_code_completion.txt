// Retrieve pixel information from the image.
// Acquire a new FxInfo instance using the specified pattern starting after the prefix "hex:".
// Evaluate the red, green, and blue channel expressions, storing the results in respective pixel channels.
// Scale the evaluated channel values to the QuantumRange and assign them to the pixel structure.
FxInfo
  *fx_info;

PixelInfo
  pixel;

if (image == (Image *) NULL)
  {
    (void) ThrowMagickException(exception,GetMagickModule(),
      OptionWarning,"NoImageForProperty","\"%%[%s]\"",lookup_pattern);
    continue; /* else no image to retrieve artifact */
  }
fx_info=AcquireFxInfo(image,lookup_pattern+4,exception);
if (fx_info == (FxInfo *) NULL)
  continue;
GetPixelInfo(image,&pixel);
(void) FxEvaluateChannelExpression(fx_info,RedPixelChannel,0,0,&pixel.red,exception);
(void) FxEvaluateChannelExpression(fx_info,GreenPixelChannel,0,0,&pixel.green,exception);
(void) FxEvaluateChannelExpression(fx_info,BluePixelChannel,0,0,&pixel.blue,exception);
pixel.red=(double) QuantumRange*pixel.red;
pixel.green=(double) QuantumRange*pixel.green;
pixel.blue=(double) QuantumRange*pixel.blue;
if (image->colorspace == CMYKColorspace)
  {
    (void) FxEvaluateChannelExpression(fx_info,BlackPixelChannel,0,0,&pixel.black,exception);
    pixel.black=(double) QuantumRange*pixel.black;
  }
(void) FxEvaluateChannelExpression(fx_info,AlphaPixelChannel,0,0,&pixel.alpha,exception);
pixel.alpha=(double) QuantumRange*pixel.alpha;
fx_info=DestroyFxInfo(fx_info);
{
  char
    hex[MagickPathExtent];

  (void) FormatLocaleString(hex,MagickPathExtent,"#%02x%02x%02x%02x",(int) ScaleAnyToQuantum(pixel.red),
    (int) ScaleAnyToQuantum(pixel.green),(int) ScaleAnyToQuantum(pixel.blue),
    (int) ScaleAnyToQuantum(pixel.alpha));
  AppendString2Text(hex);
}