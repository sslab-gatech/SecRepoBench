) p[i];
                  }
                  value[number_bytes]='\0';
                }
              break;
            }
          }
          if (value != (char *) NULL)
            {
              if (all == 0)
                {
                  (void) FormatLocaleString(buffer,MagickPathExtent,"%s=%s",
                    EXIFTag[i].description,value);
                }
              else
                {
                  (void) FormatLocaleString(buffer,MagickPathExtent,"%s",
                    value);
                }
              value=DestroyString(value);
            }
          if (all != 0)
            {
              (void) SetImageProperty((Image *) image,EXIFTag[i].description,
                buffer,exception);
            }
          else
            {
              (void) SetImageProperty((Image *) image,property,buffer,
                exception);
            }
          buffer[0]='\0';
        }
    }
    if (level == MaxDirectoryStack-1)
      break;
    /*
      Push the next IFD onto the stack.
    */
    directory_stack[level].directory=directory;
    directory_stack[level].entry=entry;
    directory_stack[level].offset=tag_offset;
    level++;
    if (level >= MaxDirectoryStack)
      break;
    if (entry < number_entries)
      {
        directory=exif+tag_offset;
        tag_offset=(ssize_t) ReadPropertySignedLong(endian,directory+8);
      }
    else
      {
        directory=exif+length;
        tag_offset=0;
      }
  }
  exif_resources=DestroySplayTree(exif_resources);
  return(MagickTrue);
}

static MagickBooleanType GetProperty(const Image *image,const char *key,
  ExceptionInfo *exception)
{
  if (LocaleCompare(key,"exif:") == 0)
    return(GetEXIFProperty(image,key+5,exception));
  if (LocaleCompare(key,"iptc:") == 0)
    return(GetIPTCProperty(image,key+5,exception));
  if (LocaleCompare(key,"8bim:") == 0)
    return(Get8BIMProperty(image,key+5,exception));
  return(MagickFalse);
}

MagickExport const char *GetImageProperty(const Image *image,const char *key,
  ExceptionInfo *exception)
{
  char
    *property;

  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(key != (const char *) NULL);
  property=(char *) NULL;
  (void) AcquireString(key,&property);
  if (property == (char *) NULL)
    return((char *) NULL);
  if (GetImagePropertyInternal(image,property,exception) == MagickFalse)
    {
      property=DestroyString(property);
      return((char *) NULL);
    }
  return(property);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   G e t I m a g e P r o p e r t y I n t e r n a l                          %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  GetImagePropertyInternal() gets a value associated with an image property.
%
%  The format of the GetImagePropertyInternal method is:
%
%      MagickBooleanType GetImagePropertyInternal(const Image *image,
%        const char *key,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o key: the key.
%
%    o exception: return any errors or warnings in this structure.
%
*/
static MagickBooleanType GetImagePropertyInternal(const Image *image,
  const char *key,ExceptionInfo *exception)
{
  char
    *attribute;

  MagickBooleanType
    status;

  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(key != (const char *) NULL);
  attribute=(char *) NULL;
  status=GetProperty(image,key,exception);
  if (status == MagickFalse)
    {
      attribute=DestroyString(attribute);
      return(MagickFalse);
    }
  return(MagickTrue);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   G e t P r o p e r t y                                                     %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  GetProperty() gets a value associated with an image property.
%
%  The format of the GetProperty method is:
%
%      MagickBooleanType GetProperty(const Image *image,const char *key,
%        ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o key: the key.
%
%    o exception: return any errors or warnings in this structure.
%
*/
static MagickBooleanType GetProperty(const Image *image,const char *key,
  ExceptionInfo *exception)
{
  if (LocaleCompare(key,"exif:") == 0)
    return(GetEXIFProperty(image,key+5,exception));
  if (LocaleCompare(key,"iptc:") == 0)
    return(GetIPTCProperty(image,key+5,exception));
  if (LocaleCompare(key,"8bim:") == 0)
    return(Get8BIMProperty(image,key+5,exception));
  return(MagickFalse);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   S e t I m a g e P r o p e r t y                                           %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  SetImageProperty() associates an assignment string of the form "key=value"
%  with an artifact or options.
%
%  The format of the SetImageProperty method is:
%
%      MagickBooleanType SetImageProperty(Image *image,const char *property,
%        const char *value,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o property: the image property.
%
%    o value: the value.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType SetImageProperty(Image *image,const char *property,
  const char *value,ExceptionInfo *exception)
{
  char
    key[MagickPathExtent];

  register char
    *p;

  assert(image != (Image *) NULL);
  assert(property != (const char *) NULL);
  (void) CopyMagickString(key,property,MagickPathExtent-1);
  for (p=key; *p != '\0'; p++)
    if (*p == '=')
      break;
  *p='\0';
  if (*value != '\0')
    {
      (void) SetImageArtifact(image,key,value);
      (void) SetImageOption(image,key,value);
    }
  else
    {
      (void) RemoveImageOption(image,key);
      (void) RemoveImageArtifact(image,key);
    }
  return(MagickTrue);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   S e t P r o p e r t y                                                     %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  SetProperty() associates an assignment string of the form "key=value" with
%  an artifact or options.
%
%  The format of the SetProperty method is:
%
%      MagickBooleanType SetProperty(const Image *image,const char *property,
%        const char *value,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o property: the image property.
%
%    o value: the value.
%
%    o exception: return any errors or warnings in this structure.
%
*/
static MagickBooleanType SetProperty(const Image *image,const char *property,
  const char *value,ExceptionInfo *exception)
{
  if (LocaleCompare(property,"exif:") == 0)
    return(SetEXIFProperty(image,property+5,value,exception));
  if (LocaleCompare(property,"iptc:") == 0)
    return(SetIPTCProperty(image,property+5,value,exception));
  if (LocaleCompare(property,"8bim:") == 0)
    return(Set8BIMProperty(image,property+5,value,exception));
  return(MagickFalse);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   S e t E X I F P r o p e r t y                                            %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  SetEXIFProperty() associates an assignment string of the form "key=value"
%  with an EXIF property.
%
%  The format of the SetEXIFProperty method is:
%
%      MagickBooleanType SetEXIFProperty(Image *image,const char *property,
%        const char *value,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o property: the EXIF property.
%
%    o value: the value.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType SetEXIFProperty(Image *image,const char *property,
  const char *value,ExceptionInfo *exception)
{
  char
    key[MagickPathExtent];

  register char
    *p;

  assert(image != (Image *) NULL);
  assert(property != (const char *) NULL);
  (void) CopyMagickString(key,property,MagickPathExtent-1);
  for (p=key; *p != '\0'; p++)
    if (*p == '=')
      break;
  *p='\0';
  if (*value != '\0')
    {
      (void) SetImageArtifact(image,key,value);
      (void) SetImageOption(image,key,value);
    }
  else
    {
      (void) RemoveImageOption(image,key);
      (void) RemoveImageArtifact(image,key);
    }
  return(MagickTrue);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   S e t I P T C P r o p e r t y                                            %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  SetIPTCProperty() associates an assignment string of the form "key=value"
%  with an IPTC property.
%
%  The format of the SetIPTCProperty method is:
%
%      MagickBooleanType SetIPTCProperty(Image *image,const char *property,
%        const char *value,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o property: the IPTC property.
%
%    o value: the value.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType SetIPTCProperty(Image *image,const char *property,
  const char *value,ExceptionInfo *exception)
{
  char
    key[MagickPathExtent];

  register char
    *p;

  assert(image != (Image *) NULL);
  assert(property != (const char *) NULL);
  (void) CopyMagickString(key,property,MagickPathExtent-1);
  for (p=key; *p != '\0'; p++)