double
  red_value,
  green_value,
  blue_value;

FxInfo
  *fx_info;

MagickStatusType
  status;

PixelInfo
  pixel;

/*
  Hex - color value calculator.
*/
if (image == (Image *) NULL)
{
  (void) ThrowMagickException(exception,GetMagickModule(),
    OptionWarning,"NoImageForProperty","\"%%[%s]\"",lookup_pattern);
  continue; /* else no image to retrieve artifact */
}
GetPixelInfo(image,&pixel);
fx_info=AcquireFxInfo(image,lookup_pattern+4,exception);
status=FxEvaluateChannelExpression(fx_info,RedPixelChannel,0,0,
  &red_value,exception);
status&=FxEvaluateChannelExpression(fx_info,GreenPixelChannel,0,0,
  &green_value,exception);
status&=FxEvaluateChannelExpression(fx_info,BluePixelChannel,0,0,
  &blue_value,exception);
pixel.red=(double) QuantumRange*red_value;
pixel.green=(double) QuantumRange*green_value;
pixel.blue=(double) QuantumRange*blue_value;
fx_info=DestroyFxInfo(fx_info);
if (status != MagickFalse)
{
  char
    hex[MagickPathExtent];

  (void) FormatLocaleString(hex,MagickPathExtent,"#%02X%02X%02X",
    ScaleQuantumToChar((Quantum) pixel.red),
    ScaleQuantumToChar((Quantum) pixel.green),
    ScaleQuantumToChar((Quantum) pixel.blue));
  AppendString2Text(hex);
}
continue;