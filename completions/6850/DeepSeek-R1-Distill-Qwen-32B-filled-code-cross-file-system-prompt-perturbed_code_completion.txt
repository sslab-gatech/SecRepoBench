// Retrieve pixel information from the image.
if (image == (Image *) NULL)
{
  (void) ThrowMagickException(exception,GetMagickModule(),
    OptionWarning,"NoImageForProperty","\"%%[%s]\"",lookup_pattern);
  continue;
}

PixelInfo pixel;
GetPixelInfo(image, &pixel);

FxInfo *fx_info = AcquireFxInfo(image, lookup_pattern + 4, exception);
double value;

FxEvaluateChannelExpression(fx_info, RedPixelChannel, 0, 0, &value, exception);
pixel.red = (double) QuantumRange * value;
FxEvaluateChannelExpression(fx_info, GreenPixelChannel, 0, 0, &value, exception);
pixel.green = (double) QuantumRange * value;
FxEvaluateChannelExpression(fx_info, BluePixelChannel, 0, 0, &value, exception);
pixel.blue = (double) QuantumRange * value;

fx_info = DestroyFxInfo(fx_info);

char result[MagickPathExtent];
(void) FormatLocaleString(result, MagickPathExtent, "rgb:%02x%02x%02x",
  (unsigned int) (pixel.red + 0.5), (unsigned int) (pixel.green + 0.5),
  (unsigned int) (pixel.blue + 0.5));

AppendString2Text(result);
continue;