static void ndpi_int_tls_add_connection(struct ndpi_detection_module_struct *ndpi_struct,
					struct ndpi_flow_struct *flow) {
  u_int32_t protocol;

  if(flow->detected_protocol_stack[1] == NDPI_PROTOCOL_UNKNOWN)
    flow->detected_protocol_stack[1] = __get_master(ndpi_struct, flow);
  if(flow->detected_protocol_stack[0] == NDPI_PROTOCOL_UNKNOWN)
    flow->detected_protocol_stack[0] = flow->detected_protocol_stack[1];

  ndpi_set_detected_protocol(ndpi_struct, flow, flow->detected_protocol_stack[1], flow->detected_protocol_stack[0], NDPI_CONFIDENCE_DPI);
  flow->category = ndpi_get_proto_category(ndpi_struct, flow->detected_protocol_stack[1]);
  ndpi_check_subprotocol_risk(ndpi_struct, flow, flow->detected_protocol_stack[1]);
  ndpi_unset_risk(ndpi_struct, flow, NDPI_NUMERIC_IP_HOST);
}