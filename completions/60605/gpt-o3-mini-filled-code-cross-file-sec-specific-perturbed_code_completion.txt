{
  const char *filename_start = (const char *)packet->content_disposition_line.ptr + attachment_len;
  u_int8_t new_filename_len = 0;
  
  if (attachment_filename_len > 1 && filename_start[attachment_filename_len - 1] == '\"') {
    /* Filename is enclosed in quotes: exclude both the starting and ending quotes */
    new_filename_len = attachment_filename_len - 2;
    flow->http.filename = ndpi_malloc(new_filename_len + 1);
    if (flow->http.filename != NULL) {
      strncpy(flow->http.filename, filename_start + 1, new_filename_len);
      flow->http.filename[new_filename_len] = '\0';
    }
  } else {
    /* Starting quote exists but no ending quote: exclude only the starting quote */
    new_filename_len = attachment_filename_len - 1;
    flow->http.filename = ndpi_malloc(new_filename_len + 1);
    if (flow->http.filename != NULL) {
      strncpy(flow->http.filename, filename_start + 1, new_filename_len);
      flow->http.filename[new_filename_len] = '\0';
    }
  }
}