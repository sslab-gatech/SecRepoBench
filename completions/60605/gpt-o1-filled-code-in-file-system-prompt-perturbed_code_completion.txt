if (packet->content_disposition_line.ptr[attachment_len + attachment_filename_len - 1] != '\"') {
  /* The last character is not a quote: format is filename="file_name */
  flow->http.filename = ndpi_malloc(attachment_filename_len);
  if (flow->http.filename != NULL) {
    strncpy(flow->http.filename,
            (char*)packet->content_disposition_line.ptr + attachment_len + 1,
            attachment_filename_len - 1);
    flow->http.filename[attachment_filename_len - 1] = '\0';
  }
} else {
  /* The last character is a quote: format is filename="file_name" */
  if (attachment_filename_len > 2) {
    flow->http.filename = ndpi_malloc(attachment_filename_len - 1);
    if (flow->http.filename != NULL) {
      strncpy(flow->http.filename,
              (char*)packet->content_disposition_line.ptr + attachment_len + 1,
              attachment_filename_len - 2);
      flow->http.filename[attachment_filename_len - 2] = '\0';
    }
  } else {
    /* Empty filename between quotes, e.g. filename="" */
    flow->http.filename = ndpi_malloc(1);
    if (flow->http.filename != NULL)
      flow->http.filename[0] = '\0';
  }
}