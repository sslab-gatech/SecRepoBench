{
  u_int8_t filename_len;
  
  if(packet->content_disposition_line.ptr[packet->content_disposition_line.len-1] != '\"') {
    // Format: filename="file_name (missing closing quote)
    filename_len = attachment_filename_len - 1; // Exclude opening quote
  } else if(attachment_filename_len > 1) {
    // Format: filename="file_name" (with closing quote)
    filename_len = attachment_filename_len - 2; // Exclude both quotes
  } else {
    filename_len = 0;
  }
  
  if(filename_len > 0) {
    flow->http.filename = ndpi_malloc(filename_len+1);
    
    if(flow->http.filename != NULL) {
      strncpy(flow->http.filename, (char*)packet->content_disposition_line.ptr+attachment_len+1, filename_len);
      flow->http.filename[filename_len] = '\0';
    }
  } else {
    flow->http.filename = NULL;
  }
}