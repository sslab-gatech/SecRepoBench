if(packet->content_disposition_line.ptr[packet->content_disposition_line.len-1] != '\"') {
  // Format is 'attachment; filename="file_name' (quote at the beginning but not at the end)
  if(attachment_filename_len > 1) {
    flow->http.filename = ndpi_malloc(attachment_filename_len);
    
    if(flow->http.filename != NULL) {
      strncpy(flow->http.filename, (char*)packet->content_disposition_line.ptr+attachment_len+1, attachment_filename_len-1);
      flow->http.filename[attachment_filename_len-1] = '\0';
    }
  }
} else {
  // Format is 'attachment; filename="file_name"' (quotes at both beginning and end)
  if(attachment_filename_len > 2) {
    flow->http.filename = ndpi_malloc(attachment_filename_len-1);
    
    if(flow->http.filename != NULL) {
      strncpy(flow->http.filename, (char*)packet->content_disposition_line.ptr+attachment_len+1, attachment_filename_len-2);
      flow->http.filename[attachment_filename_len-2] = '\0';
    }
  }
}