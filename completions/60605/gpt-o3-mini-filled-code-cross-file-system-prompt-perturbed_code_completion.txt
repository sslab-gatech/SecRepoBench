{
  char *filename = NULL;
  u_int8_t filename_len = 0;
  /* Check if the last character is not a quote */
  if(packet->content_disposition_line.ptr[attachment_len + attachment_filename_len - 1] != '\"') {
    filename_len = attachment_filename_len - 1;
    filename = ndpi_malloc(filename_len + 1);
    if(filename != NULL) {
      strncpy(filename, (char *)packet->content_disposition_line.ptr + attachment_len + 1, filename_len);
      filename[filename_len] = '\0';
    }
  } else {
    /* Last character is a quote */
    if(attachment_filename_len > 2) {
      filename_len = attachment_filename_len - 2;
      filename = ndpi_malloc(filename_len + 1);
      if(filename != NULL) {
        strncpy(filename, (char *)packet->content_disposition_line.ptr + attachment_len + 1, filename_len);
        filename[filename_len] = '\0';
      }
    }
  }
  flow->http.filename = filename;
}