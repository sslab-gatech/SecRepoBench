(packet->content_disposition_line.ptr[packet->content_disposition_line.len-1] != '\"') {
  // Last character is not a quote
  // Assume format: filename="file_name
  flow->http.filename = ndpi_malloc(attachment_filename_len);

  if(flow->http.filename != NULL) {
    // Copy filename excluding the starting quote
    strncpy(flow->http.filename, (char*)packet->content_disposition_line.ptr+attachment_len+1, attachment_filename_len-1);
    flow->http.filename[attachment_filename_len-1] = '\0';
  }
} else if(attachment_filename_len > 1) {
  // Last character is a quote and we have enough characters
  // Assume format: filename="file_name"
  flow->http.filename = ndpi_malloc(attachment_filename_len-1);

  if(flow->http.filename != NULL) {
    // Copy filename excluding both quotes
    strncpy(flow->http.filename, (char*)packet->content_disposition_line.ptr+attachment_len+1, attachment_filename_len-2);
    flow->http.filename[attachment_filename_len-2] = '\0';
  }
}