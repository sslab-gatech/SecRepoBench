// Check if the filename in the content disposition line is enclosed in quotes.
// If the last character is not a quote, assume the format is 'filename="file_name'.
// Allocate memory and copy the filename from the packet to the flow structure, excluding the starting quote.
if(packet->content_disposition_line.ptr[packet->payload_packet_len - 1] != '\"') {
  u_int8_t filename_len = packet->payload_packet_len - attachment_len - 1;
  
  if(filename_len > 0) {
    flow->http.filename = ndpi_malloc(filename_len + 1);

    if(flow->http.filename != NULL) {
      strncpy(flow->http.filename, (char*)packet->content_disposition_line.ptr + attachment_len + 1, filename_len);
      flow->http.filename[filename_len] = '\0';
    }
  }
}
// If the last character is a quote and the filename length is sufficient, assume the format is 'filename="file_name"'.
// Allocate memory and copy the filename from the packet to the flow structure, excluding both starting and ending quotes.
else {
  u_int8_t filename_len = packet->payload_packet_len - attachment_len - 2;

  if(filename_len > 0) {
    flow->http.filename = ndpi_malloc(filename_len + 1);

    if(flow->http.filename != NULL) {
      strncpy(flow->http.filename, (char*)packet->content_disposition_line.ptr + attachment_len + 1, filename_len);
      flow->http.filename[filename_len] = '\0';
    }
  }
}