int isfloat = 0;
char *pos = endp;

/* Check if there's a fractional part */
if (pos < str_end && *pos == '.') {
    pos++;
    if (pos == str_end || !isdigit((unsigned char)*pos)) {
        PLIST_JSON_ERR("%s: invalid fractional part\n", __func__);
        return NULL;
    }
    while (pos < str_end && isdigit((unsigned char)*pos)) {
        pos++;
    }
    isfloat = 1;
}

/* Check if there's an exponent part */
if (pos < str_end && (*pos == 'e' || *pos == 'E')) {
    pos++;
    if (pos < str_end && (*pos == '+' || *pos == '-')) {
        pos++;
    }
    if (pos == str_end || !isdigit((unsigned char)*pos)) {
        PLIST_JSON_ERR("%s: invalid exponent\n", __func__);
        return NULL;
    }
    while (pos < str_end && isdigit((unsigned char)*pos)) {
        pos++;
    }
    isfloat = 1;
}

/* If we haven't consumed the entire token, it's an error */
if (pos != str_end) {
    PLIST_JSON_ERR("%s: invalid trailing characters in number\n", __func__);
    return NULL;
}

/* Create plist node */
plist_data_t data = plist_new_plist_data();
if (!isfloat) {
    /* Treat as integer */
    if (intpart >= 0) {
        data->type = PLIST_UINT;
        data->uint_val = (uint64_t)intpart;
    } else {
        data->type = PLIST_INT;
        data->int_val = intpart;
    }
} else {
    /* Convert entire token to double */
    errno = 0;
    double dval = strtod(str_val, NULL);
    if (errno == ERANGE) {
        PLIST_JSON_ERR("%s: floating-point value out of range\n", __func__);
        return NULL;
    }
    data->type = PLIST_REAL;
    data->real_val = dval;
}

primitivevalue = plist_new_node(data);