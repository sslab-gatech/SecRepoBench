if (endp < str_end) {
    if (*endp == '.') {
        endp++;
        int64_t fracpart = parse_decimal(endp, str_end, &endp);
        int64_t exp = 0;
        if (endp < str_end && (*endp == 'e' || *endp == 'E')) {
            endp++;
            exp = parse_decimal(endp, str_end, &endp);
        }

        if (endp == str_end) {
            double d = (double)intpart;
            double fractional_multiplier = 1.0;
            int64_t tmp = fracpart;
            while (tmp > 0) {
                fractional_multiplier /= 10.0;
                tmp /= 10;
            }
            d += (double)fracpart * fractional_multiplier;

            double exp_multiplier = 1.0;
            if (exp > 0) {
                for (int i = 0; i < exp; i++) {
                    exp_multiplier *= 10.0;
                }
            } else if (exp < 0) {
                for (int i = 0; i < -exp; i++) {
                    exp_multiplier /= 10.0;
                }
            }
            d *= exp_multiplier;

            primitivevalue = plist_new_real(d);

        } else {
            PLIST_JSON_ERR("%s: invalid real number '%.*s'\n", __func__, (int)str_len, str_val);
        }

    } else {
        PLIST_JSON_ERR("%s: invalid number '%.*s'\n", __func__, (int)str_len, str_val);
    }
} else {
    primitivevalue = plist_new_uint(intpart);
}