if (endp == str_val) {
            PLIST_JSON_ERR("%s: invalid number format\n", __func__);
            return NULL;
        }
        char* endp2 = endp;
        double floatpart = 0.0;
        int exponent = 0;
        if (*endp == '.') {
            endp++;
            if (endp >= str_end || !isdigit(*endp)) {
                PLIST_JSON_ERR("%s: invalid number format\n", __func__);
                return NULL;
            }
            floatpart = strtod(endp, &endp2);
            if (endp2 == endp) {
                PLIST_JSON_ERR("%s: invalid number format\n", __func__);
                return NULL;
            }
            if (*endp2 == 'e' || *endp2 == 'E') {
                endp2++;
                if (endp2 >= str_end) {
                    PLIST_JSON_ERR("%s: invalid number format\n", __func__);
                    return NULL;
                }
                exponent = strtol(endp2, &endp2, 10);
                if (endp2 == endp2) {
                    PLIST_JSON_ERR("%s: invalid number format\n", __func__);
                    return NULL;
                }
            }
            double val = intpart + floatpart;
            if (exponent != 0) {
                val *= pow(10, exponent);
            }
            primitivevalue = plist_new_real(val);
        } else {
            primitivevalue = plist_new_uint64(intpart);
        }