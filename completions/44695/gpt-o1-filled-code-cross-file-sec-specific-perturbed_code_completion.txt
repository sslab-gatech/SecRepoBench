double realval = (double)intpart;
        int is_float = 0;

        /* Parse optional fractional part */
        char *pos = endp;
        if (pos < str_end && *pos == '.') {
            is_float = 1;
            pos++;
            double fraction = 0.0;
            double divisor = 10.0;
            while (pos < str_end && isdigit((unsigned char)*pos)) {
                fraction += (double)(*pos - '0') / divisor;
                divisor *= 10.0;
                pos++;
            }
            if (intpart < 0) {
                realval -= fraction;
            } else {
                realval += fraction;
            }
        }

        /* Parse optional exponent part */
        if (pos < str_end && (*pos == 'e' || *pos == 'E')) {
            is_float = 1;
            pos++;
            int exp_sign = 1;
            if (pos < str_end && (*pos == '+' || *pos == '-')) {
                if (*pos == '-') {
                    exp_sign = -1;
                }
                pos++;
            }
            int exponent = 0;
            while (pos < str_end && isdigit((unsigned char)*pos)) {
                exponent = exponent * 10 + (*pos - '0');
                pos++;
            }
            realval *= pow(10.0, exp_sign * exponent);
        }

        /* Check for invalid leftover characters */
        while (pos < str_end && isspace((unsigned char)*pos)) {
            pos++;
        }
        if (pos < str_end) {
            PLIST_JSON_ERR("%s: invalid numeric format '%.*s'\n",
                __func__, (int)str_len, str_val);
            return NULL;
        }

        /* Decide whether we have an integer or a real number */
        if (!is_float) {
            if (intpart < 0) {
                primitivevalue = plist_new_int(intpart);
            } else {
                primitivevalue = plist_new_uint((uint64_t)intpart);
            }
        } else {
            primitivevalue = plist_new_real(realval);
        }