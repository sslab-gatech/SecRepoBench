if (endp == str_end) {
    // Just an integer
    primitivevalue = plist_new_uint(intpart);
} else if (*endp == '.' || *endp == 'e' || *endp == 'E') {
    // Floating point number
    double dval = (double)intpart;
    
    // Parse fractional part
    if (*endp == '.') {
        endp++;
        if (endp >= str_end || !isdigit(*endp)) {
            PLIST_JSON_ERR("%s: invalid decimal part in value\n", __func__);
            return NULL;
        }
        
        double frac = 0.1;
        while (endp < str_end && isdigit(*endp)) {
            dval += (*endp - '0') * frac;
            frac *= 0.1;
            endp++;
        }
    }
    
    // Parse exponent part
    if (endp < str_end && (*endp == 'e' || *endp == 'E')) {
        endp++;
        int exp_sign = 1;
        if (endp < str_end && (*endp == '+' || *endp == '-')) {
            exp_sign = (*endp == '-') ? -1 : 1;
            endp++;
        }
        
        if (endp >= str_end || !isdigit(*endp)) {
            PLIST_JSON_ERR("%s: invalid exponent part in value\n", __func__);
            return NULL;
        }
        
        int exp_val = 0;
        while (endp < str_end && isdigit(*endp)) {
            if (exp_val > INT_MAX / 10) {
                PLIST_JSON_ERR("%s: exponent value too large\n", __func__);
                return NULL;
            }
            exp_val = exp_val * 10 + (*endp - '0');
            endp++;
        }
        
        // Apply exponent
        if (exp_val > 308) {  // DBL_MAX is approximately 1.8e308
            if (exp_sign > 0) {
                PLIST_JSON_ERR("%s: exponent value too large, would result in infinity\n", __func__);
                return NULL;
            }
            // Extremely small number, treat as 0.0
            dval = 0.0;
        } else {
            for (int i = 0; i < exp_val; i++) {
                if (exp_sign > 0) {
                    dval *= 10.0;
                } else {
                    dval /= 10.0;
                }
            }
        }
    }
    
    if (endp != str_end) {
        PLIST_JSON_ERR("%s: unexpected character in value\n", __func__);
        return NULL;
    }
    
    primitivevalue = plist_new_real(dval);
} else {
    PLIST_JSON_ERR("%s: unexpected character in number value\n", __func__);
    return NULL;
}