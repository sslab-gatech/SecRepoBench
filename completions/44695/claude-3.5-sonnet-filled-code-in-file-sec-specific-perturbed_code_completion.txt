if (endp < str_end && *endp == '.') {
    // Floating point number
    double fractional = 0.0;
    double scale = 0.1;
    endp++;
    while (endp < str_end && isdigit(*endp)) {
        fractional += (*endp - '0') * scale;
        scale *= 0.1;
        endp++;
    }
    double value = (double)intpart + (intpart < 0 ? -fractional : fractional);

    // Handle exponent
    if (endp < str_end && (*endp == 'e' || *endp == 'E')) {
        endp++;
        int exp_sign = 1;
        if (endp < str_end && (*endp == '+' || *endp == '-')) {
            exp_sign = (*endp == '+') ? 1 : -1;
            endp++;
        }
        int64_t exponent = 0;
        while (endp < str_end && isdigit(*endp)) {
            exponent = exponent * 10 + (*endp - '0');
            endp++;
        }
        value *= pow(10, exp_sign * exponent);
    }

    if (endp == str_end) {
        primitivevalue = plist_new_real(value);
    } else {
        PLIST_JSON_ERR("%s: invalid floating point value '%.*s' encountered\n", __func__, (int)str_len, str_val);
    }
} else {
    // Integer
    if (endp == str_end) {
        if (intpart >= 0) {
            primitivevalue = plist_new_uint(intpart);
        } else {
            primitivevalue = plist_new_uint((uint64_t)intpart);
        }
    } else {
        PLIST_JSON_ERR("%s: invalid integer value '%.*s' encountered\n", __func__, (int)str_len, str_val);
    }
}