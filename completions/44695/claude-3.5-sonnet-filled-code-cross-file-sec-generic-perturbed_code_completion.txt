if (endp < str_end && *endp == '.') {
    // Parse fractional part
    endp++;
    double frac = 0.0;
    double scale = 0.1;
    while (endp < str_end && isdigit(*endp)) {
        frac += (*endp - '0') * scale;
        scale *= 0.1;
        endp++;
    }
    double value = (double)intpart + (intpart < 0 ? -frac : frac);

    // Parse exponent part
    if (endp < str_end && (*endp == 'e' || *endp == 'E')) {
        endp++;
        int exp_sign = 1;
        if (endp < str_end && (*endp == '+' || *endp == '-')) {
            exp_sign = (*endp == '+') ? 1 : -1;
            endp++;
        }
        int64_t exp = 0;
        while (endp < str_end && isdigit(*endp)) {
            exp = exp * 10 + (*endp - '0');
            endp++;
        }
        value *= pow(10.0, exp_sign * exp);
    }

    if (endp == str_end) {
        primitivevalue = plist_new_real(value);
    } else {
        PLIST_JSON_ERR("%s: invalid floating-point value '%.*s' encountered\n", __func__, (int)str_len, str_val);
    }
} else if (endp == str_end) {
    primitivevalue = plist_new_uint(intpart);
} else {
    PLIST_JSON_ERR("%s: invalid numeric value '%.*s' encountered\n", __func__, (int)str_len, str_val);
}