if (endp == str_val) {
            PLIST_JSON_ERR("%s: invalid number format\n", __func__);
            return NULL;
        }
        char* endp2 = endp;
        double floatpart = 0.0;
        int exponent = 0;
        if (*endp == '.') {
            endp++;
            if (endp >= str_end || !isdigit(*endp)) {
                PLIST_JSON_ERR("%s: invalid number format\n", __func__);
                return NULL;
            }
            floatpart = strtod(endp, &endp2);
            if (endp2 == endp) {
                PLIST_JSON_ERR("%s: invalid number format\n", __func__);
                return NULL;
            }
            endp = endp2;
        }
        if (*endp == 'e' || *endp == 'E') {
            endp++;
            if (endp >= str_end) {
                PLIST_JSON_ERR("%s: invalid number format\n", __func__);
                return NULL;
            }
            char* endp3 = endp;
            exponent = strtol(endp, &endp3, 10);
            if (endp3 == endp) {
                PLIST_JSON_ERR("%s: invalid number format\n", __func__);
                return NULL;
            }
            endp = endp3;
        }
        if (endp != str_end) {
            PLIST_JSON_ERR("%s: trailing characters after number\n", __func__);
            return NULL;
        }
        double number = intpart + floatpart;
        if (exponent != 0) {
            number *= pow(10, exponent);
        }
        if (number >= INT64_MIN && number <= INT64_MAX) {
            primitivevalue = plist_new_int64((int64_t)number);
        } else {
            primitivevalue = plist_new_real(number);
        }