if (endp < str_end) {
    if (*endp == '.') {
        double fracpart = 0.0;
        double scale = 0.1;
        endp++;
        while (endp < str_end && isdigit(*endp)) {
            fracpart += (*endp - '0') * scale;
            scale *= 0.1;
            endp++;
        }
        double value = (double)intpart + (intpart < 0 ? -fracpart : fracpart);
        if (endp < str_end && (*endp == 'e' || *endp == 'E')) {
            endp++;
            int exp_sign = 1;
            if (endp < str_end && (*endp == '+' || *endp == '-')) {
                exp_sign = (*endp == '+') ? 1 : -1;
                endp++;
            }
            int64_t exp = 0;
            while (endp < str_end && isdigit(*endp)) {
                exp = exp * 10 + (*endp - '0');
                endp++;
            }
            value *= pow(10.0, exp_sign * exp);
        }
        if (endp == str_end) {
            primitivevalue = plist_new_real(value);
        } else {
            PLIST_JSON_ERR("%s: invalid floating point value\n", __func__);
        }
    } else {
        PLIST_JSON_ERR("%s: invalid character in numeric value\n", __func__);
    }
} else {
    primitivevalue = plist_new_uint(intpart);
}