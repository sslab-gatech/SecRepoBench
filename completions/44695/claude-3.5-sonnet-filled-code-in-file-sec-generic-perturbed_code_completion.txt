if (endp < str_end && *endp == '.') {
    // Floating point number
    endp++;
    double fracpart = 0.0;
    double scale = 0.1;
    while (endp < str_end && isdigit(*endp)) {
        fracpart += (*endp - '0') * scale;
        scale *= 0.1;
        endp++;
    }
    double value = (double)intpart + (intpart < 0 ? -fracpart : fracpart);
    if (endp < str_end && (*endp == 'e' || *endp == 'E')) {
        // Handle exponent
        endp++;
        int exp_sign = 1;
        if (endp < str_end && (*endp == '+' || *endp == '-')) {
            exp_sign = (*endp == '+') ? 1 : -1;
            endp++;
        }
        int64_t exp = 0;
        while (endp < str_end && isdigit(*endp)) {
            exp = exp * 10 + (*endp - '0');
            endp++;
        }
        value *= pow(10, exp_sign * exp);
    }
    if (isinf(value) || isnan(value)) {
        PLIST_JSON_ERR("%s: floating point value out of range\n", __func__);
        return NULL;
    }
    primitivevalue = plist_new_real(value);
} else {
    // Integer
    if (intpart == INT64_MIN || (intpart >= 0 && (uint64_t)intpart > INT64_MAX)) {
        primitivevalue = plist_new_uint(intpart);
    } else {
        primitivevalue = plist_new_uint((uint64_t)intpart);
    }
}