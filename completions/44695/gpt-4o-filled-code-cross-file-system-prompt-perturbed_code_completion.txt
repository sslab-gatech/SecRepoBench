if (endp == str_end) {
            // The entire string was parsed as an integer
            primitivevalue = plist_new_uint(intpart);
        } else if (*endp == '.' || *endp == 'e' || *endp == 'E') {
            // The number is a floating point
            double realpart = (double)intpart;
            if (*endp == '.') {
                endp++;
                double frac = 0.0;
                double scale = 0.1;
                while (endp < str_end && isdigit(*endp)) {
                    frac += scale * (*endp - '0');
                    scale *= 0.1;
                    endp++;
                }
                realpart += frac;
            }
            if (*endp == 'e' || *endp == 'E') {
                endp++;
                int exp_sign = 1;
                if (*endp == '-') {
                    exp_sign = -1;
                    endp++;
                } else if (*endp == '+') {
                    endp++;
                }
                int exp = 0;
                while (endp < str_end && isdigit(*endp)) {
                    exp = exp * 10 + (*endp - '0');
                    endp++;
                }
                realpart *= pow(10, exp_sign * exp);
            }
            if (endp == str_end) {
                primitivevalue = plist_new_real(realpart);
            } else {
                PLIST_JSON_ERR("%s: invalid characters in number '%.*s'\n", __func__, (int)str_len, str_val);
            }
        } else {
            PLIST_JSON_ERR("%s: invalid number format '%.*s'\n", __func__, (int)str_len, str_val);
        }