if (endp < str_end && *endp == '.') {
    // Floating point number
    endp++;
    double frac = 0.0;
    double scale = 0.1;
    while (endp < str_end && isdigit(*endp)) {
        frac += (*endp - '0') * scale;
        scale *= 0.1;
        endp++;
    }
    double value = (double)intpart + (intpart < 0 ? -frac : frac);
    if (endp < str_end && (*endp == 'e' || *endp == 'E')) {
        endp++;
        int exp_sign = 1;
        if (endp < str_end && (*endp == '+' || *endp == '-')) {
            exp_sign = (*endp == '+') ? 1 : -1;
            endp++;
        }
        int exp = 0;
        while (endp < str_end && isdigit(*endp)) {
            exp = exp * 10 + (*endp - '0');
            endp++;
        }
        value *= pow(10.0, exp_sign * exp);
    }
    primitivevalue = plist_new_real(value);
} else {
    // Integer number
    if (intpart >= 0 && (uint64_t)intpart <= UINT64_MAX) {
        primitivevalue = plist_new_uint((uint64_t)intpart);
    } else {
        primitivevalue = plist_new_uint((int64_t)intpart);
    }
}
if (endp != str_end) {
    PLIST_JSON_ERR("%s: invalid characters in number\n", __func__);
    plist_free(primitivevalue);
    primitivevalue = NULL;
}