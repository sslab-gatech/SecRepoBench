if (*endp >= str_end || (*endp != '.' && *endp != 'e' && *endp != 'E')) {
    // It's just an integer
    primitivevalue = plist_new_uint(intpart);
} else {
    // It's a floating point number
    double floatval = (double)intpart;
    
    // Handle decimal part
    if (*endp == '.') {
        (*endp)++;
        if (*endp >= str_end || !isdigit(**endp)) {
            PLIST_JSON_ERR("%s: invalid character after decimal point\n", __func__);
            return NULL;
        }
        
        uint64_t fracpart = 0;
        int fracdigits = 0;
        while (*endp < str_end && isdigit(**endp)) {
            fracpart = fracpart * 10 + (**endp - '0');
            fracdigits++;
            (*endp)++;
        }
        
        double frac = (double)fracpart;
        for (int i = 0; i < fracdigits; i++) {
            frac /= 10.0;
        }
        
        if (floatval >= 0) {
            floatval += frac;
        } else {
            floatval -= frac;
        }
    }
    
    // Handle exponent part
    if (*endp < str_end && (*endp == 'e' || *endp == 'E')) {
        (*endp)++;
        int exp_is_neg = 0;
        if (*endp < str_end && **endp == '-') {
            exp_is_neg = 1;
            (*endp)++;
        } else if (*endp < str_end && **endp == '+') {
            (*endp)++;
        }
        
        if (*endp >= str_end || !isdigit(**endp)) {
            PLIST_JSON_ERR("%s: invalid character in exponent\n", __func__);
            return NULL;
        }
        
        int exponent = 0;
        while (*endp < str_end && isdigit(**endp)) {
            exponent = exponent * 10 + (**endp - '0');
            (*endp)++;
        }
        
        if (exp_is_neg)
            exponent = -exponent;
            
        floatval *= pow(10, exponent);
    }
    
    // Check if there are any remaining invalid characters
    if (*endp < str_end) {
        PLIST_JSON_ERR("%s: invalid character after number: '%c'\n", __func__, **endp);
        return NULL;
    }
    
    // Create a real value node
    primitivevalue = plist_new_real(floatval);
}