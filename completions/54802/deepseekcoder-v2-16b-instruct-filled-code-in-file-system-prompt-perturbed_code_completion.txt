// Check specific byte patterns in the packet payload to identify PPStream traffic.
// These patterns include checking certain bytes for specific hexadecimal values,
// often at various offsets within the payload.
// If a known pattern is matched, it indicates PPStream traffic over UDP.
// Upon detection, increment the PPStream stage counter for the flow structure.
// Then, register this flow structure as a PPStream connection.
// If no pattern is matched, continue with the flow structure's protocol exclusion.

if (packet->payload_packet_len > 17) {
  if (packet->payload[1] == 0x80 || packet->payload[1] == 0x84) {
    if (packet->payload[3] == packet->payload[4]) {
      // increase count pkt ppstream over udp
      stream->l4.udp.ppstream_stage++;
      ndpi_int_ppstream_add_connection(ndpi_struct, stream);
      return;
    }
  }
  // 53
  else if (packet->payload[1] == 0x53 && packet->payload[3] == 0x00 &&
           (packet->payload[0] == 0x08 || packet->payload[0] == 0x0c)) {
    // increase count pkt ppstream over udp
    stream->l4.udp.ppstream_stage++;
    ndpi_int_ppstream_add_connection(ndpi_struct, stream);
    return;
  }
}

NDPI_EXCLUDE_PROTO(ndpi_struct, stream);