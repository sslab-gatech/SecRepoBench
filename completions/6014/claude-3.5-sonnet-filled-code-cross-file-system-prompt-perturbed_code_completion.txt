char *p = xml;
char *q = xml;

while (*p != '\0') {
  // Skip leading spaces
  while (isspace((int)((unsigned char)*p)))
    p++;

  // Move non-space characters
  while (*p != '\0' && !isspace((int)((unsigned char)*p)))
    *q++ = *p++;

  // Add a single space between words if not at the end
  if (*p != '\0')
    *q++ = ' ';

  // Skip any remaining spaces
  while (isspace((int)((unsigned char)*p)))
    p++;
}

// Remove trailing space if present
if (q > xml && *(q-1) == ' ')
  q--;

*q = '\0';