char *r, *s;
int in_space = 1;  // Start assuming we're in a space, so leading spaces get removed

r = s = p;  // Initialize both pointers to the beginning of the string

while (*r != '\0') {
  if (*r == ' ') {
    if (in_space == 0) {
      // We've just transitioned from non-space to space, so add a space
      *s++ = ' ';
      in_space = 1;
    }
    // Skip this space (and any subsequent ones will be skipped too due to in_space being true)
    r++;
  } else {
    // Copy non-space character
    *s++ = *r++;
    in_space = 0;  // We're no longer in a space
  }
}

// If the last character is a space, terminate the string before it
if (s > p && *(s-1) == ' ')
  s--;

// Terminate the string
*s = '\0';