{
  char *src = p;
  char *dst = p;
  int in_space = 1; /* begin by treating leading chars as spaces */

  while (*src != '\0')
  {
    if (isspace((unsigned char)*src))
    {
      /* insert one space if we're transitioning from non-space */
      if (!in_space)
      {
        *dst++ = ' ';
        in_space = 1;
      }
    }
    else
    {
      /* copy character and mark we're inside a word */
      *dst++ = *src;
      in_space = 0;
    }
    src++;
  }

  /* remove trailing space if any */
  if (dst > p && *(dst - 1) == ' ')
    dst--;
  *dst = '\0';
}