q=p;
entity=p;
while (isspace((int) ((unsigned char) *entity)))
  entity++;
c=0;
for ( ; *entity != '\0'; entity++)
{
  if (isspace((int) ((unsigned char) *entity)))
    {
      if (c == 0)
        {
          *q++=' ';
          c=1;
        }
    }
  else
    {
      *q++=*entity;
      c=0;
    }
}
if (q > p)
  {
    if (isspace((int) ((unsigned char) *(q-1))))
      q--;
  }
*q='\0';