char *read_ptr = p, *write_ptr = p;
      int in_word = 0;

      while (*read_ptr != '\0') {
        if (isspace((unsigned char)*read_ptr)) {
          if (in_word) {
            *write_ptr++ = ' ';
            in_word = 0;
          }
        } else {
          *write_ptr++ = *read_ptr;
          in_word = 1;
        }
        read_ptr++;
      }

      // Remove trailing space if present
      if (write_ptr > p && isspace((unsigned char)*(write_ptr - 1))) {
        write_ptr--;
      }

      *write_ptr = '\0';