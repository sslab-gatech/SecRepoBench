char *start = p;
      char *end = p;
      int in_word = 0;

      while (*start != '\0') {
        if (isspace((unsigned char)*start)) {
          if (in_word) {
            *end++ = ' ';
            in_word = 0;
          }
        } else {
          *end++ = *start;
          in_word = 1;
        }
        start++;
      }

      if (end > p && isspace((unsigned char)*(end - 1))) {
        end--;
      }
      *end = '\0';