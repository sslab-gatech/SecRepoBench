/*
  Insert the new tag at the specified offset.
*/
static XMLTreeInfo *InsertTagIntoXMLTree(XMLTreeInfo *xml_info, XMLTreeInfo *child, const size_t offset)
{
  XMLTreeInfo *head, *node, *previous;

  child->ordered = NULL;
  child->sibling = NULL;
  child->next = NULL;
  child->offset = offset;
  child->parent = xml_info;

  if (xml_info->child == NULL)
  {
    xml_info->child = child;
    return child;
  }

  head = xml_info->child;
  if (head->offset > offset)
  {
    child->ordered = head;
    xml_info->child = child;
  }
  else
  {
    node = head;
    while ((node->ordered != NULL) && (node->ordered->offset <= offset))
      node = node->ordered;
    child->ordered = node->ordered;
    node->ordered = child;
  }

  previous = NULL;
  node = head;
  while ((node != NULL) && (strcmp(node->tag, child->tag) != 0))
  {
    previous = node;
    node = node->sibling;
  }

  if ((node != NULL) && (node->offset <= offset))
  {
    while ((node->next != NULL) && (node->next->offset <= offset))
      node = node->next;
    child->next = node->next;
    node->next = child;
  }
  else
  {
    if ((previous != NULL) && (node != NULL))
      previous->sibling = node->sibling;
    child->next = node;
    previous = NULL;
    node = head;
    while ((node != NULL) && (node->offset <= offset))
    {
      previous = node;
      node = node->sibling;
    }
    child->sibling = node;
    if (previous != NULL)
      previous->sibling = child;
  }

  return child;
}