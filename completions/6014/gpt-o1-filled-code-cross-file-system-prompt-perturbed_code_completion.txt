{
  char *read = p;
  char *write = p;
  int last_space = 1; /* Assume we start as if the last character was space */

  while (*read != '\0')
  {
    if (isspace((unsigned char)*read))
    {
      /* If the last character wasn't a space, insert one space */
      if (!last_space)
      {
        *write++ = ' ';
        last_space = 1;
      }
      read++;
    }
    else
    {
      /* If it's not space, copy the character and mark last_space as false */
      *write++ = *read++;
      last_space = 0;
    }
  }

  /* Remove trailing space if any */
  if (write > p && *(write - 1) == ' ')
    write--;

  *write = '\0';
}