p = xml;
q = p;
while (*p != '\0')
{
  /* Skip leading spaces */
  if (isspace((int) ((unsigned char) *p)))
  {
    p++;
    continue;
  }
  
  /* Copy non-space character */
  *q++ = *p++;
  
  /* Copy a single space if followed by one or more spaces */
  if (*p != '\0' && isspace((int) ((unsigned char) *p)))
  {
    *q++ = ' ';
    /* Skip consecutive spaces */
    while (*p != '\0' && isspace((int) ((unsigned char) *p)))
      p++;
  }
}
/* If last character is a space, terminate before it */
if (q > xml && *(q-1) == ' ')
  q--;
*q = '\0';