// Normalize spaces for non-CDATA attributes.
  p = xml;
  while (*p != '\0') {
    // Skip leading spaces
    while (isspace((unsigned char)*p) && *p != '\0') {
      p++;
    }
    // Remove consecutive spaces
    q = p;
    while (*q != '\0' && !isspace((unsigned char)*q)) {
      q++;
    }
    // Compact the string by shifting non-space characters to the left
    while (*q != '\0') {
      *p++ = *q++;
    }
    *p = '\0';
  }
  // If the last character is a space, terminate the string before the space
  if (p > xml && isspace((unsigned char)*(p - 1))) {
    p--;
    *p = '\0';
  }