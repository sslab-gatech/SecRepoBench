{
  char *src, *dst;
  int in_space = 0;

  dst = xml;
  for (src = xml; *src != '\0'; src++)
  {
    if (isspace((unsigned char) *src))
    {
      in_space++;
    }
    else
    {
      if (in_space && dst != xml)
        *dst++ = ' ';
      *dst++ = *src;
      in_space = 0;
    }
  }
  *dst = '\0';

  /* Remove trailing space if present */
  if (dst > xml && *(dst - 1) == ' ')
    *(dst - 1) = '\0';
}