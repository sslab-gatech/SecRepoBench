char *start = p;
      char *end = p + strlen(p);

      while (start < end) {
        // Skip leading spaces
        while (start < end && isspace((int) ((unsigned char) *start))) {
          start++;
        }
        if (start == end) {
          break;
        }

        // Find the end of the word
        char *word_end = start;
        while (word_end < end && !isspace((int) ((unsigned char) *word_end))) {
          word_end++;
        }

        // Shift the word to the left to remove preceding spaces
        size_t word_len = word_end - start;
        memmove(p, start, word_len);
        p += word_len;

        // Add a space after the word if it's not the last word
        if (word_end < end) {
          *p++ = ' ';
        }

        start = word_end;
      }
      *p = '\0';