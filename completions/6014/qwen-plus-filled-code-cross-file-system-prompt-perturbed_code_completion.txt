{
  char *write = p;
  char *read = p;

  while (*read != '\0')
  {
    /* Skip leading spaces */
    while (*read == ' ')
      read++;

    if (*read == '\0')
      break;

    /* Copy non-space characters */
    while (*read != ' ' && *read != '\0')
      *(write++) = *(read++);

    /* Add a single space between words */
    if (*read == ' ')
      *(write++) = ' ';
  }

  /* Null-terminate the new string */
  *write = '\0';

  /* If the last character is a space, remove it */
  if (write > p && *(write - 1) == ' ')
    *(write - 1) = '\0';
}