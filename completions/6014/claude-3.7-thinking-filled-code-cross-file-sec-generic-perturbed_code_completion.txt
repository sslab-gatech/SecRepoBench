char *r = p;
char *w = p;

// Skip leading spaces
while (*r == ' ')
  r++;

// Process the rest of the string
while (*r != '\0') {
  if (*r != ' ') {
    // Copy non-space character
    *w++ = *r++;
  } else {
    // We found a space
    // Skip consecutive spaces
    while (*r == ' ')
      r++;
    
    // Add a space only if not at the end of the string
    if (*r != '\0')
      *w++ = ' ';
  }
}

// Null-terminate the string
*w = '\0';