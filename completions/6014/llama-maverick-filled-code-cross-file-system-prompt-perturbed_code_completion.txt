for (p=q=xml; *xml != '\0'; )
{
  if (isspace((int) ((unsigned char) *xml)) == 0)
    {
      if (p != q)
        *p++=' ';
      while ((isspace((int) ((unsigned char) *xml)) == 0) && (*xml != '\0'))
        *p++=(*xml++);
    }
  else
    xml++;
}
if ((p != q) && (p > q) && (isspace((int) ((unsigned char) *(p-1))) != 0))
  p--;
*p='\0';