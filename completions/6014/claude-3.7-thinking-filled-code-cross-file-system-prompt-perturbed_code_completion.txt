xml = p;  /* Start from the beginning of the string */
q = p;    /* q will be where we write the normalized string */

/* Skip leading spaces */
while (*xml == ' ')
  xml++;

/* Process the rest of the string */
while (*xml != '\0')
{
  /* Copy non-space characters */
  if (*xml != ' ')
    *(q++) = *xml;
  /* Copy a single space but skip consecutive spaces */
  else if (*(xml+1) != ' ' && *(xml+1) != '\0')
    *(q++) = ' ';
  xml++;
}
*q = '\0';  /* Terminate the string */