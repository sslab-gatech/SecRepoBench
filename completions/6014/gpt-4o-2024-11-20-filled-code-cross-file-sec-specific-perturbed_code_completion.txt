char *read_ptr = p;
      char *write_ptr = p;
      int in_space = 0;

      while (*read_ptr != '\0') {
        if (isspace((unsigned char)*read_ptr)) {
          if (!in_space) {
            *write_ptr++ = ' ';
            in_space = 1;
          }
        } else {
          *write_ptr++ = *read_ptr;
          in_space = 0;
        }
        read_ptr++;
      }

      // Remove trailing space if present
      if (write_ptr > p && *(write_ptr - 1) == ' ') {
        write_ptr--;
      }

      *write_ptr = '\0';