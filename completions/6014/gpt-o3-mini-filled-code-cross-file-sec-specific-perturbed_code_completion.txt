{
  char *src = p, *dst = p;
  int in_whitespace = 1;  /* true initially to skip leading spaces */

  while (*src != '\0')
  {
    if (isspace((unsigned char)*src))
    {
      if (!in_whitespace)
      {
        *dst++ = ' ';
        in_whitespace = 1;
      }
    }
    else
    {
      *dst++ = *src;
      in_whitespace = 0;
    }
    src++;
  }
  if (dst > p && *(dst - 1) == ' ')
    dst--;
  *dst = '\0';
}