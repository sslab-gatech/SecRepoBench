char *r = p;  // destination pointer
q = p;        // source pointer

// Process the entire string
while (*q != '\0')
{
  // Skip leading spaces at the beginning or after another space
  if (*q == ' ')
  {
    q++;  // skip the current space
    
    // Skip any additional spaces
    while (*q == ' ')
      q++;
    
    // Add a space only if there's more content ahead
    if (*q != '\0')
      *r++ = ' ';
  }
  else
    // Copy non-space character
    *r++ = *q++;
}

// Null-terminate the result
*r = '\0';