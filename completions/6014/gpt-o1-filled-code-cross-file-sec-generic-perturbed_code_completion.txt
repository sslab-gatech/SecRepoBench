{
  char *dest = p;
  char *src = p;

  /* Skip leading spaces */
  while (isspace((unsigned char)*src))
    src++;

  while (*src != '\0')
  {
    /* Copy non-spaces */
    while ((*src != '\0') && !isspace((unsigned char)*src))
      *dest++ = *src++;

    /* Skip consecutive spaces */
    while (isspace((unsigned char)*src))
      src++;

    /* If not at end of string, insert single space */
    if (*src != '\0')
      *dest++ = ' ';
  }

  /* Null-terminate the result */
  *dest = '\0';
}