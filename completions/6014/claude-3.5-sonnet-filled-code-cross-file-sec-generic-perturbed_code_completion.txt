char *p = xml;
char *q = xml;

while (*p != '\0') {
  // Skip leading spaces
  while (isspace((unsigned char)*p)) {
    p++;
  }

  // Move non-space characters
  while (*p != '\0' && !isspace((unsigned char)*p)) {
    *q++ = *p++;
  }

  // Add a single space between words if not at the end
  if (*p != '\0') {
    *q++ = ' ';
  }

  // Skip any remaining spaces
  while (isspace((unsigned char)*p)) {
    p++;
  }
}

// Null-terminate the compacted string
*q = '\0';

// Remove trailing space if present
if (q > xml && *(q - 1) == ' ') {
  *(--q) = '\0';
}