/* Temporarily disable generational mode */
  gc->generational = FALSE;

  /* Reset all old objects to young */
  mrb_heap_page *page = gc->heaps;
  while (page) {
    RVALUE *p = objects(page);
    RVALUE *e = p + MRB_HEAP_PAGE_SIZE;

    while (p < e) {
      if (p->as.basic.tt != MRB_TT_FREE) {
        p->as.basic.flags &= ~MRB_FLAG_OLD_OBJECT; /* Clear old flag */
      }
      p++;
    }
    page = page->next;
  }

  /* Perform a full garbage collection */
  incremental_gc_until(mrbstateptr, gc, MRB_GC_STATE_SWEEP);

  /* Re-enable generational mode */
  gc->generational = TRUE;