change_gen_gc_mode(mrb, gc, enable)
  if gc.disabled || gc.iterating
    mrb_raise(mrb, E_RUNTIME_ERROR, "generational mode changed when GC disabled")
    return
  end
  if is_generational(gc) && !enable
    clear_all_old(mrb, gc)
    mrb_assert(gc.state == MRB_GC_STATE_ROOT)
    gc.full = FALSE
  elsif !is_generational(gc) && enable
    incremental_gc_finish(mrb, gc)
    gc.majorgc_old_threshold = (gc.live_after_mark/100) * MAJOR_GC_INC_RATIO
    gc.full = FALSE
  end
  gc.generational = enable
end