// <MASK>
if (is_generational(gc)) {
  /* clear all the old objects back to young */
  clear_all_old(mrbstateptr, gc);
  gc->full = TRUE;
  incremental_sweep_phase(mrbstateptr, gc, MRB_HEAP_PAGE_SIZE);
  gc->generational = TRUE;
}
else {
  incremental_gc_finish(mrbstateptr, gc);
  gc->threshold = (gc->live_after_mark/100) * gc->interval_ratio;
  if (gc->state!= MRB_GC_STATE_ROOT) {
    /* finish half baked GC cycle */
    incremental_gc_finish(mrbstateptr, gc);
  }
}
gc->gray_list = gc->atomic_gray_list;
gc->atomic_gray_list = NULL;
gc->generational = TRUE;