if (m->matrix_changed++) {
    av_log(m->avctx, AV_LOG_ERROR,
           "Matrix parameters may change only once per access unit.\n");
    return AVERROR_INVALIDDATA;
}
{
    unsigned int allowed_primitive_matrices;
    /* Determine the allowed maximum number of primitive matrices based on codec type */
    if (m->avctx->codec_id == AV_CODEC_ID_MLP)
        allowed_primitive_matrices = 4;
    else
        allowed_primitive_matrices = 8;
    /* Retrieve the number of primitive matrices from the bitstream
       (the bitfield uses 2 bits to signal a value in the range 1 to 4) */
    s->num_primitive_matrices = get_bits(bit_context, 2) + 1;
    if (s->num_primitive_matrices > allowed_primitive_matrices) {
        av_log(m->avctx, AV_LOG_ERROR,
               "Number of primitive matrices %d exceeds allowed maximum %d.\n",
               s->num_primitive_matrices, allowed_primitive_matrices);
        return AVERROR_INVALIDDATA;
    }
}