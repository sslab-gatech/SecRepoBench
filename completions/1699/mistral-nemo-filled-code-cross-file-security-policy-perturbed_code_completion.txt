unsigned int max_primitive_matrices = 16; // Set a maximum limit for primitive matrices
    unsigned int num_primitive_matrices = get_bits(bit_context, 16);

    if (num_primitive_matrices > max_primitive_matrices) {
        av_log(m->avctx, AV_LOG_ERROR,
                "Number of primitive matrices exceeds the allowed maximum.\n");
        return AVERROR_INVALIDDATA;
    }

    if (m->matrix_changed[substr]++ > 1) {
        av_log(m->avctx, AV_LOG_ERROR,
                "Matrix configuration has been changed more than once per access unit.\n");
        return AVERROR_INVALIDDATA;
    }