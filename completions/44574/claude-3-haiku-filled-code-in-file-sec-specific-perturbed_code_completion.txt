// <MASK>
if (isnan(realval)) {
    len = snprintf(buf, bufsize, "nan");
} else if (isinf(realval)) {
    len = snprintf(buf, bufsize, "%cinfinity", (realval > 0.0) ? '+' : '-');
} else if (realval == 0.0f) {
    len = snprintf(buf, bufsize, "0.0");
} else {
    size_t i = 0;
    len = snprintf(buf, bufsize, "%.*g", 17, realval);
    for (i = 0; buf && i < len; i++) {
        if (buf[i] == ',') {
            buf[i] = '.';
            break;
        } else if (buf[i] == '.') {
            break;
        }
    }
}