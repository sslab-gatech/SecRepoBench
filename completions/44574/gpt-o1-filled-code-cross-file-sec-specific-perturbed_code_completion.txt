} else if (!strncmp("null", str_val, str_len)) {
    primitive_value = plist_new_null();
} else {
    char *num_str = (char *)malloc(str_len + 1);
    if (!num_str) {
        PLIST_JSON_ERR("%s: Out of memory\n", __func__);
        return NULL;
    }
    memcpy(num_str, str_val, str_len);
    num_str[str_len] = '\0';

    errno = 0;
    char *endptr = NULL;
    double val = strtod(num_str, &endptr);

    if (endptr == num_str || errno == ERANGE) {
        PLIST_JSON_ERR("%s: Invalid or out-of-range numeric value\n", __func__);
        free(num_str);
        return NULL;
    }

    while (isspace((unsigned char)*endptr)) {
        endptr++;
    }
    if (*endptr != '\0') {
        PLIST_JSON_ERR("%s: Trailing characters after numeric value\n", __func__);
        free(num_str);
        return NULL;
    }

    if (val == (int64_t)val) {
        int64_t ival = (int64_t)val;
        if (ival < 0) {
            primitive_value = plist_new_int(ival);
        } else {
            primitive_value = plist_new_uint((uint64_t)ival);
        }
    } else {
        primitive_value = plist_new_real(val);
    }

    free(num_str);
}