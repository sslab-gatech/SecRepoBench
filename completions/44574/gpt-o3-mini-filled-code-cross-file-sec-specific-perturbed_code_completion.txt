{
    char *numbuf = (char *)malloc(str_len + 1);
    if (!numbuf) {
        PLIST_JSON_ERR("%s: Out of memory\n", __func__);
        return NULL;
    }
    memcpy(numbuf, str_val, str_len);
    numbuf[str_len] = '\0';

    if (strcmp(numbuf, "null") == 0) {
        primitive_value = plist_new_null();
    } else {
        char *endptr = NULL;
        errno = 0;
        long int_val = strtol(numbuf, &endptr, 10);
        if (endptr != numbuf && *endptr == '\0' && errno != ERANGE) {
            primitive_value = plist_new_int(int_val);
        } else {
            errno = 0;
            double dval = strtod(numbuf, &endptr);
            if (endptr != numbuf && *endptr == '\0' && errno != ERANGE) {
                primitive_value = plist_new_real(dval);
            } else {
                PLIST_JSON_ERR("%s: numeric value parsing error\n", __func__);
                free(numbuf);
                return NULL;
            }
        }
    }
    free(numbuf);
}