const uint8_t *buf = avpkt->data;
int buf_size = avpkt->size;
SpeedhqContext *s = codec_context->priv_data;

if (buf_size < 4) {
    av_log(codec_context, AV_LOG_WARNING, "truncated header\n");
    return AVERROR_INVALIDDATA;
}

int quality = buf[0];
speedhq_calculate_qtable(s, quality);