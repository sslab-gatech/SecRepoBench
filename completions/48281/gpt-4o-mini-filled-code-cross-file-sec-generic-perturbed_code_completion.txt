const uint8_t *buf = avpkt->data;
    int buf_size = avpkt->size;
    SpeedhqContext *s = codec_context->priv_data;
    int ret;

    if (buf_size < 4) {
        return AVERROR_INVALIDDATA;
    }

    s->buf = buf;
    s->size = buf_size;

    // Initialize the decoding process
    if ((ret = ff_get_buffer(codec_context, frame, 0)) < 0) {
        return ret;
    }

    // Set frame properties
    frame->key_frame = 1;
    frame->pict_type = AV_PICTURE_TYPE_I;

    // Perform additional decoding steps as necessary
    // Ensure that the decoding process is secure and does not lead to buffer overflows
    if (buf_size > MAX_BUFFER_SIZE) {
        return AVERROR_INVALIDDATA; // Prevent buffer overflow
    }

    // Proceed with decoding logic