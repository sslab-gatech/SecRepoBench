int quality = AV_RL24(buf + 4);
int qmat_size = 64;
uint8_t qmat[64];

if (quality < 1) {
    quality = 1;
} else if (quality > 31) {
    quality = 31;
}

for (int i = 0; i < qmat_size; i++) {
    qmat[i] = ff_mpeg4_default_intra_matrix[i] * (32 - quality) / 16;
}

codec_context->idct_algo = FF_IDCT_AUTO;
codec_context->dct_algo = FF_DCT_AUTO;
codec_context->flags |= AV_CODEC_FLAG_GRAY;