// <MASK>
int quality = AV_RL24(buf + 4);
if (quality < 1 || quality > 100) {
    return AVERROR_INVALIDDATA;
}

int qmat_size = 64 * sizeof(int16_t);
s->qmat = av_malloc(qmat_size);
if (!s->qmat) {
    return AVERROR(ENOMEM);
}

speedhq_calculate_qmat(s->qmat, quality);

codec_context->width = FFALIGN(codec_context->width, 8);
codec_context->height = FFALIGN(codec_context->height, 8);