const uint8_t *buf = avpkt->data;
int buf_size = avpkt->size;
SpeedHQContext *s = codec_context->priv_data;
int quality, ret;

if (buf_size < 4 || codec_context->width <= 0 || codec_context->height <= 0) {
    return AVERROR_INVALIDDATA;
}

quality = buf[0];
speedhq_calculate_quant_matrix(s, quality);