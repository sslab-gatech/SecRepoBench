int ret;
const uint8_t *buf = avpkt->data;
int buf_size = avpkt->size;
SHQContext *s = codec_context->priv_data;

if (buf_size < 5)
    return AVERROR_INVALIDDATA;

if (buf[0]!= 0x80)
    return AVERROR_INVALIDDATA;

s->quality = buf[4];
if (s->quality < 1 || s->quality > 100)
    return AVERROR_INVALIDDATA;

if ((ret = ff_set_dimensions(codec_context, codec_context->width, codec_context->height)) < 0)
    return ret;

if ((ret = ff_get_buffer(codec_context, frame, 0)) < 0)
    return ret;