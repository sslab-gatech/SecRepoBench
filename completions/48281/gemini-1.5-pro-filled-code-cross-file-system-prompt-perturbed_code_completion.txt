SpeedHQContext *s = codec_context->priv_data;
    const uint8_t *buf = avpkt->data;
    int buf_size = avpkt->size;
    int second_field_offset;
    int ret;

    if (buf_size < 8) {
        return AVERROR_INVALIDDATA;
    }

    if (AV_RL32(buf) != MKTAG('S', 'P', 'H', 'Q'))
        return AVERROR_INVALIDDATA;
    if (buf[4] != 0)
        return AVERROR_INVALIDDATA;

    s->quality = buf[5];
    if (s->quality > 63)
        s->quality = 63;
    s->quality = 63 - s->quality;

    ff_speedhq_generate_qmat(s->qmat, s->quality);