SpeedHQContext *s = codec_context->priv_data;
    const uint8_t *buf = avpkt->data;
    int buf_size = avpkt->size;
    int second_field_offset, ret;

    if (buf_size < 7) {
        return AVERROR_INVALIDDATA;
    }

    if (codec_context->width  <= 0 || codec_context->width  > 2048 ||
        codec_context->height <= 0 || codec_context->height > 2048) {
        return AVERROR_INVALIDDATA;
    }

    s->quality = buf[0];
    if (s->quality > 31)
        s->quality = 31;

    calculate_quantization_matrix(s->quantization_matrix, s->quality);