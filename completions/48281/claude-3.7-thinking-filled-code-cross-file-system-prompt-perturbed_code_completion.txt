const uint8_t *buf = avpkt->data;
int buf_size = avpkt->size;
SpeedhqContext *s = codec_context->priv_data;
int ret, second_field_offset;

if (buf_size < 8) {
    av_log(codec_context, AV_LOG_ERROR, "Packet too small\n");
    return AVERROR_INVALIDDATA;
}

// Extract quality parameter from the first byte
uint8_t quality = buf[0];
// Calculate quantization matrix based on quality
speedhq_calculate_qtable(s, quality);