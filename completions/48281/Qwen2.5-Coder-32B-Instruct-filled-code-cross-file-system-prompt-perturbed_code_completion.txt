const uint8_t *buf = avpkt->data;
int buf_size = avpkt->size;
SpeedHQContext *s = codec_context->priv_data;
int ret;

if (buf_size < 7) {
    av_log(codec_context, AV_LOG_WARNING, "truncated header\n");
    return AVERROR_INVALIDDATA;
}

codec_context->width = AV_RL16(buf);
codec_context->height = AV_RL16(buf + 2);

ret = ff_set_dimensions(codec_context, codec_context->width, codec_context->height);
if (ret < 0)
    return ret;

calculate_quantization_matrix(s, buf[6]);