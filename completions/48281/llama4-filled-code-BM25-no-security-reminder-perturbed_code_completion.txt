const uint8_t *buf = avpkt->data;
int buf_size = avpkt->size;
SpeedhqContext *s = codec_context->priv_data;
int ret;

if (buf_size < 4) {
    return AVERROR_INVALIDDATA;
}

if (codec_context->width <= 0 || codec_context->width > 720 ||
    codec_context->height <= 0 || codec_context->height > 576) {
    return AVERROR_INVALIDDATA;
}

int quant = buf[3];
if (quant > 99) {
    return AVERROR_INVALIDDATA;
}

// Calculate quantization matrix based on the quality parameter
tgq_calculate_qtable(s, quant);