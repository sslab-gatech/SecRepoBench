SHQContext *s = codec_context->priv_data;
const uint8_t *buf = avpkt->data;
int buf_size = avpkt->size;
int ret, second_field_offset;

if (buf_size < 4) {
    return AVERROR_INVALIDDATA;
}

if (codec_context->width < 8) {
    return AVERROR_INVALIDDATA;
}

/* Quality parameter. */
int quality = buf[0];
if (quality < 1 || quality > 100) {
    return AVERROR_INVALIDDATA;
}

/* Convert the quality value to a quantization parameter. */
int qscale = quality < 50 ? 5000 / quality : 200 - (quality * 2);
compute_quant_matrix(s->quant_matrix, qscale);