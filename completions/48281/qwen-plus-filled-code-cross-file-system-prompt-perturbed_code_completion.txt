const uint8_t *buf = avpkt->data;
int buf_size = avpkt->size;
SpeedHQContext *s = codec_context->priv_data;

if (buf_size < 16) {
    av_log(codec_context, AV_LOG_ERROR, "Packet is too small to contain valid data.\n");
    return AVERROR_INVALIDDATA;
}

if ((codec_context->width % 16) != 0 || (codec_context->height % 16) != 0) {
    av_log(codec_context, AV_LOG_ERROR, "Codec context dimensions must be multiples of 16.\n");
    return AVERROR(EINVAL);
}

int quality_param = AV_RL32(buf);
speedhq_calculate_qmatrix(s, quality_param);