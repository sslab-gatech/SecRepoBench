const uint8_t *buf = avpkt->data;
int buf_size       = avpkt->size;
SpeedHQContext *s = codec_context->priv_data;
int ret;

if (buf_size < 4) {
    av_log(codec_context, AV_LOG_WARNING, "truncated header\n");
    return AVERROR_INVALIDDATA;
}

s->quality = buf[0];
buf += 1;
buf_size -= 1;

speedhq_calculate_qtable(s, s->quality);