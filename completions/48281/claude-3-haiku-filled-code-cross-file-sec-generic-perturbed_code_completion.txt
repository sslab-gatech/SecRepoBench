// <MASK>
int quality = AV_RL24(buf + 4);
if (quality < 0 || quality > 100) {
    return AVERROR_INVALIDDATA;
}

int qmat_size = 64 * sizeof(int16_t);
s->qmat = av_malloc(qmat_size);
if (!s->qmat) {
    return AVERROR(ENOMEM);
}

speedhq_calculate_qmat(s->qmat, quality);

if ((ret = decode_speedhq_frame(s, buf, buf_size, frame)) < 0) {
    av_freep(&s->qmat);
    return ret;
}