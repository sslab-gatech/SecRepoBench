static int speedhq_decode_frame(AVCodecContext *codec_context, AVFrame *frame,
                                int *got_frame, AVPacket *avpkt)
{
    // Initialize context and packet data variables for processing the frame.
    // Validate basic constraints on packet size and codec context width to ensure data integrity.
    // Extract a quality parameter from the packet data to adjust processing parameters.
    // Calculate a quantization matrix based on the quality parameter to prepare for further decoding.
    int qscale = get_qscale(avpkt->data, avpkt->size);
    compute_quant_matrix(s->quant_matrix, qscale);

    // Initialize the packet data reader and frame data pointers.
    GetBitContext gb;
    init_get_bits8(&gb, avpkt->data, avpkt->size);

    // Decode the frame.
    if ((ret = decode_speedhq_field(s, avpkt->data, avpkt->size, frame, 0, 4, second_field_offset, 2)) < 0)
        return ret;
    if ((ret = decode_speedhq_field(s, avpkt->data, avpkt->size, frame, 1, second_field_offset, avpkt->size, 2)) < 0)
        return ret;

    *got_frame = 1;
    return avpkt->size;
}