const uint8_t *buf = avpkt->data;
    int buf_size = avpkt->size;
    SpeedHQContext *s = codec_context->priv_data;
    int ret, second_field_offset;
    int quality;

    if (buf_size < 8 || codec_context->width <= 0 || codec_context->height <= 0)
        return AVERROR_INVALIDDATA;

    quality = buf[0] & 0x3F;
    speedhq_calculate_qtable(s, quality);