const uint8_t *buf = avpkt->data;
int buf_size = avpkt->size;

if (buf_size < 8) {
    av_log(codec_context, AV_LOG_WARNING, "truncated header\n");
    return AVERROR_INVALIDDATA;
}

codec_context->width = AV_RL16(buf);
codec_context->height = AV_RL16(buf + 2);

if (ff_set_dimensions(codec_context, codec_context->width, codec_context->height) < 0)
    return AVERROR_INVALIDDATA;