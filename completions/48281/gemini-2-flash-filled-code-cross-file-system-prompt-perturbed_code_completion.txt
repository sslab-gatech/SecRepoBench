SpeedHQContext *s = codec_context->priv_data;
    const uint8_t *buf = avpkt->data;
    int buf_size = avpkt->size;
    int second_field_offset, ret;

    if (buf_size < 8)
        return AVERROR_INVALIDDATA;

    if (codec_context->width  <= 0 || codec_context->width  > 2048 ||
        codec_context->height <= 0 || codec_context->height > 2048)
        return AVERROR_INVALIDDATA;

    s->quality = AV_RL32(buf + 4);
    if (s->quality <= 0 || s->quality > 256)
        return AVERROR_INVALIDDATA;

    calculate_quantization_matrix(s, s->quality);