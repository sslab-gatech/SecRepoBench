SHQContext * const s = codec_context->priv_data;
    const uint8_t *buf = avpkt->data;
    int buf_size = avpkt->size;
    int ret;
    int qscale;
    int second_field_offset;

    if (buf_size < 4) {
        return AVERROR_INVALIDDATA;
    }

    qscale = buf[0];
    if (qscale < 1 || qscale > 31) {
        av_log(codec_context, AV_LOG_ERROR, "Invalid qscale value: %d\n", qscale);
        return AVERROR_INVALIDDATA;
    }

    compute_quant_matrix(s->quant_matrix, qscale);