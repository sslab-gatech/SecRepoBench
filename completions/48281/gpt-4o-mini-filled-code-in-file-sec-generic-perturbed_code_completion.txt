const uint8_t *buf = avpkt->data;
    int buf_size = avpkt->size;
    int ret;

    if (buf_size < 4) {
        return AVERROR_INVALIDDATA;
    }

    int qscale = buf[0]; // Extract quality scale from the first byte of the packet
    compute_quant_matrix(s->quant_matrix, qscale); // Compute the quantization matrix based on the quality scale

    int second_field_offset = AV_RL24(buf + 1);
    if (second_field_offset >= buf_size - 3) {
        return AVERROR_INVALIDDATA;
    }

    codec_context->coded_width = FFALIGN(codec_context->width, 16);
    codec_context->coded_height = FFALIGN(codec_context->height, 16);

    if ((ret = ff_get_buffer(codec_context, frame, 0)) < 0) {
        return ret;
    }
    frame->key_frame = 1;