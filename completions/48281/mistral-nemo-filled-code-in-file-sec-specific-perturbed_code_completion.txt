static int speedhq_decode_frame(AVCodecContext *codec_context, AVFrame *frame,
                                int *got_frame, AVPacket *avpkt)
{
    // Initialize context and packet data variables for processing the frame.
    // Validate basic constraints on packet size and codec context width to ensure data integrity.
    // Extract a quality parameter from the packet data to adjust processing parameters.
    // Calculate a quantization matrix based on the quality parameter to prepare for further decoding.
    const uint8_t *buf = avpkt->data;
    const int buf_size = avpkt->size;
    SHQContext *s = codec_context->priv_data;
    int ret, qscale;

    if (buf_size < 4)
        return AVERROR_INVALIDDATA;

    // Extract quality parameter from packet data
    qscale = buf[0];

    // Calculate quantization matrix based on quality parameter
    compute_quant_matrix(s->quant_matrix, qscale);

    // Rest of the function remains the same as provided in the context
    // ...

    return speedhq_decode_frame(codec_context, frame, got_frame, avpkt);
}