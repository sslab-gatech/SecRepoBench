if ((__xmlRegisterCallbacks) && (xmlDeregisterNodeDefaultValue))
        xmlDeregisterNodeDefaultValue((xmlNodePtr)attribute);

    xmlDocPtr doc = (reader != NULL && reader->ctxt != NULL) ? reader->ctxt->myDoc : NULL;
    if (doc != NULL) {
        if (attribute->atype == XML_ATTRIBUTE_ID)
            xmlRemoveID(doc, attribute);
        else if (attribute->atype == XML_ATTRIBUTE_IDREF || attribute->atype == XML_ATTRIBUTE_IDREFS)
            xmlRemoveRef(doc, attribute);
    }

    if (attribute->children != NULL) {
        xmlTextReaderFreeNodeList(reader, attribute->children);
        attribute->children = NULL;
    }

    DICT_FREE(attribute->name);