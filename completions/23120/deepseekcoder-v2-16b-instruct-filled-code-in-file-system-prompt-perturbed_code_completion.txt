);
        xmlBufferFree(buff2);
    }
    resbuf = xmlBufferContent(buff);
    xmlBufferFree(buff);
    return resbuf;
}

/**
 * xmlTextReaderReadOuterXml:
 * @reader:  the xmlTextReaderPtr used
 *
 * Reads the contents of the current node including child nodes and markup,
 * and also the closing tag.
 *
 * Returns a string containing the XML content, or NULL if the current node
 *         is neither an element nor attribute, or has no child nodes. The
 *         string must be deallocated by the caller.
 */
xmlChar *
xmlTextReaderReadOuterXml(xmlTextReaderPtr reader ATTRIBUTE_UNUSED)
{
    xmlChar *resbuf;
    xmlNodePtr node, cur_node;
    xmlBufferPtr buff, buff2;
    xmlDocPtr doc;

    if (xmlTextReaderExpand(reader) == NULL) {
        return NULL;
    }
    doc = reader->node->doc;
    buff = xmlBufferCreate();
    if (buff == NULL)
        return NULL;
    for (cur_node = reader->node->children; cur_node != NULL;
         cur_node = cur_node->next) {
        /* XXX: Why is the node copied? */
        node = xmlDocCopyNode(cur_node, doc, 1);
        buff2 = xmlBufferCreate();
        if (xmlNodeDump(buff2, doc, node, 0, 0) == -1) {
            xmlFreeNode(node);
            xmlBufferFree(buff2);
            xmlBufferFree(buff);
            return NULL;
        }
        xmlBufferCat(buff, buff2->content);
        xmlFreeNode(node);
        xmlBufferFree(buff2);
    }
    buff2 = xmlBufferCreate();
    if (xmlNodeDump(buff2, doc, reader->node, 0, 0) == -1) {
        xmlBufferFree(buff);
        xmlBufferFree(buff2);
        return NULL;
    }
    xmlBufferCat(buff, buff2->content);
    xmlBufferFree(buff2);
    resbuf = xmlBufferContent(buff);
    xmlBufferFree(buff);
    return resbuf;
}
#endif /* LIBXML_WRITER_ENABLED */

/**
 * xmlTextReaderGetParserProp:
 * @reader:  the xmlTextReaderPtr used
 * @prop:  the property to get
 *
 * Gets the value of a parser property.
 *
 * Returns the value of the property, or -1 in case of error.
 */
int
xmlTextReaderGetParserProp(xmlTextReaderPtr reader, int prop) {
    if (reader == NULL)
	return(-1);
    switch (prop) {
    case XML_PARSER_DEFAULTATTRS:
	return(reader->ctxt->defaultAttrs);
    case XML_PARSER_VALIDATE:
	return(reader->ctxt->validate);
    case XML_PARSER_SUBST_ENTITIES:
	return(reader->ctxt->substEntities);
    case XML_PARSER_NAMESPACE:
	return(reader->ctxt->ns);
    case XML_PARSER_NS_AUTOCLOSE:
	return(reader->ctxt->nsAutoClose);
    case XML_PARSER_NS_UNDECL:
	return(reader->ctxt->nsUnDecl);
    case XML_PARSER_NS_PFXLEN:
	return(reader->ctxt->nsPfxLen);
    case XML_PARSER_NS_PFXLEN_MAX:
	return(reader->ctxt->nsPfxLenMax);
    case XML_PARSER_NS_PFX_COUNT:
	return(reader->ctxt->nsPfxCount);
    case XML_PARSER_NS_PFX_TABLE:
	return(reader->ctxt->nsPfxTable);
    case XML_PARSER_NS_PFX_TABLE_SIZE:
	return(reader->ctxt->nsPfxTableSize);
    case XML_PARSER_NS_PFX_TABLE_MASK:
	return(reader->ctxt->nsPfxTableMask);
    case XML_PARSER_NS_PFX_TABLE_HASH:
	return(reader->ctxt->nsPfxTableHash);
    case XML_PARSER_NS_PFX_TABLE_SHIFT:
	return(reader->ctxt->nsPfxTableShift);
    case XML_PARSER_NS_PFX_TABLE_MASK_SHIFT:
	return(reader->ctxt->nsPfxTableMaskShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_SHIFT:
	return(reader->ctxt->nsPfxTableHashShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK:
	return(reader->ctxt->nsPfxTableHashMask);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT_SHIFT:
	return(reader->ctxt->nsPfxTableHashMaskShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShiftShift);
    case XML_PARSER_NS_PFX_TABLE_HASH_MASK_SHIFT