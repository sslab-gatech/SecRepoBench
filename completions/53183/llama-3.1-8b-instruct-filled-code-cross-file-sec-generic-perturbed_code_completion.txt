static const char*
get_num(mrb_state *mrb, const char *p, const char *end, int *value_pointer)
{
  mrb_int len = end - p;
  if (len == 0) return NULL;

  if (len > 1 && p[0] == '-' && p[1] == '0') {
    if (len == 2) {
      *value_pointer = 0;
      return p + 2;
    }
    else if (len == 3 && p[2] == 'x') {
      *value_pointer = 0;
      return p + 3;
    }
  }

  mrb_int value = 0;
  const char *ptr = p;
  while (ptr < end) {
    char c = *ptr++;
    if (c >= '0' && c <= '9') {
      value = value * 10 + (c - '0');
    }
    else {
      break;
    }
  }

  *value_pointer = value;
  return ptr;
}