const char *e = p;
char *end_ptr;
long value = strtol(p, &end_ptr, 10);

if (end_ptr == p || end_ptr > end) {
    return NULL; // Parsing failed
}

if (value_pointer) {
    *value_pointer = (int)value;
}

return end_ptr;