const char *e = NULL;
int value = 0;
int sign = 1;
int base = 10;

if (*p == '-') {
  sign = -1;
  p++;
}
else if (*p == '+') {
  p++;
}

if (*p == '0') {
  if (p[1] == 'x' || p[1] == 'X') {
    base = 16;
    p += 2;
  }
  else if (p[1] == 'b' || p[1] == 'B') {
    base = 2;
    p += 2;
  }
  else if (p[1] == 'o' || p[1] == 'O') {
    base = 8;
    p += 2;
  }
}

while (p < end) {
  int digit;
  if (*p >= '0' && *p <= '9') {
    digit = *p - '0';
  }
  else if (*p >= 'a' && *p <= 'z') {
    digit = *p - 'a' + 10;
  }
  else if (*p >= 'A' && *p <= 'Z') {
    digit = *p - 'A' + 10;
  }
  else {
    break;
  }

  if (digit >= base) {
    break;
  }

  if (value > (INT_MAX - digit) / base) {
    // overflow
    return NULL;
  }

  value = value * base + digit;
  p++;
}

value *= sign;
if (value < INT_MIN || value > INT_MAX) {
  // overflow
  return NULL;
}

*value_pointer = value;
e = p;