const char *e = p;
  int val = 0;

  if (p == end) return NULL;
  if (*p == '-') {
    e++;
    if (e == end) return NULL;
    if (!isdigit(*e)) return NULL;
    for (; e < end; e++) {
      if (!isdigit(*e)) break;
      val = val * 10 - (*e - '0');
      if (val > 0) return NULL; /* overflow */
    }
  }
  else if (isdigit(*p)) {
    for (; e < end; e++) {
      if (!isdigit(*e)) break;
      val = val * 10 + (*e - '0');
      if (val < 0) return NULL; /* overflow */
    }
  }
  else {
    return NULL;
  }

  if (value_pointer) *value_pointer = val;