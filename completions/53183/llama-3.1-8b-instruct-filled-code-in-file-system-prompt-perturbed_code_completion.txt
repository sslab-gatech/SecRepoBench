static const char*
get_num(mrb_state *mrb, const char *p, const char *end, int *value_pointer)
{
  mrb_int base = 10;
  mrb_int sign = 1;
  mrb_int value = 0;
  const char *start = p;

  while (p < end && *p >= '0' && *p <= '9') {
    value = value * base + (*p - '0');
    p++;
  }

  if (p < end && (*p == '+' || *p == '-')) {
    sign = (*p == '-')? -1 : 1;
    p++;
  }

  if (p < end && *p == '0' && p + 1 < end && *(p + 1) == 'x' || *p == '0' && p + 1 < end && *(p + 1) == 'X') {
    base = 16;
    p += 2;
  }
  else if (p < end && *p == '0' && p + 1 < end && *(p + 1) == 'b' || *p == '0' && p + 1 < end && *(p + 1) == 'B') {
    base = 2;
    p += 2;
  }
  else if (p < end && *p == '0' && p + 1 < end && *(p + 1) == 'o') {
    base = 8;
    p += 2;
  }

  while (p < end && *p >= '0' && *p <= '9') {
    value = value * base + (*p - '0');
    p++;
  }

  if (p < end && *p == 'h' || p < end && *p == 'H') {
    if (base == 16) {
      base = 16;
    }
    else if (base == 8) {
      base = 8;
    }
    else {
      base = 10;
    }
    p++;
  }

  if (p < end && *p == 'l' || p < end && *p == 'L') {
    if (base == 16) {
      base = 16;
    }
    else if (base == 8) {
      base = 8;
    }
    else {
      base = 10;
    }
    p++;
  }

  if (p < end && *p == 'u') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'x' || p < end && *p == 'X') {
    base = 16;
    p++;
  }

  if (p < end && *p == 'b' || p < end && *p == 'B') {
    base = 2;
    p++;
  }

  if (p < end && *p == 'o') {
    base = 8;
    p++;
  }

  if (p < end && *p == 'd' || p < end && *p == 'i') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'f') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'e' || p < end && *p == 'E') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'g' || p < end && *p == 'G') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'c') {
    base = 10;
    p++;
  }

  if (p < end && *p =='s') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'p') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'n') {
    base = 10;
    p++;
  }

  if (p < end && *p == 't') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'x' || p < end && *p == 'X') {
    base = 16;
    p++;
  }

  if (p < end && *p == 'o') {
    base = 8;
    p++;
  }

  if (p < end && *p == 'b' || p < end && *p == 'B') {
    base = 2;
    p++;
  }

  if (p < end && *p == 'u') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'd' || p < end && *p == 'i') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'f') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'e' || p < end && *p == 'E') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'g' || p < end && *p == 'G') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'c') {
    base = 10;
    p++;
  }

  if (p < end && *p =='s') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'p') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'n') {
    base = 10;
    p++;
  }

  if (p < end && *p == 't') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'x' || p < end && *p == 'X') {
    base = 16;
    p++;
  }

  if (p < end && *p == 'o') {
    base = 8;
    p++;
  }

  if (p < end && *p == 'b' || p < end && *p == 'B') {
    base = 2;
    p++;
  }

  if (p < end && *p == 'u') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'd' || p < end && *p == 'i') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'f') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'e' || p < end && *p == 'E') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'g' || p < end && *p == 'G') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'c') {
    base = 10;
    p++;
  }

  if (p < end && *p =='s') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'p') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'n') {
    base = 10;
    p++;
  }

  if (p < end && *p == 't') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'x' || p < end && *p == 'X') {
    base = 16;
    p++;
  }

  if (p < end && *p == 'o') {
    base = 8;
    p++;
  }

  if (p < end && *p == 'b' || p < end && *p == 'B') {
    base = 2;
    p++;
  }

  if (p < end && *p == 'u') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'd' || p < end && *p == 'i') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'f') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'e' || p < end && *p == 'E') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'g' || p < end && *p == 'G') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'c') {
    base = 10;
    p++;
  }

  if (p < end && *p =='s') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'p') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'n') {
    base = 10;
    p++;
  }

  if (p < end && *p == 't') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'x' || p < end && *p == 'X') {
    base = 16;
    p++;
  }

  if (p < end && *p == 'o') {
    base = 8;
    p++;
  }

  if (p < end && *p == 'b' || p < end && *p == 'B') {
    base = 2;
    p++;
  }

  if (p < end && *p == 'u') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'd' || p < end && *p == 'i') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'f') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'e' || p < end && *p == 'E') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'g' || p < end && *p == 'G') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'c') {
    base = 10;
    p++;
  }

  if (p < end && *p =='s') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'p') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'n') {
    base = 10;
    p++;
  }

  if (p < end && *p == 't') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'x' || p < end && *p == 'X') {
    base = 16;
    p++;
  }

  if (p < end && *p == 'o') {
    base = 8;
    p++;
  }

  if (p < end && *p == 'b' || p < end && *p == 'B') {
    base = 2;
    p++;
  }

  if (p < end && *p == 'u') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'd' || p < end && *p == 'i') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'f') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'e' || p < end && *p == 'E') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'g' || p < end && *p == 'G') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'c') {
    base = 10;
    p++;
  }

  if (p < end && *p =='s') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'p') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'n') {
    base = 10;
    p++;
  }

  if (p < end && *p == 't') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'x' || p < end && *p == 'X') {
    base = 16;
    p++;
  }

  if (p < end && *p == 'o') {
    base = 8;
    p++;
  }

  if (p < end && *p == 'b' || p < end && *p == 'B') {
    base = 2;
    p++;
  }

  if (p < end && *p == 'u') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'd' || p < end && *p == 'i') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'f') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'e' || p < end && *p == 'E') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'g' || p < end && *p == 'G') {
    base = 10;
    p++;
  }

  if (p < end && *p == 'c') {
    base