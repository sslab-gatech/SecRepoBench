{
  long value = 0;
  int sign = 1;
  int digits = 0;

  /* optional sign */
  if (p < end && (*p == '+' || *p == '-')) {
    if (*p == '-') sign = -1;
    p++;
  }
  /* parse digits */
  for (; p < end && isdigit((unsigned char)*p); p++) {
    int d = (*p - '0');
    if (value > (LONG_MAX - d) / 10) {
      /* overflow */
      return NULL;
    }
    value = value * 10 + d;
    digits++;
  }
  if (digits == 0) {
    /* no digits parsed */
    return NULL;
  }
  value *= sign;
  if (value < INT_MIN || value > INT_MAX) {
    /* out of range for int */
    return NULL;
  }
  *value_pointer = (int)value;
  return p;
}