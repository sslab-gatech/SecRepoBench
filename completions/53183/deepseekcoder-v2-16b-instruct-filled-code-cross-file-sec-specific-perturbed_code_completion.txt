int base = 10;
  const char *e = p;
  if (p < end && *p == '0') {
    if (p + 1 < end && (*(p + 1) == 'x' || *(p + 1) == 'X')) {
      base = 16;
      e = p + 2;
    } else {
      base = 8;
      e = p + 1;
    }
  }

  while (e < end && *e >= '0' && *e <= '9') {
    e++;
  }

  if (e > p) {
    errno = 0;
    char *endptr;
    long val = strtol(p, &endptr, base);
    if (endptr == e && errno == 0) {
      *value_pointer = (int)val;
      return e;
    }
  }

  return NULL;