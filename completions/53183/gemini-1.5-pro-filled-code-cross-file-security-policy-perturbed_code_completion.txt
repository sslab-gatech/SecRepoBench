int value = 0;
  const char *e = p;
  if (p < end && *p == '-') {
    e++;
    if (e < end && mrb_isdigit(*e)) {
      do {
        if (value < INT_MIN/10 || (value == INT_MIN/10 && (*e - '0') > -(INT_MIN%10))) {
          // Integer underflow
          return NULL;
        }

        value = value * 10 - (*e - '0');
        e++;
      } while (e < end && mrb_isdigit(*e));
    }
  }
  else {
    if (e < end && mrb_isdigit(*e)) {
      do {

        if (value > INT_MAX/10 || (value == INT_MAX/10 && (*e - '0') > INT_MAX%10)) {
          // Integer overflow
          return NULL;
        }
        value = value * 10 + (*e - '0');
        e++;
      } while (e < end && mrb_isdigit(*e));
    }
  }

  if (e == p) return NULL; // no digits found

  *value_pointer = value;