if (max_matrix_channel >= std_max_matrix_channel) {
        av_log(m->avctx, AV_LOG_ERROR, "Too many matrix channels: %d.\n",
               max_matrix_channel);
        return AVERROR_INVALIDDATA;
    }

    if (m->avctx->codec_id == AV_CODEC_ID_TRUEHD) {
        s->mask = get_bits_long(gbp, 24);
        if (!s->mask) {
            av_log(m->avctx, AV_LOG_ERROR, "Invalid TrueHD channel layout mask.\n");
            return AVERROR_INVALIDDATA;
        }
    } else {
        s->mask = 0;
        for (ch = min_channel; ch <= maxaudiochannel; ch++)
            s->mask |= 1ULL << mlp_stereo_map[ch];
    }