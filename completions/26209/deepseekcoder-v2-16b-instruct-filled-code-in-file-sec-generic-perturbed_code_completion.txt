static int decode_frame(AVCodecContext *avctx, AVFrame *picture,
                        AVPacket *avpkt, int *got_frame)
{
    MJpegDecodeContext *s = avctx->priv_data;
    GetByteContext gb;
    int ret, i, j, nb_components;
    int Al = s->bits - 8;
    int width, height;
    int progressive = s->progressive;
    int interlaced  = s->interlaced;
    int bottom_field = s->bottom_field;
    int field_mode = 0;
    int field_picture = 0;
    int field_end = 0;
    int field_start = 0;
    int field_next = 0;
    int field_prev = 0;
    int field_cur = 0;
    int field_top = 0;
    int field_bot = 0;
    int field_top_start = 0;
    int field_bot_start = 0;
    int field_top_end = 0;
    int field_bot_end = 0;
    int field_top_next = 0;
    int field_bot_next = 0;
    int field_top_prev = 0;
    int field_bot_prev = 0;
    int field_top_cur = 0;
    int field_bot_cur = 0;
    int field_top_mb = 0;
    int field_bot_mb = 0;
    int field_top_mb_x = 0;
    int field_bot_mb_x = 0;
    int field_top_mb_y = 0;
    int field_bot_mb_y = 0;
    int field_top_mb_width = 0;
    int field_bot_mb_width = 0;
    int field_top_mb_height = 0;
    int field_bot_mb_height = 0;
    int field_top_mb_linesize = 0;
    int field_bot_mb_linesize = 0;
    int field_top_mb_size = 0;
    int field_bot_mb_size = 0;
    int field_top_mb_size_x = 0;
    int field_bot_mb_size_x = 0;
    int field_top_mb_size_y = 0;
    int field_bot_mb_size_y = 0;
    int field_top_mb_size_xy = 0;
    int field_bot_mb_size_xy = 0;
    int field_top_mb_size_x_y = 0;
    int field_bot_mb_size_x_y = 0;
    int field_top_mb_size_xy_y = 0;
    int field_bot_mb_size_xy_y = 0;
    int field_top_mb_size_x_y_x = 0;
    int field_bot_mb_size_x_y_x = 0;
    int field_top_mb_size_xy_y_y = 0;
    int field_bot_mb_size_xy_y_y = 0;
    int field_top_mb_size_x_y_x_y = 0;
    int field_bot_mb_size_x_y_x_y = 0;
    int field_top_mb_size_xy_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x = 0;
    int field_bot_mb_size_x_y_x_y_x = 0;
    int field_top_mb_size_xy_y_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x_y = 0;
    int field_bot_mb_size_x_y_x_y_x_y = 0;
    int field_top_mb_size_xy_y_y_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x_y_x = 0;
    int field_bot_mb_size_x_y_x_y_x_y_x = 0;
    int field_top_mb_size_xy_y_y_y_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x_y_x_y = 0;
    int field_bot_mb_size_x_y_x_y_x_y_x_y = 0;
    int field_top_mb_size_xy_y_y_y_y_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y_y_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x_y_x_y_x = 0;
    int field_bot_mb_size_x_y_x_y_x_y_x_y_x = 0;
    int field_top_mb_size_xy_y_y_y_y_y_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y_y_y_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x_y_x_y_x_y = 0;
    int field_bot_mb_size_x_y_x_y_x_y_x_y_x_y = 0;
    int field_top_mb_size_xy_y_y_y_y_y_y_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y_y_y_y_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x_y_x_y_x_y_x = 0;
    int field_bot_mb_size_x_y_x_y_x_y_x_y_x_y_x = 0;
    int field_top_mb_size_xy_y_y_y_y_y_y_y_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y_y_y_y_y_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x_y_x_y_x_y_x_y = 0;
    int field_bot_mb_size_x_y_x_y_x_y_x_y_x_y_x_y = 0;
    int field_top_mb_size_xy_y_y_y_y_y_y_y_y_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y_y_y_y_y_y_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x_y_x_y_x_y_x_y_x = 0;
    int field_bot_mb_size_x_y_x_y_x_y_x_y_x_y_x_y_x = 0;
    int field_top_mb_size_xy_y_y_y_y_y_y_y_y_y_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y_y_y_y_y_y_y_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x_y_x_y_x_y_x_y_x_y = 0;
    int field_bot_mb_size_x_y_x_y_x_y_x_y_x_y_x_y_x_y = 0;
    int field_top_mb_size_xy_y_y_y_y_y_y_y_y_y_y_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y_y_y_y_y_y_y_y_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x = 0;
    int field_bot_mb_size_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x = 0;
    int field_top_mb_size_xy_y_y_y_y_y_y_y_y_y_y_y_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y_y_y_y_y_y_y_y_y_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x_y = 0;
    int field_bot_mb_size_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x_y = 0;
    int field_top_mb_size_xy_y_y_y_y_y_y_y_y_y_y_y_y_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y_y_y_y_y_y_y_y_y_y_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x = 0;
    int field_bot_mb_size_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x = 0;
    int field_top_mb_size_xy_y_y_y_y_y_y_y_y_y_y_y_y_y_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y_y_y_y_y_y_y_y_y_y_y_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x_y = 0;
    int field_bot_mb_size_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x_y = 0;
    int field_top_mb_size_xy_y_y_y_y_y_y_y_y_y_y_y_y_y_y_y_y_y = 0;
    int field_bot_mb_size_xy_y_y_y_y_y_y_y_y_y_y_y_y_y_y_y_y_y = 0;
    int field_top_mb_size_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x = 0;
    int field_bot_mb_size_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x_y_x = 0;
    int field_top_mb_size_xy_y_y_y_y_y_y_y_y_