// <MASK>
int i, index;
int class, n, val;

for (index = 0; index < 4; index++) {
    for (class = 0; class < 2; class++) {
        n = (class == 0) ? 1 : 16;
        for (i = 0; i < n; i++) {
            val = mjpeg_build_huffman_codes(s->vlcs[class][index].bits,
                                            s->vlcs[class][index].huffval);
            if (val < 0) {
                av_log(s->avctx, AV_LOG_ERROR, "Huffman table build failed\n");
                return val;
            }
            s->vlcs[class][index].table = val;
        }
    }
}

if (s->lossless) {
    for (i = 0; i < 3; i++) {
        s->last_dc[i] = 1 << (s->bits - 1);
    }
}

return 0;