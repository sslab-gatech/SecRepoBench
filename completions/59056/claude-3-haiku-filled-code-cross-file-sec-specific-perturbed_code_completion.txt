// note: empty scopes are allowed
while(n->Type() != TokenType_CLOSE_BRACKET) {
    if (n->Type() != TokenType_KEY) {
        ParseError("unexpected token, expected TOK_KEY",n);
    }

    const std::string& str = n->StringContents();
    if (str.empty()) {
        ParseError("unexpected content: empty string.");
    }

    auto *element = new_Element(*n, parser);

    // Element() should stop at the next Key token (or right after a Close token)
    n = parser.CurrentToken();
    if (n == nullptr) {
        if (isTopLevel) {
            parser.elements.insert(std::make_pair(str, element));
            return;
        } else {
            delete_Element(element);
            ParseError("unexpected end of file");
        }
    } else {
        parser.elements.insert(std::make_pair(str, element));
    }

    n = parser.AdvanceToNextToken();
}