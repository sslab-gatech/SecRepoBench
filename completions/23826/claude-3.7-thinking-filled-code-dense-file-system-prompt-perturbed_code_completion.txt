if (envvar != NULL) {
  /* BLOSC_NOLOCK is set, use a local context without locking */
  dparams.nthreads = blosc_get_nthreads();
  dctx = blosc2_create_dctx(dparams);
  result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
  blosc2_free_ctx(dctx);
} else {
  /* BLOSC_NOLOCK is not set, use global lock for thread safety */
  pthread_mutex_lock(&global_comp_mutex);
  dparams.nthreads = blosc_get_nthreads();
  dctx = blosc2_create_dctx(dparams);
  result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
  blosc2_free_ctx(dctx);
  pthread_mutex_unlock(&global_comp_mutex);
}
return result;