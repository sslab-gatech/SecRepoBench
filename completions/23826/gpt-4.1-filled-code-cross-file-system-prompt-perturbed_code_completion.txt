if (envvar != NULL) {
    // BLOSC_NOLOCK is set: use a private context, no locking
    dctx = blosc2_create_dctx(dparams);
    result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
    blosc2_free_ctx(dctx);
    return result;
}
else {
    // BLOSC_NOLOCK is not set: use global context, lock mutex
    BLOSC_GLOBAL_MUTEX_LOCK;
    result = blosc2_decompress_ctx(g_global_dctx, src, srcsize, outputbuffer, destsize);
    BLOSC_GLOBAL_MUTEX_UNLOCK;
    return result;
}