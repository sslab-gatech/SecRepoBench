envvar = getenv("BLOSC_NOLOCK");
  if (envvar != NULL) {
    /* BLOSC_NOLOCK is set */
    dctx = blosc2_create_dctx(dparams);
    if (dctx == NULL) {
      return -1;
    }
    result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
    blosc2_free_ctx(dctx);
  } else {
    /* BLOSC_NOLOCK is not set */
    /* Lock the mutex */
    pthread_mutex_lock(&global_blosc_mutex);
    /* Call the routine */
    dctx = blosc2_create_dctx(dparams);
    if (dctx == NULL) {
      pthread_mutex_unlock(&global_blosc_mutex);
      return -1;
    }
    result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
    blosc2_free_ctx(dctx);
    /* Unlock the mutex */
    pthread_mutex_unlock(&global_blosc_mutex);
  }

  return result;