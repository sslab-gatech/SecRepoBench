if (envvar != NULL) {
    dctx = blosc2_create_dctx(dparams);
    if (dctx == NULL) {
      return BLOSC2_ERROR_DCTX;  // Return an error if context creation fails
    }
    result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
    blosc2_free_ctx(dctx);  // Free the decompression context
  } else {
    BLOSC_LOCK_MUTEX(global_comp_mutex);
    result = blosc2_decompress_ctx(g_global_dctx, src, srcsize, outputbuffer, destsize);
    BLOSC_UNLOCK_MUTEX(global_comp_mutex);
  }
  return result;