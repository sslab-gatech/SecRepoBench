if (envvar != NULL) {
    blosc2_context *dctx;
    /* Create a decompression context using default parameters and the global
       thread count. */
    dctx = blosc2_create_dctx(dparams);
    dctx->nthreads = g_nthreads;
    /* Decompress the source data into the destination buffer. */
    result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
    /* Release context resources. */
    blosc2_free_ctx(dctx);
    return result;
  }
  else {
    pthread_mutex_lock(&global_comp_mutex);
    /* Create a decompression context using default parameters and the global
       thread count. */
    dctx = blosc2_create_dctx(dparams);
    dctx->nthreads = g_nthreads;
    /* Decompress the source data into the destination buffer. */
    result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
    /* Release context resources. */
    blosc2_free_ctx(dctx);
    pthread_mutex_unlock(&global_comp_mutex);
    return result;
  }