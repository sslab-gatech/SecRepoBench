if (envvar != NULL) {
    dparams.nthreads = (uint8_t)g_nthreads;
    dctx = blosc2_create_dctx(dparams);
    /* Do the actual decompression */
    result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
    /* Release context resources */
    blosc2_free_ctx(dctx);
    return result;
  }

  pthread_mutex_lock(&global_comp_mutex);

  blosc2_context *context = g_global_context;
  if (context->serial_context == NULL) {
    context->serial_context = create_thread_context(context, 0);
  }

  result = blosc_run_decompression_with_context(context, src, srcsize, outputbuffer, destsize);

  pthread_mutex_unlock(&global_comp_mutex);

  return result;