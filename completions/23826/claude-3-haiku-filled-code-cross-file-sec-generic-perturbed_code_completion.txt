if (envvar != NULL && strcmp(envvar, "TRUE") == 0) {
    dctx = blosc2_create_dctx(dparams);
    result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
    blosc2_free_ctx(dctx);
    return result;
} else {
    blosc_acquire_global_lock();
    dctx = blosc2_create_dctx(dparams);
    result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
    blosc2_free_ctx(dctx);
    blosc_release_global_lock();
    return result;
}