if (envvar != NULL) {
    // BLOSC_NOLOCK is set
    dparams.nthreads = blosc_get_nthreads();
    dctx = blosc2_create_dctx(dparams);
    if (dctx == NULL) {
        return -1;  // Error handling
    }
    result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
    blosc2_free_dctx(dctx);
    return result;
} else {
    // BLOSC_NOLOCK is not set
    pthread_mutex_lock(&global_comp_mutex);
    result = blosc2_decompress_internal(src, srcsize, outputbuffer, destsize);
    pthread_mutex_unlock(&global_comp_mutex);
    return result;
}