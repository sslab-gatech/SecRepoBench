// Check if the BLOSC_NOLOCK environment variable is set. If it is set,
// create a decompression context using default parameters and the global
// thread count. Use this context to decompress the source data into the
// destination buffer and free the context afterward. Return the result of
// the decompression operation. If the environment variable is not set,
// lock a global mutex to ensure thread safety, run the decompression with
// a global context, and unlock the mutex afterward. Return the result of
// the decompression operation.
if (envvar!= NULL) {
  dparams.nthreads = 1;
  dctx = blosc2_create_dctx(dparams);
  result = blosc2_decompress_ctx(dctx, (void*)src, srcsize, outputbuffer, destsize);
  blosc2_free_dctx(dctx);
}
else {
  // Lock a global mutex to ensure thread safety
  pthread_mutex_lock(&g_mutex);
  dctx = blosc2_create_dctx(BLOSC2_DPARAMS_DEFAULTS);
  result = blosc2_decompress_ctx(dctx, (void*)src, srcsize, outputbuffer, destsize);
  blosc2_free_dctx(dctx);
  // Unlock the global mutex
  pthread_mutex_unlock(&g_mutex);
}
return result;