envvar = getenv("BLOSC_NOLOCK");
if (envvar != NULL) {
  dctx = blosc2_create_dctx(dparams);
  result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
  blosc2_free_dctx(dctx);
  return result;
} else {
  blosc2_get_nthreads(&nthreads);
  mutex_lock(&blosc_mutex);
  dctx = blosc2_create_dctx(dparams);
  result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
  blosc2_free_dctx(dctx);
  mutex_unlock(&blosc_mutex);
  return result;
}