import blosc2

# Define the compressor and decompression functions
def compress(src, clevel, doshuffle, typesize, nbytes, compcode):
    dest = bytearray(nbytes)
    cbytes = blosc2.compress(clevel, doshuffle, typesize, src, dest)
    return dest[:cbytes]

def decompress(cbuffer, cbytes, nbytes):
    dest = bytearray(nbytes)
    dbytes = blosc2.decompress(cbuffer, cbytes, dest)
    return dest[:dbytes]

# Define the compressor and decompression contexts
def create_compressor_context(clevel, doshuffle, typesize, compcode):
    cparams = blosc2.Blosc2Cparams(clevel=clevel, doshuffle=doshuffle, typesize=typesize, compcode=compcode)
    return blosc2.Blosc2Context(cparams=cparams)

def create_decompressor_context():
    return blosc2.Blosc2Context()

# Define the compressor and decompression functions using contexts
def compress_context(ctx, src, clevel, doshuffle, typesize, nbytes, compcode):
    dest = bytearray(nbytes)
    cbytes = ctx.compress(clevel, doshuffle, typesize, src, dest)
    return dest[:cbytes]

def decompress_context(ctx, cbuffer, cbytes, nbytes):
    dest = bytearray(nbytes)
    dbytes = ctx.decompress(cbuffer, cbytes, dest)
    return dest[:dbytes]