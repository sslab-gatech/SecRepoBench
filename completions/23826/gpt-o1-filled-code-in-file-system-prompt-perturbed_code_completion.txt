if (envvar != NULL) {
  /* Create a decompression context using global threads, decompress, and free context */
  blosc2_dparams dparams = BLOSC2_DPARAMS_DEFAULTS;
  dparams.nthreads = g_nthreads;
  blosc2_context *dctx = blosc2_create_dctx(dparams);
  result = blosc2_decompress_ctx(dctx, src, srcsize, outputbuffer, destsize);
  blosc2_free_ctx(dctx);
} else {
  pthread_mutex_lock(&global_comp_mutex);
  result = blosc_run_decompression_with_context(g_global_context, src, srcsize, outputbuffer, destsize);
  pthread_mutex_unlock(&global_comp_mutex);
}
return result;