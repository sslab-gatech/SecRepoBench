buf = in->cur;
    len = in->end - buf;

    while (len > 0) {
        if (incomment) {
            if (buf[0] == '-' && buf[1] == '-' && buf[2] == '>') {
                incomment = 0;
                buf += 3;
                len -= 3;
                continue;
            }
            buf++;
            len--;
            continue;
        }

        if (ignoreAttrValue && invalue) {
            if (buf[0] == '"' || buf[0] == '\'') {
                invalue = 1;
                buf++;
                len--;
                continue;
            }
        }

        if (buf[0] == first) {
            if (len > 1 && buf[1] == next) {
                if (third == 0 || (len > 2 && buf[2] == third)) {
                    ctxt->checkIndex = buf - in->base;
                    return ctxt->checkIndex;
                }
            }
        }

        buf++;
        len--;
    }