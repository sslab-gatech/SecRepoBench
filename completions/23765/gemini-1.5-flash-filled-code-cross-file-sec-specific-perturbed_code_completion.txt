buf = in->base + base;
    len = in->cur - buf;
    if (next != 0) {
        len--;
        if (third != 0)
            len--;
    }
    if (len <= 0)
        return (-1);
    incomment = (ctxt->instate == XML_PARSER_COMMENT);
    invalue = (ctxt->instate == XML_PARSER_ATTRIBUTE_VALUE);
    if (ignoreAttrValue && invalue) {
        while (len > 0) {
            if (*buf == valdellim) {
                valdellim = 0x0;
                invalue = 0;
            } else if ((*buf == '"') || (*buf == '\'')) {
                valdellim = *buf;
                invalue = 1;
            }
            buf++;
            len--;
        }
        ctxt->checkIndex = in->cur - in->base;
        return (-1);
    }
    while (len > 0) {
        if (incomment) {
            if (*buf == '-') {
                if (len > 1 && buf[1] == '-') {
                    if (len > 2 && buf[2] == '>') {
                        incomment = 0;
                        buf += 3;
                        len -= 3;
                        ctxt->instate = XML_PARSER_MISC;
                        ctxt->checkIndex = in->cur - in->base;
                        return (in->cur - in->base);
                    }
                }
            }
        } else if (*buf == first) {
            if (next == 0) {
                ctxt->checkIndex = in->cur - in->base;
                return (in->cur - in->base);
            } else if (len > 1 && buf[1] == next) {
                if (third == 0) {
                    ctxt->checkIndex = in->cur - in->base;
                    return (in->cur - in->base);
                } else if (len > 2 && buf[2] == third) {
                    ctxt->checkIndex = in->cur - in->base;
                    return (in->cur - in->base);
                }
            }
        }
        buf++;
        len--;
    }
    ctxt->checkIndex = in->cur - in->base;