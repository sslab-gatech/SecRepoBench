int seqlen = 1;
    if (next != 0) seqlen++;
    if (third != 0) seqlen++;

    buf = in->base + base;
    len = in->length - base;
    if (len < seqlen) {
        ctxt->checkIndex = in->cur - in->base;
        return (-1);
    }

    for (int i = 0; i <= len - seqlen; i++) {
        xmlChar c = buf[i];

        /* Handle comments if requested */
        if (iscomment) {
            if (!incomment) {
                /* Check for start of comment: <!-- */
                if (i + 3 < len &&
                    c == '<' &&
                    buf[i + 1] == '!' &&
                    buf[i + 2] == '-' &&
                    buf[i + 3] == '-') {
                    incomment = 1;
                    i += 3; /* jump over <!-- */
                    continue;
                }
            } else {
                /* We are inside a comment, look for end: --> */
                if (i + 2 < len &&
                    c == '-' &&
                    buf[i + 1] == '-' &&
                    buf[i + 2] == '>') {
                    incomment = 0;
                    i += 2; /* jump over --> */
                    continue;
                } else {
                    /* Still in comment, skip content */
                    continue;
                }
            }
        }

        /* Handle ignoring attribute values if requested */
        if (ignoreAttrValue) {
            if (invalue) {
                if (c == valdellim) {
                    invalue = 0;
                }
                continue;
            } else {
                if ((c == '\'') || (c == '"')) {
                    invalue = 1;
                    valdellim = (char) c;
                    continue;
                }
            }
        }

        /* Check for the sequence */
        if (c == first) {
            if (next == 0) {
                ctxt->checkIndex = base + i;
                return (base + i);
            } else if ((i + 1 < len) && (buf[i + 1] == next)) {
                if (third == 0) {
                    ctxt->checkIndex = base + i;
                    return (base + i);
                } else if ((i + 2 < len) && (buf[i + 2] == third)) {
                    ctxt->checkIndex = base + i;
                    return (base + i);
                }
            }
        }
    }

    /* Sequence not found */
    ctxt->checkIndex = in->cur - in->base;
    return (-1);