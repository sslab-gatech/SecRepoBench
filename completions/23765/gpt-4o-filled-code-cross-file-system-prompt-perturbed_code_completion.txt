len = in->length;
    buf = in->base;

    if (len <= 0 || buf == NULL)
        return (-1);

    len -= base;
    if (len <= 0)
        return (-1);

    for (int i = 0; i < len; i++) {
        xmlChar cur = buf[base + i];

        if (iscomment) {
            if (incomment) {
                if ((cur == '-') && (buf[base + i + 1] == '-') && (buf[base + i + 2] == '>')) {
                    incomment = 0;
                    i += 2;
                }
                continue;
            } else if ((cur == '<') && (buf[base + i + 1] == '!') && (buf[base + i + 2] == '-') && (buf[base + i + 3] == '-')) {
                incomment = 1;
                i += 3;
                continue;
            }
        }

        if (ignoreAttrValue) {
            if (invalue) {
                if (cur == valdellim) {
                    invalue = 0;
                }
                continue;
            } else if ((cur == '\'') || (cur == '"')) {
                invalue = 1;
                valdellim = cur;
                continue;
            }
        }

        if (cur == first) {
            if ((next == 0) || ((i + 1 < len) && (buf[base + i + 1] == next))) {
                if ((third == 0) || ((i + 2 < len) && (buf[base + i + 2] == third))) {
                    ctxt->checkIndex = base + i;
                    return (i);
                }
            }
        }
    }

    ctxt->checkIndex = base + len;