buf = in->base;
    len = in->length;
    if (len < 0)
        return (-1);
    len = len - base;
    if (len < 0)
        return (-1);
    if (len > 100000)
        len = 100000;
    
    for (base = base; base < base + len; base++) {
        if (incomment) {
            if (buf[base] == '>' && buf[base-1] == '-' && buf[base-2] == '-') {
                incomment = 0;
                continue;
            }
        } else if (invalue) {
            if (buf[base] == valdellim) {
                invalue = 0;
                valdellim = 0x0;
                continue;
            }
        } else if (buf[base] == '<' && buf[base+1] == '!' && buf[base+2] == '-') {
            incomment = 1;
            continue;
        } else if (buf[base] == '<' && buf[base+1] == '/') {
            continue;
        } else if (buf[base] == '"' || buf[base] == '\'') {
            invalue = 1;
            valdellim = buf[base];
            continue;
        }
        
        if (buf[base] == first) {
            if (next == 0) {
                ctxt->checkIndex = base + 1;
                return base;
            }
            if (buf[base+1] == next) {
                if (third == 0) {
                    ctxt->checkIndex = base + 2;
                    return base;
                }
                if (buf[base+2] == third) {
                    ctxt->checkIndex = base + 3;
                    return base;
                }
            }
        }
    }
    ctxt->checkIndex = base;