len = in->length;
    buf = in->base;

    if (len <= 0 || buf == NULL)
        return (-1);

    len -= 2; // Adjust length to account for the search sequence

    for (int i = base; i < len; i++) {
        if (iscomment) {
            if (incomment) {
                if ((buf[i] == '-') && (buf[i + 1] == '-') && (buf[i + 2] == '>')) {
                    incomment = 0;
                    i += 2;
                }
                continue;
            } else if ((buf[i] == '<') && (buf[i + 1] == '!') && (buf[i + 2] == '-') && (buf[i + 3] == '-')) {
                incomment = 1;
                i += 3;
                continue;
            }
        }

        if (ignoreAttrValue) {
            if (invalue) {
                if (buf[i] == valdellim) {
                    invalue = 0;
                }
                continue;
            } else if ((buf[i] == '\'') || (buf[i] == '"')) {
                invalue = 1;
                valdellim = buf[i];
                continue;
            }
        }

        if (buf[i] == first) {
            if ((next == 0) || ((buf[i + 1] == next) && ((third == 0) || (buf[i + 2] == third)))) {
                ctxt->checkIndex = i + ((third != 0) ? 3 : (next != 0) ? 2 : 1);
                return (i);
            }
        }
    }