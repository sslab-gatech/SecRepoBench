buf = in->cur;
    len = in->length - base;
    if (len <= 0)
        return (-1);
    if (third)
        len -= 2;
    else if (next)
        len -= 1;
    for (; len > 0; len--, buf++) {
        if (!incomment) {
            if (!invalue) {
                if (ignoreAttrValue) {
                    if (*buf == '<') {
                        if ((len > 1) && (buf[1] == '!')) {
                            if ((len > 3) && (buf[2] == '-') &&
                                (buf[3] == '-'))
                                incomment = 1;
                        }
                    }
                }
                if (*buf == '\'') {
                    invalue = 1;
                    valdellim = *buf;
                } else if (*buf == '"') {
                    invalue = 1;
                    valdellim = *buf;
                }
            } else {
                if (*buf == valdellim)
                    invalue = 0;
            }
        } else {
            if ((*buf == '-') && (len > 1) && (buf[1] == '-')) {
                if ((len > 2) && (buf[2] == '>')) {
                    buf += 2;
                    len -= 2;
                    incomment = 0;
                }
            }
        }
        if (ignoreAttrValue && invalue)
            continue;

        if (*buf == first) {
            if (next == 0)
                return (buf - in->cur + base);
            if ((len > 1) && (buf[1] == next)) {
                if (third == 0)
                    return (buf - in->cur + base);
                if ((len > 2) && (buf[2] == third))
                    return (buf - in->cur + base);
            }
        }
        ctxt->checkIndex++;
    }