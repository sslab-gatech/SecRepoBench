buf = in->cur;
    len = in->length - base;
    if (len <= 0)
        return (-1);
    if (third)
        len -= 2;
    else if (next)
        len -= 1;
    for (; len > 0; len--, buf++) {
        if (!incomment) {
            if (!invalue) {
                if (ignoreAttrValue) {
                    if (*buf == '<') {
                        const xmlChar *end;

                        end = htmlSkipTag(buf, in->end);
                        if (end != NULL) {
                            len -= end - buf - 1;
                            buf = end - 1;
                            continue;
                        }
                    }
                }
                if (IS_HTML_COMMENT(*buf)) {
                    incomment = 1;
                    /* we can have <!--> */
                    if ((len > 2) && (buf[1] == '-') && (buf[2] == '>')) {
                        incomment = 0;
                        buf += 2;
                        len -= 2;
                        continue;
                    }
                }
            }
        } else {
            if (IS_HTML_COMMENT_END(*buf)) {
                if ((len > 2) && (buf[1] == '-') && (buf[2] == '>')) {
                    incomment = 0;
                    buf += 2;
                    len -= 2;
                    continue;
                }
            }
        }
        if (*buf == first) {
            if (third != 0) {
                if ((len > 1) && (buf[1] == next) && (buf[2] == third))
                    return (buf - in->base);
            } else if (next != 0) {
                if ((len > 0) && (buf[1] == next))
                    return (buf - in->base);
            } else {
                return (buf - in->base);
            }
        }
    }
    ctxt->checkIndex = 0;