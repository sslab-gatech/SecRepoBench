static int
htmlParseLookupSequence(htmlParserCtxtPtr ctxt, xmlChar first,
                        xmlChar next, xmlChar third, int iscomment,
                        int ignoreAttrValue)
{
    int base, len;
    htmlParserInputPtr in;
    const xmlChar *buf;
    int incomment = 0;
    int invalue = 0;
    char valdellim = 0x0;

    in = ctxt->input;
    if (in == NULL)
        return (-1);

    base = in->cur - in->base;
    if (base < 0)
        return (-1);

    if (ctxt->checkIndex > base)
        base = ctxt->checkIndex;

    if (in->buf == NULL) {
        buf = in->base;
        len = in->length;
    } else {
        buf = xmlBufContent(in->buf->buffer);
        len = xmlBufUse(in->buf->buffer);
    }

    for (; base < len; base++) {
        if (!incomment && (base + 4 < len)) {
            if ((buf[base] == '<') && (buf[base + 1] == '!') &&
                (buf[base + 2] == '-') && (buf[base + 3] == '-')) {
                incomment = 1;
                /* do not increment past <! - some people use <!--> */
                base += 2;
            }
        }
        if (incomment) {
            if (base + 3 > len)
                return (-1);
            if ((buf[base] == '-') && (buf[base + 1] == '-') &&
                (buf[base + 2] == '>')) {
                incomment = 0;
                base += 2;
            }
            if (!iscomment)
                continue;
        }
        if (ignoreAttrValue) {
            if (!invalue && ((buf[base] == '\"') || (buf[base] == '\''))) {
                invalue = 1;
                valdellim = buf[base];
                continue;
            }
            if (invalue && (buf[base] == valdellim)) {
                invalue = 0;
                valdellim = 0;
                continue;
            }
            if (invalue)
                continue;
        }
        if (buf[base] == first) {
            if (next == 0)
                return (base - (in->cur - in->base));
            if (base + 1 < len) {
                if (buf[base + 1] == next) {
                    if (third == 0)
                        return (base - (in->cur - in->base));
                    if (base + 2 < len) {
                        if (buf[base + 2] == third)
                            return (base - (in->cur - in->base));
                    } else
                        return (-1);
                }
            } else
                return (-1);
        }
    }
    ctxt->checkIndex = base;
    
#ifdef DEBUG_PUSH
    if (next == 0)
        xmlGenericError(xmlGenericErrorContext,
                        "HPP: lookup '%c' failed\n", first);
    else if (third == 0)
        xmlGenericError(xmlGenericErrorContext,
                        "HPP: lookup '%c%c' failed\n", first, next);
    else
        xmlGenericError(xmlGenericErrorContext,
                        "HPP: lookup '%c%c%c' failed\n", first, next,
                        third);
#endif
    return (-1);
}