len = in->length - base;
    if (len <= 0)
        return (-1);

    buf = in->base + base;
    for (int i = 0; i < len; i++) {
        if (iscomment) {
            if (incomment) {
                if ((buf[i] == '-') && (i + 2 < len) && (buf[i + 1] == '-') && (buf[i + 2] == '>')) {
                    incomment = 0;
                    i += 2;
                }
                continue;
            } else if ((buf[i] == '<') && (i + 3 < len) && (buf[i + 1] == '!') && (buf[i + 2] == '-') && (buf[i + 3] == '-')) {
                incomment = 1;
                i += 3;
                continue;
            }
        }

        if (ignoreAttrValue) {
            if (invalue) {
                if (buf[i] == valdellim) {
                    invalue = 0;
                }
                continue;
            } else if ((buf[i] == '\'') || (buf[i] == '"')) {
                invalue = 1;
                valdellim = buf[i];
                continue;
            }
        }

        if (buf[i] == first) {
            if ((next == 0) || ((i + 1 < len) && (buf[i + 1] == next) && ((third == 0) || ((i + 2 < len) && (buf[i + 2] == third))))) {
                ctxt->checkIndex = i + base;
                return (i + base);
            }
        }
    }
    ctxt->checkIndex = len + base;