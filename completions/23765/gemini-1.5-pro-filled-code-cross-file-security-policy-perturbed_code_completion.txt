buf = in->cur;
    len = in->length - base;
    if (len <= 0)
        return (-1);
    if (third)
        len -= 2;
    else if (next)
        len -= 1;
    for (; len > 0; len--, buf++) {
        if (incomment) {
            if ((*buf == '-') && (buf[1] == '-')) {
                if (buf[2] == '>') {
                    incomment = 0;
                    buf += 2;
                    len -= 2;
                    continue;
                }
            }
        } else if (ignoreAttrValue) {
            if (invalue) {
                if (*buf == valdellim) {
                    invalue = 0;
                    continue;
                }
            } else {
                if (*buf == '\'') {
                    invalue = 1;
                    valdellim = '\'';
                    continue;
                } else if (*buf == '"') {
                    invalue = 1;
                    valdellim = '"';
                    continue;
                }
            }
            if (*buf == '<') {
                if ((buf[1] == '!') && (buf[2] == '-') &&
                    (buf[3] == '-')) {
                    incomment = 1;
                    buf += 3;
                    len -= 3;
                    continue;
                }
            }
        }
        if (*buf == first) {
            if (next == 0)
                return (buf - in->base);
            if ((len > 1) && (buf[1] == next)) {
                if (third == 0)
                    return (buf - in->base);
                if ((len > 2) && (buf[2] == third))
                    return (buf - in->base);
            }
        }
    }
    ctxt->checkIndex = 0;