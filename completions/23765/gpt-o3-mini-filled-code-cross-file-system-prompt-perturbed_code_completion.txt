{
    const xmlChar *cur;
    int pos = 0, avail;

    if (in->buf)
        avail = (int)(xmlBufUse(in->buf->buffer) - (in->cur - in->base));
    else
        avail = in->length - (in->cur - in->base);

    cur = in->cur;
    while (pos < avail) {
        /* If ignoring attribute values, skip over quoted strings */
        if (ignoreAttrValue && (cur[pos] == '"' || cur[pos] == '\'')) {
            char delim = cur[pos++];
            while (pos < avail && cur[pos] != delim)
                pos++;
            if (pos < avail)
                pos++; /* skip closing delimiter */
            continue;
        }
        if (cur[pos] == first) {
            if (next) {
                if ((pos + 1) >= avail || cur[pos + 1] != next) {
                    pos++;
                    continue;
                }
            }
            if (third) {
                if ((pos + 2) >= avail || cur[pos + 2] != third) {
                    pos++;
                    continue;
                }
            }
            ctxt->checkIndex = pos;
            return pos;
        }
        pos++;
    }
    ctxt->checkIndex = pos;
    return -1;
}