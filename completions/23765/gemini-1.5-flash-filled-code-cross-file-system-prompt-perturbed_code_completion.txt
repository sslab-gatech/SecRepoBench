buf = in->cur;
    len = in->end - buf;
    if (next == 0)
        len = 1;
    else if (third == 0)
        len = 2;
    else
        len = 3;
    if (len > in->end - in->cur)
        len = in->end - in->cur;
    if (len <= 0)
        return (-1);
    while (len > 0) {
        if (iscomment && (buf[0] == '<')) {
            incomment = 1;
            if ((len >= 4) && (buf[1] == '!') && (buf[2] == '-') &&
                (buf[3] == '-')) {
                int val;
                val = htmlParseLookupSequence(ctxt, '-', '-', '>', 1,
                                              ignoreAttrValue);
                if (val < 0)
                    break;
                buf += val;
                len -= val;
                incomment = 0;
            }
        } else if (ignoreAttrValue && (buf[0] == '"') && !incomment) {
            invalue = 1;
            valdellim = '"';
        } else if (ignoreAttrValue && (buf[0] == '\'') && !incomment) {
            invalue = 1;
            valdellim = '\'';
        } else if (invalue && (buf[0] == valdellim) && !incomment) {
            invalue = 0;
            valdellim = 0x0;
        } else if (buf[0] == first) {
            if (next == 0)
                return (base + (buf - in->base));
            else if ((len >= 2) && (buf[1] == next)) {
                if (third == 0)
                    return (base + (buf - in->base));
                else if ((len >= 3) && (buf[2] == third))
                    return (base + (buf - in->base));
                else
                    break;
            } else
                break;
        }
        buf++;
        len--;
    }
    ctxt->checkIndex = in->cur - in->base;