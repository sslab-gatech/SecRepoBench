buf = in->base + base;
    len = in->cur - buf;
    if (len < 0)
        return (-1);
    if (iscomment) {
        incomment = 1;
        invalue = 0;
    } else {
        incomment = 0;
    }
    if (ignoreAttrValue) {
        invalue = 0;
        valdellim = 0x0;
    } else {
        invalue = 0;
    }
    while (len > 0) {
        if (incomment) {
            if (buf[0] == '-') {
                if (len > 1 && buf[1] == '-') {
                    if (len > 2 && buf[2] == '>') {
                        incomment = 0;
                        base += 3;
                        len -= 3;
                        buf += 3;
                        continue;
                    }
                }
            }
        } else if (invalue) {
            if (buf[0] == valdellim) {
                invalue = 0;
            }
        } else if (buf[0] == '<') {
            if (len > 1 && buf[1] == '!') {
                if (len > 2 && buf[2] == '-') {
                    if (len > 3 && buf[3] == '-') {
                        incomment = 1;
                    }
                }
            } else if (len > 1 && buf[1] == '/') {
                /*
                 * this is an end tag, we don't want to parse it
                 */
                break;
            } else if (len > 1 && xmlIsNameStartChar(ctxt, buf[1])) {
                /*
                 * this is a start tag, we don't want to parse it
                 */
                break;
            }
        } else if (buf[0] == '"') {
            valdellim = '"';
            invalue = 1;
        } else if (buf[0] == '\'') {
            valdellim = '\'';
            invalue = 1;
        } else if (buf[0] == first) {
            if (next == 0)
                return (base);
            if (len > 1 && buf[1] == next) {
                if (third == 0)
                    return (base);
                if (len > 2 && buf[2] == third)
                    return (base);
            }
        }
        base++;
        len--;
        buf++;
    }
    ctxt->checkIndex = base;