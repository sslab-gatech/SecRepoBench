{
    unsigned long remaining;
    const xmlChar *cur;

    if (in->buf != NULL) {
        remaining = xmlBufUse(in->buf->buffer) - (in->cur - in->base);
    } else {
        remaining = in->length - (in->cur - in->base);
    }
    cur = in->cur;

    while (remaining > 0) {
        /* If ignoring attribute values, skip over quoted text */
        if (ignoreAttrValue && (*cur == '"' || *cur == '\'')) {
            valdellim = *cur;
            cur++;
            remaining--;
            while (remaining > 0 && *cur != valdellim) {
                cur++;
                remaining--;
            }
            if (remaining > 0) {
                cur++; /* Skip closing delimiter */
                remaining--;
            }
            continue;
        }
        /* If processing comments, detect the start and end of comment blocks */
        if (iscomment) {
            if (!incomment && remaining >= 4 &&
                cur[0] == '<' && cur[1] == '!' && cur[2] == '-' && cur[3] == '-') {
                incomment = 1;
                cur += 4;
                remaining -= 4;
                continue;
            }
            if (incomment) {
                if (remaining >= 3 &&
                    cur[0] == '-' && cur[1] == '-' && cur[2] == '>') {
                    incomment = 0;
                    cur += 3;
                    remaining -= 3;
                    continue;
                }
                cur++;
                remaining--;
                continue;
            }
        }
        /* Check if the current character matches the first character of the search sequence */
        if (*cur == first) {
            if (next == 0) {
                ctxt->checkIndex = (int)(cur - in->base);
                in->cur = cur;
                return ctxt->checkIndex;
            }
            if (remaining >= 2 && cur[1] == next) {
                if (third != 0) {
                    if (remaining >= 3 && cur[2] == third) {
                        ctxt->checkIndex = (int)(cur - in->base);
                        in->cur = cur;
                        return ctxt->checkIndex;
                    }
                } else {
                    ctxt->checkIndex = (int)(cur - in->base);
                    in->cur = cur;
                    return ctxt->checkIndex;
                }
            }
        }
        cur++;
        remaining--;
    }
    ctxt->checkIndex = (int)(cur - in->base);
    in->cur = cur;
}