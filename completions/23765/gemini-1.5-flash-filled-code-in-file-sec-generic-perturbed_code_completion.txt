buf = in->base + base;
    len = in->length - base;
    if (len < 1) return (-1);

    if (ctxt->checkIndex > base)
        base = ctxt->checkIndex;

    if (iscomment) {
        while (base < len) {
            if ((buf[base] == '-') && (buf[base + 1] == '-') &&
                (buf[base + 2] == '>')) {
                base += 3;
                break;
            }
            base++;
        }
    } else {
        while (base < len) {
            if (buf[base] == '<') {
                invalue = 1;
                valdellim = '>';
                base++;
                break;
            } else if (buf[base] == '"') {
                invalue = 1;
                valdellim = '"';
                base++;
                break;
            } else if (buf[base] == '\'') {
                invalue = 1;
                valdellim = '\'';
                base++;
                break;
            } else if (buf[base] == '&') {
                invalue = 1;
                valdellim = ';';
                base++;
                break;
            }
            base++;
        }
        if (invalue) {
            while (base < len) {
                if (buf[base] == valdellim) {
                    base++;
                    break;
                }
                base++;
            }
        }
    }

    if (ignoreAttrValue && invalue) {
        while (base < len) {
            if (buf[base] == '>') {
                base++;
                break;
            }
            base++;
        }
    }

    if (base >= len) {
        ctxt->checkIndex = base;
        return (-1);
    }

    if (buf[base] == first) {
        if (next == 0) {
            ctxt->checkIndex = base + 1;
            return (base - (in->cur - in->base));
        } else if (third == 0) {
            if (base + 1 < len && buf[base + 1] == next) {
                ctxt->checkIndex = base + 2;
                return (base - (in->cur - in->base));
            }
        } else if (base + 2 < len && buf[base + 1] == next &&
                   buf[base + 2] == third) {
            ctxt->checkIndex = base + 3;
            return (base - (in->cur - in->base));
        }
    }