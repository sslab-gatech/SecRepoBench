if ((ctxt->input->cur - ctxt->input->base < 4) && (ctxt->input->end - ctxt->input->cur < 4)) {
    if (ctxt->input->buf!= NULL) {
        xmlParserInputBufferPtr in = ctxt->input->buf;
        if ((in->encoder!= NULL) && (in->buffer!= NULL) &&
            (in->raw!= NULL)) {
            int nbchars;
            size_t base = xmlBufGetInputBase(in->buffer, ctxt->input);
            size_t current = ctxt->input->cur - ctxt->input->base;

            nbchars = xmlCharEncInput(in, 0);
            xmlBufSetInputBaseCur(in->buffer, ctxt->input, base, current);
            if (nbchars < 0) {
                htmlParseErr(ctxt, XML_ERR_INVALID_ENCODING,
                             "encoder error\n", NULL, NULL);
            }
        }
    }
}