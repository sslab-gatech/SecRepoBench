mrb_int base = 10;
  mrb_int num = mrb_integer(self);
  mrb_get_args(mrb, "|i", &base);

  if (base < 2 || base > 36) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "invalid base");
  }

  char buf[66]; // Sufficient for 64-bit binary + sign + null
  int i = 0;
  int negative = 0;

  if (num == 0) {
    return mrb_str_new_cstr(mrb, "0");
  }

  if (num < 0) {
    negative = 1;
    num = -num;
  }

  while (num > 0) {
    mrb_int rem = num % base;
    buf[i++] = (rem < 10) ? (rem + '0') : (rem - 10 + 'a');
    num /= base;
  }

  if (negative) {
    buf[i++] = '-';
  }

  // Reverse the string
  for (int j = 0; j < i / 2; j++) {
    char tmp = buf[j];
    buf[j] = buf[i - j - 1];
    buf[i - j - 1] = tmp;
  }

  buf[i] = '\0';
  return mrb_str_new_cstr(mrb, buf);