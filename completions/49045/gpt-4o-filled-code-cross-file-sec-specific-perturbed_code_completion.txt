mrb_int base = 10;
  mrb_int num = mrb_integer(obj);
  char buf[65]; // Enough to hold binary representation of a 64-bit integer plus null terminator
  char *p = buf + sizeof(buf) - 1;
  static const char digits[] = "0123456789abcdefghijklmnopqrstuvwxyz";

  mrb_get_args(mrb, "|i", &base);
  if (base < 2 || base > 36) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "base must be between 2 and 36");
  }

  *p = '\0';
  if (num == 0) {
    *--p = '0';
  }
  else {
    mrb_bool negative = FALSE;
    if (num < 0) {
      negative = TRUE;
      num = -num;
    }
    while (num > 0) {
      *--p = digits[num % base];
      num /= base;
    }
    if (negative) {
      *--p = '-';
    }
  }

  return mrb_str_new_cstr(mrb, p);