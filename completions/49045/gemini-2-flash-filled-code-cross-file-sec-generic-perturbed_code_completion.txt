mrb_int base = 10;
  mrb_int i;
  char buf[sizeof(mrb_int) * 3 + 1];
  mrb_value arg;

  mrb_get_args(mrb, "|o", &arg);
  if (mrb_undef_p(arg)) {
    base = 10;
  } else {
    mrb_value tmp = mrb_to_int(mrb, arg);
    base = mrb_integer(tmp);
    if (base < 2 || base > 36) {
      mrb_raise(mrb, E_ARGUMENT_ERROR, "invalid radix");
    }
  }

  i = mrb_snprintf(buf, sizeof(buf), "%lli", (long long)mrb_integer(obj));
  if (i < 0 || i >= (int)sizeof(buf)) {
    /* Handle the case where snprintf fails or the buffer is too small.
       Returning a duplicate of the string representation is safer than
       potentially returning a truncated or corrupted string. */
    return mrb_str_dup(mrb, mrb_str_new_cstr(mrb, "")); /* Empty string as fallback */
  }

  return mrb_str_new_cstr(mrb, buf);