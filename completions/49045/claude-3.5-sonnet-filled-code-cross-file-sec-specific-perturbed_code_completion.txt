mrb_int base = 10;
mrb_int val;
char *buf;
size_t len;
mrb_value str;

mrb_get_args(mrb, "|i", &base);
if (base < 2 || base > 36) {
  mrb_raisef(mrb, E_ARGUMENT_ERROR, "invalid radix %S", mrb_fixnum_value(base));
}

val = mrb_integer(obj);
len = sizeof(mrb_int) * CHAR_BIT + 2;
buf = (char*)mrb_malloc(mrb, len);
if (!buf) {
  mrb_raise(mrb, E_RUNTIME_ERROR, "out of memory");
}

snprintf(buf, len, "%" MRB_PRId, val);
str = mrb_str_new_cstr(mrb, buf);
mrb_free(mrb, buf);

return str;