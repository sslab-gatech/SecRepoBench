mrb_value
int_to_s(mrb_state *state, mrb_value self)
{
  mrb_int i;
  mrb_int base = 10;
  char buf[64];
  int len;

  mrb_get_args(state, "i|i", &i, &base);

  if (base < 2 || base > 36) {
    mrb_raisef(state, E_ARGUMENT_ERROR, "invalid radix %S", mrb_fixnum_value(base));
  }

  len = snprintf(buf, sizeof(buf), "%.*" PRId64, (int)sizeof(buf) - 1, (int64_t)i);
  if (len < 0 || len >= sizeof(buf)) {
    mrb_raise(state, E_RUNTIME_ERROR, "integer to string conversion failed");
  }

  return mrb_str_new(state, buf, len);
}