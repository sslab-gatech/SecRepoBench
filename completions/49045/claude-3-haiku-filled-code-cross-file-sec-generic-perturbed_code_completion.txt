mrb_value
int_to_s(mrb_state *mrb, mrb_value obj)
{
  mrb_int base = 10;
  mrb_int value = mrb_fixnum(obj);
  char buf[64];
  int len;

  mrb_get_args(mrb, "|i", &base);

  if (base < 2 || base > 36) {
    mrb_raisef(mrb, E_ARGUMENT_ERROR, "invalid radix %S", mrb_fixnum_value(base));
  }

  len = snprintf(buf, sizeof(buf), "%.*" PRId64, (int)sizeof(buf) - 1, (int64_t)value);
  if (len < 0 || len >= sizeof(buf)) {
    mrb_raise(mrb, E_RUNTIME_ERROR, "integer to string conversion failed");
  }

  return mrb_str_new(mrb, buf, len);
}