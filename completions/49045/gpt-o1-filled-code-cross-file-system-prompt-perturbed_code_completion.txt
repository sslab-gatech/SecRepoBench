mrb_int base = 10;
  mrb_int n, r;
  mrb_bool neg;
  char buf[64];
  char *b = buf + sizeof(buf);
  size_t len;

  /* parse optional base argument (default is 10) */
  mrb_get_args(mrb, "|i", &base);
  if (base < 2 || base > 36) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "base out of range");
  }

  n = mrb_integer(obj);
  neg = (n < 0);
  if (neg) {
    n = -n;
  }

  /* convert integer to string with specified base */
  *--b = '\0';
  do {
    r = n % base;
    *--b = "0123456789abcdefghijklmnopqrstuvwxyz"[r];
    n /= base;
  } while (n != 0);

  if (neg) {
    *--b = '-';
  }

  len = (size_t)((buf + sizeof(buf)) - b - 1);
  return mrb_str_new(mrb, b, len);