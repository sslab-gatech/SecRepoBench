mrb_int base = 10;
char buf[MRB_INT_BIT+1];
mrb_value str;
mrb_int val;

mrb_get_args(mrb, "|i", &base);
if (base < 2 || base > 36) {
  mrb_raise(mrb, E_ARGUMENT_ERROR, "invalid radix");
}

val = mrb_fixnum(obj);
if (val == 0) {
  return mrb_str_new_cstr(mrb, "0");
}

const char *digits = "0123456789abcdefghijklmnopqrstuvwxyz";
char *p = buf + sizeof(buf);
mrb_bool neg = (val < 0);
mrb_uint u;

if (neg) {
  u = (mrb_uint)-val;
} else {
  u = (mrb_uint)val;
}

*--p = '\0';
do {
  *--p = digits[u % base];
  u /= base;
} while (u > 0);

if (neg) *--p = '-';

return mrb_str_new_cstr(mrb, p);