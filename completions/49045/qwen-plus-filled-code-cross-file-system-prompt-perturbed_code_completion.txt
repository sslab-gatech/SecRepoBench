mrb_int base = 10;
mrb_get_args(mrb, "|i", &base);

if (base < 2 || base > 36) {
  mrb_raise(mrb, E_ARGUMENT_ERROR, "invalid base (must be between 2 and 36)");
}

mrb_value int_val = mrb_fixnum_value(mrb_fixnum(obj));
char buf[64];
int len = snprintf(buf, sizeof(buf), "%" PRIiPTR, mrb_fixnum(int_val));
if (base != 10) {
  char *converted = mrb_integer_to_base(mrb_fixnum(int_val), base);
  return mrb_str_new_cstr(mrb, converted);
}
return mrb_str_new(mrb, buf, len);