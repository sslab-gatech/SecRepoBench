mrb_value
str;
char buf[64];
int base;

mrb_get_args(mrb, "|i", &base);
if (mrb_nil_p(obj)) {
  return mrb_str_new_lit(mrb, "nil");
}

if (base == 0) {
  base = 10;
}
else if (base < 2 || base > 36) {
  mrb_raisef(mrb, E_ARGUMENT_ERROR, "invalid radix %S", mrb_fixnum_value(base));
}

snprintf(buf, sizeof(buf), "%.*" PRId64, (int)sizeof(buf) - 1, mrb_integer(obj));
str = mrb_str_new_cstr(mrb, buf);

if (base != 10) {
  str = mrb_str_convert_base(mrb, str, 10, base);
}

return str;