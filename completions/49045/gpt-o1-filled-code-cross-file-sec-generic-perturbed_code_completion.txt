mrb_int base = 10;
  mrb_int val = mrb_integer(obj);
  mrb_get_args(mrb, "|i", &base);
  if (base < 2 || base > 36) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "invalid base");
  }

  {
    char buf[70];
    char *p = buf + sizeof(buf);
    static const char digits[] = "0123456789abcdefghijklmnopqrstuvwxyz";
    mrb_bool negative = FALSE;

    if (val < 0) {
      negative = TRUE;
      val = -val;
    }

    *--p = '\0';
    do {
      *--p = digits[val % base];
      val /= base;
    } while (val != 0);

    if (negative) {
      *--p = '-';
    }

    return mrb_str_new_cstr(mrb, p);
  }