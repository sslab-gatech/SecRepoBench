mrb_int base = 10;
mrb_get_args(mrb, "|i", &base);

if (base < 2 || base > 36) {
  mrb_raise(mrb, E_ARGUMENT_ERROR, "invalid base - must be between 2 and 36");
}

char format[8];
snprintf(format, sizeof(format), "%%l%" MRB_PRId_INT, base);
const char *format_str = format;

mrb_int number;
mrb_get_args(mrb, "i", &number);

char buffer[128];
snprintf(buffer, sizeof(buffer), format_str, number);

return mrb_str_new_cstr(mrb, buffer);