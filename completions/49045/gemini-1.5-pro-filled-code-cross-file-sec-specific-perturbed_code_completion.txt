mrb_int base = 10;
  mrb_int value;

  if (mrb_get_args(state, "i|i", &value, &base) == 1) {
    base = 10;
  }

  if (base < 2 || base > 36) {
    mrb_raisef(state, mrb_class_get(state, "ArgumentError"), "invalid radix %i", base);
  }

  char buf[MRB_INT_BIT + 1]; // enough size for base 2
  char *p = &buf[sizeof(buf) - 1];
  *p = '\0';

  if (value == 0) {
    *--p = '0';
  } else {
    while (value != 0) {
      mrb_int digit = value % base;
      value /= base;
      if (digit < 0) {
        digit = -digit;
        value = -value; // for -INT_MIN case
      }
      *--p = (digit < 10) ? ('0' + digit) : ('a' + digit - 10);
    }
  }

  return mrb_str_new_cstr(state, p);