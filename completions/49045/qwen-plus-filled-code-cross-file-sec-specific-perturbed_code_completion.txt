mrb_int base = 10;
mrb_get_args(mrb, "|i", &base);

if (base < 2 || base > 36) {
  mrb_raisef(mrb, E_ARGUMENT_ERROR, "invalid base: %d", base);
}

char buf[128]; // sufficiently large buffer to hold integer string representation
long num = mrb_fixnum(obj);
int len = snprintf(buf, sizeof(buf), "%ld", num);

if (len >= sizeof(buf)) {
  mrb_raise(mrb, E_RUNTIME_ERROR, "buffer overflow during integer conversion");
}

return mrb_str_new_cstr(mrb, buf);