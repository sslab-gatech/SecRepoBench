mrb_int base = 10;
  mrb_int num;
  char buf[66];
  char *p = &buf[65];
  int negative = 0;

  mrb_get_args(mrb, "|i", &base);
  if (base < 2 || base > 36) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "invalid radix");
  }

  num = mrb_fixnum(obj);
  if (num < 0 && base == 10) {
    negative = 1;
    num = -num;
  }

  *p = '\0';
  do {
    int digit = num % base;
    num /= base;
    *(--p) = (digit < 10) ? ('0' + digit) : ('a' + digit - 10);
  } while (num > 0);

  if (negative) {
    *(--p) = '-';
  }

  return mrb_str_new_cstr(mrb, p);