mrb_int base = 10;
mrb_int val = mrb_integer(obj);
char buf[MRB_INT_BIT + 1];
char *p = buf + sizeof(buf);
mrb_bool negative = FALSE;

mrb_get_args(mrb, "|i", &base);
if (base < 2 || base > 36) {
  mrb_raisef(mrb, E_ARGUMENT_ERROR, "invalid radix %S", mrb_fixnum_value(base));
}

if (val < 0) {
  negative = TRUE;
  val = -val;
}

*--p = '\0';
do {
  *--p = "0123456789abcdefghijklmnopqrstuvwxyz"[val % base];
  val /= base;
} while (val > 0);

if (negative) {
  *--p = '-';
}

return mrb_str_new_cstr(mrb, p);