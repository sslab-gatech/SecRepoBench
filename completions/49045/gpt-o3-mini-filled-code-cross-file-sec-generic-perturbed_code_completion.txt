{
  mrb_int base = 10;
  mrb_get_args(mrb, "|i", &base);
  if (base < 2 || base > 36) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "base must be between 2 and 36");
  }
  mrb_int n = mrb_integer(obj);
  int negative = (n < 0);
  unsigned long long un;
  if (negative) {
    un = ((unsigned long long)(~n)) + 1;
  }
  else {
    un = (unsigned long long)n;
  }

  char buf[66];
  buf[65] = '\0';
  int pos = 64;
  if (un == 0) {
    buf[pos--] = '0';
  }
  else {
    while (un != 0 && pos >= 0) {
      unsigned int rem = un % base;
      un /= base;
      buf[pos--] = (rem < 10) ? '0' + rem : 'a' + (rem - 10);
    }
  }
  if (negative) {
    buf[pos--] = '-';
  }
  return mrb_str_new_cstr(mrb, &buf[pos+1]);
}