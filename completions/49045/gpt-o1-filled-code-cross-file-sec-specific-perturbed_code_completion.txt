mrb_int val = mrb_integer(obj);
  mrb_int base = 10;
  static const char digits[] = "0123456789abcdefghijklmnopqrstuvwxyz";
  char buf[70]; /* enough to hold 64-bit number in base 2 plus sign + terminator */
  char *p = &buf[69];
  mrb_bool neg = FALSE;
  mrb_get_args(mrb, "|i", &base);

  if (base < 2 || base > 36) {
    mrb_raisef(mrb, E_ARGUMENT_ERROR, "invalid base %i", base);
  }

  *p = '\0';
  if (val < 0) {
    neg = TRUE;
    val = -val;
  }

  do {
    *--p = digits[val % base];
    val /= base;
  } while (val != 0);

  if (neg) {
    *--p = '-';
  }

  return mrb_str_new_cstr(mrb, p);