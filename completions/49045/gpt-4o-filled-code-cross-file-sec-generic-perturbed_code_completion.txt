mrb_int base = 10;
  mrb_int num = mrb_integer(obj);
  mrb_value str;
  char buf[65]; // Enough to hold binary representation of a 64-bit integer plus null terminator
  char *p = buf + sizeof(buf) - 1;
  int negative = 0;

  mrb_get_args(mrb, "|i", &base);

  if (base < 2 || base > 36) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "base must be between 2 and 36");
  }

  if (num == 0) {
    return mrb_str_new_lit(mrb, "0");
  }

  if (num < 0) {
    negative = 1;
    num = -num;
  }

  *p = '\0';
  while (num > 0) {
    mrb_int remainder = num % base;
    *(--p) = (remainder < 10) ? '0' + remainder : 'a' + (remainder - 10);
    num /= base;
  }

  if (negative) {
    *(--p) = '-';
  }

  str = mrb_str_new_cstr(mrb, p);
  return str;