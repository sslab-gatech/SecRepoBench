mrb_int base = 10;
  char buf[MRB_INT_MAX_DIGITS + 1];
  mrb_int len;
  mrb_int num = mrb_integer(obj);

  mrb_get_args(mrb, "|i", &base);
  if (base < 2 || base > 36) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "base must be between 2 and 36");
  }

  len = mrb_int_to_str(buf, sizeof(buf), num, base);
  if (len < 0) {
    mrb_raise(mrb, E_RUNTIME_ERROR, "integer to string conversion failed");
  }

  return mrb_str_new(mrb, buf, len);