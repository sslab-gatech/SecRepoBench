mrb_int base = 10;
  mrb_int n;
  char *buf;
  mrb_value num;
  mrb_get_args(state, "|i", &base);
  if (base < 2 || base > 36) {
    mrb_raise(state, E_ARGUMENT_ERROR, "base must be between 2 and 36");
  }
  num = self;
  if (mrb_integer_p(num)) {
    n = mrb_integer(num);
  } else if (mrb_float_p(num)) {
    n = (mrb_int)mrb_float(num);
  } else {
    mrb_raise(state, E_TYPE_ERROR, "can't convert non-integer to string");
  }
  buf = mrb_lltoa(state, n, base, NULL);
  return mrb_str_new_cstr(state, buf);