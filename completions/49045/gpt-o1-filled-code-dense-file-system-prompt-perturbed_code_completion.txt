mrb_int base = 10;
  mrb_int num, sign = 0;
  mrb_get_args(mrb, "|i", &base);

  if (base < 2 || base > 36) {
    mrb_raisef(mrb, E_ARGUMENT_ERROR, "invalid base %i", base);
  }

  num = mrb_integer(obj);
  if (num == 0) {
    return mrb_str_new_lit(mrb, "0");
  }

  if (num < 0) {
    sign = 1;
    num = -num;
  }

  {
    char buf[64], *p = buf + sizeof(buf);
    static const char digits[] = "0123456789abcdefghijklmnopqrstuvwxyz";
    *--p = '\0';

    while (num > 0) {
      *--p = digits[num % base];
      num /= base;
    }
    
    if (sign) {
      *--p = '-';
    }

    return mrb_str_new_cstr(mrb, p);
  }