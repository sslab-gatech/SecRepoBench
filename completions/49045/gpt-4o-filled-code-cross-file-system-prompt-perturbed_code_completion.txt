mrb_int base = 10;
  mrb_get_args(state, "|i", &base);

  if (base < 2 || base > 36) {
    mrb_raise(state, E_ARGUMENT_ERROR, "base must be between 2 and 36");
  }

  mrb_int num = mrb_integer(self);
  char buf[65]; // enough to hold binary representation of a 64-bit integer
  char *p = buf + sizeof(buf);
  mrb_bool negative = FALSE;

  if (num < 0) {
    negative = TRUE;
    num = -num;
  }

  *--p = '\0';
  do {
    *--p = "0123456789abcdefghijklmnopqrstuvwxyz"[num % base];
    num /= base;
  } while (num > 0);

  if (negative) {
    *--p = '-';
  }

  return mrb_str_new_cstr(state, p);