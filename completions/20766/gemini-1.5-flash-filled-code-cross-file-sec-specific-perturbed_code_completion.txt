struct ndpi_udphdr *udp_header = (struct ndpi_udphdr *) &packet[ip_offset];
    u_int16_t source_port = ntohs(udp_header->source);
    u_int16_t dest_port = ntohs(udp_header->dest);
    ip_offset += sizeof(struct ndpi_udphdr);

    if (source_port == GTPU_PORT || dest_port == GTPU_PORT) {
        // Check GTP-U
        if (check_gtp_u(packet, ip_offset, &ip_offset)) {
            tunnel_type = ndpi_gtp_tunnel;
        }
    } else if (source_port == TZSP_PORT || dest_port == TZSP_PORT) {
        // Check TZSP
        if (check_tzsp(packet, ip_offset, &ip_offset)) {
            tunnel_type = ndpi_tzsp_tunnel;
        }
    } else if (source_port == CAPWAP_PORT) {
        // Check CAPWAP
        if (check_capwap(packet, ip_offset, &ip_offset)) {
            tunnel_type = ndpi_capwap_tunnel;
        }
    }