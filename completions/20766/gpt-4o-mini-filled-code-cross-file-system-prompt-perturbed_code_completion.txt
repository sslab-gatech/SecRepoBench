struct ndpi_udphdr *udph = NULL;
    struct ndpi_tcphdr *tcph = NULL;
    u_int16_t sport = 0, dport = 0;
    u_int8_t *payload = NULL;
    u_int16_t payload_len = 0;
    u_int8_t src_to_dst_direction = 0;

    // Check for GTP-U protocol
    if ((ntohs(iph->dest) == 2152) || (ntohs(iph->source) == 2152)) {
        // GTP-U detected
        tunnel_type = ndpi_gtp_tunnel;
        ip_offset += sizeof(struct ndpi_udphdr);
    }
    // Check for TZSP protocol
    else if ((ntohs(iph->dest) == 37008) || (ntohs(iph->source) == 37008)) {
        // TZSP detected
        tunnel_type = ndpi_tzsp_tunnel;
        // Navigate through TZSP tags (not implemented here)
        // Update ip_offset accordingly
    }
    // Check for CAPWAP protocol
    else if ((ntohs(iph->dest) == 5246) || (ntohs(iph->source) == 5246)) {
        // CAPWAP detected
        tunnel_type = ndpi_capwap_tunnel;
        ip_offset += sizeof(struct ndpi_udphdr);
    }

    // Further processing with updated ip_offset and tunnel_type