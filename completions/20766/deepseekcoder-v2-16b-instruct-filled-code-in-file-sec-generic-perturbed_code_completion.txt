_to_c_init_win = rawsize;
        }
    }

    if(ndpi_flow->detection_completed) {
      process_ndpi_collected_info(workflow, flow);
    } else {
      if(ndpi_flow->detection_enabled) {
	ndpi_flow->detection_completed = 1;
	ndpi_flow->detection_enabled = 0;
      }

      if(ndpi_flow->detection_completed) {
	process_ndpi_collected_info(workflow, flow);
      } else {
	if(tcph != NULL) {
	  if(tcph->syn && tcph->ack) {
	    begin_or_end_tcp = 1;
	  } else if(tcph->fin) {
	    begin_or_end_tcp = 2;
	  }
	}

	if(begin_or_end_tcp == 1) {
	  if(src_to_dst_direction) {
	    flow->src2dst_bytes = rawsize;
	    flow->src2dst_packets++;
	  } else {
	    flow->dst2src_bytes = rawsize;
	    flow->dst2src_packets++;
	  }
	} else if(begin_or_end_tcp == 2) {
	  if(src_to_dst_direction) {
	    flow->src2dst_bytes = 0;
	    flow->src2dst_packets++;
	  } else {
	    flow->dst2src_bytes = 0;
	    flow->dst2src_packets++;
	  }
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL || udph != NULL) {
	  ndpi_flow_update_byte_count(flow, payload, payload_len, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, payload, payload_len, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to_dst_direction);
	}

	if(udph != NULL) {
	  ndpi_flow_update_byte_count(flow, udph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, udph, rawsize, src_to_dst_direction);
	}

	if(tcph != NULL) {
	  ndpi_flow_update_byte_count(flow, tcph, src_to_dst_direction);
	  ndpi_flow_update_byte_dist_mean_var(flow, tcph, rawsize, src_to