struct ndpi_udphdr *udph = (struct ndpi_udphdr *)&packet[ip_offset];
    u_int16_t sport = ntohs(udph->source), dport = ntohs(udph->dest);

    if((sport == 2152) || (dport == 2152)) { // GTP-U
      u_int8_t flags = packet[ip_offset + 8];
      u_int8_t message_type = packet[ip_offset + 9];

      if((flags >> 5) == 1 && message_type == 0xFF) { // GTPv1 and T-PDU
        ip_offset += 8 + ((flags & 0x07) * 4);
        tunnel_type = ndpi_gtp_tunnel;
      }
    } else if((sport == 37008) || (dport == 37008)) { // TZSP
      u_int8_t version = packet[ip_offset + 8];
      u_int8_t encapsulated_protocol = packet[ip_offset + 9];

      if(version == 1 && encapsulated_protocol == 1) { // Ethernet
        ip_offset += 10;
        while(packet[ip_offset] != 1) { // End tag
          ip_offset += packet[ip_offset + 1] + 2;
        }
        ip_offset += 2; // Skip end tag
        tunnel_type = ndpi_tzsp_tunnel;
      }
    } else if(sport == 5246) { // CAPWAP
      u_int8_t message_type = packet[ip_offset + 8] & 0x0F;

      if(message_type == 0) { // Data message
        ip_offset += 8;
        tunnel_type = ndpi_capwap_tunnel;
      }
    }