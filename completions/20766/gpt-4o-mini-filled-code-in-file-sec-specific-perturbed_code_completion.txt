// Check for GTP-U protocol
    if (ntohs(*((u_int16_t*)&packet[ip_offset])) == GTP_U_V1_PORT || ntohs(*((u_int16_t*)&packet[ip_offset + 2])) == GTP_U_V1_PORT) {
        // Verify GTP version and message type
        if (payload_len >= 1 && (payload[0] & 0xC0) == 0x20) {
            ip_offset += 8; // Skip GTP header
            tunnel_type = ndpi_gtp_tunnel;
        }
    }
    // Check for TZSP protocol
    else if (ntohs(*((u_int16_t*)&packet[ip_offset])) == TZSP_PORT) {
        // Verify TZSP version and encapsulated protocol
        if (payload_len >= 2) {
            ip_offset += 4; // Skip TZSP header
            tunnel_type = ndpi_tzsp_tunnel;
        }
    }
    // Check for CAPWAP protocol
    else if (ntohs(*((u_int16_t*)&packet[ip_offset])) == NDPI_CAPWAP_DATA_PORT) {
        // Verify CAPWAP message type
        if (payload_len >= 1) {
            ip_offset += 4; // Skip CAPWAP header
            tunnel_type = ndpi_capwap_tunnel;
        }
    }