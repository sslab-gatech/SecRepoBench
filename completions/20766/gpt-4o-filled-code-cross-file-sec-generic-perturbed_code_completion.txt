struct ndpi_udphdr *udph = (struct ndpi_udphdr *) &packet[ip_offset];
    u_int16_t sport = ntohs(udph->source), dport = ntohs(udph->dest);

    if((sport == 2152) || (dport == 2152)) { // GTP-U
      struct ndpi_gtphdr *gtp = (struct ndpi_gtphdr *) &packet[ip_offset + sizeof(struct ndpi_udphdr)];
      if(gtp->v_pt_rsv_flags == 0x30) { // GTP version 1 and GTP-U message
        ip_offset += sizeof(struct ndpi_udphdr) + 8; // Move to encapsulated IP header
        tunnel_type = ndpi_gtp_tunnel;
      }
    } else if((sport == 3703) || (dport == 3703)) { // TZSP
      struct ndpi_tzsphdr *tzsp = (struct ndpi_tzsphdr *) &packet[ip_offset + sizeof(struct ndpi_udphdr)];
      if(tzsp->version == 1) {
        u_int8_t *tag = (u_int8_t *) &packet[ip_offset + sizeof(struct ndpi_udphdr) + sizeof(struct ndpi_tzsphdr)];
        while(*tag != 1) { // End tag
          tag += 2 + tag[1]; // Move to next tag
        }
        ip_offset = (tag - packet) + 2; // Move to encapsulated Ethernet frame
        tunnel_type = ndpi_tzsp_tunnel;
      }
    } else if(sport == 5246) { // CAPWAP
      struct ndpi_capwaphdr *capwap = (struct ndpi_capwaphdr *) &packet[ip_offset + sizeof(struct ndpi_udphdr)];
      if(capwap->type == 0) { // Data packet
        ip_offset += sizeof(struct ndpi_udphdr) + 8; // Move to encapsulated IP header
        tunnel_type = ndpi_capwap_tunnel;
      }
    }