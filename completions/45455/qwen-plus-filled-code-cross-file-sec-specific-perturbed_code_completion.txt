ent = xmlParseStringEntityRef(ctxt, &ctxt->input->cur);
if (ent == NULL)
    return;

if (ent->checked == 0) {
    entity_checked_status = ent->checked;
}

if ((ent->etype == XML_INTERNAL_GENERAL_ENTITY) || 
    (ent->etype == XML_EXTERNAL_GENERAL_PARSED_ENTITY)) {
    val = xmlStringDecodeEntities(ctxt, ent->content, XML_SUBSTITUTE_REF, 0, 0, 0);
    if (val == NULL)
        return;

    if ((ctxt->sax != NULL) && (ctxt->sax->characters != NULL) && (!ctxt->disableSAX)) {
        ctxt->sax->characters(ctxt->userData, val, xmlStrlen(val));
    }
    xmlFree(val); // Securely free the allocated memory for 'val'
}