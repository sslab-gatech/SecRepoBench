// Parse the entity reference from the XML parser context.
ent = xmlParseStringEntityRef(ctxt, &val);
if (ent == NULL) {
    return;
}
entity_checked_status = ent->checked;

// Handle the special case for predefined entities:
if (ent->etype == XML_INTERNAL_PREDEFINED_ENTITY) {
    if (ent->content != NULL) {
        if ((ctxt->sax != NULL) && (ctxt->sax->characters != NULL) &&
            (!ctxt->disableSAX))
            ctxt->sax->characters(ctxt->userData, ent->content, xmlStrlen(ent->content));
    }
    return;
}

// Inline the entity content using the SAX character handler if available.
if ((ctxt->sax != NULL) && (ctxt->sax->characters != NULL) &&
    (!ctxt->disableSAX)) {
    if (ent->content != NULL) {
        ctxt->sax->characters(ctxt->userData, ent->content, xmlStrlen(ent->content));
    } else {
        xmlChar *rep;
        rep = xmlStringDecodeEntities(ctxt, ent->name, what, end, end2, end3);
        if (rep != NULL) {
            ctxt->sax->characters(ctxt->userData, rep, -1);
            xmlFree(rep);
        }
    }
}