if (ent == NULL) {
        if (ctxt->instate == XML_PARSER_ATTRIBUTE_VALUE) {
            xmlFatalErrMsgStr(ctxt, XML_ERR_UNDECLARED_ENTITY,
                              "Entity '%s' not defined\n", name);
        } else {
            xmlWarningMsg(ctxt, XML_WAR_UNDECLARED_ENTITY,
                          "Entity '%s' not defined\n", name, NULL);
            ctxt->valid = 0;
        }
        return (NULL);
    }
    entity_checked_status = ent->checked;
    if ((ent->etype == XML_INTERNAL_PREDEFINED_ENTITY) &&
        (ent->content != NULL)) {
        int i = 0;
        xmlChar out[16];

        while (ent->content[i] != 0) {
            COPY_BUF(0, out, i, ent->content[i]);
            i++;
        }
        out[i] = 0;
        if ((ctxt->sax != NULL) && (ctxt->sax->characters != NULL) &&
            (!ctxt->disableSAX))
            ctxt->sax->characters(ctxt->userData, out, i);
        return (ent);
    }