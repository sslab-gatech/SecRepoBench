if ((ent!= NULL) &&
    (ent->etype == XML_INTERNAL_PREDEFINED_ENTITY)) {
    if (ent->content!= NULL) {
        if (ctxt->replaceEntities) {
            if (ctxt->sax!= NULL) {
                if (ctxt->sax->characters!= NULL)
                    ctxt->sax->characters(ctxt->userData, ent->content, 1);
            } else {
                xmlNodePtr nw = xmlDocCopyNode(ent->content, ctxt->myDoc, 1);
                if (nw!= NULL) {
                    nw->_private = ent->content->_private;
                    xmlAddChild(ctxt->node, nw);
                }
            }
        } else {
            if (ctxt->sax!= NULL) {
                if (ctxt->sax->reference!= NULL)
                    ctxt->sax->reference(ctxt->userData, ent->name);
            }
        }
    }
} else if ((ent!= NULL) &&
           (ctxt->replaceEntities!= 0)) {
    if (ent->etype!= XML_INTERNAL_PREDEFINED_ENTITY) {
        if (ctxt->sax!= NULL) {
            if (ctxt->sax->characters!= NULL) {
                if (ctxt->sax->startElementNs!= NULL) {
                    if (ctxt->sax->startElementNs(ctxt->userData, ent->name, NULL,
                                                  NULL, 0, NULL, 0, 0, NULL)) {
                        if (ctxt->sax->endElementNs!= NULL)
                            ctxt->sax->endElementNs(ctxt->userData, ent->name,
                                                    NULL, NULL);
                    }
                } else {
                    if (ctxt->sax->startElement!= NULL) {
                        if (ctxt->sax->startElement(ctxt->userData, ent->name)) {
                            if (ctxt->sax->endElement!= NULL)
                                ctxt->sax->endElement(ctxt->userData, ent->name);
                        }
                    }
                }
            }
        }
    }
}