if (ent->checked == 0) {
        ctxt->depth++;
        ret = xmlParseBalancedChunkMemoryInternal(ctxt, ent->content, ctxt->userData, &list);
        ctxt->depth--;

        if (ret == XML_ERR_ENTITY_LOOP) {
            xmlFatalErr(ctxt, XML_ERR_ENTITY_LOOP, NULL);
            xmlHaltParser(ctxt);
            return NULL;
        }
    }

    ctxt->nbentities += ent->checked / 2;

    if ((ctxt->sax != NULL) && (ctxt->sax->reference != NULL) && (ctxt->replaceEntities == 0) && (!ctxt->disableSAX)) {
        ctxt->sax->reference(ctxt->userData, ent->name);
    }