ent = xmlParseStringEntityRef(ctxt, &ctxt->input->cur);
    if (ent == NULL) {
        xmlFatalErr(ctxt, XML_ERR_UNDECLARED_ENTITY, NULL);
        return;
    }

    if (ent->etype == XML_EXTERNAL_GENERAL_UNPARSED_ENTITY) {
        xmlFatalErrMsgStr(ctxt, XML_ERR_UNPARSED_ENTITY,
                          "Entity reference to unparsed entity %s\n", ent->name);
        return;
    }

    if ((ctxt->instate == XML_PARSER_ATTRIBUTE_VALUE) &&
        (ent->etype == XML_EXTERNAL_GENERAL_PARSED_ENTITY)) {
        xmlFatalErrMsgStr(ctxt, XML_ERR_ENTITY_IS_EXTERNAL,
                          "Attribute references external entity '%s'\n", ent->name);
        return;
    }

    if ((ctxt->instate == XML_PARSER_ATTRIBUTE_VALUE) &&
        (ent->content != NULL) &&
        (ent->etype != XML_INTERNAL_PREDEFINED_ENTITY) &&
        (xmlStrchr(ent->content, '<'))) {
        xmlFatalErrMsgStr(ctxt, XML_ERR_LT_IN_ATTRIBUTE,
                          "'<' in entity '%s' is not allowed in attributes values\n", ent->name);
        return;
    }

    if ((ent->content != NULL) && (ctxt->sax != NULL) &&
        (ctxt->sax->characters != NULL) && (!ctxt->disableSAX)) {
        ctxt->sax->characters(ctxt->userData, ent->content, xmlStrlen(ent->content));
    }