{
    // If the codec is H.264, a VP-series codec, or similar, or if lowres is used,
    // align the height by adding 2 to accommodate certain MC edge cases.
    switch (codeccontext->codec_id) {
    case AV_CODEC_ID_H264:
    case AV_CODEC_ID_HEVC:
    case AV_CODEC_ID_VP8:
    case AV_CODEC_ID_VP9:
    case AV_CODEC_ID_AV1:
        *height = FFALIGN(*height + 2, h_align);
        break;
    default:
        break;
    }

    if (codeccontext->lowres > 0)
        *height = FFALIGN(*height + 2, h_align);

    // Ensure width is at least 32 for out-of-frame edge emulation.
    *width = FFMAX(*width, 32);
}