_data, unicode, glyph);
    }

    bool get_glyph (hb_codepoint_t unicode,
		    hb_codepoint_t *glyph) const
    {
      if (unlikely (!this->get_glyph_funcZ)) return false;
      return this->get_glyph_funcZ (this->get_glyph_data, unicode, glyph);
    }

    void collect_unicodes (hb_set_t *unicodes) const
    {
      if (unlikely (!this->get_glyph_funcZ)) return;
      this->get_glyph_data->collect_unicodes (unicodes);
    }

    void collect_mapping (hb_set_t *unicodes, /* OUT */
			  hb_map_t *mapping /* OUT */) const
    {
      if (unlikely (!this->get_glyph_funcZ)) return;
      this->get_glyph_data->collect_mapping (unicodes, mapping);
    }

    void collect_variation_selectors (hb_set_t *out) const
    {
      if (unlikely (!this->get_glyph_funcZ)) return;
      this->subtable_uvs->collect_variation_selectors (out);
    }

    void collect_variation_unicodes (hb_codepoint_t variation_selector,
				     hb_set_t *out) const
    {
      if (unlikely (!this->get_glyph_funcZ)) return;
      this->subtable_uvs->collect_variation_unicodes (variation_selector, out);
    }

    const CmapSubtable *subtable;
    const CmapSubtableFormat14 *subtable_uvs;
    const CmapSubtable *get_glyph_data;
    get_glyph_func_t get_glyph_funcZ;
    hb_sanitize_context_t table;
    union {
      const CmapSubtable *format4_accel;
    } u;
  };

  const CmapSubtable *find_subtable (unsigned platformID,
				     unsigned encodingID) const
  {
    for (const EncodingRecord& _ : encodingRecord)
      if (_.platformID == platformID && _.encodingID == encodingID)
	return &(_ + _.subtable);
    return nullptr;
  }

  const CmapSubtable *find_glyph_subtable (hb_codepoint_t codepoint,
					   bool *symbol = nullptr) const
  {
    if (symbol) *symbol = false;

    const CmapSubtable *subtable = this->find_best_subtable (symbol);
    if (!subtable) return nullptr;

    hb_codepoint_t glyph;
    if (!subtable->get_glyph (codepoint, &glyph)) return nullptr;

    return subtable;
  }

  const CmapSubtable *find_glyph_subtable_uvs (hb_codepoint_t codepoint,
					       hb_codepoint_t variation_selector,
					       hb_codepoint_t *glyph) const
  {
    const CmapSubtable *subtable = this->find_best_subtable ();
    if (!subtable) return nullptr;

    glyph_variant_t variant = subtable->u.format14.get_glyph_variant (codepoint, variation_selector, glyph);
    if (variant == GLYPH_VARIANT_NOT_FOUND) return nullptr;
    if (variant == GLYPH_VARIANT_USE_DEFAULT) return nullptr;

    return subtable;
  }

  bool sanitize (hb_sanitize_context_t *c) const
  {
    TRACE_SANITIZE (this);
    return_trace (c->check_struct (this) &&
		  encodingRecord.sanitize (c, this));
  }

  const CmapSubtable *get_glyph_subtable (hb_codepoint_t codepoint,
					  bool *symbol = nullptr) const
  {
    if (symbol) *symbol = false;

    const CmapSubtable *subtable = this->find_best_subtable (symbol);
    if (!subtable) return nullptr;

    hb_codepoint_t glyph;
    if (!subtable->get_glyph (codepoint, &glyph)) return nullptr;

    return subtable;
  }

  const CmapSubtable *get_glyph_subtable_uvs (hb_codepoint_t codepoint,
					      hb_codepoint_t variation_selector,
					      hb_codepoint_t *glyph) const
  {
    const CmapSubtable *subtable = this->find_best_subtable ();
    if (!subtable) return nullptr;

    glyph_variant_t variant = subtable->u.format14.get_glyph_variant (codepoint, variation_selector, glyph);
    if (variant == GLYPH_VARIANT_NOT_FOUND) return nullptr;
    if (variant == GLYPH_VARIANT_USE_DEFAULT) return nullptr;

    return subtable;
  }

  const CmapSubtable *get_glyph_subtable_uvs_for_selector (hb_codepoint_t variation_selector,
							   hb_codepoint_t *glyph) const
  {
    const CmapSubtable *subtable = this->find_best_subtable ();
    if (!subtable) return nullptr;

    glyph_variant_t variant = subtable->u.format14.get_glyph_variant (variation_selector, glyph);
    if (variant == GLYPH_VARIANT_NOT_FOUND) return nullptr;
    if (variant == GLYPH_VARIANT_USE_DEFAULT) return nullptr;

    return subtable;
  }

  const CmapSubtable *get_glyph_subtable_for_selector (hb_codepoint_t variation_selector) const
  {
    const CmapSubtable *subtable = this->find_best_subtable ();
    if (!subtable) return nullptr;

    glyph_variant_t variant = subtable->u.format14.get_glyph_variant (variation_selector);
    if (variant == GLYPH_VARIANT_NOT_FOUND) return nullptr;
    if (variant == GLYPH_VARIANT_USE_DEFAULT) return nullptr;

    return subtable;
  }

  const CmapSubtable *get_glyph_subtable_for_codepoint (hb_codepoint_t codepoint) const
  {
    const CmapSubtable *subtable = this->find_best_subtable ();
    if (!subtable) return nullptr;

    hb_codepoint_t glyph;
    if (!subtable->get_glyph (codepoint, &glyph)) return nullptr;

    return subtable;
  }

  const CmapSubtable *get_glyph_subtable_uvs_for_codepoint (hb_codepoint_t codepoint,
							    hb_codepoint_t variation_selector,
							    hb_codepoint_t *glyph) const
  {
    const CmapSubtable *subtable = this->find_best_subtable ();
    if (!subtable) return nullptr;

    glyph_variant_t variant = subtable->u.format14.get_glyph_variant (codepoint, variation_selector, glyph);
    if (variant == GLYPH_VARIANT_NOT_FOUND) return nullptr;
    if (variant == GLYPH_VARIANT_USE_DEFAULT) return nullptr;

    return subtable;
  }

  const CmapSubtable *get_glyph_subtable_uvs_for_codepoint_and_selector (hb_codepoint_t codepoint,
									  hb_codepoint_t variation_selector,
									  hb_codepoint_t *glyph) const
  {
    const CmapSubtable *subtable = this->find_best_subtable ();
    if (!subtable) return nullptr;

    glyph_variant_t variant = subtable->u.format14.get_glyph_variant (codepoint, variation_selector, glyph);
    if (variant == GLYPH_VARIANT_NOT_FOUND) return nullptr;
    if (variant == GLYPH_VARIANT_USE_DEFAULT) return nullptr;

    return subtable;
  }

  const CmapSubtable *get_glyph_subtable_uvs_for_codepoint_and_selector_and_glyph (hb_codepoint_t codepoint,
										      hb_codepoint_t variation_selector,
										      hb_codepoint_t glyph) const
  {
    const CmapSubtable *subtable = this->find_best_subtable ();
    if (!subtable) return nullptr;

    glyph_variant_t variant = subtable->u.format14.get_glyph_variant (codepoint, variation_selector, &glyph);
    if (variant == GLYPH_VARIANT_NOT_FOUND) return nullptr;
    if (variant == GLYPH_VARIANT_USE_DEFAULT) return nullptr;

    return subtable;
  }

  const CmapSubtable *get_glyph_subtable_uvs_for_codepoint_and_glyph (hb_codepoint_t codepoint,
								      hb_codepoint_t glyph) const
  {
    const CmapSubtable *subtable = this->find_best_subtable ();
    if (!subtable) return nullptr;

    glyph_variant_t variant = subtable->u.format14.get_glyph_variant (codepoint, &glyph);
    if (variant == GLYPH_VARIANT_NOT_FOUND) return nullptr;
    if (variant == GLYPH_VARIANT_USE_DEFAULT) return nullptr;

    return subtable;
  }

  const CmapSubtable *get_glyph_subtable_uvs_for_selector_and_glyph (hb_codepoint_t variation_selector,
								      hb_codepoint_t glyph) const
  {
    const CmapSubtable *subtable = this->find_best_subtable ();
    if (!subtable) return nullptr;

    glyph_variant_t variant = subtable->u.format14.get_glyph_variant (variation_selector, &glyph);
    if (variant == GLYPH_VARIANT_NOT_FOUND) return nullptr;
    if (variant == GLYPH_VARIANT_USE_DEFAULT) return nullptr;

    return subtable;
  }

  const CmapSubtable *get_glyph_subtable_for_selector_and_glyph (hb_codepoint_t variation_selector,
								 hb_codepoint_t glyph) const
  {
    const CmapSubtable *subtable = this->find_best_subtable ();
    if (!subtable) return nullptr;

    glyph_variant_t variant = subtable->u.format14.get_glyph_variant (variation_selector, &glyph);
    if (variant == GLYPH_VARIANT_NOT_FOUND) return nullptr;
    if (variant == GLYPH_VARIANT_USE_DEFAULT) return nullptr;

    return subtable;
  }

  const CmapSubtable *get_glyph_subtable_uvs_for_codepoint_and_glyph_and_selector (hb_codepoint_t codepoint,
										      hb_codepoint_t glyph,
										      hb_codepoint_t variation_selector) const
  {
    const CmapSubtable *subtable = this->find_best_subtable ();
    if (!subtable) return nullptr;

    glyph_variant_t variant = subtable->u.format14.get_glyph_variant (codepoint, variation_selector, &glyph);
    if (variant == GLYPH_VARIANT_NOT_FOUND) return nullptr;
    if (variant == GLYPH_VARIANT_USE_DEFAULT) return nullptr;

    return subtable;
  }

  const CmapSubtable *get_glyph_subtable_for_codepoint_and_glyph (hb_codepoint_t codepoint,
								  hb_codepoint_t glyph) const
  {
    const CmapSubtable *subtable = this->find_best_subtable ();
    if (!subtable) return nullptr;

    glyph_variant_t variant = subtable->u.format14.get_glyph_variant (codepoint, &glyph);
    if (variant == GLYPH_VARIANT_NOT_FOUND) return nullptr;
    if (variant == GLYPH_VARIANT_USE_DEFAULT) return nullptr;

    return subtable;
  }

  const CmapSubtable *get_glyph_subtable_for_selector_and_codepoint (hb_codepoint_t variation_selector,
								      hb_codepoint_t codepoint) const
  {
    const CmapSubtable *subtable = this->find