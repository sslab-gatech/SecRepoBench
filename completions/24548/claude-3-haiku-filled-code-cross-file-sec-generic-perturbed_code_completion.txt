// Calculate the tail length and update the length and record length fields
// with the appropriate values based on the current context length and offsets.
unsigned int tail_length = c->length () - initial_table_position;
src_tbl->length = hb_be_uint16 (tail_length);
src_tbl->record_length = hb_be_uint16 (obj_indices.length);

// Reverse the order of the variation selector records to match the expected order.
void _reverse_variation_records ()
{
  for (unsigned int i = 0, j = obj_indices.length - 1; i < j; i++, j--)
  {
    hb_pair_t<unsigned, unsigned> temp = obj_indices[i];
    obj_indices[i] = obj_indices[j];
    obj_indices[j] = temp;
  }
}

// Add links to the variation records based on the calculated offsets.
void _add_links_to_variation_records (hb_serialize_context_t *c, const hb_vector_t<hb_pair_t<unsigned, unsigned>> &obj_indices)
{
  for (const auto& pair : obj_indices)
  {
    if (pair.first)
    {
      c->push ();
      c->copy (c->start_embed (reinterpret_cast<const VariationSelectorRecord*> (c->start + pair.first)), sizeof (VariationSelectorRecord));
      c->pop_pack ();
    }
    if (pair.second)
    {
      c->push ();
      c->copy (c->start_embed (reinterpret_cast<const NonDefaultUVS*> (c->start + pair.second)), sizeof (NonDefaultUVS));
      c->pop_pack ();
    }
  }
}