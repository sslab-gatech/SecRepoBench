// Check if the CodeView signature fits in the PE data
if (!fits_in_pe(pe, codeview_header, 4))
  continue;

// Offset to the PDB path based on the format
size_t pdb_path_offset = 0;

// Check the signature to determine the format
if (memcmp(codeview_header->Signature, "NB10", 4) == 0)
{
  pdb_path_offset = 16;  // For NB10 format
}
else if (memcmp(codeview_header->Signature, "RSDS", 4) == 0)
{
  pdb_path_offset = 24;  // For RSDS format
}
else
{
  continue;  // Unknown format, skip this entry
}

// Ensure we have enough data for the metadata
if (pcv_hdr_offset + pdb_path_offset >= pe->data_size)
  continue;

pdb_path = (char*)(pe->data + pcv_hdr_offset + pdb_path_offset);

// Calculate how much space is left in the PE file after the PDB path
size_t remaining = pe->data_size - (pcv_hdr_offset + pdb_path_offset);

// Find the length of the null-terminated string
pdb_path_len = strnlen(pdb_path, remaining);

// Check if we found a null terminator and the path is of a reasonable length
// Using 260 as a common MAX_PATH value
if (pdb_path_len < remaining && pdb_path_len > 0 && pdb_path_len < 260)
{
  set_string(pdb_path, pe->object, "pdb_path");
  break;  // Found a valid PDB path, stop searching
}