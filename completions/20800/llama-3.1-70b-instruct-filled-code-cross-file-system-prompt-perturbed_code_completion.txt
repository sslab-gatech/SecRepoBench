// Determine the type of CodeView debug information by checking the signature.
// Depending on the signature, cast the header to the appropriate PDB structure.
// Extract the PDB file name from the structure if it fits within the PE bounds.
// Compute the length of the PDB path and ensure it's within valid limits.
// If a valid PDB path is found, store the path in the object associated with the PE.
// Stop further processing after successfully storing a valid PDB path.

switch (yr_le32toh(codeview_header->cv_signature))
{
  case CV_SIGNATURE_RSDS:
  {
    PRSDS_HEADER rsds_header = (PRSDS_HEADER) codeview_header;
    if (fits_in_pe(pe, rsds_header->szPdb, sizeof(rsds_header->szPdb)))
    {
      pdb_path_len = strnlen(rsds_header->szPdb, sizeof(rsds_header->szPdb));
      if (pdb_path_len > 0 && pdb_path_len < sizeof(rsds_header->szPdb))
      {
        pdb_path = (char*) yr_malloc(pdb_path_len + 1);
        if (pdb_path!= NULL)
        {
          strncpy(pdb_path, rsds_header->szPdb, pdb_path_len);
          pdb_path[pdb_path_len] = '\0';
          set_string(pdb_path, pe->object, "pdb_path");
          yr_free(pdb_path);
          return;
        }
      }
    }
    break;
  }

  case CV_SIGNATURE_NB10:
  {
    PNB10_HEADER nb10_header = (PNB10_HEADER) codeview_header;
    if (fits_in_pe(pe, nb10_header->filename, sizeof(nb10_header->filename)))
    {
      pdb_path_len = strnlen(nb10_header->filename, sizeof(nb10_header->filename));
      if (pdb_path_len > 0 && pdb_path_len < sizeof(nb10_header->filename))
      {
        pdb_path = (char*) yr_malloc(pdb_path_len + 1);
        if (pdb_path!= NULL)
        {
          strncpy(pdb_path, nb10_header->filename, pdb_path_len);
          pdb_path[pdb_path_len] = '\0';
          set_string(pdb_path, pe->object, "pdb_path");
          yr_free(pdb_path);
          return;
        }
      }
    }
    break;
  }
}