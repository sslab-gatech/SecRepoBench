if (struct_fits_in_pe(pe, codeview_header, CV_HEADER)) {
    char* pdb_filename = NULL;
    
    // Check for PDB 7.0 format (RSDS)
    if (memcmp(codeview_header->Signature, "RSDS", 4) == 0) {
        PCV_INFO_PDB70 pdb70 = (PCV_INFO_PDB70) codeview_header;
        if (struct_fits_in_pe(pe, pdb70, CV_INFO_PDB70)) {
            pdb_filename = (char*) pdb70 + sizeof(CV_INFO_PDB70);
        }
    }
    // Check for PDB 2.0 format (NB10)
    else if (memcmp(codeview_header->Signature, "NB10", 4) == 0) {
        PCV_INFO_PDB20 pdb20 = (PCV_INFO_PDB20) codeview_header;
        if (struct_fits_in_pe(pe, pdb20, CV_INFO_PDB20)) {
            pdb_filename = (char*) pdb20 + sizeof(CV_INFO_PDB20);
        }
    }
    
    // Process the PDB filename if we found one
    if (pdb_filename != NULL) {
        // Calculate remaining bytes for the string
        size_t remaining = pe->data + pe->data_size - (uint8_t*) pdb_filename;
        
        if (remaining > 0) {
            // Find length of null-terminated string, capped by remaining space
            pdb_path_len = strnlen(pdb_filename, remaining);
            
            // Make sure we have a complete string (not truncated)
            if (pdb_path_len < remaining) {
                pdb_path = (char*) yr_malloc(pdb_path_len + 1);
                if (pdb_path != NULL) {
                    memcpy(pdb_path, pdb_filename, pdb_path_len);
                    pdb_path[pdb_path_len] = '\0';
                    set_string(pdb_path, pe->object, "pdb_path");
                    yr_free(pdb_path);
                    break;  // Stop further processing after finding valid PDB path
                }
            }
        }
    }
}