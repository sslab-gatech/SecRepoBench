if (!struct_fits_in_pe(pe, codeview_header, CV_HEADER))
  continue;

// Check the CodeView signature
if (memcmp(codeview_header->Signature, "RSDS", 4) == 0)
{
  // This is a PDB 7.0 format
  PRSDS_HEADER rsds_header = (PRSDS_HEADER) codeview_header;
  
  if (!struct_fits_in_pe(pe, rsds_header, RSDS_HEADER))
    continue;
  
  pdb_path = (char*) rsds_header->PdbFileName;
  
  // Make sure the PDB filename is within the PE bounds
  if (fits_in_pe(pe, pdb_path, 1))
  {
    pdb_path_len = strnlen(pdb_path, pe->data_size - (pdb_path - pe->data));
    
    if (pdb_path_len > 0 && pdb_path_len < MAX_PATH)
    {
      set_string(pdb_path, pe->object, "pdb_path");
      break;  // Found a valid PDB path, stop processing
    }
  }
}
else if (memcmp(codeview_header->Signature, "NB10", 4) == 0)
{
  // This is a PDB 2.0 format
  PNB10_HEADER nb10_header = (PNB10_HEADER) codeview_header;
  
  if (!struct_fits_in_pe(pe, nb10_header, NB10_HEADER))
    continue;
  
  pdb_path = (char*) nb10_header->PdbFileName;
  
  // Make sure the PDB filename is within the PE bounds
  if (fits_in_pe(pe, pdb_path, 1))
  {
    pdb_path_len = strnlen(pdb_path, pe->data_size - (pdb_path - pe->data));
    
    if (pdb_path_len > 0 && pdb_path_len < MAX_PATH)
    {
      set_string(pdb_path, pe->object, "pdb_path");
      break;  // Found a valid PDB path, stop processing
    }
  }
}