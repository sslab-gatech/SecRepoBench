if (primitive_info == (const PrimitiveInfo *) NULL)
  return (PathInfo *) NULL;
if ((primitive_info[0].primitive == UndefinedPrimitive) ||
    (primitive_info[0].coordinates <= 0))
  return (PathInfo *) NULL;

/* Count the number of valid primitives */
for (i = 0, n = 0; primitive_info[i].primitive != UndefinedPrimitive; i++)
  n++;

/* Allocate extra space for potential additional path elements (e.g. ghostline and end marker) */
{
  size_t required_elements = (size_t)n + 3;
  if (required_elements > SIZE_MAX / sizeof(PathInfo))
    return (PathInfo *) NULL;
  path_info = (PathInfo *) malloc(required_elements * sizeof(PathInfo));
  if (path_info == (PathInfo *) NULL)
    return (PathInfo *) NULL;
}

/* Initialize counters */
n = 0;
coordinates = 0;
start = 0;