%
%  The format of the DrawImage method is:
%
%      MagickBooleanType DrawImage(Image *image,const DrawInfo *draw_info,
%        ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType DrawImage(Image *image,const DrawInfo *draw_info,
  ExceptionInfo *exception)
{
  MagickBooleanType
    status;

  PrimitiveInfo
    *primitive_info;

  size_t
    number_primitives;

  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(draw_info != (const DrawInfo *) NULL);
  if (draw_info->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"...");
  if (draw_info->primitive == (char *) NULL)
    return(MagickTrue);
  status=MagickTrue;
  number_primitives=TracePath(NULL,draw_info->primitive,exception);
  if (number_primitives == 0)
    return(MagickTrue);
  primitive_info=(PrimitiveInfo *) AcquireQuantumMemory(number_primitives+1,
    sizeof(*primitive_info));
  if (primitive_info == (PrimitiveInfo *) NULL)
    return(MagickFalse);
  (void) memset(primitive_info,0,number_primitives*sizeof(*primitive_info));
  (void) TracePath(primitive_info,draw_info->primitive,exception);
  if (IsEventLogging() != MagickFalse)
    LogMagickEvent(DrawEvent,GetMagickModule(),"    begin draw-primitive");
  status=DrawPrimitive(image,draw_info,primitive_info,exception);
  if (IsEventLogging() != MagickFalse)
    LogMagickEvent(DrawEvent,GetMagickModule(),"    end draw-primitive");
  primitive_info=(PrimitiveInfo *) RelinquishMagickMemory(primitive_info);
  return(status);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w P r i m i t i v e                                                 %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawPrimitive() draws a graphic primitive on your image.  The primitive
%  may be represented as a string or filename.
%
%  The format of the DrawPrimitive method is:
%
%      MagickBooleanType DrawPrimitive(Image *image,const DrawInfo *draw_info,
%        const PrimitiveInfo *primitive_info)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o primitive_info: Specifies a pointer to an PrimitiveInfo structure.
%
*/
static MagickBooleanType DrawPrimitive(Image *image,const DrawInfo *draw_info,
  const PrimitiveInfo *primitive_info,ExceptionInfo *exception)
{
  MagickBooleanType
    status;

  register ssize_t
    i;

  status=MagickTrue;
  for (i=0; primitive_info[i].primitive != UndefinedPrimitive; i++)
  {
    switch (primitive_info[i].primitive)
    {
      case ArcPrimitive:
        status=DrawArc(image,draw_info,primitive_info+i,exception);
        break;
      case BezierPrimitive:
        status=DrawBezier(image,draw_info,primitive_info+i,exception);
        break;
      case CirclePrimitive:
        status=DrawCircle(image,draw_info,primitive_info+i,exception);
        break;
      case EllipsePrimitive:
        status=DrawEllipse(image,draw_info,primitive_info+i,exception);
        break;
      case LinePrimitive:
        status=DrawLine(image,draw_info,primitive_info+i,exception);
        break;
      case RectanglePrimitive:
        status=DrawRectangle(image,draw_info,primitive_info+i,exception);
        break;
      case RoundRectanglePrimitive:
        status=DrawRoundRectangle(image,draw_info,primitive_info+i,exception);
        break;
      case SquareLinecapPrimitive:
        status=DrawSquareLinecap(image,draw_info,primitive_info+i,exception);
        break;
      case UndefinedPrimitive:
        break;
      default:
        ThrowPointExpectedException(primitive_info[i].primitive,exception);
        break;
    }
    if (status == MagickFalse)
      break;
  }
  return(status);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w S t r o k e P o l y g o n                                         %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawStrokePolygon() draws a stroked polygon on the image.
%
%  The format of the DrawStrokePolygon method is:
%
%      MagickBooleanType DrawStrokePolygon(Image *image,const DrawInfo *draw_info,
%        const PrimitiveInfo *primitive_info,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o primitive_info: Specifies a pointer to a PrimitiveInfo structure.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType DrawStrokePolygon(Image *image,
  const DrawInfo *draw_info,const PrimitiveInfo *primitive_info,
  ExceptionInfo *exception)
{
  MagickBooleanType
    status;

  register ssize_t
    i;

  status=MagickTrue;
  for (i=0; primitive_info[i].primitive != UndefinedPrimitive; i++)
  {
    switch (primitive_info[i].primitive)
    {
      case ArcPrimitive:
        status=DrawArc(image,draw_info,primitive_info+i,exception);
        break;
      case BezierPrimitive:
        status=DrawBezier(image,draw_info,primitive_info+i,exception);
        break;
      case CirclePrimitive:
        status=DrawCircle(image,draw_info,primitive_info+i,exception);
        break;
      case EllipsePrimitive:
        status=DrawEllipse(image,draw_info,primitive_info+i,exception);
        break;
      case LinePrimitive:
        status=DrawLine(image,draw_info,primitive_info+i,exception);
        break;
      case RectanglePrimitive:
        status=DrawRectangle(image,draw_info,primitive_info+i,exception);
        break;
      case RoundRectanglePrimitive:
        status=DrawRoundRectangle(image,draw_info,primitive_info+i,exception);
        break;
      case SquareLinecapPrimitive:
        status=DrawSquareLinecap(image,draw_info,primitive_info+i,exception);
        break;
      case UndefinedPrimitive:
        break;
      default:
        ThrowPointExpectedException(primitive_info[i].primitive,exception);
        break;
    }
    if (status == MagickFalse)
      break;
  }
  return(status);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w S t r o k e T e x t                                               %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawStrokeText() draws text on the image with stroke color.
%
%  The format of the DrawStrokeText method is:
%
%      MagickBooleanType DrawStrokeText(Image *image,const DrawInfo *draw_info,
%        const char *text,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o text: the text to draw.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType DrawStrokeText(Image *image,
  const DrawInfo *draw_info,const char *text,ExceptionInfo *exception)
{
  MagickBooleanType
    status;

  DrawInfo
    *clone_info;

  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(draw_info != (const DrawInfo *) NULL);
  assert(text != (const char *) NULL);
  clone_info=CloneDrawInfo((ImageInfo *) NULL,draw_info);
  (void) CloneString(&clone_info->text,text);
  status=DrawImage(image,clone_info,exception);
  clone_info=DestroyDrawInfo(clone_info);
  return(status);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w T e x t                                                           %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawText() draws text on the image.
%
%  The format of the DrawText method is:
%
%      MagickBooleanType DrawText(Image *image,const DrawInfo *draw_info,
%        ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o draw_info: the draw info.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType DrawText(Image *image,const DrawInfo *draw_info,
  ExceptionInfo *exception)
{
  MagickBooleanType
    status;

  DrawInfo
    *clone_info;

  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);
  assert(draw_info != (const DrawInfo *) NULL);
  clone_info=CloneDrawInfo((ImageInfo *) NULL,draw_info);
  status=DrawImage(image,clone_info,exception);
  clone_info=DestroyDrawInfo(clone_info);
  return(status);
}

/*
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%                                                                             %
%                                                                             %
%   D r a w T r a n s f o r m I m a g e                                       %
%                                                                             %
%                                                                             %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  DrawTransformImage() composites the source over the destination image as
%  dictated by the transform.
%
%  The format of the DrawTransformImage method is:
%
%      MagickBooleanType DrawTransformImage(Image *image,const Image *source,
%        const TransformInfo *transform,ExceptionInfo *exception)
%
%  A description of each parameter follows:
%
%    o image: the image.
%
%    o source: the source image.
%
%    o transform: the transform.
%
%    o exception: return any errors or warnings in this structure.
%
*/
MagickExport MagickBooleanType DrawTransformImage(Image *image,
  const Image *source,const TransformInfo *transform,ExceptionInfo *exception)
{
  AffineMatrix
    affine;

  CacheView
    *image_view,
    *source_view;

  MagickBooleanType
    status;

  PointInfo
    extent[4],
    min,
    max;

  register ssize_t
    i;

  SegmentInfo
    edge;

  ssize_t
    start,
    stop,
    y;

  /*
    Determine bounding box.
  */
  assert(image != (Image *) NULL);
  assert(image->signature == MagickCoreSignature);
  if (image->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",image->filename);