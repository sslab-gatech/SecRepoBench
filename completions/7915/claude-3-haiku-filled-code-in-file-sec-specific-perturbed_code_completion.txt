// <MASK>
for (i=0; primitive_info[i].primitive != UndefinedPrimitive; i++)
{
  if ((x != (ssize_t) ceil(primitive_info[i].point.x-0.5)) ||
      (y != (ssize_t) ceil(primitive_info[i].point.y-0.5)))
    {
      offset=GetStopColorOffset(gradient,x,y);
      if (gradient->type != RadialGradient)
        offset*=PerceptibleReciprocal(length);
    }
  for (i=0; i < (ssize_t) gradient->number_stops; i++)
    if (offset < gradient->stops[i].offset)
      break;
  if ((offset < 0.0) || (i == 0))
    composite=gradient->stops[0].color;
  else
    if ((offset > 1.0) || (i == (ssize_t) gradient->number_stops))
      composite=gradient->stops[gradient->number_stops-1].color;
    else
      {
        j=i;
        i--;
        alpha=(offset-gradient->stops[i].offset)/
          (gradient->stops[j].offset-gradient->stops[i].offset);
        CompositePixelInfoBlend(&gradient->stops[i].color,1.0-alpha,
          &gradient->stops[j].color,alpha,&composite);
      }
}