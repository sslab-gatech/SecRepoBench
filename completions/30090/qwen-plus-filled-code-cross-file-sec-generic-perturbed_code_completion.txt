if (v->type != MSGPACK_OBJECT_STR) {
    flb_error("[parser] time_key value is not a string");
    msgpack_unpacked_destroy(&result);
    return -1;
}

len = v->via.str.size;
if (len == 0 || v->via.str.ptr == NULL) {
    flb_error("[parser] time_key value is empty or invalid");
    msgpack_unpacked_destroy(&result);
    return -1;
}

ret = flb_time_parse(v->via.str.ptr, len, parser->time_fmt,
                     &time_lookup, &tmfrac);
if (ret == -1) {
    flb_warn("[parser] failed to parse time_key with format '%s'",
             parser->time_fmt);
    time_lookup = 0;
    tmfrac = 0;
}