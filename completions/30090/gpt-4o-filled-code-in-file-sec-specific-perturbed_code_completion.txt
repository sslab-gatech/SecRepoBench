if (k != NULL && v != NULL && v->type == MSGPACK_OBJECT_STR) {
    struct tm tm = {0};
    char *time_str = (char *)v->via.str.ptr;
    size_t time_str_len = v->via.str.size;

    /* Ensure the time string is null-terminated */
    if (time_str_len < sizeof(tmp)) {
        memcpy(tmp, time_str, time_str_len);
        tmp[time_str_len] = '\0';

        /* Parse the time string */
        ret = flb_parser_time_lookup(tmp, parser->time_fmt, &tm, &tmfrac);
        if (ret == 0) {
            time_lookup = flb_parser_tm2time(&tm);
        }
        else {
            flb_warn("[parser] could not parse time string '%s'", tmp);
            time_lookup = 0;
        }
    }
    else {
        flb_warn("[parser] time string too long, skipping");
        time_lookup = 0;
    }
}
else {
    time_lookup = 0;
}