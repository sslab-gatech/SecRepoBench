if (skip != map_size) {
    /* We found the time_key (either removed from map or kept). Parse it. */
    if (v && v->type == MSGPACK_OBJECT_STR && v->via.str.ptr != NULL) {
        ret = flb_parser_time_lookup(v->via.str.ptr, v->via.str.size,
                                     0, parser, &tm, &tmfrac);
        if (ret == -1) {
            flb_warn("[parser:%s] invalid time format for '%.*s' (key='%s'), "
                     "setting timestamp to 0",
                     parser->name, (int) v->via.str.size, v->via.str.ptr, time_key);
            time_lookup = 0;
            tmfrac = 0;
        }
        else {
            time_lookup = flb_parser_tm2time(&tm);
        }
    }
    else {
        /* If the value is not a valid string, just set the timestamp to 0 */
        flb_warn("[parser:%s] unable to parse time key '%s', setting timestamp to 0",
                 parser->name, time_key);
        time_lookup = 0;
        tmfrac = 0;
    }
}
else {
    /* No time_key found in the map, set timestamp to 0 */
    time_lookup = 0;
    tmfrac = 0;
}