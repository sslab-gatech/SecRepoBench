if (k != NULL && v != NULL) {
        if (v->type == MSGPACK_OBJECT_STR) {
            len = v->via.str.size;
            if (len > sizeof(tmp) - 1) {
                len = sizeof(tmp) - 1;
            }

            /* Ensure the pointer we are about to read is not NULL */
            if (v->via.str.ptr == NULL) {
                flb_free(mp_buf);
                *out_buf = NULL;
                msgpack_unpacked_destroy(&result);
                return -1;
            }

            memcpy(tmp, v->via.str.ptr, len);
            tmp[len] = '\0';

            if (parser->time_fmt_len > 0) {
                if (strptime(tmp, parser->time_fmt, &tm) == NULL) {
                    flb_warn("[parser] invalid time format '%s', using zero",
                             tmp);
                    time_lookup = 0;
                }
                else {
#ifdef FLB_HAVE_GMTIME_R
                    time_lookup = mktime(&tm);
#else
                    time_lookup = mktime(&tm);
#endif
                }
            }
            else {
                /* binary mode */
                time_lookup = strtol(tmp, NULL, 10);
            }
        }
        else if (v->type == MSGPACK_OBJECT_POSITIVE_INTEGER) {
            time_lookup = v->via.u64;
        }
        else if (v->type == MSGPACK_OBJECT_NEGATIVE_INTEGER) {
            time_lookup = v->via.i64;
        }
        else if (v->type == MSGPACK_OBJECT_FLOAT) {
            time_lookup = (time_t) v->via.f64;
            tmfrac = v->via.f64 - time_lookup;
        }
        else {
            flb_warn("[parser] time field contains non string value, skip");
            time_lookup = 0;
        }
    }
    else {
        time_lookup = 0;
    }