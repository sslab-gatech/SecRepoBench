/* No time_key field found */
    if (skip == -1) {
        flb_free(mp_buf);
        *out_buf = NULL;
        msgpack_unpacked_destroy(&result);
        return -1;
    }

    /* Parse the time string */
    if (parser->time_fmt) {
        ret = strptime(mp_buf + off, parser->time_fmt, &tm);
        if (ret == NULL) {
            flb_warn("[flb_parser_json_do] failed to parse time string");
            time_lookup = 0;
        }
        else {
            time_lookup = mktime(&tm);
            tmfrac = difftime(time_lookup, mktime(&tm)) * 1000000000;
        }
    }
    else {
        flb_warn("[flb_parser_json_do] time format not specified");
        time_lookup = 0;
    }

    /* Compose a new map without the time_key field */
    msgpack_sbuffer_init(&mp_sbuf);
    msgpack_packer_init(&mp_pck, &mp_sbuf, msgpack_sbuffer_write);

    if (parser->time_keep == FLB_FALSE) {
        msgpack_pack_map(&mp_pck, map_size - 1);
    }
    else {
        msgpack_pack_map(&mp_pck, map_size);
    }

    for (index = 0; index < map_size; index++) {
        if (index == skip) {
            continue;
        }
        msgpack_pack_object(&mp_pck, map.via.map.ptr[index].key);
        msgpack_pack_object(&mp_pck, map.via.map.ptr[index].val);
    }