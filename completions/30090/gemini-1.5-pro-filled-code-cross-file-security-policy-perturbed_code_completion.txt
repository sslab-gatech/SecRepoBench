if (k != NULL && v != NULL) {
    if (v->type == MSGPACK_OBJECT_STR) {
        /* String value */
        if (flb_parser_time_lookup(parser->time_fmt, v->via.str.ptr,
                                 v->via.str.size, &tm, &tmfrac,
                                 &time_lookup) == -1) {
            flb_plg_warn(ctx->ins, "invalid time format %s, using current time",
                         v->via.str.ptr);
            time_lookup = time(NULL);
        }
    }
    else if (v->type == MSGPACK_OBJECT_POSITIVE_INTEGER) {
        time_lookup = v->via.u64;
    }
    else if (v->type == MSGPACK_OBJECT_FLOAT) {
        time_lookup = v->via.f64;
    }
    else {
        time_lookup = time(NULL);
    }
}
else {
    time_lookup = time(NULL);
}