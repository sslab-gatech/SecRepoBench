char username[256]; // Buffer to store the username
size_t username_len = 0; // Length of the username

// Search for "USER " in the payload
for (size_t k = 0; k < packet->payload_packet_len - 5; k++) {
  if (memcmp(&packet->payload[k], "USER ", 5) == 0) {
    // Extract the username following "USER "
    size_t l = k + 5;
    while (l < packet->payload_packet_len && packet->payload[l] != ' ' && packet->payload[l] != '\n' && username_len < sizeof(username) - 1) {
      username[username_len++] = packet->payload[l++];
    }
    username[username_len] = '\0'; // Null-terminate the username
    NDPI_LOG_INFO(detection_module, "found IRC username: %s", username);
    break;
  }
}

flow->risk |= NDPI_RISK_CREDENTIALS_LEAKED;
NDPI_LOG_INFO(detection_module, "found IRC: USER, NICK, PASS, NOTICE, PRIVMSG at least once");