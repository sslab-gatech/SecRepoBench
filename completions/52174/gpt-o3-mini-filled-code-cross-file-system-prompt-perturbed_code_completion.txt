{
  char irc_username[64];
  u_int16_t username_len = 0;
  const char *user_start = NULL;
  const char *username_end = NULL;

  memset(irc_username, 0, sizeof(irc_username));
  user_start = strstr((const char *)packet->payload, "USER ");
  if(user_start != NULL) {
    user_start += 5; // skip "USER "
    /* Look for the end of the username: a space or line break */
    username_end = memchr(user_start, ' ', packet->payload_packet_len - (user_start - (const char *)packet->payload));
    if(username_end == NULL) {
      username_end = memchr(user_start, '\n', packet->payload_packet_len - (user_start - (const char *)packet->payload));
    }
    if(username_end != NULL) {
      username_len = username_end - user_start;
    } else {
      username_len = packet->payload_packet_len - (user_start - (const char *)packet->payload);
    }
    if(username_len >= sizeof(irc_username))
      username_len = sizeof(irc_username) - 1;
    memcpy(irc_username, user_start, username_len);
    irc_username[username_len] = '\0';  // null-terminate the username

    NDPI_LOG_INFO(detection_module, "Found IRC username: %s", irc_username);
    /* Set the risk level indicating clear text credentials detected.
       Assuming NDPI_RISK_LEVEL_CLEARTEXT_CREDENTIALS is defined appropriately. */
    flow->risk_level = NDPI_RISK_LEVEL_CLEARTEXT_CREDENTIALS;
    NDPI_LOG_INFO(detection_module,
                  "IRC keywords (USER, NICK, PASS, NOTICE, PRIVMSG) identified at least once");
  }
}