// Extract the username following the "USER " keyword and store it in a buffer
char username[256] = {0}; // Buffer to store the username, ensure it's large enough
const char *user_start = (const char *)packet->payload + 5; // Skip "USER "
size_t user_len = 0;

// Find the end of the username (terminated by space or end of payload)
while (user_len < sizeof(username) - 1 && 
       (user_start[user_len] != ' ' && user_start[user_len] != '\0' && 
        user_start[user_len] != '\r' && user_start[user_len] != '\n') &&
       (user_start - (const char *)packet->payload + user_len < packet->payload_packet_len)) {
  username[user_len] = user_start[user_len];
  user_len++;
}
username[user_len] = '\0'; // Null-terminate the username

// Log a message indicating that an IRC username has been found
if (user_len > 0) {
  NDPI_LOG_INFO(detection_module, "IRC username found: %s", username);
}

// Set the risk level for the flow to indicate that clear text credentials have been detected
flow->risk |= NDPI_CLEAR_TEXT_CREDENTIALS_RISK;

// Log that IRC-related keywords like USER, NICK, PASS, NOTICE, and PRIVMSG were identified at least once
NDPI_LOG_INFO(detection_module, "IRC-related keywords detected in the payload.");