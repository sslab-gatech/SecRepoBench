u_int8_t *username = NULL;
size_t username_len = 0;

// Calculate the length of the username following "USER "
if (packet->payload_packet_len > 5 && memcmp(packet->payload, "USER ", 5) == 0) {
    username_len = packet->payload_packet_len - 5;

    // Allocate memory for the username buffer with a null terminator
    username = malloc(username_len + 1);
    if (username == NULL) {
        NDPI_LOG_ERROR(detection_module, "Memory allocation failed for username.");
        return;
    }

    // Copy the username into the allocated buffer and ensure it is null-terminated
    memcpy(username, packet->payload + 5, username_len);
    username[username_len] = '\0';

    NDPI_LOG_INFO(detection_module, "Found IRC username: %s", username);

    // Set the risk level for clear text credentials detection
    ndpi_set_risk(ndpi_struct, flow, NDPI_CLEAR_TEXT_CREDENTIALS);

    // Log that IRC-related keywords like USER, NICK, PASS, NOTICE, and PRIVMSG were identified at least once
    NDPI_LOG_INFO(detection_module, "IRC-related keyword detected: USER");

    free(username); // Free the allocated memory after use
}