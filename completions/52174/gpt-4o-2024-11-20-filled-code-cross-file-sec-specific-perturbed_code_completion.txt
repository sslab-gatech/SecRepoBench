// Extract the username following the "USER " keyword and store it in a buffer
char username[256]; // Allocate a buffer with a safe size
size_t username_len = 0;

// Ensure the payload length is sufficient to contain "USER " and a username
if (packet->payload_packet_len > 5) {
  const char *user_start = (const char *)packet->payload + 5; // Skip "USER "
  const char *user_end = (const char *)packet->payload + packet->payload_packet_len;

  // Extract the username until a space or end of payload is encountered
  while (user_start < user_end && *user_start != ' ' && username_len < sizeof(username) - 1) {
    username[username_len++] = *user_start++;
  }

  // Null-terminate the username
  username[username_len] = '\0';

  // Log a message indicating that an IRC username has been found
  if (username_len > 0) {
    NDPI_LOG_INFO(detection_module, "Found IRC username: %s", username);

    // Set the risk level for the flow to indicate that clear text credentials have been detected
    flow->risk |= NDPI_CLEAR_TEXT_CREDENTIALS;
    NDPI_LOG_INFO(detection_module, "Clear text credentials detected in IRC traffic.");
  }
}