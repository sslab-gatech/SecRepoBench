{
  const char *user_keyword = "USER ";
  const char *nick_keyword = "NICK ";
  const char *pass_keyword = "PASS ";
  const char *notice_keyword = "NOTICE ";
  const char *privmsg_keyword = "PRIVMSG ";
  int payload_len = packet->payload_packet_len;

  /* Log that we're seeing at least one IRC-related keyword if any matches. */
  if ((payload_len >= 5 && (memcmp(packet->payload, user_keyword, 5) == 0 ||
                            memcmp(packet->payload, nick_keyword, 5) == 0 ||
                            memcmp(packet->payload, pass_keyword, 5) == 0)) ||
      (payload_len >= 7 && memcmp(packet->payload, notice_keyword, 7) == 0) ||
      (payload_len >= 8 && memcmp(packet->payload, privmsg_keyword, 8) == 0)) {
    NDPI_LOG_INFO(detection_module,
                  "Detected at least one IRC keyword (USER, NICK, PASS, NOTICE, PRIVMSG).");
  }

  /* Search for "USER " and extract username. */
  if (payload_len >= 5 && memcmp(packet->payload, user_keyword, 5) == 0) {
    int start = 5;
    /* Skip any extra spaces after "USER ". */
    while (start < payload_len && packet->payload[start] == ' ') {
      start++;
    }

    /* Copy username until space, CR, or LF. */
    {
      int end = start;
      while (end < payload_len &&
             packet->payload[end] != ' ' &&
             packet->payload[end] != '\r' &&
             packet->payload[end] != '\n') {
        end++;
      }
      int user_len = end - start;

      if (user_len > 0) {
        char username[128];
        if (user_len >= (int)sizeof(username)) {
          user_len = (int)sizeof(username) - 1;
        }
        memcpy(username, &packet->payload[start], user_len);
        username[user_len] = '\0';

        NDPI_LOG_INFO(detection_module, "Found IRC username: %s", username);

        /* Indicate clear text credentials risk (implementation-specific). */
        flow->risk |= 0x01; /* Example bitmask or risk flag */
      }
    }
  }
}