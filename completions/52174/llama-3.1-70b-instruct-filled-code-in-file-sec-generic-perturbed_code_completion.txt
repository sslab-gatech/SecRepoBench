// Search for the "USER " string within the packet payload to identify potential IRC usernames.
// Extract the username following the "USER " keyword and store it in a buffer.
// Null-terminate the username.
// Log a message indicating that an IRC username has been found.
// Set the risk level for the flow to indicate that clear text credentials have been detected.
// Log that IRC-related keywords like USER, NICK, PASS, NOTICE, and PRIVMSG were identified at least once.

u_int8_t username_found = 0;
u_int8_t keyword_found = 0;
u_int16_t username_len = 0;
u_int8_t username[256];

if (memcmp(packet->payload, "USER ", 5) == 0) {
  username_found = 1;
  username_len = packet->payload_packet_len - 5;
  if (username_len > 255) {
    username_len = 255;
  }
  memcpy(username, packet->payload + 5, username_len);
  username[username_len] = '\0';
  NDPI_LOG_INFO(detection_module, "found IRC username: %s", username);
  flow->risk_level += 1;
}

if (memcmp(packet->payload, "NICK ", 5) == 0
    || memcmp(packet->payload, "PASS ", 5) == 0
    || memcmp(packet->payload, "NOTICE ", 7) == 0
    || memcmp(packet->payload, "PRIVMSG ", 8) == 0) {
  keyword_found = 1;
}

if (username_found || keyword_found) {
  NDPI_LOG_INFO(detection_module, "found IRC-related keywords");
}