char username[256]; // Buffer to store the username
size_t username_len = 0; // Length of the username

// Search for "USER " in the payload
for (i = 0; i < packet->payload_packet_len - 5; i++) {
  if (memcmp(&packet->payload[i], "USER ", 5) == 0) {
    // Extract the username
    i += 5; // Move past "USER "
    while (i < packet->payload_packet_len && packet->payload[i] != ' ' && username_len < sizeof(username) - 1) {
      username[username_len++] = packet->payload[i++];
    }
    username[username_len] = '\0'; // Null-terminate the username
    NDPI_LOG_INFO(detection_module, "found IRC username: %s", username);
    ndpi_set_risk(flow, NDPI_SECURITY_MALWARE, NDPI_SECURITY_CREDENTIALS_LEAK);
    break;
  }
}