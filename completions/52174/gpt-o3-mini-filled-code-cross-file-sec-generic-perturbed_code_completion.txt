{
  #define MAX_USER_LEN 64
  char username[MAX_USER_LEN];
  size_t offset = 5; /* skip "USER " */
  size_t username_len = 0;
  /* Ensure buffer is zeroed to prevent leakage of uninitialized data */
  memset(username, 0, sizeof(username));
  while(offset < packet->payload_packet_len && username_len < (sizeof(username) - 1)) {
    char ch = packet->payload[offset];
    if(ch == ' ' || ch == '\r' || ch == '\n')
      break;
    username[username_len++] = ch;
    offset++;
  }
  username[username_len] = '\0';
  NDPI_LOG_INFO(detection_module, "Detected IRC username: %s", username);
  /* Set the risk level to indicate clear text credentials have been detected.
     This assumes flow->risk_level is defined appropriately (e.g. NDPI_RISK_HIGH) */
  flow->risk_level = NDPI_RISK_HIGH;
  NDPI_LOG_INFO(detection_module, "IRC keywords detected: USER, NICK, PASS, NOTICE, PRIVMSG");
}