char username[256]; // Buffer to store the username
size_t username_len = 0;

// Check if the payload contains "USER " and extract the username
if (memcmp(packet->payload, "USER ", 5) == 0) {
  const char *user_start = packet->payload + 5;
  const char *user_end = memchr(user_start, ' ', packet->payload_packet_len - 5);
  if (user_end != NULL) {
    username_len = user_end - user_start;
    if (username_len < sizeof(username)) {
      memcpy(username, user_start, username_len);
      username[username_len] = '\0'; // Null-terminate the username
      NDPI_LOG_INFO(detection_module, "IRC username found: %s", username);
      flow->risk |= NDPI_RISK_CREDENTIALS_LEAKED;
    }
  }
}

NDPI_LOG_INFO(detection_module, "IRC-related keywords identified.");
flow->l4.tcp.irc_stage = 1;