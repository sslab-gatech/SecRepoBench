// Search for the "USER " string within the packet payload to identify potential IRC usernames.
// Extract the username following the "USER " keyword and store it in a buffer.
// Null-terminate the username.
// Log a message indicating that an IRC username has been found.
// Set the risk level for the flow to indicate that clear text credentials have been detected.
// Log that IRC-related keywords like USER, NICK, PASS, NOTICE, and PRIVMSG were identified at least once.

u_int16_t username_len = 0;
u_int8_t username[256];

if (memcmp(packet->payload, "USER ", 5) == 0) {
  username_len = packet->payload_packet_len - 5;
  if (username_len > 255) {
    username_len = 255;
  }
  // Use snprintf to prevent buffer overflow
  snprintf((char *)username, username_len + 1, "%s", packet->payload + 5);
  username[username_len] = '\0'; // Null-terminate the username
  NDPI_LOG_INFO(detection_module, "found IRC username: %s", username);
  flow->risk_level = NDPI_RISK_CLEAR_TEXT_CREDENTIALS;
}

NDPI_LOG_INFO(detection_module, "found IRC-related keywords: USER, NICK, PASS, NOTICE, PRIVMSG");