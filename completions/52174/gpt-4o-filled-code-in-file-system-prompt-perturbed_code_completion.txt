char username[256];
char *user_start = (char *)memmem(packet->payload, packet->payload_packet_len, "USER ", 5);
if(user_start != NULL) {
  user_start += 5; // Move past "USER "
  char *user_end = (char *)memchr(user_start, ' ', packet->payload_packet_len - (user_start - (char *)packet->payload));
  if(user_end != NULL) {
    size_t user_len = user_end - user_start;
    if(user_len < sizeof(username)) {
      memcpy(username, user_start, user_len);
      username[user_len] = '\0';
      NDPI_LOG_INFO(detection_module, "found IRC username: %s", username);
      flow->risk |= NDPI_FLOW_RISK_CREDENTIALS_LEAKED;
    }
  }
}
NDPI_LOG_INFO(detection_module, "found IRC: USER, NICK, PASS, NOTICE, PRIVMSG at least once");