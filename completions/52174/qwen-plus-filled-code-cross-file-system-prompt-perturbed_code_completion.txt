u_int8_t username_found = 0;
u_int16_t username_len = 0;
u_int8_t username_buffer[256] = {0};

// Search for the "USER " string within the packet payload to identify potential IRC usernames.
if (memcmp(packet->payload, "USER ", 5) == 0) {
  // Extract the username following the "USER " keyword and store it in a buffer.
  username_len = packet->payload_packet_len - 5; // Subtract the length of "USER " keyword
  if (username_len > 0 && username_len < sizeof(username_buffer)) {
    memcpy(username_buffer, &packet->payload[5], username_len);
    username_buffer[username_len] = '\0'; // Null-terminate the username.

    NDPI_LOG_INFO(detection_module, "IRC username found: %s", username_buffer);

    // Set the risk level for the flow to indicate that clear text credentials have been detected.
    ndpi_set_risk(ndpi_struct, flow, NDPI_CLEAR_TEXT_CREDENTIALS);

    // Log that IRC-related keywords like USER, NICK, PASS, NOTICE, and PRIVMSG were identified at least once.
    NDPI_LOG_INFO(detection_module, "IRC-related keyword detected: USER");

    username_found = 1;
  }
}

// If a username was found, proceed with further checks.
if (username_found || memcmp(packet->payload, "NICK ", 5) == 0 ||
    memcmp(packet->payload, "PASS ", 5) == 0 ||
    (memcmp(packet->payload, ":", 1) == 0 && ndpi_check_for_NOTICE_or_PRIVMSG(detection_module, flow) != 0) ||
    memcmp(packet->payload, "PONG ", 5) == 0 ||
    memcmp(packet->payload, "PING ", 5) == 0 ||
    memcmp(packet->payload, "JOIN ", 5) == 0 ||
    memcmp(packet->payload, "MODE ", 5) == 0 ||
    memcmp(packet->payload, "NOTICE ", 7) == 0 ||
    memcmp(packet->payload, "PRIVMSG ", 8) == 0 ||
    memcmp(packet->payload, "VERSION ", 8) == 0) {
  NDPI_LOG_INFO(detection_module, "IRC-related keyword detected.");
}