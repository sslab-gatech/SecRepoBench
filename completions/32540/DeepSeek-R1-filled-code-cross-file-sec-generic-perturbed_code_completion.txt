if (indexlookup >= done_lookups_glyph_set->length)
{
  unsigned int old_length = done_lookups_glyph_set->length;
  if (!done_lookups_glyph_set->resize(indexlookup + 1))
    return true;
  for (unsigned int i = old_length; i < done_lookups_glyph_set->length; i++)
  {
    done_lookups_glyph_set->arrayZ[i] = hb_set_create();
    if (!done_lookups_glyph_set->arrayZ[i])
      return true;
  }
}

hb_set_t* lookup_glyph_set = done_lookups_glyph_set->arrayZ[indexlookup];
if (hb_set_is_subset(parent_active_glyphs(), lookup_glyph_set))
  return true;

hb_set_union(lookup_glyph_set, parent_active_glyphs());