if (indexlookup >= done_lookups_glyph_count->length)
{
  if (!done_lookups_glyph_count->resize(indexlookup + 1) ||
      !done_lookups_glyph_set->resize(indexlookup + 1))
    return true;
}

hb_set_t*& current_set = done_lookups_glyph_set->arrayZ[indexlookup];
if (!current_set)
{
  current_set = hb_set_create();
  if (current_set->in_error())
  {
    hb_set_destroy(current_set);
    current_set = nullptr;
    done_lookups_glyph_set->in_error();
    return true;
  }
}

hb_set_t* parent_glyphs = parent_active_glyphs();
if (hb_set_is_subset(parent_glyphs, current_set))
  return true;

hb_set_union(current_set, parent_glyphs);