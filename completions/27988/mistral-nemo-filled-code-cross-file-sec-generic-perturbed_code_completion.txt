if(networkflow->l4_proto == IPPROTO_TCP) {
    if(networkflow->l4.tcp.tls.message.buffer) {
      ndpi_free(networkflow->l4.tcp.tls.message.buffer);
      networkflow->l4.tcp.tls.message.buffer = NULL;
      networkflow->l4.tcp.tls.message.buffer_used = 0;
    }
  } else if(networkflow->l4_proto == IPPROTO_UDP) {
    if(ndpi_search_tls_udp(ndpi_struct, flow)) {
      ndpi_int_tls_add_connection(ndpi_struct, flow, NDPI_PROTOCOL_TLS);
    }
  }

  if(networkflow->l4_proto == IPPROTO_TCP && ndpi_search_tls_tcp(ndpi_struct, flow)) {
    ndpi_int_tls_add_connection(ndpi_struct, flow, NDPI_PROTOCOL_TLS);
  }