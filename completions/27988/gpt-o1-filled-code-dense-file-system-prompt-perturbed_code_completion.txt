if(networkflow->detected_protocol_stack[0] == NDPI_PROTOCOL_HTTP) {
  /* Free memory allocated for HTTP related fields */
  if(networkflow->protos.http.url) {
    ndpi_free(networkflow->protos.http.url);
    networkflow->protos.http.url = NULL;
  }

  if(networkflow->protos.http.host) {
    ndpi_free(networkflow->protos.http.host);
    networkflow->protos.http.host = NULL;
  }

  if(networkflow->protos.http.user_agent) {
    ndpi_free(networkflow->protos.http.user_agent);
    networkflow->protos.http.user_agent = NULL;
  }
}

if(networkflow->detected_protocol_stack[0] == NDPI_PROTOCOL_SSL ||
   networkflow->detected_protocol_stack[0] == NDPI_PROTOCOL_QUIC) {
  /* Free memory allocated for TLS/SSL or QUIC related fields */
  if(networkflow->l4_proto == IPPROTO_TCP) {
    if(networkflow->l4.tcp.tls.server_names) {
      ndpi_free(networkflow->l4.tcp.tls.server_names);
      networkflow->l4.tcp.tls.server_names = NULL;
    }

    if(networkflow->l4.tcp.tls.tls_alpn) {
      ndpi_free(networkflow->l4.tcp.tls.tls_alpn);
      networkflow->l4.tcp.tls.tls_alpn = NULL;
    }

    if(networkflow->l4.tcp.tls.tls_supported_versions) {
      ndpi_free(networkflow->l4.tcp.tls.tls_supported_versions);
      networkflow->l4.tcp.tls.tls_supported_versions = NULL;
    }

    if(networkflow->l4.tcp.tls.tls_issuerDN) {
      ndpi_free(networkflow->l4.tcp.tls.tls_issuerDN);
      networkflow->l4.tcp.tls.tls_issuerDN = NULL;
    }

    if(networkflow->l4.tcp.tls.tls_subjectDN) {
      ndpi_free(networkflow->l4.tcp.tls.tls_subjectDN);
      networkflow->l4.tcp.tls.tls_subjectDN = NULL;
    }

    if(networkflow->l4.tcp.tls.encrypted_sni.esni) {
      ndpi_free(networkflow->l4.tcp.tls.encrypted_sni.esni);
      networkflow->l4.tcp.tls.encrypted_sni.esni = NULL;
    }
  }
  /* If QUIC is handled via IPPROTO_UDP, free any analogous fields there */
}