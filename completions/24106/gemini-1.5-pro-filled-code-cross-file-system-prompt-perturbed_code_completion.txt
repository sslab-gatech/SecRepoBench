mvg_class = graphic_context[graphiccontextindex]->id;
if (mvg_class != (char *) NULL) {
  if (LocaleCompare(mvg_class, token) == 0)
    break;
}

mvg_class = (const char *) GetValueFromSplayTree(macros, token);
if (mvg_class != (const char *) NULL) {
  char *elements = AcquireString(mvg_class);
  const char *remaining_content = q;

  size_t elements_length = strlen(elements);
  size_t remaining_length = strlen(remaining_content);

  char *new_primitive = (char *) AcquireQuantumMemory(elements_length + remaining_length + 1, sizeof(char));
  if (new_primitive == (char *) NULL) {
    elements=DestroyString(elements);
    ThrowBinaryException(ResourceLimitError, "MemoryAllocationFailed", image->filename);
  }

  strcpy(new_primitive, elements);
  strcat(new_primitive, remaining_content);

  primitive=DestroyString(primitive);
  primitive = new_primitive;
  q = primitive + elements_length;

  elements=DestroyString(elements);
}