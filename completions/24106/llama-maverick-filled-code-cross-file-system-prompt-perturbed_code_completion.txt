mvg_class=(const char *) GetValueFromSplayTree(macros,token);
if (mvg_class != (const char *) NULL)
  {
    char
      *elements;

    size_t
      mvg_length,
      original_length,
      total_length;

    (void) GetNextToken(q,&q,extent,token);
    original_length=strlen(primitive);
    mvg_length=strlen(mvg_class);
    total_length=original_length+mvg_length+MagickPathExtent;
    elements=(char *) AcquireQuantumMemory(total_length,sizeof(*elements));
    if (elements == (char *) NULL)
      {
        (void) ThrowMagickException(exception,GetMagickModule(),
          ResourceLimitError,"MemoryAllocationFailed","`%s'",image->filename);
        status=MagickFalse;
        break;
      }
    (void) CopyMagickString(elements,mvg_class,total_length);
    (void) ConcatenateMagickString(elements,q-strlen(keyword)-1,total_length);
    primitive=(char *) RelinquishMagickMemory(primitive);
    primitive=elements;
    q=primitive+original_length+mvg_length;
  }