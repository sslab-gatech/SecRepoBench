const char *mvg_class;

// Check if the current token matches the graphic context ID, break if true.
if (LocaleCompare(token, graphic_context[graphiccontextindex]->id) == 0)
    break;

// Retrieve the MVG class definition from the macros using the token.
mvg_class = (const char *) GetValueFromSplayTree(macros, token);
if (mvg_class != (const char *) NULL)
{
    // If the class definition is found,
    // inject the class elements into the stream.
    // Concatenate the MVG class to the elements string, followed by the remaining content.
    // Free the previous primitive string and update it with the new elements.
    // Adjust the stream pointer to the new position in the modified primitive.
    char *new_primitive = AcquireString(mvg_class);
    strcat(new_primitive, q);
    primitive = DestroyString(primitive);
    primitive = new_primitive;
    q = primitive;
}