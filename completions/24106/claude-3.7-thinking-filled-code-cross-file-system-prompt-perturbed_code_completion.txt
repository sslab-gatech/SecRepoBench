if (LocaleCompare(token, graphic_context[graphiccontextindex]->id) == 0)
  break;
mvg_class = (const char *) GetValueFromSplayTree(macros, token);
if (mvg_class != (const char *) NULL)
{
  size_t 
    length;
  
  char
    *elements;
  
  length = (q-p)+strlen(mvg_class)+strlen(q)+1;
  elements = (char *) AcquireQuantumMemory(length, sizeof(*elements));
  if (elements == (char *) NULL)
    ThrowFatalException(ResourceLimitFatalError, "MemoryAllocationFailed");
  
  (void) CopyMagickString(elements, primitive, p-primitive+1);
  (void) ConcatenateMagickString(elements, mvg_class, length);
  (void) ConcatenateMagickString(elements, q, length);
  
  primitive = DestroyString(primitive);
  primitive = elements;
  q = primitive+(q-p)+strlen(mvg_class);
  p = q;
}