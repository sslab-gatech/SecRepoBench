{
  /* Check if the current token matches the graphic context ID, break if true. */
  if ((graphic_context[graphiccontextindex]->id != (char *) NULL) &&
      (LocaleCompare(graphic_context[graphiccontextindex]->id, token) == 0))
    break;

  /* Retrieve the MVG class definition from the macros using the token. */
  mvg_class = (const char *) GetValueFromSplayTree(macros, token);
  if (mvg_class != (const char *) NULL)
    {
      /* Inject the class elements into the stream, concatenating with the remainder. */
      size_t new_length = strlen(mvg_class) + strlen(q) + MagickPathExtent;
      char *revised_primitive = (char *) AcquireQuantumMemory(new_length, sizeof(*revised_primitive));
      if (revised_primitive == (char *) NULL)
        {
          status = MagickFalse;
          break;
        }
      (void) CopyMagickString(revised_primitive, mvg_class, new_length);
      (void) ConcatenateString(revised_primitive, q);

      /* Free the previous primitive string and update it with the new elements. */
      primitive = DestroyString(primitive);
      primitive = revised_primitive;

      /* Adjust the stream pointer to the new position in the modified primitive. */
      q = primitive;
    }
}