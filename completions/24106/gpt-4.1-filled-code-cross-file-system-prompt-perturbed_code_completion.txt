mvg_class=(const char *) GetValueFromSplayTree(macros,token);
if (mvg_class != (const char *) NULL)
  {
    size_t
      elements_length,
      primitive_length,
      remaining_length;

    char
      *elements;

    primitive_length=strlen(primitive);
    elements_length=strlen(mvg_class);
    remaining_length=primitive_length-(q-primitive);
    elements=(char *) AcquireQuantumMemory(elements_length+remaining_length+2,
      sizeof(*elements));
    if (elements == (char *) NULL)
      {
        primitive=DestroyString(primitive);
        ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
          image->filename);
      }
    (void) CopyMagickString(elements,mvg_class,elements_length+1);
    (void) CopyMagickString(elements+elements_length,q,remaining_length+1);
    primitive=DestroyString(primitive);
    primitive=elements;
    q=primitive+elements_length;
  }