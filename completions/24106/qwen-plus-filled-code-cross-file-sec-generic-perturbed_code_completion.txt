const char
  *mvg_class;

mvg_class = (const char *) GetValueFromSplayTree(macros, token);
if (mvg_class != (const char *) NULL && LocaleCompare(graphic_context[graphiccontextindex]->id, token) == 0)
{
    break; // Skip further processing if the current token matches the graphic context ID.
}

// Retrieve the MVG class definition from the macros using the token.
mvg_class = (const char *) GetValueFromSplayTree(macros, token);

if (mvg_class != (const char *) NULL)
{
    size_t len = strlen(mvg_class) + strlen(primitive) + 2;
    char *new_primitive = AcquireString((char *) NULL);
    new_primitive = (char *) ResizeQuantumMemory(new_primitive, len, sizeof(*new_primitive));
    if (new_primitive == (char *) NULL)
    {
        ThrowFatalException(ResourceLimitFatalError, "MemoryAllocationFailed");
    }

    (void) CopyMagickString(new_primitive, mvg_class, len);
    (void) ConcatenateMagickString(new_primitive, primitive, len);

    // Free the previous primitive string and update it with the new elements.
    primitive = DestroyString(primitive);
    primitive = new_primitive;

    // Adjust the stream pointer to the new position in the modified primitive.
    q = primitive;
}