mvg_class=GetValueFromSplayTree(macros,token);
            if (mvg_class == (const char *) NULL)
              {
                status=MagickFalse;
                break;
              }
            /*
              Inject the class elements into the stream.
            */
            primitive=ConcatenateString(primitive,mvg_class);
            if (primitive == (char *) NULL)
              {
                status=MagickFalse;
                break;
              }
            /*
              Concatenate the MVG class to the elements string, followed by the
              remaining content.
            */
            for (p=q; *q != '\0'; )
            {
              if (GetNextToken(q,&q,extent,token) < 1)
                break;
              if (LocaleCompare(token,"pop") != 0)
                continue;
              (void) GetNextToken(q,(const char **) NULL,extent,token);
              if (LocaleCompare(token,"class") != 0)
                continue;
              break;
            }
            if ((q == (char *) NULL) || (p == (char *) NULL) || ((q-4) < p))
              {
                status=MagickFalse;
                break;
              }
            primitive=ConcatenateString(primitive,p);
            if (primitive == (char *) NULL)
              {
                status=MagickFalse;
                break;
              }
            primitive=ConcatenateString(primitive,q);
            if (primitive == (char *) NULL)
              {
                status=MagickFalse;
                break;
              }
            /*
              Free the previous primitive string and update it with the new
              elements.
            */
            token=DestroyString(token);
            token=AcquireString(primitive);
            if (token == (char *) NULL)
              {
                status=MagickFalse;
                break;
              }
            extent=strlen(token)+MagickPathExtent;
            /*
              Adjust the stream pointer to the new position in the modified
              primitive.
            */
            q=token;
            break;
          }