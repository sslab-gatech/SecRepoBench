if (LocaleCompare(graphic_context[graphiccontextindex]->id, token) == 0) {
  break;
}

mvg_class = (const char *)GetValueFromSplayTree(macros, token);
if (mvg_class != (const char *)NULL) {
  char *elements = AcquireString(mvg_class);
  size_t len = strlen(elements);

  if (len > 0) {
    char *new_primitive = (char *)AcquireQuantumMemory(primitive_extent + len + 1, sizeof(char));
    if (new_primitive == (char *)NULL) {
      elements = DestroyString(elements);
      ThrowBinaryException(ResourceLimitError, "MemoryAllocationFailed", image->filename);
    }

    strcpy(new_primitive, elements);
    strcpy(new_primitive + len, q);

    elements=DestroyString(elements);
    primitive = DestroyString(primitive);
    primitive = new_primitive;
    primitive_extent = strlen(primitive);
    q = primitive;
  } else {
    elements=DestroyString(elements);
  }

}