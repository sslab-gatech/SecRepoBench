if (graphic_context[graphiccontextindex]->id != (char *) NULL &&
                LocaleCompare(token, graphic_context[graphiccontextindex]->id) == 0)
                break;
            mvg_class = (const char *) GetValueFromSplayTree(macros, token);
            if (mvg_class != (const char *) NULL)
            {
                char
                    *elements;

                const size_t
                    part_before_len = (size_t)(p - primitive),
                    class_len = strlen(mvg_class),
                    remaining_len = strlen(q);

                elements = (char *) AcquireQuantumMemory(part_before_len + class_len + remaining_len + 1, sizeof(*elements));
                if (elements == (char *) NULL)
                {
                    status = MagickFalse;
                    break;
                }
                (void) memcpy(elements, primitive, part_before_len);
                (void) memcpy(elements + part_before_len, mvg_class, class_len);
                (void) memcpy(elements + part_before_len + class_len, q, remaining_len + 1);
                primitive = DestroyString(primitive);
                primitive = elements;
                q = primitive + part_before_len + class_len;
            }