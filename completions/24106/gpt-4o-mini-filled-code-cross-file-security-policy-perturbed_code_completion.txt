mvg_class=GetValueFromSplayTree(macros,token);
            if (mvg_class != (const char *) NULL)
              {
                size_t new_length = strlen(mvg_class) + strlen(primitive) + 1; // +1 for null terminator
                char *new_primitive = (char *) AcquireQuantumMemory(new_length, sizeof(char));
                if (new_primitive == (char *) NULL)
                  {
                    status=MagickFalse;
                    break;
                  }
                // Check if p is within bounds of primitive
                if (p >= primitive && p < primitive + strlen(primitive))
                  {
                    snprintf(new_primitive, new_length, "%s%s", mvg_class, p);
                    DestroyString(primitive);
                    primitive = new_primitive;
                    q = primitive; // Update q to point to the new primitive
                  }
                else
                  {
                    DestroyString(new_primitive);
                    status=MagickFalse;
                    break;
                  }
              }