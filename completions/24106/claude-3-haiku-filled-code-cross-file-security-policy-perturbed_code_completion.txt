// Check if the current token matches the graphic context ID, break if true.
if (LocaleCompare(token, graphic_context[graphiccontextindex]->id) == 0)
    break;

// Retrieve the MVG class definition from the macros using the token.
const char *mvg_class = (const char *) GetValueFromSplayTree(macros, token);
if (mvg_class != (const char *) NULL)
{
    // If the class definition is found, inject the class elements into the stream.
    clone_info = CloneDrawInfo((ImageInfo *) NULL, graphic_context[graphiccontextindex]);
    (void) CloneString(&clone_info->primitive, mvg_class);
    status = RenderMVGContent(image, clone_info, depth + 1, exception);
    clone_info = DestroyDrawInfo(clone_info);

    // Concatenate the MVG class to the elements string, followed by the remaining content.
    char *new_primitive = AcquireString(mvg_class);
    (void) ConcatenateString(&new_primitive, q);
    primitive = DestroyString(primitive);
    primitive = new_primitive;

    // Adjust the stream pointer to the new position in the modified primitive.
    q = primitive;
}