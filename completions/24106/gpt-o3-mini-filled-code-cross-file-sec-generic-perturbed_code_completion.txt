if (graphic_context[graphiccontextindex]->id != (char *) NULL &&
    LocaleCompare(graphic_context[graphiccontextindex]->id, token) == 0)
  break;
mvg_class = (const char *) GetValueFromSplayTree(macros, token);
if (mvg_class != (const char *) NULL)
{
  size_t class_length, remaining_length, new_length;
  char *new_primitive;

  class_length = strlen(mvg_class);
  remaining_length = strlen(q);
  new_length = class_length + remaining_length + 1;
  new_primitive = (char *) AcquireQuantumMemory(new_length, sizeof(*new_primitive));
  if (new_primitive == (char *) NULL)
  {
    ThrowBinaryException(ResourceLimitError, "MemoryAllocationFailed", image->filename);
    status = MagickFalse;
    break;
  }
  (void) CopyMagickString(new_primitive, mvg_class, new_length);
  (void) ConcatenateMagickString(new_primitive, q, new_length);
  primitive = DestroyString(primitive);
  primitive = AcquireString(new_primitive);
  new_primitive = DestroyString(new_primitive);
  q = primitive;
}