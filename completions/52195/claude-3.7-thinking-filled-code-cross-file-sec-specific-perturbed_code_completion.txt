// Handle simplified triple letter checking
if (checkcompoundtriple && !checkedstriple && (i > 1) && (i < word.size()) &&
    (word[i - 1] == word[i]) && ((word[i - 2] == word[i]) || (i + 1 < word.size() && word[i + 1] == word[i]))) {
  striple = 1;
  
  // Adjust the index to re-evaluate
  i--;
  
  // Safety check to avoid out-of-bounds access
  if (i < st.size()) {
    ch = st[i];
    st[i] = '\0';
  }
}

// Perform a lookup for the current substring
rv = lookup(st.c_str(), i);

// Iterate over homonyms to find matching compound conditions
if (rv && (rv->astr)) {
  while (rv &&
        !((compoundflag && TESTAFF(rv->astr, compoundflag, rv->alen)) ||
          (compoundend && TESTAFF(rv->astr, compoundend, rv->alen)) ||
          (!defcpdtable.empty() && defcpd_check(&compound_words, wnum + 1, rv, NULL, 1)))) {
    rv = rv->next_homonym;
  }
}