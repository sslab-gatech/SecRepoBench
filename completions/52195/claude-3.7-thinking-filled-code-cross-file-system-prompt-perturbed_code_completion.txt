// Handle simplified triple letter checking.
if (striple && !checkedstriple) {
  checkedstriple = 1;
  i--;
  st[i] = st[i+1];
  rv = lookup(st.c_str() + i, st.size() - i);
  
  // search homonym with compound flag
  while (rv && 
        ((needaffix && TESTAFF(rv->astr, needaffix, rv->alen)) ||
         !((compoundflag && TESTAFF(rv->astr, compoundflag, rv->alen)) ||
           (compoundend && TESTAFF(rv->astr, compoundend, rv->alen))))) {
    rv = rv->next_homonym;
  }
  
  if (!rv) {
    i++;
    checkedstriple = 0;
    striple = 0;
    continue;
  }
} else {
  striple = 0;
  sfx = NULL;
  sfxflag = FLAG_NULL;
  pfx = NULL;
  
  if (i < st.size()) {
    rv = lookup(st.c_str() + i, st.size() - i);
  } else {
    rv = NULL;
  }
  
  // search homonym with compound flag
  while (rv && 
        ((needaffix && TESTAFF(rv->astr, needaffix, rv->alen)) ||
         !((compoundflag && TESTAFF(rv->astr, compoundflag, rv->alen)) ||
           (compoundend && TESTAFF(rv->astr, compoundend, rv->alen))))) {
    rv = rv->next_homonym;
  }
  
  if (!rv && !onlycpdrule) {
    sfx = NULL;
    pfx = NULL;
    
    if (compoundflag) {
      rv = affix_check(st.substr(i), 0, st.size() - i, compoundflag,
                      IN_CPD_END);
    }
    if (!rv && compoundend) {
      rv = affix_check(st.substr(i), 0, st.size() - i, compoundend,
                      IN_CPD_END);
    }
  }
  
  // check non_compound flag in suffix and prefix
  if ((rv) && ((pfx && pfx->getCont() &&
              TESTAFF(pfx->getCont(), compoundforbidflag, pfx->getContLen())) ||
             (sfx && sfx->getCont() &&
              TESTAFF(sfx->getCont(), compoundforbidflag, sfx->getContLen())))) {
    rv = NULL;
  }
}