if(iph != NULL) {
  frag_off = ntohs(iph->frag_off);
  proto = iph->protocol;

  if(header->caplen < header->len) {
    static u_int8_t ip_warning_used = 0;

    if(ip_warning_used == 0) {
      if(!workflow->prefs.quiet_mode)
        NDPI_LOG(0, workflow->ndpi_struct, NDPI_LOG_DEBUG,
                 "\n\nWARNING: packet capture size is smaller than packet size, NDPI may not work correctly (%u < %u)\n\n",
                 header->caplen, header->len);
      ip_warning_used = 1;
    }
  }

  iph_check:
    nproto = packet_processing(workflow, time, vlan_id, tunnel_type, iph, iph6,
                               ip_offset, header->caplen - ip_offset,
                               header->caplen, header, packet, header->ts);
}