if(recheck_type) {
    goto ether_type_check;
  }

  if(vlan_packet) {
    workflow->stats.vlan_count++;
  }

  if(iph->version == IPVERSION) {
    ip_len = ((u_int16_t)iph->ihl * 4);
    iph6 = NULL;

    if(iph->protocol == IPPROTO_IPV6) {
      ip_offset += ip_len;
      if (ip_len > 0)
        goto iph_check;
    }

    if((frag_off & 0x1FFF) != 0) {
      // ... (rest of the code)
    }
  } else if(iph->version == 6) {
    // ... (rest of the code)
  } else {
    // ... (rest of the code)
  }

  if(workflow->prefs.decode_tunnels && (proto == IPPROTO_UDP)) {
    // ... (rest of the code)
  }

  /* process the packet */
  return(packet_processing(workflow, time, vlan_id, tunnel_type, iph, iph6,
                           ip_offset, header->caplen - ip_offset,
                           header->caplen, header, packet, header->ts));