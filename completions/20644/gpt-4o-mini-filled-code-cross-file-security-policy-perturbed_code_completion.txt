if (header->caplen < (ip_offset + sizeof(struct ndpi_iphdr))) {
    static u_int8_t ip_header_warning_used = 0;
    if (ip_header_warning_used == 0) {
        if (!workflow->prefs.quiet_mode)
            NDPI_LOG(0, workflow->ndpi_struct, NDPI_LOG_DEBUG,
                     "\n\nWARNING: Incomplete IP header detected, packet will be discarded\n\n");
        ip_header_warning_used = 1;
    }
    workflow->stats.total_discarded_bytes += header->len;
    return(nproto);
}

iph = (struct ndpi_iphdr *)&packet[ip_offset];