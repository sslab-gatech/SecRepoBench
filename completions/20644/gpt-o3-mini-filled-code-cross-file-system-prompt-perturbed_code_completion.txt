iph = (struct ndpi_iphdr *) &packet[ip_offset];
if(header->caplen < ip_offset + ((iph->ihl & 0x0F) * 4)) {
  static u_int8_t ip_header_warning_once = 0;
  if(!workflow->prefs.quiet_mode && !ip_header_warning_once) {
    NDPI_LOG(0, workflow->ndpi_struct, NDPI_LOG_DEBUG,
             "\n\nWARNING: Captured packet size (%u bytes) is smaller than IP header size (%u bytes). Discarding packet.\n",
             header->caplen, ip_offset + ((iph->ihl & 0x0F) * 4));
    ip_header_warning_once = 1;
  }
  workflow->stats.total_discarded_bytes += header->caplen;
  return(nproto);
}
frag_off = ntohs(iph->frag_off);
proto = iph->protocol;