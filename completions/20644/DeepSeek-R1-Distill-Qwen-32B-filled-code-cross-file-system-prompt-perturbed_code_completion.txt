if (header->caplen < ip_offset + sizeof(struct ndpi_iphdr)) {
    return(nproto);
  }
  iph = (struct ndpi_iphdr *)&packet[ip_offset];