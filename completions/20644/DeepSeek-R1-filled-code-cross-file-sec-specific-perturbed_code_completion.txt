if(recheck_type)
  goto ether_type_check;

if(vlan_packet)
  workflow->stats.vlan_count++;

iph_check:
iph = (struct ndpi_iphdr *)&packet[ip_offset];

if(ip_offset >= header->caplen || (iph->version != IPVERSION && iph->version != 6))
  goto v4_warning;

frag_off = ntohs(iph->frag_off);
proto = iph->protocol;

if(header->caplen < header->len) {
  static u_int8_t caplen_warning_used = 0;
  if(!caplen_warning_used && !workflow->prefs.quiet_mode) {
    NDPI_LOG(0, workflow->ndpi_struct, NDPI_LOG_DEBUG, "WARNING: captured packet size smaller than actual packet size\n");
    caplen_warning_used = 1;
  }
}