if(ipsize < 20)
  return NULL;

if((iph->ihl * 4) > ipsize || ipsize < ntohs(iph->tot_len)
   /* || (iph->frag_off & htons(0x1FFF)) != 0 */)
  return NULL;

l4_offset = iph->ihl * 4;
l3 = (const u_int8_t*)iph;