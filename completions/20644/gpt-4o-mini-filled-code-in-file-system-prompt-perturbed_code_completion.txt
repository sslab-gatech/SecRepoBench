if(ipsize < ip_offset + sizeof(struct ndpi_iphdr)) {
      workflow->stats.total_discarded_bytes += header->len;
      return(nproto);
    }

    iph = (struct ndpi_iphdr *)&packet[ip_offset];
    proto = iph->protocol;

    if(iph->version != IPVERSION) {
      static u_int8_t ipv4_warning_used = 0;

      if(ipv4_warning_used == 0) {
        if(!workflow->prefs.quiet_mode)
          NDPI_LOG(0, workflow->ndpi_struct, NDPI_LOG_DEBUG,
                   "\n\nWARNING: only IPv4/IPv6 packets are supported in this demo (nDPI supports both IPv4 and IPv6), all other packets will be discarded\n\n");
        ipv4_warning_used = 1;
      }
      workflow->stats.total_discarded_bytes += header->len;
      return(nproto);
    }