mp_limb_t limbs[sizeof(mrb_int) / sizeof(mp_limb_t)];
size_t num_limbs = sizeof(mrb_int) / sizeof(mp_limb_t);
int sign = mpz_sgn(mpzptr);

if (mpz_sizeinbase(mpzptr, 2) <= num_limbs * DIGITBITS) {
  mpz_export(limbs, NULL, -1, sizeof(mp_limb_t), 0, 0, mpzptr);
  i = 0;
  while (i < num_limbs && limbs[i] == 0) {
    i++;
  }
  if (i == num_limbs) {
    *v = 0;
  } else {
    *v = (mrb_int)limbs[i] * sign;
    return TRUE;
  }
}
return FALSE;