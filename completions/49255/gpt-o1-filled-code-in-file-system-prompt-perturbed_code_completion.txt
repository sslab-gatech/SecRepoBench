{
  /* if the number is zero, it's trivially convertible */
  if (mpzptr->sn == 0) {
    *v = 0;
    return TRUE;
  }

  /* if more than 2 limbs are in use, it won't fit in mrb_int */
  if (digits(mpzptr) > 2) {
    return FALSE;
  }

  /* combine lower and upper limbs into an unsigned integer */
  mrb_uint uv = mpzptr->p[0];
  if (mpzptr->sz > 1) {
    uv |= ((mrb_uint)mpzptr->p[1] << DIGITBITS);
  }

  /* apply sign and check range */
  if (mpzptr->sn < 0) {
    /* check if absolute value is within [âˆ’MRB_INT_MIN, MRB_INT_MAX+1] */
    if (uv > (mrb_uint)(-(mrb_int)MRB_INT_MIN)) {
      return FALSE;
    }
    /* handle special case for MRB_INT_MIN */
    if (uv == (mrb_uint)(-(mrb_int)MRB_INT_MIN)) {
      *v = MRB_INT_MIN;
    }
    else {
      *v = -(mrb_int)uv;
    }
  }
  else {
    if (uv > (mrb_uint)MRB_INT_MAX) {
      return FALSE;
    }
    *v = (mrb_int)uv;
  }

  return TRUE;
}