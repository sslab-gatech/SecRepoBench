size_t expected_end = oldpos + obj->size;
if (bit_chain->byte != expected_end)
{
    if (bit_chain->byte > expected_end)
    {
        LOG_ERROR("Object %u overflow: read %zu bytes, expected %zu",
                  num, bit_chain->byte - oldpos, obj->size);
        error |= DWG_ERR_INVALIDDWG;
        bit_chain->byte = expected_end;
    }
    else
    {
        size_t remaining = expected_end - bit_chain->byte;
        if (remaining > 0)
        {
            if (bit_chain->byte + remaining > bit_chain->size)
            {
                LOG_ERROR("Object %u remaining data exceeds buffer", num);
                error |= DWG_ERR_INVALIDDWG;
                remaining = bit_chain->size - bit_chain->byte;
            }
            if (remaining > 0)
            {
                obj->unknown_bits = (BITCODE_TF)malloc(remaining);
                if (!obj->unknown_bits)
                {
                    LOG_ERROR("Out of memory for unknown data");
                    error |= DWG_ERR_OUTOFMEM;
                }
                else
                {
                    memcpy(obj->unknown_bits, bit_chain->chain + bit_chain->byte, remaining);
                    bit_chain->byte += remaining;
                    obj->unknown_size = remaining;
                    LOG_TRACE("Stored %zu unknown bytes for object %u", remaining, num);
                }
            }
        }
    }
}