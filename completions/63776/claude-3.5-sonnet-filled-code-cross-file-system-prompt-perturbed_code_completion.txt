// For pre-R11 versions
PRE (R_11)
{
  obj->size = bit_read_RS (bit_chain);
  LOG_TRACE ("size: " FORMAT_RS " [RS]\n", obj->size);
  if (obj->size > 0 && obj->size < 0x7fff)
    {
      if (obj->size + oldpos > bit_chain->size)
        {
          obj->size = (bit_chain->size - oldpos) & 0xFFFF;
          LOG_WARN ("Invalid object size " FORMAT_RS ", reduced to " FORMAT_RS,
                    bit_read_RS (bit_chain), obj->size);
        }
      if (obj->size < (bit_chain->byte - oldpos))
        {
          LOG_ERROR ("Invalid object size " FORMAT_RS " < " FORMAT_RS,
                     obj->size, (BITCODE_RS)(bit_chain->byte - oldpos));
          obj->size = (bit_chain->byte - oldpos) & 0xFFFF;
        }
      if (obj->size > (bit_chain->byte - oldpos))
        {
          BITCODE_RS size = obj->size;
          error |= dwg_decode_unknown_bits (bit_chain, obj);
          obj->size = size;
        }
    }
  else
    {
      LOG_ERROR ("Invalid object size " FORMAT_RS, obj->size);
      obj->size = 0;
      return DWG_ERR_VALUEOUTOFBOUNDS;
    }
}
// For R11 and later versions
LATER_VERSIONS
{
  obj->size = bit_read_RL (bit_chain);
  LOG_TRACE ("size: " FORMAT_RL " [RL]\n", obj->size);
  if (obj->size > 0)
    {
      BITCODE_RS crc;
      if (obj->size + oldpos > bit_chain->size)
        {
          obj->size = (bit_chain->size - oldpos) & 0xFFFFFFFF;
          LOG_WARN ("Invalid object size " FORMAT_RL ", reduced to " FORMAT_RL,
                    bit_read_RL (bit_chain), obj->size);
        }
      if (obj->size < (bit_chain->byte - oldpos))
        {
          LOG_ERROR ("Invalid object size " FORMAT_RL " < " FORMAT_RL,
                     obj->size, (BITCODE_RL)(bit_chain->byte - oldpos));
          obj->size = (bit_chain->byte - oldpos) & 0xFFFFFFFF;
        }
      if (obj->address + obj->size != bit_chain->byte)
        {
          BITCODE_RL offset = (obj->address + obj->size) - bit_chain->byte;
          LOG_TRACE ("-skip %u bytes\n", (unsigned)offset);
          bit_advance_position (bit_chain, offset);
        }
      crc = bit_calc_CRC (0xC0C1, &bit_chain->chain[oldpos],
                          obj->size);
      LOG_TRACE ("crc: %04X [RSx]\n", crc);
      if (crc != bit_read_RS (bit_chain))
        {
          LOG_ERROR ("Wrong CRC 0x%04X for %s", crc,
                     dwg_type_name (obj->type));
          error |= DWG_ERR_WRONGCRC;
        }
    }
  else
    {
      LOG_ERROR ("Invalid object size " FORMAT_RL, obj->size);
      obj->size = 0;
      return DWG_ERR_VALUEOUTOFBOUNDS;
    }
}