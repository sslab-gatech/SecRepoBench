extent=GetQuantumExtent(image,quantumdata);
quantum=(extent > quantumdata->extent) ? extent : quantumdata->extent;
if (quantumdata->quantum == (unsigned char *) NULL)
{
  quantumdata->quantum=(unsigned char *) AcquireQuantumMemory((size_t) image->columns,quantum);
  if (quantumdata->quantum == (unsigned char *) NULL)
    return MagickFalse;
}
else
  if ((quantum != quantumdata->extent) && (image->columns > 0))
  {
    unsigned char *new_quantum = (unsigned char *) AcquireQuantumMemory((size_t) image->columns,quantum);
    if (new_quantum != (unsigned char *) NULL)
    {
      /* Safely release the old memory before assigning new memory to prevent CWE-416 */
      RelinquishMagickMemory(quantumdata->quantum);
      quantumdata->quantum = new_quantum;
    }
    else
    {
      /* Handle memory allocation failure */
      return MagickFalse;
    }
  }
quantumdata->extent=quantum;
return MagickTrue;