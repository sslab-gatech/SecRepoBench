if (quantumdata->format == FloatingPointQuantumFormat)
  {
    quantum=(size_t) quantumdata->depth;
    if (quantum == 16)
      quantum=32;
    else
      if ((quantum == 32) || (quantum == 64))
        quantum=64;
  }
else
  {
    quantum=(size_t) quantumdata->depth;
    if (quantum <= 8)
      quantum=8;
    else
      if (quantum <= 16)
        quantum=16;
      else
        if (quantum <= 32)
          quantum=32;
        else
          quantum=64;
  }
quantumdata->quantum=quantum;
extent=MagickMax(image->columns,1);
if (quantumdata->pad > 0)
  extent+=(quantumdata->pad-1);
extent=(extent/quantumdata->pad)*quantumdata->pad;
extent=(size_t) image->rows*extent*GetPixelChannels(image)*((quantum+7)/8);
if (extent != (size_t) ((size_t) image->columns*image->rows*
      GetPixelChannels(image)*((quantum+7)/8)))
  extent=(size_t) image->columns*image->rows*GetPixelChannels(image)*
    ((quantum+7)/8);
if (quantumdata->pixels == (unsigned char *) NULL)
  quantumdata->pixels=(unsigned char *) AcquireQuantumMemory(extent,
    sizeof(*quantumdata->pixels));
else
  if (extent > quantumdata->extent)
    quantumdata->pixels=(unsigned char *) ResizeQuantumMemory(
      quantumdata->pixels,extent,sizeof(*quantumdata->pixels));
if (quantumdata->pixels == (unsigned char *) NULL)
  return(MagickFalse);
quantumdata->extent=extent;
return(MagickTrue);