{
  size_t
    quantum_size,
    channels;

  /*
    Determine the number of channels in the image.
  */
  channels=GetPixelChannels(image);
  /*
    Compute the number of bytes per pixel.
    (Add 7 to depth and divide by 8 to round up to whole bytes.)
  */
  quantum_size=channels*((quantumdata->depth+7)/8);
  /*
    Determine the total memory required for the quantum pixel buffer.
  */
  extent=image->columns*image->rows*quantum_size;
  /*
    Allocate or reallocate the quantum pixel buffer as needed.
  */
  if (quantumdata->pixels == (unsigned char *) NULL)
  {
    quantumdata->length=extent;
    quantumdata->pixels=(unsigned char *) AcquireMagickMemory(quantumdata->length);
    if (quantumdata->pixels == (unsigned char *) NULL)
      return(MagickFalse);
  }
  else
  {
    if (quantumdata->length < extent)
    {
      quantumdata->pixels=(unsigned char *) ResizeMagickMemory(quantumdata->pixels,extent);
      if (quantumdata->pixels == (unsigned char *) NULL)
        return(MagickFalse);
      quantumdata->length=extent;
    }
  }
  return(MagickTrue);
}