if (quantumdata->format == FloatingPointQuantumFormat)
  quantumdata->depth=32;
quantum=quantumdata->depth;
if ((quantum == 8) || (quantum == 16) || (quantum == 32) || (quantum == 64))
  {
    quantum=(size_t) MagickMax((size_t) quantum,(size_t) 8);
    quantum=(size_t) MagickMin((size_t) quantum,(size_t) 64);
  }
else
  if (quantum < 8)
    quantum=8;
  else
    if (quantum > 64)
      quantum=64;
    else
      quantum=(((size_t) quantum+7) & ~0x07);
extent=(quantum*image->columns*GetImageChannels(image)+7)/8;
if (extent < (image->columns*GetImageChannels(image)))
  extent=image->columns*GetImageChannels(image);
if (quantumdata->pixels == (unsigned char *) NULL)
  quantumdata->pixels=(unsigned char *) AcquireQuantumMemory(extent,
    sizeof(*quantumdata->pixels));
else
  quantumdata->pixels=(unsigned char *) ResizeQuantumMemory(
    quantumdata->pixels,extent,sizeof(*quantumdata->pixels));
if (quantumdata->pixels == (unsigned char *) NULL)
  return(MagickFalse);
quantumdata->extent=extent;
return(MagickTrue);