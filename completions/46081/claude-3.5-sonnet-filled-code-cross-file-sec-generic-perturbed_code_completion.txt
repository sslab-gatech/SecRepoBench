quantum=GetQuantumRange(quantumdata->depth);
if (quantum == 0)
  return(MagickFalse);
if ((quantumdata->format == FloatingPointQuantumFormat) &&
    (quantumdata->depth == 16))
  quantum=65535;
if ((quantumdata->format == FloatingPointQuantumFormat) &&
    (quantumdata->depth == 32))
  quantum=65535;
if ((quantumdata->format == FloatingPointQuantumFormat) &&
    (quantumdata->depth == 64))
  quantum=65535;
extent=(image->columns*image->rows);
if (extent != (size_t) ((size_t) image->columns*image->rows))
  return(MagickFalse);
extent*=image->number_channels;
if (extent != (size_t) (image->number_channels*image->columns*image->rows))
  return(MagickFalse);
extent=(size_t) (quantum*extent)/8;
if (extent != (size_t) ((quantum*image->number_channels*image->columns*
    image->rows)/8))
  return(MagickFalse);
extent+=image->number_channels*image->columns;  /* pad scan lines */
if (extent < image->number_channels*image->columns)
  return(MagickFalse);
if (quantumdata->pixels != (unsigned char *) NULL)
  quantumdata->pixels=(unsigned char *) RelinquishMagickMemory(
    quantumdata->pixels);
quantumdata->pixels=(unsigned char *) AcquireQuantumMemory(extent,
  sizeof(*quantumdata->pixels));
if (quantumdata->pixels == (unsigned char *) NULL)
  return(MagickFalse);
return(MagickTrue);