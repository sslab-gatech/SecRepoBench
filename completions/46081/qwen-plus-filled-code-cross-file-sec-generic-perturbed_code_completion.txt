extent = GetQuantumExtent(image, quantumdata);
if (extent == 0)
  return MagickFalse;

quantum = image->storage_class == PseudoClass ? GetNumberColors(image) : image->columns * image->rows;
size_t buffer_size = extent * quantum;

if (quantumdata->quantum == nullptr || quantumdata->extent < buffer_size)
{
  quantumdata->quantum = (unsigned char *) ResizeQuantumMemory(quantumdata->quantum, quantumdata->extent, buffer_size);
  if (quantumdata->quantum == nullptr)
    return MagickFalse;
  quantumdata->extent = buffer_size;
}

return MagickTrue;