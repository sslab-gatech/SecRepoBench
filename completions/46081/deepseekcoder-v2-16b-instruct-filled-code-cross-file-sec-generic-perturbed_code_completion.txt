/*
    Adjust the quantum depth based on the format and specified depth,
    particularly for floating point formats. Calculate the memory
    required for quantum pixels based on the image's channels, padding,
    and depth. Determine the necessary buffer size by comparing it to
    the product of the image's dimensions and memory requirement per
    pixel. Ensure memory allocation for quantum pixels is sufficient;
    if not, reallocate as needed. Return whether the allocation was
    successful.
  */

  // Calculate the number of channels
  size_t channels = image->colorspace == CMYKColorspace ? 4 : 3;

  // Calculate the memory requirement per pixel
  size_t memory_per_pixel = channels * (quantumdata->depth / 8);

  // Calculate the total memory required for the image
  extent = image->columns * image->rows * memory_per_pixel;

  // Allocate memory for quantum pixels
  if (quantumdata->pixels == NULL) {
    quantumdata->pixels = (Quantum *) AcquireQuantumMemory(extent, sizeof(Quantum));
    if (quantumdata->pixels == NULL) {
      return MagickFalse;
    }
  } else {
    if (extent > quantumdata->allocated_memory) {
      quantumdata->pixels = (Quantum *) ReallocateQuantumMemory(quantumdata->pixels, quantumdata->allocated_memory, extent);
      if (quantumdata->pixels == NULL) {
        return MagickFalse;
      }
      quantumdata->allocated_memory = extent;
    }
  }

  return MagickTrue;