{
  if ((quantumdata->format == FloatingPointQuantumFormat) &&
      (quantumdata->depth > 32))
    quantumdata->depth=64;
  if ((quantumdata->format == FloatingPointQuantumFormat) &&
      (quantumdata->depth <= 32))
    quantumdata->depth=32;
  quantum=GetQuantumSamples(image,quantumdata);
  extent=quantum*image->channels;
  if (image->storage_class == DirectClass)
    extent=image->colors*quantum;
  if (quantumdata->pad != 0)
    extent+=quantumdata->pad;
  if (extent == 0)
    return(MagickTrue);
  if ((extent*image->columns*image->rows) > GetMagickResourceLimit(AreaResource))
    ThrowMagickBooleanException(ResourceLimitError,AreaLimitExceeded,
      "SetQuantumDepth");
  if (image->pixels == (void *) NULL)
    {
      image->pixels=(unsigned char *) AcquireAlignedMemory(image->columns,
        image->rows*extent);
      if (image->pixels == (void *) NULL)
        ThrowMagickBooleanException(ResourceLimitError,MemoryAllocationFailed,
          "SetQuantumDepth");
      return(MagickTrue);
    }
  if (image->columns*image->rows*extent > image->columns*image->rows*quantumdata->extent)
    {
      image->pixels=(unsigned char *) ResizeAlignedMemory(image->pixels,
        image->columns,image->rows*extent);
      if (image->pixels == (void *) NULL)
        ThrowMagickBooleanException(ResourceLimitError,MemoryAllocationFailed,
          "SetQuantumDepth");
    }
  quantumdata->extent=extent;
  return(MagickTrue);
}