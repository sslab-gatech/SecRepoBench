size_t packet_size = 0;
if (quantum_info->format == FloatingPointQuantumFormat)
{
  quantum_info->depth = MagickMin(depth, sizeof(float)*8);
  packet_size = sizeof(float) * GetPixelChannels(image);
}
else
{
  quantum_info->depth = MagickMin(depth, 64);
  packet_size = (quantum_info->depth + 7) / 8 * GetPixelChannels(image);
}

extent = packet_size * image->columns;
if (!AcquireQuantumPixels(quantum_info, extent))
  return MagickFalse;

return MagickTrue;