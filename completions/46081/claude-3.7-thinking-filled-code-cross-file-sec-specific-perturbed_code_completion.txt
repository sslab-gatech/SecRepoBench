if (quantumdata->format == FloatingPointQuantumFormat)
  quantum=(size_t) (quantumdata->depth <= 8 ? 1 : (quantumdata->depth <= 16 ? 2 : 4));
else
  quantum=(size_t) ((quantumdata->depth+7)/8);

extent=quantum;
if (quantumdata->pack == MagickFalse)
  extent=(size_t) (quantum*image->channels);

// Free old buffer if it exists
if (quantumdata->pixels != (unsigned char *) NULL)
{
  quantumdata->pixels=(unsigned char *) RelinquishMagickMemory(
    quantumdata->pixels);
}

// Calculate total memory required
extent = extent * image->columns;
quantumdata->pixels=(unsigned char *) AcquireQuantumMemory(extent,
  sizeof(*quantumdata->pixels));
if (quantumdata->pixels == (unsigned char *) NULL)
  return(MagickFalse);

return(MagickTrue);