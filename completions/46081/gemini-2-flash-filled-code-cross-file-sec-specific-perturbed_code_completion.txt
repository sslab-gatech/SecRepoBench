{
  quantum=GetQuantumDepth(quantumdata);
  if ((quantumdata->format == FloatingPointQuantumFormat) &&
      (quantumdata->depth > quantum))
    {
      quantumdata->depth=quantum;
      if (image->debug != MagickFalse)
        (void) LogMagickEvent(CoderEvent,GetMagickModule(),
          "Quantum depth truncated to %lu",(unsigned long) quantumdata->depth);
    }
  extent=GetQuantumExtent(image,quantumdata);
  if (extent == 0)
    return(MagickFalse);
  if ((extent*image->columns) > (MagickSizeType) (MaxMapArea/image->rows))
    return(MagickFalse);
  if (image->storage_class == DirectClass)
    {
      if (extent > quantumdata->max_extent)
        {
          quantumdata->max_extent=extent;
          quantumdata->pixels=(unsigned char *) RelinquishAlignedMemory(
            quantumdata->pixels);
          quantumdata->pixels=(unsigned char *) AcquireAlignedMemory(
            quantumdata->max_extent,sizeof(*quantumdata->pixels));
          if (quantumdata->pixels == (unsigned char *) NULL)
            {
              quantumdata->max_extent=0;
              return(MagickFalse);
            }
        }
      return(MagickTrue);
    }
  if ((extent*image->columns*image->rows) > quantumdata->max_extent)
    {
      quantumdata->max_extent=extent*image->columns*image->rows;
      quantumdata->pixels=(unsigned char *) RelinquishAlignedMemory(
        quantumdata->pixels);
      quantumdata->pixels=(unsigned char *) AcquireAlignedMemory(
        quantumdata->max_extent,sizeof(*quantumdata->pixels));
      if (quantumdata->pixels == (unsigned char *) NULL)
        {
          quantumdata->max_extent=0;
          return(MagickFalse);
        }
    }
  return(MagickTrue);
}