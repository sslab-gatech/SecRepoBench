extent = image->columns * image->rows * quantumdata->depth / 8; // Calculate required memory size
if (quantumdata->pixels != NULL) // Check if already allocated
{
    // Free the existing pixel buffer to prevent memory leak
    free(quantumdata->pixels);
    quantumdata->pixels = NULL; // Avoid dangling pointer
}

// Allocate memory for quantum pixels
quantumdata->pixels = (Quantum *) malloc(extent);
if (quantumdata->pixels == NULL) // Check for successful allocation
{
    ThrowMagickException(exception,GetMagickModule(),ResourceLimitError,"MemoryAllocationFailed","`%s'",image->filename);
    return(MagickFalse);
}
return(MagickTrue);