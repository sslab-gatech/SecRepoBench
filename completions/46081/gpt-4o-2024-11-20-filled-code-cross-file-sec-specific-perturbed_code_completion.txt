quantum = quantumdata->depth / 8; // Calculate bytes per quantum
  extent = quantum * image->columns * image->rows; // Calculate total memory needed

  // Ensure the buffer is large enough
  if (quantumdata->pixels == (unsigned char *) NULL || quantumdata->extent < extent)
  {
    quantumdata->pixels = (unsigned char *) RelinquishMagickMemory(quantumdata->pixels);
    quantumdata->pixels = (unsigned char *) AcquireQuantumMemory(extent, sizeof(*quantumdata->pixels));
    if (quantumdata->pixels == (unsigned char *) NULL)
      return MagickFalse; // Memory allocation failed
    quantumdata->extent = extent;
  }

  return MagickTrue; // Allocation successful