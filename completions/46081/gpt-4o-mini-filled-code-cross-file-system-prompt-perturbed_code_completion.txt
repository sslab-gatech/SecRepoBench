size_t channels = GetQuantumChannels(quantumdata->format);
size_t padding = (quantumdata->depth % 8) ? 1 : 0;
quantum = (channels * quantumdata->depth + 7) / 8 + padding;

extent = image->columns * image->rows * quantum;
if (quantumdata->pixels == (Quantum *) NULL)
  quantumdata->pixels = (Quantum *) AcquireQuantumMemory(extent, sizeof(*quantumdata->pixels));
else
  quantumdata->pixels = (Quantum *) ResizeQuantumMemory(quantumdata->pixels, extent, sizeof(*quantumdata->pixels));

if (quantumdata->pixels == (Quantum *) NULL)
  return(MagickFalse);

return(MagickTrue);