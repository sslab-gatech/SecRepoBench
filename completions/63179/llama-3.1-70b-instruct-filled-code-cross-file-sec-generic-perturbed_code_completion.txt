u_int32_t needed = sizeof(u_int32_t);
int rc;

if(serializer->status.flags & NDPI_SERIALIZER_STATUS_HEADER_WRITTEN) {
  needed += 1; // for the comma
}

if(serializer->fmt == ndpi_serialization_format_csv) {
  if(!(serializer->status.flags & NDPI_SERIALIZER_STATUS_HEADER_WRITTEN)) {
    if(ndpi_serializer_header_string(serializer, "", 0) < 0)
      return(-1);
  }
}

if(serializer->buffer.size - serializer->status.buffer.size_used < needed) {
  if(ndpi_extend_serializer_buffer(&serializer->buffer, needed - (serializer->buffer.size - serializer->status.buffer.size_used)) < 0)
    return(-1);
}

if(serializer->status.flags & NDPI_SERIALIZER_STATUS_HEADER_WRITTEN) {
  serializer->buffer.data[serializer->status.buffer.size_used++] = ',';
}

rc = ndpi_snprintf((char *)&serializer->buffer.data[serializer->status.buffer.size_used], serializer->buffer.size - serializer->status.buffer.size_used, "%d", value);
if(rc < 0 || (u_int)rc >= serializer->buffer.size - serializer->status.buffer.size_used)
  return(-1);
serializer->status.buffer.size_used += rc;
serializer->status.flags |= NDPI_SERIALIZER_STATUS_HEADER_WRITTEN;