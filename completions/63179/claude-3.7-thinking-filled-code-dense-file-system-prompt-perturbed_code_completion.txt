int rc;
u_int16_t needed = 32; /* Estimated space needed for int32_t string representation */

if(remainingspace < needed) {
  if(ndpi_extend_serializer_buffer(&serializer->buffer, needed - remainingspace) < 0)
    return(-1);
  remainingspace = serializer->buffer.size - serializer->status.buffer.size_used;
}

if(!(serializer->status.flags & NDPI_SERIALIZER_STATUS_HDR_DONE)) {
  if(ndpi_serializer_header_string(serializer, key, strlen(key)) < 0)
    return(-1);
}

ndpi_serialize_csv_pre(serializer);
rc = ndpi_snprintf((char *)&serializer->buffer.data[serializer->status.buffer.size_used], 
                  remainingspace, "%d", value);