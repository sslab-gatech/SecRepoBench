int needed = sizeof(u_int8_t) /* type */ +
                 sizeof(u_int16_t) /* key len */ +
                 strlen(key) /* key */ +
                 sizeof(int32_t); // size for the integer value

    if (remainingspace < needed) {
        if (ndpi_extend_serializer_buffer(&serializer->buffer, needed - remainingspace) < 0)
            return(-1);
        remainingspace = serializer->buffer.size - serializer->status.buffer.size_used;
    }

    if (ndpi_serializer_header_string(serializer, key, strlen(key)) < 0) return(-1);
    rc = ndpi_snprintf((char *) &serializer->buffer.data[serializer->status.buffer.size_used], remainingspace,
                       "%d", value);