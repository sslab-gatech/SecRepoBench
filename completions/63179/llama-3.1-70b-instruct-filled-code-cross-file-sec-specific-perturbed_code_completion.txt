u_int32_t needed;
int rc;

needed = sizeof(u_int8_t) /* type */ +
         sizeof(u_int32_t) /* value */;

if(serializer->fmt == ndpi_serialization_format_csv) {
  if(serializer->status.flags & NDPI_SERIALIZER_STATUS_HEADER_WRITTEN) {
    serializer->buffer.data[serializer->status.buffer.size_used++] = ',';
  } else {
    serializer->status.flags |= NDPI_SERIALIZER_STATUS_HEADER_WRITTEN;
  }
}

if(serializer->buffer.size - serializer->status.buffer.size_used < needed) {
  if(ndpi_extend_serializer_buffer(&serializer->buffer, needed - (serializer->buffer.size - serializer->status.buffer.size_used)) < 0)
    return(-1);
}

rc = ndpi_snprintf((char *)&serializer->buffer.data[serializer->status.buffer.size_used], serializer->buffer.size - serializer->status.buffer.size_used,
                   "%d", value);
if(rc < 0 || (u_int)rc >= serializer->buffer.size - serializer->status.buffer.size_used)
  return(-1);