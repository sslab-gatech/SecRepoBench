int rc;
if (serializer->status.flags & NDPI_SERIALIZER_STATUS_HEADER) {
    rc = ndpi_snprintf((char *)&serializer->buffer.data[serializer->status.buffer.size_used],
                       remainingspace, "%d", value);
} else {
    rc = ndpi_snprintf((char *)&serializer->buffer.data[serializer->status.buffer.size_used],
                       remainingspace, "int32\n%d", value);
    serializer->status.flags |= NDPI_SERIALIZER_STATUS_HEADER;
}

if (rc < 0 || (u_int)rc >= remainingspace) {
    u_int32_t new_size = serializer->buffer.size + (rc - remainingspace) + 1;
    if (ndpi_extend_serializer_buffer(&serializer->buffer, new_size - serializer->buffer.size) < 0)
        return(-1);
    remainingspace = serializer->buffer.size - serializer->status.buffer.size_used;
    rc = ndpi_snprintf((char *)&serializer->buffer.data[serializer->status.buffer.size_used],
                       remainingspace, serializer->status.flags & NDPI_SERIALIZER_STATUS_HEADER ? "%d" : "int32\n%d", value);
}