// Serialize the integer value into a CSV format string and store it in the buffer.
// Ensure that the buffer has sufficient space, extending it if necessary.
// Prepend a header string if the header has not already been written.
// Adjust the buffer usage count to reflect the serialized data.
char buffer[32];
int rc = snprintf(buffer, sizeof(buffer), "%d", value);
if (rc < 0 || (size_t)rc >= sizeof(buffer)) {
    return -1;
}

if (serializer->status.flags & NDPI_SERIALIZER_STATUS_HEADER_WRITTEN) {
    serializer->buffer.data[serializer->status.buffer.size_used++] = ',';
} else {
    rc = ndpi_serializer_header_string(serializer, key, strlen(key));
    if (rc < 0) {
        return -1;
    }
    serializer->status.flags |= NDPI_SERIALIZER_STATUS_HEADER_WRITTEN;
}

size_t buffer_size = strlen(buffer);
if (serializer->status.buffer.size_used + buffer_size > serializer->buffer.size) {
    if (ndpi_extend_serializer_buffer(&serializer->buffer, buffer_size) < 0) {
        return -1;
    }
}

memcpy(&serializer->buffer.data[serializer->status.buffer.size_used], buffer, buffer_size);
serializer->status.buffer.size_used += buffer_size;