while (uc < ueend) {
    uc = json_skip_space(uc, ueend);
    if (uc == ueend)
        goto out;

    if (*uc == ']') {
        uc++;
        DPRINTF("Good array: ", uc, *ucp);
        *ucp = uc;
        *st += 1;
        return 1;
    }

    if (!json_parse(&uc, ueend, st, lvl + 1)) {
        DPRINTF("Bad element: ", uc, *ucp);
        goto out;
    }

    uc = json_skip_space(uc, ueend);
    if (uc == ueend)
        goto out;

    if (*uc == ',') {
        uc++;
        continue;
    } else if (*uc == ']') {
        uc++;
        DPRINTF("Good array: ", uc, *ucp);
        *ucp = uc;
        *st += 1;
        return 1;
    } else {
        DPRINTF("Bad array: ", uc, *ucp);
        goto out;
    }
}