{
    u_int16_t msg_len, offset, additional_len;

    if (flow_packet->payload[0] == 0x0) {
        offset = 2;
        additional_len = 4;
    } else {
        offset = 4;
        additional_len = 8;
    }

    if (flow_packet->payload_packet_len >= offset + sizeof(u_int16_t)) {
        msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[offset]);
        if (msg_len + additional_len == flow_packet->payload_packet_len) {
            goto capwap_found;
        }
    }
}