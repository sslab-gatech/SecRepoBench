u_int16_t msg_len, calculated_len;
  u_int8_t first_byte = flow_packet->payload[0];

  if (first_byte == 0x0) {
    msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[2]);
    calculated_len = msg_len + 12; // 12 is the fixed header length
  } else if (first_byte == 0x1) {
    msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[4]);
    calculated_len = msg_len + 14; // 14 is the fixed header length
  } else {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  if (calculated_len == flow_packet->payload_packet_len) {
    goto capwap_found;
  }