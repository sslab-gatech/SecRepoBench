{
  u_int16_t msg_len;
  u_int16_t offset = (flow_packet->payload[0] == 0x0) ? 8 : 12;
  u_int16_t additional_len = (flow_packet->payload[0] == 0x0) ? 4 : 0;

  if (flow_packet->payload_packet_len < offset + 2) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[offset]) + offset + additional_len;

  if (msg_len == flow_packet->payload_packet_len)
    goto capwap_found;
}