u_int16_t offset = 0;
    u_int16_t msg_len = 0;

    if (flow_packet->payload[0] == 0x0) {
        offset = 12; // Assuming the message length starts at offset 12 for payload[0] == 0x0
    } else if (flow_packet->payload[0] == 0x1) {
        offset = 16; // Assuming the message length starts at offset 16 for payload[0] == 0x1
    }

    // Validate that the offset and size do not exceed the payload length
    if (offset + sizeof(msg_len) <= flow_packet->payload_packet_len) {
        msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[offset]);
        if (msg_len + offset + 4 == flow_packet->payload_packet_len) {
            goto capwap_found;
        }
    }