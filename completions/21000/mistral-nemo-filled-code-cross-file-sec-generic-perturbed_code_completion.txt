u_int16_t msg_len;
u_int8_t offset, additional_len;

if (sport == NDPI_CAPWAP_CONTROL_PORT) {
  offset = 0;
  additional_len = 4;
} else {
  offset = 1;
  additional_len = 2;
}

msg_len = flow_packet->payload[offset] + (flow_packet->payload[offset + 1] << 8);

if ((msg_len + additional_len) == flow_packet->payload_packet_len)
  goto capwap_found;