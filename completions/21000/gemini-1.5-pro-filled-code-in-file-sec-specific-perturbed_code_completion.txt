{
      u_int16_t msg_len;
      u_int16_t offset = 4;

      if(flow_packet->payload[0] == 0x1) {
        offset = 8;
      }

      if(flow_packet->payload_packet_len < offset + 2) {
        NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
        return;
      }
      
      msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[offset]);
      if((msg_len + offset + 2) == flow_packet->payload_packet_len)
        goto capwap_found;
    }