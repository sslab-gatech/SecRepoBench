u_int16_t msg_len;
u_int8_t offset, additional_len;

if (flow_packet->payload[0] == 0x0) {
  offset = 4;
  additional_len = 2;
} else if (flow_packet->payload[0] == 0x1) {
  offset = 8;
  additional_len = 4;
} else {
  return;
}

msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[offset]);

if ((msg_len + additional_len) == flow_packet->payload_packet_len) {
  goto capwap_found;
}