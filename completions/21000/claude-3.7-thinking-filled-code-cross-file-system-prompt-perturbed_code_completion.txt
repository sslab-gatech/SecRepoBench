{
  u_int16_t msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[2]);
  u_int16_t offset;
  
  // Determine offset based on payload type
  if(flow_packet->payload[0] == 0x0)
    offset = 8;  // Type 0 header size
  else
    offset = 12; // Type 1 header size
  
  // Check if calculated length matches actual packet length
  if((msg_len + offset) == flow_packet->payload_packet_len)
    goto capwap_found;
}