u_int16_t offset, msg_len;
u_int8_t  ver;

if(flow_packet->payload[0] == 0x0) 
  offset = 8;
else
  offset = 4;

ver = flow_packet->payload[1];

if(flow_packet->payload_packet_len >= (offset + 4)) 
  msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[offset + 2]);

if((flow_packet->payload_packet_len == (offset + 4 + msg_len)) 
   && ((ver == 0x0) || (ver == 0x1))) 
  goto capwap_found;