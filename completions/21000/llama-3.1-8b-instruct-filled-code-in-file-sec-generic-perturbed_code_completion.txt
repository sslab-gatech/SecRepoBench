if(((sport == NDPI_CAPWAP_CONTROL_PORT) || (dport == NDPI_CAPWAP_CONTROL_PORT))
   && ((flow_packet->payload[0] == 0x0) || (flow_packet->payload[0] == 0x1))
   ) 
   // Check if the CAPWAP control port is used in the source or destination,
   // and if the first byte of the payload is 0x0 or 0x1.
   // Calculate a message length from the payload using an offset and an additional length,
   // depending on the first byte of the payload.
   // Compare the calculated total length with the actual payload packet length.
   // If they match, jump to the code block that handles a successful CAPWAP detection.
   if(flow_packet->payload[0] == 0x0) {
     u_int16_t msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[2]);
     if((msg_len+2) == flow_packet->payload_packet_len)
       goto capwap_found;
   } else if(flow_packet->payload[0] == 0x1) {
     u_int16_t msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[3]);
     if((msg_len+3) == flow_packet->payload_packet_len)
       goto capwap_found;
   }