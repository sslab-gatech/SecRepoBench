u_int16_t msg_len;
if(flow_packet->payload[0] == 0x0) {
  msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[2]);
} else if(flow_packet->payload[0] == 0x1) {
  msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[4]);
} else {
  NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
  return;
}

if(msg_len == flow_packet->payload_packet_len) {
  goto capwap_found;
} else {
  NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
  return;
}