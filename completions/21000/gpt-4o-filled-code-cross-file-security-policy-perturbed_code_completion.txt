{
  u_int16_t msg_len;
  if (flow_packet->payload[0] == 0x0) {
    if (flow_packet->payload_packet_len < 8 + sizeof(u_int16_t)) {
      NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
      return;
    }
    msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[6]);
  } else {
    if (flow_packet->payload_packet_len < 4 + sizeof(u_int16_t)) {
      NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
      return;
    }
    msg_len = ntohs(*(u_int16_t*)&flow_packet->payload[2]);
  }

  if ((msg_len + 8) == flow_packet->payload_packet_len)
    goto capwap_found;
}