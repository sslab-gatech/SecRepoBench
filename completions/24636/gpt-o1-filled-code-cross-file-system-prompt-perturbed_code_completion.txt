{
    int size = tp->tp_end - bytestream2_get_buffer(&decodercontext->g);
    if (size < 0) {
        av_log(decodercontext->avctx, AV_LOG_ERROR, "Invalid tile-part size\n");
        return AVERROR_INVALIDDATA;
    }

    // If main packed headers (PPM) are present, prepare them for tile-part header parsing
    if (decodercontext->has_ppm) {
        bytestream2_seek(&decodercontext->packed_headers_stream, 0, SEEK_SET);
    }

    // If packed packet headers (PPT) are present and this is the first tile-part, initialize them
    if (!tile->tp_idx && tp->ppt_data_size > 0) {
        bytestream2_init(&tp->ppt_stream, tp->ppt_data, tp->ppt_data_size);
    }

    // Set up the data stream for this tile-part
    bytestream2_init(&tp->tile_data, bytestream2_get_buffer(&decodercontext->g), size);
    bytestream2_skip(&decodercontext->g, size);

    // Move on to the next tile-part
    tile->tp_idx++;
    continue;
}