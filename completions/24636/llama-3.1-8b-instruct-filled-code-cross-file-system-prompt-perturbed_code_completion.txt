// Initialize the bytestream for tile-part headers using packed header streams if PPM is present.
// Initialize the bytestream for packed packet headers if PPT is present and it's the first tile-part.
// Set up the data stream for the current tile-part by calculating its size and skipping to its end in the buffer.
// Continue to the next iteration of the loop to process more headers or reach the end marker.
if (decodercontext->has_ppm) {
    if (decodercontext->in_tile_headers) {
        bytestream2_init(&decodercontext->packed_headers_stream, decodercontext->packed_headers, decodercontext->packed_headers_size);
    }
    if (marker == JPEG2000_PPT) {
        if (!decodercontext->has_ppm) {
            av_log(decodercontext->avctx, AV_LOG_ERROR, "Cannot have PPT without PPM marker.\n");
            return AVERROR_INVALIDDATA;
        }
        if (decodercontext->curtileno == 0) {
            decodercontext->in_tile_headers = 1;
        }
    }
    if (marker == JPEG2000_SOT) {
        if (decodercontext->curtileno >= 0) {
            tile = decodercontext->tile + decodercontext->curtileno;
            tp = tile->tile_part + tile->tp_idx;
            if (tp->tp_end < decodercontext->g.buffer) {
                av_log(decodercontext->avctx, AV_LOG_ERROR, "Invalid tpend\n");
                return AVERROR_INVALIDDATA;
            }
            if (decodercontext->curtileno == 0) {
                decodercontext->in_tile_headers = 1;
            }
        }
    }
    if (marker == JPEG2000_TLM) {
        ret = get_tlm(decodercontext, len);
        if (ret < 0)
            return ret;
        tp->tp_end = bytestream2_tell(&decodercontext->g);
    }
    if (marker == JPEG2000_PLT) {
        ret = get_plt(decodercontext, len);
        if (ret < 0)
            return ret;
        tp->tp_end = bytestream2_tell(&decodercontext->g);
    }
    if (marker == JPEG2000_PPM) {
        ret = get_ppm(decodercontext, len);
        if (ret < 0)
            return ret;
        tp->tp_end = bytestream2_tell(&decodercontext->g);
    }
    if (marker == JPEG2000_EOC)
        break;
}