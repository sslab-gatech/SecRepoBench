if (decodercontext->has_ppm) {
    if (tp->tp_header_start > decodercontext->packed_headers_size) {
        av_log(decodercontext->avctx, AV_LOG_ERROR, "Invalid tp_header_start\n");
        return AVERROR_INVALIDDATA;
    }
    bytestream2_init(&tp->header_stream, 
                     decodercontext->packed_headers + tp->tp_header_start,
                     decodercontext->packed_headers_size - tp->tp_header_start);
}

// Initialize the bytestream for packed packet headers if PPT is present and it's the first tile-part
if (tile->has_ppt && !tile->tp_idx) {
    if (tile->packed_ph_size <= 0) {
        av_log(decodercontext->avctx, AV_LOG_ERROR, "Invalid packed_ph_size\n");
        return AVERROR_INVALIDDATA;
    }
    bytestream2_init(&tile->packed_ph_stream, tile->packed_ph, tile->packed_ph_size);
}

// Set up the data stream for the current tile-part
tp->tpdata_size = tp->tp_end - decodercontext->g.buffer;
if (tp->tpdata_size <= 0 || tp->tpdata_size > bytestream2_get_bytes_left(&decodercontext->g)) {
    av_log(decodercontext->avctx, AV_LOG_ERROR, "Invalid tpdata_size\n");
    return AVERROR_INVALIDDATA;
}
bytestream2_init(&tp->tpdata, decodercontext->g.buffer, tp->tpdata_size);
bytestream2_skip(&decodercontext->g, tp->tpdata_size);
continue;