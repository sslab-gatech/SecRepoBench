if (decodercontext->has_ppt) {
    bytestream2_init(&tp->packed_headers_stream, tp->ppt_data, tp->ppt_data_size);
} else if (decodercontext->has_ppm) {
    bytestream2_init(&tp->packed_headers_stream, decodercontext->packed_headers + tp->ppm_data_start, tp->ppm_data_size);
}
if ((ret = init_tile(decodercontext, decodercontext->curtileno)) < 0)
    return ret;
if (!(tp->tp_end = bytestream2_get_byteu(&decodercontext->g))) {
    bytestream2_seek(&decodercontext->g, oldpos + len, SEEK_SET);
    continue;
}
tp->tp_end = oldpos + len + tp->tp_end;

if (bytestream2_get_bytes_left(&decodercontext->g) < tp->tp_end - oldpos - 2) {
    av_log(decodercontext->avctx, AV_LOG_ERROR, "Invalid tile size\n");
    return AVERROR_INVALIDDATA;
}

if (decodercontext->ncomponents) {
    ret = jpeg2000_decode_packets_po_iteration(decodercontext, tile,
                                               decodercontext->poc.RSpoc[decodercontext->tp_idx],
                                               decodercontext->poc.CSpoc[decodercontext->tp_idx],
                                               decodercontext->poc.LYEpoc[decodercontext->tp_idx],
                                               decodercontext->poc.REpoc[decodercontext->tp_idx],
                                               decodercontext->poc.CEpoc[decodercontext->tp_idx],
                                               decodercontext->poc.Ppoc[decodercontext->tp_idx],
                                               &tile->tp_idx);
}
bytestream2_seek(&decodercontext->g, tp->tp_end, SEEK_SET);
continue;