if (tile->tp_idx == 0 && s->has_ppt) {
    bytestream2_init(&s->packed_headers_stream, tile->packed_headers, tile->packed_headers_size);
}

Jpeg2000TilePart *tp = tile->tile_part + tile->tp_idx;
int stream_end = bytestream2_tell(&s->g) + tp->tp_end - tp->tp_start;

if (stream_end > s->g.buffer_end - s->g.buffer) {
    av_log(s->avctx, AV_LOG_ERROR, "Invalid tile part length\n");
    return AVERROR_INVALIDDATA;
}

bytestream2_init(&tp->tpg, s->g.buffer, tp->tp_end - tp->tp_start);
bytestream2_skip(&s->g, tp->tp_end - tp->tp_start);

tile->tp_idx++;
continue;