{
    /*
     * ID already exists, reuse the existing one and update the attribute
     */
    
    /*
     * Clear the previous association between ID and attribute
     */
    if (ret->attr != NULL && !streaming) {
        ret->attr->id = NULL;
    }
    
    /*
     * Update the ID with the new attribute
     */
    if (streaming) {
        /*
         * Operating in streaming mode, attr is gonna disappear
         */
        if (ret->name != NULL) {
            xmlFree((xmlChar *)ret->name);
        }
        if (doc->dict != NULL)
            ret->name = xmlDictLookup(doc->dict, attribute->name, -1);
        else
            ret->name = xmlStrdup(attribute->name);
        if (ret->name == NULL) {
            return(-1);
        }
        ret->attr = NULL;
    } else {
        ret->attr = attribute;
        ret->name = NULL;
    }
    
    /*
     * Update the line number
     */
    ret->lineno = xmlGetLineNo(attribute->parent);
    
    /*
     * Update the attribute to point to this ID
     */
    attribute->atype = XML_ATTRIBUTE_ID;
    if (!streaming)
        attribute->id = ret;
    
    if (id != NULL)
        *id = ret;
    
    return(1);
}