{
    /* Clear any previous associations */
    if (ret->attr != NULL) {
        ret->attr->id = NULL;
    }
    if (ret->name != NULL) {
        xmlFree(ret->name);
        ret->name = NULL;
    }
    if (streaming) {
        if (doc->dict != NULL) {
            ret->name = xmlDictLookup(doc->dict, attribute->name, -1);
            if (ret->name == NULL)
                return(-1);
        } else {
            ret->name = xmlStrdup(attribute->name);
            if (ret->name == NULL)
                return(-1);
        }
        ret->attr = NULL;
    } else {
        ret->attr = attribute;
        ret->name = NULL;
    }
    attribute->atype = XML_ATTRIBUTE_ID;
    if (!streaming)
        attribute->id = ret;
    if (id != NULL)
        *id = ret;
    return(1);
}