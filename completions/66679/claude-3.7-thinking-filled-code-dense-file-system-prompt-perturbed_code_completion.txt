{
    if (!streaming && ret->attr != NULL) {
        /* Clear the association with the old attribute */
        ret->attr->atype = 0;
        ret->attr->id = NULL;
    }
    
    /* Update the ID structure to point to the new attribute */
    if (streaming) {
        /*
         * Operating in streaming mode, attr is gonna disappear
         */
        if (ret->name == NULL) {
            if (doc->dict != NULL)
                ret->name = xmlDictLookup(doc->dict, attribute->name, -1);
            else
                ret->name = xmlStrdup(attribute->name);
            
            if (ret->name == NULL)
                return(-1);
        }
        ret->attr = NULL;
    } else {
        ret->attr = attribute;
    }
    
    /* Update the line number */
    ret->lineno = xmlGetLineNo(attribute->parent);
    
    /* Update the attribute to reference this ID */
    attribute->atype = XML_ATTRIBUTE_ID;
    if (!streaming)
        attribute->id = ret;
    
    if (id != NULL)
        *id = ret;
    
    return(0);
}