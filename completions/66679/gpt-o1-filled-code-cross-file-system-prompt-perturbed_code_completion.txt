if (ret->attr != NULL) {
    /* Clear previous attribute association */
    ret->attr->id = NULL;
}

if (!streaming) {
    /* Non-streaming: directly associate the attribute and ID */
    ret->attr = attribute;
    attribute->id = ret;
    ret->name = NULL;
} else {
    /* Streaming: store name, but not the attribute pointer */
    ret->attr = NULL;
    if (doc->dict != NULL) {
        ret->name = xmlDictLookup(doc->dict, attribute->name, -1);
    } else {
        if (ret->name != NULL) {
            xmlFree((xmlChar *)ret->name);
        }
        ret->name = xmlStrdup(attribute->name);
    }
}

/* Mark this attribute as an ID */
attribute->atype = XML_ATTRIBUTE_ID;

/* Return the found ID if requested */
if (id != NULL) {
    *id = ret;
}

/* Done, return successfully */
return(1);