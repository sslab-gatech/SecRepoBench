// <MASK>
if (ret != NULL) {
    // Update the existing ID in the table with the new attribute
    ret->attr = attr;
    // Clear any previous association between the attribute and an ID
    if (ret->attr != NULL)
        ret->attr->id = NULL;
    // Associate the attribute with the ID
    attr->id = ret;
    attr->atype = XML_ATTRIBUTE_ID;
    return(1);
} else {
    // Add a new ID to the table
    ret = (xmlIDPtr) xmlMalloc(sizeof(xmlID));
    if (ret == NULL)
        return(-1);
    memset(ret, 0, sizeof(*ret));
    ret->doc = doc;
    ret->value = xmlStrdup(value);
    if (ret->value == NULL) {
        xmlFree(ret);
        return(-1);
    }
    ret->attr = attr;
    attr->id = ret;
    attr->atype = XML_ATTRIBUTE_ID;
    if (xmlHashAddEntry(table, value, ret) < 0) {
        xmlFreeID(ret);
        return(-1);
    }
    return(1);
}