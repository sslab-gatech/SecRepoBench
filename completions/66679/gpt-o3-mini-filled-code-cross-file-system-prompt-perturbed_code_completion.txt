if (!streaming) {
        if (ret->attr != NULL)
            ret->attr->id = NULL;
        ret->attr = attribute;
    } else {
        /* In streaming mode, the attribute node won't persist, so update the name instead. */
        if (ret->name != NULL) {
            /* If the previous name was dynamically allocated, it might be freed here.
             * However, typically the name comes either from the dictionary lookup
             * or was set before, so we simply overwrite it.
             */
        }
        ret->name = (doc->dict != NULL) ? xmlDictLookup(doc->dict, attribute->name, -1)
                                        : xmlStrdup(attribute->name);
    }
    attribute->atype = XML_ATTRIBUTE_ID;
    if (!streaming)
        attribute->id = ret;
    if (id != NULL)
        *id = ret;
    return(1);