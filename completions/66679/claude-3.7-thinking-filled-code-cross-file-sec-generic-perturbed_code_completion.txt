{
    if (streaming) {
        // In streaming mode, update ret->name and clear ret->attr
        if (ret->attr != NULL) {
            ret->attr->id = NULL;  // Clear the old attribute's association
            ret->attr = NULL;      // Clear the reference to the old attribute
        }
        
        // Update ret->name based on the attribute's name
        if (doc->dict != NULL) {
            ret->name = xmlDictLookup(doc->dict, attribute->name, -1);
        } else {
            xmlChar *tmp = xmlStrdup(attribute->name);
            if (tmp == NULL) {
                // Handle memory allocation failure gracefully
                return(-1);
            }
            ret->name = tmp;  // Note: potential memory leak if ret->name was previously set
        }
    } else {
        // In non-streaming mode, clear the old attribute's association if it exists
        if (ret->attr != NULL) {
            ret->attr->id = NULL;  // Clear the old attribute's association
        }
        
        ret->attr = attribute;  // Set the ID to point to the new attribute
        ret->name = NULL;       // Clear the name in non-streaming mode
        
        attribute->id = ret;    // Set the attribute to point to the ID
    }
    
    attribute->atype = XML_ATTRIBUTE_ID;  // Mark it as an ID attribute
    ret->lineno = xmlGetLineNo(attribute->parent);  // Update the line number
    
    if (id != NULL)
        *id = ret;
    
    return(1);  // Success
}