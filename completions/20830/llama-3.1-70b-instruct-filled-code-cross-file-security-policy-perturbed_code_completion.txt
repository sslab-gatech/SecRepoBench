// Extract and store the "username" and "password" from the IMAP LOGIN command.
// Copy the packet payload into a temporary string buffer.
// Ensure the copied string is null-terminated.
// Locate the first double quote character, marking the start of the username.
// Find the next double quote to identify the end of the username and store it.
// Locate the next pair of double quotes to extract the password and store it.
// The extracted username and password are stored within the flow structure.

u_int16_t username_start = 0;
u_int16_t username_end = 0;
u_int16_t password_start = 0;
u_int16_t password_end = 0;
u_int16_t i = 0;

// Copy the packet payload into a temporary string buffer.
char temp_buffer[flow_packet->payload_packet_len + 1];
memcpy(temp_buffer, flow_packet->payload, flow_packet->payload_packet_len);
temp_buffer[flow_packet->payload_packet_len] = '\0'; // Ensure null-termination.

// Locate the first double quote character, marking the start of the username.
for (i = 0; i < flow_packet->payload_packet_len; i++) {
  if (temp_buffer[i] == '"') {
    username_start = i + 1;
    break;
  }
}

// Find the next double quote to identify the end of the username and store it.
for (i = username_start; i < flow_packet->payload_packet_len; i++) {
  if (temp_buffer[i] == '"') {
    username_end = i;
    break;
  }
}

// Locate the next pair of double quotes to extract the password and store it.
for (i = username_end + 1; i < flow_packet->payload_packet_len; i++) {
  if (temp_buffer[i] == '"') {
    password_start = i + 1;
    break;
  }
}

for (i = password_start; i < flow_packet->payload_packet_len; i++) {
  if (temp_buffer[i] == '"') {
    password_end = i;
    break;
  }
}

// Store the extracted username and password within the flow structure.
memcpy(flow->protos.ftp_imap_pop_smtp.username, &temp_buffer[username_start], username_end - username_start);
flow->protos.ftp_imap_pop_smtp.username[username_end - username_start] = '\0'; // Ensure null-termination.

memcpy(flow->protos.ftp_imap_pop_smtp.password, &temp_buffer[password_start], password_end - password_start);
flow->protos.ftp_imap_pop_smtp.password[password_end - password_start] = '\0'; // Ensure null-termination.