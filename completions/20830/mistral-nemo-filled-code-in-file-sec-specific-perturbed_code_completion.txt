// <MASK>
if (command_start + 5 < flow_packet->payload_packet_len) {
  if ((flow_packet->payload[command_start] == 'L' || flow_packet->payload[command_start] == 'l')
      && (flow_packet->payload[command_start + 1] == 'O' || flow_packet->payload[command_start + 1] == 'o')
      && (flow_packet->payload[command_start + 2] == 'G' || flow_packet->payload[command_start + 2] == 'g')
      && (flow_packet->payload[command_start + 3] == 'I' || flow_packet->payload[command_start + 3] == 'i')
      && (flow_packet->payload[command_start + 4] == 'N' || flow_packet->payload[command_start + 4] == 'n')) {
    // Extract and store the "username" and "password" from the IMAP LOGIN command.
    // Copy the packet payload into a temporary string buffer.
    // Ensure the copied string is null-terminated.
    // Locate the first double quote character, marking the start of the username.
    // Find the next double quote to identify the end of the username and store it.
    // Locate the next pair of double quotes to extract the password and store it.
    // The extracted username and password are stored within the flow structure.
    char *payload = (char *)flow_packet->payload;
    char *username_start = strchr(payload + command_start, '"');
    if (username_start) {
      char *username_end = strchr(username_start + 1, '"');
      if (username_end) {
        size_t username_len = username_end - username_start - 1;
        strncpy(flow->protos.ftp_imap_pop_smtp.username, username_start + 1, username_len);
        flow->protos.ftp_imap_pop_smtp.username[username_len] = '\0';

        char *password_start = strchr(username_end + 1, '"');
        if (password_start) {
          char *password_end = strchr(password_start + 1, '"');
          if (password_end) {
            size_t password_len = password_end - password_start - 1;
            strncpy(flow->protos.ftp_imap_pop_smtp.password, password_start + 1, password_len);
            flow->protos.ftp_imap_pop_smtp.password[password_len] = '\0';
          }
        }
      }
    }
    flow->l4.tcp.mail_imap_stage += 1;
    saw_command = 1;
  }
// </MASK>