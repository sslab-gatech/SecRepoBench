char buf[128], *username, *password;
if (flow_packet->payload_packet_len > (command_start + 6 + 2)) { // +6 for "LOGIN " length, +2 for minimum username/password
  // Copy the command part to a temporary buffer for safe parsing
  u_int16_t buf_len = flow_packet->payload_packet_len - command_start;
  if(buf_len > sizeof(buf)-1) buf_len = sizeof(buf)-1; // Prevent buffer overflow
  memcpy(buf, &flow_packet->payload[command_start], buf_len);
  buf[buf_len] = '\0'; // Ensure null-termination
  
  // Find first quote for username
  username = strchr(buf, '"');
  if(username != NULL) {
    username++; // Skip the quote
    // Find the closing quote for username
    char *username_end = strchr(username, '"');
    if(username_end != NULL && username_end > username) {
      u_int16_t username_len = username_end - username;
      if(username_len < sizeof(flow->protos.ftp_imap_pop_smtp.username)-1) {
        memcpy(flow->protos.ftp_imap_pop_smtp.username, username, username_len);
        flow->protos.ftp_imap_pop_smtp.username[username_len] = '\0';
        
        // Now look for the password - search after the username end quote
        password = strchr(username_end + 1, '"');
        if(password != NULL) {
          password++; // Skip the quote
          // Find the closing quote for password
          char *password_end = strchr(password, '"');
          if(password_end != NULL && password_end > password) {
            u_int16_t password_len = password_end - password;
            if(password_len < sizeof(flow->protos.ftp_imap_pop_smtp.password)-1) {
              memcpy(flow->protos.ftp_imap_pop_smtp.password, password, password_len);
              flow->protos.ftp_imap_pop_smtp.password[password_len] = '\0';
            }
          }
        }
      }
    }
  }
}