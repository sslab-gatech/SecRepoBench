// Extract and store the "username" and "password" from the IMAP LOGIN command.
char temp_buffer[1024]; // Temporary buffer to hold the payload
size_t payload_len = flow_packet->payload_packet_len;

// Ensure the payload length does not exceed the buffer size
if (payload_len >= sizeof(temp_buffer)) {
  goto imap_excluded; // Exclude if payload is too large
}

// Copy the payload into the temporary buffer and null-terminate it
memcpy(temp_buffer, flow_packet->payload, payload_len);
temp_buffer[payload_len] = '\0';

// Locate the first double quote character for the username
char *username_start = strchr(temp_buffer + command_start, '"');
if (username_start == NULL) {
  goto imap_excluded; // Exclude if no starting quote is found
}

// Locate the ending double quote for the username
char *username_end = strchr(username_start + 1, '"');
if (username_end == NULL) {
  goto imap_excluded; // Exclude if no ending quote is found
}

// Locate the starting double quote for the password
char *password_start = strchr(username_end + 1, '"');
if (password_start == NULL) {
  goto imap_excluded; // Exclude if no starting quote for password is found
}

// Locate the ending double quote for the password
char *password_end = strchr(password_start + 1, '"');
if (password_end == NULL) {
  goto imap_excluded; // Exclude if no ending quote for password is found
}

// Extract and store the username
size_t username_len = username_end - username_start - 1;
if (username_len >= sizeof(flow->protos.ftp_imap_pop_smtp.username)) {
  goto imap_excluded; // Exclude if username is too long
}
memcpy(flow->protos.ftp_imap_pop_smtp.username, username_start + 1, username_len);
flow->protos.ftp_imap_pop_smtp.username[username_len] = '\0';

// Extract and store the password
size_t password_len = password_end - password_start - 1;
if (password_len >= sizeof(flow->protos.ftp_imap_pop_smtp.password)) {
  goto imap_excluded; // Exclude if password is too long
}
memcpy(flow->protos.ftp_imap_pop_smtp.password, password_start + 1, password_len);
flow->protos.ftp_imap_pop_smtp.password[password_len] = '\0';