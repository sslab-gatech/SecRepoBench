{
  char tmp[256];
  int len = (flow_packet->payload_packet_len < (sizeof(tmp)-1)) ? flow_packet->payload_packet_len : (sizeof(tmp)-1);
  int u_start = -1, u_end = -1, p_start = -1, p_end = -1;
  int j, dq_count = 0;

  memcpy(tmp, (const char*)&flow_packet->payload[0], len);
  tmp[len] = '\0';

  // Find the first double quote (start of username)
  for(j = command_start; j < len; j++) {
    if(tmp[j] == '"') {
      dq_count++;
      if(dq_count == 1) u_start = j+1;
      else if(dq_count == 2) { u_end = j; break; }
    }
  }
  if(u_start >= 0 && u_end > u_start && (u_end-u_start) < (int)sizeof(flow->protos.ftp_imap_pop_smtp.username)) {
    memcpy(flow->protos.ftp_imap_pop_smtp.username, &tmp[u_start], u_end-u_start);
    flow->protos.ftp_imap_pop_smtp.username[u_end-u_start] = '\0';
  }

  // Find the next pair of double quotes for password
  dq_count = 0;
  for(j = u_end+1; j < len; j++) {
    if(tmp[j] == '"') {
      dq_count++;
      if(dq_count == 1) p_start = j+1;
      else if(dq_count == 2) { p_end = j; break; }
    }
  }
  if(p_start >= 0 && p_end > p_start && (p_end-p_start) < (int)sizeof(flow->protos.ftp_imap_pop_smtp.password)) {
    memcpy(flow->protos.ftp_imap_pop_smtp.password, &tmp[p_start], p_end-p_start);
    flow->protos.ftp_imap_pop_smtp.password[p_end-p_start] = '\0';
  }
}