char tmp_payload[NDPI_PAYLOAD_MAX_LEN];
	char *username_start = NULL;
	char *username_end = NULL;
	char *password_start = NULL;
	char *password_end = NULL;
	size_t payload_len = flow_packet->payload_packet_len;

	if (payload_len >= NDPI_PAYLOAD_MAX_LEN)
		payload_len = NDPI_PAYLOAD_MAX_LEN - 1;

	memcpy(tmp_payload, flow_packet->payload, payload_len);
	tmp_payload[payload_len] = '\0';

	username_start = strchr(tmp_payload + command_start, '"');
	if (username_start != NULL) {
		username_start++;
		username_end = strchr(username_start, '"');
		if (username_end != NULL) {
			size_t username_len = username_end - username_start;
			if (username_len < sizeof(flow->protos.ftp_imap_pop_smtp.username)) {
				strncpy(flow->protos.ftp_imap_pop_smtp.username, username_start, username_len);
				flow->protos.ftp_imap_pop_smtp.username[username_len] = '\0';

				password_start = strchr(username_end + 1, '"');
				if (password_start != NULL) {
					password_start++;
					password_end = strchr(password_start, '"');
					if (password_end != NULL) {
						size_t password_len = password_end - password_start;
						if (password_len < sizeof(flow->protos.ftp_imap_pop_smtp.password)) {
							strncpy(flow->protos.ftp_imap_pop_smtp.password, password_start, password_len);
							flow->protos.ftp_imap_pop_smtp.password[password_len] = '\0';
						} else {
							NDPI_LOG_DBG(ndpi_struct, "IMAP password too long\n");
						}
					} else {
						NDPI_LOG_DBG(ndpi_struct, "IMAP password end quote not found\n");
					}
				} else {
					NDPI_LOG_DBG(ndpi_struct, "IMAP password start quote not found\n");
				}
			} else {
				NDPI_LOG_DBG(ndpi_struct, "IMAP username too long\n");
			}
		} else {
			NDPI_LOG_DBG(ndpi_struct, "IMAP username end quote not found\n");
		}
	} else {
		NDPI_LOG_DBG(ndpi_struct, "IMAP username start quote not found\n");
	}