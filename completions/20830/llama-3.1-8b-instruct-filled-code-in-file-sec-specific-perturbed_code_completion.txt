// Extract and store the "username" and "password" from the IMAP LOGIN command.
// Copy the packet payload into a temporary string buffer.
// Ensure the copied string is null-terminated.
// Locate the first double quote character, marking the start of the username.
// Find the next double quote to identify the end of the username and store it.
// Locate the next pair of double quotes to extract the password and store it.
// The extracted username and password are stored within the flow structure.
char *username = NULL;
char *password = NULL;
char temp_buffer[1024];
strncpy(temp_buffer, flow_packet->payload, flow_packet->payload_packet_len);
temp_buffer[flow_packet->payload_packet_len] = '\0';

char *start_username = strstr(temp_buffer, "\"");
if (start_username!= NULL) {
    start_username++;
    char *end_username = strstr(start_username, "\"");
    if (end_username!= NULL) {
        username = malloc(end_username - start_username + 1);
        strncpy(username, start_username, end_username - start_username);
        username[end_username - start_username] = '\0';
    }
}

char *start_password = strstr(end_username, "\"");
if (start_password!= NULL) {
    start_password++;
    char *end_password = strstr(start_password, "\"");
    if (end_password!= NULL) {
        password = malloc(end_password - start_password + 1);
        strncpy(password, start_password, end_password - start_password);
        password[end_password - start_password] = '\0';
    }
}

// Store the extracted username and password within the flow structure.
if (username!= NULL && password!= NULL) {
    strncpy(flow->l4.tcp.mail_imap_username, username, strlen(username));
    flow->l4.tcp.mail_imap_username[strlen(username)] = '\0';
    strncpy(flow->l4.tcp.mail_imap_password, password, strlen(password));
    flow->l4.tcp.mail_imap_password[strlen(password)] = '\0';
    free(username);
    free(password);
}

flow->l4.tcp.mail_imap_stage += 1;
saw_command = 1;