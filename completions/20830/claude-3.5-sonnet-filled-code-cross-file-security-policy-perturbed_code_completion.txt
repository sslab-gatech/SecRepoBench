char temp_buffer[256];
u_int16_t username_start, username_end, password_start, password_end;

if (flow_packet->payload_packet_len < sizeof(temp_buffer)) {
  strncpy(temp_buffer, (char *)flow_packet->payload, flow_packet->payload_packet_len);
  temp_buffer[flow_packet->payload_packet_len - 1] = '\0';

  username_start = strchr(temp_buffer, '"') - temp_buffer + 1;
  if (username_start < flow_packet->payload_packet_len) {
    username_end = strchr(temp_buffer + username_start, '"') - temp_buffer;
    if (username_end < flow_packet->payload_packet_len && username_end > username_start) {
      strncpy(flow->protos.ftp_imap_pop_smtp.username, temp_buffer + username_start, MIN(username_end - username_start, sizeof(flow->protos.ftp_imap_pop_smtp.username) - 1));
      flow->protos.ftp_imap_pop_smtp.username[MIN(username_end - username_start, sizeof(flow->protos.ftp_imap_pop_smtp.username) - 1)] = '\0';

      password_start = strchr(temp_buffer + username_end + 1, '"') - temp_buffer + 1;
      if (password_start < flow_packet->payload_packet_len) {
        password_end = strchr(temp_buffer + password_start, '"') - temp_buffer;
        if (password_end < flow_packet->payload_packet_len && password_end > password_start) {
          strncpy(flow->protos.ftp_imap_pop_smtp.password, temp_buffer + password_start, MIN(password_end - password_start, sizeof(flow->protos.ftp_imap_pop_smtp.password) - 1));
          flow->protos.ftp_imap_pop_smtp.password[MIN(password_end - password_start, sizeof(flow->protos.ftp_imap_pop_smtp.password) - 1)] = '\0';
        }
      }
    }
  }
}