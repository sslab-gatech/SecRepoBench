// Ensure the payload length is sufficient to avoid buffer over-read
if (command_start + 1 < flow_packet->payload_packet_len) {
  // Locate the first double quote character marking the start of the username
  u_int16_t username_start = command_start + 5; // Skip "LOGIN" and space
  while (username_start < flow_packet->payload_packet_len && flow_packet->payload[username_start] != '"') {
    username_start++;
  }

  if (username_start < flow_packet->payload_packet_len && flow_packet->payload[username_start] == '"') {
    // Find the next double quote to identify the end of the username
    u_int16_t username_end = username_start + 1;
    while (username_end < flow_packet->payload_packet_len && flow_packet->payload[username_end] != '"') {
      username_end++;
    }

    if (username_end < flow_packet->payload_packet_len && flow_packet->payload[username_end] == '"') {
      // Extract the username
      u_int16_t username_length = username_end - username_start - 1;
      if (username_length > 0 && username_length <= sizeof(flow->protos.ftp_imap_pop_smtp.username) - 1) {
        memcpy(flow->protos.ftp_imap_pop_smtp.username, &flow_packet->payload[username_start + 1], username_length);
        flow->protos.ftp_imap_pop_smtp.username[username_length] = '\0';
      }

      // Locate the start of the password
      u_int16_t password_start = username_end + 1;
      while (password_start < flow_packet->payload_packet_len && flow_packet->payload[password_start] != '"') {
        password_start++;
      }

      if (password_start < flow_packet->payload_packet_len && flow_packet->payload[password_start] == '"') {
        // Find the next double quote to identify the end of the password
        u_int16_t password_end = password_start + 1;
        while (password_end < flow_packet->payload_packet_len && flow_packet->payload[password_end] != '"') {
          password_end++;
        }

        if (password_end < flow_packet->payload_packet_len && flow_packet->payload[password_end] == '"') {
          // Extract the password
          u_int16_t password_length = password_end - password_start - 1;
          if (password_length > 0 && password_length <= sizeof(flow->protos.ftp_imap_pop_smtp.password) - 1) {
            memcpy(flow->protos.ftp_imap_pop_smtp.password, &flow_packet->payload[password_start + 1], password_length);
            flow->protos.ftp_imap_pop_smtp.password[password_length] = '\0';
          }
        }
      }
    }
  }
}