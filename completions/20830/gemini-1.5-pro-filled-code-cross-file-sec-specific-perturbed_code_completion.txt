u_int32_t username_start = 0;
u_int32_t username_end = 0;
u_int32_t password_start = 0;
u_int32_t password_end = 0;
char *payload_copy = (char *)malloc((flow_packet->payload_packet_len + 1) * sizeof(char));
if (payload_copy == NULL) {
    return;
}
memcpy(payload_copy, flow_packet->payload, flow_packet->payload_packet_len);
payload_copy[flow_packet->payload_packet_len] = '\0';

for (i = command_start; i < flow_packet->payload_packet_len; i++) {
    if (payload_copy[i] == '"') {
        username_start = i + 1;
        break;
    }
}
for (i = username_start; i < flow_packet->payload_packet_len; i++) {
    if (payload_copy[i] == '"') {
        username_end = i;
        break;
    }
}
for (i = username_end + 1; i < flow_packet->payload_packet_len; i++) {
    if (payload_copy[i] == '"') {
        password_start = i + 1;
        break;
    }
}
for (i = password_start; i < flow_packet->payload_packet_len; i++) {
    if (payload_copy[i] == '"') {
        password_end = i;
        break;
    }
}

if (username_start > 0 && username_end > username_start && password_start > 0 && password_end > password_start) {
    if ((username_end - username_start) < 256) {
        memcpy(flow->protos.ftp_imap_pop_smtp.username, payload_copy + username_start, username_end - username_start);
        flow->protos.ftp_imap_pop_smtp.username[username_end - username_start] = '\0';
    }
    if ((password_end - password_start) < 256) {
        memcpy(flow->protos.ftp_imap_pop_smtp.password, payload_copy + password_start, password_end - password_start);
        flow->protos.ftp_imap_pop_smtp.password[password_end - password_start] = '\0';
    }
}
free(payload_copy);