char imap_string[flow_packet->payload_packet_len + 1];
  u_int16_t imap_username_start = 0;
  u_int16_t imap_username_end = 0;
  u_int16_t imap_password_start = 0;
  u_int16_t imap_password_end = 0;

  memcpy(imap_string, flow_packet->payload, flow_packet->payload_packet_len);
  imap_string[flow_packet->payload_packet_len] = '\0';

  for (i = command_start; i < flow_packet->payload_packet_len; i++) {
    if (imap_string[i] == '"') {
      if (imap_username_start == 0) {
        imap_username_start = i + 1;
      } else if (imap_username_end == 0) {
        imap_username_end = i;
      } else if (imap_password_start == 0) {
        imap_password_start = i + 1;
      } else {
        imap_password_end = i;
        break;
      }
    }
  }

  if (imap_username_start > 0 && imap_username_end > 0) {
    if ((imap_username_end - imap_username_start) < 256) {
      memcpy(flow->protos.ftp_imap_pop_smtp.username, &imap_string[imap_username_start], imap_username_end - imap_username_start);
      flow->protos.ftp_imap_pop_smtp.username[imap_username_end - imap_username_start] = '\0';
    }
  }

  if (imap_password_start > 0 && imap_password_end > 0) {
    if ((imap_password_end - imap_password_start) < 256) {
      memcpy(flow->protos.ftp_imap_pop_smtp.password, &imap_string[imap_password_start], imap_password_end - imap_password_start);
      flow->protos.ftp_imap_pop_smtp.password[imap_password_end - imap_password_start] = '\0';
    }
  }