if((flow_packet->payload[command_start] == 'L' || flow_packet->payload[command_start] == 'l')
    && (flow_packet->payload[command_start + 1] == 'O' || flow_packet->payload[command_start + 1] == 'o')
    && (flow_packet->payload[command_start + 2] == 'G' || flow_packet->payload[command_start + 2] == 'g')
    && (flow_packet->payload[command_start + 3] == 'I' || flow_packet->payload[command_start + 3] == 'i')
    && (flow_packet->payload[command_start + 4] == 'N' || flow_packet->payload[command_start + 4] == 'n')) {
  // Extract and store the "username" and "password" from the IMAP LOGIN command.
  // Copy the packet payload into a temporary string buffer.
  // Ensure the copied string is null-terminated.
  // Locate the first double quote character, marking the start of the username.
  // Find the next double quote to identify the end of the username and store it.
  // Locate the next pair of double quotes to extract the password and store it.
  // The extracted username and password are stored within the flow structure.
  char *username = NULL;
  char *password = NULL;
  char temp_buffer[flow_packet->payload_packet_len + 1];
  memcpy(temp_buffer, flow_packet->payload, flow_packet->payload_packet_len);
  temp_buffer[flow_packet->payload_packet_len] = '\0';
  size_t username_start = 0;
  size_t username_end = 0;
  size_t password_start = 0;
  size_t password_end = 0;
  for (size_t i = 0; i < flow_packet->payload_packet_len; i++) {
    if (temp_buffer[i] == '"') {
      if (username_start == 0) {
        username_start = i + 1;
      } else if (username_end == 0) {
        username_end = i;
        break;
      }
    }
  }
  username = malloc(username_end - username_start + 2);
  memcpy(username, &temp_buffer[username_start], username_end - username_start + 1);
  username[username_end - username_start] = '\0';
  for (size_t i = username_end + 1; i < flow_packet->payload_packet_len; i++) {
    if (temp_buffer[i] == '"') {
      password_start = i + 1;
      break;
    }
  }
  for (size_t i = password_start; i < flow_packet->payload_packet_len; i++) {
    if (temp_buffer[i] == '"') {
      password_end = i;
      break;
    }
  }
  password = malloc(password_end - password_start + 2);
  memcpy(password, &temp_buffer[password_start], password_end - password_start + 1);
  password[password_end - password_start] = '\0';
  flow->l4.tcp.mail_imap_username = strdup(username);
  flow->l4.tcp.mail_imap_password = strdup(password);
  free(username);
  free(password);
  flow->l4.tcp.mail_imap_stage += 1;
  saw_command = 1;
}