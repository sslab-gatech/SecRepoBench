u_int16_t idx = command_start + 5; // "LOGIN" is 5 characters
char tmp[256];
u_int16_t tmp_len = sizeof(tmp)-1;

// Skip whitespace after LOGIN command
while(idx < flow_packet->payload_packet_len && (flow_packet->payload[idx] == ' ' || flow_packet->payload[idx] == '\t'))
    idx++;

// Find username start quote
u_int16_t user_start = idx;
while(user_start < flow_packet->payload_packet_len && flow_packet->payload[user_start] != '"')
    user_start++;
if(++user_start >= flow_packet->payload_packet_len) return;

// Find username end quote
u_int16_t user_end = user_start;
while(user_end < flow_packet->payload_packet_len && flow_packet->payload[user_end] != '"')
    user_end++;

// Find password start quote
u_int16_t pass_start = user_end + 1;
while(pass_start < flow_packet->payload_packet_len && (flow_packet->payload[pass_start] == ' ' || flow_packet->payload[pass_start] == '\t' || flow_packet->payload[pass_start] != '"'))
    pass_start++;
if(++pass_start >= flow_packet->payload_packet_len) return;

// Find password end quote
u_int16_t pass_end = pass_start;
while(pass_end < flow_packet->payload_packet_len && flow_packet->payload[pass_end] != '"')
    pass_end++;

// Copy username
u_int16_t len = MIN(user_end - user_start, tmp_len);
len = MIN(len, sizeof(flow->protos.ftp_imap_pop_smtp.username)-1);
if(len > 0) {
    strncpy(flow->protos.ftp_imap_pop_smtp.username, (char*)&flow_packet->payload[user_start], len);
    flow->protos.ftp_imap_pop_smtp.username[len] = '\0';
}

// Copy password
len = MIN(pass_end - pass_start, tmp_len);
len = MIN(len, sizeof(flow->protos.ftp_imap_pop_smtp.password)-1);
if(len > 0) {
    strncpy(flow->protos.ftp_imap_pop_smtp.password, (char*)&flow_packet->payload[pass_start], len);
    flow->protos.ftp_imap_pop_smtp.password[len] = '\0';
}