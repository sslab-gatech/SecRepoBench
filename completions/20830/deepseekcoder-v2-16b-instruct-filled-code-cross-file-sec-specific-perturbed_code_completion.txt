// Extract and store the "username" and "password" from the IMAP LOGIN command.
// Copy the packet payload into a temporary string buffer.
// Ensure the copied string is null-terminated.
// Locate the first double quote character, marking the start of the username.
// Find the next double quote to identify the end of the username and store it.
// Locate the next pair of double quotes to extract the password and store it.
// The extracted username and password are stored within the flow structure.
char temp_buffer[flow_packet->payload_packet_len + 1];
memcpy(temp_buffer, flow_packet->payload, flow_packet->payload_packet_len);
temp_buffer[flow_packet->payload_packet_len] = '\0';

char *username_start = strchr(temp_buffer, '"');
if (username_start) {
    char *username_end = strchr(username_start + 1, '"');
    if (username_end) {
        size_t username_len = username_end - username_start - 1;
        if (username_len > 0) {
            memset(flow->protos.ftp_imap_pop_smtp.username, 0, NDPI_PROTOCOL_MAIL_IMAP_USERNAME_LEN);
            memcpy(flow->protos.ftp_imap_pop_smtp.username, username_start + 1, username_len);
        }
    }
}

char *password_start = strchr(username_end + 1, '"');
if (password_start) {
    char *password_end = strchr(password_start + 1, '"');
    if (password_end) {
        size_t password_len = password_end - password_start - 1;
        if (password_len > 0) {
            memset(flow->protos.ftp_imap_pop_smtp.password, 0, NDPI_PROTOCOL_MAIL_IMAP_PASSWORD_LEN);
            memcpy(flow->protos.ftp_imap_pop_smtp.password, password_start + 1, password_len);
        }
    }
}