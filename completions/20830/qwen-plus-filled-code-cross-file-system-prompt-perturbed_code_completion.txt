char temp_buffer[flow_packet->payload_packet_len + 1];
memcpy(temp_buffer, &flow_packet->payload[command_start], flow_packet->payload_packet_len - command_start);
temp_buffer[flow_packet->payload_packet_len - command_start] = '\0';

// Locate the first double quote character marking the start of the username.
u_int16_t username_start = strcspn(temp_buffer, "\"");
if (username_start == strlen(temp_buffer) || temp_buffer[username_start] != '\"') {
  goto imap_excluded;
}

// Find the next double quote to identify the end of the username.
u_int16_t username_end = username_start + 1;
while (username_end < strlen(temp_buffer) && temp_buffer[username_end] != '\"') {
  username_end++;
}
if (temp_buffer[username_end] != '\"') {
  goto imap_excluded;
}

// Store the extracted username.
u_int16_t username_length = username_end - username_start - 1;
if (username_length > 0 && username_length <= sizeof(flow->protos.ftp_imap_pop_smtp.username) - 1) {
  memcpy(flow->protos.ftp_imap_pop_smtp.username, &temp_buffer[username_start + 1], username_length);
  flow->protos.ftp_imap_pop_smtp.username[username_length] = '\0';
} else {
  goto imap_excluded;
}

// Locate the next pair of double quotes to extract the password.
u_int16_t password_start = username_end + 1;
password_start += strcspn(&temp_buffer[password_start], "\"");
if (password_start >= strlen(temp_buffer) || temp_buffer[password_start] != '\"') {
  goto imap_excluded;
}

u_int16_t password_end = password_start + 1;
while (password_end < strlen(temp_buffer) && temp_buffer[password_end] != '\"') {
  password_end++;
}
if (temp_buffer[password_end] != '\"') {
  goto imap_excluded;
}

// Store the extracted password.
u_int16_t password_length = password_end - password_start - 1;
if (password_length > 0 && password_length <= sizeof(flow->protos.ftp_imap_pop_smtp.password) - 1) {
  memcpy(flow->protos.ftp_imap_pop_smtp.password, &temp_buffer[password_start + 1], password_length);
  flow->protos.ftp_imap_pop_smtp.password[password_length] = '\0';
} else {
  goto imap_excluded;
}