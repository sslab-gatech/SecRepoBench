{
  /* copy payload starting from the command into a temporary buffer */
  #define MAX_TEMP_BUF_LEN 256
  char temp_buf[MAX_TEMP_BUF_LEN];
  u_int16_t copy_len = flow_packet->payload_packet_len - command_start;
  if(copy_len > (MAX_TEMP_BUF_LEN - 1)) {
    copy_len = MAX_TEMP_BUF_LEN - 1;
  }
  memcpy(temp_buf, &flow_packet->payload[command_start], copy_len);
  temp_buf[copy_len] = '\0';

  /* locate username between the first pair of quotes */
  char *p = strchr(temp_buf, '"');
  if(!p) goto skip_login_extract;
  char *username_start = ++p;
  p = strchr(p, '"');
  if(!p) goto skip_login_extract;
  *p = '\0';
  strncpy(flow->protos.ftp_imap_pop_smtp.username, username_start,
          sizeof(flow->protos.ftp_imap_pop_smtp.username) - 1);
  flow->protos.ftp_imap_pop_smtp.username[sizeof(flow->protos.ftp_imap_pop_smtp.username) - 1] = '\0';

  /* locate password between the next pair of quotes */
  p = strchr(++p, '"');
  if(!p) goto skip_login_extract;
  char *password_start = ++p;
  p = strchr(p, '"');
  if(!p) goto skip_login_extract;
  *p = '\0';
  strncpy(flow->protos.ftp_imap_pop_smtp.password, password_start,
          sizeof(flow->protos.ftp_imap_pop_smtp.password) - 1);
  flow->protos.ftp_imap_pop_smtp.password[sizeof(flow->protos.ftp_imap_pop_smtp.password) - 1] = '\0';

skip_login_extract:;
}