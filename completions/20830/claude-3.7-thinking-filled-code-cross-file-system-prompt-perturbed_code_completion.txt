char str[256];
size_t rem_len = flow_packet->payload_packet_len - command_start - 5; // subtract the "LOGIN" command
char *username_start = NULL, *username_end = NULL;
char *password_start = NULL, *password_end = NULL;

if (rem_len > sizeof(str) - 1) rem_len = sizeof(str) - 1;
  
memcpy(str, &flow_packet->payload[command_start + 5], rem_len);
str[rem_len] = '\0';

// Find the first double quote (start of username)
username_start = strchr(str, '"');
if (username_start != NULL) {
  username_start++; // Skip the quote
  username_end = strchr(username_start, '"');
  if (username_end != NULL) {
    // Find the start of password
    password_start = strchr(username_end + 1, '"');
    if (password_start != NULL) {
      password_start++; // Skip the quote
      password_end = strchr(password_start, '"');
    }
  }
}

// Store the username and password if found
if (username_start != NULL && username_end != NULL && 
    password_start != NULL && password_end != NULL) {
  size_t username_len = username_end - username_start;
  size_t password_len = password_end - password_start;
  
  if (username_len < sizeof(flow->protos.ftp_imap_pop_smtp.username)) {
    memcpy(flow->protos.ftp_imap_pop_smtp.username, username_start, username_len);
    flow->protos.ftp_imap_pop_smtp.username[username_len] = '\0';
  }
  
  if (password_len < sizeof(flow->protos.ftp_imap_pop_smtp.password)) {
    memcpy(flow->protos.ftp_imap_pop_smtp.password, password_start, password_len);
    flow->protos.ftp_imap_pop_smtp.password[password_len] = '\0';
  }
}