// Copy the packet payload into a temporary string buffer.
char *temp_str = strndup(flow_packet->payload, flow_packet->payload_packet_len);
if (!temp_str) {
  NDPI_LOG_DBG(ndpi_struct, "Failed to allocate memory for temporary string buffer\n");
  return;
}

// Ensure the copied string is null-terminated.
temp_str[flow_packet->payload_packet_len] = '\0';

// Locate the first double quote character, marking the start of the username.
char *username_start = strchr(temp_str, '"');
if (!username_start) {
  goto imap_excluded;
}

// Find the next double quote to identify the end of the username and store it.
char *username_end = strchr(username_start + 1, '"');
if (!username_end) {
  goto imap_excluded;
}

// Locate the next pair of double quotes to extract the password and store it.
char *password_start = strchr(username_end + 1, '"');
if (!password_start) {
  goto imap_excluded;
}
char *password_end = strchr(password_start + 1, '"');
if (!password_end) {
  goto imap_excluded;
}

// Store the extracted username and password within the flow structure.
strncpy(flow->protos.ftp_imap_pop_smtp.username, username_start + 1, username_end - username_start - 1);
flow->protos.ftp_imap_pop_smtp.username[username_end - username_start - 1] = '\0';
strncpy(flow->protos.ftp_imap_pop_smtp.password, password_start + 1, password_end - password_start - 1);
flow->protos.ftp_imap_pop_smtp.password[password_end - password_start - 1] = '\0';

// Free the temporary string buffer.
free(temp_str);