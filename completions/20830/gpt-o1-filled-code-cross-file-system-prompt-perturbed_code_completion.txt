{
  char tmp_buffer[512];
  /* Make a local copy of the payload so we can manipulate it safely. */
  u_int16_t copy_len = (flow_packet->payload_packet_len < (sizeof(tmp_buffer) - 1))
    ? flow_packet->payload_packet_len
    : (sizeof(tmp_buffer) - 1);
  memcpy(tmp_buffer, flow_packet->payload, copy_len);
  tmp_buffer[copy_len] = '\0';

  /* Search for the first pair of double quotes for the username. */
  char *first_quote = strchr(tmp_buffer, '"');
  if(first_quote) {
    char *second_quote = strchr(first_quote + 1, '"');
    if(second_quote) {
      /* Terminate the username string. */
      *second_quote = '\0';
      strncpy(flow->protos.ftp_imap_pop_smtp.username, first_quote + 1,
              sizeof(flow->protos.ftp_imap_pop_smtp.username) - 1);
      flow->protos.ftp_imap_pop_smtp.username[sizeof(flow->protos.ftp_imap_pop_smtp.username) - 1] = '\0';

      /* Search for the next pair of double quotes for the password. */
      char *third_quote = strchr(second_quote + 1, '"');
      if(third_quote) {
        char *fourth_quote = strchr(third_quote + 1, '"');
        if(fourth_quote) {
          /* Terminate the password string. */
          *fourth_quote = '\0';
          strncpy(flow->protos.ftp_imap_pop_smtp.password, third_quote + 1,
                  sizeof(flow->protos.ftp_imap_pop_smtp.password) - 1);
          flow->protos.ftp_imap_pop_smtp.password[sizeof(flow->protos.ftp_imap_pop_smtp.password) - 1] = '\0';
        }
      }
    }
  }
}