{
  #define MAX_TMP_BUF_LEN 512
  char tmp_buf[MAX_TMP_BUF_LEN];
  memset(tmp_buf, 0, sizeof(tmp_buf));

  /* Copy payload into a temporary buffer, ensuring null termination */
  u_int16_t copy_len = (flow_packet->payload_packet_len < (sizeof(tmp_buf) - 1))
                       ? flow_packet->payload_packet_len
                       : (sizeof(tmp_buf) - 1);
  memcpy(tmp_buf, flow_packet->payload, copy_len);
  tmp_buf[copy_len] = '\0';

  /* Locate the first pair of quotes for the username */
  char *first_quote = strchr(tmp_buf, '"');
  if(first_quote) {
    char *second_quote = strchr(first_quote + 1, '"');
    if(second_quote) {
      /* Extract username between first_quote and second_quote */
      size_t username_len = second_quote - (first_quote + 1);
      if(username_len > 0) {
        if(username_len >= sizeof(flow->protos.ftp_imap_pop_smtp.username)) {
          username_len = sizeof(flow->protos.ftp_imap_pop_smtp.username) - 1;
        }
        memcpy(flow->protos.ftp_imap_pop_smtp.username, first_quote + 1, username_len);
        flow->protos.ftp_imap_pop_smtp.username[username_len] = '\0';
      }

      /* Locate the next pair of quotes for the password */
      char *third_quote = strchr(second_quote + 1, '"');
      if(third_quote) {
        char *fourth_quote = strchr(third_quote + 1, '"');
        if(fourth_quote) {
          /* Extract password between third_quote and fourth_quote */
          size_t password_len = fourth_quote - (third_quote + 1);
          if(password_len > 0) {
            if(password_len >= sizeof(flow->protos.ftp_imap_pop_smtp.password)) {
              password_len = sizeof(flow->protos.ftp_imap_pop_smtp.password) - 1;
            }
            memcpy(flow->protos.ftp_imap_pop_smtp.password, third_quote + 1, password_len);
            flow->protos.ftp_imap_pop_smtp.password[password_len] = '\0';
          }
        }
      }
    }
  }
}