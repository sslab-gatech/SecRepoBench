// Extract and store the "username" and "password" from the IMAP LOGIN command.
char temp_buffer[256];
int username_start, username_end, password_start, password_end;

// Copy the packet payload into a temporary string buffer
strncpy(temp_buffer, (const char*)&(flow_packet->payload[command_start]), sizeof(temp_buffer) - 1);
temp_buffer[sizeof(temp_buffer) - 1] = '\0'; // Ensure null termination

// Locate the first double quote character, marking the start of the username
username_start = strcspn(temp_buffer, "\"");
if (username_start < (int)strlen(temp_buffer)) {
    username_start++; // Skip the opening quote
    username_end = strcspn(&temp_buffer[username_start], "\"");
    if (username_end < (int)strlen(&temp_buffer[username_start])) {
        temp_buffer[username_start + username_end] = '\0'; // Null-terminate the username
        strncpy(flow->protos.ftp_imap_pop_smtp.username, &temp_buffer[username_start], sizeof(flow->protos.ftp_imap_pop_smtp.username) - 1);
        flow->protos.ftp_imap_pop_smtp.username[sizeof(flow->protos.ftp_imap_pop_smtp.username) - 1] = '\0'; // Ensure null termination

        password_start = strcspn(&temp_buffer[username_end + 2], "\"");
        if (password_start < (int)strlen(&temp_buffer[username_end + 2])) {
            password_start += username_end + 2; // Skip the opening quote
            password_end = strcspn(&temp_buffer[password_start], "\"");
            if (password_end < (int)strlen(&temp_buffer[password_start])) {
                temp_buffer[password_start + password_end] = '\0'; // Null-terminate the password
                strncpy(flow->protos.ftp_imap_pop_smtp.password, &temp_buffer[password_start], sizeof(flow->protos.ftp_imap_pop_smtp.password) - 1);
                flow->protos.ftp_imap_pop_smtp.password[sizeof(flow->protos.ftp_imap_pop_smtp.password) - 1] = '\0'; // Ensure null termination
            }
        }
    }
}