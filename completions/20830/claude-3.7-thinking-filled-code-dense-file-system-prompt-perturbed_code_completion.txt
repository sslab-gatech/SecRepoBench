// Look for LOGIN command with quoted username and password: LOGIN "username" "password"
u_int16_t i;
u_int16_t username_start = 0;
u_int16_t username_len = 0;
u_int16_t password_start = 0;
u_int16_t password_len = 0;
int quote_count = 0;

// Search for the quoted strings in the payload
for (i = command_start + 5; i < flow_packet->payload_packet_len - 1; i++) {
  if (flow_packet->payload[i] == '"') {
    quote_count++;
    
    if (quote_count == 1) {
      // First quote - start of username
      username_start = i + 1;
    } else if (quote_count == 2) {
      // Second quote - end of username
      username_len = i - username_start;
    } else if (quote_count == 3) {
      // Third quote - start of password
      password_start = i + 1;
    } else if (quote_count == 4) {
      // Fourth quote - end of password
      password_len = i - password_start;
      break;
    }
  }
}

// Copy username and password if valid
if (username_len > 0 && username_len < sizeof(flow->protos.ftp_imap_pop_smtp.username) &&
    password_len > 0 && password_len < sizeof(flow->protos.ftp_imap_pop_smtp.password)) {
  // Copy username
  strncpy(flow->protos.ftp_imap_pop_smtp.username, (const char*)&flow_packet->payload[username_start], username_len);
  flow->protos.ftp_imap_pop_smtp.username[username_len] = '\0';
  
  // Copy password
  strncpy(flow->protos.ftp_imap_pop_smtp.password, (const char*)&flow_packet->payload[password_start], password_len);
  flow->protos.ftp_imap_pop_smtp.password[password_len] = '\0';
}