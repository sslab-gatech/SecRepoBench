static MagickBooleanType DrawImage(Image *image, const DrawInfo *draw_info,
  ExceptionInfo *exception)
{
  // ... (other code)

  if (draw_info->primitive == (char *) NULL)
    return(MagickFalse);

  // ... (other code)

  if (primitive_info == (PrimitiveInfo *) NULL)
    {
      primitive_info=(PrimitiveInfo *) AcquireQuantumMemory(number_points,
        sizeof(*primitive_info));
      if (primitive_info == (PrimitiveInfo *) NULL)
        {
          (void) ThrowMagickException(exception,GetMagickModule(),
            ResourceLimitError,"MemoryAllocationFailed","`%s'",
            image->filename);
          return(MagickFalse);
        }
    }

  // ... (other code)

  if (primitive_info->text != (char *) NULL)
    primitive_info->text=(char *) RelinquishMagickMemory(
      primitive_info->text);

  // ... (other code)

  if (primitive_info->primitive == ImagePrimitive)
    {
      ssize_t
        length;

      length=strlen(primitive_info->text)+MagickPathExtent;
      if (SetImageStorageClass(image,DirectClass,exception) == MagickFalse)
        return(MagickFalse);
      primitive_info->image=ReadImage(primitive_info->text,exception);
      if (primitive_info->image == (Image *) NULL)
        {
          CatchException(exception);
          primitive_info->image=ReadImage(primitive_info->text,exception);
          if (primitive_info->image == (Image *) NULL)
            {
              (void) ThrowMagickException(exception,GetMagickModule(),
                ResourceLimitError,"MemoryAllocationFailed","`%s'",
                image->filename);
              return(MagickFalse);
            }
        }
      primitive_info->image->storage_class=DirectClass;
      primitive_info->image->matte=CloneMagickMatrix(image->matte);
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->image->matte->depth=image->matte->depth;
      primitive_info->image->matte->colormap=image->matte->colormap;
      primitive_info->image->matte->class=DirectClass;
      primitive_info->image->matte->storage_class=DirectClass;
      primitive_info->imag