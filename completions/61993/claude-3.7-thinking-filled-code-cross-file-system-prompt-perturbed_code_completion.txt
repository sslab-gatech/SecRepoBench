if (csv_stream == NULL) {
    /* str_getcsv case - no stream to read from */
    if (hunk_begin < bptr && bptr < limit && *bptr == '\0') {
        bptr--;
    }
    goto quit_loop_2;
} else {
    char *new_buf;
    size_t new_len;
    
    if ((new_buf = php_stream_get_line(csv_stream, NULL, 0, &new_len)) == NULL) {
        /* EOF - unterminated enclosure */
        if (hunk_begin < bptr && bptr < limit && *bptr == '\0') {
            bptr--;
        }
        goto quit_loop_2;
    }
}