if (csv_stream == NULL) {
								if (hunk_begin != line_end) {
									memcpy(tptr, hunk_begin, line_end - hunk_begin);
									tptr += (line_end - hunk_begin);
								}
								memcpy(tptr, line_end, line_end_len);
								tptr += line_end_len;
								bptr = line_end;
								break;
							} else {
								size_t new_len;
								char *new_buf = php_stream_get_line(csv_stream, NULL, 0, &new_len);
								if (new_buf == NULL) {
									if (hunk_begin != line_end) {
										memcpy(tptr, hunk_begin, line_end - hunk_begin);
										tptr += (line_end - hunk_begin);
									}
									memcpy(tptr, line_end, line_end_len);
									tptr += line_end_len;
									bptr = line_end;
									break;
								}