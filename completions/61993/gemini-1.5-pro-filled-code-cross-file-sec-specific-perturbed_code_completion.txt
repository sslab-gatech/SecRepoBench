if (csv_stream == NULL) {
    // Handle unterminated enclosure for string input
    if (bptr == limit) {
        // Adjust position pointer to exclude the null character if needed
        if (bptr > buf && *(bptr - 1) == '\0') {
            bptr--;
        }
    }
    break; // Exit loop as there's no more data to read
}

size_t new_len;
char *new_buf = php_stream_get_line(csv_stream, NULL, 0, &new_len);
if (!new_buf) {
    // Handle unterminated enclosure for stream input
    if (bptr == limit) {
        // Adjust position pointer to exclude the null character if needed
        if (bptr > buf && *(bptr - 1) == '\0') {
            bptr--;
        }
    }
    break; // Exit loop as there's no more data to read
}