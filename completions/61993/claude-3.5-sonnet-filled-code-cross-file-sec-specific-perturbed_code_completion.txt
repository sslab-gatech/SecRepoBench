if (csv_stream == NULL) {
    tptr--;  // Exclude the null character
    goto quit_loop_2;
}
char *new_buf = emalloc(ZSTR_ALLOC_OVERHEAD);
size_t new_len = php_stream_get_line(csv_stream, new_buf, ZSTR_ALLOC_OVERHEAD, NULL);
if (new_len == 0) {
    efree(new_buf);
    tptr--;  // Exclude the null character
    goto quit_loop_2;
}