if (csv_stream == NULL) {
    if (hunk_begin < limit) {
        bptr = hunk_begin; // Adjust bptr to the start of the next field
    } else {
        // If we are at the end of the buffer, we need to handle the unterminated enclosure
        break;
    }
} else {
    // Read the next line from the stream
    ssize_t new_len = php_stream_get_line(csv_stream, buf, buf_len, &buf_len);
    if (new_len < 0) {
        // Handle read failure
        if (hunk_begin < limit) {
            bptr = hunk_begin; // Adjust bptr to the start of the next field
        }
        break;
    }
    buf[new_len] = '\0'; // Null-terminate the new buffer
}