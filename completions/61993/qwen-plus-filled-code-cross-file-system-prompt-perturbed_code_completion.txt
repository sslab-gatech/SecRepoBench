if (csv_stream == NULL) {
    if (*bptr == '\0') {
        bptr--; // Adjust position to exclude null character
        goto quit_loop_2;
    }
} else {
    char *new_buf;
    size_t new_len = php_stream_get_line(csv_stream, &new_buf, 0, &new_len);
    if (new_len == 0 || new_buf == NULL) {
        if (*bptr == '\0') {
            bptr--; // Adjust position to exclude null character
            goto quit_loop_2;
        }
    } else {
        buf = new_buf;
        buf_len = new_len;
    }
}