if (!csv_stream) {
    /* If the stream is NULL (str_getcsv case), we can't read more data.
     * This is an unterminated enclosure. */
    goto quit_loop_2;
}

/* Get a new line */
char *new_buf;
size_t new_len;
if ((new_buf = php_stream_get_line(csv_stream, NULL, 0, &new_len)) == NULL) {
    /* Failed to read more data, treat as unterminated enclosure */
    goto quit_loop_2;
}