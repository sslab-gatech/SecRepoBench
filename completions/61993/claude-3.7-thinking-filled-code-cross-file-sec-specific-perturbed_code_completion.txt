if (csv_stream == NULL) {
    /* No stream available (e.g., str_getcsv), so this is an unterminated enclosure */
    memcpy(tptr, hunk_begin, bptr - hunk_begin);
    tptr += (bptr - hunk_begin);
    goto quit_loop_2;
}

/* Get line from file handle */
size_t new_len;
char *new_buf = php_stream_get_line(csv_stream, NULL, 0, &new_len);
if (new_buf == NULL) {
    /* Error or EOF during stream reading, unterminated enclosure */
    memcpy(tptr, hunk_begin, bptr - hunk_begin);
    tptr += (bptr - hunk_begin);
    goto quit_loop_2;
}