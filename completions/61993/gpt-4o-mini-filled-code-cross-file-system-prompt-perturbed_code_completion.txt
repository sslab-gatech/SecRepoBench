if (csv_stream == NULL) {
    // Handle unterminated enclosure case
    if (hunk_begin != line_end) {
        memcpy(tptr, hunk_begin, bptr - hunk_begin);
        tptr += (bptr - hunk_begin);
    }
    *tptr = '\0'; // Null-terminate the string
    break; // Exit the loop
} else {
    // Read the next line from the stream
    ssize_t new_len = php_stream_get_line(csv_stream, buf, buf_len, &buf_len);
    if (new_len < 0) {
        // Handle read failure
        if (hunk_begin != line_end) {
            memcpy(tptr, hunk_begin, bptr - hunk_begin);
            tptr += (bptr - hunk_begin);
        }
        *tptr = '\0'; // Null-terminate the string
        break; // Exit the loop
    }
    buf[new_len] = '\0'; // Null-terminate the new buffer
}