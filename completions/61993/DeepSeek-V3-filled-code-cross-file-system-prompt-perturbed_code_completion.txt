if (csv_stream == NULL) {
    /* Handle unterminated enclosure for str_getcsv() */
    if (tptr > temp && *(tptr - 1) == '\0') {
        tptr--;
    }
    break;
}

size_t new_len;
char *new_buf = php_stream_get_line(csv_stream, NULL, 0, &new_len);
if (new_buf == NULL) {
    /* Handle unterminated enclosure when reading fails */
    if (tptr > temp && *(tptr - 1) == '\0') {
        tptr--;
    }
    break;
}