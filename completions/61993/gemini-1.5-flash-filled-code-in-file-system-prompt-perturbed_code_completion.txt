char *new_buf;
				size_t new_len;
				if (php_stream_get_line(csv_stream, NULL, 0, &new_len) == NULL) {
					/* unterminated enclosure */
					if (hunk_begin != line_end) {
						memcpy(tptr, hunk_begin, bptr - hunk_begin);
						tptr += (bptr - hunk_begin);
						hunk_begin = bptr;
					}
					break;
				}
				new_buf = emalloc(new_len + 1);
				memcpy(new_buf, line_end, line_end_len);
				memcpy(new_buf + line_end_len, "\n", 1);
				memcpy(new_buf + line_end_len + 1, php_stream_get_line(csv_stream, new_buf + line_end_len + 1, new_len, &new_len), new_len);