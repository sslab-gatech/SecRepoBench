if (!csv_stream) {
    php_error_docref(NULL, E_WARNING, "Unterminated quoted field at end of CSV string");
    zend_array_destroy(values);
    values = NULL;
    break;
}

size_t new_len;
char *new_buf = php_stream_get_line(csv_stream, NULL, 0, &new_len);
if (!new_buf) {
    php_error_docref(NULL, E_WARNING, "Unterminated quoted field at end of CSV file");
    zend_array_destroy(values);
    values = NULL;
    break;
}