{
	char *new_buf = NULL;
	size_t new_len = 0;

	/* If there's no stream, we can't read more data: handle the unterminated enclosure and exit. */
	if (!csv_stream) {
		if (bptr < line_end) {
			bptr = line_end;
		}
		goto quit_loop_2;
	}

	/* Attempt to read the next line from the stream. */
	new_buf = php_stream_get_line(csv_stream, NULL, 0, &new_len);
	if (!new_buf) {
		/* Reading failed: handle the unterminated enclosure and exit. */
		if (bptr < line_end) {
			bptr = line_end;
		}
		goto quit_loop_2;
	}
}