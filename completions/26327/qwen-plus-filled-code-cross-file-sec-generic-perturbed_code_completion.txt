time_t current_time = time(NULL);
gmtime_r(&current_time, &tmy);

if (timeparser->time_fmt_year) {
    /* Copy the original time string to temporary buffer */
    strncpy(tmp, time_str, tsize);
    tmp[tsize] = '\0';
    p = flb_strptime(tmp, timeparser->time_fmt_full, tm);
} else {
    /* Create a modified time string with the current year prepended */
    strftime(tmp, sizeof(tmp), "%Y ", &tmy);
    strncat(tmp, time_str, tsize);
    tmp[sizeof(tmp) - 1] = '\0';
    p = flb_strptime(tmp, timeparser->time_fmt_full, tm);
}