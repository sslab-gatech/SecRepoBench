if (time_ptr == NULL) {
    time_ptr = time_str;
    time_len = tsize;
}

if (timeparser->time_with_year == FLB_TRUE) {
    // Check if the time string does not include the year.
    // If the year is missing, use the current date to fill in the missing year.
    // Create a temporary buffer to hold the modified time string with the year.
    // Concatenate the current year to the beginning of the time string.
    // Use `gmtime_r` to get the current date and fill the missing month and day.
    // Parse the modified time string with the year using `flb_strptime` and store results in `tm`.
    struct tm tmy;
    time_t now = now;
    struct tm *tmp = gmtime_r(&now, &tmy);
    if (tmp == NULL) {
        flb_error("[parser] cannot get current date");
        return -1;
    }
    char tmp_str[64];
    strftime(tmp_str, sizeof(tmp_str), "%Y-%m-%d", tmp);
    if (time_len < sizeof(tmp_str) - 1) {
        flb_error("[parser] time string length is too short");
        return -1;
    }
    memcpy(time_str, tmp_str, sizeof(tmp_str) - 1);
    time_str[sizeof(tmp_str) - 1] = '\0';
    time_len = strlen(time_str);
    time_ptr = time_str;
}

// Parse the time string using `flb_strptime` with the expected format and store results in `tm`.
p = flb_strptime(time_ptr, timeparser->time_fmt_year, tm);
if (p == NULL) {
    flb_error("[parser] cannot parse '%.*s'", tsize, time_str);
    return -1;
}