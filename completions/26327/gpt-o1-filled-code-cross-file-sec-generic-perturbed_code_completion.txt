time_now = time(NULL);
    gmtime_r(&time_now, &tmy);

    /* Try parsing as if the year is already present */
    memcpy(tmp, time_ptr, time_len);
    tmp[time_len] = '\0';
    fmt = timeparser->time_fmt;
    p = flb_strptime(tmp, fmt, tm);

    /* If it fails and we have a 'year' format, prepend the current year */
    if (!p && timeparser->time_fmt_year) {
        int n;

        n = snprintf(tmp, sizeof(tmp), "%04d %.*s",
                     tmy.tm_year + 1900, (int) time_len, time_ptr);
        if (n < 0 || n >= (int)sizeof(tmp)) {
            flb_error("[parser] truncated time string with year");
            return -1;
        }

        fmt = timeparser->time_fmt_year;
        p  = flb_strptime(tmp, fmt, tm);
    }