/* Check if year is missing in time string */
    if (timeparser->time_fmt_year) {
        /* Get current time */
        time_now = now;
        if (time_now == 0) {
            time_now = time(NULL);
        }
        gmtime_r(&time_now, &tmy);

        /* Create temporary buffer with year */
        memcpy(tmp, time_str, tsize);
        tmp[tsize] = '\0';
        fmt = timeparser->time_fmt_year;
        p = flb_strptime(tmp, fmt, tm);
        if (p == NULL) {
            /* Try again with original format */
            fmt = timeparser->time_fmt;
            p = flb_strptime(tmp, fmt, tm);
        }
    }
    else {
        /* Copy time string to temporary buffer */
        memcpy(tmp, time_str, tsize);
        tmp[tsize] = '\0';
        fmt = timeparser->time_fmt;
        p = flb_strptime(tmp, fmt, tm);
    }

    /* If parsing failed, try with original string */
    if (p == NULL) {
        p = flb_strptime(time_str, timeparser->time_fmt, tm);
    }