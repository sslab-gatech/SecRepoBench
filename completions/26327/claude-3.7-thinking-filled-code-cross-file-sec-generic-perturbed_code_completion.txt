/* Copy the time string to a temporary buffer */
memcpy(tmp, time_str, time_len);
tmp[time_len] = '\0';

/* If time_fmt_year is available, use it. This is typically used for parsing
 * time strings without year info.
 */
if (timeparser->time_fmt_year) {
    fmt = timeparser->time_fmt_year;
    
    /* We need the current time to get the current year */
    time_now = now;
    if (time_now == 0) {
        time_now = time(NULL);
    }
    
    /* Get the current year */
    if (gmtime_r(&time_now, &tmy) == NULL) {
        flb_error("[parser] cannot parse gmtime");
        return -1;
    }
    
    /* Parse the time string with the special format */
    p = flb_strptime(tmp, fmt, tm);
    
    /* If successful, use the current year */
    if (p != NULL) {
        tm->tm_year = tmy.tm_year;
    }
} else {
    /* Use the standard time format */
    fmt = timeparser->time_fmt;
    
    /* Parse the time string */
    p = flb_strptime(tmp, fmt, tm);
}