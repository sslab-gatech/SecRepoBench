if (timeparser->time_with_year == FLB_FALSE) {
            time_now = now;
            gmtime_r(&time_now, &tmy);

            fmt = timeparser->time_fmt_year;
            time_len = snprintf(tmp, sizeof(tmp) - 1,
                               fmt,
                               tmy.tm_year + 1900,
                               time_str);
            time_ptr = tmp;
        }
        else if (timeparser->time_with_year == FLB_TRUE) {
            /* Make sure the time string is null-terminated */
            memcpy(tmp, time_str, tsize);
            tmp[tsize] = '\0';
            time_ptr = tmp;
        }

        if (timeparser->time_fmt) {
            fmt = timeparser->time_fmt;
        }
        else {
            fmt = timeparser->time_fmt_year;
        }

        p = flb_strptime(time_ptr, fmt, tm);