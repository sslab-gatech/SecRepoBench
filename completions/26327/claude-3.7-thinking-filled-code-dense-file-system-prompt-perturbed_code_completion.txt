fmt = timeparser->time_fmt;
if (timeparser->time_with_year == FLB_FALSE) {
    /* There is no year in the time format */
    if (now == 0) {
        time_now = time(NULL);
    }
    else {
        time_now = now;
    }

    /* Format the string */
    memcpy(tmp, time_str, tsize);
    tmp[tsize] = '\0';

    /* Get local time */
    gmtime_r(&time_now, &tmy);

    /* Set the year manually in the tm structure */
    tm->tm_year = tmy.tm_year;
    
    p = flb_strptime(tmp, fmt, tm);
} else {
    /* The time format already includes the year */
    memcpy(tmp, time_str, tsize);
    tmp[tsize] = '\0';
    
    p = flb_strptime(tmp, fmt, tm);
}