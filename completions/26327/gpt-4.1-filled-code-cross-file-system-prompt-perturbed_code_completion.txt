if (timeparser->time_fmt_year) {
        /* The time string does not include the year, so we need to prepend it */
        time_now = now;
        gmtime_r(&time_now, &tmy);

        /* Compose the new time string with the current year */
        int n = snprintf(tmp, sizeof(tmp), "%04d %.*s",
                         tmy.tm_year + 1900, (int) tsize, time_str);
        if (n < 0 || n >= sizeof(tmp)) {
            flb_error("[parser] failed to compose time string with year");
            return -1;
        }
        tmp[sizeof(tmp) - 1] = '\0';
        fmt = timeparser->time_fmt_year;
        time_ptr = tmp;
        time_len = strlen(tmp);
    }
    else {
        /* The time string includes the year, just copy it to tmp */
        memcpy(tmp, time_str, tsize);
        tmp[tsize] = '\0';
        fmt = timeparser->time_fmt;
        time_ptr = tmp;
        time_len = tsize;
    }

    /* Parse the time string */
    memset(tm, 0, sizeof(struct tm));
    p = flb_strptime(time_ptr, fmt, tm);