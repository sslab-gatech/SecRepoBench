/* Check if the time string does not include the year */
    if (timeparser->time_fmt_year) {
        /* Get the current time */
        time_now = now;
        gmtime_r(&time_now, &tmy);

        /* Create a temporary buffer to hold the modified time string with the year */
        snprintf(tmp, sizeof(tmp) - 1, "%d %.*s",
                 tmy.tm_year + 1900, time_len, time_ptr);
        tmp[sizeof(tmp) - 1] = '\0';

        /* Parse the modified time string with the year */
        p = flb_strptime(tmp, timeparser->time_fmt_year, tm);
    }
    else {
        /* Copy the time string to a temporary buffer ensuring it is null-terminated */
        memcpy(tmp, time_ptr, time_len);
        tmp[time_len] = '\0';

        /* Parse the time string using the expected format */
        p = flb_strptime(tmp, timeparser->time_fmt, tm);
    }