if (timeparser->time_fmt_year) {
        /* Check if the time string includes the year */
        if (strstr(timeparser->time_fmt, "%Y") == NULL &&
            strstr(timeparser->time_fmt, "%y") == NULL) {
            /* Get current time */
            time_now = time(NULL);
            gmtime_r(&time_now, &tmy);

            /* Create a temporary buffer with the year */
            snprintf(tmp, sizeof(tmp), "%04d %.*s",
                     tmy.tm_year + 1900, (int) tsize, time_str);
            time_ptr = tmp;
            time_len = strlen(tmp);
            fmt = timeparser->time_fmt_year;
        }
        else {
            /* Copy the time string to a temporary buffer */
            memcpy(tmp, time_str, tsize);
            tmp[tsize] = '\0';
            fmt = timeparser->time_fmt;
        }
    }
    else {
        /* Copy the time string to a temporary buffer */
        memcpy(tmp, time_str, tsize);
        tmp[tsize] = '\0';
        fmt = timeparser->time_fmt;
    }

    /* Parse the time string */
    p = flb_strptime(time_ptr, fmt, tm);