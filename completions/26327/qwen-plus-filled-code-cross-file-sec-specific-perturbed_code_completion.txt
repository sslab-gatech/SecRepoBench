if (timeparser->time_fmt_year) {
    fmt = timeparser->time_fmt_year;
} else {
    fmt = timeparser->time_fmt_full;
}

p = flb_strptime(time_str, fmt, &tmy);
if (p == NULL && timeparser->time_fmt_year) {
    /* Time string does not include the year, use current date to fill in */
    if (gmtime_r(&now, &tmy) == NULL) {
        flb_error("[parser] gmtime_r failed");
        return -1;
    }
    /* Create a temporary buffer with the year concatenated */
    snprintf(tmp, sizeof(tmp), "%04d-%s", tmy.tm_year + 1900, time_str);
    p = flb_strptime(tmp, fmt, &tmy);
}
if (p != NULL) {
    memcpy(tm, &tmy, sizeof(struct tm));
}