if (timeparser->time_with_year == FLB_FALSE) {
        /* Get current time and format it */
        time_now = now;
        gmtime_r(&time_now, &tmy);

        /* Format the year */
        fmt = timeparser->time_fmt_year;
        strftime(tmp, sizeof(tmp) - 1, fmt, &tmy);

        /* Concatenate the time */
        time_len = strlen(tmp);
        memcpy(tmp + time_len, time_str, tsize);
        time_len += tsize;
        tmp[time_len] = '\0';
        time_ptr = tmp;

        fmt = timeparser->time_fmt_year;
        p = flb_strptime(time_ptr, fmt, tm);
    }
    else if (timeparser->time_with_year == FLB_TRUE) {
        /* time string includes year */
        memcpy(tmp, time_str, tsize);
        tmp[tsize] = '\0';
        time_ptr = tmp;

        if (is_epoch == FLB_TRUE) {
            fmt = "%s";
        }
        else {
            fmt = timeparser->time_fmt;
        }
        p = flb_strptime(time_ptr, fmt, tm);
    }