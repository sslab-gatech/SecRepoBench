if (timeparser->time_fmt_year) {
        // Parse the time string with the year format
        p = flb_strptime(time_str, timeparser->time_fmt_year, &tmy);
        if (p != NULL) {
            memcpy(tm, &tmy, sizeof(struct tm));
            goto parse_subseconds;
        }
    }

    // If the time string does not contain the year, use the current date to fill in the missing year
    time_now = now ? now : time(NULL);
    gmtime_r(&time_now, &tmy);

    if (flb_strptime(time_str, timeparser->time_fmt, &tmy) != NULL) {
        memcpy(tm, &tmy, sizeof(struct tm));

        // Fill in missing year, month, and day with current values if they are zero or out of range
        if (tm->tm_year == 0 || tm->tm_mon == 0 || tm->tm_mday == 0) {
            tm->tm_year = tmy.tm_year;
            tm->tm_mon = tmy.tm_mon;
            tm->tm_mday = tmy.tm_mday;
        }
        
        // Create a temporary buffer with the year concatenated
        snprintf(tmp, sizeof(tmp), "%d-%02d-%02d%s", 
                 tm->tm_year + 1900, tm->tm_mon + 1, tm->tm_mday, time_str);
        p = flb_strptime(tmp, timeparser->time_fmt_full, tm);
    } else {
        flb_error("[parser] invalid time format '%.*s'", tsize, time_str);
        return -1;
    }

parse_subseconds:
    if (p != NULL) {
        time_len = p - time_ptr;
    }