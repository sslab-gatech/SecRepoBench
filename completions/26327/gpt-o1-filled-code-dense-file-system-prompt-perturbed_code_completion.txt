/* Check for a missing year by searching for any four consecutive digits */
    int has_year = 0;
    for (int i = 0; i < time_len - 3; i++) {
        if (isdigit(time_str[i]) && isdigit(time_str[i+1]) &&
            isdigit(time_str[i+2]) && isdigit(time_str[i+3])) {
            has_year = 1;
            break;
        }
    }

    /* Get current date/time for filling in missing year */
    time_now = time(NULL);
    gmtime_r(&time_now, &tmy);

    fmt = timeparser->time_fmt;

    if (!has_year) {
        /* Year is missing, prepend current year to the time string */
        snprintf(tmp, sizeof(tmp), "%d %.*s",
                 tmy.tm_year + 1900,
                 (int) time_len, time_str);
        tmp[sizeof(tmp) - 1] = '\0';
        p = flb_strptime(tmp, fmt, tm);
    }
    else {
        /* Time string includes the year, just copy and parse */
        memcpy(tmp, time_str, time_len);
        tmp[time_len] = '\0';
        p = flb_strptime(tmp, fmt, tm);
    }