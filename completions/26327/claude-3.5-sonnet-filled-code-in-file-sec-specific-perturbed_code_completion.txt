if (timeparser->time_with_year == FLB_FALSE) {
        time_now = now;
        gmtime_r(&time_now, &tmy);
        uint32_t year_len = digits10(tmy.tm_year + 1900);
        uint32_t total_len = year_len + 1 + time_len;

        if (total_len > sizeof(tmp) - 1) {
            flb_error("[parser] time string length is too long");
            return -1;
        }

        char *tmp_ptr = tmp;
        tmp_ptr += u64_to_str(tmy.tm_year + 1900, tmp_ptr);
        *tmp_ptr++ = ' ';
        memcpy(tmp_ptr, time_str, time_len);
        tmp[total_len] = '\0';

        time_ptr = tmp;
        time_len = total_len;
        fmt = timeparser->time_fmt_year;
    }
    else {
        fmt = timeparser->time_fmt;
        memcpy(tmp, time_str, time_len);
        tmp[time_len] = '\0';
    }

    p = flb_strptime(time_ptr, fmt, tm);