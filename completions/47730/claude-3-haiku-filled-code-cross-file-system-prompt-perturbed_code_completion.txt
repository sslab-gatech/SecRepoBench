// <MASK>
bool found_uncommon_alpn = false;
while (*comma_or_nul != '\0') {
  char *alpn_end = strchr(alpn_start, ',');
  size_t alpn_len = alpn_end ? (size_t)(alpn_end - alpn_start) : strlen(alpn_start);

  if (!ndpi_is_common_alpn(ndpi_struct, alpn_start, alpn_len)) {
    char alpn_str[256];
    snprintf(alpn_str, sizeof(alpn_str), "Uncommon ALPN: %.*s", (int)alpn_len, alpn_start);
    NDPI_LOG_DBG(ndpi_struct, "%s", alpn_str);
    ndpi_set_risk(ndpi_struct, connectionflow, NDPI_RISK_UNCOMMON_ALPN, alpn_str);
    found_uncommon_alpn = true;
  }

  if (alpn_end)
    alpn_start = alpn_end + 1;
  else
    break;
}

if (found_uncommon_alpn)
  connectionflow->risk_checked_for_flow = true;