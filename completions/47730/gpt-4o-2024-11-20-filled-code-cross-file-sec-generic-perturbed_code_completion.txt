// Extract the next ALPN identifier by finding the next comma or null terminator
    while (*comma_or_nul != ',' && *comma_or_nul != '\0') {
      comma_or_nul++;
    }

    // Calculate the length of the current ALPN identifier
    size_t alpn_length = comma_or_nul - alpn_start;

    // Skip empty ALPN identifiers (e.g., ",,")
    if (alpn_length == 0) {
      continue;
    }

    // Create a null-terminated string for the current ALPN identifier
    char alpn_identifier[256];
    if (alpn_length >= sizeof(alpn_identifier)) {
      NDPI_LOG_DBG(ndpi_struct, "ALPN identifier too long, skipping");
      continue;
    }
    memcpy(alpn_identifier, alpn_start, alpn_length);
    alpn_identifier[alpn_length] = '\0';

    // Check if the ALPN identifier is uncommon
    if (is_uncommon_alpn(alpn_identifier)) {
      // Log the uncommon ALPN identifier if debugging is enabled
#ifdef DEBUG_TLS
      NDPI_LOG_DBG(ndpi_struct, "Uncommon ALPN detected: %s", alpn_identifier);
#endif

      // Set a risk for the uncommon ALPN
      char risk_message[300];
      snprintf(risk_message, sizeof(risk_message), "Uncommon ALPN detected: %s", alpn_identifier);
      ndpi_set_risk(ndpi_struct, connectionflow, NDPI_TLS_UNCOMMON_ALPN, risk_message);
    }