// Find the next comma or null
while (*comma_or_nul != '\0' && *comma_or_nul != ',')
  comma_or_nul++;

// Only proceed if we have a non-empty ALPN identifier
if (comma_or_nul > alpn_start) {
  int alpn_len = comma_or_nul - alpn_start;
  char alpn[256];
  
  if (alpn_len >= sizeof(alpn))
    alpn_len = sizeof(alpn) - 1;
  
  memcpy(alpn, alpn_start, alpn_len);
  alpn[alpn_len] = '\0';
  
  // Check if it's an uncommon ALPN
  if (!ndpi_is_known_alpn(ndpi_struct, alpn)) {
    char str[512];
    snprintf(str, sizeof(str), "Uncommon ALPN: %s", alpn);
    
    NDPI_LOG_DBG(ndpi_struct, "%s", str);
    ndpi_set_risk(ndpi_struct, connectionflow, NDPI_SUSPICIOUS_ALPN, str);
  }
}