char * alpn_identifier = alpn_start;
char * comma_or_nul = alpn_start;
do {
  // Skip leading commas
  while (*alpn_identifier == ',') alpn_identifier++;

  // Check if the ALPN identifier is not common
  if (!ndpi_is_common_alpn(ndpi_struct, alpn_identifier, comma_or_nul - alpn_identifier)) {
    char alpn_str[256];
    snprintf(alpn_str, sizeof(alpn_str), "ALPN: %.*s", (int)(comma_or_nul - alpn_identifier), alpn_identifier);

    // Log a debug message if debugging is enabled
    if (ndpi_struct->debugging) {
      NDPI_LOG_DBG(ndpi_struct, "%s", alpn_str);
    }

    // Set a risk using the detection module
    ndpi_set_risk(ndpi_struct, flow, NDPI_UNCOMMON_ALPN, alpn_str);
  }

  alpn_identifier = comma_or_nul + 1;
} while (*(comma_or_nul++) != '\0');