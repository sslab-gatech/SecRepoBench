char alpn_identifier[128];
int alpn_identifier_len = 0;
do {
  alpn_identifier_len = (comma_or_nul - alpn_start) < sizeof(alpn_identifier) ? (comma_or_nul - alpn_start) : sizeof(alpn_identifier) - 1;
  memcpy(alpn_identifier, alpn_start, alpn_identifier_len);
  alpn_identifier[alpn_identifier_len] = '\0';

  if (!ndpi_is_common_alpn(ndpi_struct, alpn_identifier, alpn_identifier_len)) {
    char alpn_str[128];
    snprintf(alpn_str, sizeof(alpn_str), "ALPN: %s", alpn_identifier);

    if (ndpi_struct->debug_mode) {
      NDPI_LOG_DBG(ndpi_struct, "%s", alpn_str);
    }

    ndpi_set_risk(ndpi_struct, flow, NDPI_UNCOMMON_ALPN, alpn_str);
  }

  alpn_start = comma_or_nul + 1;
} while (*(comma_or_nul++) != '\0');