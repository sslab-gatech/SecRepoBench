char * alpn_identifier = alpn_start;
char * comma_or_nul = alpn_start;
do {
  // Find the end of the current ALPN identifier.
  char * end = strchr(alpn_identifier, ',');
  if (!end) {
    end = strchr(alpn_identifier, '\0');
  }

  // Check if the ALPN identifier is not common.
  if (!ndpi_is_common_alpn(ndpi_struct, alpn_identifier, end - alpn_identifier)) {
    // Prepare a string representation of the ALPN.
    char alpn_str[end - alpn_identifier + 1];
    memcpy(alpn_str, alpn_identifier, end - alpn_identifier);
    alpn_str[end - alpn_identifier] = '\0';

    // Log a debug message if debugging is enabled.
    if (ndpi_struct->debugging) {
      NDPI_LOG_DBG(ndpi_struct, "Uncommon ALPN: %s", alpn_str);
    }

    // Set a risk using the detection module.
    ndpi_set_risk(ndpi_struct, flow, NDPI_UNCOMMON_ALPN, alpn_str);
  }

  alpn_identifier = end + 1;
} while (*(comma_or_nul++) != '\0');