char uncommon_alpn[64];
    int uncommon_alpn_len = 0;

    while (*alpn_start != '\0') {
        comma_or_nul = strchr(alpn_start, ',');
        if (comma_or_nul == NULL) {
            comma_or_nul = alpn_start + strlen(alpn_start);
        }

        int alpn_len = comma_or_nul - alpn_start;
        if (alpn_len > 0 && alpn_len < sizeof(uncommon_alpn)) {
            strncpy(uncommon_alpn, alpn_start, alpn_len);
            uncommon_alpn[alpn_len] = '\0';

            // Check if the ALPN is uncommon
            if (!is_common_alpn(uncommon_alpn)) {
                ndpi_set_risk(ndpi_struct, flow, NDPI_TLS_UNCOMMON_ALPN, uncommon_alpn);
            }
        }

        alpn_start = comma_or_nul + 1;
    }