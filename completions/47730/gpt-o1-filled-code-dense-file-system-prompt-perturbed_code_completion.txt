while (*comma_or_nul != ',' && *comma_or_nul != '\0') {
      comma_or_nul++;
    }

    /* Temporarily null-terminate the current ALPN token. */
    char saved_char = *comma_or_nul;
    *comma_or_nul = '\0';

    /* Check if the ALPN is uncommon. */
    if(!ac_automata_search(ndpi_struct->common_alpns_automa.ac_automa,
                           alpn_start,
                           strlen(alpn_start),
                           0,
                           0)) {
#ifdef DEBUG_TLS
      NDPI_LOG_DBG(ndpi_struct, "Found uncommon ALPN: %s\n", alpn_start);
#endif
      ndpi_set_risk(ndpi_struct, connectionflow, NDPI_RISK_TLS_UNCOMMON_ALPN, alpn_start);
    }

    /* Restore the character. */
    *comma_or_nul = saved_char;