char alpn_identifier[256];
size_t alpn_len = 0;

while (*alpn_start && *comma_or_nul != ',') {
  if (alpn_len < sizeof(alpn_identifier) - 1) {
    alpn_identifier[alpn_len++] = *alpn_start++;
  } else {
    alpn_start++; // Skip over characters if the buffer is full
  }
}

alpn_identifier[alpn_len] = '\0'; // Null-terminate the ALPN identifier

if (!isCommonALPN(ndpi_struct, alpn_identifier)) { // Assume isCommonALPN is a helper function
  char log_message[512];
  snprintf(log_message, sizeof(log_message), "Uncommon ALPN detected: %s", alpn_identifier);
  
#ifdef DEBUG
  NDPI_LOG_DBG(ndpi_struct, log_message);
#endif
  
  ndpi_set_risk(ndpi_struct, connectionflow, NDPI_UNCOMMON_ALPN, log_message);
}