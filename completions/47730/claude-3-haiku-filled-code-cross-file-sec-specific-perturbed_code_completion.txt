// <MASK>
char alpn_str[256] = { 0 };
int alpn_len = 0;

while (comma_or_nul != alpn_start) {
    char *comma = strchr(alpn_start, ',');
    if (comma == NULL) {
        comma = alpn_start + strlen(alpn_start);
    }
    int len = comma - alpn_start;
    if (len > 0 && len < sizeof(alpn_str) - alpn_len - 1) {
        memcpy(alpn_str + alpn_len, alpn_start, len);
        alpn_len += len;
        alpn_str[alpn_len++] = ',';
    }
    if (*comma == '\0') {
        break;
    }
    alpn_start = comma + 1;
}
if (alpn_len > 0) {
    alpn_str[alpn_len - 1] = '\0'; // Replace the last comma with null terminator
    if (!ndpi_is_common_alpn(ndpi_struct, alpn_str)) {
        NDPI_LOG_DBG(ndpi_struct, "Uncommon ALPN found: %s", alpn_str);
        ndpi_set_risk(ndpi_struct, connectionflow, NDPI_RISK_UNCOMMON_ALPN, alpn_str);
    }
}