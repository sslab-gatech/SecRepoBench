char alpn_identifier[256];
size_t alpn_len = 0;

while (*alpn_start && *comma_or_nul) {
  if (*comma_or_nul == ',') {
    alpn_len = comma_or_nul - alpn_start;
    if (alpn_len > 0 && alpn_len < sizeof(alpn_identifier)) {
      memcpy(alpn_identifier, alpn_start, alpn_len);
      alpn_identifier[alpn_len] = '\0';
      
      if (!isCommonALPN(alpn_identifier)) { // Assume isCommonALPN is a helper function
        char risk_message[512];
        
        snprintf(risk_message, sizeof(risk_message), "Uncommon ALPN identifier: %s", alpn_identifier);
        NDPI_LOG_DBG(ndpi_struct, risk_message);
        
        ndpi_set_risk(ndpi_struct, connectionflow, NDPI_TLS_UNCOMMON_ALPN, risk_message);
      }
    }
    break; // Exit after processing the first uncommon ALPN for simplicity
  }
}