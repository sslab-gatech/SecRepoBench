while (*comma_or_nul != ',' && *comma_or_nul != '\0') {
  comma_or_nul++;
}

if (alpn_start != comma_or_nul) {
  size_t len = (size_t)(comma_or_nul - alpn_start);
  char alpn_token[128];

  if (len >= sizeof(alpn_token)) {
    len = sizeof(alpn_token) - 1;
  }

  memcpy(alpn_token, alpn_start, len);
  alpn_token[len] = '\0';

  /* Check if this ALPN is not common using a helper function. */
  if (!ndpi_is_common_alpn(alpn_token)) {
    NDPI_LOG_DBG(ndpi_struct, "Uncommon ALPN found: %s\n", alpn_token);
    ndpi_set_risk(ndpi_struct, connectionflow, NDPI_POSSIBLE_EXPLOIT, alpn_token);
  }
}