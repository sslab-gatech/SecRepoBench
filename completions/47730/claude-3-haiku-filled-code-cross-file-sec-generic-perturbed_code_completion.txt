// <MASK>
bool found_uncommon_alpn = false;
char alpn_str[256] = {0};

while (*comma_or_nul != '\0') {
    size_t alpn_len = (size_t)(comma_or_nul - alpn_start);
    if (alpn_len > 0 && alpn_len < sizeof(alpn_str) - 1) {
        strncpy(alpn_str, alpn_start, alpn_len);
        alpn_str[alpn_len] = '\0';

        if (!ndpi_is_common_alpn(ndpi_struct, alpn_str)) {
            found_uncommon_alpn = true;
            NDPI_LOG_DBG(ndpi_struct, "Uncommon ALPN found: %s\n", alpn_str);
            ndpi_set_risk(ndpi_struct, connectionflow, NDPI_CUSTOM_PROTOCOL_RISK, alpn_str);
        }
    }

    alpn_start = comma_or_nul + 1;
    comma_or_nul = strchr(alpn_start, ',');
    if (comma_or_nul == NULL)
        comma_or_nul = alpn_start + strlen(alpn_start);
}

if (found_uncommon_alpn) {
    NDPI_LOG_DBG(ndpi_struct, "Uncommon ALPN(s) found in the flow.\n");
}