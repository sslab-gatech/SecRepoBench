// <MASK>
char alpn_str[256] = { 0 };
int alpn_len = 0;

while (comma_or_nul != alpn_start) {
    int curr_len = (comma_or_nul - alpn_start);
    if (curr_len > 0 && curr_len < sizeof(alpn_str) - alpn_len - 1) {
        memcpy(alpn_str + alpn_len, alpn_start, curr_len);
        alpn_len += curr_len;
        alpn_str[alpn_len++] = ',';
    }
    if (*comma_or_nul == '\0')
        break;
    alpn_start = comma_or_nul + 1;
    comma_or_nul = strchr(alpn_start, ',');
    if (!comma_or_nul)
        comma_or_nul = alpn_start + strlen(alpn_start);
}

if (alpn_len > 0) {
    alpn_str[alpn_len - 1] = '\0'; // Null-terminate the string
    if (!ndpi_is_common_alpn(ndpi_struct, alpn_str)) {
        NDPI_LOG_DBG(ndpi_struct, "Uncommon ALPN: %s\n", alpn_str);
        ndpi_set_risk(ndpi_struct, connectionflow, NDPI_RISK_UNCOMMON_ALPN, alpn_str);
    }
}