// Extract the current ALPN identifier
    while (*comma_or_nul != ',' && *comma_or_nul != '\0') {
        comma_or_nul++;
    }

    // Calculate the length of the current ALPN identifier
    size_t alpn_length = comma_or_nul - alpn_start;

    // Ensure the ALPN length is within a safe and expected range
    if (alpn_length > 0 && alpn_length < 256) {
        char alpn_identifier[256];

        // Safely copy the ALPN identifier into a local buffer
        strncpy(alpn_identifier, alpn_start, alpn_length);
        alpn_identifier[alpn_length] = '\0'; // Null-terminate the string

        // Check if the ALPN identifier is uncommon
        if (is_uncommon_alpn(alpn_identifier)) {
            // Log the uncommon ALPN if debugging is enabled
#ifdef DEBUG_TLS
            NDPI_LOG_DBG(ndpi_struct, "Uncommon ALPN detected: %s\n", alpn_identifier);
#endif

            // Set a risk for the uncommon ALPN
            char risk_message[300];
            snprintf(risk_message, sizeof(risk_message), "Uncommon ALPN detected: %s", alpn_identifier);
            ndpi_set_risk(ndpi_struct, connectionflow, NDPI_TLS_UNCOMMON_ALPN, risk_message);
        }
    }