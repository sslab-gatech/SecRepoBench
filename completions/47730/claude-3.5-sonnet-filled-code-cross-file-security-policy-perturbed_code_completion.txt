char *comma = strchr(comma_or_nul, ',');
size_t alpn_len = comma ? (size_t)(comma - alpn_start) : strlen(alpn_start);
char alpn_buf[256];
size_t copy_len = alpn_len < sizeof(alpn_buf) - 1 ? alpn_len : sizeof(alpn_buf) - 1;

memcpy(alpn_buf, alpn_start, copy_len);
alpn_buf[copy_len] = '\0';

if (!ndpi_is_common_alpn(alpn_buf)) {
  if (ndpi_struct->enable_tls_debug) {
    char debug_str[512];
    snprintf(debug_str, sizeof(debug_str), "Uncommon ALPN: %s", alpn_buf);
    NDPI_LOG_DBG(ndpi_struct, "%s\n", debug_str);
  }
  ndpi_set_risk(ndpi_struct, connectionflow, NDPI_TLS_UNCOMMON_ALPN, alpn_buf);
}

comma_or_nul = comma ? comma : alpn_start + alpn_len;