char *comma = strchr(alpn_start, ',');
    size_t alpn_len = comma ? (size_t)(comma - alpn_start) : strlen(alpn_start);
    
    if (alpn_len > 0 && alpn_len < 256) {
      char alpn[256];
      memcpy(alpn, alpn_start, alpn_len);
      alpn[alpn_len] = '\0';
      
      if (!ndpi_is_common_alpn(ndpi_struct, alpn)) {
        char risk_str[300];
        snprintf(risk_str, sizeof(risk_str), "Uncommon ALPN: %s", alpn);
        
        NDPI_LOG_DBG(ndpi_struct, "TLS: %s\n", risk_str);
        ndpi_set_risk(ndpi_struct, connectionflow, NDPI_TLS_UNCOMMON_ALPN, risk_str);
      }
    }
    
    comma_or_nul = comma ? comma : alpn_start + strlen(alpn_start);