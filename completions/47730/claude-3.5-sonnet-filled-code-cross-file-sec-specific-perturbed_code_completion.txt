comma_or_nul = strchr(alpn_start, ',');
    if (comma_or_nul == NULL) {
      comma_or_nul = alpn_start + strlen(alpn_start);
    }

    size_t alpn_len = comma_or_nul - alpn_start;
    if (alpn_len > 0) {
      char alpn[256];
      if (alpn_len >= sizeof(alpn)) {
        alpn_len = sizeof(alpn) - 1;
      }
      memcpy(alpn, alpn_start, alpn_len);
      alpn[alpn_len] = '\0';

      if (!ndpi_is_common_alpn(ndpi_struct, alpn)) {
        char risk_str[300];
        snprintf(risk_str, sizeof(risk_str), "Uncommon ALPN: %s", alpn);
        
        #ifdef NDPI_ENABLE_DEBUG_MESSAGES
        NDPI_LOG_DBG(ndpi_struct, "%s\n", risk_str);
        #endif

        ndpi_set_risk(ndpi_struct, connectionflow, NDPI_TLS_UNCOMMON_ALPN, risk_str);
      }
    }