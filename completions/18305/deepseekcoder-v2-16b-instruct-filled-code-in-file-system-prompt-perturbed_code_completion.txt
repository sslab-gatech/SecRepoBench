chromaticity[2];
            image->chromaticity.green_primary.y=chromaticity[3];
            image->chromaticity.blue_primary.x=chromaticity[4];
            image->chromaticity.blue_primary.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&hor_res) == 1)
      image->resolution.y=hor_res;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&hor_res) == 1)
      image->resolution.x=hor_res;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) == 1)
      {
        if (units == RESUNIT_INCH)
          image->units=InchResolution;
        if (units == RESUNIT_CENTIMETER)
          image->units=CentimeterResolution;
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YPOSITION,&y_resolution) == 1)
      image->resolution.y=y_resolution;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XPOSITION,&x_resolution) == 1)
      image->resolution.x=x_resolution;
    // </MASK>
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      (void) SetImageProperty(image,"tiff:software",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ARTIST,&value) == 1)
      (void) SetImageProperty(image,"tiff:artist",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_DATETIME,&value) == 1)
      (void) SetImageProperty(image,"tiff:timestamp",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_COPYRIGHT,&value) == 1)
      (void) SetImageProperty(image,"tiff:copyright",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_DOCUMENTNAME,&value) == 1)
      (void) SetImageProperty(image,"tiff:document",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_HOSTCOMPUTER,&value) == 1)
      (void) SetImageProperty(image,"tiff:hostcomputer",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_IMAGEDESCRIPTION,&value) == 1)
      (void) SetImageProperty(image,"comment",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MAKE,&value) == 1)
      (void) SetImageProperty(image,"tiff:make",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MODEL,&value) == 1)
      (void) SetImageProperty(image,"tiff:model",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_OPIIMAGEID,&count,&value) == 1)
      {
        if (count >= MagickPathExtent)
          count=MagickPathExtent-1;
        (void) CopyMagickString(image->properties[0].value,value,count+1);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENAME,&value) == 1)
      (void) SetImageProperty(image,"label",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      (void) SetImageProperty(image,"tiff:software",value,exception);
    if (TIFFGetFieldDefaulted(tiff,33423,&count,&value) == 1)
      {
        if (count >= MagickPathExtent)
          count=MagickPathExtent-1;
        (void) CopyMagickString(image->properties[0].value,value,count+1);
      }
    if (TIFFGetFieldDefaulted(tiff,36867,&count,&value) == 1)
      {
        if (count >= MagickPathExtent)
          count=MagickPathExtent-1;
        (void) CopyMagickString(image->properties[0].value,value,count+1);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SUBFILETYPE,&value) == 1)
      switch (value)
      {
        case 0x01:
          (void) SetImageProperty(image,"tiff:subfiletype","REDUCEDIMAGE",
            exception);
          break;
        case 0x02:
          (void) SetImageProperty(image,"tiff:subfiletype","PAGE",exception);
          break;
        case 0x04:
          (void) SetImageProperty(image,"tiff:subfiletype","MASK",exception);
          break;
        default:
          break;
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SUBIFD,&value) == 1)
      {
        for (i=0; i < (ssize_t) value; i++)
        {
          if (TIFFReadDirectory(tiff) == 0)
            {
              TIFFClose(tiff);
              ThrowReaderException(CorruptImageError,"ImproperImageHeader");
            }
          AcquireNextImage(image_info,image,exception);
          if (GetNextImageInList(image) == (Image *) NULL)
            {
              TIFFClose(tiff);
              ThrowReaderException(CorruptImageError,"ImproperImageHeader");
            }
          image=SyncNextImageInList(image);
        }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_EXIFIFD,&value) == 1)
      TIFFGetEXIFProperties(tiff,image,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RICHTIFFIPTC,&value) == 1)
      TIFFGetEXIFProperties(tiff,image,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XMLPACKET,&value) == 1)
      TIFFGetEXIFProperties(tiff,image,exception);
    if (TIFFGetFieldDefaulted(tiff,34118,&count,&value) == 1)
      TIFFGetEXIFProperties(tiff,image,exception);
    if (TIFFGetFieldDefaulted(tiff,37724,&count,&value) == 1)
      TIFFGetEXIFProperties(tiff,image,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PHOTOSHOP,&value) == 1)
      TIFFReadPhotoshopLayers(image_info,image,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&orientation) == 1)
      image->orientation=(OrientationType) orientation;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) == 1)
      {
        if (units == RESUNIT_INCH)
          image->units=PixelsPerInchResolution;
        if (units == RESUNIT_CENTIMETER)
          image->units=PixelsPerCentimeterResolution;
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&hor_res) == 1)
      image->resolution.x=hor_res;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&hor_res) == 1)
      image->resolution.y=hor_res;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XPOSITION,&x_resolution) == 1)
      image->resolution.x=x_resolution;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YPOSITION,&y_resolution) == 1)
      image->resolution.y=y_resolution;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_WHITEPOINT,&chromaticity) == 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.white_point.x=chromaticity[0];
            image->chromaticity.white_point.y=chromaticity[1];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PRIMARYCHROMATICITIES,&chromaticity) == 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.red_primary.x=chromaticity[0];
            image->chromaticity.red_primary.y=chromaticity[1];
            image->chromaticity.green_primary.x=chromaticity[2];
            image->chromaticity.green_primary.y=chromaticity[3];
            image->chromaticity.blue_primary.x=chromaticity[4];
            image->chromaticity.blue_primary.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YCBCRCOEFFICIENTS,&chromaticity) == 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.y_coeff=chromaticity[0];
            image->chromaticity.cb_coeff=chromaticity[1];
            image->chromaticity.cr_coeff=chromaticity[2];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_REFERENCEBLACKWHITE,&chromaticity) == 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.black_point.x=chromaticity[0];
            image->chromaticity.black_point.y=chromaticity[1];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_TRANSFERFUNCTION,&chromaticity) == 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.red_primary.x=chromaticity[0];
            image->chromaticity.red_primary.y=chromaticity[1];
            image->chromaticity.green_primary.x=chromaticity[2];
            image->chromaticity.green_primary.y=chromaticity[3];
            image->chromaticity.blue_primary.x=chromaticity[4];
            image->chromaticity.blue_primary.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      (void) SetImageProperty(image,"tiff:software",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ARTIST,&value) == 1)
      (void) SetImageProperty(image,"tiff:artist",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_DATETIME,&value) == 1)
      (void) SetImageProperty(image,"tiff:timestamp",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_COPYRIGHT,&value) == 1)
      (void) SetImageProperty(image,"tiff:copyright",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_DOCUMENTNAME,&value) == 1)
      (void) SetImageProperty(image,"tiff:document",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_HOSTCOMPUTER,&value) == 1)
      (void) SetImageProperty(image,"tiff:hostcomputer",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_IMAGEDESCRIPTION,&value) == 1)
      (void) SetImageProperty(image,"comment",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MAKE,&value) == 1)
      (void) SetImageProperty(image,"tiff:make",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MODEL,&value) == 1)
      (void) SetImageProperty(image,"tiff:model",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_OPIIMAGEID,&count,&value) == 1)
      {
        if (count >= MagickPathExtent)
          count=MagickPathExtent-1;
        (void) CopyMagickString(image->properties[0].value,value,count+1);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENAME,&value) == 1)
      (void) SetImageProperty(image,"label",value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      (void) SetImageProperty(image,"tiff:software",value,exception);
    if (TIFFGetFieldDefaulted(tiff,33423,&count,&value)