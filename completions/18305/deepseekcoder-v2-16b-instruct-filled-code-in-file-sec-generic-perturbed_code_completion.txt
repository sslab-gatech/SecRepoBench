[1];
            image->chromaticity.green_primary.x=chromaticity[2];
            image->chromaticity.green_primary.y=chromaticity[3];
            image->chromaticity.blue_primary.x=chromaticity[4];
            image->chromaticity.blue_primary.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) == 1)
      image->resolution.y=y_resolution;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) == 1)
      image->resolution.x=x_resolution;
    // </MASK>
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SAMPLESPERPIXEL,&samples_per_pixel) != 1)
      samples_per_pixel=1;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PLANARCONFIG,&interlace) != 1)
      interlace=PLANARCONFIG_CONTIG;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_COMPRESSION,&compress_tag) != 1)
      compress_tag=COMPRESSION_NONE;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PHOTOMETRIC,&photometric) != 1)
      photometric=PHOTOMETRIC_RGB;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_BITSPERSAMPLE,&bits_per_sample) != 1)
      bits_per_sample=8;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SAMPLEFORMAT,&sample_format) != 1)
      sample_format=SAMPLEFORMAT_UINT;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MINSAMPLEVALUE,&min_sample_value) != 1)
      min_sample_value=0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MAXSAMPLEVALUE,&max_sample_value) != 1)
      max_sample_value=255;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_EXTRASAMPLES,&extra_samples,&sample_info) == 1)
      {
        for (i=0; i < (ssize_t) extra_samples; i++)
        {
          if (sample_info[i] == EXTRASAMPLE_ASSOCALPHA)
            image->alpha_trait=BlendPixelTrait;
          else if (sample_info[i] == EXTRASAMPLE_UNASSALPHA)
            image->alpha_trait=CopyPixelTrait;
        }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&orientation) != 1)
      orientation=ORIENTATION_UNDEFINED;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) != 1)
      units=RESUNIT_INCH;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) != 1)
      x_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) != 1)
      y_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_WHITEPOINT,&chromaticity) != 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.white_point.x=chromaticity[0];
            image->chromaticity.white_point.y=chromaticity[1];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PRIMARYCHROMATICITIES,&chromaticity) != 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.red_primary.x=chromaticity[0];
            image->chromaticity.red_primary.y=chromaticity[1];
            image->chromaticity.green_primary.x=chromaticity[2];
            image->chromaticity.green_primary.y=chromaticity[3];
            image->chromaticity.blue_primary.x=chromaticity[4];
            image->chromaticity.blue_primary.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YCBCRCOEFFICIENTS,&chromaticity) != 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.y_chroma_blue_weight=chromaticity[0];
            image->chromaticity.y_chroma_red_weight=chromaticity[1];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_REFERENCEBLACKWHITE,&chromaticity) != 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.black_point.x=chromaticity[0];
            image->chromaticity.black_point.y=chromaticity[1];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_TRANSFERFUNCTION,&chromaticity) != 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.red_primary.x=chromaticity[0];
            image->chromaticity.red_primary.y=chromaticity[1];
            image->chromaticity.green_primary.x=chromaticity[2];
            image->chromaticity.green_primary.y=chromaticity[3];
            image->chromaticity.blue_primary.x=chromaticity[4];
            image->chromaticity.blue_primary.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      (void) SetImageProperty(image,"tiff:software",(char *) value,errorinfo);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ARTIST,&value) == 1)
      (void) SetImageProperty(image,"tiff:artist",(char *) value,errorinfo);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_COPYRIGHT,&value) == 1)
      (void) SetImageProperty(image,"tiff:copyright",(char *) value,errorinfo);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_DATETIME,&value) == 1)
      (void) SetImageProperty(image,"tiff:timestamp",(char *) value,errorinfo);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_DOCUMENTNAME,&value) == 1)
      (void) SetImageProperty(image,"tiff:document",(char *) value,errorinfo);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_HOSTCOMPUTER,&value) == 1)
      (void) SetImageProperty(image,"tiff:hostcomputer",(char *) value,errorinfo);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_IMAGEDESCRIPTION,&value) == 1)
      (void) SetImageProperty(image,"comment",(char *) value,errorinfo);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MAKE,&value) == 1)
      (void) SetImageProperty(image,"tiff:make",(char *) value,errorinfo);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MODEL,&value) == 1)
      (void) SetImageProperty(image,"tiff:model",(char *) value,errorinfo);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_OPIIMAGEID,&count,&value) == 1)
      (void) SetImageProperty(image,"tiff:image-id",(char *) value,errorinfo);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENAME,&value) == 1)
      (void) SetImageProperty(image,"label",(char *) value,errorinfo);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      (void) SetImageProperty(image,"tiff:software",(char *) value,errorinfo);
    if (TIFFGetFieldDefaulted(tiff,33423,&count,&value) == 1)
      (void) SetImageProperty(image,"tiff:kodak-33423",(char *) value,errorinfo);
    if (TIFFGetFieldDefaulted(tiff,36867,&count,&value) == 1)
      (void) SetImageProperty(image,"tiff:kodak-36867",(char *) value,errorinfo);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SUBFILETYPE,&type) == 1)
      switch (type)
      {
        case 0x01:
          (void) SetImageProperty(image,"tiff:subfiletype","REDUCEDIMAGE",
            errorinfo);
          break;
        case 0x02:
          (void) SetImageProperty(image,"tiff:subfiletype","PAGE",errorinfo);
          break;
        case 0x04:
          (void) SetImageProperty(image,"tiff:subfiletype","MASK",errorinfo);
          break;
        default:
          break;
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&orientation) != 1)
      orientation=ORIENTATION_UNDEFINED;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) != 1)
      units=RESUNIT_INCH;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) != 1)
      x_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) != 1)
      y_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_WHITEPOINT,&chromaticity) != 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.white_point.x=chromaticity[0];
            image->chromaticity.white_point.y=chromaticity[1];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PRIMARYCHROMATICITIES,&chromaticity) != 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.red_primary.x=chromaticity[0];
            image->chromaticity.red_primary.y=chromaticity[1];
            image->chromaticity.green_primary.x=chromaticity[2];
            image->chromaticity.green_primary.y=chromaticity[3];
            image->chromaticity.blue_primary.x=chromaticity[4];
            image->chromaticity.blue_primary.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YCBCRCOEFFICIENTS,&chromaticity) != 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.y_chroma_blue_weight=chromaticity[0];
            image->chromaticity.y_chroma_red_weight=chromaticity[1];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_REFERENCEBLACKWHITE,&chromaticity) != 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.black_point.x=chromaticity[0];
            image->chromaticity.black_point.y=chromaticity[1];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_TRANSFERFUNCTION,&chromaticity) != 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.red_primary.x=chromaticity[0];
            image->chromaticity.red_primary.y=chromaticity[1];
            image->chromaticity.green_primary.x=chromaticity[2];
            image->chromaticity.green_primary.y=chromaticity[3];
            image->chromaticity.blue_primary.x=chromaticity[4];
            image->chromaticity.blue_primary.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      (void) SetImageProperty(image,"tiff:software",(char *) value,error