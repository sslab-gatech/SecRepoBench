orientation != TopLeftOrientation)
      (void) TIFFSetField(tiff,TIFFTAG_ORIENTATION,(uint16) image->orientation);
    if (image->chromaticity.white_point.x != 0.0)
      {
        float
          white_point[2];

        white_point[0]=image->chromaticity.white_point.x;
        white_point[1]=image->chromaticity.white_point.y;
        (void) TIFFSetField(tiff,TIFFTAG_WHITEPOINT,white_point);
      }
    if (image->chromaticity.red_primary.x != 0.0)
      {
        float
          primary[6];

        primary[0]=image->chromaticity.red_primary.x;
        primary[1]=image->chromaticity.red_primary.y;
        primary[2]=image->chromaticity.green_primary.x;
        primary[3]=image->chromaticity.green_primary.y;
        primary[4]=image->chromaticity.blue_primary.x;
        primary[5]=image->chromaticity.blue_primary.y;
        (void) TIFFSetField(tiff,TIFFTAG_PRIMARYCHROMATICITIES,primary);
      }
    if (image->colorspace == CMYKColorspace)
      {
        (void) TIFFSetField(tiff,TIFFTAG_INKSET,INKSET_CMYK);
        (void) TIFFSetField(tiff,TIFFTAG_PHOTOMETRIC,PHOTOMETRIC_SEPARATED);
      }
    if (image->colorspace == YCbCrColorspace)
      {
        (void) TIFFSetField(tiff,TIFFTAG_PHOTOMETRIC,PHOTOMETRIC_YCBCR);
        (void) TIFFSetField(tiff,TIFFTAG_YCBCRSUBSAMPLING,1,1);
      }
    if (image->colorspace == LabColorspace)
      {
        (void) TIFFSetField(tiff,TIFFTAG_PHOTOMETRIC,PHOTOMETRIC_CIELAB);
        EncodeLabImage(image,exception);
      }
    if (image->storage_class == PseudoClass)
      {
        size_t
          colors;

        colors=(size_t) GetQuantumRange(bits_per_sample)+1;
        if (AcquireImageColormap(image,colors,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowWriterException(ResourceLimitError,"MemoryAllocationFailed");
          }
      }
    if (image->alpha_trait != UndefinedPixelTrait)
      {
        (void) TIFFSetField(tiff,TIFFTAG_EXTRASAMPLES,1,&sample_info);
        if (sample_info[0] == EXTRASAMPLE_ASSOCALPHA)
          SetQuantumAlphaType(quantum_info,AssociatedQuantumAlpha);
      }
    if (image->storage_class == PseudoClass)
      {
        size_t
          range;

        uint16
          *blue_colormap,
          *green_colormap,
          *red_colormap;

        /*
          Initialize colormap.
        */
        tiff_status=TIFFGetField(tiff,TIFFTAG_COLORMAP,&red_colormap,
          &green_colormap,&blue_colormap);
        if (tiff_status == 1)
          {
            if ((red_colormap != (uint16 *) NULL) &&
                (green_colormap != (uint16 *) NULL) &&
                (blue_colormap != (uint16 *) NULL))
              {
                range=255;  /* might be old style 8-bit colormap */
                for (i=0; i < (ssize_t) image->colors; i++)
                  if ((red_colormap[i] >= 256) || (green_colormap[i] >= 256) ||
                      (blue_colormap[i] >= 256))
                    {
                      range=65535;
                      break;
                    }
                for (i=0; i < (ssize_t) image->colors; i++)
                {
                  image->colormap[i].red=ClampToQuantum(((double)
                    QuantumRange*red_colormap[i])/range);
                  image->colormap[i].green=ClampToQuantum(((double)
                    QuantumRange*green_colormap[i])/range);
                  image->colormap[i].blue=ClampToQuantum(((double)
                    QuantumRange*blue_colormap[i])/range);
                }
              }
          }
      }
    if (image->storage_class == PseudoClass)
      {
        (void) TIFFSetField(tiff,TIFFTAG_COLORMAP,image->colormap,
          (uint16) image->colors);
        (void) TIFFSetField(tiff,TIFFTAG_PHOTOMETRIC,PHOTOMETRIC_PALETTE);
      }
    if (image->storage_class == DirectClass)
      {
        (void) TIFFSetField(tiff,TIFFTAG_PHOTOMETRIC,photometric);
        if (photometric == PHOTOMETRIC_PALETTE)
          {
            (void) TIFFSetField(tiff,TIFFTAG_COLORMAP,image->colormap,
              (uint16) image->colors);
            (void) TIFFSetField(tiff,TIFFTAG_PALETTECOLOR,image->colormap,
              (uint16) image->colors);
          }
      }
    if (image->storage_class == DirectClass)
      {
        (void) TIFFSetField(tiff,TIFFTAG_IMAGEDESCRIPTION,
          (uint8 *) image->filename,strlen(image->filename)+1);
        (void) TIFFSetField(tiff,TIFFTAG_DATETIME,image->date);
        (void) TIFFSetField(tiff,TIFFTAG_ARTIST,image->artist);
        (void) TIFFSetField(tiff,TIFFTAG_IMAGEDESCRIPTION,
          (uint8 *) image->description,strlen(image->description)+1);
        (void) TIFFSetField(tiff,TIFFTAG_HOSTCOMPUTER,
          (uint8 *) image->host_computer,strlen(image->host_computer)+1);
        (void) TIFFSetField(tiff,TIFFTAG_HOSTSOFTWARE,
          (uint8 *) image->host_software,strlen(image->host_software)+1);
        (void) TIFFSetField(tiff,TIFFTAG_OSOFTWARE,
          (uint8 *) image->software,strlen(image->software)+1);
        (void) TIFFSetField(tiff,TIFFTAG_DOCUMENTNAME,
          (uint8 *) image->filename,strlen(image->filename)+1);
        (void) TIFFSetField(tiff,TIFFTAG_PAGENAME,
          (uint8 *) image->filename,strlen(image->filename)+1);
        (void) TIFFSetField(tiff,TIFFTAG_SUBFILETYPE,FILETYPE_PAGE);
        (void) TIFFSetField(tiff,TIFFTAG_DATETIME,image->date);
        (void) TIFFSetField(tiff,TIFFTAG_ARTIST,image->artist);
        (void) TIFFSetField(tiff,TIFFTAG_IMAGEDESCRIPTION,
          (uint8 *) image->description,strlen(image->description)+1);
        (void) TIFFSetField(tiff,TIFFTAG_HOSTCOMPUTER,
          (uint8 *) image->host_computer,strlen(image->host_computer)+1);
        (void) TIFFSetField(tiff,TIFFTAG_HOSTSOFTWARE,
          (uint8 *) image->host_software,strlen(image->host_software)+1);
        (void) TIFFSetField(tiff,TIFFTAG_OSOFTWARE,
          (uint8 *) image->software,strlen(image->software)+1);
        (void) TIFFSetField(tiff,TIFFTAG_DOCUMENTNAME,
          (uint8 *) image->filename,strlen(image->filename)+1);
        (void) TIFFSetField(tiff,TIFFTAG_PAGENAME,
          (uint8 *) image->filename,strlen(image->filename)+1);
        (void) TIFFSetField(tiff,TIFFTAG_SUBFILETYPE,FILETYPE_PAGE);
        (void) TIFFSetField(tiff,TIFFTAG_DATETIME,image->date);
        (void) TIFFSetField(tiff,TIFFTAG_ARTIST,image->artist);
        (void) TIFFSetField(tiff,TIFFTAG_IMAGEDESCRIPTION,
          (uint8 *) image->description,strlen(image->description)+1);
        (void) TIFFSetField(tiff,TIFFTAG_HOSTCOMPUTER,
          (uint8 *) image->host_computer,strlen(image->host_computer)+1);
        (void) TIFFSetField(tiff,TIFFTAG_HOSTSOFTWARE,
          (uint8 *) image->host_software,strlen(image->host_software)+1);
        (void) TIFFSetField(tiff,TIFFTAG_OSOFTWARE,
          (uint8 *) image->software,strlen(image->software)+1);
        (void) TIFFSetField(tiff,TIFFTAG_DOCUMENTNAME,
          (uint8 *) image->filename,strlen(image->filename)+1);
        (void) TIFFSetField(tiff,TIFFTAG_PAGENAME,
          (uint8 *) image->filename,strlen(image->filename)+1);
        (void) TIFFSetField(tiff,TIFFTAG_SUBFILETYPE,FILETYPE_PAGE);
        (void) TIFFSetField(tiff,TIFFTAG_DATETIME,image->date);
        (void) TIFFSetField(tiff,TIFFTAG_ARTIST,image->artist);
        (void) TIFFSetField(tiff,TIFFTAG_IMAGEDESCRIPTION,
          (uint8 *) image->description,strlen(image->description)+1);
        (void) TIFFSetField(tiff,TIFFTAG_HOSTCOMPUTER,
          (uint8 *) image->host_computer,strlen(image->host_computer)+1);
        (void) TIFFSetField(tiff,TIFFTAG_HOSTSOFTWARE,
          (uint8 *) image->host_software,strlen(image->host_software)+1);
        (void) TIFFSetField(tiff,TIFFTAG_OSOFTWARE,
          (uint8 *) image->software,strlen(image->software)+1);
        (void) TIFFSetField(tiff,TIFFTAG_DOCUMENTNAME,
          (uint8 *) image->filename,strlen(image->filename)+1);
        (void) TIFFSetField(tiff,TIFFTAG_PAGENAME,
          (uint8 *) image->filename,strlen(image->filename)+1);
        (void) TIFFSetField(tiff,TIFFTAG_SUBFILETYPE,FILETYPE_PAGE);
        (void) TIFFSetField(tiff,TIFFTAG_DATETIME,image->date);
        (void) TIFFSetField(tiff,TIFFTAG_ARTIST,image->artist);
        (void) TIFFSetField(tiff,TIFFTAG_IMAGEDESCRIPTION,
          (uint8 *) image->description,strlen(image->description)+1);
        (void) TIFFSetField(tiff,TIFFTAG_HOSTCOMPUTER,
          (uint8 *) image->host_computer,strlen(image->host_computer)+1);
        (void) TIFFSetField(tiff,TIFFTAG_HOSTSOFTWARE,
          (uint8 *) image->host_software,strlen(image->host_software)+1);
        (void) TIFFSetField(tiff,TIFFTAG_OSOFTWARE,
          (uint8 *) image->software,strlen(image->software)+1);
        (void) TIFFSetField(tiff,TIFFTAG_DOCUMENTNAME,
          (uint8 *) image->filename,strlen(image->filename)+1);
        (void) TIFFSetField(tiff,TIFFTAG_PAGENAME,
          (uint8 *) image->filename,strlen(image->filename)+1);
        (void) TIFFSetField(tiff,TIFFTAG_SUBFILETYPE,FILETYPE_PAGE);
        (void) TIFFSetField(tiff,TIFFTAG_DATETIME,image->date);
        (void) TIFFSetField(tiff,TIFFTAG_ARTIST,image->artist);
        (void) TIFFSetField(tiff,TIFFTAG_IMAGEDESCRIPTION,
          (uint8 *) image->description,strlen(image->description)+1);
        (void) TIFFSetField(tiff,TIFFTAG_HOSTCOMPUTER,
          (uint8 *) image->host_computer,strlen(image->host_computer)+1);
        (void) TIFFSetField(tiff,TIFFTAG_HOSTSOFTWARE,
          (uint8 *) image->host_software,strlen(image->host_software)+1);
        (void) TIFFSetField(tiff,TIFFTAG_OSOFTWARE,
          (uint8 *) image->software,strlen(image->software)+1);
        (void) TIFFSetField(tiff,TIFFTAG_DOCUMENTNAME,
          (uint8 *) image->filename,strlen(image->filename)+1);
        (void) TIFFSetField(tiff,TIFFTAG_PAGENAME,
          (uint8 *) image->filename,strlen(image->filename)+1);
        (void) TIFFSetField(tiff,TIFFTAG_SUBFILETYPE,FILETYPE_PAGE);
        (void) TIFFSetField(tiff,TIFFTAG_DATETIME,image->date);
        (void) TIFFSetField(tiff,TIFFTAG_ARTIST,image->artist);
        (void) TIFFSetField(tiff,TIFFTAG_IMAGEDESCRIPTION,
          (uint8 *) image->description,strlen(image->description)+1);
        (void) TIFFSetField(tiff,TIFFTAG_HOSTCOMPUTER,
          (uint8 *) image->