_per_sample);
        if (bits_per_sample == 8)
          (void) TIFFSetField(tiff,TIFFTAG_JPEGTABLESMODE,JPEGTablesMode_QUANT);
        else
          (void) TIFFSetField(tiff,TIFFTAG_JPEGTABLESMODE,JPEGTablesMode_NONE);
#endif
        break;
      }
      case COMPRESSION_NONE:
      {
        if (image->depth == 1)
          {
            predictor=2;
            (void) TIFFSetField(tiff,TIFFTAG_PREDICTOR,predictor);
          }
        break;
      }
      default:
        break;
    }
    if (image->depth == 1)
      {
        if (image->alpha_trait != UndefinedPixelTrait)
          (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,2);
        else
          (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
      }
    if (image->depth > 8)
      {
        if (image->depth == 16)
          (void) TIFFSetField(tiff,TIFFTAG_BITSPERSAMPLE,16);
        else
          (void) TIFFSetField(tiff,TIFFTAG_BITSPERSAMPLE,image->depth);
      }
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_BITSPERSAMPLE,8);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth < 8)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,3);
    if (image->depth == 1)
      (void) TIFFSetField(tiff,TIFFTAG_SAMPLESPERPIXEL,1);
    if (image->depth > 8)
      (void) TIFFSet