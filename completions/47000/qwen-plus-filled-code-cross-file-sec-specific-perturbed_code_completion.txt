case 0x07: /* Open Connection Request 2 */
  if (packet->payload_packet_len < 36) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  ip_addr_offset = raknet_dissect_ip(packet, 18);
  if (ip_addr_offset == 0 || ip_addr_offset + 18 > packet->payload_packet_len) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  u_int16_t mtu_size = ntohs(get_u_int16_t(packet->payload, ip_addr_offset + 18));
  if (mtu_size > 1500) { // Ensure MTU size does not exceed the maximum supported limit
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }
  required_packets = 6;
  break;

case 0x08: /* Open Connection Reply 2 */
  if (packet->payload_packet_len < 40) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  ip_addr_offset = raknet_dissect_ip(packet, 20);
  if (ip_addr_offset == 0 || ip_addr_offset + 20 > packet->payload_packet_len) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  mtu_size = ntohs(get_u_int16_t(packet->payload, ip_addr_offset + 20));
  if (mtu_size > 1500) { // Ensure MTU size does not exceed the maximum supported limit
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  if (packet->payload[ip_addr_offset + 22] > 0x01) { // Check connection encryption flag
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }
  required_packets = 4;
  break;