case 0x07: /* Open Connection Request 2 */
    {
      if (packet->payload_packet_len < 34 ||
          packet->payload[17] > 10)
      {
        NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
        return;
      }

      ip_addr_offset = 18;
      {
        size_t ip_len = raknet_dissect_ip(packet, ip_addr_offset);
        if (!ip_len)
        {
          NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
          return;
        }
        ip_addr_offset += ip_len; /* skip IP */
        ip_addr_offset += 2;      /* skip port */
      }

      if (ip_addr_offset + 2 > packet->payload_packet_len)
      {
        NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
        return;
      }

      {
        u_int16_t max_mtu_size = ntohs(get_u_int16_t(packet->payload, ip_addr_offset));
        ip_addr_offset += 2;
        if (max_mtu_size > 1500)
        {
          NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
          return;
        }
      }

      required_packets = 6;
    }
    break;

    case 0x08: /* Open Connection Reply 2 */
    {
      if (packet->payload_packet_len < 36 ||
          packet->payload[25] > 0x01)
      {
        NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
        return;
      }

      ip_addr_offset = 26;
      {
        size_t ip_len = raknet_dissect_ip(packet, ip_addr_offset);
        if (!ip_len)
        {
          NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
          return;
        }
        ip_addr_offset += ip_len; /* skip IP */
        ip_addr_offset += 2;      /* skip port */
      }

      if (ip_addr_offset + 2 > packet->payload_packet_len)
      {
        NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
        return;
      }

      {
        u_int16_t max_mtu_size = ntohs(get_u_int16_t(packet->payload, ip_addr_offset));
        ip_addr_offset += 2;
        if (max_mtu_size > 1500)
        {
          NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
          return;
        }
      }

      required_packets = 4;
    }
    break;