case 0x07: /* Open Connection Request 2 */
  {
    if (packet->payload_packet_len < 30) /* Minimum expected length */
    {
      NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
      return;
    }
    
    ip_addr_offset = 1 + 16 /* magic */;
    ip_addr_offset += raknet_dissect_ip(packet, ip_addr_offset);
    ip_addr_offset += 2 /* port */ + 2 /* MTU size */ + 8 /* client GUID */;
    
    if (ip_addr_offset != packet->payload_packet_len)
    {
      NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
      return;
    }
    
    u_int16_t mtu_size = ntohs(get_u_int16_t(packet->payload, ip_addr_offset - 10));
    if (mtu_size > 1500 /* Max. supported MTU */)
    {
      NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
      return;
    }
    
    required_packets = 6;
  }
  break;

case 0x08: /* Open Connection Reply 2 */
  {
    if (packet->payload_packet_len < 30) /* Minimum expected length */
    {
      NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
      return;
    }
    
    ip_addr_offset = 1 + 16 /* magic */ + 8 /* server GUID */;
    ip_addr_offset += raknet_dissect_ip(packet, ip_addr_offset);
    ip_addr_offset += 2 /* port */ + 2 /* MTU size */ + 1 /* encryption */;
    
    if (ip_addr_offset != packet->payload_packet_len)
    {
      NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
      return;
    }
    
    u_int16_t mtu_size = ntohs(get_u_int16_t(packet->payload, ip_addr_offset - 3));
    if (mtu_size > 1500 /* Max. supported MTU */)
    {
      NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
      return;
    }
    
    if (packet->payload[ip_addr_offset - 1] > 0x01 /* use encryption: bool -> 0x00 or 0x01 */)
    {
      NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
      return;
    }
    
    required_packets = 4;
  }
  break;