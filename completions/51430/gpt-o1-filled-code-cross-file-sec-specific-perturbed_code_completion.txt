{
  // Compare the first part of the compound word with the current segment.
  // If they match, that indicates a repeated pattern: return NULL.
  if ((i > 0) && (2 * i <= compound_word.size()) &&
      (compound_word.compare(0, i, compound_word, i, i) == 0)) {
    return NULL;
  }

  // Temporarily modify st at position i.
  char saved_ch = st[i];
  st[i] = '\0';

  // Check for repeated pattern in the partial substring.
  if (checkcompoundrep && cpdrep_check(st.c_str(), i)) {
    st[i] = saved_ch;
    return NULL;
  }

  // Check if this partial substring is a forbidden word.
  struct hentry* rv_check = lookup(st.c_str(), i);
  while (rv_check) {
    if (rv_check->astr && TESTAFF(rv_check->astr, forbiddenword, rv_check->alen)) {
      st[i] = saved_ch;
      return NULL;
    }
    rv_check = rv_check->next_homonym;
  }

  // Restore the character at position i.
  st[i] = saved_ch;
}