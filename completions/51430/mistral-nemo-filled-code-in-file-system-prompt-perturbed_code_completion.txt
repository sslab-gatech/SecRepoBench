// masked region
struct hentry* AffixMgr::prefix_check(const std::string& word,
                                      int start,
                                      int len,
                                      char in_compound,
                                      const FLAG needflag) {
  struct hentry* rv = NULL;
  pfx = NULL;
  pfxappnd = NULL;
  sfxappnd = NULL;
  sfxextra = 0;
  sfxflag = FLAG_NULL;

  // first handle the special case of 0 length prefixes
  PfxEntry* pe = pStart[0];
  while (pe) {
    if (// fogemorpheme
            ((in_compound != IN_CPD_NOT) ||
             !(pe->getCont() &&
               (TESTAFF(pe->getCont(), onlyincompound, pe->getContLen())))) &&
            // permit prefixes in compounds
            ((in_compound != IN_CPD_END) ||
             (pe->getCont() &&
              (TESTAFF(pe->getCont(), compoundpermitflag, pe->getContLen()))))) {
      rv = pe->checkword(word, start, len, in_compound, needflag);
      if (rv) {
        pfx = pe;  // BUG: pfx not stateless
        return rv;
      }
    }
    pe = pe->getNext();
  }

  // now handle the general case
  if (len == 0)
    return NULL;  // FULLSTRIP
  unsigned char sp = word[start + len - 1];
  PfxEntry* pptr = pStart[sp];

  while (pptr) {
    if (isSubset(pptr->getKey(), word.c_str() + start + len - 1, len)) {
      if (// fogemorpheme
              ((in_compound != IN_CPD_NOT) ||
               !(pptr->getCont() &&
                 (TESTAFF(pptr->getCont(), onlyincompound, pptr->getContLen())))) &&
              // permit prefixes in compounds
              ((in_compound != IN_CPD_END) ||
               (pptr->getCont() &&
                (TESTAFF(pptr->getCont(), compoundpermitflag, pptr->getContLen()))))) {
        rv = pptr->checkword(word, start, len, in_compound, needflag);
        if (rv) {
          pfx = pptr;  // BUG: pfx not stateless
          return rv;
        }
      }
      pptr = pptr->getNextEQ();
    } else {
      pptr = pptr->getNextNE();
    }
  }

  return NULL;
}