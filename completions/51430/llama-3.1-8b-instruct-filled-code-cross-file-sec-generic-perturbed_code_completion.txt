if (checkcompoundrep || forbiddenword) {

  // Check if the compound word contains repetitions of characters or patterns.
  // If such a pattern is found, return NULL to indicate an invalid compound word.
  // Compare the first part of the compound word with the current segment.
  // If they match, temporarily modify the string to check for repetitions or
  // forbidden word patterns in the modified segment.
  // If a forbidden pattern or word is detected, restore the modified character
  // and continue to the next iteration.
  // If no issues are detected, restore the modified character and proceed.

  // Check for repetitions of characters
  for (int i = 0; i < len; i++) {
    for (int j = i + 1; j < len; j++) {
      if (compound_word[i] == compound_word[j]) {
        // Check if the repeated character is a forbidden word pattern
        if (forbiddenword && TESTAFF(compound_word.substr(i, j - i + 1).c_str(), forbiddenword, j - i + 1)) {
          return NULL;
        }
        // Check if the repeated character is a repetition of a pattern
        if (checkcompoundrep && cpdrep_check(compound_word.c_str(), len)) {
          return NULL;
        }
      }
    }
  }

  // Check for forbidden word patterns
  for (int i = 0; i < len; i++) {
    for (int j = i + 1; j < len; j++) {
      std::string pattern = compound_word.substr(i, j - i + 1);
      if (forbiddenword && TESTAFF(pattern.c_str(), forbiddenword, j - i + 1)) {
        return NULL;
      }
    }
  }

  // Check for dictionary word pairs
  if (cpdwordpair_check(compound_word.c_str(), len)) {
    return NULL;
  }

  return rv_first;
}