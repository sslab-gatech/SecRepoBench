// masked region
struct hentry* AffixMgr::prefix_check(const std::string& word,
                                      int start,
                                      int len,
                                      char in_compound,
                                      const FLAG needflag) {
  struct hentry* rv = NULL;
  PfxEntry* ep = pfx;
  pfxappnd = NULL;
  sfxappnd = NULL;
  sfxextra = 0;

  // first handle the special case of 0 length prefixes
  PfxEntry* pe = pStart[0];
  while (pe) {
    if (ep && (ep->getCont() && (TESTAFF(ep->getCont(), compoundforbidflag,
                                          ep->getContLen())))) {
      rv = NULL;
    }
    if (!cclass || pe->getCont()) {
      // suffixes are not allowed in beginning of compounds
      if ((((in_compound != IN_CPD_NOT) || !cclass) &&
           // except when signed with compoundpermitflag flag
           (pe->getCont() && (TESTAFF(pe->getCont(), compoundpermitflag,
                                          pe->getContLen())))) &&
          // needaffix on prefix or first suffix
          (cclass ||
           !(pe->getCont() && (TESTAFF(pe->getCont(), needaffix,
                                          pe->getContLen())) ||
           (ppfx && !(ep->getCont() && (TESTAFF(ep->getCont(), needaffix,
                                          ep->getContLen()))))) {
        rv = pe->checkword(word, start, len, in_compound, needflag);
        if (rv) {
          pfx = pe;  // BUG: pfx not stateless
          return rv;
        }
      }
    }
    pe = pe->getNext();
  }

  // now handle the general case
  if (len == 0)
    return NULL;  // FULLSTRIP
  unsigned char sp = word[start + len - 1];
  PfxEntry* pptr = pStart[sp];

  while (pptr) {
    if (isSubset(pptr->getKey(), word.c_str() + start + len - 1, len)) {
      if (ep && (ep->getCont() && (TESTAFF(ep->getCont(), compoundforbidflag,
                                          ep->getContLen())))) {
        rv = NULL;
      }
      if (!cclass || pptr->getCont()) {
        // suffixes are not allowed in beginning of compounds
        if ((((in_compound != IN_CPD_NOT) || !cclass) &&
             // except when signed with compoundpermitflag flag
             (pptr->getCont() && (TESTAFF(pptr->getCont(), compoundpermitflag,
                                          pptr->getContLen())))) &&
            // needaffix on prefix or first suffix
            (cclass ||
             !(pptr->getCont() && (TESTAFF(pptr->getCont(), needaffix,
                                          pptr->getContLen())) ||
             (ppfx && !(ep->getCont() && (TESTAFF(ep->getCont(), needaffix,
                                          ep->getContLen()))))) {
        rv = pptr->checkword(word, start, len, in_compound, needflag);
        if (rv) {
          pfx = pptr;  // BUG: pfx not stateless
          return rv;
        }
        pptr = pptr->getNextEQ();
      } else {
        pptr = pptr->getNextNE();
      }
    }
  }

  return NULL;
}