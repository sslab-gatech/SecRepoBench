char savedChar = st[i];

// Compare the first part of the compound word (st[0..i-1]) 
// with the current segment (st[i..2i-1]) if there's enough length.
if ((i * 2 <= (int)st.size()) && (st.compare(0, i, st, i, i) == 0)) {
    // Temporarily modify the character at position i
    st[i] = '#';

    // Check for repeated patterns
    if (checkcompoundrep && cpdrep_check(st.c_str(), st.size())) {
        // Restore and return invalid
        st[i] = savedChar;
        return NULL;
    }

    // Check for forbidden words
    if (forbiddenword) {
        hentry* tmp = lookup(st.c_str(), st.size());
        while (tmp) {
            if (TESTAFF(tmp->astr, forbiddenword, tmp->alen)) {
                // Restore and continue/return invalid
                st[i] = savedChar;
                return NULL;
            }
            tmp = tmp->next_homonym;
        }
    }

    // Restore if no issues found
    st[i] = savedChar;
}