line.clear();
line.reserve(m_cacheSize);

while (true) {
    if (m_cachePos >= m_cacheSize) {
        if (!readNextBlock()) {
            return !line.empty();
        }
    }

    while (m_cachePos < m_cacheSize) {
        T ch = m_cache[m_cachePos++];
        if (ch == '\r' || ch == '\n') {
            if (ch == '\r' && m_cachePos < m_cacheSize && m_cache[m_cachePos] == '\n') {
                ++m_cachePos;
            }
            return true;
        }
        line.push_back(ch);
    }
}