if (m_cache.empty() || m_cachePos == m_cache.size()) {
    if (!readNextBlock()) {
        return false;
    }
}

line.clear();
while (m_cachePos < m_cache.size()) {
    T c = m_cache[m_cachePos++];
    if (c == '\n' || c == '\r') {
        break;
    }
    line.push_back(c);
}

return !line.empty();