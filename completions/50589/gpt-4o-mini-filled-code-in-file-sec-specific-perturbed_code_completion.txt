line.clear();
    size_t i = 0;

    while (true) {
        if (m_cachePos >= m_cacheSize) {
            if (!readNextBlock()) {
                break; // End of stream
            }
        }

        if (m_cachePos >= size()) {
            break; // Prevent reading past the end
        }

        if (IsLineEnd(m_cache[m_cachePos])) {
            ++m_cachePos; // Skip the end-of-line character
            if (i > 0) {
                break; // Line read successfully
            }
            continue; // Skip empty lines
        }

        if (i >= line.size()) {
            line.resize(i + 1); // Resize to accommodate new character
        }

        line[i] = m_cache[m_cachePos];
        ++m_cachePos;
        ++i;
    }

    if (i > 0) {
        line.resize(i); // Resize to the actual line length
        return true; // Successfully read a line
    }

    return false; // No line read