line.clear();
if (m_cachePos >= m_cacheSize || 0 == m_filePos) {
    if (!readNextBlock()) {
        return false;
    }
}

size_t i = 0;
for (;;) {
    if (IsLineEnd(m_cache[m_cachePos])) {
        break;
    }

    line.push_back(m_cache[m_cachePos]);
    ++m_cachePos;
    ++i;

    if (m_cachePos >= m_cacheSize) {
        if (!readNextBlock()) {
            return false;
        }
    }
}

if (m_cachePos < m_cacheSize) {
    if (IsLineEnd(m_cache[m_cachePos])) {
        ++m_cachePos;
    }
}

return true;