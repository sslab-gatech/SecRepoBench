line.clear();
line.reserve(m_cacheSize);

while (true) {
    if (m_cachePos >= m_cacheSize || (m_filePos == 0 && m_cachePos == 0)) {
        if (!readNextBlock()) {
            return !line.empty();
        }
    }

    size_t endPos = m_cachePos;
    while (endPos < m_cacheSize && !IsLineEnd(m_cache[endPos])) {
        ++endPos;
    }

    line.insert(line.end(), m_cache.begin() + m_cachePos, m_cache.begin() + endPos);
    m_cachePos = endPos;

    if (m_cachePos < m_cacheSize) {
        // Found end of line within current cache
        ++m_cachePos; // Skip the newline character
        if (m_cachePos < m_cacheSize && m_cache[m_cachePos] == '\n' && m_cache[m_cachePos - 1] == '\r') {
            ++m_cachePos; // Skip \n if we have \r\n
        }
        return true;
    }

    // If we've reached here, we need to read the next block
}