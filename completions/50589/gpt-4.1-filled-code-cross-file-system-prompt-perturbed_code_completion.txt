line.clear();

while (true) {
    // If cache is exhausted, try to read the next block
    if (m_cachePos >= m_cache.size()) {
        if (!readNextBlock()) {
            // If nothing was read and no line has been accumulated, return false
            return !line.empty();
        }
    }

    // Read characters from the cache until end-of-line or end-of-cache
    while (m_cachePos < m_cache.size()) {
        T c = m_cache[m_cachePos++];
        // Handle both '\n' and '\r' as line endings
        if (c == T('\n') || c == T('\r')) {
            // Handle possible "\r\n" or "\n\r" sequences
            if (m_cachePos < m_cache.size()) {
                T next = m_cache[m_cachePos];
                if ((c == T('\r') && next == T('\n')) || (c == T('\n') && next == T('\r'))) {
                    ++m_cachePos;
                }
            }
            return true;
        }
        line.push_back(c);
    }
    // If we reach here, the cache is exhausted but no EOL was found, so continue to refill
}