// Clear the line buffer
line.clear();
line.resize(256);  // Start with a reasonable size
size_t i = 0;

// If we're at the end of the cache, read the next block
if (m_cachePos >= m_cacheSize) {
    if (!readNextBlock()) {
        return false;  // End of stream reached
    }
}

// Read characters until we find the end of line or the end of the stream
while (true) {
    // Check for end of line
    if (IsLineEnd(m_cache[m_cachePos])) {
        // Skip the line ending character(s)
        ++m_cachePos;
        // If we have \r\n, skip the \n as well
        if (m_cachePos < m_cacheSize && 
            m_cache[m_cachePos-1] == '\r' && 
            m_cache[m_cachePos] == '\n') {
            ++m_cachePos;
        }
        break;
    }

    // Add the current character to the line
    line[i] = m_cache[m_cachePos];
    ++m_cachePos;
    ++i;

    // Resize the buffer if needed
    if (i == line.size()) {
        line.resize(line.size() * 2);
    }

    // If we've reached the end of the cache, try to read more data
    if (m_cachePos >= m_cacheSize) {
        if (!readNextBlock()) {
            break;  // End of stream reached
        }
    }
}

// Resize the line to its actual content length
line.resize(i);

// Return true if we've read any data
return i > 0;