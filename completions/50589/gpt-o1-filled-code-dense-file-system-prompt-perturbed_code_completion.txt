line.clear();
if (m_cachePos >= m_cacheSize) {
    if (!readNextBlock()) {
        return false;
    }
}

if (line.empty()) {
    line.resize(128);
}

size_t i = 0;

while (true) {
    if (continuationToken == m_cache[m_cachePos] && IsLineEnd(m_cache[m_cachePos + 1])) {
        ++m_cachePos;
        while (m_cachePos < m_cacheSize && m_cache[m_cachePos] != '\n') {
            ++m_cachePos;
        }
        if (m_cachePos < m_cacheSize) {
            ++m_cachePos;
        }
    } else if (IsLineEnd(m_cache[m_cachePos])) {
        ++m_cachePos;
        break;
    }

    line[i] = m_cache[m_cachePos];
    ++m_cachePos;
    ++i;

    if (i == line.size()) {
        line.resize(line.size() * 2);
    }

    if (m_cachePos >= m_cacheSize) {
        if (!readNextBlock()) {
            break;
        }
    }
}

if (i == 0) {
    return false;
}

line.resize(i);
return true;