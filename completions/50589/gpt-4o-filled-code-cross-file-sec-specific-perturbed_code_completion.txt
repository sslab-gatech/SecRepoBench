line.clear();

    while (true) {
        // Check if the cache is exhausted
        if (m_cachePos >= m_cache.size()) {
            if (!readNextBlock()) {
                // End of stream reached
                return !line.empty();
            }
        }

        // Read characters from the cache
        T c = m_cache[m_cachePos++];
        
        // Check for end-of-line characters
        if (c == '\n' || c == '\r') {
            // Handle potential \r\n or \n\r sequences
            if (c == '\r' && m_cachePos < m_cache.size() && m_cache[m_cachePos] == '\n') {
                ++m_cachePos;
            } else if (c == '\n' && m_cachePos < m_cache.size() && m_cache[m_cachePos] == '\r') {
                ++m_cachePos;
            }
            return true;
        }

        // Add character to the line
        line.push_back(c);
    }