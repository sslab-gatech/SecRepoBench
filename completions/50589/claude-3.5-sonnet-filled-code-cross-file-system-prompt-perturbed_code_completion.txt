if (line.empty()) {
    line.reserve(256);
}

while (true) {
    if (m_cachePos >= m_cache.size()) {
        if (!readNextBlock()) {
            return !line.empty();
        }
    }

    while (m_cachePos < m_cache.size()) {
        T c = m_cache[m_cachePos++];
        if (c == '\r' || c == '\n') {
            if (!line.empty()) {
                // Skip any additional newline characters
                while (m_cachePos < m_cache.size() && (m_cache[m_cachePos] == '\r' || m_cache[m_cachePos] == '\n')) {
                    ++m_cachePos;
                }
                return true;
            }
        } else {
            line.push_back(c);
        }
    }
}