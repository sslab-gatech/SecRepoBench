line.clear();

    while (true) {
        if (m_cachePos >= m_cacheSize) {
            if (!readNextBlock()) {
                // End of stream reached
                if (line.empty()) {
                    return false; // No data read at all
                }
                return true; // Return the last line, even if it's incomplete
            }
        }

        T c = m_cache[m_cachePos++];

        // Check for end-of-line characters
        if (c == '\n' || c == '\r') {
            // Skip consecutive end-of-line characters
            while (m_cachePos < m_cacheSize && (m_cache[m_cachePos] == '\n' || m_cache[m_cachePos] == '\r')) {
                m_cachePos++;
            }
            return true;
        }

        line.push_back(c);
    }