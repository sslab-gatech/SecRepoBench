line.clear();
    if (m_cachePos >= m_cacheSize && m_blockIdx >= m_numBlocks) {
        return false;
    }

    line.reserve(m_cacheSize); // Reserve space to avoid frequent reallocations

    while (true) {
        if (m_cachePos >= m_cacheSize) {
            if (!readNextBlock()) {
                // Check if any data was read before returning
                return !line.empty();
            }
        }

        // Read characters until end of line or end of cache
        while (m_cachePos < m_cacheSize) {
            T c = m_cache[m_cachePos++];
            if (IsLineEnd(c)) {
                // Skip any subsequent end-of-line characters
                while (m_cachePos < m_cacheSize && IsLineEnd(m_cache[m_cachePos])) {
                    ++m_cachePos;
                }
                return true; // Line successfully read
            }
            line.push_back(c);
        }
    }