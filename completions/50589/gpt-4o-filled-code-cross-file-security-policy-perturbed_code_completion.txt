line.clear();

    while (true) {
        // Check if we need to read more data into the cache
        if (m_cachePos >= m_cache.size()) {
            if (!readNextBlock()) {
                return !line.empty(); // Return true if we have read any data, false otherwise
            }
        }

        // Read characters from the cache until we find a newline or reach the end of the cache
        while (m_cachePos < m_cache.size()) {
            T c = m_cache[m_cachePos++];
            
            // Check for newline characters
            if (c == '\n') {
                return true; // Successfully read a line
            } else if (c == '\r') {
                // Check for a possible "\r\n" sequence
                if (m_cachePos < m_cache.size() && m_cache[m_cachePos] == '\n') {
                    ++m_cachePos; // Skip the '\n'
                }
                return true; // Successfully read a line
            } else {
                line.push_back(c); // Add character to the line
            }
        }
    }