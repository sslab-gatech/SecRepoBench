line.clear();
    size_t i = 0;

    while (true) {
        if (m_cachePos >= m_cacheSize) {
            if (!readNextBlock()) {
                if (i == 0) {
                    return false; // No data read
                }
                break; // End of stream reached
            }
        }

        if (IsLineEnd(m_cache[m_cachePos])) {
            ++m_cachePos; // Skip the end-of-line character
            break; // Line read complete
        }

        if (i >= line.size()) {
            line.resize(i + 1); // Resize to accommodate new character
        }

        line[i++] = m_cache[m_cachePos++];
    }

    line.resize(i); // Resize to the actual length of the line
    return true;