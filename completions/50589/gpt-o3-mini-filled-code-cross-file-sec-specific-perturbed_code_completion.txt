line.clear();
bool lineFound = false;
while (true) {
    if (m_cachePos >= m_cache.size()) {
        if (!readNextBlock())
            break;
    }
    while (m_cachePos < m_cache.size()) {
        T c = m_cache[m_cachePos++];
        if (c == '\n' || c == '\r') {
            lineFound = true;
            if (c == '\r' && m_cachePos < m_cache.size() && m_cache[m_cachePos] == '\n')
                ++m_cachePos;
            goto finish;
        }
        line.push_back(c);
    }
}
finish:
if (line.empty() && !lineFound)
    return false;
return true;