line.clear();

    // Attempt to fill the line buffer until an end-of-line is encountered or no more data is available
    while (true) {
        // If we've run out of cache, fill it
        if (m_cachePos >= m_cache.size()) {
            if (!readNextBlock()) {
                // Return false only if no characters have been read (line would be empty)
                return !line.empty();
            }
        }

        T c = m_cache[m_cachePos++];
        // Check for newline or carriage return
        if (c == T('\n') || c == T('\r')) {
            // Handle Windows-style "\r\n"
            if (c == T('\r') && m_cachePos < m_cache.size() && m_cache[m_cachePos] == T('\n')) {
                m_cachePos++;
            }
            return true;
        }

        // Otherwise, add the character to the line
        line.push_back(c);
    }