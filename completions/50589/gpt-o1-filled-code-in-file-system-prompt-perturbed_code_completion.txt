{
    line.clear();

    // Attempt to read from current cache; if exhausted, read next block
    if (m_cachePos >= m_cacheSize) {
        if (!readNextBlock()) {
            return false; // no data to read
        }
    }

    // Skip over any end-of-line characters from a previous read
    while (true) {
        if (m_cachePos >= m_cacheSize) {
            if (!readNextBlock()) {
                // no further data in the stream
                return false;
            }
        }
        if (!IsLineEnd(m_cache[m_cachePos])) {
            break;
        }
        ++m_cachePos;
    }

    // Read characters until we encounter a line end
    while (true) {
        if (m_cachePos >= m_cacheSize) {
            // Need more data; try reading the next block
            if (!readNextBlock()) {
                // End of file, return whatever line data we have accumulated
                return !line.empty();
            }
        }
        if (IsLineEnd(m_cache[m_cachePos])) {
            // Found end of line, skip it and return
            ++m_cachePos;
            return true; 
        }
        // Accumulate current character into the output line
        line.push_back(m_cache[m_cachePos]);
        ++m_cachePos;
    }
}