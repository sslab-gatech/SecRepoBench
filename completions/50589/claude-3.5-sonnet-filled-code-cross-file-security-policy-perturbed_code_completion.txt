if (line.empty()) {
    line.reserve(256);
}

if (m_cachePos >= m_cache.size()) {
    if (!readNextBlock()) {
        return false;
    }
    m_cachePos = 0;
}

while (m_cachePos < m_cache.size()) {
    T c = m_cache[m_cachePos++];
    if (c == '\n' || c == '\r') {
        if (c == '\r' && m_cachePos < m_cache.size() && m_cache[m_cachePos] == '\n') {
            m_cachePos++;
        }
        if (!line.empty()) {
            return true;
        }
        continue;
    }
    line.push_back(c);
}

return !line.empty();