if (!m_cache.size() && !readNextBlock()) {
    return false;
}

line.clear();
bool finished = false;

while (!finished) {
    while (m_cachePos < m_cache.size()) {
        T c = m_cache[m_cachePos++];
        if (isEndOfLine(c)) {
            finished = true;
            break;
        }
        line.push_back(c);
    }

    if (!finished && !readNextBlock()) {
        // No more data and line is not finished
        return line.empty() ? false : true;
    }
}

return true;