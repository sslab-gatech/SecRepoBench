if (path_q == (PointInfo *) NULL)
  {
    path_p=(PointInfo *) RelinquishMagickMemory(path_p);
    polygon_primitive=(PrimitiveInfo *) RelinquishMagickMemory(
      polygon_primitive);
    return((PrimitiveInfo *) NULL);
  }
slope.p=0.0;
inverse_slope.p=0.0;
if (fabs(dx.p) < MagickEpsilon)
  {
    if (dx.p >= 0.0)
      slope.p=dy.p < 0.0 ? -1.0/MagickEpsilon : 1.0/MagickEpsilon;
    else
      slope.p=dy.p < 0.0 ? 1.0/MagickEpsilon : -1.0/MagickEpsilon;
  }
else
  if (fabs(dy.p) < MagickEpsilon)
    {
      if (dy.p >= 0.0)
        inverse_slope.p=dx.p < 0.0 ? -1.0/MagickEpsilon : 1.0/MagickEpsilon;
      else
        inverse_slope.p=dx.p < 0.0 ? 1.0/MagickEpsilon : -1.0/MagickEpsilon;
    }
  else
    {
      slope.p=dy.p/dx.p;
      inverse_slope.p=(-1.0/slope.p);
    }
mid=ExpandAffine(&draw_info->affine)*SaneStrokeWidth(image,draw_info)/2.0;
miterlimit=(double) (draw_info->miterlimit*draw_info->miterlimit*mid*mid);
if ((draw_info->linecap == SquareCap) && (closed_path == MagickFalse))
  (void) TraceSquareLinecap(polygon_primitive,number_vertices,mid);
offset.x=sqrt((double) (mid*mid/(inverse_slope.p*inverse_slope.p+1.0)));
offset.y=(double) (offset.x*inverse_slope.p);
if ((dy.p*offset.x-dx.p*offset.y) > 0.0)
  {
    box_p[0].x=polygon_primitive[0].point.x-offset.x;
    box_p[0].y=polygon_primitive[0].point.y-offset.x*inverse_slope.p;
    box_p[1].x=polygon_primitive[n].point.x-offset.x;
    box_p[1].y=polygon_primitive[n].point.y-offset.x*inverse_slope.p;
    box_q[0].x=polygon_primitive[0].point.x+offset.x;
    box_q[0].y=polygon_primitive[0].point.y+offset.x*inverse_slope.p;
    box_q[1].x=polygon_primitive[n].point.x+offset.x;
    box_q[1].y=polygon_primitive[n].point.y+offset.x*inverse_slope.p;
  }
else
  {
    box_p[0].x=polygon_primitive[0].point.x+offset.x;
    box_p[0].y=polygon_primitive[0].point.y+offset.y;
    box_p[1].x=polygon_primitive[n].point.x+offset.x;
    box_p[1].y=polygon_primitive[n].point.y+offset.y;
    box_q[0].x=polygon_primitive[0].point.x-offset.x;
    box_q[0].y=polygon_primitive[0].point.y-offset.y;
    box_q[1].x=polygon_primitive[n].point.x-offset.x;
    box_q[1].y=polygon_primitive[n].point.y-offset.y;
  }