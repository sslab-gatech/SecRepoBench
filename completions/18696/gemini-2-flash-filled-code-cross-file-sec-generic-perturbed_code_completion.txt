PointInfo
    box_p[5],
    box_q[5],
    center,
    dx,
    dy,
    offset;

  PointInfo
    *path_p,
    *path_q;

  PrimitiveInfo
    *polygon_primitive,
    *stroke_polygon;

  register ssize_t
    i,
    j;

  SegmentInfo
    inverse_slope,
    slope,
    theta;

  size_t
    arc_segments,
    n,
    number_vertices,
    p,
    q;

  MagickBooleanType
    closed_path;

  double
    dot_product,
    mid,
    miterlimit;

  /*
    Allocate polygon.
  */
  number_vertices=primitivedata->coordinates;
  polygon_primitive=(PrimitiveInfo *) AcquireQuantumMemory((size_t)
    number_vertices+1,sizeof(*polygon_primitive));
  if (polygon_primitive == (PrimitiveInfo *) NULL)
    return((PrimitiveInfo *) NULL);
  (void) CopyMagickMemory(polygon_primitive,primitivedata,(size_t)
    number_vertices*sizeof(*polygon_primitive));
  closed_path=polygon_primitive[0].closed_subpath;
  n=(ssize_t) number_vertices-1;
  if ((closed_path != MagickFalse) &&
      ((draw_info->linejoin == RoundJoin) ||
       (draw_info->linejoin == MiterJoin)))
    n=(ssize_t) number_vertices-2;
  polygon_primitive[number_vertices].primitive=UndefinedPrimitive;
  /*
    Compute the slope for the first line segment, p.
  */
  dx.p=0.0;
  dy.p=0.0;
  for (i=1; i < (ssize_t) number_vertices; i++)
  {
    dx.p=polygon_primitive[i].point.x-polygon_primitive[n].point.x;
    dy.p=polygon_primitive[i].point.y-polygon_primitive[n].point.y;
    if ((fabs((double) dx.p) >= MagickEpsilon) ||
        (fabs((double) dy.p) >= MagickEpsilon))
      break;
  }
  if (i == (ssize_t) number_vertices)
    {
      polygon_primitive=(PrimitiveInfo *) RelinquishMagickMemory(
        polygon_primitive);
      return((PrimitiveInfo *) NULL);
    }
  /*
    Allocate path.
  */
  path_p=(PointInfo *) AcquireQuantumMemory((size_t)
    number_vertices+6*BezierQuantum+360,sizeof(*path_p));
  path_q=(PointInfo *) AcquireQuantumMemory((size_t)
    number_vertices+6*BezierQuantum+360,sizeof(*path_q));
  if (path_p == (PointInfo *) NULL)
    {
      path_q=(PointInfo *) RelinquishMagickMemory(path_q);
      polygon_primitive=(PrimitiveInfo *) RelinquishMagickMemory(
        polygon_primitive);
      return((PrimitiveInfo *) NULL);
    }