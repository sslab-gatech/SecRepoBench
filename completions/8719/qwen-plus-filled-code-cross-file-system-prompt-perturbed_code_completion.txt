length=(size_t) ReadBlobMSBLong(image);
if (length > (size_t) GetBlobRemainingSize(image))
   ThrowReaderException(CorruptImageError,"ImproperImageHeader");

/* read chunk type */
for (i=0; i < 4; i++)
{
   int
     c;

   c=ReadBlobByte(image);

   if (c == EOF)
     ThrowReaderException(CorruptImageError,
       "InsufficientImageDataInFile");

   type[i]=(char) c;
}

type[4]='\0';

if (logging != MagickFalse)
  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
    "  Reading %c%c%c%c chunk length=%.20g",(int) type[0],(int) type[1],
    (int) type[2],(int) type[3],(double) length);

if (length > (size_t) ((~(size_t))0)/sizeof(unsigned char)-8)
   ThrowReaderException(CorruptImageError,"ImproperImageHeader");

if (length != 0)
{
   chunk_data=(unsigned char *) AcquireQuantumMemory(length,sizeof(*chunk_data));

   if (chunk_data == (unsigned char *) NULL)
     ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
}
else
   chunk_data=(unsigned char *) NULL;