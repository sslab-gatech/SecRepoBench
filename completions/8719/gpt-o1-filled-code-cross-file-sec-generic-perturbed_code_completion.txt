/* Read the chunk length in big-endian format */
length=(size_t) ReadBlobMSBLong(image);

/* Initialize chunk type to an empty string, then read the next 4 bytes as the chunk type */
(void) memset(type,0,sizeof(type));
count=ReadBlob(image,4,(unsigned char *) type);

/* Ensure we successfully read the chunk type */
if (count < 4)
  ThrowReaderException(CorruptImageError,"CorruptImage");

/* Log the chunk we're reading, if logging is enabled */
if (logging != MagickFalse)
  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
    "  Reading %c%c%c%c chunk (%" MAGICK_SIZE_T_F "u bytes)",
    type[0],type[1],type[2],type[3],(MAGICK_SIZE_T) length);

/* Verify that the chunk length does not exceed allowable limits */
if (length > PNG_UINT_31_MAX)
  ThrowReaderException(CorruptImageError,"ChunkLengthExceedsLimit");

/* Optionally check that there is enough data left in the file for this chunk plus CRC */
{
  MagickOffsetType current_offset=TellBlob(image);
  MagickSizeType file_size=GetBlobSize(image);
  if ((current_offset < 0) ||
      ((MagickSizeType) current_offset+length+4 > file_size))
    ThrowReaderException(CorruptImageError,"InsufficientImageDataInFile");
}