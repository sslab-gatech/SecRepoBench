(void) memset(type,0,MagickPathExtent);
length=(size_t) ReadBlobMSBLong(image);
count=(size_t) ReadBlob(image,4,(unsigned char *) type);

if (logging != MagickFalse)
  (void) LogMagickEvent(CoderEvent,GetMagickModule(),
    "  Type: %c%c%c%c, length: %.20g",
    type[0],type[1],type[2],type[3],(double) length);

if (length > PNG_UINT_31_MAX)
  ThrowReaderException(CorruptImageError,"CorruptImage");

if (length > GetBlobSize(image))
  ThrowReaderException(CorruptImageError,"InsufficientImageDataInFile");

p=chunk_data=(unsigned char *) AcquireQuantumMemory(length,sizeof(*chunk_data));

if (chunk_data == (unsigned char *) NULL)
  ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");