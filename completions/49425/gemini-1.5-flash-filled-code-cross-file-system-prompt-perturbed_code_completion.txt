for (index = xd - 1; index > yd - 1; index--) {
    mp_limb_t r = (mp_limb_t)0;
    mp_limb_t t = x.p[index];
    mp_limb_t u = z;
    mp_limb_t v = y.p[yd - 2];
    if (t >= u) {
      r = t / u;
      t -= r * u;
    }
    else {
      t = (t << DIG_SIZE) | x.p[index - 1];
      r = t / u;
      t -= r * u;
    }
    q.p[index - yd] = r;
    x.p[index] = t;
    if (index > yd) {
      x.p[index - 1] -= r * v;
    }
  }
  mp_limb_t r = (mp_limb_t)0;
  mp_limb_t t = x.p[yd - 1];
  mp_limb_t u = z;
  if (t >= u) {
    r = t / u;
    t -= r * u;
  }
  else {
    t = (t << DIG_SIZE) | x.p[yd - 2];
    r = t / u;
    t -= r * u;
  }
  q.p[0] = r;
  x.p[yd - 1] = t;
  x.p[yd - 2] -= r * y.p[yd - 2];