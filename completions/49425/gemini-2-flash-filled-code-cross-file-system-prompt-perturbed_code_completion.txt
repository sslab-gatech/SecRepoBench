for (index = xd; index > yd; ) {
    index--;
    mp_limb1 num = x.p[index];
    mp_limb2 n = ((mp_limb2)num << DIG_SIZE) | x.p[index-1];
    mp_limb1 d = n / z;
    x.p[index] = d;
    mp_limb2 r = n % z;
    x.p[index-1] = (mp_limb1)r;
  }
  mpz_set_size(&q, xd - yd);
  for (size_t i = 0; i < xd - yd; i++) {
    q.p[i] = x.p[yd + i];
  }
  mpz_set_size(&x, yd);
  for (size_t i = 0; i < yd; i++) {
    x.p[i] = x.p[i];
  }