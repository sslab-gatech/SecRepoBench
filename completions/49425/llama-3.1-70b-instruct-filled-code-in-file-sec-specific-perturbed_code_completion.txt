for (index = 0; index < yd; index++) {
  mp_limb2 q = 0;
  mp_limb2s r = 0;
  mp_limb2s d = 0;
  mp_limb2s carry = 0;
  size_t i;

  for (i = 0; i < xd; i++) {
    d = (mp_limb2s)x.p[i + index] + carry;
    q = d / z;
    r = d % z;
    carry = 0;
    if (q > 0) {
      mp_limb2s borrow = 0;
      for (i = i; i < xd; i++) {
        d = (mp_limb2s)x.p[i + index] - (mp_limb2s)y.p[i] * q - borrow;
        if (d < 0) {
          x.p[i + index] = (mp_limb)(d + DIG_BASE);
          borrow = 1;
        } else {
          x.p[i + index] = (mp_limb)d;
          borrow = 0;
        }
      }
      if (borrow) {
        carry = -borrow;
      }
    }
    qq.p[index] = (mp_limb)q;
  }
  if (carry) {
    qq.p[index] = (mp_limb)carry;
  }
}