mp_limb2 qhat, rhat;
  size_t j, qlen = 0;

  while (1) {
    if (ucmp(&x, &y) < 0) {
      zero(qq);
      mpz_set(mrb, rr, &x);
      return;
    }

    qhat = (mp_limb2)(x.p[x.sz - 1] / (y.p[y.sz - 1] + 1));
    rhat = 0;

    while (1) {
      mpz_t t;
      mpz_init(mrb, &t);
      mpz_mul_int(mrb, &t, y, qhat);
      rhat = ucmp(&x, &t);
      if (rhat < 0) {
        qhat--;
      } else {
        break;
      }
      mpz_clear(mrb, &t);
    }

    mpz_t t;
    mpz_init(mrb, &t);
    mpz_mul_int(mrb, &t, y, qhat);
    mpz_sub(mrb, &x, &x, &t);
    mpz_add(mrb, &q, &q, &qhat);
    mpz_clear(mrb, &t);
  }