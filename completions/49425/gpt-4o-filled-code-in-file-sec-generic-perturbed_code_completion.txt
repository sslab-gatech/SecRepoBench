for (index = xd - yd; index != (size_t)-1; index--) {
    mp_limb2 qhat = ((mp_limb2)x.p[index + yd] << DIG_SIZE) + x.p[index + yd - 1];
    qhat /= z;
    if (qhat > DIG_MASK) qhat = DIG_MASK;

    mp_limb2 carry = 0;
    for (size_t j = 0; j < yd; j++) {
      carry += qhat * y.p[j];
      mp_limb2 diff = (mp_limb2)x.p[index + j] - LOW(carry);
      x.p[index + j] = LOW(diff);
      carry = HIGH(carry) + (diff >> DIG_SIZE);
    }
    mp_limb2 diff = (mp_limb2)x.p[index + yd] - carry;
    x.p[index + yd] = LOW(diff);

    if (diff >> DIG_SIZE) {
      qhat--;
      mp_limb2 carry = 0;
      for (size_t j = 0; j < yd; j++) {
        carry += (mp_limb2)x.p[index + j] + y.p[j];
        x.p[index + j] = LOW(carry);
        carry >>= DIG_SIZE;
      }
      x.p[index + yd] += carry;
    }
    q.p[index] = LOW(qhat);
  }