mp_limb2 cy;
mp_size s = xd - yd + 1;

for (index = s - 1; index >= 0; index--) {
  mp_limb2 dhi = (index + yd < xd) ? x.p[index+yd] : 0;
  mp_limb2 dlo = (index + yd - 1 < xd) ? x.p[index+yd-1] : 0;
  mp_limb2 qhat;
  if (dhi == z.hi) {
    qhat = MP_LIMB_T_MAX;
  }
  else {
    qhat = divappr((mp_limb2){dhi, dlo}, z);
  }
  while (mulsub(&cy, qhat, &y, &x, index, yd) == 0 && qhat > 0)
    qhat--;
  q.p[index] = qhat;
}