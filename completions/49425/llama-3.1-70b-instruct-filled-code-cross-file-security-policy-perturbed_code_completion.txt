size_t i;
for (i = xd - yd; i >= 0; i--) {
  mp_limb2 qhat = (x.p[i + yd - 1] << (DIG_SIZE - ns)) | (i + yd > 1? x.p[i + yd - 2] >> ns : 0);
  if (qhat >= z) {
    qhat = z - 1;
  }
  usub(mrb, &x, &x, &y, qhat, i);
  while (ucmp(&x, &y) >= 0) {
    qhat++;
    usub(mrb, &x, &x, &y, 1, i);
  }
  q.p[i] = qhat;
}