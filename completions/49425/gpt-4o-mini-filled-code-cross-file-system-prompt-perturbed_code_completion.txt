mp_limb2 qlimb;
size_t qsize = 0;

while (xd >= yd) {
    // Estimate the quotient limb
    qlimb = x.p[xd - 1] / z;
    if (qlimb == 0) {
        qlimb = 1; // Ensure we don't divide by zero
    }

    // Multiply and subtract
    mpz_t temp;
    mpz_init(mrb, &temp);
    mpz_realloc(mrb, &temp, yd + 1);
    for (size_t i = 0; i < yd; i++) {
        temp.p[i] = y.p[i] * qlimb;
    }
    temp.p[yd] = 0; // Ensure the last limb is zero for proper subtraction

    // Perform subtraction
    if (mpz_cmp(mrb, &x, &temp) >= 0) {
        mpz_sub(mrb, &x, &x, &temp);
        q.p[qsize++] = qlimb; // Store the quotient limb
    } else {
        q.p[qsize++] = 0; // If we can't subtract, store 0
    }

    xd = digits(&x); // Update the digit count of x
}

q.sz = qsize; // Set the size of the quotient