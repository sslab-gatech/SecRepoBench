mp_limb2 z = y.p[yd-1];
if (z == 0) {
  mrb_raise(mrb, E_ZERODIV_ERROR, "divided by zero");
}
size_t q_len = xd - yd + 1;
mpz_realloc(mrb, &q, q_len);
for (size_t i = xd - yd + 1; i > 0; i--) {
  mp_limb2 qq = x.p[i + yd - 1];
  if (i + yd < x.sz) {
    qq = (qq << DIG_SIZE) | x.p[i + yd];
  }
  qq /= z;
  q.p[i - 1] = LOW(qq);
  mp_limb2 r = 0;
  for (size_t j = 0; j < yd; j++) {
    mp_limb2 p = (mp_limb2)q.p[i - 1] * (mp_limb2)y.p[j];
    r += (mp_limb2)x.p[i + j];
    r -= p;
    x.p[i + j] = LOW(r);
    r = HIGH(r);
  }
  x.p[i + yd - 1] += r;
}