for (index = xd - yd; index != (size_t)-1; index--) {
    mp_limb2 qhat = (x.p[index + yd] << DIG_SIZE) + x.p[index + yd - 1];
    qhat /= z;
    if (qhat > DIG_MASK) qhat = DIG_MASK;

    mp_limb2 carry = 0, borrow = 0;
    for (size_t j = 0; j < yd; j++) {
      carry += qhat * y.p[j];
      borrow += x.p[index + j] - LOW(carry);
      x.p[index + j] = LOW(borrow);
      carry = HIGH(carry);
      borrow = HIGH(borrow);
    }
    borrow += x.p[index + yd] - carry;
    x.p[index + yd] = LOW(borrow);

    if (HIGH(borrow)) {
      qhat--;
      carry = 0;
      for (size_t j = 0; j < yd; j++) {
        carry += x.p[index + j] + y.p[j];
        x.p[index + j] = LOW(carry);
        carry = HIGH(carry);
      }
      x.p[index + yd] += carry;
    }
    q.p[index] = qhat;
  }