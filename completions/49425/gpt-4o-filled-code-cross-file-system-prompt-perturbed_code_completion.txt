x.p[xd] = 0;
  for (index = xd; index-- > yd;) {
    mp_limb2 w = x.p[index];
    if (w == z) {
      q.p[index - yd] = MP_LIMB_MAX;
    }
    else {
      q.p[index - yd] = (mp_limb2)((((mp_limb3)w << DIG_SIZE) + x.p[index - 1]) / z);
    }
    mpz_t t;
    mpz_init(mrb, &t);
    mpz_realloc(mrb, &t, yd + 1);
    mpz_mul_int(mrb, &t, &y, q.p[index - yd]);
    mpz_t u;
    mpz_init(mrb, &u);
    mpz_realloc(mrb, &u, index + 1);
    mpz_sub(mrb, &u, &x, &t);
    if (u.sn < 0) {
      q.p[index - yd]--;
      mpz_add(mrb, &u, &u, &y);
    }
    mpz_set(mrb, &x, &u);
    mpz_clear(mrb, &t);
    mpz_clear(mrb, &u);
  }