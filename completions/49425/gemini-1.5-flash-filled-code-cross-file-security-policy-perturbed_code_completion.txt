for (index = 0; index < xd; index++) {
    mp_limb_t r = 0;
    size_t i = xd - 1 - index;
    size_t j = yd - 1;
    mp_limb_t xi = x.p[i];
    while (j > 0 && xi < z) {
      xi = xi * ((mp_limb_t)1 << (sizeof(mp_limb_t)*8)) + x.p[--i];
      j--;
    }
    if (j == 0 && xi < z) {
      break;
    }
    mp_limb_t qj = xi / z;
    q.p[i] = qj;
    r = xi % z;
    size_t k = i;
    while (k > 0) {
      xi = r * ((mp_limb_t)1 << (sizeof(mp_limb_t)*8)) + x.p[--k];
      r = xi / z;
      x.p[k] = xi % z;
    }
    x.p[0] = x.p[0] - (qj * y.p[0]);
  }