mp_limb2 qhat, rhat;
  mp_limb2 z;
  size_t j, k, qlen, rlen;

  for (size_t i = 0; i <= xd - yd; i++) {
    qhat = (x.p[i + yd] * DIG_BASE + x.p[i + yd - 1]) / y.p[yd - 1];
    rhat = (x.p[i + yd] * DIG_BASE + x.p[i + yd - 1]) % y.p[yd - 1];

    while (qhat >= DIG_BASE || (qhat * y.p[yd - 2] > (rhat * DIG_BASE + x.p[i + yd - 2]))) {
      qhat--;
      rhat += y.p[yd - 1];
      if (rhat >= DIG_BASE) {
        break;
      }
    }

    z = 0;
    for (j = 0; j < yd; j++) {
      z += qhat * y.p[j];
      x.p[i + j] -= LOW(z);
      z >>= DIG_SIZE;
    }
    x.p[i + yd] -= LOW(z);

    if (x.p[i + yd] < 0) {
      qhat--;
      z = 0;
      for (j = 0; j < yd; j++) {
        z += x.p[i + j] + y.p[j];
        x.p[i + j] = LOW(z);
        z >>= DIG_SIZE;
      }
      x.p[i + yd] += LOW(z);
    }
  }