ctbytes += sizeof(uint8_t);
if (token == 0) {
  // A run of zeros
  memset(comp_buffer, 0, (unsigned int)neblock);
  nbytes = neblock;
  cbytes = 0;
} else if (token >> 4 == 15) {
  // A run of non-zero bytes
  uint8_t run_value = token & 0x0F;
  if (run_value == 0) {
    if (srcsize < sizeof(uint8_t)) {
      return BLOSC2_ERROR_READ_BUFFER;
    }
    run_value = src[0];
    src += 1;
    ctbytes += sizeof(uint8_t);
    srcsize -= sizeof(uint8_t);
  }
  memset(comp_buffer, run_value, (unsigned int)neblock);
  nbytes = neblock;
  cbytes = 0;
} else {
  // An invalid token
  return BLOSC2_ERROR_DATA;
}