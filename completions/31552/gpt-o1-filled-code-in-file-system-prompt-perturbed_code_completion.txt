if (token == 1) {
  /* Token indicates a run of non-zero bytes.  The byte value
     to be repeated is the absolute value of cbytes (since it's negative). */
  int run_val = (int8_t)(-cbytes);

  /* Validate that the block isn't too large for a run. */
  if ((uint32_t)neblock > (1U << 31U)) {
    return BLOSC2_ERROR_2GB_LIMIT;
  }

  /* Fill the entire block with run_val. */
  memset(comp_buffer, (uint8_t)run_val, (size_t)neblock);

  /* Set the number of decompressed bytes to the whole block. */
  nbytes = neblock;

  /* The token fully accounted for these bytes, so mark the compressed bytes as zero now. */
  cbytes = 0;
}
else {
  /* Unknown token for non-zero run, so fail. */
  return BLOSC2_ERROR_DATA;
}