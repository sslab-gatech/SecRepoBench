// Check if the token indicates a run of non-zero bytes
if (token & 0x80) {
  // Validate that the run length does not exceed a specific limit
  int run_length = (token & 0x7f) + 1;
  if (run_length > neblock) {
    return BLOSC2_ERROR_DATA;
  }
  // Use the token to determine the byte value for the run
  uint8_t byte_value = src[0];
  src += 1;
  // Fill the destination buffer with the byte value
  memset(comp_buffer, byte_value, (unsigned int)run_length);
  // Set decompressed bytes to the number of elements in the block
  nbytes = run_length;
  // Ensure the compressed bytes for this stream is zeroed, as it is fully encoded in the token
  cbytes = 0;
} else {
  // Token indicates a run of non-zero bytes
  // Validate that the run length does not exceed a specific limit
  int run_length = token + 1;
  if (run_length > neblock) {
    return BLOSC2_ERROR_DATA;
  }
  // Use the token to determine the byte value for the run
  uint8_t byte_value = src[0];
  src += 1;
  // Fill the destination buffer with the byte value
  memset(comp_buffer, byte_value, (unsigned int)run_length);
  // Set decompressed bytes to the number of elements in the block
  nbytes = run_length;
  // Ensure the compressed bytes for this stream is zeroed, as it is fully encoded in the token
  cbytes = 0;
}