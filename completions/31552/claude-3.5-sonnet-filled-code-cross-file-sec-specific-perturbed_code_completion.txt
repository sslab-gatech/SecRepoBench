ctbytes += 1;
if (token >= 0x80) {
  // Run of non-zero bytes
  int32_t run_length = (token & 0x7f) + 1;
  if (run_length > neblock) {
    return BLOSC2_ERROR_DATA;
  }
  uint8_t value = src[0];
  src += 1;
  ctbytes += 1;
  srcsize -= 1;
  memset(comp_buffer, value, run_length);
  nbytes = run_length;
} else {
  // Run of zeros
  nbytes = (token & 0x7f) + 1;
  if (nbytes > neblock) {
    return BLOSC2_ERROR_DATA;
  }
  memset(comp_buffer, 0, nbytes);
}
cbytes = 0;