if (token & 0x1) {
  // Run-length encoding
  int32_t run_value = -cbytes;  // Get the repeated value (two's complement)
  if (run_value < 0 || run_value > 255) {
    // Invalid run value
    return BLOSC2_ERROR_DATA;
  }
  memset(comp_buffer, (uint8_t)run_value, (unsigned int)neblock);
  nbytes = neblock;
  cbytes = 0;  // Reset compressed bytes for this stream
}