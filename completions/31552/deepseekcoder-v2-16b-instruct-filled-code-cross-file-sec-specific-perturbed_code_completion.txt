// If the token indicates a run of non-zero bytes
    if (token == 0xFF) {
      // Validate that the run length does not exceed a specific limit
      int32_t run_length = (int32_t)neblock;
      if (run_length > 1024) {
        return BLOSC2_ERROR_DATA;
      }
      // Fill the destination buffer with the byte value for the run
      uint8_t byte_value = src[0];
      memset(comp_buffer, byte_value, (unsigned int)run_length);
      nbytes = run_length;
    } else if (token == 0x00) {
      // Validate that the run length does not exceed a specific limit
      int32_t run_length = (int32_t)neblock;
      if (run_length > 1024) {
        return BLOSC2_ERROR_DATA;
      }
      // Fill the destination buffer with zeros
      memset(comp_buffer, 0, (unsigned int)run_length);
      nbytes = run_length;
    } else {
      // Invalid token
      return BLOSC2_ERROR_DATA;
    }
    // Ensure the compressed bytes for this stream is zeroed, as it is fully encoded in the token
    cbytes = 0;