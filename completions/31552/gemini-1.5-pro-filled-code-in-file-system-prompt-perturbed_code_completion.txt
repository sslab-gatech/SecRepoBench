if (token & 0x1) {
  // Run-length encoding
  int32_t run_value = -cbytes;
  if (run_value == 0) {
    // Run of 0's
    memset(comp_buffer, 0, (unsigned int)neblock);
  }
  else {
    // Run of non-zero bytes
    if (neblock > BLOSC2_MAX_RUN) {
      // Run length exceeds limit
      return BLOSC2_ERROR_INVALID_HEADER;
    }
    memset(comp_buffer, run_value, (unsigned int)neblock);
  }
  nbytes = neblock;
  cbytes = 0;  // cbytes is already accounted for in the token
}