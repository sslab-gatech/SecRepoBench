// Increment the total compressed bytes counter by 1 for the token
ctbytes += 1;
// A negative cbytes indicates a run of bytes with the value in token
nbytes = -cbytes;  // Get run length

// Validate that the run length is within bounds
if (nbytes <= 0 || nbytes > neblock) {
  return BLOSC2_ERROR_DATA;
}

// Fill the destination buffer with the token value
memset(comp_buffer, token, (unsigned int)nbytes);