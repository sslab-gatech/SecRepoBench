if (srcsize < (signed)sizeof(uint8_t)) {
  // Not enough input to read token
  return BLOSC2_ERROR_READ_BUFFER;
}
srcsize -= sizeof(uint8_t);

token = src[0];
src += 1;
ctbytes += 1;  // Increment the total compressed bytes counter by 1 for the token

if (token == 0) {
  // A run of non-zero bytes
  if (srcsize < (signed)sizeof(uint8_t)) {
    // Not enough input to read run value
    return BLOSC2_ERROR_READ_BUFFER;
  }
  uint8_t run_value = src[0];
  src += 1;
  ctbytes += 1;
  srcsize -= sizeof(uint8_t);

  if (neblock > INT32_MAX) {
    // Run length exceeds maximum allowed value
    return BLOSC2_ERROR_DATA;
  }

  memset(comp_buffer, run_value, (unsigned int)neblock);
  nbytes = neblock;
  cbytes = 0;  // Compressed bytes for this stream is zero
} else {
  // Invalid token
  return BLOSC2_ERROR_DATA;
}