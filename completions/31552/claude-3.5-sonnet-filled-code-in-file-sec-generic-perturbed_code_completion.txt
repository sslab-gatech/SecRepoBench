ctbytes += sizeof(uint8_t);

token = src[0];
src += 1;
// Increment the total compressed bytes counter by 1 for the token
ctbytes++;
// Check if the token indicates a run of non-zero bytes
if (token & 0x1) {
  // It's a run of non-zero bytes
  uint8_t value = token >> 1;
  if (value == 0) {
    // Special case: value of 0 means we need to read the actual value
    if (srcsize < sizeof(uint8_t)) {
      return BLOSC2_ERROR_READ_BUFFER;
    }
    value = src[0];
    src++;
    ctbytes++;
  }
  // Fill the destination buffer with the value
  memset(comp_buffer, value, neblock);
  nbytes = neblock;
  // Ensure the compressed bytes for this stream is zeroed
  cbytes = 0;
} else {
  // It's a run of zeros
  memset(comp_buffer, 0, neblock);
  nbytes = neblock;
  // Ensure the compressed bytes for this stream is zeroed
  cbytes = 0;
}