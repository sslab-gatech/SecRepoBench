int handle_runlen(blosc_header *header, uint8_t* src, uint8_t* dest, int32_t destsize) {
  bool doshuffle_flag = header->flags & BLOSC_DOSHUFFLE;
  bool dobitshuffle_flag = header->flags & BLOSC_DOBITSHUFFLE;
  int rc = 0;

  if (doshuffle_flag & dobitshuffle_flag) {
    int32_t runlen_type = (header->blosc2_flags >> 4) & BLOSC2_RUNLEN_MASK;
    if (runlen_type == BLOSC2_VALUE_RUNLEN) {
      // All repeated values
      rc = set_values(header, src, dest, destsize);
    }
    else if (runlen_type == BLOSC2_NAN_RUNLEN) {
      rc = set_nans(header, src, dest, destsize);
    }
    else if (runlen_type == BLOSC2_ZERO_RUNLEN) {
      memset(dest, 0, destsize);
      rc = header->nbytes;
    }
  }

  return rc;
}