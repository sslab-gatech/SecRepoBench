if (c->video_size < aligned_width * avctx->height * c->bpp / 8)
        return AVERROR_INVALIDDATA;

    if (!compressiontype && c->palette_size && c->bpp <= 8)
        avctx->pix_fmt = AV_PIX_FMT_PAL8;
    else if (compressiontype && (c->bpp == 6 || c->bpp == 8) &&
               c->palette_size == 768)
        avctx->pix_fmt = AV_PIX_FMT_BGR24;
    else if (!compressiontype && c->bpp == 24 && c->format == CHUNKY &&
             !c->palette_size)
        avctx->pix_fmt = AV_PIX_FMT_RGB24;
    else {
        avpriv_request_sample(avctx,
                              "Format %s with encoding %s, bpp %i, and palette %s",
                              c->format == BIT_PLANAR ? "BIT_PLANAR" :
                              c->format == BIT_LINE   ? "BIT_LINE"   :
                              c->format == CHUNKY     ? "CHUNKY"     : "UNKNOWN",
                              compressiontype ? "TRUE" : "FALSE",
                              c->bpp,
                              c->palette_size ? "TRUE" : "FALSE");
        return AVERROR_PATCHWELCOME;
    }