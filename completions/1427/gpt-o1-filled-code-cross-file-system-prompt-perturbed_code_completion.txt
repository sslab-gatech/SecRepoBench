// check that we have enough video data
    {
        int required_size = (aligned_width * avctx->height * c->bpp) >> 3;
        if (c->video_size < required_size) {
            av_log(avctx, AV_LOG_ERROR, "Insufficient video data: got %d, need %d\n",
                   c->video_size, required_size);
            return AVERROR_INVALIDDATA;
        }
    }

    // determine pixel format
    if (!compressiontype) {
        // unencoded
        if (c->palette_size && c->bpp <= 8) {
            avctx->pix_fmt = AV_PIX_FMT_PAL8;
        } else if (c->bpp == 24 && c->format == CHUNKY && c->palette_size == 0) {
            avctx->pix_fmt = AV_PIX_FMT_RGB24;
        } else {
            avpriv_request_sample(avctx, "Unsupported uncompressed format: bpp=%d, palette=%d, format=0x%x",
                                  c->bpp, c->palette_size, c->format);
            return AVERROR_PATCHWELCOME;
        }
    } else {
        // encoded
        if ((c->bpp == 6 || c->bpp == 8) && c->palette_size) {
            avctx->pix_fmt = AV_PIX_FMT_BGR24;
        } else {
            avpriv_request_sample(avctx, "Unsupported compressed format: bpp=%d, palette=%d, format=0x%x",
                                  c->bpp, c->palette_size, c->format);
            return AVERROR_PATCHWELCOME;
        }
    }