if (extent > MagickPathExtent)
                      {
                        char
                          *reallocated_xml;

                        reallocated_xml=(char *) ResizeQuantumMemory(xml_start,extent + 1,sizeof(*xml_start));
                        if (reallocated_xml == (char *) NULL)
                          ThrowFatalException(ResourceLimitFatalError,"MemoryAllocationFailed");
                        if (reallocated_xml != xml_start)
                        {
                           ssize_t diff = reallocated_xml - xml_start;
                           xml = xml + diff;
                           xml_start = reallocated_xml;
                           entity = entity + diff;
                        }

                      }
                    (void) CopyMagickMemory(xml+length,entity+1,strlen(entity)+1); // Ensure null-termination
                    (void) strncpy(xml,entities[i],length);