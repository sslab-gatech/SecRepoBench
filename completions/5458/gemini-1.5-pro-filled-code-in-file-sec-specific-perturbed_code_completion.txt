if (extent < (size_t) (offset + length + strlen(entity) + 1))
{
  char *new_xml = (char *) ResizeQuantumMemory(xml_start, extent,
    (size_t)(offset + length + strlen(entity) + 1));
  if (new_xml == (char *) NULL)
    ThrowFatalException(ResourceLimitFatalError, "MemoryAllocationFailed");

  if (xml_start != q)
    xml_start = DestroyString(xml_start);
  xml_start = new_xml;
  extent = (size_t)(offset + length + strlen(entity) + 1);
}
(void) CopyMagickMemory(xml_start + offset + length, entity + 1, strlen(entity) + 1);
(void) memcpy(xml_start + offset, entities[i], length);