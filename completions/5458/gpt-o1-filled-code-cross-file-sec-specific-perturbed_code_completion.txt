{
  char *resized_xml;

  /*
    Ensure there is enough space to accommodate the expanded content plus the
    null terminator. If not, resize the memory.
  */
  resized_xml = (char *) ResizeQuantumMemory(xml_start, extent+1, sizeof(*resized_xml));
  if (resized_xml == (char *) NULL)
    ThrowFatalException(ResourceLimitFatalError,"MemoryAllocationFailed");

  /* Update the base pointer and null-terminate the buffer. */
  xml_start = resized_xml;
  xml_start[extent] = '\0';

  /* Recompute current position after resize. */
  xml = xml_start + offset;
  entity = strchr(xml, ';');
}