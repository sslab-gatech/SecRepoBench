parsed_object = result.data;

/* Ensure the top-level object is an array of exactly two elements */
if (parsed_object.type != MSGPACK_OBJECT_ARRAY ||
    parsed_object.via.array.size != 2) {
    continue;
}

/* Unpack the timestamp from the first element */
flb_time_pop_from_msgpack(&tms, &result, &obj);

/* The second element must be a map */
map = *obj;
if (map.type != MSGPACK_OBJECT_MAP) {
    continue;
}

/* Determine the map size. Increment if we will add a date key. */
map_size = map.via.map.size;
if (date_key != NULL) {
    map_size++;
}

/* Pack the map header now that we know how many entries will be stored */
msgpack_pack_map(&tmp_pck, map_size);