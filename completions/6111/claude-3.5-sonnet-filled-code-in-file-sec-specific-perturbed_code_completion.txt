MagickBooleanType status;
char
  *density,
  *options;
const char
  *option;
GeometryInfo
  geometry_info;
MagickStatusType
  flags;
PointInfo
  resolution;
size_t
  columns,
  rows;
ssize_t
  i,
  x,
  y;

/*
  Open output image file.
*/
status=OpenBlob(image_info,image,WriteBinaryBlobMode,exception);
if (status == MagickFalse)
  return(status);

/*
  Determine page geometry from bounding box.
*/
(void) ParseAbsoluteGeometry(page_geometry,&media_info);
(void) ParseGravityGeometry(image,page_geometry,&page_info,exception);
(void) ParseAbsoluteGeometry(page_geometry,&geometry);

/*
  Scale image to size of Postscript page.
*/
(void) ParsePageGeometry(image,page_geometry,&geometry,exception);
columns=image->columns;
rows=image->rows;

/*
  Initialize PS page.
*/
(void) FormatLocaleString(buffer,MagickPathExtent,
  "%%%%Page:  1 %.20g\n",(double) page++);
(void) WriteBlobString(image,buffer);
(void) FormatLocaleString(buffer,MagickPathExtent,
  "%%%%PageBoundingBox: %.20g %.20g %.20g %.20g\n",
  geometry.x,geometry.y,geometry.x+geometry.width,geometry.y+geometry.height);
(void) WriteBlobString(image,buffer);
(void) WriteBlobString(image,"%%PageResources: font Times-Roman\n");
if (LocaleCompare(image_info->magick,"PS") != 0)
  (void) WriteBlobString(image,"userdict begin\n");
(void) WriteBlobString(image,"DisplayImage\n");

/*
  Output image data.
*/
(void) FormatLocaleString(buffer,MagickPathExtent,
  "%.20g %.20g\n%g %g\n%g\n",
  (double) geometry.x,(double) geometry.y,scale.x,scale.y,pointsize);
(void) WriteBlobString(image,buffer);