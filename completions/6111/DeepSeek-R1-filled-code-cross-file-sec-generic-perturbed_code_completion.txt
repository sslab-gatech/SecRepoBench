ImageInfo
    *read_info;

  int
    status;

  MagickBooleanType
    logging;

  ssize_t
    count;

  FILE
    *ps_file;

  assert(image_info != (ImageInfo *) NULL);
  assert(image_info->signature == MagickCoreSignature);
  if (image_info->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",
      image_info->filename);
  if (SetImageInfoBlob(image_info,~0UL,exception) == MagickFalse)
    return((Image *) NULL);
  if (image_info->blob.data != (unsigned char *) NULL)
    {
      (void) AcquireUniqueFilename(postscript_filename);
      (void) WriteBlobToFile(image_info,postscript_filename,exception);
    }
  else
    (void) CopyMagickString(postscript_filename,image_info->filename,
      MagickPathExtent);
  ps_file=fopen_utf8(postscript_filename,"r");
  if (ps_file != (FILE *) NULL)
    {
      char
        buffer[MagickPathExtent];

      while (fgets(buffer,MagickPathExtent,ps_file) != (char *) NULL)
      {
        if (strncmp(buffer,BoundingBox,strlen(BoundingBox)) == 0)
          {
            double
              x1,
              x2,
              y1,
              y2;

            (void) sscanf(buffer+strlen(BoundingBox),"%lf %lf %lf %lf",
              &x1,&y1,&x2,&y2);
            geometry_info.rho=x2-x1;
            geometry_info.sigma=y2-y1;
            break;
          }
      }
      (void) fclose(ps_file);
    }
  if (image_info->density != (char *) NULL)
    (void) ParseGeometry(image_info->density,&geometry_info);
  else
    {
      geometry_info.rho=72.0;
      geometry_info.sigma=72.0;
    }
  (void) FormatLocaleString(geometry,MagickPathExtent,"%.20gx%.20g",
    geometry_info.rho,geometry_info.sigma);
  delegate_info=GetDelegateInfo("ps:decode",(char *) NULL,exception);
  if (delegate_info == (const DelegateInfo *) NULL)
    {
      if (image_info->blob.data != (unsigned char *) NULL)
        (void) RelinquishUniqueFileResource(postscript_filename);
      return((Image *) NULL);
    }
  (void) AcquireUniqueFilename(filename);
  options=GetDelegateOptions(delegate_info,image_info);
  (void) FormatLocaleString(command,MagickPathExtent,"%s -dSAFER -sDEVICE=pngalpha -sOutputFile=\"%s\" \"%s\" %s",
    delegate_info->command,filename,postscript_filename,options);
  logging=LogMagickEvent(DelegateEvent,GetMagickModule(),"Delegate command: %s",command);
  if (logging != MagickFalse)
    (void) LogMagickEvent(DelegateEvent,GetMagickModule(),"Delegate command: %s",command);
  status=InvokeDelegate(&image_info->exception,delegate_info,command,message);
  if (status == MagickFalse)
    {
      if (image_info->blob.data != (unsigned char *) NULL)
        (void) RelinquishUniqueFileResource(postscript_filename);
      (void) RelinquishUniqueFileResource(filename);
      ThrowFileException(exception,DelegateError,"DelegateFailed",
        image_info->filename);
      return((Image *) NULL);
    }
  read_info=CloneImageInfo(image_info);
  (void) CopyMagickString(read_info->filename,filename,MagickPathExtent);
  postscript_image=ReadImages(read_info,exception);
  read_info=DestroyImageInfo(read_info);
  if (postscript_image == (Image *) NULL)
    {
      if (image_info->blob.data != (unsigned char *) NULL)
        (void) RelinquishUniqueFileResource(postscript_filename);
      (void) RelinquishUniqueFileResource(filename);
      return((Image *) NULL);
    }
  if (image_info->blob.data != (unsigned char *) NULL)
    (void) RelinquishUniqueFileResource(postscript_filename);
  (void) RelinquishUniqueFileResource(filename);