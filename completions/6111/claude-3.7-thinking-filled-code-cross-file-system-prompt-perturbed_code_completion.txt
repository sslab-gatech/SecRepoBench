char
    hex_digits[256];

MagickBooleanType
    status;

PointInfo
    delta;

RectangleInfo
    page_box;

SegmentInfo
    bounds;

register ssize_t
    i;

ssize_t
    count,
    scene;

unsigned long
    columns,
    rows;

/*
  Initialize image structure.
*/
image=AcquireImage(image_info,exception);
status=OpenBlob(image_info,image,ReadBinaryBlobMode,exception);
if (status == MagickFalse)
  {
    image=DestroyImageList(image);
    return((Image *) NULL);
  }

/*
  Initialize hex map for PostScript parsing.
*/
for (i=0; i < 256; i++)
  hex_digits[i]=(-1);
for (i=0; i < 10; i++)
  hex_digits['0'+i]=(char) i;
for (i=10; i < 16; i++)
  {
    hex_digits['A'+i-10]=(char) i;
    hex_digits['a'+i-10]=(char) i;
  }

/*
  Set page geometry.
*/
SetGeometry(image,&page_box);
(void) ResetMagickMemory(&bounds,0,sizeof(bounds));
(void) ResetMagickMemory(&delta,0,sizeof(delta));
columns=0;
rows=0;
count=0;
scene=0;

/*
  Set density based on resolution.
*/
density=AcquireString("");
if (image_info->density != (char *) NULL)
  {
    (void) CopyMagickString(density,image_info->density,MagickPathExtent);
    (void) ParseGeometry(image_info->density,&geometry_info);
  }

/*
  Create temporary files for Ghostscript processing.
*/
(void) AcquireUniqueFilename(postscript_filename);
(void) AcquireUniqueFilename(filename);

/*
  Setup for Ghostscript rendering.
*/
read_info=CloneImageInfo(image_info);
(void) CopyMagickString(read_info->filename,filename,MagickPathExtent);

/*
  Use Ghostscript to render the PostScript image.
*/
delegate_info=GetDelegateInfo("ps:alpha",(char *) NULL,exception);
if (delegate_info != (const DelegateInfo *) NULL)
  {
    options=AcquireString("");
    (void) FormatLocaleString(command,MagickPathExtent,
      GetDelegateCommands(delegate_info),density,read_info->filename,
      postscript_filename);
    status=SystemCommand(MagickFalse,image_info->verbose,command,exception);
    options=DestroyString(options);
  }

/*
  Read the rendered image.
*/
postscript_image=ReadImage(read_info,exception);
(void) RelinquishUniqueFileResource(postscript_filename);
(void) RelinquishUniqueFileResource(filename);
density=DestroyString(density);
read_info=DestroyImageInfo(read_info);
if (postscript_image == (Image *) NULL)
  {
    image=DestroyImageList(image);
    return((Image *) NULL);
  }