MagickBooleanType
    status;

  MagickStatusType
    flags;

  PointInfo
    resolution;

  register char
    *p;

  register ssize_t
    i;

  ssize_t
    count;

  size_t
    columns,
    height,
    length,
    rows,
    scene,
    width;

  unsigned char
    *pixels;

  unsigned int
    text_alpha_bits,
    graphic_alpha_bits;

  assert(image_info != (const ImageInfo *) NULL);
  assert(image_info->signature == MagickCoreSignature);
  assert(exception != (ExceptionInfo *) NULL);
  assert(exception->signature == MagickCoreSignature);
  if (image_info->debug != MagickFalse)
    (void) LogMagickEvent(TraceEvent,GetMagickModule(),"%s",
      image_info->filename);
  image=AcquireImage(image_info,exception);
  status=OpenBlob(image_info,image,ReadBinaryBlobMode,exception);
  if (status == MagickFalse)
    {
      image=DestroyImageList(image);
      return((Image *) NULL);
    }
  status=AcquireUniqueSymbolicLink(image_info->filename,input_filename);
  if (status == MagickFalse)
    {
      ThrowFileException(exception,FileOpenError,"UnableToCreateTemporaryFile",
        image_info->filename);
      image=DestroyImageList(image);
      return((Image *) NULL);
    }
  
  /* Initialize variables */
  (void) memset(command,0,sizeof(command));
  (void) memset(filename,0,sizeof(filename));
  (void) memset(geometry,0,sizeof(geometry));
  (void) memset(postscript_filename,0,sizeof(postscript_filename));
  
  /* Set density and other parameters */
  density=NULL;
  if (image_info->density != (char *) NULL)
    density=AcquireString(image_info->density);
  else
    density=AcquireString("72x72");
  
  /* Create temporary files and setup Ghostscript command */
  filedescriptor=AcquireUniqueFileResource(filename);
  if (filedescriptor == -1)
    {
      ThrowFileException(exception,FileOpenError,"UnableToCreateTemporaryFile",
        image_info->filename);
      if (density != (char *) NULL)
        density=DestroyString(density);
      image=DestroyImageList(image);
      return((Image *) NULL);
    }
  (void) close(filedescriptor);
  
  /* Setup Ghostscript and render PS image */
  read_info=CloneImageInfo(image_info);
  options=AcquireString("");
  
  /* Execute Ghostscript to convert PS to a readable format */
  status=InvokeDelegate(read_info,image,PostscriptDelegateTag,options,exception);
  options=DestroyString(options);
  
  if (status == MagickFalse)
    {
      (void) RelinquishUniqueFileResource(filename);
      read_info=DestroyImageInfo(read_info);
      if (density != (char *) NULL)
        density=DestroyString(density);
      image=DestroyImageList(image);
      return((Image *) NULL);
    }
  
  /* Read the output image created by Ghostscript */
  (void) CopyMagickString(read_info->filename,filename,MagickPathExtent);
  postscript_image=ReadImage(read_info,exception);
  read_info=DestroyImageInfo(read_info);
  if (density != (char *) NULL)
    density=DestroyString(density);
  (void) RelinquishUniqueFileResource(filename);
  
  if (postscript_image == (Image *) NULL)
    {
      image=DestroyImageList(image);
      return((Image *) NULL);
    }