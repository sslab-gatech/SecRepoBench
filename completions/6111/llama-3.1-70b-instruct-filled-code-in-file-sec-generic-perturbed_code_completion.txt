// Initialize necessary variables and structures for processing Postscript images.
// Open the input image file and create a symbolic link to it for processing.
// Initialize an array to map hex characters to their integer values.
// Set the page density for the image based on the provided resolution or default values.
// Determine the page geometry using the Postscript bounding box comments.
// Initialize various variables including color space, resolution, and page dimensions.
// Create a control file for Ghostscript to render the Postscript image.
// Use the Ghostscript delegate to render the Postscript into a raster format.
// Read the rendered images and append them to the image list, handling profiles if necessary.
// Clean up and return the processed image list, handling any errors that occur.

// Initialize necessary variables and structures for processing Postscript images.
int
  columns,
  rows,
  page,
  scene;

const char
  *density,
  *options;

const DelegateInfo
  *delegate_info;

GeometryInfo
  geometry_info;

Image
  *image,
  *next,
  *postscript_image;

ImageInfo
  *read_info;

short int
  hex_digits[256];

// Open the input image file and create a symbolic link to it for processing.
if ((image_info->file == (char *) NULL) || (*image_info->file == '\0'))
  {
    (void) ThrowMagickException(exception,GetMagickModule(),OptionError,
      "NoPostscriptFile","`%s'",image_info->filename);
    return((Image *) NULL);
  }
status=GetPathAttributes(image_info->file,&attributes);
if ((status == MagickFalse) || (S_ISREG(attributes.st_mode) == 0))
  {
    (void) ThrowMagickException(exception,GetMagickModule(),OptionError,
      "NoPostscriptFile","`%s'",image_info->filename);
    return((Image *) NULL);
  }
if (IsPostscriptRendered(image_info->file)!= MagickFalse)
  {
    (void) ThrowMagickException(exception,GetMagickModule(),OptionError,
      "NoPostscriptFile","`%s'",image_info->filename);
    return((Image *) NULL);
  }
(void) CopyMagickString(input_filename,image_info->file,MagickPathExtent);
(void) CopyMagickString(postscript_filename,input_filename,MagickPathExtent);
(void) ConcatenateMagickString(postscript_filename,".ps",MagickPathExtent);
(void) CreateTemporaryFile(&postscript_filename);
(void) CopyMagickString(filename,input_filename,MagickPathExtent);
(void) ConcatenateMagickString(filename,".tmp",MagickPathExtent);
(void) CreateTemporaryFile(&filename);
(void) CopyMagickString(command,"mklink ",MagickPathExtent);
(void) ConcatenateMagickString(command,filename,MagickPathExtent);
(void) ConcatenateMagickString(command," ",MagickPathExtent);
(void) ConcatenateMagickString(command,input_filename,MagickPathExtent);
(void) InvokePostscriptDelegate(MagickFalse,command,message,exception);
if (LocaleCompare(image_info->magick,"PS") == 0)
  {
    (void) CopyMagickString(command,"gswin64c -dBATCH -dNOPAUSE -sDEVICE=png16m ",
      MagickPathExtent);
    (void) ConcatenateMagickString(command,"-sOutputFile=",MagickPathExtent);
    (void) ConcatenateMagickString(command,filename,MagickPathExtent);
    (void) ConcatenateMagickString(command," ",MagickPathExtent);
    (void) ConcatenateMagickString(command,postscript_filename,MagickPathExtent);
  }
else
  {
    (void) CopyMagickString(command,"gswin64c -dBATCH -dNOPAUSE -sDEVICE=png16m ",
      MagickPathExtent);
    (void) ConcatenateMagickString(command,"-sOutputFile=",MagickPathExtent);
    (void) ConcatenateMagickString(command,filename,MagickPathExtent);
    (void) ConcatenateMagickString(command,"[",MagickPathExtent);
    (void) ConcatenateMagickString(command,postscript_filename,MagickPathExtent);
    (void) ConcatenateMagickString(command,"] ",MagickPathExtent);
  }
(void) ConcatenateMagickString(command,"-r",MagickPathExtent);
(void) ConcatenateMagickString(command,density,MagickPathExtent);
(void) ConcatenateMagickString(command," -dTextAlphaBits=4 -dGraphicsAlphaBits=4 ",
  MagickPathExtent);
(void) ConcatenateMagickString(command,"-dFirstPage=1 -dLastPage=1 ",MagickPathExtent);
(void) ConcatenateMagickString(command,options,MagickPathExtent);
(void) InvokePostscriptDelegate(MagickFalse,command,message,exception);
// Initialize an array to map hex characters to their integer values.
for (i=0; i < 256; i++)
  hex_digits[i]=0;
for (i=0; i < 16; i++)
  hex_digits[(int) ((char) ('0'+i))]=i;
for (i=0; i < 6; i++)
  hex_digits[(int) ((char) ('A'+i))]=i+10;
for (i=0; i < 6; i++)
  hex_digits[(int) ((char) ('a'+i))]=i+10;
// Set the page density for the image based on the provided resolution or default values.
density=image_info->density;
if (density == (const char *) NULL)
  density=PSDensityGeometry;
// Determine the page geometry using the Postscript bounding box comments.
columns=0;
rows=0;
page=1;
scene=0;
// Initialize various variables including color space, resolution, and page dimensions.
read_info=CloneImageInfo(image_info);
read_info->number_scenes=0;
read_info->adjoin=MagickTrue;
read_info->ping=MagickFalse;
read_info->verbose=MagickFalse;
read_info->file=filename;
// Create a control file for Ghostscript to render the Postscript image.
// Use the Ghostscript delegate to render the Postscript into a raster format.
status=InvokePostscriptDelegate(MagickFalse,command,message,exception);
if (status == MagickFalse)
  {
    (void) ThrowMagickException(exception,GetMagickModule(),DelegateError,
      "GhostscriptRenderingException","`%s'",command);
    return((Image *) NULL);
  }
// Read the rendered images and append them to the image list, handling profiles if necessary.
postscript_image=ReadImage(read_info,exception);
if (postscript_image == (Image *) NULL)
  {
    (void) ThrowMagickException(exception,GetMagickModule(),DelegateError,
      "GhostscriptRenderingException","`%s'",command);
    return((Image *) NULL);
  }
// Clean up and return the processed image list, handling any errors that occur.
(void) DeleteTemporaryFiles(filename);
(void) DeleteTemporaryFiles(postscript_filename);