short int
    hex_digits[256];

  size_t
    columns,
    rows;

  ssize_t
    i;

  /*
    Initialize hex digits.
  */
  for (i=0; i < 16; i++)
  {
    hex_digits['0'+i]=(short int) i;
    hex_digits['A'+i]=(short int) (i+10);
    hex_digits['a'+i]=(short int) (i+10);
  }
  /*
    Open the input image file.
  */
  filedescriptor=AcquireUniqueFileDescriptor(exception);
  if (filedescriptor == -1)
    ThrowWriterException(FileOpenError,"UnableToCreateTemporaryFile");
  (void) AcquireUniqueFilename(filename);
  (void) FormatLocaleString(command,MagickPathExtent,"ln -sf \"%s\" \"%s\"",
    image_info->filename,filename);
  (void) system(command);
  /*
    Initialize an array to map hex characters to their integer values.
  */
  (void) ResetMagickMemory(hex_digits,0,sizeof(hex_digits));
  for (i=0; i < 16; i++)
  {
    hex_digits['0'+i]=(short int) i;
    hex_digits['A'+i]=(short int) (i+10);
    hex_digits['a'+i]=(short int) (i+10);
  }
  /*
    Set the page density for the image based on the provided resolution or
    default values.
  */
  columns=0;
  rows=0;
  density=(char *) NULL;
  option=GetImageOption(image_info,"density");
  if (option != (const char *) NULL)
    density=AcquireString(option);
  if (density != (char *) NULL)
    {
      GeometryInfo
        geometry_info;

      MagickStatusType
        flags;

      flags=ParseGeometry(density,&geometry_info);
      columns=(size_t) geometry_info.rho;
      rows=(size_t) geometry_info.sigma;
      if ((flags & SigmaValue) == 0)
        rows=columns;
    }
  density=DestroyString(density);
  /*
    Determine the page geometry using the Postscript bounding box comments.
  */
  (void) CopyMagickString(geometry,PSPageGeometry,MagickPathExtent);
  (void) CopyMagickString(input_filename,filename,MagickPathExtent);
  (void) CopyMagickString(postscript_filename,filename,MagickPathExtent);
  (void) ConcatenateMagickString(postscript_filename,".ps",MagickPathExtent);
  (void) FormatLocaleString(command,MagickPathExtent,
    "gs -q -sDEVICE=nullpage -dNOPAUSE -dSAFER -dBATCH -sstdout=%s %s",
    postscript_filename,input_filename);
  (void) InvokePostscriptDelegate(MagickFalse,command,message,exception);
  if (IsPostscriptRendered(postscript_filename) == MagickFalse)
    {
      (void) RelinquishUniqueFileResource(filename);
      ThrowWriterException(CoderError,"PostscriptDelegateFailed");
    }
  /*
    Initialize various variables including color space, resolution, and page
    dimensions.
  */
  (void) CopyMagickString(input_filename,postscript_filename,MagickPathExtent);
  (void) CopyMagickString(postscript_filename,filename,MagickPathExtent);
  (void) ConcatenateMagickString(postscript_filename,".miff",MagickPathExtent);
  (void) FormatLocaleString(command,MagickPathExtent,
    "gs -q -sDEVICE=miff -dNOPAUSE -dSAFER -dBATCH -r%.20g -sOutputFile=%s %s",
    (double) (columns != 0 ? columns : DefaultResolution),
    postscript_filename,input_filename);
  (void) InvokePostscriptDelegate(MagickFalse,command,message,exception);
  if (IsPostscriptRendered(postscript_filename) == MagickFalse)
    {
      (void) RelinquishUniqueFileResource(filename);
      ThrowWriterException(CoderError,"PostscriptDelegateFailed");
    }
  /*
    Create a control file for Ghostscript to render the Postscript image.
  */
  options=AcquireString("");
  if (image_info->size != (char *) NULL)
    {
      (void) ConcatenateMagickString(options,"-g",MagickPathExtent);
      (void) ConcatenateMagickString(options,image_info->size,MagickPathExtent);
    }
  read_info=CloneImageInfo(image_info);
  read_info->filename=postscript_filename;
  read_info->size=DestroyString(read_info->size);
  read_info->quality=DestroyString(read_info->quality);
  read_info->type=UndefinedType;
  read_info->ping=MagickFalse;
  /*
    Use the Ghostscript delegate to render the Postscript into a raster format.
  */
  image=ReadImage(read_info,exception);
  read_info=DestroyImageInfo(read_info);
  options=DestroyString(options);
  if (image == (Image *) NULL)
    {
      (void) RelinquishUniqueFileResource(filename);
      ThrowWriterException(CoderError,"PostscriptDelegateFailed");
    }
  (void) DeleteFile(input_filename);
  (void) RelinquishUniqueFileResource(filename);
  /*
    Read the rendered images and append them to the image list, handling
    profiles if necessary.
  */
  postscript_image=NewImageList();
  for (next=GetFirstImageInList(image); next != (Image *) NULL; )
  {
    postscript_image=AppendImageToList(postscript_image,CloneImage(next,0,0,
      MagickTrue,exception));
    if (postscript_image == (Image *) NULL)
      ThrowWriterException(ResourceLimitError,"MemoryAllocationFailed");
    next=GetNextImageInList(next);
  }
  /*
    Clean up and return the processed image list, handling any errors that
    occur.
  */
  if (postscript_image == (Image *) NULL)
    ThrowWriterException(ResourceLimitError,"MemoryAllocationFailed");