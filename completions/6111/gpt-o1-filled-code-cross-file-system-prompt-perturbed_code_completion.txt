{
  MagickBooleanType
    status;

  FILE
    *file;

  /* Create a symbolic link or copy the input file for Ghostscript processing. */
  status=AcquireUniqueFilename(input_filename);
  if (status == MagickFalse)
    ThrowReaderException(FileOpenError,"UnableToCreateTemporaryFile");
#if defined(MAGICKCORE_HAVE_SYMLINK)
  if (symlink(image->filename,input_filename) != 0)
    (void) CopyMagickString(input_filename,image->filename,MagickPathExtent);
#else
  (void) CopyMagickString(input_filename,image->filename,MagickPathExtent);
#endif

  /* Initialize an array to map hex characters to their integer values. */
  {
    static const char
      *hex_digits="0123456789ABCDEF",
      *hex_digits_lower="0123456789abcdef";

    for (c=0; c < 256; c++)
      hex_table[c] = -1;
    for (c=0; c < 16; c++)
    {
      hex_table[(int) hex_digits[c]] = c;
      hex_table[(int) hex_digits_lower[c]] = c;
    }
  }

  /* Set the page density for the Postscript image. */
  density=GetImageOption(image_info,"density");
  if (density == (const char *) NULL)
    (void) FormatLocaleString(geometry,MagickPathExtent,"%gx%g",72.0,72.0);
  else
    (void) FormatLocaleString(geometry,MagickPathExtent,"%s",density);

  /* Create a temporary file for Ghostscript to render the PS image. */
  status=AcquireUniqueFilename(postscript_filename);
  if (status == MagickFalse)
    ThrowReaderException(FileOpenError,"UnableToCreateTemporaryFile");
  filedescriptor=open(postscript_filename,O_WRONLY | O_CREAT | O_EXCL,S_MODE);
  if (filedescriptor == -1)
    ThrowReaderException(FileOpenError,"UnableToCreateTemporaryFile");
  file=fdopen(filedescriptor,"wb");
  if (file == (FILE *) NULL)
    {
      (void) close(filedescriptor);
      ThrowReaderException(FileOpenError,"UnableToCreateTemporaryFile");
    }

  /* Write minimal Postscript or control data (e.g. bounding box) if needed. */
  (void) FormatLocaleString(command,MagickPathExtent,
    "%%!PS-Adobe-3.0\n%%%%BoundingBox: 0 0 %.20g %.20g\n",
    (double) columns,(double) rows);
  (void) fputs(command,file);

  (void) fclose(file);

  /* Use the Ghostscript delegate to rasterize the Postscript file. */
  read_info=CloneImageInfo(image_info);
  (void) CopyMagickString(read_info->filename,postscript_filename,MagickPathExtent);
  postscript_image=ReadImages(read_info,postscript_filename,exception);
  read_info=DestroyImageInfo(read_info);
  if (postscript_image == (Image *) NULL)
    ThrowReaderException(DelegateError,"UnableToRenderPostscript");
}