if (fmt == 'g') {
    if (prec > e) {
      prec = e;
    }
    num_digits = prec;
  }