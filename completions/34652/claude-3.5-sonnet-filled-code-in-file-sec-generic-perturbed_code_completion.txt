if (fmt == 'g') {
  num_digits = prec;
  if (e < prec) {
    num_digits += e;
  }
}
if (num_digits > buf_remaining - FLT_MIN_BUF_SIZE) {
  num_digits = buf_remaining - FLT_MIN_BUF_SIZE;
}