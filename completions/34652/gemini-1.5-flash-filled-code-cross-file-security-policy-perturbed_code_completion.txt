if (fmt == 'g') {
        prec += (e - 1);
      }
      if (prec > buf_remaining) {
        prec = buf_remaining;
      }
      if (prec < 0) {
        prec = 0;
      }