if (originalformat == 'g') {
        prec += (e - 1);
      }
      if (prec > buf_remaining - (s - buf) - 1) {
        prec = buf_remaining - (s - buf) - 1;
      }