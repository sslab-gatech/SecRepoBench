if (fmt == 'g') {
        num_digits += (e - 1);
        if (num_digits < 0) {
          num_digits = 0;
        }
        if (num_digits > prec) {
          num_digits = prec;
        }
      }