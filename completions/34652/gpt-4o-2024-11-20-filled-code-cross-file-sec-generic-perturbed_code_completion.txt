if (originalformat == 'g') {
        if (e < -4 || e >= prec) {
          // Switch to scientific notation
          fmt = 'e';
          prec -= 1; // Adjust precision for scientific notation
        } else {
          // Use fixed-point notation
          fmt = 'f';
          prec -= (e + 1); // Adjust precision for fixed-point notation
        }
      }
      if (fmt == 'f') {
        num_digits = prec + 1;
        if (num_digits || alt_form) {
          *s++ = '.';
          while (--e > 0 && num_digits > 0) {
            *s++ = '0';
            num_digits--;
          }
        }
      }