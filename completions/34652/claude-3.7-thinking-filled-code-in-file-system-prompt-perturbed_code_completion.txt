if (originalformat == 'g') {
  // For 'g' format, adjust precision based on exponent
  prec += (e - 1);
}
// Ensure we don't exceed buffer capacity
if (prec > (buf_remaining - FLT_MIN_BUF_SIZE)) {
  prec = buf_remaining - FLT_MIN_BUF_SIZE;
  if (prec < 0) prec = 0;
}