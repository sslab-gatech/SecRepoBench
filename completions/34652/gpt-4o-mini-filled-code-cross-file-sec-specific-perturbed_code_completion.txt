if (fmt == 'g') {
        if (e < 0) {
          prec += e - 1; // Adjust precision for negative exponent
        } else if (e > prec) {
          prec = 0; // If exponent is greater than precision, set precision to 0
        }
      }
      if (prec > buf_remaining - 1) {
        prec = buf_remaining - 1; // Ensure precision does not exceed buffer size
      }