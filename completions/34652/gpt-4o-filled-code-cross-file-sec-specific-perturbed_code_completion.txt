if (prec > (buf_remaining - 2)) {
        prec = buf_remaining - 2;
      }