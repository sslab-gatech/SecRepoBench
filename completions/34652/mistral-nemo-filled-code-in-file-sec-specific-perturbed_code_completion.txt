if (fmt == 'g') {
  if (prec > (buf_remaining - e - 1)) {
    prec = buf_remaining - e - 1;
  }
}