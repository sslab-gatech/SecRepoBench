if (originalformat == 'g') {
        prec += e - 1;
      }
      if (prec > buf_remaining - 2) {
        prec = buf_remaining - 2;
      }