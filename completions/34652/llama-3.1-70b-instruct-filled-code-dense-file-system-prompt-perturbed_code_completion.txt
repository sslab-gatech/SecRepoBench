if (originalformat == 'g') {
  if (e > 4) {
    num_digits += (e - 1);
  }
} else {
  num_digits += e;
}