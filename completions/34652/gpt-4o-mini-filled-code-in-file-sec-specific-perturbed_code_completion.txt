if (num_digits + dec > buf_remaining) {
        num_digits = buf_remaining - dec;
      }