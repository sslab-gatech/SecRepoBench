if (originalformat == 'g') {
  prec += (e - 1);
}
if (prec < 0) {
  prec = 0;
}
if (prec > (buf_remaining - FLT_MIN_BUF_SIZE)) {
  prec = buf_remaining - FLT_MIN_BUF_SIZE;
}