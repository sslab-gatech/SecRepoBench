if (originalformat == 'g') {
  /* if exponent is bigger than 1, increase precision by (e - 1) */
  if (e > 1) {
    prec += (e - 1);
  }
}
/* limit precision if necessary to prevent buffer overflow */
if (prec > (buf_remaining - FLT_MIN_BUF_SIZE)) {
  prec = buf_remaining - FLT_MIN_BUF_SIZE;
  /* in 'g' format, add one more digit to accommodate rounding */
  if (originalformat == 'g') {
    prec++;
  }
}