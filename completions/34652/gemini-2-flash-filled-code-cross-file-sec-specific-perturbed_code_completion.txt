if (fmt == 'g') {
        if (e > 0) {
          prec += (e - 1);
        }
        if (prec > (buf_remaining - FLT_MIN_BUF_SIZE)) {
          prec = buf_remaining - FLT_MIN_BUF_SIZE;
        }
      }
      if (prec < 0) {
        prec = 0;
      }