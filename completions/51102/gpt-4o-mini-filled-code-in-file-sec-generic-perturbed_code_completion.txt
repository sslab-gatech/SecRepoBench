if (utf8) {
    ckeyl = u8_u16(ckey_utf, ckey.c_str());
    ctryl = u8_u16(ctry_utf, try_chars.c_str());
    if (ckeyl == -1 || ctryl == -1) {
      return; // Handle conversion error
    }
    ckey_utf.resize(ckeyl);
    ctry_utf.resize(ctryl);
  } else {
    ckeyl = ckey.length();
    ctryl = try_chars.length();
    ckey = ckey; // No conversion needed
    ctry = try_chars; // No conversion needed
  }