if (utf8) {
  std::vector<w_char> wtry;
  u8_u16(wtry, try_chars);
  ctry = u16_ustr(wtry);
  ctryl = static_cast<int>(wtry.size());
} else {
  ctry = try_chars;
  ctryl = static_cast<int>(strlen(try_chars));
}

if (utf8 && pAMgr) {
  std::vector<w_char> wckey;
  u8_u16(wckey, ckey);
  ckeyl = static_cast<int>(wckey.size());
} else {
  ckeyl = static_cast<int>(strlen(ckey));
}