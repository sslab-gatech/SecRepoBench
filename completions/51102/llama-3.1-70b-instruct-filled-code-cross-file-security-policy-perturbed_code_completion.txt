if (utf8) {
  std::vector<w_char> ckeyu;
  std::vector<w_char> ctryu;
  if (u8_u16(ckeyu, ckey) < 0 || u8_u16(ctryu, try_chars) < 0) {
    // handle error: conversion failed or buffer overflow
    // for example:
    throw std::runtime_error("UTF-8 to UTF-16 conversion failed");
  }
  ckeyl = ckeyu.size();
  ctryl = ctryu.size();
  ctry = try_chars;
} else {
  ckeyl = ckey.size();
  ctryl = try_chars.size();
  ctry = try_chars;
}