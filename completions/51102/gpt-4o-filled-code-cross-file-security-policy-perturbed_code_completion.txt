if (utf8) {
    std::vector<w_char> ckey_utf16, ctry_utf16;
    if (u8_u16(ckey_utf16, ckey) == -1 || u8_u16(ctry_utf16, try_chars) == -1) {
      // Handle error: conversion failed or exceeded buffer size
      ckeyl = 0;
      ctryl = 0;
      ctry.clear();
    } else {
      ckeyl = ckey_utf16.size();
      ctryl = ctry_utf16.size();
      ctry = try_chars;
    }
  } else {
    ckeyl = ckey.size();
    ctryl = try_chars.size();
    ctry = try_chars;
  }