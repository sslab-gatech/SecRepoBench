if (utf8) {
    std::vector<w_char> u16_key;
    std::vector<w_char> u16_try;
    // Convert the key string from UTF-8 to UTF-16 and set its length.
    u8_u16(u16_key, ckey);
    ckeyl = u16_key.size();
    // Convert the try_chars string from UTF-8 to UTF-16 and set its length.
    u8_u16(u16_try, try_chars);
    ctryl = u16_try.size();
} else {
    // In non UTF-8 mode, treat the strings as single-byte and use their lengths directly.
    ckeyl = ckey.size();
    ctryl = try_chars.size();
}
ctry = try_chars;