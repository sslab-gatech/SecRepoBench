if (utf8) {
    // Convert ckey to UTF-16 and calculate its length
    std::vector<w_char> utf16_ckey;
    u8_u16(utf16_ckey, ckey);
    ckeyl = utf16_ckey.size();

    // Convert try_chars to UTF-16 and calculate its length
    std::vector<w_char> utf16_ctry;
    u8_u16(utf16_ctry, try_chars);
    ctryl = utf16_ctry.size();

    // Assign the UTF-8 string to ctry
    ctry = try_chars;
  } else {
    // In non-UTF-8 mode, directly assign lengths and string
    ckeyl = ckey.size();
    ctryl = try_chars.size();
    ctry = try_chars;
  }