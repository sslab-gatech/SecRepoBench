if (utf8) {
    std::vector<w_char> wckey;
    std::vector<w_char> wctry;
    int ret = u8_u16(wckey, ckey);
    if (ret == -1) {
      // Handle error: Conversion failed or exceeded buffer size.
      ckeyl = 0;
    } else {
      ckeyl = wckey.size();
    }
    ret = u8_u16(wctry, try_chars);
    if (ret == -1) {
      // Handle error: Conversion failed or exceeded buffer size.
      ctryl = 0;
    } else {
      ctryl = wctry.size();
    }
    ctry.assign(try_chars);
  } else {
    ckeyl = ckey.length();
    ctryl = try_chars.length();
    ctry.assign(try_chars);
  }