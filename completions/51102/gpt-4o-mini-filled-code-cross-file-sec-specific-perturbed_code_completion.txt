// Convert ckey to UTF-16
  ckeyl = utf8 ? u8_u16(ckey, ckeyl) : ckey.length();
  
  // Convert try_chars to UTF-16
  ctryl = utf8 ? u8_u16(try_chars, ctryl) : try_chars.length();
  
  // Ensure that ckey and ctry are properly sized and allocated
  ckey.resize(ckeyl);
  ctry.resize(ctryl);