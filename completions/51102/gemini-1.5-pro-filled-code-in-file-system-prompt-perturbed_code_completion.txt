if (utf8) {
    ckeyl = u8_u16(ckey_utf, ckey.c_str());
    ctryl = u8_u16(ctry_utf, try_chars.c_str());
    if (ckeyl == -1 || ctryl == -1) {
      // Handle conversion errors if necessary
      ckeyl = 0;
      ctryl = 0;
    }
    u16_u8(ctry, ctry_utf);
  } else {
    ckeyl = ckey.size();
    ctryl = try_chars.size();
    ctry = try_chars;
  }