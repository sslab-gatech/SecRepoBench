if (utf8) {
    // Convert ckey to UTF-16
    std::vector<w_char> ckey_utf16;
    if (!ckey.empty()) {
      u8_u16(ckey_utf16, ckey.c_str());
      ckeyl = ckey_utf16.size();
    }

    // Convert try_chars to UTF-16
    std::vector<w_char> ctry_utf16;
    if (!try_chars.empty()) {
      u8_u16(ctry_utf16, try_chars.c_str());
      ctryl = ctry_utf16.size();
    }

    // Assign the UTF-16 converted try_chars to ctry
    ctry = try_chars;
  } else {
    // If not UTF-8, just assign the lengths and the string directly
    ckeyl = ckey.size();
    ctryl = try_chars.size();
    ctry = try_chars;
  }