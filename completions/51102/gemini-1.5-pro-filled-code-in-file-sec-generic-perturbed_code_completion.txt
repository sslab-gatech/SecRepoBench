if (utf8) {
    ckeyl = u8_u16(ckey_utf, ckey.c_str());
    if (ckeyl == -1) {
      // Handle the error appropriately, e.g., by throwing an exception or returning an error code.
      throw std::runtime_error("Invalid UTF-8 sequence in ckey.");
    }
    ctryl = u8_u16(ctry_utf, try_chars.c_str());
    if (ctryl == -1) {
      throw std::runtime_error("Invalid UTF-8 sequence in try_chars.");
    }
    ctry = try_chars; // UTF-8 input is stored.
  } else {
    ckeyl = ckey.size();
    ctry = try_chars;
    ctryl = ctry.size();
  }