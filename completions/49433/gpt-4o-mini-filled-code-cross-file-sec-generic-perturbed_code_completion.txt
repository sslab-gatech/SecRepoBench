Icc->TagOffsets = (cmsUInt32Number*) malloc(TagCount * sizeof(cmsUInt32Number));
    Icc->TagSizes = (cmsUInt32Number*) malloc(TagCount * sizeof(cmsUInt32Number));
    Icc->TagLinked = (cmsTagSignature*) malloc(TagCount * sizeof(cmsTagSignature));
    
    if (Icc->TagOffsets == NULL || Icc->TagSizes == NULL || Icc->TagLinked == NULL) {
        cmsSignalError(Icc->ContextID, cmsERROR_MEMORY, "Memory allocation failed for tag arrays");
        return FALSE;
    }

    for (j = 0; j < TagCount; j++) {
        cmsTagEntry TagEntry;

        if (!_cmsReadTagEntry(io, &TagEntry)) {
            free(Icc->TagOffsets);
            free(Icc->TagSizes);
            free(Icc->TagLinked);
            return FALSE;
        }

        // Validate offset and size
        if (TagEntry.offset + TagEntry.size > HeaderSize) {
            cmsSignalError(Icc->ContextID, cmsERROR_RANGE, "Invalid tag offset/size");
            free(Icc->TagOffsets);
            free(Icc->TagSizes);
            free(Icc->TagLinked);
            return FALSE;
        }

        Icc->TagOffsets[j] = TagEntry.offset;
        Icc->TagSizes[j] = TagEntry.size;
        Icc->TagLinked[j] = TagEntry.linkedSignature; // Assuming linkedSignature is part of TagEntry
        Icc->TagCount++;
    }