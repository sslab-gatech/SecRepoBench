char buf[256]; // Buffer to hold the cleaned string
const char *p = s; // Pointer to iterate over the input string
const char *pend = s + len; // Pointer to the end of the input string
char *n = buf; // Pointer to the current position in the buffer

// Step 1: Trim leading whitespace
while (p < pend && ISSPACE(*p)) p++;

// Step 2: Check for hexadecimal prefixes
if (p + 1 < pend && (*p == '0') && (*(p + 1) == 'x' || *(p + 1) == 'X')) {
    p += 2; // Skip the prefix
}

// Step 3: Prepare the buffer and iterate over the string
while (p < pend && (isdigit(*p) || *p == '.' || *p == '-' || *p == '+' || *p == '_')) {
    if (*p != '_') { // Skip underscores
        if (n < buf + sizeof(buf) - 1) { // Ensure we don't overflow the buffer
            *n++ = *p; // Copy valid characters to the buffer
        } else {
            if (badcheck) goto bad; // Buffer overflow detected
        }
    }
    p++;
}

// Step 5: Null-terminate the buffer
*n = '\0';