const char *p = s;
  const char *pend = s + len;
  char buf[256]; // Assuming a reasonable buffer size for the input string
  char *n = buf;

  // 1. Trim leading whitespace
  while (p < pend && ISSPACE(*p)) p++;

  // 2. Check for hexadecimal prefix
  if (p + 1 < pend && *p == '0' && (*(p + 1) == 'x' || *(p + 1) == 'X')) {
    p += 2;
  }

  // 3. Prepare buffer and 4. Iterate over the string
  while (p < pend) {
    if (*p == '_') {
      p++;
      continue;
    }
    if (n - buf >= sizeof(buf) - 1) {
      // Buffer overflow protection
      if (badcheck) goto bad;
      break;
    }
    *n++ = *p++;
  }