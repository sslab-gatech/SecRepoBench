char buf[256];  // Buffer to store the cleaned input
  char *n = buf;
  const char *pend = s + len;
  const char *p = s;

  // Skip leading whitespace
  while (p < pend && ISSPACE(*p)) p++;

  // Check for hexadecimal prefix
  if (p + 1 < pend && p[0] == '0' && (p[1] == 'x' || p[1] == 'X')) {
    p += 2;
    goto nocopy;
  }

  // Copy valid characters to buffer, removing underscores
  while (p < pend) {
    if (*p == '_') {
      p++;
      continue;
    }
    if (badcheck && *p == '\0') {
      goto nullbyte;
    }
    *n++ = *p++;
  }