mrb_int)(p2 - RSTR_PTR(p_str)));
  return mrb_obj_value(p_str);
}

MRB_API mrb_value
mrb_str_format(mrb_state *mrb, mrb_value str, mrb_value fmt)
{
  mrb_value *argv;
  mrb_int argc;
  mrb_value result = mrb_str_new_lit(mrb, "");
  mrb_value tmp;

  mrb_get_args(mrb, "*", &argv, &argc);
  if (argc > 0) {
    mrb_value str2 = mrb_str_to_str(mrb, str);
    mrb_value fmt2 = mrb_str_to_str(mrb, fmt);
    mrb_value ary = mrb_ary_new_from_values(mrb, argc, argv);
    tmp = mrb_format(mrb, str2, fmt2, ary);
    mrb_str_cat(mrb, result, RSTRING_PTR(tmp), RSTRING_LEN(tmp));
  }
  return result;
}

MRB_API mrb_value
mrb_str_formatv(mrb_state *mrb, mrb_value str, mrb_value fmt, mrb_value ap)
{
  mrb_value result = mrb_str_new_lit(mrb, "");
  mrb_value tmp;

  tmp = mrb_formatv(mrb, str, fmt, ap);
  mrb_str_cat(mrb, result, RSTRING_PTR(tmp), RSTRING_LEN(tmp));
  return result;
}

MRB_API mrb_value
mrb_str_cat(mrb_state *mrb, mrb_value str, const char *ptr, mrb_int len)
{
  struct RString *s = mrb_str_ptr(str);
  mrb_int slen = RSTR_LEN(s);

  mrb_str_modify(mrb, s);
  if (len == 0) return str;
  if (slen + len > MRB_SSIZE_MAX) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "string size too big");
  }
  if (slen + len > RSTR_CAPA(s)) {
    resize_capa(mrb, s, s->as.heap.aux.capa + len);
  }
  memcpy(RSTR_PTR(s) + s->as.heap.len, ptr, len);
  RSTR_SET_LEN(s, s->as.heap.len + len);
  RSTR_PTR(s)[RSTR_LEN(s)] = '\0';
  return str;
}

MRB_API mrb_value
mrb_str_cat_cstr(mrb_state *mrb, mrb_value str, const char *ptr)
{
  return mrb_str_cat(mrb, str, ptr, strlen(ptr));
}

MRB_API mrb_value
mrb_str_cat_str(mrb_state *mrb, mrb_value str, mrb_value append)
{
  struct RString *s = mrb_str_ptr(str);
  struct RString *append_str = mrb_str_ptr(append);

  mrb_str_modify(mrb, s);
  if (RSTR_LEN(append_str) == 0) return str;
  if (RSTR_LEN(s) + RSTRING_LEN(append) > MRB_SSIZE_MAX) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "string size too big");
  }
  if (RSTR_LEN(s) + RSTRING_LEN(append) > RSTR_CAPA(s)) {
    resize_capa(mrb, s, s->as.heap.aux.capa + RSTRING_LEN(append));
  }
  memcpy(RSTR_PTR(s) + RSTR_LEN(s), RSTRING_PTR(append), RSTRING_LEN(append));
  RSTR_SET_LEN(s, RSTR_LEN(s) + RSTRING_LEN(append));
  RSTR_PTR(s)[RSTR_LEN(s)] = '\0';
  return str;
}

MRB_API mrb_value
mrb_str_cat_lit(mrb_state *mrb, mrb_value str, const char *ptr)
{
  return mrb_str_cat(mrb, str, ptr, (mrb_int)strlen(ptr));
}

MRB_API mrb_value
mrb_str_cat_lit_str(mrb_state *mrb, mrb_value str, mrb_value append)
{
  struct RString *s = mrb_str_ptr(str);
  struct RString *append_str = mrb_str_ptr(append);

  mrb_str_modify(mrb, s);
  if (RSTR_LEN(append_str) == 0) return str;
  if (RSTR_LEN(s) + RSTRING_LEN(append) > MRB_SSIZE_MAX) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "string size too big");
  }
  if (RSTR_LEN(s) + RSTRING_LEN(append) > RSTR_CAPA(s)) {
    resize_capa(mrb, s, s->as.heap.aux.capa + RSTRING_LEN(append));
  }
  memcpy(RSTR_PTR(s) + RSTR_LEN(s), RSTRING_PTR(append), RSTRING_LEN(2));
  RSTR_SET_LEN(s, RSTR_LEN(s) + RSTRING_LEN(append));
  RSTR_PTR(s)[RSTR_LEN(s)] = '\0';
  return str;
}

MRB_API mrb_value
mrb_str_plus(mrb_state *mrb, mrb_value str1, mrb_value str2)
{
  return mrb_str_plus(mrb, str1, str2);
}

MRB_API mrb_value
mrb_str_times(mrb_state *mrb, mrb_value str, mrb_int times)
{
  return mrb_str_times(mrb, str, times);
}

MRB_API mrb_value
mrb_str_resize(mrb_state *mrb, mrb_value str, mrb_int len)
{
  return mrb_str_resize(mrb, str, len);
}

MRB_API mrb_value
mrb_str_substr(mrb_state *mrb, mrb_value str, mrb_int beg, mrb_int len)
{
  return str_substr(mrb, str, beg, len);
}

MRB_API mrb_value
mrb_str_aref(mrb_state *mrb, mrb_value str, mrb_value indx, mrb_value alen)
{
  return mrb_str_aref(mrb, str, indx, alen);
}

MRB_API mrb_value
mrb_str_aset(mrb_state *mrb, mrb_value str, mrb_value indx, mrb_value alen, mrb_value replace)
{
  mrb_str_aset(mrb, str, indx, alen, replace);
  return str;
}

MRB_API mrb_value
mrb_str_capitalize_bang(mrb_state *mrb, mrb_value str)
{
  return mrb_str_capitalize_bang(mrb, str);
}

MRB_API mrb_value
mrb_str_capitalize(mrb_state *mrb, mrb_value str)
{
  return mrb_str_capitalize(mrb, str);
}

MRB_API mrb_value
mrb_str_chomp_bang(mrb_state *mrb, mrb_value str)
{
  return mrb_str_chomp_bang(mrb, str);
}

MRB_API mrb_value
mrb_str_chomp(mrb_state *mrb, mrb_value str)
{
  return mrb_str_chomp(mrb, str);
}

MRB_API mrb_value
mrb_str_chop_bang(mrb_state *mrb, mrb_value str)
{
  return mrb_str_chop_bang(mrb, str);
}

MRB_API mrb_value
mrb_str_chop(mrb_state *mrb, mrb_value str)
{
  return mrb_str_chop(mrb, str);
}

MRB_API mrb_value
mrb_str_downcase_bang(mrb_state *mrb, mrb_value str)
{
  return mrb_str_downcase_bang(mrb, str);
}

MRB_API mrb_value
mrb_str_downcase(mrb_state *mrb, mrb_value str)
{
  return mrb_str_downcase(mrb, str);
}

MRB_API mrb_value
mrb_str_empty_p(mrb_state *mrb, mrb_value str)
{
  return mrb_str_empty_p(mrb, str);
}

MRB_API mrb_value
mrb_str_eql(mrb_state *mrb, mrb_value str)
{
  return mrb_str_eql(mrb, str);
}

MRB_API mrb_value
mrb_str_hash_m(mrb_state *mrb, mrb_value str)
{
  return mrb_str_hash_m(mrb, str);
}

MRB_API mrb_value
mrb_str_include(mrb_state *mrb, mrb_value str)
{
  return mrb_str_include(mrb, str);
}

MRB_API mrb_value
mrb_str_index_m(mrb_state *mrb, mrb_value str)
{
  return mrb_str_index_m(mrb, str);
}

MRB_API mrb_value
mrb_str_replace(mrb_state *mrb, mrb_value str)
{
  return mrb_str_replace(mrb, str);
}

MRB_API mrb_value
mrb_str_init(mrb_state *mrb, mrb_value str)
{
  return mrb_str_init(mrb, str);
}

MRB_API mrb_value
mrb_str_intern(mrb_state *mrb, mrb_value str)
{
  return mrb_str_intern(mrb, str);
}

MRB_API mrb_value
mrb_obj_as_string(mrb_state *mrb, mrb_value obj)
{
  return mrb_obj_as_string(mrb, obj);
}

MRB_API mrb_value
mrb_ptr_to_str(mrb_state *mrb, void *p)
{
  return mrb_ptr_to_str(mrb, p);
}

MRB_API mrb_value
mrb_str_format(mrb_state *mrb, mrb_value str, mrb_value fmt)
{
  return mrb_str_format(mrb, str, fmt);
}

MRB_API mrb_value
mrb_str_formatv(mrb_state *mrb, mrb_value str, mrb_value fmt, mrb_value ap)
{
  return mrb_str_formatv(mrb, str, fmt, ap);
}

MRB_API mrb_value
mrb_str_cat(mrb_state *mrb, mrb_value str, const char *ptr, mrb_int len)
{
  return mrb_str_cat(mrb, str, ptr, len);
}

MRB_API mrb_value
mrb_str_cat_cstr(mrb_state *mrb, mrb_value str, const char *ptr)
{
  return mrb_str_cat_cstr(mrb, str, ptr);
}

MRB_API mrb_value
mrb_str_cat_str(mrb_state *mrb, mrb_value str, mrb_value append)
{
  return mrb_str_cat_str(mrb, str, append);
}

MRB_API mrb_value
mrb_str_cat_lit(mrb_state *mrb, mrb_value str, const char *ptr)
{
  return mrb_str_cat_lit(mrb, str, ptr);
}

MRB_API mrb_value
mrb_str_cat_lit_str(mrb_state *mrb, mrb_value str, mrb_value append)
{
  return mrb_str_cat_lit_str(mrb, str, append);
}

MRB_API mrb_value
mrb_str_plus(mrb_state *mrb, mrb_value str1, mrb_value str2)
{
  return mrb_str_plus(mrb, str1, str2);
}

MRB_API mrb_value
mrb_str_times(mrb_state *mrb, mrb_value str, mrb_int times)
{
  return mrb_str_times(mrb, str, times);
}

MRB_API mrb_value
mrb_str_resize(mrb_state *mrb, mrb_value str, mrb_int len)
{
  return mrb_str_resize(mrb, str, len);
}

MRB_API mrb_value
mrb_str_substr(mrb_state *mrb, mrb_value str, mrb_int beg, mrb_int len)
{
  return str_substr(mrb, str, beg, len);
}

MRB_API mrb_value
mrb_str_aref(mrb_state *mrb, mrb_value str, mrb_value indx, mrb_value alen)
{
  return mrb_str_aref(mrb, str, indx, alen);
}

MRB_API mrb_value
mrb_str_aset(mrb_state *mrb, mrb_value str, mrb_value indx, mrb_value alen, mrb_value replace)
{
  mrb_str_aset(mrb, str, indx, alen, replace);
  return str;
}

MRB_API mrb_value
mrb_str_capitalize_bang(mrb_state *mrb, mrb_value str)
{
  return mrb_str_capitalize_bang(mrb, str);
}

MRB_API mrb_value
mrb_str_capitalize(mrb_state *mrb, mrb_value str)
{
  return mrb_str_capitalize(mrb, str);
}

MRB_API mrb_value
mrb_str_chomp_bang(mrb_state *mrb, mrb_value str)
{
  return mrb_str_chomp_bang(mrb, str);
}

MRB_API mrb_value
mrb_str_chomp(mrb_state *mrb, mrb_value str)
{
  return mrb_str_chomp(mrb, str);
}

MRB_API mrb_value
mrb_str_chop_bang(mrb_state *mrb, mrb_value str)
{
  return mrb_str_chop_bang(mrb, str);
}

MRB_API mrb_value
mrb_str_chop(mrb_state *mrb, mrb_value str)
{
  return mrb_str_chop(mrb, str);
}

MRB_API mrb_value
mrb_str_downcase_bang(mrb_state *mrb, mrb_value str)
{
  return mrb_str_downcase_bang(mrb, str);
}

MRB_API mrb_value
mrb_str_downcase(mrb_state *mrb, mrb_value str)
{
  return mrb_str_downcase(mrb, str);
}

MRB_API mrb_value
mrb_str_empty_p(mrb_state *mrb, mrb_value str)
{
  return mrb_str_empty_p(mrb, str);
}

MRB_API mrb_value
mrb_str_eql(mrb_state *mrb, mrb_value str)
{
  return mrb_str_eql(mrb, str);
}

MRB_API mrb_value
mrb_str_hash_m(mrb_state *mrb, mrb_value str)
{
  return mrb_str_hash_m(mrb, str);
}

MRB_API mrb_value
mrb_str_include(mrb_state *mrb, mrb_value str)
{
  return mrb_str_include(mrb, str);
}

MRB_API mrb_value
mrb_str_index_m(mrb_state *mrb, mrb_value str)
{
  return mrb_str_index_m(mrb, str);
}

MRB_API mrb_value
mrb_str_replace(mrb_state *mrb, mrb_value str)
{
  return mrb_str_replace(mrb, str);
}

MRB_API mrb_value
mrb_str_init(mrb_state *mrb, mrb_value str)
{
  return mrb_str_init(mrb, str);
}

MRB_API mrb_value
mrb_str_intern(mrb_state *m