const char *s = char_buffer;
  const char *send = char_buffer + len;
  char buf[256];
  char *n = buf;
  const char *p, *pend;
  double d;
  char *end;

  // 1. Trim leading whitespace from the input string.
  while (s < send && ISSPACE(*s)) s++;

  // 2. Check for and handle hexadecimal prefixes "0x" or "0X".
  if (s + 2 < send && s[0] == '0' && (s[1] == 'x' || s[1] == 'X')) {
    s += 2;
    goto nocopy;
  }

  // 3. Prepare a buffer to store cleaned input by removing underscores between digits.
  while (s < send) {
    char c = *s++;
    if (c == '_') continue; // skip underscores
    *n++ = c;
  }