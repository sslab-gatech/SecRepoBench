const char *s = char_buffer;
  const char *e = s + len;
  char buf[256];
  char *p, *n, *pend;

  while (s < e && ISSPACE(*s)) s++;
  if (e - s > 1 && *s == '0' && toupper(*(s+1)) == 'X') {
    s += 2;
    while (s < e && ISXDIGIT(*s)) s++;
  }
  n = buf;
  p = s;
  while (p < e) {
    if (*p == '_') {
      p++;
      continue;
    }
    if (!ISDIGIT(*p)) break;
    if (n >= buf + sizeof(buf) - 1) goto bad;
    *n++ = *p++;
  }