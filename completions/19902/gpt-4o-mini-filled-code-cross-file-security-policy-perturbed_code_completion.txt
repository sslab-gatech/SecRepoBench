char buf[256]; // Buffer to store cleaned input
const char *p = char_buffer;
const char *pend = char_buffer + len;
char *n = buf;

// Step 1: Trim leading whitespace
while (p < pend && ISSPACE(*p)) p++;

// Step 2: Check for hexadecimal prefixes
if (p + 1 < pend && (*p == '0') && (*(p + 1) == 'x' || *(p + 1) == 'X')) {
    p += 2; // Skip "0x" or "0X"
}

// Step 3: Prepare buffer and iterate over the string
while (p < pend && (n - buf < sizeof(buf) - 1)) {
    if (isdigit(*p) || *p == '.' || *p == '-' || *p == '+' || *p == '_') {
        if (*p != '_') { // Skip underscores
            *n++ = *p;
        }
    }
    p++;
}

// Step 4: Null-terminate the buffer
*n = '\0';

// Step 5: Handle badcheck
if (badcheck && (n == buf || (n == buf + 1 && *buf == '-'))) {
    goto bad; // Invalid string
}