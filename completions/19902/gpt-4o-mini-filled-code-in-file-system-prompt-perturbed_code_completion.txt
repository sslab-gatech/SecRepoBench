char buf[128];
  char *p = buf;
  char *pend = buf + sizeof(buf) - 1;
  double d;

  while (isspace(*string)) string++;
  if (*string == '-' || *string == '+') {
    *p++ = *string++;
  }

  while (*string && (isdigit(*string) || *string == '.' || *string == 'e' || *string == 'E' || *string == '+' || *string == '-')) {
    if (p < pend) {
      *p++ = *string;
    }
    string++;
  }
  *p = '\0';

  d = strtod(buf, NULL);
  if (endPtr) {
    *endPtr = (char *)string;
  }
  return d;