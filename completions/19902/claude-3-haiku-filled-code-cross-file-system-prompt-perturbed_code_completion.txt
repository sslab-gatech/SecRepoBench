char buf[BUFSIZE];
  char *p, *pend, *n;
  double d;

  p = buf;
  pend = buf + BUFSIZE - 1;
  n = buf;

  while (ISSPACE(*s)) s++;
  if (*s == '0' && (s[1] == 'x' || s[1] == 'X')) {
    s += 2;
    base = 16;
  }

  while (s < end) {
    if (*s == '_') {
      s++;
      continue;
    }
    if (ISDIGIT(*s) || (base == 16 && ISXDIGIT(*s))) {
      if (p < pend) *p++ = *s;
    }
    else {
      break;
    }
    s++;
  }