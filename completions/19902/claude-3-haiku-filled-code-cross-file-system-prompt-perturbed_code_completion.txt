char buf[BUFSIZE];
  char *p, *pend, *n;
  double d;

  p = buf;
  pend = buf + BUFSIZE - 1;
  n = buf;

  while (ISSPACE(*char_buffer)) {
    char_buffer++;
    len--;
  }

  if (len >= 2 && char_buffer[0] == '0' && (char_buffer[1] == 'x' || char_buffer[1] == 'X')) {
    char_buffer += 2;
    len -= 2;
    while (len > 0 && (*char_buffer == '_')) {
      char_buffer++;
      len--;
    }
  }

  while (len > 0 && n < pend) {
    if (*char_buffer == '_') {
      char_buffer++;
      len--;
      continue;
    }
    *n++ = *char_buffer++;
    len--;
  }