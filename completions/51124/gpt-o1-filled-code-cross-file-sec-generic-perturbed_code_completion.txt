if (cond[cond_index] != ']') {
    // Normal character check
    if (strip[i] != cond[cond_index]) {
        HUNSPELL_WARNING(stderr,
                         "warning: line %d: incompatible stripping "
                         "characters and condition\n",
                         linenum);
        return 0;
    }
} else {
    // Bracket expression
    int bracket_end = cond_index;
    // Find the matching '['
    int bracket_start = bracket_end - 1;
    while (bracket_start >= 0 && cond[bracket_start] != '[') {
        bracket_start--;
    }
    if (bracket_start < 0) {
        HUNSPELL_WARNING(stderr,
                         "error: line %d: missing [ in condition:\n%s\n",
                         linenum, cond.c_str());
        return 0;
    }
    // Check for negation
    neg = 0;
    if ((bracket_start + 1 < bracket_end) && (cond[bracket_start + 1] == '^')) {
        neg = 1;
    }
    // Check membership
    in = 0;
    for (int j = bracket_start + 1 + neg; j < bracket_end; j++) {
        if (strip[i] == cond[j]) {
            in = 1;
            break;
        }
    }
    if ((!neg && !in) || (neg && in)) {
        HUNSPELL_WARNING(stderr,
                         "warning: line %d: incompatible stripping "
                         "characters and condition\n",
                         linenum);
        return 0;
    }
    // Adjust cond_index so the next iteration continues correctly
    cond_index = bracket_start;
}