// Ensure that the envelope has at least two keys to interpolate
        if ((*it).keys.size() < 2) continue;

        // Calculate the number of repetitions needed for pre-behavior
        int repetitions = static_cast<int>(first - firsttime) / delta;
        if (repetitions < 0) repetitions = 0;

        // Insert additional keyframes for pre-behavior
        for (int i = 0; i < repetitions; ++i) {
            for (auto key_it = (*it).keys.begin(); key_it != (*it).keys.end(); ++key_it) {
                LWO::Key new_key = *key_it;
                new_key.time = key_it->time - (i + 1) * delta;
                (*it).keys.insert((*it).keys.begin(), new_key);
            }
        }