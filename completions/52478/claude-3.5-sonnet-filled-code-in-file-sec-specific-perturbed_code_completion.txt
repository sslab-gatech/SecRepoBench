// Handle pre-behavior
switch ((*it).pre) {
    case LWO::PrePostBehaviour_OffsetRepeat:
    case LWO::PrePostBehaviour_Repeat:
    case LWO::PrePostBehaviour_Oscillate:
        {
            const double value_delta = (*it).keys.back().value - (*it).keys.front().value;
            std::vector<LWO::Key> new_keys;
            new_keys.reserve((*it).keys.size() * 2); // Allocate conservatively

            while (firsttime > first) {
                for (const auto& key : (*it).keys) {
                    LWO::Key new_key = key;
                    new_key.time -= delta;

                    if ((*it).pre == LWO::PrePostBehaviour_OffsetRepeat) {
                        new_key.value -= value_delta;
                    } else if ((*it).pre == LWO::PrePostBehaviour_Oscillate) {
                        new_key.value = 2.0f * (*it).keys.front().value - new_key.value;
                    }

                    if (new_key.time >= first) {
                        new_keys.push_back(new_key);
                    }
                }
                firsttime -= delta;
            }

            // Safely insert new keys at the beginning
            (*it).keys.insert((*it).keys.begin(), new_keys.begin(), new_keys.end());
        }
        break;

    default:
        // No action needed for other pre-behaviors
        break;
}