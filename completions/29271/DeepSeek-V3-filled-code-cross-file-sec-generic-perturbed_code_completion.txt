zval *pcount, *pstorage;
	zend_long count;
	zval obj, inf;

	/* count */
	if (*p != 'i' || *++p != ':') {
		goto outexcept;
	}
	++p;

	pcount = var_tmp_var(&var_hash);
	if (!php_var_unserialize(pcount, &p, s + buf_len, &var_hash) || Z_TYPE_P(pcount) != IS_LONG) {
		goto outexcept;
	}
	count = Z_LVAL_P(pcount);

	if (*p != ';') {
		goto outexcept;
	}
	++p;

	/* storage */
	if (*p != 'a' || *++p != ':') {
		goto outexcept;
	}
	++p;

	pstorage = var_tmp_var(&var_hash);
	if (!php_var_unserialize(pstorage, &p, s + buf_len, &var_hash) || Z_TYPE_P(pstorage) != IS_ARRAY) {
		goto outexcept;
	}

	/* process storage */
	{
		zval *entry;
		zend_ulong idx;
		zend_string *key;
		ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL_P(pstorage), idx, key, entry) {
			if (Z_TYPE_P(entry) != IS_ARRAY || zend_hash_num_elements(Z_ARRVAL_P(entry)) < 1) {
				continue;
			}

			zval *zobj = zend_hash_index_find(Z_ARRVAL_P(entry), 0);
			if (zobj == NULL || Z_TYPE_P(zobj) != IS_OBJECT) {
				continue;
			}

			ZVAL_COPY_VALUE(&obj, zobj);
			if (zend_hash_num_elements(Z_ARRVAL_P(entry)) > 1) {
				zval *zinf = zend_hash_index_find(Z_ARRVAL_P(entry), 1);
				if (zinf != NULL) {
					ZVAL_COPY_VALUE(&inf, zinf);
				} else {
					ZVAL_UNDEF(&inf);
				}
			} else {
				ZVAL_UNDEF(&inf);
			}

			spl_object_storage_attach(intern, &obj, &inf);
		} ZEND_HASH_FOREACH_END();
	}

	if (*p != ';') {
		goto outexcept;
	}
	++p;