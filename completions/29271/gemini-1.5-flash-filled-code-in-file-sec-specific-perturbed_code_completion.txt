zval *count_zv, *pmembers;
	spl_SplObjectStorageElement *element;
	zend_long count;

	if (zend_parse_parameters(ZEND_NUM_ARGS(), "s", &serialized_data_buffer, &buf_len) == FAILURE) {
		RETURN_THROWS();
	}

	s = (const unsigned char*)serialized_data_buffer;
	p = s;

	PHP_VAR_UNSERIALIZE_INIT(var_hash);

	/* storage */
	if (*p != 'x' || *++p != ':') {
		goto outexcept;
	}
	++p;

	count_zv = var_tmp_var(&var_hash);
	if (!php_var_unserialize(count_zv, &p, s + buf_len, &var_hash) || Z_TYPE_P(count_zv) != IS_LONG) {
		goto outexcept;
	}
	count = Z_LVAL_P(count_zv);

	zend_hash_init(&intern->storage, count, NULL, spl_object_storage_dtor, 0);

	while (count--) {
		zval *obj_zv, *inf_zv;
		zend_object *obj;

		obj_zv = var_tmp_var(&var_hash);
		if (!php_var_unserialize(obj_zv, &p, s + buf_len, &var_hash) || Z_TYPE_P(obj_zv) != IS_OBJECT) {
			goto outexcept;
		}
		obj = Z_OBJ_P(obj_zv);

		if (*p != ',') {
			goto outexcept;
		}
		++p;

		inf_zv = var_tmp_var(&var_hash);
		if (!php_var_unserialize(inf_zv, &p, s + buf_len, &var_hash)) {
			goto outexcept;
		}

		element = spl_object_storage_attach(intern, obj, inf_zv);
		if (!element) {
			goto outexcept;
		}
		zval_ptr_dtor(obj_zv);
		zval_ptr_dtor(inf_zv);