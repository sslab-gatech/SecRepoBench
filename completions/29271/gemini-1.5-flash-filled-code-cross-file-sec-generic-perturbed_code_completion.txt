p = var_tmp_var(&var_hash);
	if (!php_var_unserialize(p, &p, s + buf_len, &var_hash) || Z_TYPE_P(p) != IS_LONG) {
		goto outexcept;
	}
	intern->count = Z_LVAL_P(p);

	if (*p != ';') {
		goto outexcept;
	}
	++p;

	/* storage */
	if (*p!= 's' || *++p != ':') {
		goto outexcept;
	}
	++p;

	pstorage = var_tmp_var(&var_hash);
	if (!php_var_unserialize(pstorage, &p, s + buf_len, &var_hash) || Z_TYPE_P(pstorage) != IS_ARRAY) {
		goto outexcept;
	}

	ZEND_HASH_FOREACH_VAL(Z_ARRVAL_P(pstorage), data) {
		zval *obj, *inf;
		spl_SplObjectStorageElement *elem;

		if (Z_TYPE(data) != IS_ARRAY || zend_hash_num_elements(Z_ARRVAL(data)) != 2) {
			goto outexcept;
		}

		obj = zend_hash_index_find(Z_ARRVAL(data), 0);
		inf = zend_hash_index_find(Z_ARRVAL(data), 1);

		if (Z_TYPE_P(obj) != IS_OBJECT) {
			goto outexcept;
		}

		elem = spl_object_storage_find(intern, Z_OBJ_P(obj));
		if (!elem) {
			elem = emalloc(sizeof(spl_SplObjectStorageElement));
			elem->obj = Z_OBJ_P(obj);
			Z_ADDREF_P(obj);
			zend_hash_add_ptr(&intern->storage, elem->obj, elem);
		}
		zval_ptr_dtor(&elem->inf);
		ZVAL_COPY(&elem->inf, inf);
	} ZEND_HASH_FOREACH_END();

	zval_ptr_dtor(pstorage);