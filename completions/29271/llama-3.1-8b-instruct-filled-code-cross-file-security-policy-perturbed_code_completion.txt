// <MASK>
if (*p!= ';') {
    goto outexcept;
}
++p;

/* members */
if (*p!='m' || *++p!= ':') {
    goto outexcept;
}
++p;

pmembers = var_tmp_var(&var_hash);
if (!php_var_unserialize(pmembers, &p, s + buf_len, &var_hash) || Z_TYPE_P(pmembers)!= IS_ARRAY) {
    goto outexcept;
}

/* copy members */
object_properties_load(&intern->std, Z_ARRVAL_P(pmembers));

/* iterate through the serialized elements, checking for the correct format of each entry */
while (*p == ';') {
    ++p;
    if (*p == '\0') {
        break;
    }

    /* unserialize the count of elements in the buffer */
    if (*p!= 'c' || *++p!= ':') {
        goto outexcept;
    }
    ++p;

    /* unserialize the count of elements */
    count = var_tmp_var(&var_hash);
    if (!php_var_unserialize(count, &p, s + buf_len, &var_hash) || Z_TYPE_P(count)!= IS_LONG) {
        goto outexcept;
    }

    /* unserialize each element */
    for (i = 0; i < Z_LVAL_P(count); i++) {
        /* unserialize the element */
        elem = var_tmp_var(&var_hash);
        if (!php_var_unserialize(elem, &p, s + buf_len, &var_hash)) {
            goto outexcept;
        }

        /* validate the unserialized data, ensuring it is an object, and retrieve or create a storage element */
        if (Z_TYPE_P(elem)!= IS_OBJECT) {
            goto outexcept;
        }

        /* manage references and memory for the unserialized entries, facilitating cross-references */
        Z_TRY_ADDREF(elem);

        /* attach the unserialized elements and their information to the internal storage structure */
        spl_SplObjectStorageElement *elem_ptr = emalloc(sizeof(spl_SplObjectStorageElement));
        elem_ptr->obj = Z_OBJ_P(elem);
        elem_ptr->inf = Z_OBJ_P(elem);
        zend_hash_next_index_insert(&intern->storage, elem_ptr);
    }
}

/* done reading $serialized */
PHP_VAR_UNSERIALIZE_DESTROY(var_hash);
return;

outexcept:
PHP_VAR_UNSERIALIZE_DESTROY(var_hash);
zend_throw_exception_ex(spl_ce_UnexpectedValueException, 0, "Error at offset %zd of %zd bytes", ((char*)p - serialized_data_buffer), buf_len);
RETURN_THROWS();