ZEND_PARSE_PARAMETERS_START(1, 1)
		Z_PARAM_STRING(serialized_data_buffer, buf_len)
	ZEND_PARSE_PARAMETERS_END();

	if (buf_len == 0) {
		return;
	}

	p = (const unsigned char*)serialized_data_buffer;
	s = p;

	PHP_VAR_UNSERIALIZE_INIT(var_hash);

	/* storage */
	if (*p != 'x' || *++p != ':') {
		goto outexcept;
	}
	++p;

	if (!php_var_unserialize(&flags, &p, s + buf_len, &var_hash) || Z_TYPE(flags) != IS_LONG) {
		goto outexcept;
	}

	while (*p == 'C') {
		zval obj, inf;
		if (!php_var_unserialize(&obj, &p, s + buf_len, &var_hash) || Z_TYPE(obj) != IS_OBJECT) {
			goto outexcept;
		}

		if (*p != ',') {
			zval_ptr_dtor(&obj);
			goto outexcept;
		}
		++p;

		if (!php_var_unserialize(&inf, &p, s + buf_len, &var_hash)) {
			zval_ptr_dtor(&obj);
			goto outexcept;
		}

		spl_object_storage_attach(intern, Z_OBJ(obj), &inf);
		zval_ptr_dtor(&obj);
		zval_ptr_dtor(&inf);

		if (*p != ';') {
			goto outexcept;
		}
		++p;
	}