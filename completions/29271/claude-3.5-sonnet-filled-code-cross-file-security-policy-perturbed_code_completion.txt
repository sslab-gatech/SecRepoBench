zval *pcount, *pdata, *pinfo;
zend_long count;

if (*p != 'x' || *++p != ':') {
    goto outexcept;
}
++p;

pcount = var_tmp_var(&var_hash);
if (!php_var_unserialize(pcount, &p, s + buf_len, &var_hash) || Z_TYPE_P(pcount) != IS_LONG) {
    goto outexcept;
}
count = Z_LVAL_P(pcount);

if (*p != ':') {
    goto outexcept;
}
++p;

pdata = var_tmp_var(&var_hash);
if (!php_var_unserialize(pdata, &p, s + buf_len, &var_hash) || Z_TYPE_P(pdata) != IS_ARRAY) {
    goto outexcept;
}

zend_hash_clean(&intern->storage);

for (zend_long i = 0; i < count; i++) {
    zval *entry = zend_hash_index_find(Z_ARRVAL_P(pdata), i * 2);
    if (!entry || Z_TYPE_P(entry) != IS_OBJECT) {
        goto outexcept;
    }

    spl_SplObjectStorageElement *element = spl_object_storage_get(intern, Z_OBJ_P(entry));

    pinfo = zend_hash_index_find(Z_ARRVAL_P(pdata), i * 2 + 1);
    if (pinfo) {
        ZVAL_COPY(&element->inf, pinfo);
    } else {
        ZVAL_NULL(&element->inf);
    }
}