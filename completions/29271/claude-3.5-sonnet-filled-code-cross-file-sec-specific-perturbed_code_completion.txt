/* storage */
if (*p != 'a' && *p != 'O' && *p != 'C' && *p != 'r') {
    goto outexcept;
}

zval *storage = var_tmp_var(&var_hash);
if (!php_var_unserialize(storage, &p, s + buf_len, &var_hash) || Z_TYPE_P(storage) != IS_ARRAY) {
    goto outexcept;
}

zend_hash_clean(&intern->storage);

zval *entry;
ZEND_HASH_FOREACH_VAL(Z_ARRVAL_P(storage), entry) {
    if (Z_TYPE_P(entry) != IS_ARRAY || zend_hash_num_elements(Z_ARRVAL_P(entry)) != 2) {
        goto outexcept;
    }
    
    zval *obj = zend_hash_index_find(Z_ARRVAL_P(entry), 0);
    zval *inf = zend_hash_index_find(Z_ARRVAL_P(entry), 1);
    
    if (!obj || Z_TYPE_P(obj) != IS_OBJECT) {
        goto outexcept;
    }
    
    spl_object_storage_attach(intern, obj, inf);
} ZEND_HASH_FOREACH_END();

if (*p != ';') {
    goto outexcept;
}
++p;