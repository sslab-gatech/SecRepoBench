if (zend_parse_parameters(ZEND_NUM_ARGS(), "s", &serialized_data_buffer, &buf_len) == FAILURE) {
		RETURN_THROWS();
	}

	if (buf_len == 0) {
		return;
	}

	s = p = (const unsigned char*)serialized_data_buffer;
	PHP_VAR_UNSERIALIZE_INIT(var_hash);

	/* parse and validate the storage array/object containing object-info pairs */
	if (*p != 'a' && *p != 'O' && *p != 'C' && *p != 'r') {
		goto outexcept;
	}

	zval *zstorage = var_tmp_var(&var_hash);
	if (!php_var_unserialize(zstorage, &p, s + buf_len, &var_hash) || Z_TYPE_P(zstorage) != IS_ARRAY) {
		goto outexcept;
	}

	/* iterate over the deserialized array in pairs (object, info) */
	{
		HashTable *ht = Z_ARRVAL_P(zstorage);
		zval *zobj, *zinf;
		HashPosition pos;

		zend_hash_internal_pointer_reset_ex(ht, &pos);
		while ((zobj = zend_hash_get_current_data_ex(ht, &pos)) != NULL) {
			zend_hash_move_forward_ex(ht, &pos);
			if ((zinf = zend_hash_get_current_data_ex(ht, &pos)) == NULL) {
				goto outexcept;
			}
			zend_hash_move_forward_ex(ht, &pos);

			/* ensure the first of the pair is indeed an object */
			if (Z_TYPE_P(zobj) != IS_OBJECT) {
				goto outexcept;
			}

			/* attach the object and info to this SplObjectStorage instance */
			Z_TRY_ADDREF_P(zobj);
			Z_TRY_ADDREF_P(zinf);
			spl_object_storage_attach(intern, zobj, zinf);
		}
	}