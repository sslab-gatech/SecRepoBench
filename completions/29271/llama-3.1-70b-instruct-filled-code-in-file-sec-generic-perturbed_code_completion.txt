p = serialized_data_buffer;
s = serialized_data_buffer + buf_len;

if (*p!= 'x' || *++p!= ':') {
    goto outexcept;
}
++p;

pmembers = var_tmp_var(&var_hash);
if (!php_var_unserialize(pmembers, &p, s, &var_hash) || Z_TYPE_P(pmembers)!= IS_ARRAY) {
    goto outexcept;
}

/* storage */
if (*p!='m' || *++p!= ':') {
    goto outexcept;
}
++p;

zval storage;
array_init(&storage);

while (p < s) {
    zval obj, inf;
    if (!php_var_unserialize(&obj, &p, s, &var_hash) || Z_TYPE(obj)!= IS_OBJECT) {
        goto outexcept;
    }
    if (!php_var_unserialize(&inf, &p, s, &var_hash)) {
        goto outexcept;
    }
    spl_object_storage_attach(intern, Z_OBJ(obj), &inf);
    zval_ptr_dtor(&obj);
    zval_ptr_dtor(&inf);
}

/* copy members */
object_properties_load(&intern->std, Z_ARRVAL_P(pmembers));