zval *pmembers, *pcount, *pelement, *pinfo;
	zend_object *obj;
	zend_long count;

	if (zend_parse_parameters(ZEND_NUM_ARGS(), "s", &serialized_data_buffer, &buf_len) == FAILURE) {
		RETURN_THROWS();
	}

	s = (const unsigned char*)serialized_data_buffer;
	p = s;

	PHP_VAR_UNSERIALIZE_INIT(var_hash);

	/* storage */
	if (*p!= 'x' || *++p != ':') {
		goto outexcept;
	}
	++p;

	pcount = var_tmp_var(&var_hash);
	if (!php_var_unserialize(pcount, &p, s + buf_len, &var_hash) || Z_TYPE_P(pcount) != IS_LONG) {
		goto outexcept;
	}

	count = Z_LVAL_P(pcount);

	while (count-- > 0) {
		pelement = var_tmp_var(&var_hash);
		if (!php_var_unserialize(pelement, &p, s + buf_len, &var_hash)) {
			goto outexcept;
		}
		if (Z_TYPE_P(pelement) != IS_OBJECT) {
			zval_ptr_dtor(pelement);
			goto outexcept;
		}
		obj = Z_OBJ_P(pelement);

		pinfo = var_tmp_var(&var_hash);
		if (*p == ',') { /* new version has inf */
			++p;
			if (!php_var_unserialize(pinfo, &p, s + buf_len, &var_hash)) {
				zval_ptr_dtor(pelement);
				goto outexcept;
			}
		} else {
			ZVAL_NULL(pinfo);
		}

		spl_object_storage_attach(intern, obj, pinfo);
		zval_ptr_dtor(pelement);