zval *pmembers;

PHP_VAR_UNSERIALIZE_INIT(var_hash);

/* Check for the expected format of the serialized data */
if (*p != 'x' || *++p != ':') {
	goto outexcept;
}
++p;

/* Unserialize the flags */
zval *zflags = var_tmp_var(&var_hash);
if (!php_var_unserialize(zflags, &p, s + buf_len, &var_hash) || Z_TYPE_P(zflags) != IS_LONG) {
	goto outexcept;
}

/* Process the flags */
--p; /* for ';' */
if (*p != ';') {
	goto outexcept;
}
++p;

/* Unserialize the members */
if (*p != 'm' || *++p != ':') {
	goto outexcept;
}
++p;

pmembers = var_tmp_var(&var_hash);
if (!php_var_unserialize(pmembers, &p, s + buf_len, &var_hash) || Z_TYPE_P(pmembers) != IS_ARRAY) {
	goto outexcept;
}

/* Load the unserialized members into the object storage */
object_properties_load(&intern->std, Z_ARRVAL_P(pmembers));