{
	zval *storage = var_tmp_var(&var_hash);
	if (!php_var_unserialize(storage, &p, s + buf_len, &var_hash) || Z_TYPE_P(storage) != IS_ARRAY) {
		goto outexcept;
	}

	HashTable *ht = Z_ARRVAL_P(storage);
	zend_ulong num = zend_hash_num_elements(ht);
	if ((num & 1UL) != 0) {
		zval_ptr_dtor(storage);
		goto outexcept;
	}

	zend_ulong i;
	for (i = 0; i < num; i += 2) {
		zval *obj_entry = zend_hash_index_find(ht, i);
		zval *inf_entry = zend_hash_index_find(ht, i + 1);
		if (!obj_entry || Z_TYPE_P(obj_entry) != IS_OBJECT) {
			zval_ptr_dtor(storage);
			goto outexcept;
		}
		/* Attach the object and its associated info to the storage */
		spl_object_storage_attach(intern, Z_OBJ_P(obj_entry), inf_entry);
		Z_TRY_ADDREF_P(inf_entry);
	}
	zval_ptr_dtor(storage);
}