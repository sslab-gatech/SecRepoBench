PHP_VAR_UNSERIALIZE_INIT(var_hash);

if (*p != 'O' || *++p != ':') {
    goto outexcept;
}
++p;

if (!php_var_unserialize(&intern->obj, &p, s + buf_len, &var_hash) || Z_TYPE(intern->obj) != IS_OBJECT) {
    goto outexcept;
}

if (*p != ';') {
    goto outexcept;
}
++p;

if (*p != 'i' || *++p != ':') {
    goto outexcept;
}
++p;

if (!php_var_unserialize(&intern->inf, &p, s + buf_len, &var_hash)) {
    goto outexcept;
}

if (*p != ';') {
    goto outexcept;
}
++p;

zend_hash_index_update(&intern->storage, (zend_ulong)Z_OBJ(intern->obj), &intern->obj);
zend_hash_index_update(&intern->storage, (zend_ulong)Z_OBJ(intern->obj) + 1, &intern->inf);