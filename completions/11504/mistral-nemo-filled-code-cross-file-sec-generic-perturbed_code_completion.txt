if (parser_ctxt->freeElems != NULL) {
    ret = parser_ctxt->freeElems;
    parser_ctxt->freeElems = parser_ctxt->freeElems->next;
    ret->next = NULL;
    ret->type = XML_ELEMENT_NODE;
    ret->name = xmlDictQLookup(parser_ctxt->dict, localname, NULL);
    if (ret->name == NULL) {
        xmlSAX2ErrMemory(parser_ctxt, "xmlSAX2StartElementNs");
        return NULL;
    }
    if (parser_ctxt->dictNames) {
        ret->ns = xmlSearchNs(parser_ctxt->myDoc, parent, NULL);
    } else {
        ret->ns = NULL;
    }
    if (ret->ns == NULL && xmlStrEqual(prefix, BAD_CAST "xml")) {
        ret->ns = xmlSearchNs(parser_ctxt->myDoc, ret, NULL);
    }
    if (ret->ns == NULL) {
        ns = xmlNewNs(ret, NULL, NULL);
        if (ns == NULL) {
            xmlSAX2ErrMemory(parser_ctxt, "xmlSAX2StartElementNs");
            return NULL;
        }
        ret->ns = ns;
    }
} else {
    ret = xmlNewDocNode(parser_ctxt->myDoc, NULL, localname, NULL);
    if (ret == NULL) {
        xmlSAX2ErrMemory(parser_ctxt, "xmlSAX2StartElementNs");
        return NULL;
    }
}