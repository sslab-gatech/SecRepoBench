ret = parser_ctxt->freeElems;
parser_ctxt->freeElems = ret->next;
parser_ctxt->freeElemsNr--;

/*
 * Clear the node's memory to reset its state
 * and set the node type to XML_ELEMENT_NODE.
 */
memset(ret, 0, sizeof(xmlNode));
ret->type = XML_ELEMENT_NODE;

/*
 * Assign the local name using either the parser's dictionary
 * or by duplicating the string. Report errors if allocation fails.
 */
if (parser_ctxt->dictNames) {
    ret->name = localname;
} else {
    ret->name = xmlStrdup(localname);
    if (ret->name == NULL) {
        xmlSAX2ErrMemory(parser_ctxt, "xmlSAX2StartElementNs");
        return;
    }
}

/*
 * Attach to the document and reset next pointers.
 */
ret->doc = parser_ctxt->myDoc;
ret->next = NULL;
ret->prev = NULL;