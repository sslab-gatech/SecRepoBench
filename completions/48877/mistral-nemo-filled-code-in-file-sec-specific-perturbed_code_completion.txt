static mrb_value
int_pow(mrb_state *mrb, mrb_value x)
{
  mrb_value y = mrb_get_arg1(mrb);
  mrb_int base, exp;

  base = mrb_integer(x);
  if (mrb_integer_p(y)) {
    exp = mrb_integer(y);
  }
  else if (mrb_float_p(y)) {
    exp = (mrb_int)mrb_float(y);
  }
  else {
    mrb_raise(mrb, E_TYPE_ERROR, "non integer power");
  }
  if (exp < 0) {
    if (base == 0) {
      mrb_raise(mrb, E_ZERODIV_ERROR, "0**0");
    }
    else if (base == 1) {
      return mrb_int_value(mrb, 1);
    }
    else {
      return mrb_float_value(mrb, 1.0 / pow((double)base, (double)exp));
    }
  }
  if (exp == 0) {
    return mrb_int_value(mrb, 1);
  }
  if (exp == 1) {
    return mrb_int_value(mrb, base);
  }
  if (exp == 2) {
    return mrb_int_value(mrb, base * base);
  }
  if (exp == 3) {
    return mrb_int_value(mrb, base * base * base);
  }
  if (exp == 4) {
    return mrb_int_value(mrb, base * base * base * base);
  }
  if (exp == 5) {
    return mrb_int_value(mrb, base * base * base * base * base);
  }
  if (exp == 6) {
    return mrb_int_value(mrb, base * base * base * base * base * base);
  }
  if (exp == 7) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base);
  }
  if (exp == 8) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base);
  }
  if (exp == 9) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base);
  }
  if (exp == 10) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 11) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 12) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 13) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 14) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 15) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 16) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 17) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 18) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 19) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 20) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 21) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 22) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 23) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 24) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 25) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 26) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 27) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 28) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 29) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 30) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 31) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 32) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 33) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 34) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 35) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 36) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 37) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 38) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 39) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 40) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 41) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 42) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 43) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base * base);
  }
  if (exp == 44) {
    return mrb_int_value(mrb, base * base * base * base * base * base * base * base * base * base * base * base * base