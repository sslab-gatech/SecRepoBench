mrb_value x = mrb_get_arg1(mrb);
mrb_value value = mrb_get_arg2(mrb);
mrb_int n;

switch (mrb_type(x)) {
case MRB_TT_INTEGER:
#ifdef MRB_NO_FLOAT
  n = mrb_integer(x);
#else
  n = (mrb_float)mrb_integer(x);
#endif
  break;
#ifndef MRB_NO_FLOAT
case MRB_TT_FLOAT:
  n = mrb_float(x);
  break;
#ifdef MRB_USE_RATIONAL
case MRB_TT_RATIONAL:
  n = mrb_as_float(mrb, x);
  break;
#endif
#endif
default:
  return -2;
}