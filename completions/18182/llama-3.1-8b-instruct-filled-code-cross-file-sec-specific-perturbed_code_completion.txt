#if defined(TIFFTAG_XMLPACKET)
  if ((TIFFGetField(tiff,TIFFTAG_XMLPACKET,&length,&profile) == 1) &&
      (profile!= (unsigned char *) NULL))
    {
      // The block reads the XMP profile from a TIFF image, checking if the profile contains the string 
      // "dc:format=\"image/dng\"". If the string is found, it sets the image's format to "DNG".
      const char
        *xmp_string;

      xmp_string=(const char *) profile;
      while (*xmp_string!= '\0')
      {
        if (LocaleCompare(xmp_string,"dc:format=\"image/dng\"") == 0)
          {
            (void) SetImageProperty(img,"format","DNG",exception);
            break;
          }
        xmp_string=LocaleNextToken(xmp_string);
      }
    }
#endif