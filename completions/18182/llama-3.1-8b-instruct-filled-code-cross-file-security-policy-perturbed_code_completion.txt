#if defined(TIFFTAG_XMLPACKET)
  if ((TIFFGetField(tiff,TIFFTAG_XMLPACKET,&length,&profile) == 1) &&
      (profile!= (unsigned char *) NULL))
    {
      // The block reads the XMP profile from a TIFF image, checking if the profile contains the string 
      // "dc:format=\"image/dng\"". If the string is found, it sets the image's format to "DNG".
      StringInfo
        *xml_string;

      xml_string=StringInfoCreateCopy(profile);
      if (StringInfoLength(xml_string) >= 20)
        {
          char
            *xml_copy;

          xml_copy=StringInfoToString(xml_string);
          if (LocaleCompare(xml_copy,"dc:format=\"image/dng\"") == 0)
            {
              (void) SetImageProperty(img,"format","DNG",exception);
            }
          StringInfoFree(xml_string);
        }
      else
        StringInfoFree(xml_string);
    }
#endif