char *xmp_profile = (char *) profile;
      size_t xmp_length = (size_t) length;

      // Ensure the profile is null-terminated to safely use string functions
      char *safe_xmp_profile = (char *) malloc(xmp_length + 1);
      if (safe_xmp_profile == NULL)
      {
        (void) ThrowMagickException(exception, GetMagickModule(), ResourceLimitError,
          "MemoryAllocationFailed", "`%s'", "TIFFGetProfiles");
        return;
      }
      memcpy(safe_xmp_profile, xmp_profile, xmp_length);
      safe_xmp_profile[xmp_length] = '\0';

      // Check if the profile contains the specific string
      if (strstr(safe_xmp_profile, "dc:format=\"image/dng\"") != NULL)
        (void) CopyMagickString(img->magick, "DNG", MagickPathExtent);

      // Clean up allocated memory
      free(safe_xmp_profile);