char
  *xmp_profile;

size_t
  profile_length;

/* Ensure safe bounds for length */
if (length > SSIZE_MAX)
{
  /* Handle error: Length exceeds maximum allowed size */
  return;
}

/* Allocate memory for the XMP profile string with null terminator */
profile_length = length + 1;
xmp_profile = (char *) AcquireQuantumMemory(profile_length, sizeof(*xmp_profile));
if (xmp_profile == (char *) NULL)
{
  /* Handle error: Memory allocation failed */
  return;
}

/* Copy the profile data into the allocated buffer and ensure null termination */
(void) memcpy(xmp_profile, profile, length);
xmp_profile[profile_length - 1] = '\0';

/* Check if the profile contains the specific string */
if ((strnstr(xmp_profile, "dc:format=\"image/dng\"", profile_length) != (char *) NULL))
{
  /* Set the image format to DNG */
  (void) SetImageProperty(img, "format", "DNG", exception);
}

/* Release the allocated memory */
xmp_profile = RelinquishMagickMemory(xmp_profile);