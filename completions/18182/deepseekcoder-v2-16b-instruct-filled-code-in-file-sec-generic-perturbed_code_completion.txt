green_primary.y=chromaticity[3];
            image->chromaticity.blue_primary.x=chromaticity[4];
            image->chromaticity.blue_primary.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YCBCRCOEFFICIENTS,&chromaticity) == 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.y_chroma_weight=chromaticity[0];
            image->chromaticity.cb_chroma_weight=chromaticity[1];
            image->chromaticity.cr_chroma_weight=chromaticity[2];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_REFERENCEBLACKWHITE,&chromaticity) == 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.black_point.x=chromaticity[0];
            image->chromaticity.black_point.y=chromaticity[1];
            image->chromaticity.white_point.x=chromaticity[2];
            image->chromaticity.white_point.y=chromaticity[3];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      (void) SetImageProperty(image,"tiff:software",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ARTIST,&value) == 1)
      (void) SetImageProperty(image,"tiff:artist",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_COPYRIGHT,&value) == 1)
      (void) SetImageProperty(image,"tiff:copyright",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_DATETIME,&value) == 1)
      (void) SetImageProperty(image,"tiff:timestamp",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_DOCUMENTNAME,&value) == 1)
      (void) SetImageProperty(image,"tiff:document",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_HOSTCOMPUTER,&value) == 1)
      (void) SetImageProperty(image,"tiff:hostcomputer",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_IMAGEDESCRIPTION,&value) == 1)
      (void) SetImageProperty(image,"comment",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MAKE,&value) == 1)
      (void) SetImageProperty(image,"tiff:make",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MODEL,&value) == 1)
      (void) SetImageProperty(image,"tiff:model",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_OPIIMAGEID,&value) == 1)
      (void) SetImageProperty(image,"tiff:image-id",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENAME,&value) == 1)
      (void) SetImageProperty(image,"label",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      (void) SetImageProperty(image,"tiff:software",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,33423,&value) == 1)
      (void) SetImageProperty(image,"tiff:kodak-33423",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,36867,&value) == 1)
      (void) SetImageProperty(image,"tiff:kodak-36867",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SUBFILETYPE,&value) == 1)
      {
        switch (value)
        {
          case 0x01:
          {
            (void) SetImageProperty(image,"tiff:subfiletype","REDUCEDIMAGE",
              exception);
            break;
          }
          case 0x02:
          {
            (void) SetImageProperty(image,"tiff:subfiletype","PAGE",exception);
            break;
          }
          case 0x04:
          {
            (void) SetImageProperty(image,"tiff:subfiletype","MASK",exception);
            break;
          }
          default:
            break;
        }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_EXIFIFD,&value) == 1)
      {
        if (value != 0)
          TIFFGetEXIFProperties(tiff,image,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RICHTIFFIPTC,&value) == 1)
      {
        if (value != 0)
          TIFFGetEXIFProperties(tiff,image,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XMLPACKET,&value) == 1)
      {
        if (value != 0)
          TIFFGetEXIFProperties(tiff,image,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PHOTOSHOP,&value) == 1)
      {
        if (value != 0)
          TIFFReadPhotoshopLayers(image_info,image,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_EXIFASPECTRATIO,&value) == 1)
      {
        if (value != 0)
          {
            image->aspect_ratio=(double) value/(double) TIFFGetFieldDefaulted(tiff,
              TIFFTAG_EXIFPIXELXDIMENSION,&value);
            if (image->aspect_ratio == 0.0)
              image->aspect_ratio=1.0;
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YCBCRPOSITIONING,&value) == 1)
      {
        if (value == YCBCRPOSITION_CENTERED)
          (void) SetImageProperty(image,"tiff:ycbcr-positioning",
            "centered",exception);
        else
          (void) SetImageProperty(image,"tiff:ycbcr-positioning",
            "cosited",exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_TRANSFERFUNCTION,&chromaticity) == 1)
      {
        if (chromaticity != (float *) NULL)
          {
            image->chromaticity.red_primary.x=chromaticity[0];
            image->chromaticity.red_primary.y=chromaticity[1];
            image->chromaticity.green_primary.x=chromaticity[2];
            image->chromaticity.green_primary.y=chromaticity[3];
            image->chromaticity.blue_primary.x=chromaticity[4];
            image->chromaticity.blue_primary.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      (void) SetImageProperty(image,"tiff:software",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ARTIST,&value) == 1)
      (void) SetImageProperty(image,"tiff:artist",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_COPYRIGHT,&value) == 1)
      (void) SetImageProperty(image,"tiff:copyright",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_DATETIME,&value) == 1)
      (void) SetImageProperty(image,"tiff:timestamp",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_DOCUMENTNAME,&value) == 1)
      (void) SetImageProperty(image,"tiff:document",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_HOSTCOMPUTER,&value) == 1)
      (void) SetImageProperty(image,"tiff:hostcomputer",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_IMAGEDESCRIPTION,&value) == 1)
      (void) SetImageProperty(image,"comment",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MAKE,&value) == 1)
      (void) SetImageProperty(image,"tiff:make",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MODEL,&value) == 1)
      (void) SetImageProperty(image,"tiff:model",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_OPIIMAGEID,&value) == 1)
      (void) SetImageProperty(image,"tiff:image-id",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENAME,&value) == 1)
      (void) SetImageProperty(image,"label",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      (void) SetImageProperty(image,"tiff:software",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,33423,&value) == 1)
      (void) SetImageProperty(image,"tiff:kodak-33423",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,36867,&value) == 1)
      (void) SetImageProperty(image,"tiff:kodak-36867",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SUBFILETYPE,&value) == 1)
      {
        switch (value)
        {
          case 0x01:
          {
            (void) SetImageProperty(image,"tiff:subfiletype","REDUCEDIMAGE",
              exception);
            break;
          }
          case 0x02:
          {
            (void) SetImageProperty(image,"tiff:subfiletype","PAGE",exception);
            break;
          }
          case 0x04:
          {
            (void) SetImageProperty(image,"tiff:subfiletype","MASK",exception);
            break;
          }
          default:
            break;
        }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_EXIFIFD,&value) == 1)
      {
        if (value != 0)
          TIFFGetEXIFProperties(tiff,image,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RICHTIFFIPTC,&value) == 1)
      {
        if (value != 0)
          TIFFGetEXIFProperties(tiff,image,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XMLPACKET,&value) == 1)
      {
        if (value != 0)
          TIFFGetEXIFProperties(tiff,image,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PHOTOSHOP,&value) == 1)
      {
        if (value != 0)
          TIFFReadPhotoshopLayers(image_info,image,exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_EXIFASPECTRATIO,&value) == 1)
      {
        if (value != 0)
          {
            image->aspect_ratio=(double) value/(double) TIFFGetFieldDefaulted(tiff,
              TIFFTAG_EXIFPIXELXDIMENSION,&value);
            if (image->aspect_ratio == 0.0)
              image->aspect_ratio=1.0;
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YCBCRPOSITIONING,&value) == 1)
      {
        if (value == YCBCRPOSITION_CENTERED)
          (void) SetImageProperty(image,"tiff:ycbcr-positioning",
            "centered",exception);
        else
          (void) SetImageProperty(image,"tiff:ycbcr-positioning",
            "cosited",exception);
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_TRANSFER