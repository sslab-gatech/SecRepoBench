#if defined(TIFFTAG_XMLPACKET)
  if ((TIFFGetField(tiff,TIFFTAG_XMLPACKET,&length,&profile) == 1) &&
      (profile != (unsigned char *) NULL))
    {
      // The block reads the XMP profile from a TIFF image, checking if the profile contains the string 
      // "dc:format=\"image/dng\"". If the string is found, it sets the image's format to "DNG".
      char *xmp_data = (char *) profile;
      char *xmp_end = xmp_data + length;
      while (xmp_data < xmp_end - 10) {
        if (strncmp(xmp_data, "dc:format=\"image/dng\"", 22) == 0) {
          (void) SetImageProperty(image, "format", "DNG", exception);
          break;
        }
        xmp_data++;
      }
    }
#endif