char *xmp_data;
const char *target = "dc:format=\"image/dng\"";

xmp_data = (char *) AcquireQuantumMemory(length+1, sizeof(*xmp_data));
if (xmp_data != (char *) NULL)
{
  (void) memcpy(xmp_data, profile, length);
  xmp_data[length] = '\0';
  if (strstr(xmp_data, target) != (char *) NULL)
    (void) CopyMagickString(image->magick, "DNG", MagickPathExtent);
  xmp_data = (char *) RelinquishMagickMemory(xmp_data);
}
(void) ReadProfile(image, "xmp", profile, (ssize_t) length, exception);