status == 1)
             (void) FormatLocaleString(sampling_factor,MagickPathExtent,
               "%lux%lu",(unsigned long) horizontal,(unsigned long) vertical);
           else
             sampling_factor[0]='\0';
           (void) SetImageProperty(image,"tiff:ycbcr-subsampling",sampling_factor,
             exception);
         }
#endif
         break;
      }
      case COMPRESSION_LZW: image->compression=LZWCompression; break;
      case COMPRESSION_ADOBE_DEFLATE: image->compression=DeflateCompression; break;
      case COMPRESSION_PACKBITS: image->compression=PackBitsCompression; break;
      case COMPRESSION_THUNDERSCAN: image->compression=ThunderScanCompression; break;
      case COMPRESSION_IT8CTPAD: image->compression=IT8CTPADCompression; break;
      case COMPRESSION_IT8LW: image->compression=IT8LWCompression; break;
      case COMPRESSION_IT8MP: image->compression=IT8MPCompression; break;
      case COMPRESSION_IT8BL: image->compression=IT8BLCompression; break;
      case COMPRESSION_PIXARFILM: image->compression=PixarFilmCompression; break;
      case COMPRESSION_PIXARLOG: image->compression=PixarLogCompression; break;
      case COMPRESSION_DEFLATE: image->compression=DeflateCompression; break;
      case COMPRESSION_ADOBE_LZW: image->compression=LZWCompression; break;
      case COMPRESSION_ZLIB: image->compression=DeflateCompression; break;
      case COMPRESSION_JBIG: image->compression=JBIGCompression; break;
      case COMPRESSION_NEXT: image->compression=NextCompression; break;
      case COMPRESSION_CCITTRLE: image->compression=Group3Compression; break;
      case COMPRESSION_CCITTRLEW: image->compression=Group3Compression; break;
      case COMPRESSION_JPEG2000: image->compression=JPEG2000Compression; break;
      case COMPRESSION_LZMA: image->compression=LZMACompression; break;
      case COMPRESSION_ZSTD: image->compression=ZSTDCompression; break;
      case COMPRESSION_WEBP: image->compression=WebPCompression; break;
      default:
      {
        TIFFClose(tiff);
        ThrowReaderException(CoderError,"UnsupportedCompression");
      }
    }
    if (image->compression == JPEGCompression)
      {
        method=GetJPEGMethod(image,tiff,photometric,bits_per_sample,
          samples_per_pixel);
        if (method == ReadRGBAMethod)
          {
            if (photometric == PHOTOMETRIC_RGB)
              method=ReadRGBATileMethod;
            else
              method=ReadGenericMethod;
          }
        else
          if (method == ReadYCCKMethod)
            {
              if (photometric == PHOTOMETRIC_YCBCR)
                method=ReadRGBATileMethod;
              else
                method=ReadGenericMethod;
            }
      }
    else
      {
        if (photometric == PHOTOMETRIC_RGB)
          method=ReadRGBATileMethod;
        else
          method=ReadGenericMethod;
      }
    if (method == ReadStripMethod)
      {
        if ((TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) != 1) ||
            (rows_per_strip == 0))
          {
            TIFFClose(tiff);
            ThrowReaderException(CorruptImageError,"ImproperImageHeader");
          }
      }
    if (method == ReadTileMethod)
      {
        if ((TIFFGetFieldDefaulted(tiff,TIFFTAG_TILEWIDTH,&width) != 1) ||
            (TIFFGetFieldDefaulted(tiff,TIFFTAG_TILELENGTH,&height) != 1) ||
            (width == 0) || (height == 0))
          {
            TIFFClose(tiff);
            ThrowReaderException(CorruptImageError,"ImproperImageHeader");
          }
      }
    if (method == ReadRGBATileMethod)
      {
        if ((TIFFGetFieldDefaulted(tiff,TIFFTAG_TILEWIDTH,&width) != 1) ||
            (TIFFGetFieldDefaulted(tiff,TIFFTAG_TILELENGTH,&height) != 1) ||
            (width == 0) || (height == 0))
          {
            TIFFClose(tiff);
            ThrowReaderException(CorruptImageError,"ImproperImageHeader");
          }
      }
    if (method == ReadStripMethod)
      {
        if ((TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) != 1) ||
            (rows_per_strip == 0))
          {
            TIFFClose(tiff);
            ThrowReaderException(CorruptImageError,"ImproperImageHeader");
          }
      }
    if (method == ReadGenericMethod)
      {
        if ((TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) != 1) ||
            (rows_per_strip == 0))
          {
            TIFFClose(tiff);
            ThrowReaderException(CorruptImageError,"ImproperImageHeader");
          }
      }
    if (image->debug != MagickFalse)
      (void) LogMagickEvent(CoderEvent,GetMagickModule(),"Compression: %s",
        GetCompressionInfo(image->compression,exception));
    if (photometric == PHOTOMETRIC_SEPARATED)
      {
        if ((TIFFGetFieldDefaulted(tiff,TIFFTAG_EXTRASAMPLES,&extra_samples,
            &sample_info) != 1) || (extra_samples == 0))
          {
            TIFFClose(tiff);
            ThrowReaderException(CorruptImageError,"ImproperImageHeader");
          }
        if (extra_samples > 2)
          {
            TIFFClose(tiff);
            ThrowReaderException(CorruptImageError,"ImproperImageHeader");
          }
        for (i=0; i < (ssize_t) extra_samples; i++)
          {
            if (sample_info[i] == EXTRASAMPLE_UNSPECIFIED)
              continue;
            if (sample_info[i] == EXTRASAMPLE_ASSOCALPHA)
              image->alpha_trait=BlendPixelTrait;
            else
              if (sample_info[i] == EXTRASAMPLE_UNASSALPHA)
                image->alpha_trait=OpaquePixelTrait;
          }
      }
    if (photometric == PHOTOMETRIC_YCBCR)
      {
        if ((TIFFGetFieldDefaulted(tiff,TIFFTAG_YCBCRSUBSAMPLING,&value,&value) != 1) ||
            (value == 0))
          {
            TIFFClose(tiff);
            ThrowReaderException(CorruptImageError,"ImproperImageHeader");
          }
      }
    if (photometric == PHOTOMETRIC_CIELAB)
      {
        if (DecodeLabImage(image,exception) == MagickFalse)
          {
            TIFFClose(tiff);
            ThrowReaderException(CorruptImageError,"UnableToDecodeImage");
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PREDICTOR,&value) == 1)
      {
        if ((value != PREDICTOR_NONE) && (value != PREDICTOR_HORIZONTAL))
          {
            TIFFClose(tiff);
            ThrowReaderException(CorruptImageError,"UnsupportedPredictor");
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_COLORMAP,&min_sample_value,&max_sample_value,
        &sample_info) == 1)
      {
        if (min_sample_value > max_sample_value)
          {
            TIFFClose(tiff);
            ThrowReaderException(CorruptImageError,"ImproperImageHeader");
          }
        if (sample_info == (uint16 *) NULL)
          {
            TIFFClose(tiff);
            ThrowReaderException(CorruptImageError,"ImproperImageHeader");
          }
        if (image->colorspace == CMYKColorspace)
          {
            if (image->debug != MagickFalse)
              (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                "Colormap: CMYK");
            for (i=0; i < (ssize_t) (max_sample_value-min_sample_value+1); i++)
              {
                image->colormap[i].blue=QuantumRange-sample_info[i*3+0];
                image->colormap[i].green=QuantumRange-sample_info[i*3+1];
                image->colormap[i].red=QuantumRange-sample_info[i*3+2];
                image->colormap[i].index=i;
              }
          }
        else
          {
            if (image->debug != MagickFalse)
              (void) LogMagickEvent(CoderEvent,GetMagickModule(),
                "Colormap: RGB");
            for (i=0; i < (ssize_t) (max_sample_value-min_sample_value+1); i++)
              {
                image->colormap[i].red=sample_info[i*3+0];
                image->colormap[i].green=sample_info[i*3+1];
                image->colormap[i].blue=sample_info[i*3+2];
                image->colormap[i].index=i;
              }
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      (void) SetImageProperty(image,"tiff:software",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ARTIST,&value) == 1)
      (void) SetImageProperty(image,"tiff:artist",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_COPYRIGHT,&value) == 1)
      (void) SetImageProperty(image,"tiff:copyright",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_DATETIME,&value) == 1)
      (void) SetImageProperty(image,"tiff:timestamp",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_DOCUMENTNAME,&value) == 1)
      (void) SetImageProperty(image,"tiff:document",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_HOSTCOMPUTER,&value) == 1)
      (void) SetImageProperty(image,"tiff:hostcomputer",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_IMAGEDESCRIPTION,&value) == 1)
      (void) SetImageProperty(image,"comment",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MAKE,&value) == 1)
      (void) SetImageProperty(image,"tiff:make",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MODEL,&value) == 1)
      (void) SetImageProperty(image,"tiff:model",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_OPIIMAGEID,&value) == 1)
      (void) SetImageProperty(image,"tiff:image-id",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENAME,&value) == 1)
      (void) SetImageProperty(image,"label",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SOFTWARE,&value) == 1)
      (void) SetImageProperty(image,"tiff:software",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,33423,&value) == 1)
      (void) SetImageProperty(image,"tiff:kodak-33423",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,36867,&value) == 1)
      (void) SetImageProperty(image,"tiff:kodak-36867",(char *) value,exception);
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SUBFILETYPE,&value) == 1)
      {
        if (value == 0x01)
          (void) SetImageProperty(image,"tiff:subfiletype","REDUCEDIMAGE",
            exception);
        if (value == 0x02)
          (void) SetImageProperty(image,"tiff:subfiletype","PAGE",exception);
        if (value == 0x04)