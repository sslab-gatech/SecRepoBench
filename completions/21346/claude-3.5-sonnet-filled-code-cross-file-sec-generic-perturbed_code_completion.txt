if (memcmp(&packet->line[i].ptr[j], "SEND ", 5) == 0 ||
    memcmp(&packet->line[i].ptr[j], "CHAT ", 5) == 0 ||
    memcmp(&packet->line[i].ptr[j], "chat ", 5) == 0 ||
    memcmp(&packet->line[i].ptr[j], "sslchat ", 8) == 0 ||
    memcmp(&packet->line[i].ptr[j], "TSEND ", 6) == 0) {
  NDPI_LOG_DBG2(ndpi_struct, "found DCC SEND, CHAT, chat, sslchat, or TSEND");
  
  j += 5; // Advance past the command
  
  space = 0;
  for (; j < packet->line[i].len - 9; j++) {
    if (packet->line[i].ptr[j] == ' ') {
      space++;
      if (space == 3) {
        j++;
        port = 0;
        while (j < packet->line[i].len - 1 && packet->line[i].ptr[j] >= '0' && packet->line[i].ptr[j] <= '9') {
          port *= 10;
          port += packet->line[i].ptr[j] - '0';
          j++;
        }
        
        if (port > 0) {
          if (src_id != NULL) {
            less = -1;
            for (k = 0; k < src_id->irc_number_of_port; k++) {
              if (src_id->irc_port[k] == port) {
                src_id->last_time_port_used[k] = packet->tick_timestamp;
                less = 0;
                break;
              }
            }
            if (less == -1 && src_id->irc_number_of_port < IRC_MAX_PORTS) {
              src_id->irc_port[src_id->irc_number_of_port] = port;
              src_id->last_time_port_used[src_id->irc_number_of_port] = packet->tick_timestamp;
              src_id->irc_number_of_port++;
            } else if (less == -1) {
              for (k = 0; k < IRC_MAX_PORTS; k++) {
                if ((packet->tick_timestamp - src_id->last_time_port_used[k]) >
                    (packet->tick_timestamp - src_id->last_time_port_used[less])) {
                  less = k;
                }
              }
              if (less > -1) {
                src_id->irc_port[less] = port;
                src_id->last_time_port_used[less] = packet->tick_timestamp;
              }
            }
          }
          if (dst != NULL) {
            less = -1;
            for (k = 0; k < dst->irc_number_of_port; k++) {
              if (dst->irc_port[k] == port) {
                dst->last_time_port_used[k] = packet->tick_timestamp;
                less = 0;
                break;
              }
            }
            if (less == -1 && dst->irc_number_of_port < IRC_MAX_PORTS) {
              dst->irc_port[dst->irc_number_of_port] = port;
              dst->last_time_port_used[dst->irc_number_of_port] = packet->tick_timestamp;
              dst->irc_number_of_port++;
            } else if (less == -1) {
              for (k = 0; k < IRC_MAX_PORTS; k++) {
                if ((packet->tick_timestamp - dst->last_time_port_used[k]) >
                    (packet->tick_timestamp - dst->last_time_port_used[less])) {
                  less = k;
                }
              }
              if (less > -1) {
                dst->irc_port[less] = port;
                dst->last_time_port_used[less] = packet->tick_timestamp;
              }
            }
          }
        }
        break;
      }
    }
  }
}