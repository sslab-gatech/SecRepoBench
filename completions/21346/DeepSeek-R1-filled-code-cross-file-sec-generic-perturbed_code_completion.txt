if (memcmp(&packet->line[i].ptr[j], "SEND ", 5) == 0 || 
                  memcmp(&packet->line[i].ptr[j], "CHAT ", 5) == 0 ||
                  memcmp(&packet->line[i].ptr[j], "chat ", 5) == 0 ||
                  memcmp(&packet->line[i].ptr[j], "sslchat ", 8) == 0 ||
                  memcmp(&packet->line[i].ptr[j], "TSEND ", 6) == 0) {

                j += (memcmp(&packet->line[i].ptr[j], "sslchat ", 8) == 0) ? 8 :
                     (memcmp(&packet->line[i].ptr[j], "TSEND ", 6) == 0) ? 6 : 5;

                space = 0;
                for (k = j; k < packet->line[i].len && space < 3; k++) {
                  if (packet->line[i].ptr[k] == ' ') {
                    space++;
                    if (space == 3) {
                      k++;
                      port = 0;
                      while (k < packet->line[i].len && packet->line[i].ptr[k] >= '0' && packet->line[i].ptr[k] <= '9') {
                        port = port * 10 + (packet->line[i].ptr[k] - '0');
                        k++;
                      }
                      if (port > 0 && port <= 65535) {
                        struct ndpi_id_struct *target = (src_id != NULL) ? src_id : dst;
                        if (target != NULL) {
                          int found = 0, lru_idx = 0;
                          u_int32_t lru_ts = target->last_time_port_used[0];
                          
                          for (counter = 0; counter < target->irc_number_of_port; counter++) {
                            if (target->irc_port[counter] == port) {
                              found = 1;
                              target->last_time_port_used[counter] = packet->tick_timestamp;
                              break;
                            }
                            if (target->last_time_port_used[counter] < lru_ts) {
                              lru_ts = target->last_time_port_used[counter];
                              lru_idx = counter;
                            }
                          }

                          if (!found) {
                            if (target->irc_number_of_port < NDPI_MAX_IRC_PORTS) {
                              target->irc_port[target->irc_number_of_port] = port;
                              target->last_time_port_used[target->irc_number_of_port] = packet->tick_timestamp;
                              target->irc_number_of_port++;
                            } else if (target->irc_port[lru_idx] != port) {
                              target->irc_port[lru_idx] = port;
                              target->last_time_port_used[lru_idx] = packet->tick_timestamp;
                            }
                          }
                          
                          if (src_id != NULL)
                            src_id->irc_ts = packet->tick_timestamp;
                          if (dst != NULL)
                            dst->irc_ts = packet->tick_timestamp;
                        }
                      }
                      break;
                    }
                  }
                }
              }