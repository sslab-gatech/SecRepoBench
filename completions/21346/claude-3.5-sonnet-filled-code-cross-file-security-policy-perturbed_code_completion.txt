if (memcmp(&packet->line[i].ptr[j], "SEND ", 5) == 0 ||
    memcmp(&packet->line[i].ptr[j], "CHAT ", 5) == 0 ||
    memcmp(&packet->line[i].ptr[j], "chat ", 5) == 0 ||
    (j+7 < packet->line[i].len && memcmp(&packet->line[i].ptr[j], "sslchat", 7) == 0) ||
    memcmp(&packet->line[i].ptr[j], "TSEND ", 6) == 0) {
  NDPI_LOG_DBG2(ndpi_struct, "found DCC SEND, CHAT, chat, sslchat, or TSEND");
  
  for (k = j; k < packet->line[i].len - 1; k++) {
    if (packet->line[i].ptr[k] == ' ') {
      if (++space == 3) {
        k++;
        port = 0;
        while (k < packet->line[i].len - 1 && packet->line[i].ptr[k] >= '0' && packet->line[i].ptr[k] <= '9') {
          port *= 10;
          port += packet->line[i].ptr[k++] - '0';
        }
        if (port > 0) {
          if (src_id != NULL) {
            if (src_id->irc_number_of_port < 8) {
              for (h = 0; h < src_id->irc_number_of_port; h++) {
                if (src_id->irc_port[h] == port) {
                  src_id->last_time_port_used[h] = packet->tick_timestamp;
                  break;
                }
              }
              if (h == src_id->irc_number_of_port) {
                src_id->irc_port[src_id->irc_number_of_port] = port;
                src_id->last_time_port_used[src_id->irc_number_of_port] = packet->tick_timestamp;
                src_id->irc_number_of_port++;
              }
            } else {
              u_int32_t oldest_timestamp = 0;
              u_int16_t oldest_port_index = 0;
              for (h = 0; h < 8; h++) {
                if (src_id->last_time_port_used[h] < oldest_timestamp || h == 0) {
                  oldest_timestamp = src_id->last_time_port_used[h];
                  oldest_port_index = h;
                }
                if (src_id->irc_port[h] == port) {
                  src_id->last_time_port_used[h] = packet->tick_timestamp;
                  break;
                }
              }
              if (h == 8) {
                src_id->irc_port[oldest_port_index] = port;
                src_id->last_time_port_used[oldest_port_index] = packet->tick_timestamp;
              }
            }
          }
          if (dst != NULL) {
            if (dst->irc_number_of_port < 8) {
              for (h = 0; h < dst->irc_number_of_port; h++) {
                if (dst->irc_port[h] == port) {
                  dst->last_time_port_used[h] = packet->tick_timestamp;
                  break;
                }
              }
              if (h == dst->irc_number_of_port) {
                dst->irc_port[dst->irc_number_of_port] = port;
                dst->last_time_port_used[dst->irc_number_of_port] = packet->tick_timestamp;
                dst->irc_number_of_port++;
              }
            } else {
              u_int32_t oldest_timestamp = 0;
              u_int16_t oldest_port_index = 0;
              for (h = 0; h < 8; h++) {
                if (dst->last_time_port_used[h] < oldest_timestamp || h == 0) {
                  oldest_timestamp = dst->last_time_port_used[h];
                  oldest_port_index = h;
                }
                if (dst->irc_port[h] == port) {
                  dst->last_time_port_used[h] = packet->tick_timestamp;
                  break;
                }
              }
              if (h == 8) {
                dst->irc_port[oldest_port_index] = port;
                dst->last_time_port_used[oldest_port_index] = packet->tick_timestamp;
              }
            }
          }
        }
        break;
      }
    }
  }
}