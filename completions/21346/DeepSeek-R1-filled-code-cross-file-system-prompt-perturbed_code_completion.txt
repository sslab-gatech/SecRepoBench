if (memcmp(&packet->line[i].ptr[j], "SEND ", 5) == 0 ||
    memcmp(&packet->line[i].ptr[j], "CHAT ", 5) == 0 ||
    memcmp(&packet->line[i].ptr[j], "chat ", 5) == 0 ||
    memcmp(&packet->line[i].ptr[j], "sslchat ", 8) == 0 ||
    memcmp(&packet->line[i].ptr[j], "TSEND ", 6) == 0) {
    j += (memcmp(&packet->line[i].ptr[j], "sslchat ", 8) == 0) ? 8 :
         (memcmp(&packet->line[i].ptr[j], "TSEND ", 6) == 0) ? 6 : 5;

    int space_count = 0;
    u_int16_t port = 0;
    for (k = j; k < packet->line[i].len; k++) {
        if (packet->line[i].ptr[k] == ' ') {
            space_count++;
            if (space_count == 2) {
                char *port_start = &packet->line[i].ptr[k+1];
                char *port_end;
                port = (u_int16_t)strtoul(port_start, &port_end, 10);
                if (port_end > port_start && port != 0) {
                    struct ndpi_id_struct *target = (src_id != NULL) ? src_id : dst;
                    if (target != NULL) {
                        int found = 0;
                        for (counter = 0; counter < target->irc_number_of_port; counter++) {
                            if (target->irc_port[counter] == port) {
                                target->last_time_port_used[counter] = packet->tick_timestamp;
                                found = 1;
                                break;
                            }
                        }
                        if (!found) {
                            if (target->irc_number_of_port < 5) {
                                target->irc_port[target->irc_number_of_port] = port;
                                target->last_time_port_used[target->irc_number_of_port] = packet->tick_timestamp;
                                target->irc_number_of_port++;
                            } else {
                                u_int32_t oldest = target->last_time_port_used[0];
                                int lru_idx = 0;
                                for (counter = 1; counter < 5; counter++) {
                                    if (target->last_time_port_used[counter] < oldest) {
                                        oldest = target->last_time_port_used[counter];
                                        lru_idx = counter;
                                    }
                                }
                                if (target->irc_port[lru_idx] != port) {
                                    target->irc_port[lru_idx] = port;
                                    target->last_time_port_used[lru_idx] = packet->tick_timestamp;
                                }
                            }
                        }
                    }
                }
                break;
            }
        }
    }
}