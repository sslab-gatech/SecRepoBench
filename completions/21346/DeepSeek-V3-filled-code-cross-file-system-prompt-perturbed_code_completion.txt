if (memcmp(&packet->line[i].ptr[j], "SEND ", 5) == 0
    || memcmp(&packet->line[i].ptr[j], "CHAT ", 5) == 0
    || memcmp(&packet->line[i].ptr[j], "chat ", 5) == 0
    || memcmp(&packet->line[i].ptr[j], "sslchat ", 8) == 0
    || memcmp(&packet->line[i].ptr[j], "TSEND ", 6) == 0) {
  j += (packet->line[i].ptr[j] == 'T') ? 6 : (packet->line[i].ptr[j + 1] == 's') ? 8 : 5;
  space = 0;
  for (k = j; k < packet->line[i].len; k++) {
    if (packet->line[i].ptr[k] == ' ') {
      space++;
      if (space == 3) {
        k++;
        port = 0;
        while (k < packet->line[i].len && packet->line[i].ptr[k] >= '0' && packet->line[i].ptr[k] <= '9') {
          port = port * 10 + (packet->line[i].ptr[k] - '0');
          k++;
        }
        if (port != 0) {
          if (src_id != NULL) {
            less = 0;
            for (h = 0; h < src_id->irc_number_of_port; h++) {
              if (src_id->irc_port[h] == port) {
                less = 1;
                break;
              }
            }
            if (less == 0) {
              if (src_id->irc_number_of_port < NDPI_MAX_IRC_PORTS) {
                src_id->irc_port[src_id->irc_number_of_port] = port;
                src_id->last_time_port_used[src_id->irc_number_of_port] = packet->tick_timestamp;
                src_id->irc_number_of_port++;
              } else {
                u_int32_t min_ts = packet->tick_timestamp;
                u_int16_t min_idx = 0;
                for (h = 1; h < NDPI_MAX_IRC_PORTS; h++) {
                  if (src_id->last_time_port_used[h] < min_ts) {
                    min_ts = src_id->last_time_port_used[h];
                    min_idx = h;
                  }
                }
                if (src_id->irc_port[min_idx] != port) {
                  src_id->irc_port[min_idx] = port;
                  src_id->last_time_port_used[min_idx] = packet->tick_timestamp;
                }
              }
            }
            src_id->irc_ts = packet->tick_timestamp;
          }
          if (dst != NULL) {
            less = 0;
            for (h = 0; h < dst->irc_number_of_port; h++) {
              if (dst->irc_port[h] == port) {
                less = 1;
                break;
              }
            }
            if (less == 0) {
              if (dst->irc_number_of_port < NDPI_MAX_IRC_PORTS) {
                dst->irc_port[dst->irc_number_of_port] = port;
                dst->last_time_port_used[dst->irc_number_of_port] = packet->tick_timestamp;
                dst->irc_number_of_port++;
              } else {
                u_int32_t min_ts = packet->tick_timestamp;
                u_int16_t min_idx = 0;
                for (h = 1; h < NDPI_MAX_IRC_PORTS; h++) {
                  if (dst->last_time_port_used[h] < min_ts) {
                    min_ts = dst->last_time_port_used[h];
                    min_idx = h;
                  }
                }
                if (dst->irc_port[min_idx] != port) {
                  dst->irc_port[min_idx] = port;
                  dst->last_time_port_used[min_idx] = packet->tick_timestamp;
                }
              }
            }
            dst->irc_ts = packet->tick_timestamp;
          }
        }
        break;
      }
    }
  }
}