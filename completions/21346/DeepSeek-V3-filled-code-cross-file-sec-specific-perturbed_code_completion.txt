if (memcmp(&packet->line[i].ptr[j], "SEND ", 5) == 0
    || memcmp(&packet->line[i].ptr[j], "CHAT ", 5) == 0
    || memcmp(&packet->line[i].ptr[j], "chat ", 5) == 0
    || memcmp(&packet->line[i].ptr[j], "sslchat ", 8) == 0
    || memcmp(&packet->line[i].ptr[j], "TSEND ", 6) == 0) {
  j += (packet->line[i].ptr[j] == 'T') ? 6 : (packet->line[i].ptr[j+1] == 'S') ? 5 : 5;
  space = 0;
  while (j < packet->line[i].len && space < 3) {
    if (packet->line[i].ptr[j] == ' ') {
      space++;
    }
    j++;
  }
  if (space == 3 && j < packet->line[i].len) {
    port = 0;
    while (j < packet->line[i].len && packet->line[i].ptr[j] >= '0' && packet->line[i].ptr[j] <= '9') {
      port = port * 10 + (packet->line[i].ptr[j] - '0');
      j++;
    }
    if (port > 0) {
      if (src_id != NULL) {
        int found = 0;
        for (k = 0; k < src_id->irc_number_of_port; k++) {
          if (src_id->irc_port[k] == port) {
            found = 1;
            src_id->last_time_port_used[k] = packet->tick_timestamp;
            break;
          }
        }
        if (!found) {
          if (src_id->irc_number_of_port < NDPI_MAX_IRC_PORTS) {
            src_id->irc_port[src_id->irc_number_of_port] = port;
            src_id->last_time_port_used[src_id->irc_number_of_port] = packet->tick_timestamp;
            src_id->irc_number_of_port++;
          } else {
            u_int32_t min_ts = src_id->last_time_port_used[0];
            u_int16_t min_idx = 0;
            for (k = 1; k < NDPI_MAX_IRC_PORTS; k++) {
              if (src_id->last_time_port_used[k] < min_ts) {
                min_ts = src_id->last_time_port_used[k];
                min_idx = k;
              }
            }
            if (port != src_id->irc_port[min_idx]) {
              src_id->irc_port[min_idx] = port;
              src_id->last_time_port_used[min_idx] = packet->tick_timestamp;
            }
          }
        }
      }
      if (dst != NULL) {
        int found = 0;
        for (k = 0; k < dst->irc_number_of_port; k++) {
          if (dst->irc_port[k] == port) {
            found = 1;
            dst->last_time_port_used[k] = packet->tick_timestamp;
            break;
          }
        }
        if (!found) {
          if (dst->irc_number_of_port < NDPI_MAX_IRC_PORTS) {
            dst->irc_port[dst->irc_number_of_port] = port;
            dst->last_time_port_used[dst->irc_number_of_port] = packet->tick_timestamp;
            dst->irc_number_of_port++;
          } else {
            u_int32_t min_ts = dst->last_time_port_used[0];
            u_int16_t min_idx = 0;
            for (k = 1; k < NDPI_MAX_IRC_PORTS; k++) {
              if (dst->last_time_port_used[k] < min_ts) {
                min_ts = dst->last_time_port_used[k];
                min_idx = k;
              }
            }
            if (port != dst->irc_port[min_idx]) {
              dst->irc_port[min_idx] = port;
              dst->last_time_port_used[min_idx] = packet->tick_timestamp;
            }
          }
        }
      }
    }
  }
}