if (memcmp(&packet->line[i].ptr[j + 4], "SEND", 4) == 0
    || memcmp(&packet->line[i].ptr[j + 4], "CHAT", 4) == 0
    || memcmp(&packet->line[i].ptr[j + 4], "chat", 4) == 0
    || memcmp(&packet->line[i].ptr[j + 4], "sslchat", 7) == 0
    || (j+7 < packet->line[i].len && memcmp(&packet->line[i].ptr[j + 4], "TSEND", 5) == 0)) {
  j += 4;
  if (j+1 < packet->line[i].len && packet->line[i].ptr[j] =='') {
    j++;
    if (j+1 < packet->line[i].len && packet->line[i].ptr[j] =='') {
      j++;
      if (j+1 < packet->line[i].len && packet->line[i].ptr[j] =='') {
	j++;
	if (j+5 < packet->line[i].len && packet->line[i].ptr[j] >= '0' && packet->line[i].ptr[j] <= '9') {
	  port = 0;
	  for (k = j; k < packet->line[i].len && packet->line[i].ptr[k] >= '0' && packet->line[i].ptr[k] <= '9'; k++) {
	    port = port * 10 + packet->line[i].ptr[k] - '0';
	  }
	  if (src_id!= NULL) {
	    for (counter = 0; counter < src_id->irc_number_of_port; counter++) {
	      if (src_id->irc_port[counter] == port) {
		break;
	      }
	    }
	    if (counter == src_id->irc_number_of_port) {
	      if (src_id->irc_number_of_port < 10) {
		src_id->irc_port[src_id->irc_number_of_port] = port;
		src_id->irc_number_of_port++;
	      } else {
		less = 0;
		for (counter = 0; counter < src_id->irc_number_of_port; counter++) {
		  if (src_id->last_time_port_used[counter] < src_id->last_time_port_used[less]) {
		    less = counter;
		  }
		}
		src_id->irc_port[less] = port;
	      }
	    }
	  }
	  if (dst!= NULL) {
	    for (counter = 0; counter < dst->irc_number_of_port; counter++) {
	      if (dst->irc_port[counter] == port) {
		break;
	      }
	    }
	    if (counter == dst->irc_number_of_port) {
	      if (dst->irc_number_of_port < 10) {
		dst->irc_port[dst->irc_number_of_port] = port;
		dst->irc_number_of_port++;
	      } else {
		less = 0;
		for (counter = 0; counter < dst->irc_number_of_port; counter++) {
		  if (dst->last_time_port_used[counter] < dst->last_time_port_used[less]) {
		    less = counter;
		  }
		}
		dst->irc_port[less] = port;
	      }
	    }
	  }
	  if (src_id!= NULL) {
	    src_id->last_time_irc_activity = packet->tick_timestamp;
	  }
	  if (dst!= NULL) {
	    dst->last_time_irc_activity = packet->tick_timestamp;
	  }
	}
      }
    }
  }
}