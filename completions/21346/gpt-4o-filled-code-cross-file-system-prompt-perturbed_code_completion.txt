// Check for specific DCC commands and extract the port number
	      if (memcmp(&packet->line[i].ptr[j], "SEND ", 5) == 0 ||
		  memcmp(&packet->line[i].ptr[j], "CHAT ", 5) == 0 ||
		  memcmp(&packet->line[i].ptr[j], "chat ", 5) == 0 ||
		  memcmp(&packet->line[i].ptr[j], "sslchat ", 8) == 0 ||
		  memcmp(&packet->line[i].ptr[j], "TSEND ", 6) == 0) {
		j += 5;
		space = 0;
		while (j < packet->line[i].len && space < 3) {
		  if (packet->line[i].ptr[j] == ' ') {
		    space++;
		  }
		  j++;
		}
		if (space == 3) {
		  port = ntohl(get_u_int32_t(&packet->line[i].ptr[j]));
		  if (src_id != NULL) {
		    less = 0;
		    for (k = 0; k < src_id->irc_number_of_port; k++) {
		      if (src_id->irc_port[k] == port) {
			src_id->last_time_port_used[k] = packet->tick_timestamp;
			less = 1;
			break;
		      }
		    }
		    if (less == 0) {
		      if (src_id->irc_number_of_port < MAX_IRC_PORTS) {
			src_id->irc_port[src_id->irc_number_of_port] = port;
			src_id->last_time_port_used[src_id->irc_number_of_port] = packet->tick_timestamp;
			src_id->irc_number_of_port++;
		      } else {
			// Replace the least recently used port
			u_int16_t min_index = 0;
			for (k = 1; k < MAX_IRC_PORTS; k++) {
			  if (src_id->last_time_port_used[k] < src_id->last_time_port_used[min_index]) {
			    min_index = k;
			  }
			}
			src_id->irc_port[min_index] = port;
			src_id->last_time_port_used[min_index] = packet->tick_timestamp;
		      }
		    }
		  }
		  if (dst != NULL) {
		    less = 0;
		    for (k = 0; k < dst->irc_number_of_port; k++) {
		      if (dst->irc_port[k] == port) {
			dst->last_time_port_used[k] = packet->tick_timestamp;
			less = 1;
			break;
		      }
		    }
		    if (less == 0) {
		      if (dst->irc_number_of_port < MAX_IRC_PORTS) {
			dst->irc_port[dst->irc_number_of_port] = port;
			dst->last_time_port_used[dst->irc_number_of_port] = packet->tick_timestamp;
			dst->irc_number_of_port++;
		      } else {
			// Replace the least recently used port
			u_int16_t min_index = 0;
			for (k = 1; k < MAX_IRC_PORTS; k++) {
			  if (dst->last_time_port_used[k] < dst->last_time_port_used[min_index]) {
			    min_index = k;
			  }
			}
			dst->irc_port[min_index] = port;
			dst->last_time_port_used[min_index] = packet->tick_timestamp;
		      }
		    }
		  }
		}
	      }