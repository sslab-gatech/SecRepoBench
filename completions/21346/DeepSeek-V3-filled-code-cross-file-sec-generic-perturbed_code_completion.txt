if (memcmp(&packet->line[i].ptr[j], "SEND ", 5) == 0
    || memcmp(&packet->line[i].ptr[j], "CHAT ", 5) == 0
    || memcmp(&packet->line[i].ptr[j], "chat ", 5) == 0
    || memcmp(&packet->line[i].ptr[j], "sslchat ", 8) == 0
    || memcmp(&packet->line[i].ptr[j], "TSEND ", 6) == 0) {
  j += (packet->line[i].ptr[j] == 'T') ? 6 : (packet->line[i].ptr[j] == 's') ? 8 : 5;
  space = 0;
  for (k = j; k < packet->line[i].len - 1; k++) {
    if (packet->line[i].ptr[k] == ' ') {
      space++;
      if (space == 3) {
	k++;
	if (k < packet->line[i].len - 1) {
	  port = 0;
	  while (k < packet->line[i].len && packet->line[i].ptr[k] >= '0' && packet->line[i].ptr[k] <= '9') {
	    port = port * 10 + (packet->line[i].ptr[k] - '0');
	    k++;
	  }
	  if (port > 0) {
	    if (src_id != NULL) {
	      less = 0;
	      for (h = 0; h < src_id->irc_number_of_port; h++) {
		if (src_id->irc_port[h] == port) {
		  src_id->last_time_port_used[h] = packet->tick_timestamp;
		  break;
		}
		if (src_id->last_time_port_used[h] < src_id->last_time_port_used[less]) {
		  less = h;
		}
	      }
	      if (h == src_id->irc_number_of_port) {
		if (src_id->irc_number_of_port < NDPI_MAX_IRC_PORTS) {
		  src_id->irc_port[src_id->irc_number_of_port] = port;
		  src_id->last_time_port_used[src_id->irc_number_of_port] = packet->tick_timestamp;
		  src_id->irc_number_of_port++;
		} else {
		  src_id->irc_port[less] = port;
		  src_id->last_time_port_used[less] = packet->tick_timestamp;
		}
	      }
	    }
	    if (dst != NULL) {
	      less = 0;
	      for (h = 0; h < dst->irc_number_of_port; h++) {
		if (dst->irc_port[h] == port) {
		  dst->last_time_port_used[h] = packet->tick_timestamp;
		  break;
		}
		if (dst->last_time_port_used[h] < dst->last_time_port_used[less]) {
		  less = h;
		}
	      }
	      if (h == dst->irc_number_of_port) {
		if (dst->irc_number_of_port < NDPI_MAX_IRC_PORTS) {
		  dst->irc_port[dst->irc_number_of_port] = port;
		  dst->last_time_port_used[dst->irc_number_of_port] = packet->tick_timestamp;
		  dst->irc_number_of_port++;
		} else {
		  dst->irc_port[less] = port;
		  dst->last_time_port_used[less] = packet->tick_timestamp;
		}
	      }
	    }
	  }
	}
	break;
      }
    }
  }
}