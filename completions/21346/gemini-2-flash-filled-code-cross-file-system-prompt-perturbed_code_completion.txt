char *command = NULL;

	      if (memcmp(&packet->line[i].ptr[j], "SEND ", 5) == 0) {
		command = "SEND ";
		j += 5;
	      } else if (memcmp(&packet->line[i].ptr[j], "CHAT ", 5) == 0) {
		command = "CHAT ";
		j += 5;
	      } else if (memcmp(&packet->line[i].ptr[j], "chat ", 5) == 0) {
		command = "chat ";
		j += 5;
	      } else if (memcmp(&packet->line[i].ptr[j], "sslchat ", 8) == 0) {
		command = "sslchat ";
		j += 8;
	      } else if (memcmp(&packet->line[i].ptr[j], "TSEND ", 6) == 0) {
		command = "TSEND ";
		j += 6;
	      }

	      if (command != NULL) {
		int space_count = 0;
		int port_start = -1;

		for (; j < packet->line[i].len; j++) {
		  if (packet->line[i].ptr[j] == ' ') {
		    space_count++;
		    if (space_count == 3 && port_start == -1) {
		      port_start = j + 1;
		    } else if (space_count > 3 && port_start != -1) {
		      break;
		    }
		  }
		}

		if (port_start != -1) {
		  port = 0;
		  for (; port_start < packet->line[i].len && isdigit(packet->line[i].ptr[port_start]);
		       port_start++) {
		    port = port * 10 + (packet->line[i].ptr[port_start] - '0');
		  }

		  if (port > 0 && port < 65536) {
		    if (dst != NULL) {
		      less = 1;
		      for (counter = 0; counter < dst->irc_number_of_port; counter++) {
			if (dst->irc_port[counter] == port) {
			  less = 0;
			  break;
			}
		      }
		      if (dst->irc_number_of_port < NDPI_MAX_IRC_PORTS) {
			if (less) {
			  NDPI_LOG_DBG2(ndpi_struct, "add port to dst");
			  dst->irc_port[dst->irc_number_of_port] = port;
			  dst->last_time_port_used[dst->irc_number_of_port] =
			    packet->tick_timestamp;
			  dst->irc_number_of_port++;
			}
		      } else {
			u_int32_t oldest_time = packet->tick_timestamp;
			u_int8_t oldest_index = 0;

			for (counter = 0; counter < NDPI_MAX_IRC_PORTS; counter++) {
			  if (dst->last_time_port_used[counter] < oldest_time) {
			    oldest_time = dst->last_time_port_used[counter];
			    oldest_index = counter;
			  }
			}
			less = 1;
			for (counter = 0; counter < dst->irc_number_of_port; counter++) {
			  if (dst->irc_port[counter] == port) {
			    less = 0;
			    break;
			  }
			}
			if (less) {
			  NDPI_LOG_DBG2(ndpi_struct, "replace port to dst");
			  dst->irc_port[oldest_index] = port;
			  dst->last_time_port_used[oldest_index] = packet->tick_timestamp;
			}
		      }
		      dst->irc_ts = packet->tick_timestamp;
		    }
		    if (src_id != NULL) {
		      less = 1;
		      for (counter = 0; counter < src_id->irc_number_of_port; counter++) {
			if (src_id->irc_port[counter] == port) {
			  less = 0;
			  break;
			}
		      }
		      if (src_id->irc_number_of_port < NDPI_MAX_IRC_PORTS) {
			if (less) {
			  NDPI_LOG_DBG2(ndpi_struct, "add port to src");
			  src_id->irc_port[src_id->irc_number_of_port] = port;
			  src_id->last_time_port_used[src_id->irc_number_of_port] =
			    packet->tick_timestamp;
			  src_id->irc_number_of_port++;
			}
		      } else {
			u_int32_t oldest_time = packet->tick_timestamp;
			u_int8_t oldest_index = 0;

			for (counter = 0; counter < NDPI_MAX_IRC_PORTS; counter++) {
			  if (src_id->last_time_port_used[counter] < oldest_time) {
			    oldest_time = src_id->last_time_port_used[counter];
			    oldest_index = counter;
			  }
			}
			less = 1;
			for (counter = 0; counter < src_id->irc_number_of_port; counter++) {
			  if (src_id->irc_port[counter] == port) {
			    less = 0;
			    break;
			  }
			}
			if (less) {
			  NDPI_LOG_DBG2(ndpi_struct, "replace port to src");
			  src_id->irc_port[oldest_index] = port;
			  src_id->last_time_port_used[oldest_index] = packet->tick_timestamp;
			}
		      }
		      src_id->irc_ts = packet->tick_timestamp;
		    }
		  }
		}
	      }