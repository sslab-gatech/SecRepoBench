for (k = j + 4; k < packet->line[i].len; k++) {
  if (packet->line[i].ptr[k] =='') {
    space++;
    if (space == 3) {
      port = 0;
      for (h = k + 1; h < packet->line[i].len; h++) {
	if (packet->line[i].ptr[h] >= '0' && packet->line[i].ptr[h] <= '9') {
	  port = port * 10 + packet->line[i].ptr[h] - '0';
	} else {
	  break;
	}
      }
      if (port > 0 && port < 65536) {
	if (dst!= NULL) {
	  for (counter = 0; counter < dst->irc_number_of_port; counter++) {
	    if (dst->irc_port[counter] == port) {
	      break;
	    }
	  }
	  if (counter == dst->irc_number_of_port) {
	    if (dst->irc_number_of_port < 10) {
	      dst->irc_port[dst->irc_number_of_port] = port;
	      dst->last_time_port_used[dst->irc_number_of_port] = packet->tick_timestamp;
	      dst->irc_number_of_port++;
	    } else {
	      u_int16_t min = dst->last_time_port_used[0];
	      u_int16_t min_index = 0;
	      for (counter = 1; counter < dst->irc_number_of_port; counter++) {
		if (dst->last_time_port_used[counter] < min) {
		  min = dst->last_time_port_used[counter];
		  min_index = counter;
		}
	      }
	      if (packet->tick_timestamp - dst->last_time_port_used[min_index] > ndpi_struct->irc_timeout) {
		dst->irc_port[min_index] = port;
		dst->last_time_port_used[min_index] = packet->tick_timestamp;
	      }
	    }
	  }
	}
	if (src_id!= NULL) {
	  for (counter = 0; counter < src_id->irc_number_of_port; counter++) {
	    if (src_id->irc_port[counter] == port) {
	      break;
	    }
	  }
	  if (counter == src_id->irc_number_of_port) {
	    if (src_id->irc_number_of_port < 10) {
	      src_id->irc_port[src_id->irc_number_of_port] = port;
	      src_id->last_time_port_used[src_id->irc_number_of_port] = packet->tick_timestamp;
	      src_id->irc_number_of_port++;
	    } else {
	      u_int16_t min = src_id->last_time_port_used[0];
	      u_int16_t min_index = 0;
	      for (counter = 1; counter < src_id->irc_number_of_port; counter++) {
		if (src_id->last_time_port_used[counter] < min) {
		  min = src_id->last_time_port_used[counter];
		  min_index = counter;
		}
	      }
	      if (packet->tick_timestamp - src_id->last_time_port_used[min_index] > ndpi_struct->irc_timeout) {
		src_id->irc_port[min_index] = port;
		src_id->last_time_port_used[min_index] = packet->tick_timestamp;
	      }
	    }
	  }
	}
      }
    }
  }
}