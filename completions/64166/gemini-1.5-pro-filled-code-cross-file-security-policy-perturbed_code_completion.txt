if (DeviceLink == NULL) {
        cmsDeleteTransform(xform);
        return 0;
    }

    cmsPipelineSetFlags(DeviceLink, cmsFLAGS_FORCE_CLUT);

    if (!_cmsOptimizePipeline(DeviceLink, lDoBPC, lFixWhite, InFrm, OutputFormat)) {
        cmsPipelineFree(DeviceLink);
        cmsDeleteTransform(xform);
        return 0;
    }