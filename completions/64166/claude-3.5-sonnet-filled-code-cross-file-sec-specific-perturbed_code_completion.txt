if (DeviceLink == NULL) {
    cmsDeleteTransform(xform);
    return 0;
}
v->Lut = cmsPipelineDup(DeviceLink);
v->InputFormat = TYPE_Lab_DBL;
v->OutputFormat = OutputFormat;
v->EntryColorSpace = cmsGetColorSpace(hProfile);
v->ExitColorSpace = cmsGetPCS(hProfile);
v->RenderingIntent = AdjustedEncodingIntent;
v->dwOriginalFlags = 0;
v->core = NULL;
v->ContextID = m->ContextID;
v->GamutCheck = NULL;
v->Gamut = NULL;
v->UserData = NULL;
v->FreeUserData = NULL;
v->UseInputBuffer = FALSE;
v->UseOutputBuffer = FALSE;
v->InputBufferIsFloat = FALSE;
v->OutputBufferIsFloat = FALSE;
v->MemPool = NULL;
v->Lut->SaveAs8Bits = FALSE;
v->Lut->SaveAsFloat = FALSE;
cmsPipelineSetOptimizationParameters(DeviceLink, cmsFLAGS_FORCE_CLUT, cmsChangeBuffersFormat, NULL);
_cmsOptimizePipeline(m->ContextID, &DeviceLink, AdjustedEncodingIntent, &InFrm, &OutputFormat, &dwFlags);