// Check if the DeviceLink is NULL and deletes the transform if it is.
    // If the DeviceLink exists, it forces the use of a CLUT by setting the cmsFLAGS_FORCE_CLUT flag.
    // Proceeds to optimize the pipeline for color rendering using the _cmsOptimizePipeline function.
    if (DeviceLink == NULL) {
        cmsDeleteTransform(xform);
        return 0;
    }

    // Optimize the pipeline
    DeviceLink = _cmsOptimizePipeline(DeviceLink, cmsFLAGS_NOOPTIMIZE);

    // Check if the optimization was successful
    if (DeviceLink == NULL) {
        cmsDeleteTransform(xform);
        cmsSignalError(m->ContextID, cmsERROR_UNKNOWN_EXTENSION, "Failed to optimize pipeline");
        return 0;
    }

    // Force the use of a CLUT
    cmsSetProfileFlags(hProfile, cmsFLAGS_FORCE_CLUT);

    // Emit the optimized CLUT
    first = cmsPipelineGetPtrToFirstStage(DeviceLink);
    if (first != NULL) {
        WriteCLUT(m, first, "<", ">\n", "", "", lFixWhite, ColorSpace);
    }