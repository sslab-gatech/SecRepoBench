if (DeviceLink == NULL) {
        cmsDeleteTransform(xform);
        return 0;
    }

    if (!cmsPipelineIsLinear(DeviceLink)) {
        dwFlags |= cmsFLAGS_FORCE_CLUT;
    }

    if (!_cmsOptimizePipeline(DeviceLink, dwFlags)) {
        cmsPipelineFree(DeviceLink);
        cmsDeleteTransform(xform);
        return 0;
    }