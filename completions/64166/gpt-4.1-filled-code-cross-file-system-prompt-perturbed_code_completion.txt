if (DeviceLink == NULL) {
    cmsDeleteTransform(xform);
    cmsSignalError(m ->ContextID, cmsERROR_COLORSPACE_CHECK, "Cannot duplicate devicelink in CRD creation");
    return 0;
}

// Force CLUT
dwFlags |= cmsFLAGS_FORCE_CLUT;

// Optimize the pipeline for color rendering
if (!_cmsOptimizePipeline(DeviceLink, INTENT_PERCEPTUAL, &InFrm, &OutputFormat, &dwFlags)) {
    cmsPipelineFree(DeviceLink);
    cmsDeleteTransform(xform);
    cmsSignalError(m ->ContextID, cmsERROR_COLORSPACE_CHECK, "Cannot optimize pipeline in CRD creation");
    return 0;
}