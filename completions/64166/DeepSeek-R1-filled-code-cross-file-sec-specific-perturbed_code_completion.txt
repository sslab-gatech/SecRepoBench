if (DeviceLink == NULL) {
        cmsDeleteTransform(xform);
        return 0;
    }

    dwFlags |= cmsFLAGS_FORCE_CLUT;
    if (!_cmsOptimizePipeline(m->ContextID, &DeviceLink, AdjustedEncodingIntent, InFrm, OutputFormat, dwFlags)) {
        cmsPipelineFree(DeviceLink);
        cmsDeleteTransform(xform);
        return 0;
    }