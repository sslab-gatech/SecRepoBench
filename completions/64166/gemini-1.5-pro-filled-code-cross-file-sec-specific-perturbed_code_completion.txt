if (DeviceLink == NULL) {
        cmsDeleteTransform(xform);
        return 0;
    }

    cmsPipelineSetFlags(DeviceLink, cmsFLAGS_FORCE_CLUT);

    DeviceLink = _cmsOptimizePipeline(DeviceLink, lDoBPC, lFixWhite, InFrm, OutputFormat);
    if (DeviceLink == NULL) {
        cmsDeleteTransform(xform);
        return 0;
    }