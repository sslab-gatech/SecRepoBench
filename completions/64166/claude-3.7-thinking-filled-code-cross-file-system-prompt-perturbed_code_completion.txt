if (DeviceLink == NULL) {
    cmsDeleteTransform(xform);
    return 0;
}

// Force the use of CLUT
dwFlags |= cmsFLAGS_FORCE_CLUT;

// Optimize the pipeline for color rendering
_cmsOptimizePipeline(&DeviceLink, AdjustedEncodingIntent, &BlackPointAdaptedToD50, dwFlags);