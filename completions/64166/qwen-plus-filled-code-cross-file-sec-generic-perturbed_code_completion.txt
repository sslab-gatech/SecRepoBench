if (DeviceLink == NULL) {
    cmsDeleteTransform(xform);
    return 0;
}

dwFlags |= cmsFLAGS_FORCE_CLUT;

cmsPipelineOptimize(DeviceLink, NULL, dwFlags);