if (DeviceLink == NULL) {
        cmsDeleteTransform(xform);
        cmsSignalError(m->ContextID, cmsERROR_COLORSPACE_CHECK, "Cannot duplicate device link");
        return 0;
    }

    // Force the use of a CLUT
    dwFlags |= cmsFLAGS_FORCE_CLUT;

    // Optimize the pipeline
    if (!_cmsOptimizePipeline(DeviceLink, Intent, dwFlags, &OutputFormat, &OutputFormat, NULL)) {
        cmsPipelineFree(DeviceLink);
        cmsDeleteTransform(xform);
        cmsSignalError(m->ContextID, cmsERROR_COLORSPACE_CHECK, "Cannot optimize pipeline");
        return 0;
    }