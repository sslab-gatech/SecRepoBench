if (DeviceLink == NULL) {
    cmsDeleteTransform(xform);
    cmsSignalError(m->ContextID, cmsERROR_COLORSPACE_CHECK, "Cannot create devicelink");
    return 0;
}

// We want to make sure the LUT is presented as CLUT
cmsUInt32Number optimizeFlags = dwFlags | cmsFLAGS_FORCE_CLUT;
_cmsOptimizePipeline(&DeviceLink, AdjustedEncodingIntent, &InFrm, OutputFormat, optimizeFlags);