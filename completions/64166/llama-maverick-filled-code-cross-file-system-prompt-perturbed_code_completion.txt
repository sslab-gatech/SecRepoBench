if (DeviceLink == NULL) { 
    cmsDeleteTransform(xform);
    return 0;
}

cmsPipelineSetSaveAs8bitsFlag(DeviceLink, FALSE);
if (!_cmsOptimizePipeline(m->ContextID, DeviceLink, Intent, &InFrm, &OutputFormat, &dwFlags)) {
    cmsPipelineFree(DeviceLink);
    cmsDeleteTransform(xform);
    return 0;
}