if (DeviceLink == NULL) {
    cmsDeleteTransform(xform);
    return 0;
}

// Force the use of CLUT
dwFlags |= cmsFLAGS_FORCE_CLUT;

// Optimize pipeline
if (!_cmsOptimizePipeline(&DeviceLink, InFrm, OutputFormat, dwFlags)) {
    cmsPipelineFree(DeviceLink);
    cmsDeleteTransform(xform);
    return 0;
}