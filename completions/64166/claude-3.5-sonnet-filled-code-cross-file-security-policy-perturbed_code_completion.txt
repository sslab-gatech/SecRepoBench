if (DeviceLink == NULL) {
    cmsDeleteTransform(xform);
    return 0;
}

v->Lut = cmsPipelineDup(DeviceLink);
v->InputFormat = TYPE_Lab_DBL;
v->OutputFormat = OutputFormat;
v->dwOriginalFlags |= cmsFLAGS_FORCE_CLUT;

if (!_cmsOptimizePipeline(m->ContextID, &DeviceLink, AdjustedEncodingIntent, &InFrm, &OutputFormat, &dwFlags)) {
    cmsDeleteTransform(xform);
    cmsPipelineFree(DeviceLink);
    return 0;
}