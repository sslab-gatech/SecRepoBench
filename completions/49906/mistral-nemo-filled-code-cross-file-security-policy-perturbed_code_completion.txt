if(http_flow->guessed_host_protocol_id != NDPI_PROTOCOL_UNKNOWN) {
    if(http_flow->detected_protocol_stack[0] == NDPI_PROTOCOL_UNKNOWN) {
      http_flow->detected_protocol_stack[0] = http_flow->guessed_host_protocol_id;
    } else if(http_flow->detected_protocol_stack[0] != http_flow->guessed_host_protocol_id) {
      NDPI_LOG_WARN(ndpi_struct, "Mismatch between guessed host protocol and detected protocol\n");
    }

    if(http_flow->detected_protocol_stack[1] == NDPI_PROTOCOL_UNKNOWN) {
      http_flow->detected_protocol_stack[1] = http_flow->guessed_protocol_id;
    } else if(http_flow->detected_protocol_stack[1] != http_flow->guessed_protocol_id) {
      NDPI_LOG_WARN(ndpi_struct, "Mismatch between guessed protocol and detected protocol\n");
    }
  }