((http_flow->detected_protocol_stack[1] == NDPI_PROTOCOL_UNKNOWN)
         && (ndpi_int_http_guess_protocol(ndpi_struct, http_flow) == NDPI_PROTOCOL_UNKNOWN)) {
      http_flow->detected_protocol_stack[0] = http_flow->guessed_host_protocol_id;
      http_flow->detected_protocol_stack[1] = http_flow->guessed_protocol_id;
    } else if(http_flow->detected_protocol_stack[1] != NDPI_PROTOCOL_UNKNOWN) {
      if((http_flow->detected_protocol_stack[0] != http_flow->guessed_host_protocol_id)
	 || (http_flow->detected_protocol_stack[1] != http_flow->guessed_protocol_id)) {
	/* Mismatch */
	NDPI_LOG_ERR(ndpi_struct, "HTTP sub-protocol mismatch\n");
      }
    }