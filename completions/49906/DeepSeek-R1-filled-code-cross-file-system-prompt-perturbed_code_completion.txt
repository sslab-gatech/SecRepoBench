(http_flow->detected_protocol_stack[0] == NDPI_PROTOCOL_UNKNOWN) {
    http_flow->detected_protocol_stack[0] = http_flow->guessed_host_protocol_id;
    http_flow->detected_protocol_stack[1] = http_flow->guessed_protocol_id;
  } else {
    http_flow->guessed_host_protocol_id = http_flow->detected_protocol_stack[0];
    http_flow->guessed_protocol_id = http_flow->detected_protocol_stack[1];
  }