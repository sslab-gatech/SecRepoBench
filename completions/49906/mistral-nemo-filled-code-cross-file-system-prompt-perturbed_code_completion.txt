if(http_flow->detected_protocol_stack[0] == NDPI_PROTOCOL_UNKNOWN)
    ndpi_set_detected_protocol(ndpi_struct, http_flow, NDPI_PROTOCOL_HTTP, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DPI);

  if(http_flow->detected_protocol_stack[1] == NDPI_PROTOCOL_UNKNOWN) {
    if(http_flow->http_detected && packet->http_origin.len > 0) {
      ndpi_protocol_match_result ret_match;

      ndpi_match_host_subprotocol(ndpi_struct, http_flow,
                                  (char *)packet->http_origin.ptr,
                                  packet->http_origin.len,
                                  &ret_match,
                                  NDPI_PROTOCOL_HTTP);

      if(ret_match.guessed_protocol != NDPI_PROTOCOL_UNKNOWN) {
        ndpi_set_detected_protocol(ndpi_struct, http_flow, ret_match.guessed_protocol, NDPI_PROTOCOL_HTTP, NDPI_CONFIDENCE_DPI);
      }
    }
  }