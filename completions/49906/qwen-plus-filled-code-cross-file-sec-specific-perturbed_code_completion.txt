(http_flow->detected_protocol_stack[1] == NDPI_PROTOCOL_UNKNOWN) {
    if (http_flow->guessed_protocol_id != NDPI_PROTOCOL_UNKNOWN && !ndpi_has_subprotocol(http_flow->guessed_protocol_id)) {
      http_flow->detected_protocol_stack[0] = http_flow->guessed_host_protocol_id;
      http_flow->detected_protocol_stack[1] = http_flow->guessed_protocol_id;
    }
  } else if (http_flow->detected_protocol_stack[1] != NDPI_PROTOCOL_UNKNOWN) {
    if (http_flow->guessed_protocol_id != NDPI_PROTOCOL_UNKNOWN &&
        http_flow->guessed_host_protocol_id == http_flow->detected_protocol_stack[0] &&
        http_flow->guessed_protocol_id == http_flow->detected_protocol_stack[1]) {
      // Protocols match, no action needed
    } else {
      NDPI_LOG_WARN(ndpi_struct, "Guessed protocol does not match detected protocol stack.\n");
    }
  }