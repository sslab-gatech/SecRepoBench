(http_flow->detected_protocol_stack[1] == NDPI_PROTOCOL_UNKNOWN &&
 http_flow->guessed_protocol_id != NDPI_PROTOCOL_UNKNOWN &&
 !ndpi_protocol_has_subprotocol(&http_flow->guessed_protocol)) {
    http_flow->detected_protocol_stack[0] = http_flow->guessed_host_protocol;
    http_flow->detected_protocol_stack[1] = http_flow->guessed_protocol_id;
} else if(http_flow->detected_protocol_stack[1] != NDPI_PROTOCOL_UNKNOWN) {
    if(http_flow->guessed_protocol_id != http_flow->detected_protocol_stack[1] ||
       http_flow->guessed_host_protocol != http_flow->detected_protocol_stack[0]) {
        /* Handle mismatch between guessed and detected protocols */
        NDPI_LOG_INFO(ndpi_struct, "Mismatch in guessed and detected protocols. Guessed: %s/%s, Detected: %s/%s\n",
                      ndpi_get_proto_name(ndpi_struct, http_flow->guessed_host_protocol),
                      ndpi_get_proto_name(ndpi_struct, http_flow->guessed_protocol_id),
                      ndpi_get_proto_name(ndpi_struct, http_flow->detected_protocol_stack[0]),
                      ndpi_get_proto_name(ndpi_struct, http_flow->detected_protocol_stack[1]));
    }
}