if(http_flow->detected_protocol_stack[1] == NDPI_PROTOCOL_UNKNOWN) {
  /* If the second protocol in the stack is unknown, and the current guessed protocol has no subprotocols,
     set the first protocol in the stack to the guessed host protocol, and the second to the guessed protocol. */
  if(http_flow->guessed_protocol_id != NDPI_PROTOCOL_UNKNOWN) {
    if(http_flow->detected_protocol_stack[0] == NDPI_PROTOCOL_UNKNOWN) {
      http_flow->detected_protocol_stack[0] = NDPI_PROTOCOL_HTTP;
    }
    http_flow->detected_protocol_stack[1] = http_flow->guessed_protocol_id;
  }
} else {
  /* If the second protocol is already detected, ensure that the guessed protocol
     and guessed host protocol match the detected protocols in the stack. */
  if(http_flow->guessed_protocol_id == NDPI_PROTOCOL_UNKNOWN) {
    http_flow->guessed_protocol_id = http_flow->detected_protocol_stack[1];
  }
}