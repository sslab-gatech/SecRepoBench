(http_flow->guessed_host_protocol_id != NDPI_PROTOCOL_UNKNOWN)
       && (http_flow->guessed_protocol_id != NDPI_PROTOCOL_UNKNOWN)
       && (http_flow->detected_protocol_stack[1] == NDPI_PROTOCOL_UNKNOWN)
       && (ndpi_has_subprotocols(ndpi_struct, http_flow->guessed_protocol_id) == 0)) {
      http_flow->detected_protocol_stack[0] = http_flow->guessed_host_protocol_id;
      http_flow->detected_protocol_stack[1] = http_flow->guessed_protocol_id;
    } else if((http_flow->guessed_host_protocol_id != NDPI_PROTOCOL_UNKNOWN)
	      && (http_flow->guessed_protocol_id != NDPI_PROTOCOL_UNKNOWN)
	      && (http_flow->detected_protocol_stack[1] != NDPI_PROTOCOL_UNKNOWN)) {
      if((http_flow->detected_protocol_stack[0] != http_flow->guessed_host_protocol_id)
	 || (http_flow->detected_protocol_stack[1] != http_flow->guessed_protocol_id)) {
	NDPI_LOG_ERR(ndpi_struct, "Protocol mismatch: detected (%d, %d), guessed (%d, %d)\n",
		      http_flow->detected_protocol_stack[0], http_flow->detected_protocol_stack[1],
		      http_flow->guessed_host_protocol_id, http_flow->guessed_protocol_id);
      }
    }