if((flow->detected_protocol_stack[1] == NDPI_PROTOCOL_UNKNOWN)
   && (flow->guessed_host_protocol_id != NDPI_PROTOCOL_UNKNOWN)) {
  ndpi_set_detected_protocol(ndpi_struct, flow, flow->guessed_host_protocol_id,
                             flow->detected_protocol_stack[0],
                             NDPI_CONFIDENCE_DPI);
} else if((flow->detected_protocol_stack[1] != NDPI_PROTOCOL_UNKNOWN)
          && (flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)) {
  flow->guessed_host_protocol_id = flow->detected_protocol_stack[1];
}