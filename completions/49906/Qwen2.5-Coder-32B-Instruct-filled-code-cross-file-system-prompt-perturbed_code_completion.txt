if(http_flow->detected_protocol_stack[1] == NDPI_PROTOCOL_UNKNOWN) {
      if(http_flow->guessed_protocol_id != NDPI_PROTOCOL_UNKNOWN && !ndpi_has_subprotocols(http_flow->guessed_protocol_id)) {
        http_flow->detected_protocol_stack[0] = http_flow->guessed_host_protocol_id;
        http_flow->detected_protocol_stack[1] = http_flow->guessed_protocol_id;
      }
    } else {
      if(http_flow->detected_protocol_stack[0] != http_flow->guessed_host_protocol_id || http_flow->detected_protocol_stack[1] != http_flow->guessed_protocol_id) {
        // Handle mismatch between detected and guessed protocols
      }
    }