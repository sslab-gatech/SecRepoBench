if(flow->detected_protocol_stack[1] == NDPI_PROTOCOL_UNKNOWN) {
  flow->guessed_protocol_id = flow->detected_protocol_stack[0];
  flow->detected_protocol_stack[0] = http_flow->guessed_host_protocol_id;
  flow->detected_protocol_stack[1] = flow->guessed_protocol_id;
} else {
  if(flow->guessed_protocol_id!= flow->detected_protocol_stack[1]) {
    flow->guessed_protocol_id = flow->detected_protocol_stack[1];
    flow->detected_protocol_stack[1] = flow->guessed_host_protocol_id;
  }
}