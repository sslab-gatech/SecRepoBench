{
    plist_t new_dict = plist_new_dict();
    if (!new_dict) {
        plist_free(*plist);
        return PLIST_ERR_PARSE;
    }

    /* The previously parsed node is treated as the first key.
       It must be a string; if not, it is an error. */
    if ((*plist)->data == NULL || (*plist)->data->type != PLIST_STRING ||
        (*plist)->data->strval == NULL) {
        plist_free(*plist);
        plist_free(new_dict);
        return PLIST_ERR_PARSE;
    }
    char *key = strdup((*plist)->data->strval);
    if (!key) {
        plist_free(*plist);
        plist_free(new_dict);
        return PLIST_ERR_PARSE;
    }

    /* Advance past the '=' character */
    ctx.pos++;
    parse_skip_ws(&ctx);

    /* Parse the value associated with the first key */
    plist_t value_node = NULL;
    err = node_from_openstep(&ctx, &value_node);
    if (err != PLIST_ERR_SUCCESS || !value_node) {
        free(key);
        plist_free(*plist);
        plist_free(new_dict);
        return err ? err : PLIST_ERR_PARSE;
    }
    plist_dict_insert_item(new_dict, key, value_node);
    free(key);

    /* Continue parsing additional key=value pairs delimited by ';' */
    while (ctx.pos < ctx.end) {
        parse_skip_ws(&ctx);
        if (ctx.pos >= ctx.end || *ctx.pos != ';')
            break;
        ctx.pos++; // skip the ';'
        parse_skip_ws(&ctx);

        plist_t next_key = NULL;
        err = node_from_openstep(&ctx, &next_key);
        if (err != PLIST_ERR_SUCCESS || !next_key) {
            plist_free(new_dict);
            return err ? err : PLIST_ERR_PARSE;
        }
        if (next_key->data == NULL || next_key->data->type != PLIST_STRING ||
            next_key->data->strval == NULL) {
            plist_free(next_key);
            plist_free(new_dict);
            return PLIST_ERR_PARSE;
        }
        char *next_key_str = strdup(next_key->data->strval);
        plist_free(next_key);
        if (!next_key_str) {
            plist_free(new_dict);
            return PLIST_ERR_PARSE;
        }

        parse_skip_ws(&ctx);
        if (ctx.pos >= ctx.end || *ctx.pos != '=') {
            free(next_key_str);
            plist_free(new_dict);
            return PLIST_ERR_PARSE;
        }
        ctx.pos++; // skip '='
        parse_skip_ws(&ctx);

        plist_t next_value = NULL;
        err = node_from_openstep(&ctx, &next_value);
        if (err != PLIST_ERR_SUCCESS || !next_value) {
            free(next_key_str);
            plist_free(new_dict);
            return err ? err : PLIST_ERR_PARSE;
        }
        plist_dict_insert_item(new_dict, next_key_str, next_value);
        free(next_key_str);
        parse_skip_ws(&ctx);
    }

    plist_free(*plist);
    *plist = new_dict;
}