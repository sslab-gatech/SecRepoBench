long n = lengthy;
  bitint mask1 = MASK1, mask2 = MASK2, mask3 = MASK3;
  bitint *y = (bitint*)ys;
  bitint *x = (bitint*)xs;
  bitint a = *x;
  bitint b = (bitint)*(xs + m - 1);
  bitint c;

  if (m > n) return -1;

  /* Preprocessing */
  switch (m) {
    case 1:
      goto m1;
    case 2:
      goto m2;
    case 3:
      goto m3;
    case 4:
      goto m4;
    case 5:
      goto m5;
    case 6:
      goto m6;
    case 7:
      goto m7;
    case 8:
      goto m8;
    case 9:
      goto m9;
    case 10:
      goto m10;
    case 11:
      goto m11;
    case 12:
      goto m12;
    case 13:
      goto m13;
    case 14:
      goto m14;
    case 15:
      goto m15;
    case 16:
      goto m16;
  }

  while (n >= m) {
    c = *(y + (n - m) / sizeof(bitint));
    c &= mask2;
    c |= mask3;
    c ^= a;
    if ((c & mask1) == 0) {
      if (memcmp(xs + 1, ys + (n - m) / sizeof(bitint) * sizeof(bitint) + 1, m - 2) == 0) {
        if (b == (bitint)*(ys + n - 1)) {
          return (n - m) / sizeof(bitint) * sizeof(bitint);
        }
      }
    }
    n -= sizeof(bitint);
  }
  return -1;

m16:
  b = *x;
m15:
  b = *x;
m14:
  b = *x;
m13:
  b = *x;
m12:
  b = *x;
m11:
  b = *x;
m10:
  b = *x;
m9:
  b = *x;
m8:
  b = *x;
m7:
  b = *x;
m6:
  b = *x;
m5:
  b = *x;
m4:
  b = *x;
m3:
  b = *x;
m2:
  b = *x;
m1:;