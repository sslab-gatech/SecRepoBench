if (m < 1 || lengthy < m) {
    return -1;
  }

  const unsigned char *x = xs;
  const unsigned char *y = ys;
  const unsigned char *y_end = ys + lengthy - m + 1;

  bitint pattern = 0;
  for (long i = 0; i < m; i++) {
    pattern |= ((bitint)(x[i] & 0x7f)) << (i * 8);
  }

  while (y < y_end) {
    bitint block = 0;
    for (long i = 0; i < m; i++) {
      block |= ((bitint)(y[i] & 0x7f)) << (i * 8);
    }

    if (((block ^ pattern) & MASK2) == 0) {
      if (memcmp(x, y, m) == 0) {
        return y - ys;
      }
    }

    y++;
  }