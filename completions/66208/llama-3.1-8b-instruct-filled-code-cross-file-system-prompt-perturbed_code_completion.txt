if (mrb_lstat(mrb, (mrb_value)xs, &st) == -1)
  return -1;
if (S_ISREG(st.st_mode))
{
  mrb_value ys_obj = mrb_value(ys);
  mrb_value xs_obj = mrb_value(xs);
  mrb_value result = mrb_value(0);
  mrb_value len = mrb_value(lengthy);
  mrb_value m = mrb_value(m);

  if (mrb_funcall(mrb, ys_obj, mrb_intern_cstr(mrb, "length"), 0) == mrb_intern_cstr(mrb, "length"))
  {
    mrb_value len2 = mrb_funcall(mrb, ys_obj, mrb_intern_cstr(mrb, "length"), 0);
    if (mrb_funcall(mrb, len2, mrb_intern_cstr(mrb, ">="), 1, len) == mrb_true_value())
    {
      mrb_value start = mrb_value(0);
      mrb_value end = mrb_value(0);
      mrb_value step = mrb_value(1);

      if (mrb_funcall(mrb, xs_obj, mrb_intern_cstr(mrb, "length"), 0) == mrb_intern_cstr(mrb, "length"))
      {
        mrb_value len3 = mrb_funcall(mrb, xs_obj, mrb_intern_cstr(mrb, "length"), 0);
        if (mrb_funcall(mrb, len3, mrb_intern_cstr(mrb, ">="), 1, len) == mrb_true_value())
        {
          mrb_value i = mrb_value(0);
          mrb_value found = mrb_value(0);

          while (mrb_funcall(mrb, i, mrb_intern_cstr(mrb, "<"), 1, len) == mrb_true_value())
          {
            mrb_value j = mrb_value(0);
            mrb_value found2 = mrb_value(0);

            while (mrb_funcall(mrb, j, mrb_intern_cstr(mrb, "<"), 1, len) == mrb_true_value())
            {
              mrb_value k = mrb_value(0);
              mrb_value found3 = mrb_value(0);

              while (mrb_funcall(mrb, k, mrb_intern_cstr(mrb, "<"), 1, len) == mrb_true_value())
              {
                mrb_value cmp = mrb_funcall(mrb, mrb_funcall(mrb, xs_obj, mrb_intern_cstr(mrb, "[]"), 1, i), mrb_intern_cstr(mrb, "=="), 1, mrb_funcall(mrb, mrb_funcall(mrb, ys_obj, mrb_intern_cstr(mrb, "[]"), 1, j), mrb_intern_cstr(mrb, "+"), 1, k));
                if (mrb_funcall(mrb, cmp, mrb_intern_cstr(mrb, "=="), 1, mrb_value(0)) == mrb_true_value())
                {
                  found3 = mrb_value(1);
                  break;
                }
                k = mrb_funcall(mrb, k, mrb_intern_cstr(mrb, "+"), 1, mrb_value(1));
              }
              if (mrb_funcall(mrb, found3, mrb_intern_cstr(mrb, "=="), 1, mrb_value(1)) == mrb_true_value())
              {
                found2 = mrb_value(1);
                break;
              }
              j = mrb_funcall(mrb, j, mrb_intern_cstr(mrb, "+"), 1, mrb_value(1));
            }
            if (mrb_funcall(mrb, found2, mrb_intern_cstr(mrb, "=="), 1, mrb_value(1)) == mrb_true_value())
            {
              found = mrb_value(1);
              break;
            }
            i = mrb_funcall(mrb, i, mrb_intern_cstr(mrb, "+"), 1, mrb_value(1));
          }
          if (mrb_funcall(mrb, found, mrb_intern_cstr(mrb, "=="), 1, mrb_value(1)) == mrb_true_value())
          {
            result = mrb_funcall(mrb, mrb_funcall(mrb, ys_obj, mrb_intern_cstr(mrb, "[]"), 1, j), mrb_intern_cstr(mrb, "+"), 1, mrb_funcall(mrb, i, mrb_intern_cstr(mrb, "*"), 1, len));
            break;
          }
        }
      }
    }
  }
  return mrb_funcall(mrb, result, mrb_intern_cstr(mrb, "to_i"), 0);
}
else
{
  return -1;
}