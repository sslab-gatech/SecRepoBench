if (m < 1 || m > lengthy) return -1;

  bitint mask = 0;
  bitint pattern = 0;
  for (long i = 0; i < m; i++) {
    pattern = (pattern << 8) | xs[i];
    mask = (mask << 8) | 0xFF;
  }

  bitint last_byte_mask = MASK4 >> ((m - 1) * 8);
  bitint first_byte_mask = MASK3 >> ((m - 1) * 8);

  for (long i = 0; i <= lengthy - m; i++) {
    bitint block = *(bitint *)(ys + i) & mask;
    if ((block & last_byte_mask) == (pattern & last_byte_mask)) {
      if ((block & first_byte_mask) == (pattern & first_byte_mask)) {
        if (memcmp(xs, ys + i, m) == 0) {
          return i;
        }
      }
    }
  }