bitint *p1 = (bitint*)xs;
  bitint *p2 = (bitint*)ys;
  bitint x = *p1 & MASK2;
  bitint xor;
  long i, j;

  for (i = 0; i < lengthy - m + 1; i++) {
    xor = x ^ (*p2 & MASK2);
    if ((((xor - MASK1) & ~xor) & MASK3) == 0) {
      for (j = 0; j < m; j++) {
        if (xs[j] != ys[i + j]) break;
      }
      if (j == m) return i;
    }
    p2 = (bitint*)(ys + i + 1);
  }