bitint *p = (bitint *)ys;
  bitint *end = (bitint *)(ys + lengthy - m + 1);
  bitint mask = MASK1;
  bitint cmp_mask = MASK4;

  while (p < end) {
    bitint data = *p;
    bitint cmp = (data ^ cmp_mask) & ~mask;

    if ((cmp - MASK2) & ~cmp) {
      const unsigned char *q = xs;
      long index = (p - (bitint *)ys) * sizeof(bitint);
      while (*q && (index < lengthy) && (ys[index] == *q)) {
        index++;
        q++;
      }
      if (!*q) {
        return index - m;
      }
    }
    p++;
  }