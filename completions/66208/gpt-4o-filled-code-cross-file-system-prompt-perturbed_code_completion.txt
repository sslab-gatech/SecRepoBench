if (m == 0) return 0;
  if (m > lengthy) return -1;

  const unsigned char *xe = xs + m;
  const unsigned char *ye = ys + lengthy - m + 1;
  bitint v, eq, diff;

  while (ys < ye) {
    v = *(const bitint *)ys;
    eq = v ^ *(const bitint *)xs;
    diff = (eq - MASK1) & ~eq & MASK2;
    if (diff == 0) {
      const unsigned char *x = xs;
      const unsigned char *y = ys;
      while (x < xe && *x == *y) {
        x++;
        y++;
      }
      if (x == xe) return ys - (const unsigned char *)ys;
    }
    ys++;
  }