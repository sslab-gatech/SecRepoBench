long i, j;
bitint mask1 = MASK1, mask2 = MASK2, mask3 = MASK3, mask4 = MASK4;
const unsigned char *x = xs;
const unsigned char *y = ys;
long len = m;

if (lengthy < len) return -1;

for (i = 0; i < len; i++) {
  mask1 &= (bitint)(x[i] << 8 | x[i]);
}

for (j = 0; j <= lengthy - len; j++) {
  bitint b1 = (bitint)(y[j + len - 1] | (y[j + len - 1] << 8));
  bitint b2 = 0;

  for (i = 0; i < len; i++) {
    b2 |= (bitint)(y[j + i] ^ x[i]);
  }

  if ((b1 & mask4) == 0 && (b2 & ~mask1) == 0) {
    bitint b3 = 0;
    for (i = 0; i < len; i++) {
      b3 |= (bitint)((y[j + i] & mask2) - mask3);
    }
    if (b3 == 0) return j;
  }
}