long i, j;
  bitint mask;
  bitint c;

  if (lengthy < m) return -1;

  /* Preprocessing */
  mask = ~((bitint)0);
  for (i = 0; i < m; ++i) {
    mask &= ~(MASK1 * xs[i]);
  }

  /* Searching */
  j = 0;
  while (j <= lengthy - m) {
    c = *(bitint *)(ys + j);
    if ((c & mask) == 0) {
      for (i = 0; i < m; ++i) {
        if (xs[i] != ys[i + j])
          goto next;
      }
      return j;
    next:;
    }
    if (m > 1 && ((c + MASK2) & MASK3 & c) == 0) {
      j += m;
    }
    else if (m > 0 && ((c + MASK2) & MASK3 & c & MASK4) == 0) {
      j += m - 1;
    }
    else {
      j++;
    }
  }