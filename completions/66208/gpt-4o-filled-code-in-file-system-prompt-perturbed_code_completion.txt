const unsigned char *y = ys;
  bitint v, d, mask;
  long i, j, k, shift;

  if (m < 1 || lengthy < 1) return -1;
  if (m == 1) {
    for (i = 0; i < lengthy; i++) {
      if (ys[i] == xs[0]) return i;
    }
    return -1;
  }

  /* initialize the bit mask */
  mask = 0;
  for (i = 0; i < m; i++) {
    mask |= (bitint)1 << (xs[i] & (sizeof(bitint) * 8 - 1));
  }

  /* search for the first occurrence */
  for (i = 0; i <= lengthy - m; i += sizeof(bitint)) {
    v = *(bitint *)(y + i);
    if ((v & mask) == 0) continue;

    for (j = 0; j < sizeof(bitint); j++) {
      if (i + j > lengthy - m) break;
      if (ys[i + j] == xs[0]) {
        for (k = 1; k < m; k++) {
          if (ys[i + j + k] != xs[k]) break;
        }
        if (k == m) return i + j;
      }
    }
  }

  /* check the remaining bytes */
  for (i = lengthy - m + 1; i < lengthy; i++) {
    if (ys[i] == xs[0]) {
      for (j = 1; j < m; j++) {
        if (ys[i + j] != xs[j]) break;
      }
      if (j == m) return i;
    }
  }