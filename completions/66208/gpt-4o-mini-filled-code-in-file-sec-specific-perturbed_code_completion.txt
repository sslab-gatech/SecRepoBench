const unsigned char *p = xs;
  const unsigned char *end = ys + lengthy;
  const unsigned char *last_match = NULL;
  const unsigned char *last_p = NULL;
  long i, j;

  for (i = 0; i <= lengthy - m; i++) {
    for (j = 0; j < m; j++) {
      if (xs[j] != ys[i + j]) {
        break;
      }
    }
    if (j == m) {
      last_match = ys + i;
      last_p = last_match;
    }
  }

  if (last_match) {
    return (mrb_int)(last_match - ys);
  }