if (m <= 0 || lengthy <= 0 || m > lengthy) return -1;
  if (m == 1) {
    const unsigned char c = xs[0];
    const unsigned char *p = ys;
    for (long i = 0; i < lengthy; i++) {
      if (*p == c) return i;
      p++;
    }
    return -1;
  }
  if (m <= sizeof(bitint)) {
    bitint x = 0, y = 0;
    for (int i = 0; i < m; i++) {
#if defined(MRB_ENDIAN_BIG)
      x = (x << 8) | xs[i];
      y = (y << 8) | ys[i];
#else
      x |= (bitint)xs[i] << (i * 8);
      y |= (bitint)ys[i] << (i * 8);
#endif
    }
    if (x == y) return 0;
    for (long i = m; i < lengthy; i++) {
#if defined(MRB_ENDIAN_BIG)
      y <<= 8;
      y |= ys[i];
      y &= ~(bitint)ys[i - m] << (sizeof(bitint) * 8 - 8);
#else
      y >>= 8;
      y |= (bitint)ys[i] << ((m - 1) * 8);
#endif
      if (x == y) return i - m + 1;
    }
  }
  else {
    for (long i = 0; i <= lengthy - m; i++) {
      if (memcmp(xs, ys + i, m) == 0) return i;
    }
  }