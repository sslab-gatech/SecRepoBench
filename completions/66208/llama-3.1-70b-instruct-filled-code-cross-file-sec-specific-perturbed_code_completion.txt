bitint *xs1 = (bitint *)malloc((m + 7) / 8 * sizeof(bitint));
bitint *ys1 = (bitint *)malloc((lengthy + 7) / 8 * sizeof(bitint));
bitint *xs2 = (bitint *)malloc((m + 7) / 8 * sizeof(bitint));
bitint *ys2 = (bitint *)malloc((lengthy + 7) / 8 * sizeof(bitint));

for (long i = 0; i < (m + 7) / 8; i++) {
  xs1[i] = 0;
  xs2[i] = 0;
}

for (long i = 0; i < m; i++) {
  xs1[i / 8] |= (bitint)(xs[i] & 1) << (i % 8);
  xs2[i / 8] |= (bitint)(xs[i] & 0x80) << (i % 8);
}

for (long i = 0; i < (lengthy + 7) / 8; i++) {
  ys1[i] = 0;
  ys2[i] = 0;
}

for (long i = 0; i < lengthy; i++) {
  ys1[i / 8] |= (bitint)(ys[i] & 1) << (i % 8);
  ys2[i / 8] |= (bitint)(ys[i] & 0x80) << (i % 8);
}

for (long i = 0; i <= lengthy - m; i++) {
  bitint t1 = 0, t2 = 0;
  for (long j = 0; j < (m + 7) / 8; j++) {
    t1 |= (ys1[i + j] ^ xs1[j]) & MASK2;
    t2 |= (ys2[i + j] ^ xs2[j]) & MASK2;
  }
  if ((t1 | t2) == 0) {
    free(xs1);
    free(ys1);
    free(xs2);
    free(ys2);
    return i;
  }
}

free(xs1);
free(ys1);
free(xs2);
free(ys2);