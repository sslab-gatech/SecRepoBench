if (m <= 0) return 0;
  if (lengthy < m) return -1;
  
  // Special case for single byte search
  if (m == 1) {
    unsigned char ch = xs[0];
    for (long i = 0; i < lengthy; i++) {
      if (ys[i] == ch) return i;
    }
    return -1;
  }
  
  const unsigned char *x = xs;
  const unsigned char *y = ys;
  const unsigned char first = x[0];
  
  // Main search loop
  for (long i = 0; i <= lengthy - m; i++) {
    // Fast check for the first byte
    if (y[i] == first) {
      // Potential match, verify the rest
      long j;
      for (j = 1; j < m; j++) {
        if (y[i + j] != x[j]) break;
      }
      if (j == m) return i;
    }
  }