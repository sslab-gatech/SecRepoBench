bitint mask;
  const unsigned char *x = xs, *y = ys;
  long n = lengthy - m + 1;
  int i, j;

  if (m > lengthy) return -1;
  if (!m) return 0;
  if (m < sizeof(bitint)) {
    for (i = 0; i < n; ++i) {
      if (memcmp(x, y + i, m) == 0)
        return i;
    }
    return -1;
  }

  mask = 0;
  for (i = 0; i < m; ++i)
    mask |= (bitint)x[i] << (8 * (sizeof(bitint) - 1 - i % sizeof(bitint)));

  for (i = 0; i < n; i += sizeof(bitint)) {
    bitint val = *(bitint *)(y + i);
    val ^= mask;
    if ((((val - MASK1) & ~val) & MASK3) == 0) {
      for (j = 0; j < m; ++j) {
        if (x[j] != y[i + j]) break;
      }
      if (j == m) return i;
    }
  }

  for (; i < n; ++i) {
    if (memcmp(x, y + i, m) == 0)
      return i;
  }