if (m <= 0 || lengthy <= 0 || m > lengthy) {
    return -1; // Invalid input or no possible match
  }

  const unsigned char *end = ys + lengthy - m + 1;
  bitint pattern = 0;
  bitint mask = MASK1;

  // Build the pattern for the first m bytes of xs
  for (long i = 0; i < m; i++) {
    pattern = (pattern << 8) | (xs[i] & 0xFF);
    mask = (mask << 8) | MASK1;
  }

  while (ys < end) {
    bitint window = 0;

    // Build the current window of m bytes
    for (long i = 0; i < m; i++) {
      window = (window << 8) | (ys[i] & 0xFF);
    }

    // Compare the window with the pattern
    if ((window & mask) == pattern) {
      return ys - (ys + lengthy - m + 1); // Return the index of the match
    }

    ys++;
  }