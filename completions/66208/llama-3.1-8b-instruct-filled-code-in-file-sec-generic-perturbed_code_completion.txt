static inline mrb_int
mrb_memsearch_ss(const unsigned char *xs, long m, const unsigned char *ys, long lengthy)
{
#ifdef MRB_64BIT
#define bitint uint64_t
#define MASK1 0x0101010101010101ull
#define MASK2 0x7f7f7f7f7f7f7f7full
#define MASK3 0x8080808080808080ull
#else
#define bitint uint32_t
#define MASK1 0x01010101ul
#define MASK2 0x7f7f7f7ful
#define MASK3 0x80808080ul
#endif
#if defined(MRB_ENDIAN_BIG)
#ifdef MRB_64BIT
#define MASK4 0x8000000000000000ull
#else
#define MASK4 0x80000000ul
#endif
#else
#define MASK4 0x80
#endif

// This function performs a substring search using a bit manipulation technique.
// It returns the byte index of the first occurrence of `xs` in `ys`.
  const unsigned char *p = ys;
  const unsigned char *pend = ys + lengthy;
  const unsigned char *s = xs;
  const unsigned char *send = xs + m;
  const unsigned char *t;
  const unsigned char *tend;
  const unsigned char *tend2;
  const unsigned char *tend3;
  const unsigned char *tend4;
  const unsigned char *tend5;
  const unsigned char *tend6;
  const unsigned char *tend7;
  const unsigned char *tend8;
  const unsigned char *tend9;
  const unsigned char *tend10;
  const unsigned char *tend11;
  const unsigned char *tend12;
  const unsigned char *tend13;
  const unsigned char *tend14;
  const unsigned char *tend15;
  const unsigned char *tend16;
  const unsigned char *tend17;
  const unsigned char *tend18;
  const unsigned char *tend19;
  const unsigned char *tend20;
  const unsigned char *tend21;
  const unsigned char *tend22;
  const unsigned char *tend23;
  const unsigned char *tend24;
  const unsigned char *tend25;
  const unsigned char *tend26;
  const unsigned char *tend27;
  const unsigned char *tend28;
  const unsigned char *tend29;
  const unsigned char *tend30;
  const unsigned char *tend31;
  const unsigned char *tend32;
  const unsigned char *tend33;
  const unsigned char *tend34;
  const unsigned char *tend35;
  const unsigned char *tend36;
  const unsigned char *tend37;
  const unsigned char *tend38;
  const unsigned char *tend39;
  const unsigned char *tend40;
  const unsigned char *tend41;
  const unsigned char *tend42;
  const unsigned char *tend43;
  const unsigned char *tend44;
  const unsigned char *tend45;
  const unsigned char *tend46;
  const unsigned char *tend47;
  const unsigned char *tend48;
  const unsigned char *tend49;
  const unsigned char *tend50;
  const unsigned char *tend51;
  const unsigned char *tend52;
  const unsigned char *tend53;
  const unsigned char *tend54;
  const unsigned char *tend55;
  const unsigned char *tend56;
  const unsigned char *tend57;
  const unsigned char *tend58;
  const unsigned char *tend59;
  const unsigned char *tend60;
  const unsigned char *tend61;
  const unsigned char *tend62;
  const unsigned char *tend63;
  const unsigned char *tend64;
  const unsigned char *tend65;
  const unsigned char *tend66;
  const unsigned char *tend67;
  const unsigned char *tend68;
  const unsigned char *tend69;
  const unsigned char *tend70;
  const unsigned char *tend71;
  const unsigned char *tend72;
  const unsigned char *tend73;
  const unsigned char *tend74;
  const unsigned char *tend75;
  const unsigned char *tend76;
  const unsigned char *tend77;
  const unsigned char *tend78;
  const unsigned char *tend79;
  const unsigned char *tend80;
  const unsigned char *tend81;
  const unsigned char *tend82;
  const unsigned char *tend83;
  const unsigned char *tend84;
  const unsigned char *tend85;
  const unsigned char *tend86;
  const unsigned char *tend87;
  const unsigned char *tend88;
  const unsigned char *tend89;
  const unsigned char *tend90;
  const unsigned char *tend91;
  const unsigned char *tend92;
  const unsigned char *tend93;
  const unsigned char *tend94;
  const unsigned char *tend95;
  const unsigned char *tend96;
  const unsigned char *tend97;
  const unsigned char *tend98;
  const unsigned char *tend99;
  const unsigned char *tend100;
  const unsigned char *tend101;
  const unsigned char *tend102;
  const unsigned char *tend103;
  const unsigned char *tend104;
  const unsigned char *tend105;
  const unsigned char *tend106;
  const unsigned char *tend107;
  const unsigned char *tend108;
  const unsigned char *tend109;
  const unsigned char *tend110;
  const unsigned char *tend111;
  const unsigned char *tend112;
  const unsigned char *tend113;
  const unsigned char *tend114;
  const unsigned char *tend115;
  const unsigned char *tend116;
  const unsigned char *tend117;
  const unsigned char *tend118;
  const unsigned char *tend119;
  const unsigned char *tend120;
  const unsigned char *tend121;
  const unsigned char *tend122;
  const unsigned char *tend123;
  const unsigned char *tend124;
  const unsigned char *tend125;
  const unsigned char *tend126;
  const unsigned char *tend127;
  const unsigned char *tend128;
  const unsigned char *tend129;
  const unsigned char *tend130;
  const unsigned char *tend131;
  const unsigned char *tend132;
  const unsigned char *tend133;
  const unsigned char *tend134;
  const unsigned char *tend135;
  const unsigned char *tend136;
  const unsigned char *tend137;
  const unsigned char *tend138;
  const unsigned char *tend139;
  const unsigned char *tend140;
  const unsigned char *tend141;
  const unsigned char *tend142;
  const unsigned char *tend143;
  const unsigned char *tend144;
  const unsigned char *tend145;
  const unsigned char *tend146;
  const unsigned char *tend147;
  const unsigned char *tend148;
  const unsigned char *tend149;
  const unsigned char *tend150;
  const unsigned char *tend151;
  const unsigned char *tend152;
  const unsigned char *tend153;
  const unsigned char *tend154;
  const unsigned char *tend155;
  const unsigned char *tend156;
  const unsigned char *tend157;
  const unsigned char *tend158;
  const unsigned char *tend159;
  const unsigned char *tend160;
  const unsigned char *tend161;
  const unsigned char *tend162;
  const unsigned char *tend163;
  const unsigned char *tend164;
  const unsigned char *tend165;
  const unsigned char *tend166;
  const unsigned char *tend167;
  const unsigned char *tend168;
  const unsigned char *tend169;
  const unsigned char *tend170;
  const unsigned char *tend171;
  const unsigned char *tend172;
  const unsigned char *tend173;
  const unsigned char *tend174;
  const unsigned char *tend175;
  const unsigned char *tend176;
  const unsigned char *tend177;
  const unsigned char *tend178;
  const unsigned char *tend179;
  const unsigned char *tend180;
  const unsigned char *tend181;
  const unsigned char *tend182;
  const unsigned char *tend183;
  const unsigned char *tend184;
  const unsigned char *tend185;
  const unsigned char *tend186;
  const unsigned char *tend187;
  const unsigned char *tend188;
  const unsigned char *tend189;
  const unsigned char *tend190;
  const unsigned char *tend191;
  const unsigned char *tend192;
  const unsigned char *tend193;
  const unsigned char *tend194;
  const unsigned char *tend195;
  const unsigned char *tend196;
  const unsigned char *tend197;
  const unsigned char *tend198;
  const unsigned char *tend199;
  const unsigned char *tend200;
  const unsigned char *tend201;
  const unsigned char *tend202;
  const unsigned char *tend203;
  const unsigned char *tend204;
  const unsigned char *tend205;
  const unsigned char *tend206;
  const unsigned char *tend207;
  const unsigned char *tend208;
  const unsigned char *tend209;
  const unsigned char *tend210;
  const unsigned char *tend211;
  const unsigned char *tend212;
  const unsigned char *tend213;
  const unsigned char *tend214;
  const unsigned char *tend215;
  const unsigned char *tend216;
  const unsigned char *tend217;
  const unsigned char *tend218;
  const unsigned char *tend219;
  const unsigned char *tend220;
  const unsigned char *tend221;
  const unsigned char *tend222;
  const unsigned char *tend223;
  const unsigned char *tend224;
  const unsigned char *tend225;
  const unsigned char *tend226;
  const unsigned char *tend227;
  const unsigned char *tend228;
  const unsigned char *tend229;
  const unsigned char *tend230;
  const unsigned char *tend231;
  const unsigned char *tend232;
  const unsigned char *tend233;
  const unsigned char *tend234;
  const unsigned char *tend235;
  const unsigned char *tend236;
  const unsigned char *tend237;
  const unsigned char *tend238;
  const unsigned char *tend239;
  const unsigned char *tend240;
  const unsigned char *tend241;
  const unsigned char *tend242;
  const unsigned char *tend243;
  const unsigned char *tend244;
  const unsigned char *tend245;
  const unsigned char *tend246;
  const unsigned char *tend247;
  const unsigned char *tend248;
  const unsigned char *tend249;
  const unsigned char *tend250;
  const unsigned char *tend251;
  const unsigned char *tend252;
  const unsigned char *tend253;
  const unsigned char *tend254;
  const unsigned char *tend255;
  const unsigned char *tend256;
  const unsigned char *tend257;
  const unsigned char *tend258;
  const unsigned char *tend259;
  const unsigned char *tend260;
  const unsigned char *tend261;
  const unsigned char *tend262;
  const unsigned char *tend263;
  const unsigned char *tend264;
  const unsigned char *tend265;
  const unsigned char *tend266;
  const unsigned char *tend267;
  const unsigned char *tend268;
  const unsigned char *tend269;
  const unsigned char *tend270;
  const unsigned char *tend271;
  const unsigned char *tend272;
  const unsigned char *tend273;
  const unsigned char *tend274;
  const unsigned char *tend275;
  const unsigned char *tend276;
  const unsigned char *tend277;
  const unsigned char *tend278;
  const unsigned char *tend279;
  const unsigned char *tend280;
  const unsigned char *tend281;
  const unsigned char *tend282;
  const unsigned char *tend283;
  const unsigned char *tend284;
  const unsigned char *tend285;
  const unsigned char *tend286;
  const unsigned char *tend287;
  const unsigned char *tend288;
  const unsigned char *tend289;
  const unsigned char *tend290;
  const unsigned char *tend291;
  const unsigned char *tend292;
  const unsigned char *tend293;
  const unsigned char *tend294;
  const unsigned char *tend295;
  const unsigned char *tend296;
  const unsigned char *tend297;
  const unsigned char *tend298;
  const unsigned char *tend299;
  const unsigned char *tend300;
  const unsigned char *tend301;
  const unsigned char *tend302;
  const unsigned char *tend303;
  const unsigned char *tend304;
  const unsigned char *tend305;
  const unsigned char *tend306;
  const unsigned char *tend307;
  const unsigned char *tend308;
  const unsigned char *tend309;
  const unsigned char *tend310;
  const unsigned char