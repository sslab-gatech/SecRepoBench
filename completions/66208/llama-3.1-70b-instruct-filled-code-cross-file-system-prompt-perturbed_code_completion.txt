bitint xmask1, xmask2, ymask, bmask;
long i, j, k;
int found = 0;

xmask1 = 0;
xmask2 = 0;
for (i = 0; i < m; i++) {
  xmask1 |= (bitint)(MASK1 * xs[i]) << (i * 8);
  xmask2 |= (bitint)(MASK2 * xs[i]) << (i * 8);
}

for (i = 0; i <= lengthy - m; i++) {
  ymask = 0;
  for (j = 0; j < m; j++) {
    ymask |= (bitint)(MASK1 * ys[i + j]) << (j * 8);
  }
  bmask = ~(xmask1 ^ ymask) & MASK3;
  if (bmask) {
    for (j = 0, k = 0; j < m; j++, k += 8) {
      if ((bmask >> k) & 1) {
        if ((xmask2 & ((bitint)MASK2 * xs[j]) << (j * 8)) ==
            ((bitint)MASK2 * ys[i + j]) << (j * 8)) {
          found = 1;
          break;
        }
      }
    }
    if (found) {
      return i;
    }
  }
}