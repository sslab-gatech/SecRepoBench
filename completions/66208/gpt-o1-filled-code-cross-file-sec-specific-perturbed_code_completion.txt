if (m <= 0 || lengthy < m) return -1;

bitint cfill = (bitint)xs[0];
cfill *= (bitint)MASK1;

long i = 0;
/* Process in chunks of 'bitint' size */
while (i + (long)sizeof(bitint) <= lengthy) {
  bitint chunk;
  memcpy(&chunk, ys + i, sizeof(chunk));
  bitint tmp = chunk ^ cfill;
  if (((tmp - MASK1) & ~tmp & MASK3) != 0) {
    /* Check each candidate byte in this chunk */
    for (long k = 0; k < (long)sizeof(chunk) && (i + k) <= (lengthy - m); k++) {
      if (ys[i + k] == xs[0]) {
        /* Verify full substring match */
        long j;
        for (j = 1; j < m; j++) {
          if (ys[i + k + j] != xs[j]) break;
        }
        if (j == m) return i + k;
      }
    }
  }
  i += sizeof(bitint);
}

/* Check remaining bytes */
while (i <= lengthy - m) {
  if (ys[i] == xs[0]) {
    long j;
    for (j = 1; j < m; j++) {
      if (ys[i + j] != xs[j]) break;
    }
    if (j == m) return i;
  }
  i++;
}