const bitint *xs = (const bitint*)xs;
  const bitint *ys = (const bitint*)ys;
  const bitint *ys_end = (const bitint*)(ys + lengthy - m + 1);

  bitint first = *xs;
  bitint mask = first ^ MASK1;
  mask = (mask - MASK1) & ~mask & MASK3;

  while (ys < ys_end) {
    bitint v = *ys ^ first;
    if ((v - MASK1) & ~v & MASK3) {
      if (memcmp(xs, ys, m) == 0) {
        return (mrb_int)((const unsigned char*)ys - (const unsigned char*)ys);
      }
    }
    ys++;
  }