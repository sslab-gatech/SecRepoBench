if (m > lengthy) return -1;
if (m == 0) return 0;
unsigned char c = xs[0];
long last = lengthy - m;
long i = 0;

/* Process bytes until ys is aligned on a word boundary */
while (i <= last && ((uintptr_t)(ys + i) % sizeof(bitint)) != 0) {
  if (ys[i] == c && memcmp(ys + i, xs, m) == 0)
    return i;
  i++;
}

/* Prepare a word filled with c for bitâ€level comparison */
const bitint repeated = c * MASK1;
for (; i <= last - (long)sizeof(bitint) + 1; i += sizeof(bitint)) {
  bitint word;
  memcpy(&word, ys + i, sizeof(word));
  bitint cmp = word ^ repeated;
  if (((cmp - MASK1) & ~cmp & MASK3) != 0) {
    /* At least one byte matches: check each byte in the word */
    for (unsigned int j = 0; j < sizeof(bitint); j++) {
      if (ys[i + j] == c && i + j <= last && memcmp(ys + i + j, xs, m) == 0)
        return i + j;
    }
  }
}

/* Process any remaining bytes */
for (; i <= last; i++) {
  if (ys[i] == c && memcmp(ys + i, xs, m) == 0)
    return i;
}