bitint x = 0, y = 0;
  long i;

  for (i = 0; i < m; ++i) {
    x = (x << 8) | xs[i];
  }

  for (i = 0; i < lengthy; ++i) {
    y = (y << 8) | ys[i];
  }

  if (m > 64) {
    bitint mask = (bitint)MASK1 << (m - 64);
    while (y & mask) {
      y <<= 1;
    }
  }

  for (i = 0; i <= lengthy - m; ++i) {
    if (x == y) {
      return i;
    }
    if (i < lengthy - m) {
      y = ((y << 8) | ys[i + m]) & ((bitint)MASK2 << (m * 8) | MASK3);
    }
  }

  return -1;
}