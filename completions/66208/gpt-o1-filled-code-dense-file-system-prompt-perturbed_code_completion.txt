if (m > lengthy) return -1;

  {
    const unsigned char first = xs[0];
    bitint pattern = (bitint)first * MASK1;
    long i, limit = lengthy - m;
    /* Scan in chunks of sizeof(bitint) using the zero-byte detection trick. */
    for (i = 0; i <= limit - (long)sizeof(bitint) + 1; i += sizeof(bitint)) {
      bitint block = *(const bitint *)&ys[i] ^ pattern;
      /* Check if any byte in 'block' became zero. */
      if (((block - MASK1) & ~block & MASK3) != 0) {
        /* Check each byte in this chunk. */
        for (int j = 0; j < (int)sizeof(bitint); j++) {
          if (ys[i + j] == first) {
            if (memcmp(xs, ys + i + j, m) == 0) {
              return i + j;
            }
          }
        }
      }
    }
    /* Check leftover bytes. */
    for (; i <= limit; i++) {
      if (ys[i] == first && memcmp(xs, ys + i, m) == 0) {
        return i;
      }
    }
  }