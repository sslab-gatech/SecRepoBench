if (m < 1 || lengthy < m) return -1;

  const unsigned char *xe = xs + m;
  const unsigned char *ye = ys + lengthy - m + 1;
  bitint v, eq, diff;

  while (ys < ye) {
    v = *(const bitint *)ys;
    eq = v ^ *(const bitint *)xs;
    diff = (eq - MASK1) & ~eq & MASK2;
    if (!diff) {
      if (memcmp(xs, ys, m) == 0) {
        return ys - (const unsigned char *)ys;
      }
    }
    ys++;
  }