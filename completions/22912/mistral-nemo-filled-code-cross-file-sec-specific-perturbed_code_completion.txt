if (packet->payload_packet_len > 0) {
  const u_int8_t *packet_payload = packet->payload;

  if (packet->packet_ttl == 1 && packet->packet_protocol == IPPROTO_UDP && packet->packet_dst == htons(4070)) {
    if (ndpi_check_spotify_identifier(ndpi_struct, packet_payload, payload_len)) {
      NDPI_LOG_DBG(ndpi_struct, "Spotify detected via UDP");
      ndpi_set_detection_bitmask(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      return;
    }
  }

  if (packet->packet_protocol == IPPROTO_TCP) {
    if (ndpi_check_spotify_tcp(ndpi_struct, packet_payload, payload_len)) {
      NDPI_LOG_DBG(ndpi_struct, "Spotify detected via TCP");
      ndpi_set_detection_bitmask(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      return;
    }
  }

  if (ndpi_check_spotify_ip(ndpi_struct, packet->packet_src, packet->packet_dst)) {
    NDPI_LOG_DBG(ndpi_struct, "Spotify detected via IP");
    ndpi_set_detection_bitmask(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
    return;
  }
}