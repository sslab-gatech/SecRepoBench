if (packet->protocol == IPPROTO_UDP && 
    (packet->src_port == NDPI_SPOTIFY_PORT || packet->dst_port == NDPI_SPOTIFY_PORT)) {
  if (payload_len >= 7) {
    if (memcmp(packet->payload, "SpotifyClient", 13) == 0) {
      NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic");
      stream->detected_protocol = NDPI_PROTOCOL_SPOTIFY;
      return;
    }
  }
} else if (packet->protocol == IPPROTO_TCP) {
  if (payload_len >= 7) {
    if (memcmp(packet->payload, "SpotifyClient", 13) == 0) {
      NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic");
      stream->detected_protocol = NDPI_PROTOCOL_SPOTIFY;
      return;
    }
  }
} else if (packet->ip_header->src_ip == NDPI_SPOTIFY_IP1 || packet->ip_header->dst_ip == NDPI_SPOTIFY_IP2) {
  NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic");
  stream->detected_protocol = NDPI_PROTOCOL_SPOTIFY;
  return;
}