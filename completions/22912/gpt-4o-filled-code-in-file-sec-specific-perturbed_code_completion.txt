(packet->udp != NULL && (packet->udp->source == htons(4070) || packet->udp->dest == htons(4070))) {
    if (payload_len > 0 && packet->payload[0] == 0x01) { // Example check for a specific byte pattern
      NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic on UDP port 4070\n");
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  } else if (packet->tcp != NULL) {
    if (payload_len > 4 && memcmp(packet->payload, "SPOT", 4) == 0) { // Example check for a specific byte pattern
      NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic on TCP\n");
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  } else if (packet->iph != NULL) {
    if ((ntohl(packet->iph->saddr) & 0xFFFF0000) == 0xC0A80000 || // Example IP range check
        (ntohl(packet->iph->daddr) & 0xFFFF0000) == 0xC0A80000) {
      NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic based on IP range\n");
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  }