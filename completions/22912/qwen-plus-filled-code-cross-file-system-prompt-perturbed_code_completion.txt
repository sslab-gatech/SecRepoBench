(packet->udp != NULL && payload_len > 0) {
    if (packet->udp->dest == htons(4070) || packet->udp->source == htons(4070)) { // Spotify UDP port
        if (memcmp(packet->payload, "SPOT", 4) == 0) { // Hypothetical Spotify identifier
            NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic over UDP\n");
            ndpi_int_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DPI);
            return;
        }
    }
} else if (packet->tcp != NULL) {
    if (payload_len >= 10 && memcmp(packet->payload, "\x16\x03", 2) == 0) { // Check for TLS handshake
        // Additional heuristic checks for Spotify-specific patterns in TCP payloads can be added here.
        // For example, check for known hostnames or paths related to Spotify.
        NDPI_LOG_INFO(ndpi_struct, "Potential Spotify traffic over TCP detected\n");
        ndpi_int_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DPI);
        return;
    }
}

// Analyze IP addresses for known Spotify ranges
if (stream->src_ip类别 == NDPI_IPv4) {
    u_int32_t src_ip = ntohl(stream->src_ip.v4);
    u_int32_t dst_ip = ntohl(stream->dst_ip.v4);

    // Example Spotify IP range check (replace with actual ranges)
    if ((src_ip >= 0x2A022EE0 && src_ip <= 0x2A022EEB) || (dst_ip >= 0x2A022EE0 && dst_ip <= 0x2A022EEB)) {
        NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic via IP range\n");
        ndpi_int_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_LOW);
        return;
    }
}