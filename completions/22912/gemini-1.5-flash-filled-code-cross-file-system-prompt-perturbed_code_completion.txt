if (packet->udp_port_source == 4070 || packet->udp_port_destination == 4070 ||
      packet->tcp_port_source == 4070 || packet->tcp_port_destination == 4070) {
    // Check for Spotify-specific payload patterns
    if (payload_len > 0) {
      // Add your Spotify payload pattern check here
      // ...
      if (/* Spotify payload pattern detected */) {
        NDPI_SET_PROTO(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
        NDPI_LOG_DETECTED_PROTO(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
        return;
      }
    }
  } else if (payload_len > 0) {
    // Check for Spotify-specific byte patterns in TCP payload
    // Add your Spotify TCP payload pattern check here
    // ...
    if (/* Spotify TCP payload pattern detected */) {
      NDPI_SET_PROTO(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      NDPI_LOG_DETECTED_PROTO(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      return;
    }
  } else {
    // Check for Spotify IP ranges
    // Add your Spotify IP range check here
    // ...
    if (/* Spotify IP range detected */) {
      NDPI_SET_PROTO(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      NDPI_LOG_DETECTED_PROTO(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      return;
    }
  }