(void)ndpi_struct;
(void)stream;

if (packet->udp != NULL) {
    if (packet->udp->source == htons(4070) || packet->udp->dest == htons(4070)) {
        if (payload_len >= 4 && memcmp(packet->payload, "SPFY", 4) == 0) {
            ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
            return;
        }
    }
} else if (packet->tcp != NULL) {
    if (payload_len >= 4 && memcmp(packet->payload, "SPFY", 4) == 0) {
        ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
        return;
    }
} else {
    if (ndpi_struct->ip_version == 4) {
        if (ndpi_struct->host_ip_addr.ipv4 == htonl(0x34800000) || // 52.88.0.0/14
            ndpi_struct->host_ip_addr.ipv4 == htonl(0x34c00000) || // 52.140.0.0/15
            ndpi_struct->host_ip_addr.ipv4 == htonl(0x34e00000)) { // 52.142.0.0/15
            ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
            return;
        }
    }
}