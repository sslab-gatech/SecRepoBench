if (packet->protocol == IPPROTO_UDP) {
  if (packet->src_port == 5353 || packet->dst_port == 5353) {
    if (payload_len >= 4) {
      u_int32_t spotify_identifier = *(u_int32_t *)packet->payload;
      if (spotify_identifier == 0x00000001) {
        NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
        return;
      }
    }
  }
} else if (packet->protocol == IPPROTO_TCP) {
  if (payload_len >= 4) {
    u_int32_t spotify_identifier = *(u_int32_t *)packet->payload;
    if (spotify_identifier == 0x00000001) {
      NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
      return;
    }
  }
} else if (packet->protocol == IPPROTO_IP) {
  if (IN_CLASSA(packet->src_ip) && IN_CLASSA(packet->dst_ip)) {
    if (IN_CLASSA_NET(packet->src_ip) == IN_CLASSA_NET(0x0A000000) ||
        IN_CLASSA_NET(packet->dst_ip) == IN_CLASSA_NET(0x0A000000)) {
      NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
      return;
    }
  }
}