if (packet->udp != 0) {
    if (packet->dest_port == 0x8000 || packet->dest_port == 0x8004) {
      if (payload_len > 8) {
        u_int8_t spotify_header[] = { 0x53, 0x50, 0x4f, 0x54, 0x49, 0x46, 0x59 };
        if (memcmp(packet->payload, spotify_header, sizeof(spotify_header)) == 0) {
          NDPI_LOG_PROTOCOL(ndpi_struct, NDPI_PROTOCOL_SPOTIFY);
          ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
          return;
        }
      }
    }
  } else if (packet->tcp != 0) {
    if (payload_len > 8) {
      u_int8_t spotify_header[] = { 0x53, 0x50, 0x4f, 0x54, 0x49, 0x46, 0x59 };
      if (memcmp(packet->payload, spotify_header, sizeof(spotify_header)) == 0) {
        NDPI_LOG_PROTOCOL(ndpi_struct, NDPI_PROTOCOL_SPOTIFY);
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
        return;
      }
    }
  } else if (packet->ip != 0) {
    u_int32_t src_ip = ntohl(packet->iph->saddr);
    u_int32_t dst_ip = ntohl(packet->iph->daddr);
    if ((src_ip >= 0x0A000000 && src_ip <= 0x0A0FFFFF) || (dst_ip >= 0x0A000000 && dst_ip <= 0x0A0FFFFF)) {
      NDPI_LOG_PROTOCOL(ndpi_struct, NDPI_PROTOCOL_SPOTIFY);
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
      return;
    }
  }