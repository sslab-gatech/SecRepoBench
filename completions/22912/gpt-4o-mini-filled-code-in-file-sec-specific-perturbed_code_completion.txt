if (packet->protocol == IPPROTO_UDP && (packet->dst_port == 4070 || packet->src_port == 4070)) {
    if (payload_len > 0 && payload_len <= MAX_PAYLOAD_SIZE) {
      const u_int8_t *packet_payload = packet->payload;
      // Check for specific Spotify identifiers in the payload
      if (is_spotify_identifier(packet_payload, payload_len)) {
        ndpi_int_spotify_add_connection(ndpi_struct, flow, 0);
        return;
      }
    }
  } else if (packet->protocol == IPPROTO_TCP) {
    if (payload_len > 0 && payload_len <= MAX_PAYLOAD_SIZE) {
      const u_int8_t *packet_payload = packet->payload;
      // Analyze TCP payload for Spotify patterns
      if (is_spotify_identifier(packet_payload, payload_len)) {
        ndpi_int_spotify_add_connection(ndpi_struct, flow, 0);
        return;
      }
    }
  }

  // Check IP addresses against known Spotify ranges
  if (is_known_spotify_ip(stream->src_ip) || is_known_spotify_ip(stream->dst_ip)) {
    ndpi_int_spotify_add_connection(ndpi_struct, flow, 0);
    return;
  }