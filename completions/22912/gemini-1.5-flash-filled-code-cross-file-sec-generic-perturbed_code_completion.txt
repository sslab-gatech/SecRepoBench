if (packet->udp_port_source == 4070 || packet->udp_port_destination == 4070) {
    // Check for Spotify UDP payload identifier
    if (payload_len > 10 && memcmp(packet->payload, "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00", 10) == 0) {
      NDPI_SET_PROTOCOL(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      NDPI_LOG_DETECTED_PROTOCOL(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      return;
    }
  } else if (packet->tcp_stream) {
    // Check for Spotify TCP payload patterns
    if (payload_len > 20 && memmem(packet->payload, payload_len, "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00", 16)) {
      NDPI_SET_PROTOCOL(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      NDPI_LOG_DETECTED_PROTOCOL(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      return;
    }
  } else {
    // Check for Spotify IP ranges
    // Add your IP range checks here.  This requires specific knowledge of Spotify IP ranges.
    // Example (replace with actual Spotify IP ranges):
    // if (ndpi_is_ip_in_range(packet->ip_source, 192, 168, 0, 0, 192, 168, 0, 255) ||
    //     ndpi_is_ip_in_range(packet->ip_destination, 192, 168, 0, 0, 192, 168, 0, 255)) {
    //   NDPI_SET_PROTOCOL(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
    //   NDPI_LOG_DETECTED_PROTOCOL(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
    //   return;
    // }
  }