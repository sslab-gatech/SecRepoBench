if(packet->udp != NULL) {
    if((packet->udp->source == htons(4070) || packet->udp->dest == htons(4070)) && payload_len > 4) {
      if(memcmp(packet->payload, "Spot", 4) == 0) {
        NDPI_LOG_INFO(ndpi_struct, "Spotify UDP detected\n");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
        return;
      }
    }
  } else if(packet->tcp != NULL) {
    if(payload_len > 4 && memcmp(packet->payload, "Spot", 4) == 0) {
      NDPI_LOG_INFO(ndpi_struct, "Spotify TCP detected\n");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      return;
    }
  }

  if((packet->iph->saddr == htonl(78.31.8.0) || packet->iph->daddr == htonl(78.31.8.0)) ||
     (packet->iph->saddr == htonl(193.182.8.0) || packet->iph->daddr == htonl(193.182.8.0))) {
    NDPI_LOG_INFO(ndpi_struct, "Spotify IP detected\n");
    ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
    return;
  }