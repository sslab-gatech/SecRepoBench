if (packet->tcp_retransmission == 0) {
    if (packet->udp && packet->udp->dport == 4070) { // Check if UDP packet and port is 4070 (known Spotify port)
      if (payload_len >= 12 && memcmp(packet->payload, "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00", 12) == 0) { // Check for specific Spotify identifier in payload
        ndpi_set_detected_protocol(ndpi_struct, flow, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
        return;
      }
    } else if (packet->tcp) {
      // Analyze TCP payload for specific byte patterns indicative of Spotify
      // ...
    } else if (packet->ip) {
      // Check if source or destination IP addresses fall within specific known Spotify IP ranges
      // ...
    }
  }