if (packet->udp != 0 && packet->payload_packet_len >= 4 &&
      memcmp(packet->payload, "\x00\x00\x01\x01", 4) == 0) {
    NDPI_LOG_INFO(ndpi_struct, "Spotify traffic detected.\n");
    ndpi_int_spotify_add_connection(ndpi_struct, flow, 0);
    return;
  }

  if (packet->tcp != 0 && payload_len >= 4 &&
      memcmp(packet->payload, "\x00\x00\x01\x01", 4) == 0) {
    NDPI_LOG_INFO(ndpi_struct, "Spotify traffic detected.\n");
    ndpi_int_spotify_add_connection(ndpi_struct, flow, 0);
    return;
  }

  if (packet->ip_version == 4 &&
      (packet->src_ip.ip4 != 0 && packet->dst_ip.ip4 != 0)) {
    if ((packet->src_ip.ip4 >= 192.168.0.0 && packet->src_ip.ip4 <= 192.168.255.255) ||
        (packet->dst_ip.ip4 >= 192.168.0.0 && packet->dst_ip.ip4 <= 192.168.255.255)) {
      NDPI_LOG_INFO(ndpi_struct, "Spotify traffic detected.\n");
      ndpi_int_spotify_add_connection(ndpi_struct, flow, 0);
      return;
    }
  }

  if (packet->ip_version == 6 &&
      (packet->src_ip.ip6 != 0 && packet->dst_ip.ip6 != 0)) {
    if (ipv6_is_spotify_subnet(packet->src_ip.ip6) || ipv6_is_spotify_subnet(packet->dst_ip.ip6)) {
      NDPI_LOG_INFO(ndpi_struct, "Spotify traffic detected.\n");
      ndpi_int_spotify_add_connection(ndpi_struct, flow, 0);
      return;
    }
  }