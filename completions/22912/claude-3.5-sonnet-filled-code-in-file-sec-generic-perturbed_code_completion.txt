(packet->udp != 0) {
    if (payload_len >= 4 && packet->udp->dest == htons(57621)) {
      if (packet->payload[0] == 0x00 && packet->payload[1] == 0x04 &&
          packet->payload[2] == 0x00 && packet->payload[3] == 0x00) {
        NDPI_LOG_INFO(ndpi_struct, "Found Spotify\n");
        ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
        return;
      }
    }
  } else if (packet->tcp != 0) {
    if (payload_len > 8) {
      if (memcmp(packet->payload, "\x00\x04\x00\x00", 4) == 0 ||
          memcmp(packet->payload, "\x00\x01\x00\x00", 4) == 0) {
        NDPI_LOG_INFO(ndpi_struct, "Found Spotify\n");
        ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
        return;
      }
    }
  }

  if (packet->iph) {
    u_int32_t src_ip = ntohl(packet->iph->saddr);
    u_int32_t dst_ip = ntohl(packet->iph->daddr);

    if ((src_ip >= 0x4E000000 && src_ip <= 0x4E7FFFFF) ||
        (dst_ip >= 0x4E000000 && dst_ip <= 0x4E7FFFFF)) {
      NDPI_LOG_INFO(ndpi_struct, "Found Spotify (IP range match)\n");
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  }