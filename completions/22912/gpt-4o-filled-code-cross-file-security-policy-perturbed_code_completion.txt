if(packet->udp != NULL) {
    // Check if the packet is a UDP packet on a known Spotify port
    if(packet->udp->source == htons(4070) || packet->udp->dest == htons(4070)) {
      // Ensure payload length is sufficient before checking payload content
      if(payload_len >= 7 && memcmp(packet->payload, "Spotify", 7) == 0) {
        NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic on UDP port 4070\n");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
        return;
      }
    }
  } else if(packet->tcp != NULL) {
    // Check for specific byte patterns in TCP payload
    if(payload_len >= 7 && memcmp(packet->payload, "Spotify", 7) == 0) {
      NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic in TCP payload\n");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      return;
    }
  }

  // Further IP address checks for known Spotify ranges could be added here