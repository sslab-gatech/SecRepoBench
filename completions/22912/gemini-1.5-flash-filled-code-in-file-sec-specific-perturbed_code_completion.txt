(payload_len > 0 && packet->transport_protocol == NDPI_PROTOCOL_UDP && packet->payload[0] == 0x00 && packet->payload[1] == 0x01) {
    NDPI_LOG_DBG(ndpi_struct, "Spotify detected (UDP)\n");
    ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
    return;
  } else if (payload_len > 0 && packet->transport_protocol == NDPI_PROTOCOL_TCP) {
    // Analyze TCP payload for Spotify-specific byte patterns
    // ... (Implementation for TCP payload analysis) ...
    if (/* Spotify pattern detected */) {
      NDPI_LOG_DBG(ndpi_struct, "Spotify detected (TCP)\n");
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  } else if (packet->ip_proto == IPPROTO_IP) {
    // Check source and destination IP addresses against known Spotify IP ranges
    // ... (Implementation for IP address range check) ...
    if (/* IP address within Spotify range */) {
      NDPI_LOG_DBG(ndpi_struct, "Spotify detected (IP)\n");
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  }