(packet->udp) {
    if (packet->dport == 1900 || packet->sport == 1900) {
      if (payload_len >= 4 && memcmp(packet->payload, "SPOT", 4) == 0) {
        NDPI_LOG_INFO(ndpi_struct, "Spotify detection successful (UDP).\n");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
        return;
      }
    }
  } else if (packet->tcp) {
    if (payload_len > 4) {
      /* Check for specific byte patterns indicative of Spotify */
      if (memcmp(packet->payload, "\x00\x04\x73\x70", 4) == 0) /* ..sp */
      {
        NDPI_LOG_INFO(ndpi_struct, "Spotify detection successful (TCP).\n");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
        return;
      }
    }
  } else if (packet->ip) {
    /* Check for known Spotify IP ranges */
    u_int32_t ip_src = ntohl(packet->iph->saddr);
    u_int32_t ip_dst = ntohl(packet->iph->daddr);

    /* Example IP Range Check (Replace with actual Spotify IP ranges) */
    if ((ip_src >= 0xA000000 && ip_src <= 0xAFFFFFF) || /* 10.0.0.0 - 10.255.255.255 */
        (ip_dst >= 0xA000000 && ip_dst <= 0xAFFFFFF)) {
      NDPI_LOG_INFO(ndpi_struct, "Spotify detection successful (IP Range).\n");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
      return;
    }
  }