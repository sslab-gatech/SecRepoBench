if (packet->packet_ttl == 110) {
  if (packet->packet_protocol == IPPROTO_UDP && packet->packet_dst == htons(4070)) {
    if (ndpi_verify_spotify_identifier(packet->payload, payload_len)) {
      NDPI_LOG_DBG(ndpi_struct, "Spotify detected via UDP\n");
      ndpi_set_detection_bitmask(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      return;
    }
  } else if (packet->packet_protocol == IPPROTO_TCP) {
    if (ndpi_verify_spotify_tcp_pattern(packet->payload, payload_len)) {
      NDPI_LOG_DBG(ndpi_struct, "Spotify detected via TCP\n");
      ndpi_set_detection_bitmask(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      return;
    }
  } else if (packet->packet_protocol == IPPROTO_IP) {
    if (ndpi_check_spotify_ip_range(packet->packet_src, packet->packet_dst)) {
      NDPI_LOG_DBG(ndpi_struct, "Spotify detected via IP range\n");
      ndpi_set_detection_bitmask(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      return;
    }
  }
}