(payload_len >= 4 && packet->udp != NULL &&
     ((NTOHS(packet->udp->source) == 4070) || (NTOHS(packet->udp->dest) == 4070)) &&
     packet->payload[0] == 'S' && packet->payload[1] == 'p' && packet->payload[2] == 'o' &&
     packet->payload[3] == 't') {
    NDPI_LOG(ndpi_struct, "found Spotify over UDP\n");
    NDPI_ADD_PROTOCOL_TO_BITMASK(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
    return;
  } else if (payload_len >= 29 && packet->tcp != NULL &&
             packet->payload[25] == 0x00 && packet->payload[26] == 0x01 &&
             packet->payload[27] == 0x00 && packet->payload[28] == 0x06) {
    NDPI_LOG(ndpi_struct, "found Spotify over TCP\n");
    NDPI_ADD_PROTOCOL_TO_BITMASK(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
    return;
  }

  if (payload_len > 0 && packet->ip != NULL) {
    if ((ntohl(packet->ip->saddr) >= 0xAC400000 && ntohl(packet->ip->saddr) <= 0xAC4FFFFF) || /* 172.64.0.0/10 */
        (ntohl(packet->ip->daddr) >= 0xAC400000 && ntohl(packet->ip->daddr) <= 0xAC4FFFFF)) {
      NDPI_LOG(ndpi_struct, "found Spotify over IP\n");
      NDPI_ADD_PROTOCOL_TO_BITMASK(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY);
      return;
    }
  }