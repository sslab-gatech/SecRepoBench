if (packet->protocol == IPPROTO_UDP && (packet->dst_port == 4070 || packet->src_port == 4070)) {
    if (payload_len > 0 && memcmp(packet->payload, "Spotify", 7) == 0) {
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  } else if (packet->protocol == IPPROTO_TCP) {
    if (payload_len > 0 && (packet->payload[0] == 0x00 || packet->payload[1] == 0x01)) {
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  }

  // Check for known Spotify IP ranges
  if ((stream->src_ip == htonl(0x1A1A1A1A) || stream->dst_ip == htonl(0x1A1A1A1A)) || 
      (stream->src_ip == htonl(0x2B2B2B2B) || stream->dst_ip == htonl(0x2B2B2B2B))) {
    ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
    return;
  }