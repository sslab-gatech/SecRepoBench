((packet->udp != NULL) && (
      (packet->udp->dest == htons(4070)) || (packet->udp->source == htons(4070))
    ) && (payload_len > 4) &&
    (memcmp(packet->payload, "SPOT", 4) == 0)) {
    NDPI_LOG_INFO(ndpi_struct, "Spotify detected via UDP port 4070 and payload signature\n");
    ndpi_int_add_connection(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_REAL_PROTOCOL);
    return;
  } else if ((packet->tcp != NULL) && (payload_len > 4) &&
             (memcmp(packet->payload, "SPOT", 4) == 0)) {
    NDPI_LOG_INFO(ndpi_struct, "Spotify detected via TCP payload signature\n");
    ndpi_int_add_connection(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_REAL_PROTOCOL);
    return;
  } else if ((packet->ip != NULL) &&
             (   ((ntohl(packet->ip->saddr) & 0xFFF00000) == 0x2A000000) /* 42.0.0.0/12 */
              || ((ntohl(packet->ip->daddr) & 0xFFF00000) == 0x2A000000) )) {
    NDPI_LOG_INFO(ndpi_struct, "Spotify detected via known IP range 42.0.0.0/12\n");
    ndpi_int_add_connection(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_REAL_PROTOCOL);
    return;
  }