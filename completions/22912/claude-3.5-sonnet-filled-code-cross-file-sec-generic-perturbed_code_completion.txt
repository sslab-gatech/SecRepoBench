(packet->udp != 0 && ((packet->udp->source == htons(57621) || packet->udp->dest == htons(57621)))) {
    if(payload_len >= 4 && memcmp(packet->payload, "SpotUdp", 7) == 0) {
      NDPI_LOG_INFO(ndpi_struct, "Spotify UDP detected\n");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DPI);
      return;
    }
  } else if(packet->tcp != 0) {
    if(payload_len >= 20 && memcmp(packet->payload, "\x00\x04\x00\x00", 4) == 0) {
      NDPI_LOG_INFO(ndpi_struct, "Spotify TCP detected\n");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DPI);
      return;
    }
  } else if(packet->iph) {
    u_int32_t src_ip = ntohl(packet->iph->saddr);
    u_int32_t dst_ip = ntohl(packet->iph->daddr);
    if((src_ip >= 0xA9FE0000 && src_ip <= 0xA9FEFFFF) || 
       (dst_ip >= 0xA9FE0000 && dst_ip <= 0xA9FEFFFF)) {
      NDPI_LOG_INFO(ndpi_struct, "Spotify IP range detected\n");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DPI);
      return;
    }
  }