((packet->udp != 0 && (packet->destination == htons(4070) || packet->source == htons(4070))) ||
 (packet->tcp != 0 && (packet->destination == htons(4070) || packet->source == htons(4070)))) {
    NDPI_LOG_DBG(ndpi_struct, "Detected Spotify on port 4070\n");
    ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
    return;
} else if((packet->iph != NULL) && (
           /* Example: 78.31.8.0/21 (Spotify AS) */
           ((ntohl(packet->iph->saddr) & 0xFFFFF800) == 0x4E1F0800) ||
           ((ntohl(packet->iph->daddr) & 0xFFFFF800) == 0x4E1F0800))) {
    NDPI_LOG_DBG(ndpi_struct, "Detected Spotify based on known IP range\n");
    ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
    return;
} else if((packet->tcp != 0 || packet->udp != 0) && payload_len > 4 &&
          /* Example pattern check for "Spotify" in payload */
          (packet->payload[0] == 'S' && packet->payload[1] == 'p' &&
           packet->payload[2] == 'o' && packet->payload[3] == 't')) {
    NDPI_LOG_DBG(ndpi_struct, "Detected Spotify based on payload pattern\n");
    ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
    return;
}