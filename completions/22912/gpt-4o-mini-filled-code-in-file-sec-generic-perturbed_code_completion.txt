if (packet->protocol == NDPI_PROTOCOL_UDP && (packet->src_port == 4070 || packet->dst_port == 4070)) {
    if (payload_len > 0 && memcmp(packet->payload, "Spotify", 7) == 0) {
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  } else if (packet->protocol == NDPI_PROTOCOL_TCP) {
    if (payload_len > 0 && (strstr((const char *)packet->payload, "Spotify") != NULL)) {
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  }

  // Check for known Spotify IP ranges
  if ((ntohl(stream->src_ip) >= ntohl(inet_addr("78.31.8.0")) && ntohl(stream->src_ip) <= ntohl(inet_addr("78.31.15.255"))) ||
      (ntohl(stream->dst_ip) >= ntohl(inet_addr("78.31.8.0")) && ntohl(stream->dst_ip) <= ntohl(inet_addr("78.31.15.255")))) {
    ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
    return;
  }