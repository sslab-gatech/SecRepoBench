(packet->packet_protocol == IPPROTO_UDP) {
    if (packet->dport == 4070 || packet->dport == 8080) {
      if (payload_len > 4 && memcmp(packet->payload, "0\x1d\x06\x00", 4) == 0) {
        NDPI_LOG_INFO(ndpi_struct, "Spotify UDP Detected\n");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
        return;
      }
    }
  } else if (packet->packet_protocol == IPPROTO_TCP) {
    if (payload_len > 10) {
      if (memcmp(packet->payload, "\x16\x03\x01", 3) == 0 ||
          memcmp(packet->payload, "\x16\x03\x00", 3) == 0 ||
          memcmp(packet->payload, "\x47\x45\x54\x20", 4) == 0 ||
          memcmp(packet->payload, "\x50\x4f\x53\x54\x20", 4) == 0 ||
          memcmp(packet->payload, "\x48\x54\x54\x50", 4) == 0) {
        NDPI_LOG_INFO(ndpi_struct, "Spotify TCP Detected\n");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
      }
    }
  }

  if (stream->src_ip == ndpi_struct->spotify.ip_addr[0] ||
      stream->src_ip == ndpi_struct->spotify.ip_addr[1] ||
      stream->src_ip == ndpi_struct->spotify.ip_addr[2] ||
      stream->src_ip == ndpi_struct->spotify.ip_addr[3] ||
      stream->dst_ip == ndpi_struct->spotify.ip_addr[0] ||
      stream->dst_ip == ndpi_struct->spotify.ip_addr[1] ||
      stream->dst_ip == ndpi_struct->spotify.ip_addr[2] ||
      stream->dst_ip == ndpi_struct->spotify.ip_addr[3]) {
    NDPI_LOG_INFO(ndpi_struct, "Spotify IP Detected\n");
    ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
    return;
  }