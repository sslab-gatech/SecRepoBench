// <MASK>
(packet->udp != NULL) {
  if ((packet->udp->source == htons(SPOTIFY_UDP_PORT)) || (packet->udp->dest == htons(SPOTIFY_UDP_PORT))) {
    if (ndpi_match_string_subprotocol(ndpi_struct, stream, "spotify", SPOTIFY_PAYLOAD_LEN)) {
      NDPI_LOG_INFO(ndpi_struct, "found spotify (UDP)\n");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
      return;
    }
  }
} else if (packet->tcp != NULL) {
  if (ndpi_match_string_subprotocol(ndpi_struct, stream, "spotify", SPOTIFY_PAYLOAD_LEN)) {
    NDPI_LOG_INFO(ndpi_struct, "found spotify (TCP)\n");
    ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
    return;
  }
} else {
  if (ndpi_is_ip_address_in_spotify_range(packet->iph)) {
    NDPI_LOG_INFO(ndpi_struct, "found spotify (IP)\n");
    ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
    return;
  }
}