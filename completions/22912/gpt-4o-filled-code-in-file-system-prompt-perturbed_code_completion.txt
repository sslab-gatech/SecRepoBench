(packet->udp != NULL && (packet->udp->source == htons(4070) || packet->udp->dest == htons(4070))) {
    if (payload_len > 0 && packet->payload[0] == 0x00) { // Example check for a Spotify-specific identifier
      NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic on UDP port 4070\n");
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  } else if (packet->tcp != NULL) {
    if (payload_len > 4 && memcmp(packet->payload, "SPOT", 4) == 0) { // Example pattern check
      NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic via TCP\n");
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  } else if (packet->iph != NULL) {
    if ((packet->iph->saddr == htonl(0xC0A80001) || packet->iph->daddr == htonl(0xC0A80001))) { // Example IP range check
      NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic based on IP address\n");
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  }