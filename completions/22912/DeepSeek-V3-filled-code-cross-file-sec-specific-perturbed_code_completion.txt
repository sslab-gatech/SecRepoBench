(packet->udp != NULL) {
    if (payload_len > 4 && memcmp(packet->payload, "SPOT", 4) == 0) {
      NDPI_LOG_INFO(ndpi_struct, "found Spotify via UDP\n");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
      return;
    }
  } else if (packet->tcp != NULL) {
    if (payload_len > 8 && memcmp(packet->payload, "\x00\x00\x00\x08SPOT", 8) == 0) {
      NDPI_LOG_INFO(ndpi_struct, "found Spotify via TCP\n");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
      return;
    }
  }

  if (ndpi_network_ptree_match(ndpi_struct, &packet->iph->saddr) ||
      ndpi_network_ptree_match(ndpi_struct, &packet->iph->daddr)) {
    NDPI_LOG_INFO(ndpi_struct, "found Spotify via IP range\n");
    ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
    return;
  }