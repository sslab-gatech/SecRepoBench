(packet->udp != NULL && (packet->udp->source == htons(4070) || packet->udp->dest == htons(4070))) {
    // Check for specific Spotify payload pattern
    if (payload_len > 0 && packet->payload[0] == 0x01) { // Example pattern check
      NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic on UDP port 4070\n");
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  } else if (packet->tcp != NULL) {
    // Check for specific Spotify payload pattern in TCP
    if (payload_len > 4 && packet->payload[0] == 0x16 && packet->payload[1] == 0x03) { // Example pattern check
      NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic on TCP\n");
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  } else if (packet->iph != NULL) {
    // Check for known Spotify IP ranges
    if ((ntohl(packet->iph->saddr) & 0xFFFF0000) == 0xC0A80000 || // Example IP range check
        (ntohl(packet->iph->daddr) & 0xFFFF0000) == 0xC0A80000) {
      NDPI_LOG_INFO(ndpi_struct, "Detected Spotify traffic based on IP range\n");
      ndpi_int_spotify_add_connection(ndpi_struct, stream, 0);
      return;
    }
  }