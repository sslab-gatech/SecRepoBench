(packet->l4.protocol == IPPROTO_UDP && (packet->l4.udp.dst_port == 4070 || packet->l4.udp.src_port == 4070)) {
    if (payload_len >= 7 && memcmp(packet->payload, "Spotify", 7) == 0) {
      NDPI_LOG(ndpi_struct, "found Spotify over UDP\n");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
      return;
    }
  } else if (packet->l4.protocol == IPPROTO_TCP) {
    if (payload_len >= 25 && memcmp(packet->payload, "GET /audio_preview.php?", 25) == 0) {
      NDPI_LOG(ndpi_struct, "found Spotify over TCP\n");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
      return;
    }
  } else if (packet->l4.protocol == IPPROTO_IP) {
    if ((packet->l3.ip.src[0] == 74 && packet->l3.ip.src[1] == 125 && packet->l3.ip.src[2] == 224) ||
        (packet->l3.ip.dst[0] == 74 && packet->l3.ip.dst[1] == 125 && packet->l3.ip.dst[2] == 224)) {
      NDPI_LOG(ndpi_struct, "found Spotify over IP\n");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_SPOTIFY, NDPI_PROTOCOL_UNKNOWN);
      return;
    }
  }