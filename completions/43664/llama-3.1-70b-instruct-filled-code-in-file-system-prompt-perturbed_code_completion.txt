// Process the TLS extensions in the client's "Client Hello" message.
// For the "supported versions" extension, extract and store the supported TLS versions in the flow structure.
// For the "encrypted server name" extension, extract and store the encrypted SNI details if present.
// For the "QUIC transport parameters" extension, extract transport parameters and process the user agent if available.
// Continue processing any additional extensions that are part of the Client Hello message.
else if(extension_id == 43 /* supported versions */) {
  if(extension_len >= 2) {
    u_int16_t tls_version = ntohs(*((u_int16_t*)&packet->payload[offset+4]));

#ifdef DEBUG_TLS
    printf("Client TLS [TLS version: 0x%04X]\n", tls_version);
#endif

    flow->protos.tls_quic.ssl_version = ja3.client.tls_handshake_version = tls_version;
  }
} else if(extension_id == 18 /* encrypted server name */) {
  // Extract and store the encrypted SNI details if present
  if(extension_len >= 2) {
    u_int16_t encrypted_sni_len = ntohs(*((u_int16_t*)&packet->payload[offset+4]));

#ifdef DEBUG_TLS
    printf("Client TLS [Encrypted SNI: len=%u]\n", encrypted_sni_len);
#endif

    if(encrypted_sni_len > 0) {
      flow->protos.tls_quic.encrypted_sni.esni = ndpi_malloc(encrypted_sni_len);
      memcpy(flow->protos.tls_quic.encrypted_sni.esni, &packet->payload[offset+6], encrypted_sni_len);
      flow->protos.tls_quic.encrypted_sni.esni_len = encrypted_sni_len;
    }
  }
} else if(extension_id == 65445 /* QUIC transport parameters */) {
  // Extract transport parameters and process the user agent if available
  if(extension_len >= 2) {
    u_int16_t quic_transport_params_len = ntohs(*((u_int16_t*)&packet->payload[offset+4]));

#ifdef DEBUG_TLS
    printf("Client TLS [QUIC transport parameters: len=%u]\n", quic_transport_params_len);
#endif

    if(quic_transport_params_len > 0) {
      // Process the user agent if available
      if(quic_transport_params_len >= 4) {
        u_int16_t user_agent_len = ntohs(*((u_int16_t*)&packet->payload[offset+6]));

#ifdef DEBUG_TLS
        printf("Client TLS [User Agent: len=%u]\n", user_agent_len);
#endif

        if(user_agent_len > 0) {
          char *user_agent = ndpi_malloc(user_agent_len + 1);
          memcpy(user_agent, &packet->payload[offset+8], user_agent_len);
          user_agent[user_agent_len] = '\0';

          // Process the user agent
          http_process_user_agent(ndpi_struct, flow, (const u_int8_t*)user_agent, user_agent_len);

          ndpi_free(user_agent);
        }
      }
    }
  }
}