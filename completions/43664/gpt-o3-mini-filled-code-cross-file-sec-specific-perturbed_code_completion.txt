else if(extension_id == 43 /* supported versions */) {
  /* Check that the extension length is at least 2 bytes and within total length */
  if(extension_len >= 2 && (offset + extension_offset + extension_len) <= total_len) {
    /* Each version is 2 bytes. Build a commaâ€separated list (using "-" as per JA3) */
    u_int16_t num_versions = extension_len / 2;
    char versions_str[256] = {0};
    int pos = 0, n;
    for(i = 0; i < num_versions; i++) {
      u_int16_t ver = ntohs(*((u_int16_t*)&packet->payload[offset + extension_offset + (i * 2)]));
      n = snprintf(versions_str + pos, sizeof(versions_str) - pos, "%s0x%04X", (i > 0) ? "-" : "", ver);
      if(n <= 0 || (size_t)n >= sizeof(versions_str) - pos)
        break;
      pos += n;
    }
    /* Store the supported versions string in the client JA3 structure */
    snprintf(ja3.client.supported_versions, sizeof(ja3.client.supported_versions), "%s", versions_str);
  }
} else if(extension_id == 0xFFCE /* encrypted server name (ESNI) */) {
  /* Validate that the ESNI data lies within the packet bounds */
  if(extension_len > 0 && (offset + extension_offset + extension_len) <= total_len) {
    /* Allocate memory for the ESNI data plus null terminator */
    flow->protos.tls_quic.encrypted_sni.esni = ndpi_malloc(extension_len + 1);
    if(flow->protos.tls_quic.encrypted_sni.esni != NULL) {
      memcpy(flow->protos.tls_quic.encrypted_sni.esni,
             &packet->payload[offset + extension_offset],
             extension_len);
      flow->protos.tls_quic.encrypted_sni.esni[extension_len] = '\0';
    }
  }
} else if(extension_id == 57 /* QUIC transport parameters */) {
  /* Validate that the transport parameters data is within packet bounds */
  if(extension_len > 0 && (offset + extension_offset + extension_len) <= total_len) {
    /* Copy the QUIC transport parameters into the flow structure,
       making sure not to exceed the destination buffer size */
    flow->protos.tls_quic.quic_transport_params_len =
       (extension_len < sizeof(flow->protos.tls_quic.quic_transport_params)) ?
       extension_len : sizeof(flow->protos.tls_quic.quic_transport_params);
    memcpy(flow->protos.tls_quic.quic_transport_params,
           &packet->payload[offset + extension_offset],
           flow->protos.tls_quic.quic_transport_params_len);
  }
} else {
  /* For any other extensions not handled above, simply skip processing */
  /* (No operation for now) */
}