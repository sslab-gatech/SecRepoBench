// Process the TLS extensions in the client's "Client Hello" message.
// For the "supported versions" extension, extract and store the supported TLS versions in the flow structure.
// For the "encrypted server name" extension, extract and store the encrypted SNI details if present.
// For the "QUIC transport parameters" extension, extract transport parameters and process the user agent if available.
// Continue processing any additional extensions that are part of the Client Hello message.

// Supported versions
if(extension_id == 43 /* supported versions */) {
  if(extension_len >= 2) {
    u_int16_t tls_version = ntohs(*((u_int16_t*)&packet->payload[offset+4]));

#ifdef DEBUG_TLS
    printf("Client TLS [TLS version: 0x%04X]\n", tls_version);
#endif

    flow->protos.tls_quic.ssl_version = ja3.client.tls_supported_version = tls_version;
  }
}

// Encrypted server name
else if(extension_id == 0x8a /* encrypted server name */) {
  if(extension_len >= 2) {
    u_int16_t esni_len = ntohs(*((u_int16_t*)&packet->payload[offset+4]));

#ifdef DEBUG_TLS
    printf("Client TLS [ESNI: len=%u]\n", esni_len);
#endif

    if(offset+4+esni_len <= total_len) {
      flow->protos.tls_quic.encrypted_sni.esni = ndpi_memdup(&packet->payload[offset+4], esni_len);
      flow->protos.tls_quic.encrypted_sni.esni_len = esni_len;
    }
  }
}

// QUIC transport parameters
else if(extension_id == 0x39 /* QUIC transport parameters */) {
  if(extension_len >= 2) {
    u_int16_t quic_transport_params_len = ntohs(*((u_int16_t*)&packet->payload[offset+4]));

#ifdef DEBUG_TLS
    printf("Client TLS [QUIC transport parameters: len=%u]\n", quic_transport_params_len);
#endif

    if(offset+4+quic_transport_params_len <= total_len) {
      // Extract transport parameters
      u_int8_t *quic_transport_params = &packet->payload[offset+4];

      // Process user agent if available
      if(quic_transport_params_len >= 4) {
        u_int16_t user_agent_len = ntohs(*((u_int16_t*)&quic_transport_params[2]));

#ifdef DEBUG_TLS
        printf("Client TLS [User Agent: len=%u]\n", user_agent_len);
#endif

        if(offset+4+quic_transport_params_len >= user_agent_len) {
          char *user_agent = ndpi_memdup(&quic_transport_params[4], user_agent_len);

#ifdef DEBUG_TLS
          printf("Client TLS [User Agent: %s]\n", user_agent);
#endif

          // Process user agent
          //...
        }
      }
    }
  }
}

// Continue processing any additional extensions that are part of the Client Hello message.
else {
  // Process other extensions
  //...
}