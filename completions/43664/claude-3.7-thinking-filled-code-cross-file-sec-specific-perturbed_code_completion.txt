if(extension_id == 43 /* supported versions */ && 
   offset+extension_offset+1 < total_len) {
  u_int16_t s_offset = offset+extension_offset;
  u_int8_t version_len = packet->payload[s_offset];
  u_int8_t version_offset = 0;
  
#ifdef DEBUG_TLS
  printf("Client TLS [Supported TLS Version: block_len=%u/len=%u]\n", extension_len, version_len);
#endif
  
  if((s_offset+1+version_len) <= total_len && version_len > 0) {
    s_offset++;
    
    for(i=0; (i < version_len) && ((s_offset+i+1) < total_len); i += 2) {
      u_int16_t tls_version = ntohs(*((u_int16_t*)&packet->payload[s_offset+i]));
      
      if(i > 0 && version_offset < sizeof(ja3.client.supported_versions)-1) {
        ja3.client.supported_versions[version_offset++] = '-';
      }
      
      /* Skip GREASE */
      if((packet->payload[s_offset+i] != packet->payload[s_offset+i+1]) || (tls_version == 0)) {
        int rc = snprintf(&ja3.client.supported_versions[version_offset], 
                        sizeof(ja3.client.supported_versions)-version_offset, 
                        "%04X", tls_version);
        if(rc > 0) version_offset += rc;
      }
    }
    
    ja3.client.supported_versions[version_offset] = '\0';
    
#ifdef DEBUG_TLS
    printf("Client TLS [Supported TLS Version: %s]\n", ja3.client.supported_versions);
#endif
  }
} else if(extension_id == 65486 /* encrypted server name */ && 
         (offset+extension_offset+2) <= total_len) {
  u_int16_t s_offset = offset+extension_offset;
  u_int16_t esni_len = ntohs(*((u_int16_t*)&packet->payload[s_offset]));
  
  if((s_offset+2+esni_len) <= total_len) {
    /* This is ESNI: let's process it */
    flow->protos.tls_quic.encrypted_sni.esni = 1;
    
#ifdef DEBUG_TLS
    printf("Client TLS [ESNI: len=%u]\n", esni_len);
#endif
  }
} else if(extension_id == 0x39 /* QUIC transport parameters */ && 
         (offset+extension_offset+4) <= total_len) {
  u_int16_t s_offset = offset+extension_offset;
  u_int16_t param_offset = 0;
  
#ifdef DEBUG_TLS
  printf("Client TLS [QUIC transport parameters: len=%u]\n", extension_len);
#endif
  
  /* Process QUIC parameters */
  while((param_offset+4 <= extension_len) && 
        (s_offset+param_offset+4 <= total_len)) {
    u_int16_t param_id = ntohs(*((u_int16_t*)&packet->payload[s_offset+param_offset]));
    u_int16_t param_len = ntohs(*((u_int16_t*)&packet->payload[s_offset+param_offset+2]));
    
    if(param_id == 0x0d /* user_agent_id */ && 
       (s_offset+param_offset+4+param_len) <= total_len) {
      if(param_len > 0 && flow->protos.tls_quic.user_agent == NULL) {
        u_int16_t ua_len = param_len < 256 ? param_len : 255; /* Safety limit */
        flow->protos.tls_quic.user_agent = ndpi_malloc(ua_len+1);
        
        if(flow->protos.tls_quic.user_agent != NULL) {
          memcpy(flow->protos.tls_quic.user_agent, 
                &packet->payload[s_offset+param_offset+4], ua_len);
          flow->protos.tls_quic.user_agent[ua_len] = '\0';
        }
      }
    }
    
    /* Move to next parameter safely */
    if(param_len <= extension_len-param_offset-4)
      param_offset += 4 + param_len;
    else
      break;
  }
}