size_t bytecnt, linecnt;
const char *c;
if (m->str_range > 0) {
	if (m->str_flags & REGEX_LINECOUNT) {
		linecnt = m->str_range;
		/* Avoid overflow: ensure we don't exceed available bytes */
		if (linecnt > (nbytes - offset) / 80)
			bytecnt = nbytes - offset;
		else
			bytecnt = linecnt * 80;
	} else {
		bytecnt = m->str_range;
		linecnt = 0;
	}
} else {
	bytecnt = nbytes - offset;
	linecnt = 0;
}