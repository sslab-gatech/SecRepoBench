const char *buf, *end, *last, *b, *c;
size_t bytecnt = m->vallen ? m->vallen : nbytes - offset;
size_t linecnt = m->str_flags & REGEX_LINES ? m->str_flags & REGEX_LINES : 0;

if (linecnt) {
    bytecnt = linecnt * 1024; // Assuming each line is at most 1024 bytes
}