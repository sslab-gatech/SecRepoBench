const char *buf, *end, *last, *c;
size_t lines, bytecnt, linecnt;
int32_t regex_flags = m->str_flags;

// Initialize the buffer and end pointers
buf = RCAST(const char *, source) + offset;
end = RCAST(const char *, source) + nbytes;

// Determine the byte count and line count for the search
if (regex_flags & REGEX_LINE_COUNT) {
    linecnt = m->vallen;
    bytecnt = linecnt * 80; // Assume 80 characters per line
} else {
    linecnt = 0;
    bytecnt = m->vallen;
}