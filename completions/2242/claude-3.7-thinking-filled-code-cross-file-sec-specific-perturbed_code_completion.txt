const char *buf, *end, *last, *c;
size_t bytecnt, linecnt;
int lines;
const char *b;

// If the MAGIC_LINECOUNT flag is set in 'm', use line count
if (m->str_flags & MAGIC_LINECOUNT) {
    linecnt = m->str_range;
    bytecnt = linecnt * 80; // Assume 80 chars per line
} else {
    linecnt = 0;
    bytecnt = m->str_range;
}