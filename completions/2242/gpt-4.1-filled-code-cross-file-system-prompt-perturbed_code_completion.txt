const char *buf, *end, *last, *b, *c;
size_t bytecnt, linecnt, lines;

if (offset > nbytes)
	offset = CAST(uint32_t, nbytes);

linecnt = 0;
if ((m->str_flags & STRING_LINE_COUNT) != 0) {
	linecnt = m->str_range;
	bytecnt = linecnt * 80; /* estimate 80 bytes per line */
} else {
	bytecnt = m->str_range;
}