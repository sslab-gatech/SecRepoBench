size_t bytecnt = 0, linecnt = 0;
const char *buf = NULL, *end = NULL, *last = NULL;

if (source == NULL || offset >= nbytes) {
	ms->search.s = "";
	ms->search.s_len = 0;
	ms->search.offset = 0;
	return 0;
}

if (m->str_flags & REGEX_LINES) {
	linecnt = m->range;
	if (linecnt > 0)
		bytecnt = linecnt * 80; // Assuming average line length of 80 bytes
	else
		bytecnt = nbytes - offset;
} else {
	bytecnt = m->range;
}