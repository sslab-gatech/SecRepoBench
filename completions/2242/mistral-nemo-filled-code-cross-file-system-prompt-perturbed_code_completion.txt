if (linecnt == 0) {
		bytecnt = nbytes - offset;
	} else {
		const char *end = RCAST(const char *, source) + nbytes;
		const char *last = RCAST(const char *, source) + offset;
		int lines = linecnt;

		for (; lines && last < end; lines--, last++) {
			if (*last == '\n')
				break;
		}
		bytecnt = last - RCAST(const char *, source) + offset;
		if (bytecnt > ms->regex_max)
			bytecnt = ms->regex_max;
	}