size_t bytecnt;
unsigned int linecnt;
const char *buf, *last, *end, *b, *c;

if (m->str_range == 0)
    bytecnt = nbytes - offset;
else if (m->str_flags & REGEX_LINE_COUNT) {
    linecnt = m->str_range;
    /* Multiply the number of lines by an estimated average line length, e.g. 64 bytes per line */
    bytecnt = linecnt * 64;
} else {
    linecnt = UINT_MAX;
    bytecnt = m->str_range;
}