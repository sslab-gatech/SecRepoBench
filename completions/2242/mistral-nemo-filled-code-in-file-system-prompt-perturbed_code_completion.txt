private int
file_softmagic(struct magic_set *ms, const unsigned char *buf, size_t nbytes,
    uint16_t *indir_count, uint16_t *name_count, int mode, int text)
{
    // ... (existing code)

    // Masked region
    if (m->type == FILE_SEARCH || m->type == FILE_REGEX) {
        // ... (existing code)
    }

    // ... (remaining code)
}