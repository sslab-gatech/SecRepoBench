const char *buf, *end, *last, *c;
size_t bytecnt = m->str_range;
size_t lines = 0;
size_t linecnt = (m->str_flags & STRING_COMPACT_WHITESPACE) ?
    m->str_range : m->str_range * 2;

if (m->str_flags & STRING_COMPACT_WHITESPACE) {
    linecnt = m->str_range;
} else if (m->str_flags & STRING_FULL_LINES) {
    linecnt = m->str_range;
    bytecnt = 0;
} else {
    linecnt = m->str_range * 2;
}