size_t bytecnt = m->str_range;
const char *buf, *end, *last, *b, *c;
size_t lines = 0, linecnt = m->str_flags & STRING_LINE_COUNT;

if (linecnt) {
    bytecnt = linecnt * 80;  /* default line length */
} else if (m->str_flags & STRING_TRIM) {
    bytecnt = m->str_range;
}