const char *buf = RCAST(const char *, source) + offset;
size_t len = nbytes - offset;
size_t bytecnt = 0;
size_t linecnt = 0;

if (buf == NULL) {
    ms->search.s = NULL;
    ms->search.s_len = 0;
    ms->search.offset = offset;
    return 0;
}

if (m->str_flags & REGEX_LINECOUNT) {
    linecnt = m->vallen;
    bytecnt = linecnt * 80;  // Assuming 80 bytes per line
} else {
    bytecnt = m->vallen;
}