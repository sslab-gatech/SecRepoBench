const char *buf, *end, *last, *c, *b;
size_t bytecnt, linecnt;

// Handle NULL source safely
if (source == NULL) {
    ms->search.s = NULL;
    ms->search.s_len = 0;
    ms->search.offset = 0;
    ms->search.rm_len = 0;
    return 0;
}

// Determine line count and byte count based on flags and range
if (m->str_flags & REGEX_LINE_COUNT) {
    // If line count flag is set, limit to specified number of lines
    linecnt = m->str_range;
    bytecnt = linecnt * 160; // Estimate bytes needed for line count
} else {
    // Otherwise limit to specified byte count
    linecnt = 0; // No line limit
    bytecnt = m->str_range;
}