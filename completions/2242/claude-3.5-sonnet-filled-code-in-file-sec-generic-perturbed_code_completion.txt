const char *buf, *end, *last, *c;
size_t bytecnt = m->str_range;
size_t lines = 0;
size_t linecnt = (m->str_flags & STRING_COMPACT_WHITESPACE) ? 0 : m->str_range;

if (ms->search.s == NULL) {
    ms->search.s = RCAST(const char *, source);
    ms->search.s_len = nbytes - offset;
    ms->search.offset = offset;
}

if (m->str_flags & STRING_COMPACT_WHITESPACE)
    bytecnt = 0;
else if (m->str_flags & STRING_FULL)
    bytecnt = ms->search.s_len;