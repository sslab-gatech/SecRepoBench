const char *buf, *end, *last, *c;
size_t bytecnt, linecnt;

if (source == NULL || nbytes == 0) {
    ms->search.s = NULL;
    ms->search.s_len = 0;
    ms->search.offset = 0;
    return 0;
}

linecnt = m->str_range;
bytecnt = linecnt * 80;

if (m->str_flags & REGEX_LINE_COUNT) {
    bytecnt = linecnt * 80;
} else {
    bytecnt = m->str_range;
}