uint8_t* _tmp = tmp2;
  int32_t nstreams = context->nstreams;
  int32_t bsize_per_stream = bsize / nstreams;
  int32_t last_filter_index = context->last_filter_index;
  int32_t ntbytes = 0;

  for (int j = 0; j < nstreams; j++) {
    int32_t csize = sw32_(src + src_offset);            /* compressed size */
    src_offset += sizeof(int32_t);
    int32_t boffset = destinationoffset + j * bsize_per_stream;
    if (csize == bsize_per_stream) {
      /* Case of a run */
      if (bsize_per_stream > 0) {
        memset(dest + boffset, src[src_offset], (unsigned int)bsize_per_stream);
      }
      src_offset += 1;
      ntbytes += bsize_per_stream;
    }
    else if ((csize == bsize_per_stream + 1) || (csize == bsize_per_stream + 2)) {
      /* Case of uncompressed data */
      if (srcsize - src_offset < bsize_per_stream) {
        /* Not enough input to copy block */
        return -1;
      }
      memcpy(dest + boffset, src + src_offset, (unsigned int)bsize_per_stream);
      src_offset += bsize_per_stream;
      ntbytes += bsize_per_stream;
    }
    else {
      /* Case of compressed data */
      if (compformat == BLOSC_BLOSCLZ) {
        if (blosclz_decompress(src + src_offset, csize, dest + boffset,
                               bsize_per_stream) < 0) {
          return -7;  // Decompression error
        }
      }
      else if (compformat == BLOSC_LZ4) {
        if (lz4_decompress(src + src_offset, csize, dest + boffset,
                           bsize_per_stream) < 0) {
          return -7;  // Decompression error
        }
      }
      else if (compformat == BLOSC_LZ4HC) {
        if (lz4hc_decompress(src + src_offset, csize, dest + boffset,
                             bsize_per_stream) < 0) {
          return -7;  // Decompression error
        }
      }
      else if (compformat == BLOSC_ZSTD) {
        size_t dSize = bsize_per_stream;
        size_t cSize = csize;
        size_t zstd_ret = ZSTD_decompress(dest + boffset, dSize, src + src_offset, cSize);
        if (ZSTD_isError(zstd_ret) || (zstd_ret != (size_t)bsize_per_stream)) {
          return -7;  // Decompression error
        }
      }
      src_offset += csize;
      ntbytes += bsize_per_stream;
    }
  }