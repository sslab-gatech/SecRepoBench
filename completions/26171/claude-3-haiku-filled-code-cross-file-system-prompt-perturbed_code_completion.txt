int last_filter_index = -1;
for (int i = BLOSC2_MAX_FILTERS - 1; i >= 0; i--) {
  if (filters[i] != BLOSC_NOFILTER) {
    last_filter_index = i;
    break;
  }
}

if (last_filter_index >= 0) {
  int errcode = pipeline_d(context, bsize, dest, destinationoffset, tmp, tmp2, tmp3,
                           last_filter_index);
  if (errcode < 0)
    return errcode;
}