int ntbytes;

if (memcpyed) {
  // Check that sizes in header are compatible, otherwise there is a header corruption
  int32_t csize = sw32_(context->src + 12);   /* compressed buffer size */
  if (context->sourcesize + BLOSC_MAX_OVERHEAD != csize) {
    return -1;
  }
  if (context->srcsize < BLOSC_MAX_OVERHEAD + (j * context->blocksize) + bsize) {
    /* Not enough input to copy block */
    return -1;
  }
  memcpy(context->dest + j * context->blocksize,
         context->src + BLOSC_MAX_OVERHEAD + j * context->blocksize,
         (unsigned int)bsize);
  cbytes = (int32_t)bsize;
}
else {
  /* Regular decompression */
  cbytes = blosc_d(thread_context, bsize, leftoverblock,
                   context->src, context->srcsize, sw32_(bstarts + j),
                   context->dest, j * context->blocksize, tmp, tmp2);
}

if (cbytes < 0) {
  ntbytes = cbytes;         /* error in blosc_c or blosc_d */
  break;
}
ntbytes += cbytes;