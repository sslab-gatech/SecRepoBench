int32_t nstreams = context->nstreams;
  int32_t j;
  int32_t ntbytes = 0;
  int32_t last_filter_index = -1;
  int32_t cbytes;
  uint8_t* dest_ptr = dest + destinationoffset;
  for (j = 0; j < nstreams; j++) {
    int32_t csize = sw32_(src + src_offset);
    src_offset += 4;
    if (csize == 0) {
      /* uncompressible data */
      cbytes = 0;
    }
    else if (csize < 0) {
      /* run */
      int32_t run_length = -csize;
      int32_t run_value = src[src_offset];
      src_offset += 1;
      memset(dest_ptr, run_value, run_length);
      cbytes = run_length;
    }
    else {
      /* compressed data */
      int32_t comp_size = csize;
      int32_t uncomp_size = sw32_(src + src_offset);
      src_offset += 4;
      int32_t errcode = blosc_decompress_internal(
          context, compformat, src + src_offset, comp_size, dest_ptr, uncomp_size, tmp, tmp2, tmp3, &last_filter_index);
      if (errcode < 0)
        return errcode;
      src_offset += comp_size;
      cbytes = uncomp_size;
    }
    dest_ptr += cbytes;
    ntbytes += cbytes;
  }