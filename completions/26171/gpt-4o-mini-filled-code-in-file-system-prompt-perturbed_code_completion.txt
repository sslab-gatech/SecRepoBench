ntbytes = 0;  /* Initialize the number of uncompressed bytes */
  int32_t bsize; /* Size of the current block */
  int32_t leftoverblock; /* Flag for leftover block */
  int32_t cbytes; /* Compressed bytes for the current block */
  int32_t nblocks = context->nblocks; /* Total number of blocks */
  int32_t leftover = context->leftover; /* Extra bytes at the end of the buffer */
  int32_t* bstarts = context->bstarts; /* Start pointers for each block */
  
  for (int j = 0; j < nblocks; j++) {
    bsize = context->blocksize; /* Set block size */
    leftoverblock = 0; /* Reset leftover block flag */
    
    if ((j == nblocks - 1) && (leftover > 0)) {
      bsize = leftover; /* Adjust for the last block */
      leftoverblock = 1; /* Set leftover block flag */
    }

    /* Decompress the current block */
    cbytes = blosc_d(thread_context, bsize, leftoverblock,
                     src, srcsize, sw32_(bstarts + j),
                     dest, destinationoffset + ntbytes, tmp, tmp2);
    
    if (cbytes < 0) {
      return cbytes; /* Return error code */
    }
    
    ntbytes += cbytes; /* Accumulate the number of uncompressed bytes */
  }