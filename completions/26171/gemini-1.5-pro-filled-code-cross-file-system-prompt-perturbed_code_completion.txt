int32_t nstreams = context->nstreams;
  int32_t bsize2 = bsize / nstreams;
  int32_t last_filter_index = context->last_filter_index;
  uint64_t ntbytes = 0;

  for (int j = 0; j < nstreams; j++) {
    int32_t bsize3 = bsize2;
    int32_t leftoverblock2 = 0;
    if ((j == nstreams - 1) && (leftoverblock == 1)) {
      bsize3 = context->leftover;
      leftoverblock2 = 1;
    }
    int32_t csize = sw32_(src + src_offset);   /* compressed buffer size */
    src_offset += sizeof(int32_t);
    uint8_t* dest2 = dest + destinationoffset + j * bsize2;
    if (csize == bsize3) {
      /* Case of a run */
      memset(dest2, src[src_offset], (unsigned int)bsize3);
      src_offset += 1;
      ntbytes += bsize3;
    }
    else if (csize == 0) {
      /* Case of uncompressed data */
      memcpy(dest2, src + src_offset, (unsigned int)bsize3);
      src_offset += bsize3;
      ntbytes += bsize3;
    }
    else {
      /* Case of compressed data */
      if (compformat == BLOSC_BLOSCLZ) {
        if (blosclz_decompress(src + src_offset, csize, dest2, bsize3) < 0) {
          return -7;  // Decompression error
        }
      }
      else if (compformat == BLOSC_LZ4) {
        if (lz4_decompress(src + src_offset, csize, dest2, bsize3) < 0) {
          return -7;  // Decompression error
        }
      }
      else if (compformat == BLOSC_LZ4HC) {
        if (lz4hc_decompress(src + src_offset, csize, dest2, bsize3) < 0) {
          return -7;  // Decompression error
        }
      }
      else if (compformat == BLOSC_ZSTD) {
        size_t dsize = bsize3;
        size_t csize2 = csize;
        size_t ret = ZSTD_decompress(dest2, dsize, src + src_offset, csize2);
        if (ZSTD_isError(ret) || ret != (size_t)bsize3) {
          return -7;  // Decompression error
        }
      }
      src_offset += csize;
      ntbytes += bsize3;
    }
  }