int32_t nstreams = context->nstreams;
uint8_t* iptr = src + src_offset;
uint8_t* optr = dest + destinationoffset;
int32_t total_uncompressed_bytes = 0;

for (int32_t j = 0; j < nstreams; ++j) {
  int32_t compressed_size = *(int32_t*)iptr; // Assuming size is stored at the beginning of each stream
  iptr += sizeof(int32_t);

  if ((iptr + compressed_size) > (src + srcsize)) {
    return -1; // Error: Compressed data exceeds source buffer bounds
  }

  if (compressed_size == 0) {
    // Handle uncompressed data
    memcpy(optr, iptr, bsize);
    total_uncompressed_bytes += bsize;
  }
  else {
    // Decompress data
    int32_t decompressed_size = bsize;
    uint8_t* temp_buffer = tmp;

    if (!decompress_data(iptr, compressed_size, temp_buffer, &decompressed_size)) {
      return -2; // Error: Decompression failed
    }

    memcpy(optr, temp_buffer, decompressed_size);
    total_uncompressed_bytes += decompressed_size;
  }

  iptr += compressed_size;
  optr += bsize;
}

ntbytes = total_uncompressed_bytes;