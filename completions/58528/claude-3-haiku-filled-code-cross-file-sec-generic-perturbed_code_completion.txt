// concatenate the candidate lists for the current frame
while (rpl_tmp.nb_refs < sh->nb_refs[list_idx]) {
    int cand_list_idx = cand_lists[rpl_tmp.nb_refs % 3];
    int nb_refs = s->rps[cand_list_idx].nb_refs;
    for (i = 0; i < nb_refs; i++) {
        if (s->rps[cand_list_idx].used[i]) {
            rpl_tmp.list[rpl_tmp.nb_refs] = s->rps[cand_list_idx].poc[i];
            rpl_tmp.ref[rpl_tmp.nb_refs] = s->ref->refPicList[cand_list_idx].ref[i];
            rpl_tmp.isLongTerm[rpl_tmp.nb_refs] = cand_list_idx == LT_CURR;
            rpl_tmp.nb_refs++;
        }
    }
    if (s->ps.pps->pps_curr_pic_ref_enabled_flag && rpl_tmp.nb_refs < sh->nb_refs[list_idx]) {
        rpl_tmp.list[rpl_tmp.nb_refs] = s->ref->poc;
        rpl_tmp.ref[rpl_tmp.nb_refs] = s->ref;
        rpl_tmp.isLongTerm[rpl_tmp.nb_refs] = 0;
        rpl_tmp.nb_refs++;
    }
}