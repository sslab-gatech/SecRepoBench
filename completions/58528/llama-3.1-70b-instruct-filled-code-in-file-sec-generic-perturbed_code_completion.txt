for (int j = 0; j < 3; j++) {
    RefPicList *rpl = &s->rps[cand_lists[j]];
    for (i = 0; i < rpl->nb_refs; i++) {
        if (rpl_tmp.nb_refs >= sh->nb_refs[list_idx])
            break;
        if (rpl->list[i] == s->ref->poc)
            continue;
        rpl_tmp.list[rpl_tmp.nb_refs] = rpl->list[i];
        rpl_tmp.ref[rpl_tmp.nb_refs]  = rpl->ref[i];
        rpl_tmp.isLongTerm[rpl_tmp.nb_refs] = rpl->isLongTerm[i];
        rpl_tmp.nb_refs++;
    }
}