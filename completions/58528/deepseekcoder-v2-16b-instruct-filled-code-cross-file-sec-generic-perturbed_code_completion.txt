// Iterate over the candidate reference picture lists (ST_CURR_BEF, ST_CURR_AFT, LT_CURR).
        // For each candidate list, append its references to a temporary reference picture list.
        // If the current picture reference is enabled by the PPS, add the current picture as a reference.
        for (i = 0; i < 3; i++) {
            int cand_list_idx = cand_lists[i];
            int nb_refs_in_cand_list = (cand_list_idx == ST_CURR_BEF || cand_list_idx == ST_CURR_AFT) ? s->rps[cand_list_idx].nb_refs : s->rps[LT_CURR].nb_refs;

            for (int j = 0; j < nb_refs_in_cand_list; j++) {
                RefPic *ref_pic = (cand_list_idx == ST_CURR_BEF || cand_list_idx == ST_CURR_AFT) ? &s->rps[cand_list_idx].refs[j] : &s->rps[LT_CURR].refs[j];

                if (s->ps.pps->pps_curr_pic_ref_enabled_flag && ref_pic->is_current) {
                    rpl_tmp.list[rpl_tmp.nb_refs] = ref_pic;
                    rpl_tmp.ref[rpl_tmp.nb_refs] = ref_pic->frame;
                    rpl_tmp.isLongTerm[rpl_tmp.nb_refs] = (cand_list_idx == LT_CURR);
                    rpl_tmp.nb_refs++;
                }
            }
        }