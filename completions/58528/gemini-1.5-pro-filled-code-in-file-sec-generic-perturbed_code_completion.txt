for (int j = 0; j < 3; j++) {
                int type = cand_lists[j];
                for (int k = 0; k < s->rps[type].nb_refs; k++) {
                    if (rpl_tmp.nb_refs < sh->nb_refs[list_idx]) {
                        rpl_tmp.list[rpl_tmp.nb_refs] = s->rps[type].list[k];
                        rpl_tmp.ref[rpl_tmp.nb_refs] = s->rps[type].ref[k];
                        rpl_tmp.isLongTerm[rpl_tmp.nb_refs] =
                            s->rps[type].isLongTerm[k];
                        rpl_tmp.nb_refs++;
                    }
                }
            }

            if (s->ps.pps->pps_curr_pic_ref_enabled_flag) {
                if (rpl_tmp.nb_refs < sh->nb_refs[list_idx]) {
                    rpl_tmp.list[rpl_tmp.nb_refs] = s->ref->poc;
                    rpl_tmp.ref[rpl_tmp.nb_refs] = s->ref;
                    rpl_tmp.nb_refs++;
                }
            }