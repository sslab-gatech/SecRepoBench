while (rpl_tmp.nb_refs < sh->nb_refs[list_idx]) {
            // Iterate over the candidate reference picture lists (ST_CURR_BEF, ST_CURR_AFT, LT_CURR).
            // For each candidate list, append its references to a temporary reference picture list.
            // If the current picture reference is enabled by the PPS, add the current picture as a reference.
            int cand_list = cand_lists[rpl_tmp.nb_refs % 3];
            RefPicList *cand_rpl = &s->rps[cand_list];

            if (cand_list == LT_CURR && cand_rpl->nb_refs < s->ps.sps->max_num_ref_frames) {
                rpl_tmp.list[rpl_tmp.nb_refs] = s->ref->poc;
                rpl_tmp.ref[rpl_tmp.nb_refs]  = s->ref;
                rpl_tmp.isLongTerm[rpl_tmp.nb_refs] = 1;
                rpl_tmp.nb_refs++;
            } else if (cand_list != LT_CURR && cand_rpl->nb_refs < HEVC_MAX_REFS) {
                rpl_tmp.list[rpl_tmp.nb_refs] = cand_rpl->list[cand_rpl->nb_refs];
                rpl_tmp.ref[rpl_tmp.nb_refs]  = cand_rpl->ref[cand_rpl->nb_refs];
                rpl_tmp.isLongTerm[rpl_tmp.nb_refs] = 0;
                rpl_tmp.nb_refs++;
            }
        }