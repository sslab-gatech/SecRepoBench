for (int j = 0; j < FF_ARRAY_ELEMS(cand_lists); j++) {
                int type = cand_lists[j];
                for (int k = 0; k < rps[type].nb_refs &&
                                 rpl_tmp.nb_refs < sh->nb_refs[list_idx]; k++) {
                    rpl_tmp.list[rpl_tmp.nb_refs] = rps[type].list[k];
                    rpl_tmp.ref[rpl_tmp.nb_refs]  = rps[type].ref[k];
                    rpl_tmp.isLongTerm[rpl_tmp.nb_refs] = rps[type].isLongTerm[k];
                    rpl_tmp.nb_refs++;
                }
            }

            if (s->ps.pps->pps_curr_pic_ref_enabled_flag &&
                rpl_tmp.nb_refs < sh->nb_refs[list_idx]) {
                rpl_tmp.list[rpl_tmp.nb_refs] = s->poc;
                rpl_tmp.ref[rpl_tmp.nb_refs] = s->ref;
                rpl_tmp.nb_refs++;
            }