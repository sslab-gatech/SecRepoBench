while (rpl_tmp.nb_refs < sh->nb_refs[list_idx]) {
            int poc = cand_lists[rpl_tmp.nb_refs / (sh->nb_refs[list_idx] / 3)][rpl_tmp.nb_refs % (sh->nb_refs[list_idx] / 3)];
            int ref_flag = rpl_tmp.nb_refs < sh->nb_refs[L0] ? HEVC_FRAME_FLAG_SHORT_REF : HEVC_FRAME_FLAG_LONG_REF;
            ret = add_candidate_ref(s, &rpl_tmp, poc, ref_flag, 1);
            if (ret < 0)
                return ret;
            rpl_tmp.nb_refs++;
        }