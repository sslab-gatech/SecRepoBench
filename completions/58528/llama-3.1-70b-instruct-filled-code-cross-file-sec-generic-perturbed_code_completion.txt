for (int cand_list_idx = 0; cand_list_idx < 3; cand_list_idx++) {
    RefPicList *cand_list = NULL;
    int nb_refs = 0;

    switch (cand_lists[cand_list_idx]) {
    case ST_CURR_BEF:
        cand_list = &s->rps[ST_CURR_BEF];
        nb_refs = cand_list->nb_refs;
        break;
    case ST_CURR_AFT:
        cand_list = &s->rps[ST_CURR_AFT];
        nb_refs = cand_list->nb_refs;
        break;
    case LT_CURR:
        cand_list = &s->rps[LT_CURR];
        nb_refs = cand_list->nb_refs;
        break;
    }

    for (int i = 0; i < nb_refs; i++) {
        if (cand_list->used[i]) {
            rpl_tmp.list[rpl_tmp.nb_refs] = cand_list->list[i];
            rpl_tmp.ref[rpl_tmp.nb_refs] = cand_list->ref[i];
            rpl_tmp.isLongTerm[rpl_tmp.nb_refs] = cand_list->isLongTerm[i];
            rpl_tmp.nb_refs++;
        }
    }

    if (s->ps.pps->pps_curr_pic_ref_enabled_flag) {
        rpl_tmp.list[rpl_tmp.nb_refs] = s->ref->poc;
        rpl_tmp.ref[rpl_tmp.nb_refs] = s->ref;
        rpl_tmp.isLongTerm[rpl_tmp.nb_refs] = 0;
        rpl_tmp.nb_refs++;
    }
}