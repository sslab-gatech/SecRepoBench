if (*InputFmt == 0 && *OutputFormat == 0) {
    // Both input and output are uninitialized, use default 8-bit formatters
    *InputFmt = TYPE_RGB_8;
    *OutputFormat = TYPE_RGB_8;
    *dwFlags |= cmsFLAGS_CAN_CHANGE_FORMATTER;

    p->FromInput = _cmsGetFormatter(ContextID, *InputFmt, cmsFormatterInput, CMS_PACK_FLAGS_16BITS).Fmt16;
    p->ToOutput  = _cmsGetFormatter(ContextID, *OutputFormat, cmsFormatterOutput, CMS_PACK_FLAGS_16BITS).Fmt16;
}
else {
    // Obtain the formatters for input and output
    p->FromInput = _cmsGetFormatter(ContextID, *InputFmt,  cmsFormatterInput,  CMS_PACK_FLAGS_16BITS).Fmt16;
    p->ToOutput  = _cmsGetFormatter(ContextID, *OutputFormat, cmsFormatterOutput, CMS_PACK_FLAGS_16BITS).Fmt16;

    // If any formatter is unavailable, report error and exit
    if (!p->FromInput || !p->ToOutput) {
        cmsSignalError(ContextID, cmsERROR_UNKNOWN_EXTENSION, "Unsupported raster format");
        cmsDeleteTransform(p);
        return NULL;
    }
}

// Determine bytes per pixel for the input format
{
    cmsUInt32Number bpp = T_BYTES(*InputFmt);
    // If conditions are met, allow further format changes
    if (bpp == 2) {
        *dwFlags |= cmsFLAGS_CAN_CHANGE_FORMATTER;
    }
}