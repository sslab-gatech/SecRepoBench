if (*InputFmt == 0 || *OutputFormat == 0) {

    // Assign default 16-bit formats
    *InputFmt     = TYPE_RGB_16;
    *OutputFormat = TYPE_RGB_16;

    // Allow the transform to change formatters later
    *dwFlags |= cmsFLAGS_CAN_CHANGE_FORMATTER;

    // Retrieve default 16-bit formatters
    p->FromInput = _cmsGetFormatter(ContextID, *InputFmt, cmsFormatterInput, CMS_PACK_FLAGS_16BITS).Fmt16;
    p->ToOutput  = _cmsGetFormatter(ContextID, *OutputFormat, cmsFormatterOutput, CMS_PACK_FLAGS_16BITS).Fmt16;

    // Validate
    if (p->FromInput == NULL || p->ToOutput == NULL) {
        cmsSignalError(ContextID, cmsERROR_UNKNOWN_EXTENSION, "Unsupported default raster format");
        cmsDeleteTransform(p);
        return NULL;
    }

} else {

    // Obtain the appropriate formatters
    p->FromInput = _cmsGetFormatter(ContextID, *InputFmt, cmsFormatterInput, CMS_PACK_FLAGS_16BITS).Fmt16;
    p->ToOutput  = _cmsGetFormatter(ContextID, *OutputFormat, cmsFormatterOutput, CMS_PACK_FLAGS_16BITS).Fmt16;

    // If formatters are unavailable, we cannot continue
    if (p->FromInput == NULL || p->ToOutput == NULL) {
        cmsSignalError(ContextID, cmsERROR_UNKNOWN_EXTENSION, "Unsupported raster format");
        cmsDeleteTransform(p);
        return NULL;
    }

    // If either input or output is float or at least 16 bits, allow changing formatters
    if (_cmsFormatterIsFloat(*InputFmt)  ||
        _cmsFormatterIsFloat(*OutputFormat) ||
        _cmsFormatterIs16bits(*InputFmt)    ||
        _cmsFormatterIs16bits(*OutputFormat))
    {
        *dwFlags |= cmsFLAGS_CAN_CHANGE_FORMATTER;
    }
}