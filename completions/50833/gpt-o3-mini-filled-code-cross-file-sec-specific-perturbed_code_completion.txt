if (*InputFmt == 0 || *OutputFormat == 0) {

    // Uninitialized formats: assign default 16-bit formats and allow formatter change.
    // The default formats must be defined elsewhere. For this example we assume they are:
    // cmsFLAGS_DEFAULT_INPUT_FORMAT and cmsFLAGS_DEFAULT_OUTPUT_FORMAT
    *InputFmt  = cmsFLAGS_DEFAULT_INPUT_FORMAT;
    *OutputFormat = cmsFLAGS_DEFAULT_OUTPUT_FORMAT;
    *dwFlags   |= cmsFLAGS_CAN_CHANGE_FORMATTER;

    p->FromInput = _cmsGetFormatter(ContextID, *InputFmt, cmsFormatterInput, CMS_PACK_FLAGS_16BITS).Fmt16;
    p->ToOutput  = _cmsGetFormatter(ContextID, *OutputFormat, cmsFormatterOutput, CMS_PACK_FLAGS_16BITS).Fmt16;

    if (p->FromInput == NULL || p->ToOutput == NULL) {
         cmsSignalError(ContextID, cmsERROR_UNKNOWN_EXTENSION, "Unsupported default raster format");
         cmsDeleteTransform(p);
         return NULL;
    }

} else {

    // Obtain the formatters using the provided (non-zero) formats.
    p->FromInput = _cmsGetFormatter(ContextID, *InputFmt, cmsFormatterInput, CMS_PACK_FLAGS_16BITS).Fmt16;
    p->ToOutput  = _cmsGetFormatter(ContextID, *OutputFormat, cmsFormatterOutput, CMS_PACK_FLAGS_16BITS).Fmt16;

    if (p->FromInput == NULL || p->ToOutput == NULL) {
         cmsSignalError(ContextID, cmsERROR_UNKNOWN_EXTENSION, "Unsupported raster format");
         cmsDeleteTransform(p);
         return NULL;
    }

    // Determine bytes per pixel for the input format.
    {
         cmsUInt32Number BytesPerPixel = _cmsFormatterFormatToBytes(*InputFmt);
         if (BytesPerPixel == 0) {
              cmsSignalError(ContextID, cmsERROR_UNKNOWN_EXTENSION, "Invalid input format");
              cmsDeleteTransform(p);
              return NULL;
         }
         // If the bytes per pixel falls below the expected minimum for 16-bit processing,
         // update flags to allow the formatter to be changed later.
         if (BytesPerPixel < sizeof(cmsUInt16Number))
              *dwFlags |= cmsFLAGS_CAN_CHANGE_FORMATTER;
    }
}