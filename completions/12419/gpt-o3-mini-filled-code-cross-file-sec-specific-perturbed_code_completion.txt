ID = xmlNodeListGetString(doc, attr->children, 1);
if (ID == NULL)
    return(-1);

id = xmlHashLookup(idtable, ID);
xmlFree(ID);
if (id == NULL || id->attr != attr)
    return(-1);

{
    xmlChar *newName = xmlStrdup(attr->name);
    if (newName == NULL)
        return(-1);
    if (id->name != NULL)
        xmlFree(id->name);
    id->name = newName;
}

id->attr = NULL;
return(0);