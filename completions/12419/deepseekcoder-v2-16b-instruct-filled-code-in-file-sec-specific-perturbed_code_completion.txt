XML content, or NULL if the current node
 *         is neither an element nor attribute, or has no child nodes. The
 *         string must be deallocated by the caller.
 */
xmlChar *
xmlTextReaderReadOuterXml(xmlTextReaderPtr reader ATTRIBUTE_UNUSED)
{
    xmlChar *resbuf;
    xmlNodePtr node, cur_node;
    xmlBufferPtr buff, buff2;
    xmlDocPtr doc;

    if (xmlTextReaderExpand(reader) == NULL) {
        return NULL;
    }
    doc = reader->node->doc;
    buff = xmlBufferCreate();
    node = xmlDocCopyNode(reader->node, doc, 1);
    buff2 = xmlBufferCreate();
    if (xmlNodeDump(buff2, doc, node, 0, 0) == -1) {
        xmlFreeNode(node);
        xmlBufferFree(buff2);
        xmlBufferFree(buff);
        return NULL;
    }
    xmlBufferCat(buff, buff2->content);
    xmlFreeNode(node);
    xmlBufferFree(buff2);

    for (cur_node = reader->node->children; cur_node != NULL;
         cur_node = cur_node->next) {
        /* XXX: Why is the node copied? */
        node = xmlDocCopyNode(cur_node, doc, 1);
        buff2 = xmlBufferCreate();
        if (xmlNodeDump(buff2, doc, node, 0, 0) == -1) {
            xmlFreeNode(node);
            xmlBufferFree(buff2);
            xmlBufferFree(buff);
            return NULL;
        }
        xmlBufferCat(buff, buff2->content);
        xmlFreeNode(node);
        xmlBufferFree(buff2);
    }
    resbuf = buff->content;
    buff->content = NULL;

    xmlBufferFree(buff);
    return resbuf;
}
#endif

/**
 * xmlTextReaderReadString:
 * @reader:  the xmlTextReaderPtr used
 *
 * Reads the contents of the current node and concatenates it to the
 * string returned by the function.
 *
 * Returns a string containing the content, or NULL if the current node
 *         is neither a text nor a CDATA node. The string must be
 *         deallocated by the caller.
 */
xmlChar *
xmlTextReaderReadString(xmlTextReaderPtr reader) {
    xmlChar *resbuf;
    xmlBufferPtr buff;

    if (xmlTextReaderExpand(reader) == NULL) {
        return NULL;
    }
    if ((reader->node->type != XML_TEXT_NODE) &&
        (reader->node->type != XML_CDATA_SECTION_NODE)) {
        return NULL;
    }
    buff = xmlBufferCreate();
    if (xmlBufferAdd(buff, reader->node->content,
                     xmlStrlen(reader->node->content)) == -1) {
        xmlBufferFree(buff);
        return NULL;
    }
    resbuf = buff->content;
    buff->content = NULL;

    xmlBufferFree(buff);
    return resbuf;
}

/**
 * xmlTextReaderGetAttribute:
 * @reader:  the xmlTextReaderPtr used
 * @name:  the name of the attribute
 *
 * Gets the value of an attribute of the current node.
 *
 * Returns the value of the attribute or NULL if the attribute is not found.
 *         The string must be deallocated by the caller.
 */
xmlChar *
xmlTextReaderGetAttribute(xmlTextReaderPtr reader, const xmlChar *name) {
    xmlAttrPtr attr;

    if (reader == NULL)
	return(NULL);
    if (reader->node == NULL)
	return(NULL);
    if (reader->node->properties == NULL)
	return(NULL);

    attr = xmlHasNsProp(reader->node, name, NULL);
    if (attr == NULL)
	return(NULL);
    return(xmlNodeGetContent(attr));
}

/**
 * xmlTextReaderGetAttributeNo:
 * @reader:  the xmlTextReaderPtr used
 * @name:  the name of the attribute
 *
 * Gets the value of an attribute of the current node without namespace
 * prefix.
 *
 * Returns the value of the attribute or NULL if the attribute is not found.
 *         The string must be deallocated by the caller.
 */
xmlChar *
xmlTextReaderGetAttributeNo(xmlTextReaderPtr reader, const xmlChar *name) {
    xmlAttrPtr attr;

    if (reader == NULL)
	return(NULL);
    if (reader->node == NULL)
	return(NULL);
    if (reader->node->properties == NULL)
	return(NULL);

    attr = xmlHasProp(reader->node, name);
    if (attr == NULL)
	return(NULL);
    return(xmlNodeGetContent(attr));
}

/**
 * xmlTextReaderGetAttributeNs:
 * @reader:  the xmlTextReaderPtr used
 * @localName:  the local name of the attribute
 * @namespaceURI:  the namespace URI of the attribute
 *
 * Gets the value of an attribute of the current node.
 *
 * Returns the value of the attribute or NULL if the attribute is not found.
 *         The string must be deallocated by the caller.
 */
xmlChar *
xmlTextReaderGetAttributeNs(xmlTextReaderPtr reader,
                            const xmlChar *localName,
                            const xmlChar *namespaceURI) {
    xmlAttrPtr attr;

    if (reader == NULL)
	return(NULL);
    if (reader->node == NULL)
	return(NULL);
    if (reader->node->properties == NULL)
	return(NULL);

    attr = xmlGetProp(reader->node, localName);
    if ((attr == NULL) ||
        ((namespaceURI != NULL) &&
         (!xmlStrEqual(attr->ns->href, namespaceURI))))
	return(NULL);
    return(xmlNodeGetContent(attr));
}

/**
 * xmlTextReaderGetParserProp:
 * @reader:  the xmlTextReaderPtr used
 * @prop:  the property to get
 *
 * Gets a property of the parser.
 *
 * Returns the value of the property or -1 in case of error.
 */
int
xmlTextReaderGetParserProp(xmlTextReaderPtr reader, int prop) {
    if (reader == NULL)
	return(-1);
    return(reader->ctxt->properties[prop]);
}

/**
 * xmlTextReaderSetParserProp:
 * @reader:  the xmlTextReaderPtr used
 * @prop:  the property to set
 * @value:  the value of the property
 *
 * Sets a property of the parser.
 *
 * Returns 0 in case of success and -1 in case of failure.
 */
int
xmlTextReaderSetParserProp(xmlTextReaderPtr reader, int prop, int value) {
    if (reader == NULL)
	return(-1);
    reader->ctxt->properties[prop] = value;
    return(0);
}

/**
 * xmlTextReaderPreserve:
 * @reader:  the xmlTextReaderPtr used
 *
 * Preserves the current node and its subtree.
 *
 * Returns 0 in case of success and -1 in case of failure.
 */
int
xmlTextReaderPreserve(xmlTextReaderPtr reader) {
    if (reader == NULL)
	return(-1);
    if (reader->node == NULL)
	return(-1);
    reader->node->extra |= NODE_IS_PRESERVED;
    return(0);
}

/**
 * xmlTextReaderGetNodeType:
 * @reader:  the xmlTextReaderPtr used
 *
 * Gets the type of the current node.
 *
 * Returns the type of the current node or -1 in case of error.
 */
int
xmlTextReaderGetNodeType(xmlTextReaderPtr reader) {
    if (reader == NULL)
	return(-1);
    if (reader->node == NULL)
	return(-1);
    return(reader->node->type);
}

/**
 * xmlTextReaderGetNodeName:
 * @reader:  the xmlTextReaderPtr used
 *
 * Gets the name of the current node.
 *
 * Returns the name of the current node or NULL in case of error.
 */
xmlChar *
xmlTextReaderGetNodeName(xmlTextReaderPtr reader) {
    if (reader == NULL)
	return(NULL);
    if (reader->node == NULL)
	return(NULL);
    return(reader->node->name);
}

/**
 * xmlTextReaderGetNodeNamespace:
 * @reader:  the xmlTextReaderPtr used
 *
 * Gets the namespace URI of the current node.
 *
 * Returns the namespace URI of the current node or NULL in case of error.
 */
xmlChar *
xmlTextReaderGetNodeNamespace(xmlTextReaderPtr reader) {
    if (reader == NULL)
	return(NULL);
    if (reader->node == NULL)
	return(NULL);
    if (reader->node->ns == NULL)
	return(NULL);
    return(reader->node->ns->href);
}

/**
 * xmlTextReaderGetNodeBaseUri:
 * @reader:  the xmlTextReaderPtr used
 *
 * Gets the base URI of the current node.
 *
 * Returns the base URI of the current node or NULL in case of error.
 */
xmlChar *
xmlTextReaderGetNodeBaseUri(xmlTextReaderPtr reader) {
    if (reader == NULL)
	return(NULL);
    if (reader->node == NULL)
	return(NULL);
    return(reader->node->base);
}

/**
 * xmlTextReaderGetNodePrefix:
 * @reader:  the xmlTextReaderPtr used
 *
 * Gets the namespace prefix of the current node.
 *
 * Returns the namespace prefix of the current node or NULL in case of error.
 */
xmlChar *
xmlTextReaderGetNodePrefix(xmlTextReaderPtr reader) {
    if (reader == NULL)
	return(NULL);
    if (reader->node == NULL)
	return(NULL);
    if (reader->node->ns == NULL)
	return(NULL);
    return(reader->node->ns->prefix);
}

/**
 * xmlTextReaderGetNodeIsEmpty:
 * @reader:  the xmlTextReaderPtr used
 *
 * Gets the empty status of the current node.
 *
 * Returns 1 if the node is empty, 0 otherwise.
 */
int
xmlTextReaderGetNodeIsEmpty(xmlTextReaderPtr reader) {
    if (reader == NULL)
	return(-1);
    if (reader->node == NULL)
	return(-1);
    return((reader->node->extra & NODE_IS_EMPTY) != 0);
}

/**
 * xmlTextReaderGetDepth:
 * @reader:  the xmlTextReaderPtr used
 *
 * Gets the depth of the current node.
 *
 * Returns the depth of the current node or -1 in case of error.
 */
int
xmlTextReaderGetDepth(xmlTextReaderPtr reader) {
    if (reader == NULL)
	return(-1);
    return(reader->depth);
}

/**
 * xmlTextReaderGetLineNumber:
 * @reader:  the xmlTextReaderPtr used
 *
 * Gets the line number of the current node.
 *
 * Returns the line number of the current node or -1 in case of error.
 */
int
xmlTextReaderGetLineNumber(xmlTextReaderPtr reader) {
    if (reader == NULL)
	return(-1);
    if (reader->node == NULL)
	return(-1);
    return(reader->node->line);
}

/**
 * xmlTextReaderGetColumnNumber:
 * @reader:  the xmlTextReaderPtr used
 *
 * Gets the column number of the current node.
 *
 * Returns the column number of the current node or -1 in case of error.
 */
int
xmlTextReaderGetColumnNumber(xmlTextReaderPtr reader) {
    if (reader == NULL)
	return(-1);
    if (reader->node == NULL)
	return(-1);
    return(reader->node->col);
}

/**
 * xmlTextReaderGetName:
 * @reader:  the xmlTextReaderPtr used
 *
 * Gets the name of the current node.
 *
 * Returns the name of the current node or NULL in case of error.
 */
xmlChar *
xmlTextReaderGetName(xmlTextReaderPtr reader) {
    if (reader == NULL)
	return(NULL);
    if (reader->node == NULL)
	return(NULL);
    return(reader->node->name);
}

/**
 * xmlTextReaderGetLocalName:
 * @reader:  the xmlTextReaderPtr used
 *
 * Gets the local name of the current node.
 *
 * Returns the local name of the current node or NULL in case of error.
 */
xmlChar *
xmlTextReaderGetLocalName(xmlTextReaderPtr reader) {
    if (reader == NULL)
	return(NULL);
    if (reader->node == NULL)
	return(NULL