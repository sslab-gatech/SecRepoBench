by the caller.
 */
xmlChar *
xmlTextReaderReadOuterXml(xmlTextReaderPtr reader ATTRIBUTE_UNUSED)
{
    xmlChar *resbuf;
    xmlBufferPtr buff, buff2;
    xmlDocPtr doc;

    if (xmlTextReaderExpand(reader) == NULL) {
        return NULL;
    }
    doc = reader->node->doc;
    buff = xmlBufferCreate();
    if (xmlNodeDump(buff, doc, reader->node, 0, 0) == -1) {
        xmlBufferFree(buff);
        return NULL;
    }
    buff2 = xmlBufferCreate();
    for (xmlNodePtr cur_node = reader->node->children; cur_node != NULL;
         cur_node = cur_node->next) {
        /* XXX: Why is the node copied? */
        xmlNodePtr node = xmlDocCopyNode(cur_node, doc, 1);
        if (xmlNodeDump(buff2, doc, node, 0, 0) == -1) {
            xmlFreeNode(node);
            xmlBufferFree(buff2);
            xmlBufferFree(buff);
            return NULL;
        }
        xmlFreeNode(node);
    }
    xmlBufferCat(buff, buff2->content);
    xmlBufferFree(buff2);
    resbuf = buff->content;
    buff->content = NULL;

    xmlBufferFree(buff);
    return resbuf;
}
#endif

/**
 * xmlTextReaderReadString:
 * @reader:  the xmlTextReaderPtr used
 *
 * Reads the contents of the current node and concatenates it to the
 * string returned by the function.
 *
 * Returns a string containing the content, or NULL in case of error.
 * The string must be deallocated by the caller.
 */
xmlChar *
xmlTextReaderReadString(xmlTextReaderPtr reader) {
    xmlChar *resbuf;
    xmlBufferPtr buff;

    if (xmlTextReaderExpand(reader) == NULL) {
        return NULL;
    }
    buff = xmlBufferCreate();
    if (xmlNodeDump(buff, reader->node->doc, reader->node, 0, 0) == -1) {
        xmlBufferFree(buff);
        return NULL;
    }
    resbuf = buff->content;
    buff->content = NULL;

    xmlBufferFree(buff);
    return resbuf;
}

/**
 * xmlTextReaderGetAttribute:
 * @reader:  the xmlTextReaderPtr used
 * @name:  the name of the attribute
 *
 * Get the value of an attribute of the current node.
 *
 * Returns the value of the attribute or NULL if the attribute is not found.
 */
xmlChar *
xmlTextReaderGetAttribute(xmlTextReaderPtr reader, const xmlChar *name) {
    xmlAttrPtr attr;

    if ((reader == NULL) || (reader->node == NULL))
        return(NULL);
    if (reader->node->type != XML_ELEMENT_NODE)
        return(NULL);
    attr = xmlHasProp(reader->node, name);
    if (attr == NULL)
        return(NULL);
    return(xmlNodeGetContent(attr));
}

/**
 * xmlTextReaderGetAttributeNo:
 * @reader:  the xmlTextReaderPtr used
 * @name:  the name of the attribute
 * @value:  pointer to store the value of the attribute
 *
 * Get the value of an attribute of the current node.
 *
 * Returns 1 if the attribute is found, 0 otherwise.
 */
int
xmlTextReaderGetAttributeNo(xmlTextReaderPtr reader, const xmlChar *name,
                            xmlChar **value) {
    xmlAttrPtr attr;

    if ((reader == NULL) || (reader->node == NULL))
        return(0);
    if (reader->node->type != XML_ELEMENT_NODE)
        return(0);
    attr = xmlHasProp(reader->node, name);
    if (attr == NULL)
        return(0);
    *value = xmlNodeGetContent(attr);
    return(1);
}

/**
 * xmlTextReaderGetAttributeNs:
 * @reader:  the xmlTextReaderPtr used
 * @localName:  the local name of the attribute
 * @namespaceURI:  the namespace URI of the attribute
 * @value:  pointer to store the value of the attribute
 *
 * Get the value of an attribute of the current node.
 *
 * Returns 1 if the attribute is found, 0 otherwise.
 */
int
xmlTextReaderGetAttributeNs(xmlTextReaderPtr reader,
                            const xmlChar *localName,
                            const xmlChar *namespaceURI,
                            xmlChar **value) {
    xmlAttrPtr attr;

    if ((reader == NULL) || (reader->node == NULL))
        return(0);
    if (reader->node->type != XML_ELEMENT_NODE)
        return(0);
    attr = xmlGetProp(reader->node, localName);
    if (attr == NULL)
        return(0);
    if ((namespaceURI != NULL) && (attr->ns != NULL) &&
        (xmlStrncasecmp(attr->ns->href, namespaceURI, xmlStrlen(namespaceURI)) != 0))
        attr = NULL;
    if (attr == NULL)
        return(0);
    *value = xmlNodeGetContent(attr);
    return(1);
}

/**
 * xmlTextReaderGetParserProp:
 * @reader:  the xmlTextReaderPtr used
 * @prop:  the property to get
 *
 * Get the value of a parser property.
 *
 * Returns the value of the property or -1 if the property is not found.
 */
int
xmlTextReaderGetParserProp(xmlTextReaderPtr reader, int prop) {
    if (reader == NULL)
        return(-1);
    return(reader->parserFlags & prop);
}

/**
 * xmlTextReaderSetParserProp:
 * @reader:  the xmlTextReaderPtr used
 * @prop:  the property to set
 * @value:  the value to set
 *
 * Set the value of a parser property.
 *
 * Returns the previous value of the property or -1 if the property is not found.
 */
int
xmlTextReaderSetParserProp(xmlTextReaderPtr reader, int prop, int value) {
    int old;

    if (reader == NULL)
        return(-1);
    old = reader->parserFlags & prop;
    if (value)
        reader->parserFlags |= prop;
    else
        reader->parserFlags &= ~prop;
    return(old);
}

/**
 * xmlTextReaderPreserve:
 * @reader:  the xmlTextReaderPtr used
 *
 * Preserve the current node and its subtree.
 */
void
xmlTextReaderPreserve(xmlTextReaderPtr reader) {
    if ((reader == NULL) || (reader->node == NULL))
        return;
    if (reader->node->type == XML_ELEMENT_NODE)
        reader->node->extra |= NODE_IS_PRESERVED;
    else if (reader->node->type == XML_TEXT_NODE)
        reader->node->extra |= NODE_IS_SPRESERVED;
}

/**
 * xmlTextReaderGetNodeType:
 * @reader:  the xmlTextReaderPtr used
 *
 * Get the type of the current node.
 *
 * Returns the type of the current node.
 */
int
xmlTextReaderGetNodeType(xmlTextReaderPtr reader) {
    if (reader == NULL)
        return(-1);
    return(reader->node->type);
}

/**
 * xmlTextReaderGetNodeName:
 * @reader:  the xmlTextReaderPtr used
 *
 * Get the name of the current node.
 *
 * Returns the name of the current node or NULL if the node has no name.
 */
xmlChar *
xmlTextReaderGetNodeName(xmlTextReaderPtr reader) {
    if (reader == NULL)
        return(NULL);
    return(reader->node->name);
}

/**
 * xmlTextReaderGetNodeNamespace:
 * @reader:  the xmlTextReaderPtr used
 *
 * Get the namespace of the current node.
 *
 * Returns the namespace of the current node or NULL if the node has no namespace.
 */
xmlChar *
xmlTextReaderGetNodeNamespace(xmlTextReaderPtr reader) {
    if (reader == NULL)
        return(NULL);
    if (reader->node->ns == NULL)
        return(NULL);
    return(reader->node->ns->href);
}

/**
 * xmlTextReaderGetNodeBaseUri:
 * @reader:  the xmlTextReaderPtr used
 *
 * Get the base URI of the current node.
 *
 * Returns the base URI of the current node or NULL if the node has no base URI.
 */
xmlChar *
xmlTextReaderGetNodeBaseUri(xmlTextReaderPtr reader) {
    if (reader == NULL)
        return(NULL);
    if (reader->node->base != -1)
        return(reader->input->base);
    return(NULL);
}

/**
 * xmlTextReaderGetNodePrefix:
 * @reader:  the xmlTextReaderPtr used
 *
 * Get the prefix of the current node.
 *
 * Returns the prefix of the current node or NULL if the node has no prefix.
 */
xmlChar *
xmlTextReaderGetNodePrefix(xmlTextReaderPtr reader) {
    if (reader == NULL)
        return(NULL);
    if (reader->node->ns == NULL)
        return(NULL);
    return(reader->node->ns->prefix);
}

/**
 * xmlTextReaderGetNodeUri:
 * @reader:  the xmlTextReaderPtr used
 *
 * Get the URI of the current node.
 *
 * Returns the URI of the current node or NULL if the node has no URI.
 */
xmlChar *
xmlTextReaderGetNodeUri(xmlTextReaderPtr reader) {
    if (reader == NULL)
        return(NULL);
    if (reader->node->ns == NULL)
        return(NULL);
    return(reader->node->ns->href);
}

/**
 * xmlTextReaderGetNodeLineNumber:
 * @reader:  the xmlTextReaderPtr used
 *
 * Get the line number of the current node.
 *
 * Returns the line number of the current node or -1 if the node has no line number.
 */
int
xmlTextReaderGetNodeLineNumber(xmlTextReaderPtr reader) {
    if (reader == NULL)
        return(-1);
    if (reader->node->line == -1)
        return(-1);
    return(reader->node->line);
}

/**
 * xmlTextReaderGetNodeColumnNumber:
 * @reader:  the xmlTextReaderPtr used
 *
 * Get the column number of the current node.
 *
 * Returns the column number of the current node or -1 if the node has no column number.
 */
int
xmlTextReaderGetNodeColumnNumber(xmlTextReaderPtr reader) {
    if (reader == NULL)
        return(-1);
    if (reader->node->col == -1)
        return(-1);
    return(reader->node->col);
}

/**
 * xmlTextReaderGetNodeNameCount:
 * @reader:  the xmlTextReaderPtr used
 *
 * Get the number of names of the current node.
 *
 * Returns the number of names of the current node.
 */
int
xmlTextReaderGetNodeNameCount(xmlTextReaderPtr reader) {
    if (reader == NULL)
        return(-1);
    return(reader->node->nsNr);
}

/**
 * xmlTextReaderGetNodeLocalName:
 * @reader:  the xmlTextReaderPtr used
 *
 * Get the local name of the current node.
 *
 * Returns the local name of the current node or NULL if the node has no local name.
 */
xmlChar *
xmlTextReaderGetNodeLocalName(xmlTextReaderPtr reader) {
    if (reader == NULL)
        return(NULL);
    return(reader->node->name);
}

/**
 * xmlTextReaderGetNodeNamespaceUri:
 * @reader:  the xmlTextReaderPtr used
 * @index:  the index of the namespace
 *
 * Get the URI of the namespace of the current node.
 *
 * Returns the URI of the namespace of the current node or NULL if the namespace is not found.
 */
xmlChar *
xmlTextReaderGetNodeNamespaceUri(xmlTextReaderPtr reader, int index) {
    if (reader == NULL)
        return(NULL);
    if (index < 0 || index >= reader->node->nsNr)
        return(NULL);
    return(reader->node->nsTab[index]->href);
}

/**
 * xmlTextReaderGetNodePrefixUri:
 * @reader:  the xmlTextReaderPtr used
 * @index:  the index of the namespace
 *
 * Get the prefix of the namespace of the current node.
 *
 * Returns the prefix of the namespace