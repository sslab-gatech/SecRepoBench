size_t i = 0;
while (i < 128 && i < *length)
{
    suffix[i] = (char) curin[i];
    if (suffix[i] == '\0')
    {
        ++i;
        break;
    }
    ++i;
}
if (i == 128 && suffix[127] != '\0')
{
    if (i >= *length) return EXR_ERR_CORRUPT_CHUNK;
    /* consume the trailing null from the input */
    ++i;
    suffix[128] = '\0';
}
else
{
    suffix[i] = '\0';
}

mem = (char*) alloc_fn (i);
if (!mem) return EXR_ERR_OUT_OF_MEMORY;

memcpy (mem, suffix, i);
out->_suffix = mem;
/* Mark _suffix as dynamically allocated in the output structure. */
out->_ownsSuffix = 1;

/* Update how many bytes of input we've consumed. */
len = i;