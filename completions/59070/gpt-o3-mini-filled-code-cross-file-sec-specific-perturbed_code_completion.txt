{
    /* Determine the length of the nullâ€terminated suffix string.
       The maximum allowed length (not including the null terminator) is 128.
       If no null terminator is found within the allowed bytes, the chunk is corrupt. */
    size_t sfx_len = strnlen((const char*)curin, 128 + 1);
    if (sfx_len > 128)
        return EXR_ERR_CORRUPT_CHUNK;

    /* Total bytes to consume including the terminating null. */
    len = sfx_len + 1;

    /* Copy input string into a stack buffer (suffix) ensuring it is null terminated.
       This is safe because suffix is sized for 128+1 bytes. */
    memcpy(suffix, curin, len);

    /* Allocate memory for the suffix string using the provided allocation function.
       Include space for the null terminator. */
    mem = alloc_fn(len);
    if (!mem)
        return EXR_ERR_OUT_OF_MEMORY;

    /* Copy the suffix string from the stack buffer to the allocated memory. */
    memcpy(mem, suffix, len);

    /* Store the pointer to the allocated string in the output structure and mark it
       as dynamically allocated. The specific flag/field name may vary. */
    out->_suffix = mem;
    out->_suffix_is_allocated = 1;
}