size_t scanned = 0;
while ((scanned < 128) && (scanned < *length))
{
    suffix[scanned] = (char) curin[scanned];
    if (suffix[scanned] == '\0')
    {
        scanned++;
        break;
    }
    scanned++;
}
if (scanned == 128 && suffix[127] != '\0')
{
    /* String not null-terminated in first 128 bytes, truncate. */
    suffix[127] = '\0';
    scanned = 128;
}
if (scanned == 0)
{
    /* If first character is already '\0', treat as empty but consume 1 byte. */
    suffix[0] = '\0';
    scanned = 1;
}
len = scanned;
if (len > *length) return EXR_ERR_CORRUPT_CHUNK;

mem = (char*) alloc_fn (len);
if (!mem) return EXR_ERR_OUT_OF_MEMORY;

memcpy (mem, suffix, len);

/* Store allocated string in output structure and mark it as dynamically allocated. */
out->_suffix = mem;
out->_ownsSuffix = DWA_CLASSIFIER_TRUE;