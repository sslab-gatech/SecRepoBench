size_t i = 0;
while (i < 128 && i < *length && curin[i] != 0)
{
    suffix[i] = (char) curin[i];
    ++i;
}

// If we didn't encounter a null terminator within available data, or string is too long
if (i == *length)
    return EXR_ERR_CORRUPT_CHUNK;
if (i == 128 && curin[i] != 0)
    return EXR_ERR_CORRUPT_CHUNK;

suffix[i] = 0;
len = i + 1;

// Allocate memory for the string (including its null terminator)
mem = (char*) alloc_fn(len);
if (!mem)
    return EXR_ERR_OUT_OF_MEMORY;

// Copy the string into the newly allocated memory
memcpy(mem, suffix, len);

// Store the pointer in the output structure and mark it as dynamically allocated
out->_suffix = mem;
out->_suffixAllocated = 1;