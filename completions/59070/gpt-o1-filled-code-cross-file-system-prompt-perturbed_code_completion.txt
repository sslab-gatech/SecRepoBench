{
    size_t str_len = 0;
    /* Read characters until a NULL is found or the maximum length is reached */
    while (str_len < 128 && str_len < *length && curin[str_len] != '\0')
    {
        suffix[str_len] = (char)curin[str_len];
        ++str_len;
    }

    /* If we've filled the buffer without seeing a NULL, it's corrupt or too long */
    if (str_len == 128 && curin[str_len] != '\0')
        return EXR_ERR_CORRUPT_CHUNK;

    /* NULL-terminate the suffix */
    suffix[str_len] = '\0';

    /* The total length used includes the terminating NULL */
    len = str_len + 1;
    if (len > *length) return EXR_ERR_CORRUPT_CHUNK;

    /* Allocate space for the string */
    mem = (char*)alloc_fn(len);
    if (!mem) return EXR_ERR_OUT_OF_MEMORY;

    /* Copy the suffix into newly allocated memory */
    memcpy(mem, suffix, len);

    /* Store in the output structure, mark it as dynamically allocated */
    out->_suffix = mem;
    out->_suffixAllocated = DWA_CLASSIFIER_TRUE;
}