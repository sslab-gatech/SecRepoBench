if (len + 5 >= size) {
        xmlChar *tmp;

        size *= 2;
        tmp = (xmlChar *) xmlRealloc(buf, size);
        if (tmp == NULL) {
            xmlFree(buf);
            htmlErrMemory(ctxt, "growing buffer failed\n");
            ctxt->instate = state;
            return;
        }
        buf = tmp;
    }
    if (IS_CHAR(cur)) {
        COPY_BUF(l, buf, len, cur);
    } else {
        htmlParseErrInt(ctxt, XML_ERR_INVALID_CHAR,
                        "Invalid char in comment 0x%X\n", cur);
    }
    if (len > maxLength) {
        htmlParseErr(ctxt, XML_ERR_COMMENT_NOT_FINISHED,
                     "comment too long", NULL, NULL);
        xmlFree(buf);
        ctxt->instate = state;
        return;
    }