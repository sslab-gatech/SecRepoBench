u_int32_t offset = 0;

  if (flow->packet.payload_packet_len > 2 && get_u16(flow->packet.payload, 0) == 0x2045) {
    offset = 76;
  } else if (flow->packet.payload_packet_len > 2 && get_u16(flow->packet.payload, 0) == 0x0000) {
    offset = 50;
  }

  if (flow->packet.payload_packet_len > offset + 17) {
    char name[17];
    memcpy(name, flow->packet.payload + offset, 16);
    name[16] = '\0';

    if (flow->server_name == NULL) {
      flow->server_name = (char *)ndpi_malloc(17);
      if (flow->server_name == NULL) {
        return;
      }
    } else {
      char *temp = (char *)ndpi_realloc(flow->server_name, strlen(flow->server_name) + 17 + 1);
      if (temp == NULL) {
        return;
      }
      flow->server_name = temp;
      strcat(flow->server_name, ", ");
    }
    strcat(flow->server_name, name);
  }

  ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);