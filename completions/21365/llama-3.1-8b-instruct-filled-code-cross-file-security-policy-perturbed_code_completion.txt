static void ndpi_int_netbios_add_connection(struct ndpi_detection_module_struct *detectionmodulestruct,
					    struct ndpi_flow_struct *flow,
					    u_int16_t sub_protocol) { 
  // Interpret the NetBIOS name from the packet payload and store it in the flow's host server name.
  // Determine the offset to start interpreting the name based on the payload's content.
  // Update the detected protocol for the flow based on the sub-protocol value.
  struct ndpi_packet_struct *packet = &flow->packet;
  if (packet->payload_packet_len < 32) {
    return;
  }

  u_int32_t offset = 0;
  if (memcmp(packet->payload, "NETBIOS", 6) == 0) {
    offset = 6;
  } else if (memcmp(packet->payload, "NBNS", 4) == 0) {
    offset = 4;
  } else if (memcmp(packet->payload, "NBSS", 4) == 0) {
    offset = 4;
  } else {
    return;
  }

  if (offset + 16 > packet->payload_packet_len) {
    return;
  }

  u_int32_t name_length = ntohl(*(u_int32_t *)(packet->payload + offset + 4));
  if (offset + 16 + name_length > packet->payload_packet_len) {
    return;
  }

  char *name = (char *)(packet->payload + offset + 16);
  if (name_length > 0) {
    flow->host_server_name = ndpi_strdup(name);
  }

  // Update the detected protocol for the flow based on the sub-protocol value.
  ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);
}