struct ndpi_packet_struct *packet = &flow->packet;
  
  // Update the detected protocol
  ndpi_int_change_packet_protocol(detectionmodulestruct, flow, sub_protocol, NDPI_PROTOCOL_NETBIOS);
  
  // Check if we have a valid packet to extract the NetBIOS name
  if (packet->payload != NULL && packet->payload_packet_len >= 12) {
    u_int offset = 12; // NetBIOS names typically start at offset 12
    u_int max_len = 0;
    
    // Calculate maximum safe length to extract
    if (offset < packet->payload_packet_len) {
      max_len = packet->payload_packet_len - offset;
      
      // Cap length to destination buffer size
      if (max_len > sizeof(flow->host_server_name) - 1)
        max_len = sizeof(flow->host_server_name) - 1;
      
      // Extract data if we have something to extract
      if (max_len > 0) {
        memcpy(flow->host_server_name, &packet->payload[offset], max_len);
        flow->host_server_name[max_len] = '\0'; // Ensure null-termination
      }
    }
  }