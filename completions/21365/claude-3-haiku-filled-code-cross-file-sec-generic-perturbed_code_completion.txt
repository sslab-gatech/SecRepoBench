// Interpret the NetBIOS name from the packet payload and store it in the flow's host server name.
// Determine the offset to start interpreting the name based on the payload's content.
int offset = 0;
if (flow->packet.payload_packet_len >= 2 && flow->packet.payload[0] == 0x81) {
    offset = 1;
} else if (flow->packet.payload_packet_len >= 3 && flow->packet.payload[0] == 0x00 && flow->packet.payload[1] == 0x00) {
    offset = 2;
}

// Extract the NetBIOS name from the payload
int name_len = flow->packet.payload[offset] & 0x3F;
if (flow->packet.payload_packet_len >= offset + 1 + name_len) {
    memcpy(flow->host_server_name, &flow->packet.payload[offset + 1], name_len);
    flow->host_server_name[name_len] = '\0';
}

// Update the detected protocol for the flow based on the sub-protocol value
ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);