const u_int8_t *payload = flow->packet.payload;
u_int16_t payload_len = flow->packet.payload_packet_len;

if(payload_len > 0 && payload != NULL) {
  u_int16_t name_offset = 0;

  /* Determine the offset to start interpreting the NetBIOS name */
  if (payload[0] == 0x20 && payload[1] == 0x43) {
    name_offset = 15; // Example offset based on common NetBIOS naming conventions
  }

  if(name_offset < payload_len) {
    /* Extract the NetBIOS name from the payload */
    char netbios_name[18]; // NetBIOS names are typically 16 characters + null terminator
    memset(netbios_name, 0, sizeof(netbios_name));
    u_int16_t i;

    for(i = 0; i < 16 && (name_offset + i) < payload_len; i++) {
      netbios_name[i] = payload[name_offset + i];
    }

    /* Store the NetBIOS name in the flow's host server name */
    strncpy(flow->host_server_name, netbios_name, sizeof(flow->host_server_name) - 1);
  }
}

/* Update the detected protocol for the flow based on the sub-protocol value */
ndpi_int_change_packet_protocol(detectionmodulestruct, flow,
                                NDPI_PROTOCOL_NETBIOS, sub_protocol);