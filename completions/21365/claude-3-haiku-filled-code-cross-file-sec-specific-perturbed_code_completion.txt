// Interpret the NetBIOS name from the packet payload and store it in the flow's host server name.
// Determine the offset to start interpreting the name based on the payload's content.
// Update the detected protocol for the flow based on the sub-protocol value.
u_int8_t *payload = flow->packet.payload;
u_int16_t payload_len = flow->packet.payload_packet_len;
u_int16_t offset = 0;

// Determine the offset to start interpreting the NetBIOS name
if (payload_len >= 2 && (payload[0] == 0x81 || payload[0] == 0x82)) {
    offset = 2;
} else if (payload_len >= 3 && (payload[0] == 0x00 && payload[1] == 0x00)) {
    offset = 3;
}

// Interpret the NetBIOS name
u_int8_t name_len = payload[offset];
if (offset + 1 + name_len <= payload_len) {
    ndpi_strlcpy(flow->host_server_name, (const char *)&payload[offset + 1], sizeof(flow->host_server_name));
}

// Update the detected protocol for the flow
ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);