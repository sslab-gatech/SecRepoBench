if (flow->packet.payload_packet_len >= 34) {
    int offset = 12;
    if (flow->packet.payload[0] == 0x20 && flow->packet.payload[1] == 0x00)
      offset = 14;

    int name_len = flow->packet.payload[offset];
    if (name_len > 0 && name_len <= 15 && offset + name_len + 1 <= flow->packet.payload_packet_len) {
      char netbios_name[16];
      int i;
      for (i = 0; i < name_len; i += 2) {
        netbios_name[i/2] = ((flow->packet.payload[offset + 1 + i] - 'A') << 4) |
                            (flow->packet.payload[offset + 2 + i] - 'A');
      }
      netbios_name[i/2] = '\0';
      snprintf(flow->host_server_name, sizeof(flow->host_server_name), "%s", netbios_name);
    }
  }

  ndpi_int_change_packet_protocol(detectionmodulestruct, flow,
                                  NDPI_PROTOCOL_NETBIOS, sub_protocol);