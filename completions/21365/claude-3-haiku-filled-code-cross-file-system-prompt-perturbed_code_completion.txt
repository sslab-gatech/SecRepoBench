// Interpret the NetBIOS name from the packet payload and store it in the flow's host server name.
// Determine the offset to start interpreting the name based on the payload's content.
int offset = 0;
if (flow->packet.payload_packet_len > 2 && flow->packet.payload[0] == 0x81) {
    offset = 1;
} else if (flow->packet.payload_packet_len > 3 && flow->packet.payload[0] == 0x00 && flow->packet.payload[1] == 0x00) {
    offset = 3;
}

if (offset > 0) {
    int name_len = flow->packet.payload[offset++];
    if (name_len + offset <= flow->packet.payload_packet_len) {
        ndpi_hostname_sni_set(flow, &flow->packet.payload[offset], name_len);
    }
}

// Update the detected protocol for the flow based on the sub-protocol value.
ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);