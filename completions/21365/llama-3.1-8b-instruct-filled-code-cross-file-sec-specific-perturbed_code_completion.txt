// <MASK>
  if (sub_protocol == NDPI_PROTOCOL_NETBIOS) {
    struct ndpi_packet_struct *packet = &flow->packet;
    struct ndpi_id_struct *src = flow->src;
    struct ndpi_id_struct *dst = flow->dst;

    if (packet->payload_packet_len >= 24 && memcmp(packet->payload, "NETBIOS", 6) == 0) {
      u_int16_t name_len = ntohs_ndpi_bytestream_to_number(&packet->payload[6], packet->payload_packet_len, NULL);
      if (name_len > 0) {
        u_int16_t name_offset = 8;
        u_int16_t name_len_remaining = name_len;
        char name[256];
        memset(name, 0, 256);
        while (name_len_remaining > 0) {
          u_int16_t name_len_read = ntohs_ndpi_bytestream_to_number(&packet->payload[name_offset], packet->payload_packet_len, &name_offset);
          if (name_len_read > name_len_remaining) {
            name_len_read = name_len_remaining;
          }
          memcpy(name, &packet->payload[name_offset], name_len_read);
          name_offset += name_len_read;
          name_len_remaining -= name_len_read;
        }
        if (src!= NULL) {
          src->netbios_name = strdup(name);
        }
        if (dst!= NULL) {
          dst->netbios_name = strdup(name);
        }
      }
    }
  }
  ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_BITMASK_PROTOCOL_TCP_OR_UDP_WITH_PAYLOAD_WITHOUT_RETRANSMISSION, sub_protocol);
// <MASK>