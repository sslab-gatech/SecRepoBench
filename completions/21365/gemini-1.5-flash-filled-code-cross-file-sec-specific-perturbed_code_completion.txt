u_int8_t *payload = (u_int8_t *)flow->packet.payload;
  size_t payload_len = flow->packet.payload_packet_len;
  size_t offset = 0;

  // Determine the offset based on the NetBIOS packet structure.  This is highly dependent on the specific NetBIOS protocol version and packet type.
  //  A robust implementation would require handling various cases and error conditions.  This example assumes a simple case.
  if (payload_len > 2 && payload[0] == 0x00 && payload[1] == 0x00) {
    offset = 2;
  }

  // Extract the NetBIOS name.  This is a simplified example and may need adjustments depending on the NetBIOS name length encoding.
  char netbios_name[16]; // Assuming a maximum NetBIOS name length of 15 bytes + null terminator.  This should be checked against the actual payload length.
  if (payload_len > offset + sizeof(netbios_name) -1) {
    payload_len = offset + sizeof(netbios_name) -1;
  }
  strncpy(netbios_name, (char*)&payload[offset], payload_len - offset);
  netbios_name[payload_len - offset] = '\0';

  // Store the NetBIOS name in the flow's host server name.  Ensure sufficient buffer space is available.
  if (strlen(netbios_name) > 0) {
    strncpy(flow->host_server_name, netbios_name, sizeof(flow->host_server_name) - 1);
    flow->host_server_name[sizeof(flow->host_server_name) - 1] = '\0';
  }

  // Update the detected protocol for the flow.
  ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);