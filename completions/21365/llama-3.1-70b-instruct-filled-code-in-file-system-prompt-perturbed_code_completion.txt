u_int8_t name_length = packet->payload[12];
char host_server_name[256];

if (packet->payload_packet_len >= 12 + 1 + name_length + 1) {
  if (ndpi_netbios_name_interpret(packet->payload + 13, name_length, host_server_name, sizeof(host_server_name)) > 0) {
    ndpi_add_connection(ndpi_struct, flow, NDPI_PROTOCOL_NETBIOS, host_server_name);
  }
}

flow->detected_protocol_stack[flow->detected_protocol_stack_len++] = sub_protocol;