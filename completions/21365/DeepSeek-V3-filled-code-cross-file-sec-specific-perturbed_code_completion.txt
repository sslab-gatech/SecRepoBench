struct ndpi_packet_struct *packet = &flow->packet;
  u_int8_t *payload = packet->payload;
  u_int16_t payload_len = packet->payload_packet_len;
  u_int16_t offset = 0;

  if(payload_len < 1) return;

  /* NetBIOS name is at offset 1 if first byte is 0x00 */
  if(payload[0] == 0x00 && payload_len > 1) {
    offset = 1;
  }

  /* Copy NetBIOS name to host_server_name with bounds checking */
  if(offset < payload_len) {
    u_int16_t name_len = payload_len - offset;
    if(name_len > sizeof(flow->host_server_name) - 1) {
      name_len = sizeof(flow->host_server_name) - 1;
    }
    if(name_len > 0) {
      strncpy((char*)flow->host_server_name, (char*)&payload[offset], name_len);
      flow->host_server_name[name_len] = '\0';
    }
  }

  /* Update protocol detection */
  ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);