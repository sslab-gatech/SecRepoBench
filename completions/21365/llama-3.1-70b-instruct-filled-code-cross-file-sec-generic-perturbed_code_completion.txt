// Interpret the NetBIOS name from the packet payload and store it in the flow's host server name.
// Determine the offset to start interpreting the name based on the payload's content.
u_int16_t offset = 0;
if (flow->packet.payload[0] == 0x00 && flow->packet.payload[1] == 0x00) {
  offset = 4; // Skip the NetBIOS session message header
} else if (flow->packet.payload[0] == 0x81 && flow->packet.payload[1] == 0x00) {
  offset = 2; // Skip the NetBIOS session request header
}

// Extract the NetBIOS name from the payload
u_int8_t *netbios_name = &flow->packet.payload[offset];
u_int16_t netbios_name_len = flow->packet.payload_packet_len - offset;

// Store the NetBIOS name in the flow's host server name
ndpi_strncpy(flow->host_server_name, (const char *)netbios_name, netbios_name_len);

// Update the detected protocol for the flow based on the sub-protocol value.
ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);