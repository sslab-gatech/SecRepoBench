// Interpret the NetBIOS name from the packet payload and store it in the flow's host server name.
// Determine the offset to start interpreting the name based on the payload's content.
u_int16_t offset = 0;
if (flow->packet.payload[0] == 0x00 && flow->packet.payload[1] == 0x00) {
  offset = 4; // Skip the NetBIOS session message header
} else if (flow->packet.payload[0] == 0x81 && flow->packet.payload[1] == 0x00) {
  offset = 2; // Skip the NetBIOS session message header for SMB
}

// Ensure the payload is large enough to contain a NetBIOS name
if (flow->packet.payload_packet_len > offset + 1) {
  u_int8_t name_length = flow->packet.payload[offset];
  if (flow->packet.payload_packet_len >= offset + name_length + 1) {
    // Copy the NetBIOS name to the flow's host server name
    memcpy(flow->host_server_name, &flow->packet.payload[offset + 1], name_length);
    flow->host_server_name[name_length] = '\0'; // Null-terminate the string
  }
}

// Update the detected protocol for the flow based on the sub-protocol value.
ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);