char netbios_name[64];
u_int offset = (packet->payload[12] == 0x20) ? 14 : 12;

if(ndpi_netbios_name_interpret((char*)&packet->payload[offset], packet->payload_packet_len - offset, netbios_name, sizeof(netbios_name)) > 0) {
  snprintf(flow->host_server_name, sizeof(flow->host_server_name), "%s", netbios_name);
}

ndpi_set_detected_protocol(ndpi_struct, flow, sub_protocol, NDPI_PROTOCOL_NETBIOS);