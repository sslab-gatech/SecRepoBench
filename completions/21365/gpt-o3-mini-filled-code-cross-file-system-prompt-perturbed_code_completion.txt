struct ndpi_packet_struct *packet = &flow->packet;
  /* Ensure there is payload to process */
  if(packet->payload_packet_len == 0)
    return;

  /* Determine the offset to start interpreting the NetBIOS name.
   * For example, if the first byte represents the length of the encoded name,
   * then skip it. Otherwise, start at offset 0. Adjust this logic as needed.
   */
  int offset = 0;
  u_int8_t name_length_indicator = packet->payload[0];
  if(name_length_indicator > 0 && name_length_indicator < packet->payload_packet_len)
    offset = 1;

  /* Interpret and store the NetBIOS name into the flow's host server name.
   * Copy up to the maximum available size (leaving room for the terminating null).
   */
  int available_len = packet->payload_packet_len - offset;
  int max_copy = sizeof(flow->host_server_name) - 1;
  int name_len = (available_len < max_copy) ? available_len : max_copy;
  memcpy(flow->host_server_name, packet->payload + offset, name_len);
  flow->host_server_name[name_len] = '\0';

  /* Update the detected protocol for this flow based on the given sub_protocol.
   * The upper protocol is set to NDPI_PROTOCOL_NETBIOS.
   */
  ndpi_int_change_packet_protocol(ndpi_struct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);