struct ndpi_packet_struct *packet = &flow->packet;

  if (packet->payload_packet_len > 17) {
    int name_offset = 17; // Typical offset for NetBIOS name

    if (packet->payload[16] != 0x20) {
      if (packet->payload[16] == 0) {
          name_offset = 16;
      } else {
          return;
      }
    }
    if (name_offset <= packet->payload_packet_len) {
        strncpy((char *)flow->host_server_name, (const char *)&packet->payload[name_offset],
                sizeof(flow->host_server_name) - 1);
        flow->host_server_name[sizeof(flow->host_server_name) - 1] = '\0';
    }
  }


  ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);