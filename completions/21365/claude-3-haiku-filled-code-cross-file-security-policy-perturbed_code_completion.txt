// Interpret the NetBIOS name from the packet payload and store it in the flow's host server name.
// Determine the offset to start interpreting the name based on the payload's content.
u_int16_t offset = 0;
if (flow->packet.payload_packet_len >= 2) {
    // Check the first two bytes of the payload to determine the offset
    if (flow->packet.payload[0] == 0x81 && flow->packet.payload[1] == 0x00) {
        offset = 2;
    } else if (flow->packet.payload[0] == 0x00 && flow->packet.payload[1] == 0x00) {
        offset = 4;
    }
}

// Ensure the offset is within the payload's length before accessing the payload data
if (offset < flow->packet.payload_packet_len) {
    // Extract the NetBIOS name from the payload and store it in the flow's host server name
    ndpi_hostname_sni_set(detectionmodulestruct, flow, (const u_char *)&flow->packet.payload[offset], flow->packet.payload_packet_len - offset);
}

// Update the detected protocol for the flow based on the sub-protocol value
ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);