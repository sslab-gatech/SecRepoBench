struct ndpi_packet_struct *packet = &flow->packet;
  u_int8_t *payload = packet->payload;
  u_int16_t payload_len = packet->payload_packet_len;
  u_int16_t offset = 0;

  if(payload_len > 0) {
    /* Simple heuristic to find NetBIOS name start */
    if(payload[0] == 0x00 || payload[0] == 0x20) {
      offset = 1;
    }

    /* Extract NetBIOS name (limited to NDPI_MAX_HOSTNAME_LEN for safety) */
    if(offset < payload_len) {
      u_int16_t name_len = payload_len - offset;
      if(name_len > NDPI_MAX_HOSTNAME_LEN) {
        name_len = NDPI_MAX_HOSTNAME_LEN;
      }
      memcpy(flow->host_server_name, &payload[offset], name_len);
      flow->host_server_name[name_len] = '\0';
    }
  }

  /* Update protocol detection */
  ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);