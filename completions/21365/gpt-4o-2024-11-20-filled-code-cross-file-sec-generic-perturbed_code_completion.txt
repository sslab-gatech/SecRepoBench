struct ndpi_packet_struct *packet = &flow->packet;

  if(packet == NULL || packet->payload == NULL || packet->payload_packet_len < 1) {
    NDPI_LOG_DBG(detectionmodulestruct, "Invalid packet or payload\n");
    return;
  }

  // Extract NetBIOS name from the payload
  char netbios_name[16] = {0}; // NetBIOS names are 15 characters + null terminator
  u_int16_t offset = 0;

  // Determine the offset to start interpreting the name
  if(packet->payload_packet_len > 1 && packet->payload[0] == 0x20) {
    offset = 1; // Skip the first byte if it is a specific marker
  }

  // Safely copy the NetBIOS name from the payload
  for(int i = 0; i < 15 && (offset + i) < packet->payload_packet_len; i++) {
    if(packet->payload[offset + i] >= 32 && packet->payload[offset + i] <= 126) { // Valid ASCII range
      netbios_name[i] = packet->payload[offset + i];
    } else {
      break; // Stop at the first invalid character
    }
  }

  // Store the extracted name in the flow's host server name
  strncpy(flow->host_server_name, netbios_name, sizeof(flow->host_server_name) - 1);
  flow->host_server_name[sizeof(flow->host_server_name) - 1] = '\0'; // Ensure null termination

  // Update the detected protocol for the flow
  ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);

  NDPI_LOG_DBG(detectionmodulestruct, "NetBIOS name: %s, sub-protocol: %u\n", netbios_name, sub_protocol);