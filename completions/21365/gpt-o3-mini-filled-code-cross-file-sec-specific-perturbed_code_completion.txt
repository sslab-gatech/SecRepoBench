{
    struct ndpi_packet_struct *packet = &flow->packet;
    /* Make sure the payload is long enough to contain at least a length byte and one character */
    if(packet->payload_packet_len < 2)
        return;

    /* The first byte is assumed to represent the length of the NetBIOS name */
    unsigned int name_len = (unsigned char)packet->payload[0];

    /* Check that the declared length does not exceed the available payload */
    if(name_len == 0 || name_len > packet->payload_packet_len - 1)
        return;

    /*
     * Assume that flow->host_server_name points to a buffer allocated to hold
     * up to NDPI_NETBIOS_NAME_MAX characters (including the null terminator).
     * Adjust name_len if needed to prevent a heap overflow.
     */
    unsigned int max_name_len = NDPI_NETBIOS_NAME_MAX - 1;
    if(name_len > max_name_len)
        name_len = max_name_len;

    memcpy(flow->host_server_name, packet->payload + 1, name_len);
    flow->host_server_name[name_len] = '\0';

    /* Update the flow's detected protocol: set upper as NETBIOS and lower as the sub_protocol */
    ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);
}