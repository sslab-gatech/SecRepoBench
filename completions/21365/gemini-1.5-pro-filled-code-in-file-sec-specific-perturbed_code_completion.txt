char netbios_name[256];
  u_int8_t name_length;
  const u_int8_t *name_ptr;

  if (packet->payload_packet_len > 17 && packet->payload[16] == 0x20) {
    name_ptr = packet->payload + 17;
    name_length = 32; // Fixed length for NetBIOS names in this case
  } else if (packet->payload_packet_len > 13 && packet->payload[12] != 0) {
    name_ptr = packet->payload + 13;
    name_length = packet->payload[12];
  } else {
    ndpi_set_detected_protocol(ndpi_struct, flow, sub_protocol, NDPI_PROTOCOL_UNKNOWN);
    return;
  }


  if (name_length > 0 && name_length <= 32 && ndpi_netbios_name_interpret((char *)name_ptr, name_length, netbios_name, sizeof(netbios_name)) > 0) {
    if (flow->host_server_name == NULL) {
      flow->host_server_name = ndpi_strdup(ndpi_struct, netbios_name);
    }
  }

  ndpi_set_detected_protocol(ndpi_struct, flow, sub_protocol, NDPI_PROTOCOL_NETBIOS);