u_int8_t name_offset = 0;
  char netbios_name[256] = {0}; // Ensure enough space for the NetBIOS name
  size_t netbios_name_len = 0;
  struct ndpi_packet_struct *packet = &flow->packet;

  if (packet->payload_packet_len > 2) {
    name_offset = packet->payload[1]; // Offset to the NetBIOS name

    if ((name_offset + 1) < packet->payload_packet_len) {
      u_int8_t name_length = packet->payload[name_offset];

      if ((name_offset + 1 + name_length) <= packet->payload_packet_len && name_length < sizeof(netbios_name)) {
        memcpy(netbios_name, &packet->payload[name_offset + 1], name_length);
        netbios_name[name_length] = '\0'; // Null-terminate the name
        netbios_name_len = name_length;
      }
    }
  }

  if (netbios_name_len > 0) {
    strncpy(flow->host_server_name, netbios_name, sizeof(flow->host_server_name) - 1);
    flow->host_server_name[sizeof(flow->host_server_name) - 1] = '\0'; // Ensure null termination
  }

  if (sub_protocol != NDPI_PROTOCOL_UNKNOWN) {
    ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);
  }