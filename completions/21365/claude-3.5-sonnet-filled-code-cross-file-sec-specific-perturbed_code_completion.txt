u_int offset = 0;
if (flow->packet.payload_packet_len > 12) {
  offset = 12;
}

if (flow->packet.payload_packet_len > offset + 1) {
  u_int8_t name_length = flow->packet.payload[offset];
  if (name_length > 0 && name_length <= 63 && flow->packet.payload_packet_len >= offset + 1 + name_length) {
    char netbios_name[64] = {0};
    u_int i;
    for (i = 0; i < name_length && i < sizeof(netbios_name) - 1; i++) {
      netbios_name[i] = flow->packet.payload[offset + 1 + i];
    }
    netbios_name[i] = '\0';
    snprintf(flow->host_server_name, sizeof(flow->host_server_name), "%s", netbios_name);
  }
}

ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);