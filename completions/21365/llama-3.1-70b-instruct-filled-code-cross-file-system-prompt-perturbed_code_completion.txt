// Interpret the NetBIOS name from the packet payload and store it in the flow's host server name.
// Determine the offset to start interpreting the name based on the payload's content.
// Update the detected protocol for the flow based on the sub-protocol value.
u_int16_t offset = 0;
if (flow->packet.payload[0] == 0x00 && flow->packet.payload[1] == 0x00) {
  offset = 4; // SMB header
} else if (flow->packet.payload[0] == 0x00 && flow->packet.payload[1] == 0x01) {
  offset = 3; // Mailslot header
} else {
  offset = 0; // No header
}

// Extract the NetBIOS name
u_int8_t name_length = flow->packet.payload[offset];
u_int8_t *name = (u_int8_t *)&flow->packet.payload[offset + 1];
flow->host_server_name = (char *)malloc(name_length + 1);
memcpy(flow->host_server_name, name, name_length);
flow->host_server_name[name_length] = '\0';

// Update the detected protocol for the flow based on the sub-protocol value
ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);