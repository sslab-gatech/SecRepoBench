char name[256];
  int name_len;

  if(flow->detected_protocol == NDPI_PROTOCOL_UNKNOWN) {
    if(packet->payload_packet_len > 0) {
      name_len = ndpi_netbios_name_interpret((char *)packet->payload, packet->payload_packet_len, name, sizeof(name));
      if(name_len > 0) {
	ndpi_set_hostname(detectionmodulestruct, flow, name);
      }
    }
  }
  
  if(sub_protocol != NDPI_PROTOCOL_UNKNOWN)
    ndpi_set_detected_protocol(detectionmodulestruct, flow, sub_protocol);