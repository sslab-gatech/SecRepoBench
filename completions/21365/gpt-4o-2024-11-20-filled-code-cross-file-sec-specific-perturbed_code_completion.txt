struct ndpi_packet_struct *packet = &flow->packet;

  if(packet == NULL || packet->payload == NULL || packet->payload_packet_len < 1) {
    NDPI_LOG_DBG(detectionmodulestruct, "Invalid packet or payload\n");
    return;
  }

  // Ensure the payload length is within a safe range to avoid buffer overflows
  if(packet->payload_packet_len > MAX_PAYLOAD_LENGTH) {
    NDPI_LOG_DBG(detectionmodulestruct, "Payload length exceeds maximum allowed size\n");
    return;
  }

  // Extract the NetBIOS name from the payload
  char netbios_name[NETBIOS_NAME_MAX_LEN + 1] = {0}; // +1 for null terminator
  size_t name_length = (packet->payload_packet_len < NETBIOS_NAME_MAX_LEN) ? packet->payload_packet_len : NETBIOS_NAME_MAX_LEN;

  memcpy(netbios_name, packet->payload, name_length);
  netbios_name[name_length] = '\0'; // Ensure null termination

  // Store the extracted name in the flow's host_server_name
  strncpy(flow->host_server_name, netbios_name, sizeof(flow->host_server_name) - 1);
  flow->host_server_name[sizeof(flow->host_server_name) - 1] = '\0'; // Ensure null termination

  // Update the detected protocol for the flow
  ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);