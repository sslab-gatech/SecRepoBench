static void ndpi_int_netbios_add_connection(struct ndpi_detection_module_struct *detectionmodulestruct,
					    struct ndpi_flow_struct *flow,
					    u_int16_t sub_protocol) { 
  // Interpret the NetBIOS name from the packet payload and store it in the flow's host server name.
  // Determine the offset to start interpreting the name based on the payload's content.
  // Update the detected protocol for the flow based on the sub-protocol value.
  char *name = NULL;
  int name_len = 0;
  int offset = 0;
  int i = 0;
  
  if (sub_protocol == NDPI_PROTOCOL_SMBV1) {
    offset = 82;
  } else {
    offset = 0;
  }
  
  for (i = offset; i < flow->packet.payload_packet_len; i++) {
    if (flow->packet.payload[i] == 0) {
      name_len = i - offset;
      name = (char *)malloc((name_len + 1) * sizeof(char));
      for (int j = 0; j < name_len; j++) {
        name[j] = flow->packet.payload[offset + j];
      }
      name[name_len] = '\0';
      break;
    }
  }
  
  if (name!= NULL) {
    flow->host_server_name = strdup(name);
    free(name);
  }
  
  ndpi_update_detected_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);
}