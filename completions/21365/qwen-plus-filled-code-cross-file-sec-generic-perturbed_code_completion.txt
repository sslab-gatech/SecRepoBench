u_int8_t *payload = flow->packet.payload;
u_int16_t payload_len = flow->packet.payload_packet_len;

if(payload == NULL || payload_len < 5) {
  return;
}

// Determine the offset to start interpreting the name based on the payload's content.
u_int16_t name_offset = 0;

if(payload[0] == 0x01 && payload[1] == 0x00 && payload[2] == 0x00 && payload[3] == 0x00) {
  name_offset = 4; // Assume NetBIOS session service request
} else if(payload[0] == 0x81 && payload[1] == 0x00) {
  name_offset = 2; // Assume NetBIOS name query response
} else {
  return; // Unsupported or invalid packet structure
}

// Interpret the NetBIOS name from the packet payload and store it in the flow's host server name.
u_int8_t netbios_name[17];
memset(netbios_name, 0, sizeof(netbios_name));

for(u_int8_t i = 0; i < 16 && (name_offset + i * 2) < payload_len; ++i) {
  netbios_name[i] = payload[name_offset + i * 2];
}

ndpi_strncpy(flow->host_server_name, (char *)netbios_name, sizeof(flow->host_server_name) - 1);

// Update the detected protocol for the flow based on the sub-protocol value.
ndpi_int_change_packet_protocol(detectionmodulestruct, flow,
                                NDPI_PROTOCOL_NETBIOS, sub_protocol);