{
  struct ndpi_packet_struct *packet = &flow->packet;
  /* Example logic to derive offset; production code may use more accurate checks */
  u_int16_t offset = 0;
  if(packet->payload_packet_len > 1 && packet->payload[0] == 0x81) {
    offset = 1; /* Adjust if a certain byte indicates the name starts later */
  }

  /* A simple placeholder for NetBIOS name extraction;
   * in practice you would decode the name appropriately. */
  memset(flow->host_server_name, 0, sizeof(flow->host_server_name));
  if(packet->payload_packet_len > offset) {
    /* Copy only up to our buffer size or until payload end */
    u_int16_t copy_len = packet->payload_packet_len - offset;
    if(copy_len > (sizeof(flow->host_server_name) - 1))
      copy_len = (sizeof(flow->host_server_name) - 1);
    memcpy(flow->host_server_name, &packet->payload[offset], copy_len);
  }

  /* Update the protocol stack for this flow */
  ndpi_int_change_packet_protocol(detectionmodulestruct, flow,
                                  NDPI_PROTOCOL_NETBIOS, sub_protocol);
}