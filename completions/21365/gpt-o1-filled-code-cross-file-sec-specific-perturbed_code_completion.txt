{
  struct ndpi_packet_struct *packet = &flow->packet;

  /* Ensure the payload is long enough for a typical NetBIOS name (15 bytes). */
  if (packet->payload_packet_len < 15) {
    return; /* Not enough data to read a name */
  }

  /* Determine offset for where the NetBIOS name starts in the payload */
  /* For simplicity, we'll assume offset = 0. In reality, parsing logic would be needed. */
  size_t offset = 0;

  {
    char netbios_name[16];
    memset(netbios_name, 0, sizeof(netbios_name));

    /* Safely copy 15 bytes for the name or whatever is available up to 15 bytes */
    size_t copy_len = (packet->payload_packet_len - offset >= 15) ? 15 : (packet->payload_packet_len - offset);
    memcpy(netbios_name, packet->payload + offset, copy_len);

    /* Store interpreted name in flow->host_server_name safely */
    strncpy(flow->host_server_name, netbios_name, sizeof(flow->host_server_name) - 1);
    flow->host_server_name[sizeof(flow->host_server_name) - 1] = '\0';
  }

  /* Update the detected protocol stack for this flow. */
  ndpi_int_change_packet_protocol(detectionmodulestruct, flow, NDPI_PROTOCOL_NETBIOS, sub_protocol);
}