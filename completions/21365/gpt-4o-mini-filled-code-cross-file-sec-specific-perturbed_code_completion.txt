struct ndpi_packet_struct *packet = &flow->packet;
  if (!packet || packet->payload_packet_len == 0) {
    return;
  }

  // Assuming we have a function to safely copy the NetBIOS name
  size_t netbios_name_length = packet->payload_packet_len; // Adjust as necessary based on actual NetBIOS name extraction logic
  if (netbios_name_length > MAX_NETBIOS_NAME_LENGTH) {
    netbios_name_length = MAX_NETBIOS_NAME_LENGTH; // Prevent overflow
  }

  // Allocate memory for the NetBIOS name
  flow->host_server_name = (char *)malloc(netbios_name_length + 1);
  if (flow->host_server_name == NULL) {
    // Handle memory allocation failure
    return;
  }

  // Copy the NetBIOS name safely
  memcpy(flow->host_server_name, packet->payload, netbios_name_length);
  flow->host_server_name[netbios_name_length] = '\0'; // Null-terminate the string

  // Update the detected protocol
  ndpi_int_change_packet_protocol(detectionmodulestruct, flow, sub_protocol);