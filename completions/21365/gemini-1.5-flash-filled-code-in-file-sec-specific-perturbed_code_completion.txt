char name[256];
  int name_len;

  if (flow->payload_len > 0) {
    // Determine the offset to start interpreting the name based on the payload's content.  This is highly protocol-specific and requires detailed knowledge of the NetBIOS protocol.  A robust implementation would involve parsing the NetBIOS header to find the name field.  This example makes a simplifying assumption.
    size_t offset = 0; // Replace with actual offset calculation based on NetBIOS header parsing.

    if (flow->payload_len > offset + 255) {
      name_len = ndpi_netbios_name_interpret((char *)flow->payload + offset, flow->payload_len - offset, name, sizeof(name));
    } else {
      name_len = ndpi_netbios_name_interpret((char *)flow->payload + offset, flow->payload_len - offset, name, flow->payload_len - offset);
    }

    if (name_len > 0) {
      ndpi_set_hostname(detectionmodulestruct, flow, name);
    }
  }

  // Update the detected protocol for the flow based on the sub-protocol value.
  if (sub_protocol != NDPI_PROTOCOL_UNKNOWN) {
    ndpi_set_detected_protocol(detectionmodulestruct, flow, sub_protocol);
  }