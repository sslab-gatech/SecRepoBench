if(flow->host_server_name[0] == '\0' && flow->packet.payload != NULL) {
    u_int16_t offset = (flow->packet.payload[0] == 0x14) ? 0x0e : 0x0c; /* Typical NetBIOS offsets */
    u_int16_t payload_remaining = flow->packet.payload_packet_len - offset;
    
    if(payload_remaining >= 32) { /* Minimum NetBIOS name length */
      u_int16_t copy_len = sizeof(flow->host_server_name)-1;
      copy_len = (32 < copy_len) ? 32 : copy_len; /* Limit to buffer size */
      memcpy(flow->host_server_name, &flow->packet.payload[offset], copy_len);
      flow->host_server_name[copy_len] = '\0'; /* Ensure null termination */
    }
  }

  ndpi_int_change_packet_protocol(detectionmodulestruct, flow, 
                                 NDPI_PROTOCOL_NETBIOS, sub_protocol);