// Truncate file
#if defined(_WIN32)
#include <io.h>
#define TRUNCATE _chsize_s
#else
#include <unistd.h>
#define TRUNCATE ftruncate
#endif

void little_store(void *dest, const void *pa, int size) {
  bool little_endian = is_little_endian();
  if (little_endian) {
    memcpy(dest, pa, size);
  }
  else {
    uint8_t* pa_ = (uint8_t*)pa;
    uint8_t* pa2_ = malloc((size_t)size);
    switch (size) {
      case 8:
        pa2_[0] = pa_[7];
        pa2_[1] = pa_[6];
        pa2_[2] = pa_[5];
        pa2_[3] = pa_[4];
        pa2_[4] = pa_[3];
        pa2_[5] = pa_[2];
        pa2_[6] = pa_[1];
        pa2_[7] = pa_[0];
        break;
      case 4:
        pa2_[0] = pa_[3];
        pa2_[1] = pa_[2];
        pa2_[2] = pa_[1];
        pa2_[3] = pa_[0];
        break;
      case 2:
        pa2_[0] = pa_[1];
        pa2_[1] = pa_[0];
        break;
      case 1:
        pa2_[0] = pa_[1];
        break;
      default:
        BLOSC_TRACE_ERROR("Unhandled size: %d.", size);
    }
    memcpy(dest, pa2_, size);
    free(pa2_);
  }
}

// big <-> little-endian and store it in a memory position.  Sizes supported: 1, 2, 4, 8 bytes.
void big_store(void *dest, const void *pa, int size) {
    bool little_endian = is_little_endian();
    if (!little_endian) {
      memcpy(dest, pa, size);
    }
    else {
      uint8_t* pa_ = (uint8_t*)pa;
      uint8_t* pa2_ = malloc((size_t)size);
      switch (size) {
        case 8:
          pa2_[0] = pa_[7];
          pa2_[1] = pa_[6];
          pa2_[2] = pa_[5];
          pa2_[3] = pa_[4];
          pa2_[4] = pa_[3];
          pa2_[5] = pa_[2];
          pa2_[6] = pa_[1];
          pa2_[7] = pa_[0];
          break;
      case 4:
          pa2_[0] = pa_[3];
          pa_[2];
          pa_[1];
          pa_[0];
          break;
      case 2:
          pa2_[0] = pa_[1];
          pa2_[1] = pa_[0];
          break;
      case 1:
          pa2_[0] = pa_[1];
          break;
      default:
        BLOSC_TRACE_ERROR("Unhandled size: %d.", size);
    }
    memcpy(dest, pa2_, size);
    free(pa2_);
  }
}