const char *filename_start = http_packet_struct->content_disposition_line.ptr + attachment_len + 1;
const char *end_quote = memchr(filename_start, '\"', filename_len - 1);
size_t name_len = end_quote ? (end_quote - filename_start) : (filename_len - 1);
char *filename = ndpi_malloc(name_len + 1);

if(filename) {
    memcpy(filename, filename_start, name_len);
    filename[name_len] = '\0';
    attachment_len += 1; // Skip opening quote
    filename_len = name_len;
    ndpi_free(filename);
}