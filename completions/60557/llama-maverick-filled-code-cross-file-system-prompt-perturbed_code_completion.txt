char *filename = ndpi_malloc(filename_len + 1);

if(filename != NULL) {
  u_int i;

  for(i = 0; i < (filename_len-1); i++)
    filename[i] = non_ctrl(http_packet_struct->content_disposition_line.ptr[attachment_len + i]);

  filename[filename_len] = '\0';

  if(filename[0] == '"') {
    u_int j = 0;

    for(i = 1; i < filename_len; i++) {
      if(filename[i] == '"') {
	filename[j] = '\0';
	break;
      } else
	filename[j++] = filename[i];
    }
  }

  ndpi_free(filename);
}