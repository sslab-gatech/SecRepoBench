// Extract the filename from the content disposition line based on its format.
// Allocate memory for the filename and copy the appropriate substring from the content disposition line.
// Ensure the filename is null-terminated after copying.

u_int8_t filename_start = attachment_len + 1; // Skip the opening quote
u_int8_t filename_end = filename_start;

// Find the closing quote
while (filename_end < http_packet_struct->content_disposition_line.len &&
       http_packet_struct->content_disposition_line.ptr[filename_end]!= '\"') {
  filename_end++;
}

// Check if the filename is not empty and does not exceed the maximum allowed length
if (filename_end > filename_start && filename_end - filename_start <= ATTACHMENT_LEN) {
  u_int8_t filename_len = filename_end - filename_start;

  // Allocate memory for the filename, ensuring enough space for the null terminator
  char* filename = (char*)malloc(filename_len + 1);
  if (filename!= NULL) {
    // Copy the filename from the content disposition line
    memcpy(filename, &http_packet_struct->content_disposition_line.ptr[filename_start], filename_len);
    filename[filename_len] = '\0'; // Null-terminate the filename

    //... (rest of the code remains the same)
  }
}