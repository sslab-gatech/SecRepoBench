{
  int quote_start = attachment_len + 1;
  int quote_end = 0;
  
  /* Find the closing quote */
  for(i = quote_start; i < http_packet_struct->content_disposition_line.len; i++) {
    if(http_packet_struct->content_disposition_line.ptr[i] == '\"') {
      quote_end = i;
      break;
    }
  }
  
  if(quote_end > 0) {
    /* Extract filename between quotes */
    filename_len = quote_end - quote_start;
    if(filename_len > 0) {
      /* Update attachment_len to point after the filename */
      attachment_len = quote_end + 1;
    }
  }
}
else {
  /* No quotes, filename follows directly */
  int j = attachment_len;
  
  /* Find the end of the filename (space, semicolon or end of string) */
  for(; j < http_packet_struct->content_disposition_line.len; j++) {
    if(http_packet_struct->content_disposition_line.ptr[j] == ' ' || 
       http_packet_struct->content_disposition_line.ptr[j] == ';') {
      break;
    }
  }
  
  filename_len = j - attachment_len;
  if(filename_len > 0) {
    attachment_len = j;
  }
}