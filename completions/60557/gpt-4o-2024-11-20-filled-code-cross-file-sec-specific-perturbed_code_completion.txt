{
  // Calculate the length of the filename, ensuring it does not exceed the buffer size
  size_t max_filename_len = filename_len < 255 ? filename_len : 255;
  char *filename = (char *)malloc(max_filename_len + 1); // Allocate memory for the filename (+1 for null terminator)

  if (filename == NULL) {
    NDPI_LOG_ERROR(ndpi_struct, "Memory allocation failed for filename");
    return flow->category; // Return early if memory allocation fails
  }

  // Copy the filename from the content disposition line
  strncpy(filename, (const char *)&http_packet_struct->content_disposition_line.ptr[attachment_len + 1], max_filename_len);
  filename[max_filename_len] = '\0'; // Ensure null termination

  // Process the filename (e.g., log it, analyze it, etc.)
  NDPI_LOG_INFO(ndpi_struct, "Extracted filename: %s", filename);

  // Free the allocated memory to prevent memory leaks
  free(filename);
}