{
  // Calculate the length of the filename, ensuring it does not exceed the buffer size
  size_t filename_buffer_len = filename_len + 1; // +1 for null-terminator
  char *filename = (char *)malloc(filename_buffer_len);
  if (filename == NULL) {
    // Handle memory allocation failure
    NDPI_LOG_ERROR(ndpi_struct, "Memory allocation failed for filename");
    return flow->category;
  }

  // Copy the filename from the content disposition line
  strncpy(filename, (const char *)&http_packet_struct->content_disposition_line.ptr[attachment_len + 1], filename_len);
  filename[filename_len] = '\0'; // Null-terminate the string

  // Use the filename as needed, e.g., logging or further processing
  NDPI_LOG_INFO(ndpi_struct, "Extracted filename: %s", filename);

  // Free the allocated memory for the filename
  free(filename);
}