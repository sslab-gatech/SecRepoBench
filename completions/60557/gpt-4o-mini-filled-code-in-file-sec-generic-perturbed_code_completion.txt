{
        size_t filename_start = attachment_len + 1;
        size_t filename_length = 0;

        // Check for the closing quote or semicolon
        char *end_quote = strchr(&http_packet_struct->content_disposition_line.ptr[filename_start], '\"');
        char *end_semicolon = strchr(&http_packet_struct->content_disposition_line.ptr[filename_start], ';');
        
        if (end_quote && (!end_semicolon || end_quote < end_semicolon)) {
          filename_length = end_quote - &http_packet_struct->content_disposition_line.ptr[filename_start];
        } else if (end_semicolon) {
          filename_length = end_semicolon - &http_packet_struct->content_disposition_line.ptr[filename_start];
        } else {
          filename_length = filename_len; // Fallback to the full length if no end is found
        }

        // Allocate memory for the filename
        flow->http.filename = ndpi_malloc(filename_length + 1);
        if (flow->http.filename) {
          strncpy(flow->http.filename, &http_packet_struct->content_disposition_line.ptr[filename_start], filename_length);
          flow->http.filename[filename_length] = '\0'; // Null-terminate the string
        }
      }