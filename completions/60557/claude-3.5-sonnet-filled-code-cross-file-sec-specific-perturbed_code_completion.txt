{
  char *filename = NULL;
  size_t filename_size = 0;

  // Find the end of the filename (closing quote)
  const char *end = memchr(&http_packet_struct->content_disposition_line.ptr[attachment_len + 1], '\"', filename_len - 1);
  
  if (end != NULL) {
    filename_size = end - (&http_packet_struct->content_disposition_line.ptr[attachment_len + 1]) + 1;
    
    // Allocate memory for the filename (including null terminator)
    filename = (char *)ndpi_malloc(filename_size + 1);
    
    if (filename != NULL) {
      // Copy the filename, ensuring we don't exceed the allocated buffer size
      size_t copy_len = ndpi_min(filename_size, filename_len - 1);
      memcpy(filename, &http_packet_struct->content_disposition_line.ptr[attachment_len + 1], copy_len);
      filename[copy_len] = '\0'; // Ensure null-termination
    }
  }

  // Use the filename variable as needed, then free it when done
  if (filename != NULL) {
    // Process the filename...
    ndpi_free(filename);
  }
}