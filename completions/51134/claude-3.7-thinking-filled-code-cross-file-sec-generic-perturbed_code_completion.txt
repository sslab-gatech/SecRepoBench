if (pos != std::string::npos) {
  // We're in a character group
  if (st < str.size() && *p == str[st]) {
    ingroup = true;
  }
  p = nextchar(p);
} else {
  // We're not in a character group
  if (st >= str.size() || *p != str[st]) {
    return 0;  // Condition failed
  }
  p = nextchar(p);
  // Skip to next character in input string
  ++st;
  while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80)
    ++st;
  if (st == str.size() && p)
    return 0;  // word <= condition
}