if (ingroup) {
  if (*p == str[st]) {
    ingroup = true; // Character found in the group
  } else {
    ingroup = false;
  }
} else {
  if (*p != str[st]) {
    return 0; // Condition failed
  }
}

// Move to the next character in the input string
++st;
while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80)
  ++st;

// Advance to the next condition character
p = nextchar(p);