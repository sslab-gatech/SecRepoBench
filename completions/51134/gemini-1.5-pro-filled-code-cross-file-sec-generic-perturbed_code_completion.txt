unsigned char ctmp = (unsigned char)*p;
        ++p;
        if (pos == std::string::npos) {
          if (st >= str.size())
            return 0;
          unsigned char stmp = (unsigned char)str[st];
          if ((opts & aeUTF8) && stmp >= 0x80) {
            if (ctmp >= 0xc0 && ctmp <= 0xfd && st < str.size() - 1 &&
                (str[st + 1] & 0xc0) == 0x80) {
              if (ctmp != stmp)
                return 0;
              ++st;
              while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80)
                ++st;
              break;
            } else if (ctmp < 0x80) {
              return 0;
            } else {
              if (ctmp != stmp)
                return 0;
              while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80)
                ++st;
              break;
            }
          } else {
            if (ctmp != stmp)
              return 0;
            ++st;
          }
        } else {
          if (st >= str.size())
            return 0;
          unsigned char stmp = (unsigned char)str[st];
          if ((opts & aeUTF8) && stmp >= 0x80) {
            if (ctmp >= 0xc0 && ctmp <= 0xfd && st < str.size() - 1 &&
                (str[st + 1] & 0xc0) == 0x80) {
              if (ctmp == stmp)
                ingroup = true;
              ++st;
              while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80)
                ++st;
              break;
            } else if (ctmp < 0x80) {
              if (ctmp == stmp)
                ingroup = true;
              while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80)
                ++st;
              break;
            } else {
              if (ctmp == stmp)
                ingroup = true;
              while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80)
                ++st;
              break;
            }
          } else {
            if (ctmp == stmp)
              ingroup = true;
            ++st;
          }
        }
        break;