if (pos == std::string::npos) {
  // Not in a group, test the current character
  if (st >= str.size() || *p != str[st]) 
    return 0;
  p = nextchar(p);
  ++st;
  while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80)
    ++st;
} else {
  // In a group, check if the current condition character matches the character at pos
  if (pos < str.size() && *p == str[pos])
    ingroup = true;
  p = nextchar(p);
}