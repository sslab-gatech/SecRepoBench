if (pos != std::string::npos) {
          if (*p == str[st] && (!(opts & aeUTF8) || 
              ((st + 1 < str.size() && (str[st + 1] & 0xc0) == 0x80) ? 
              (*(p + 1) == str[st + 1]) : true))) {
            ingroup = true;
            p = nextchar(p);
            if (opts & aeUTF8) {
              while (*p && (st + 1 < str.size()) && (str[st + 1] & 0xc0) == 0x80) {
                if (*p != str[st + 1])
                  break;
                p = nextchar(p);
                st++;
              }
            }
          } else {
            p = nextchar(p);
          }
        } else {
          if (*p == str[st] && (!(opts & aeUTF8) || 
              ((st + 1 < str.size() && (str[st + 1] & 0xc0) == 0x80) ? 
              (*(p + 1) == str[st + 1]) : true))) {
            p = nextchar(p);
            ++st;
            if (opts & aeUTF8) {
              while (*p && (st < str.size()) && (str[st] & 0xc0) == 0x80) {
                if (*p != str[st])
                  return 0;
                p = nextchar(p);
                st++;
              }
            }
          } else {
            return 0;
          }
        }