if (st < str.size()) {
          if ((opts & aeUTF8)) {
            // Handle UTF-8 multibyte characters
            const unsigned char* utf8_char = reinterpret_cast<const unsigned char*>(&str[st]);
            size_t utf8_len = 1;

            if ((*utf8_char & 0x80) == 0x00) {
              utf8_len = 1; // 1-byte character
            } else if ((*utf8_char & 0xE0) == 0xC0) {
              utf8_len = 2; // 2-byte character
            } else if ((*utf8_char & 0xF0) == 0xE0) {
              utf8_len = 3; // 3-byte character
            } else if ((*utf8_char & 0xF8) == 0xF0) {
              utf8_len = 4; // 4-byte character
            } else {
              return 0; // Invalid UTF-8 sequence
            }

            if (strncmp(p, &str[st], utf8_len) == 0) {
              st += utf8_len;
              p = nextchar(p);
              if (pos != std::string::npos) {
                ingroup = true;
              }
            } else if (pos == std::string::npos) {
              return 0;
            }
          } else {
            // Handle single-byte characters
            if (*p == str[st]) {
              ++st;
              p = nextchar(p);
              if (pos != std::string::npos) {
                ingroup = true;
              }
            } else if (pos == std::string::npos) {
              return 0;
            }
          }
        } else {
          return 0; // Input string exhausted
        }