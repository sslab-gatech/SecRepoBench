if (st < str.size() && *p == str[st]) {
          p = nextchar(p);
          if ((opts & aeUTF8) && (str[st] & 0x80)) {
            st++;
            while (p && st < str.size()) {
              if (*p != str[st]) {
                if (pos == std::string::npos)
                  return 0;
                st = pos;
                break;
              }
              if ((*p & 0xc0) != 0x80)
                break;
              p = nextchar(p);
              st++;
            }
            if (pos != std::string::npos && st != pos) {
              if (neg)
                return 0;
              else if (st == numconds)
                return 1;
              ingroup = true;
              while (p && *p != ']' && ((p = nextchar(p)) != NULL)) {
              }
              st++;
            }
            if (p && *p != ']')
              p = nextchar(p);
          } else if (pos != std::string::npos) {
            if (neg)
              return 0;
            else if (st == numconds)
              return 1;
            ingroup = true;
            while (p && *p != ']' && ((p = nextchar(p)) != NULL)) {
            }
            st++;
          }
          if (pos == std::string::npos) {
            st++;
          }
          if (st == str.size() && p && *p != ']')
            return 0;
        } else if (pos != std::string::npos) {
          p = nextchar(p);
        } else
          return 0;