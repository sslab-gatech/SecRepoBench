if (pos != std::string::npos) {
          // we are in a group, check if current character matches
          if ((opts & aeUTF8) && (*p & 0x80)) {
            // handle UTF-8 multibyte character
            int n = 1;
            while (*(p + n) & 0x80) ++n;
            if (st + n <= str.size() && str.compare(st, n, p, n) == 0) {
              ingroup = true;
              p += n;
              st += n;
            } else {
              p = nextchar(p);
            }
          } else if (*p == str[st]) {
            ingroup = true;
            p = nextchar(p);
            ++st;
          } else {
            p = nextchar(p);
          }
        } else {
          // not in a group, must match exactly
          if ((opts & aeUTF8) && (*p & 0x80)) {
            // handle UTF-8 multibyte character
            int n = 1;
            while (*(p + n) & 0x80) ++n;
            if (st + n > str.size() || str.compare(st, n, p, n) != 0)
              return 0;
            p += n;
            st += n;
          } else if (*p != str[st]) {
            return 0;
          } else {
            p = nextchar(p);
            ++st;
          }
          // handle UTF-8 continuation bytes
          while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80)
            ++st;
        }