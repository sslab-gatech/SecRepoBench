default: {
  // if we've run out of input characters, fail
  if (st >= str.size()) return 0;

  // check if the current character matches the condition
  if (str[st] == *p) {
    // advance condition pointer
    p = nextchar(p);

    // consume the matched character in the input
    ++st;
    // skip any trailing bytes if in UTF-8
    while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80) {
      ++st;
    }

    // if we're inside a bracketed group, mark that we found a matching character
    if (pos != std::string::npos) {
      ingroup = true;
    } else {
      // matched outside a group, check if we still have conditions left but no more input
      if (st == str.size() && p) return 0;
    }
  } else if (pos != std::string::npos) {
    // we're inside a bracketed group, no match, so move to the next condition char
    p = nextchar(p);
  } else {
    // no match, and not in a group, so fail
    return 0;
  }
  break;
}