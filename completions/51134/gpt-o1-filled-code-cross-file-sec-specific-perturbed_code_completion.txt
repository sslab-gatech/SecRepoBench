{
  if (st >= str.size()) {
    // no more characters left in the input string to match
    return 0;
  }
  const char condChar = *p;
  if (condChar == str[st]) {
    // match
    if (pos != std::string::npos) {
      // we are within a group
      ingroup = true;
      p = nextchar(p);
    } else {
      // skip the matched character in the input string
      p = nextchar(p);
      ++st;
      while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80) {
        ++st;
      }
      if (st == str.size() && p) {
        return 0;  // word ended but condition continues
      }
    }
  } else {
    // no match
    if (pos != std::string::npos) {
      // within a group, so skip this condition character only
      p = nextchar(p);
    } else {
      // not in a group
      return 0;
    }
  }
  break;
}