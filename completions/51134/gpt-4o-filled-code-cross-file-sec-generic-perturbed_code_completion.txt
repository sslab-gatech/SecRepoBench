if (st < str.size()) {
          if ((opts & aeUTF8) && (str[st] & 0x80)) {
            // Handle UTF-8 multibyte character comparison
            const char* utf8_char = &str[st];
            size_t utf8_len = 1;
            while (utf8_len < 4 && (utf8_char[utf8_len] & 0xc0) == 0x80) {
              ++utf8_len;
            }
            if (strncmp(p, utf8_char, utf8_len) == 0) {
              ingroup = true;
              st += utf8_len;
              p = nextchar(p + utf8_len - 1);
            } else {
              p = nextchar(p);
            }
          } else {
            // Handle single byte character comparison
            if (*p == str[st]) {
              ingroup = true;
              ++st;
            }
            p = nextchar(p);
          }
        } else {
          return 0; // No more characters to compare, condition fails
        }
        break;