if (pos != std::string::npos) {
  if (str[pos] == *p) {
    ++st;
    while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80)
      ++st;
    if (st == str.size() && p)
      return 0;  // word <= condition
    if (ingroup)
      ingroup = false;
  } else if (!ingroup) {
    return 0;  // character does not match and is not within a group
  }
} else if (*p == '.') {
  ++st;
  while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80)
    ++st;
  if (st == str.size() && p)
    return 0;  // word <= condition
} else {
  return 0;  // character does not match and is not within a group
}