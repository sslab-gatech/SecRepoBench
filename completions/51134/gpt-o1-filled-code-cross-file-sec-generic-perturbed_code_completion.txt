{
          char cc = *p;
          p = nextchar(p);

          // If we're inside a group [...] (pos != npos), just check if the character matches.
          // If so, mark ingroup = true, but don't advance in the input string yet.
          if (pos != std::string::npos) {
            if (st < str.size() && cc == str[st]) {
              ingroup = true;
            }
          } else {
            // Outside a group, we must have an exact match with the current input character.
            if (st >= str.size() || cc != str[st]) {
              return 0;
            }
            // Match found: move to the next character in the input string.
            ++st;
            // Handle multibyte sequence if UTF-8.
            while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80) {
              ++st;
            }
            // If we run out of input but still have conditions left, fail.
            if (st == str.size() && p) {
              return 0;
            }
          }
          break;
        }