if (st < str.size()) {
          if ((opts & aeUTF8)) {
            // Handle UTF-8 multibyte characters
            size_t char_len = 1;
            if ((str[st] & 0x80) != 0) { // Check if the character is multibyte
              if ((str[st] & 0xE0) == 0xC0) char_len = 2; // 2-byte character
              else if ((str[st] & 0xF0) == 0xE0) char_len = 3; // 3-byte character
              else if ((str[st] & 0xF8) == 0xF0) char_len = 4; // 4-byte character
            }
            if (strncmp(&str[st], p, char_len) == 0) {
              st += char_len;
              p = nextchar(p);
              if (pos != std::string::npos) ingroup = true;
              break;
            }
          } else {
            // Handle single-byte characters
            if (str[st] == *p) {
              ++st;
              p = nextchar(p);
              if (pos != std::string::npos) ingroup = true;
              break;
            }
          }
        }
        if (pos != std::string::npos) {
          p = nextchar(p);
        } else {
          return 0; // Condition failed
        }