if (st < str.size() && str[st] == *p) {
    st++;
    p = nextchar(p);
    // Handle UTF-8 continuation bytes
    while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80) {
        st++;
    }
} else {
    return 0;
}