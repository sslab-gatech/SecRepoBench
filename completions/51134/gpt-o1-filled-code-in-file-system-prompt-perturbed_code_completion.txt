if (st < str.size() && str[st] == *p) {
          // matched
          if (pos != std::string::npos) {
            // we are in a group
            ingroup = true;
            p = nextchar(p);
          } else {
            // not in a group
            p = nextchar(p);
            ++st;
            while ((opts & aeUTF8) && st < str.size() && (str[st] & 0xc0) == 0x80) {
              ++st;
            }
            // if we still have condition chars, but string ended
            if (st == str.size() && p) {
              return 0;
            }
          }
        } else if (pos != std::string::npos) {
          // keep scanning group
          p = nextchar(p);
        } else {
          // no match and not in group
          return 0;
        }