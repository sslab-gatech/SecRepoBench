if (encoding_guess == NULL) {
        xmlSwitchEncoding(ctxt, XML_CHAR_ENCODING_8859_1);
    } else {
        xmlCharEncodingHandlerPtr handler;
        handler = xmlFindCharEncodingHandler(encoding_guess);
        if (handler != NULL) {
            if (strcmp(handler->name, "UTF-8") != 0) {
                xmlSwitchEncoding(ctxt, handler->encoding);
            }
        } else {
            htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                         "Unsupported encoding '%s'\n", encoding_guess, NULL);
        }
    }
    ctxt->input->flags |= XML_INPUT_HAS_ENCODING;