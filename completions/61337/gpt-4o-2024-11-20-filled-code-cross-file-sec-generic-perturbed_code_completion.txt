{
            handler = xmlFindCharEncodingHandler((const char *)encoding_guess);
            if (handler != NULL) {
                if (xmlStrcasecmp(encoding_guess, BAD_CAST "UTF-8") != 0) {
                    if (xmlSwitchToEncoding(ctxt, handler) < 0) {
                        htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                                     "Unsupported encoding %s\n",
                                     encoding_guess, NULL);
                        xmlFree(encoding_guess);
                        return 0;
                    }
                }
                xmlFree(encoding_guess);
            } else {
                htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                             "Unsupported encoding %s\n",
                             encoding_guess, NULL);
                xmlFree(encoding_guess);
                return 0;
            }
        }