{
    xmlCharEncodingHandlerPtr handler;

    handler = xmlFindCharEncodingHandler((const char *) encoding_guess);
    if (handler != NULL) {
        /* If handler is found and is not UTF-8, switch the parser's encoding */
        if (xmlStrcasecmp(handler->name, BAD_CAST "UTF-8") != 0) {
            if (xmlSwitchToEncoding(ctxt, handler) < 0) {
                htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                             "Failed to switch parser to encoding '%s'\n",
                             encoding_guess, NULL);
            }
        }
    } else {
        /* Report unsupported encoding error */
        htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                     "Unsupported encoding '%s'\n",
                     encoding_guess, NULL);
    }
}