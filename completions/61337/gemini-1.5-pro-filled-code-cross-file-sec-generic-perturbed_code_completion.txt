{
            handler = xmlFindCharEncodingHandler(encoding_guess);
            if (handler != NULL) {
                if (xmlStrcasecmp(encoding_guess, BAD_CAST "UTF-8")) {
                    xmlSwitchEncoding(ctxt, handler);
                } else {
                    ctxt->input->flags |= XML_INPUT_HAS_ENCODING;
                }
                xmlFree(encoding_guess);
            } else {
                htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                             "Unsupported encoding %s\n", encoding_guess,
                             NULL);
                xmlFree(encoding_guess);
            }
        }