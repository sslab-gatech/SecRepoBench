handler = xmlFindCharEncodingHandler((const char *) encoding_guess);
if (handler != NULL && strcmp((const char *) handler->name, "UTF-8") != 0) {
    xmlSwitchEncoding(ctxt, handler->encID);
} else {
    xmlFatalErrMsg(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                   "Unsupported encoding %s\n", encoding_guess);
}