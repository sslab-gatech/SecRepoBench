{
    xmlCharEncodingHandlerPtr handler = xmlFindCharEncodingHandler((const char *) encoding_guess);
    if (handler != NULL) {
        if (xmlStrcasecmp(encoding_guess, BAD_CAST "UTF-8") != 0) {
            xmlSwitchEncoding(ctxt, handler);
        }
    } else {
        htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                     "unsupported encoding: %s\n",
                     BAD_CAST encoding_guess, NULL);
    }
}