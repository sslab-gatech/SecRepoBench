// Find a character encoding handler based on a guessed encoding.
    handler = xmlFindCharEncodingHandler(encoding_guess);
    if (handler != NULL) {
        if (strcmp(handler->name, "UTF-8") != 0) {
            xmlSwitchEncoding(ctxt, handler->name);
        }
        xmlFree(handler);
    } else {
        xmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                    "Encoding '%s' is not supported\n", encoding_guess);
    }
    ctxt->input->flags |= XML_INPUT_HAS_ENCODING;