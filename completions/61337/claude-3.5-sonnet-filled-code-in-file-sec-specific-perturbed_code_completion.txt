handler = xmlFindCharEncodingHandler(encoding_guess);
if (handler != NULL) {
    xmlSwitchToEncoding(ctxt, handler);
} else {
    htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                 "Unsupported encoding %s\n",
                 (const xmlChar *) encoding_guess, NULL);
}
xmlFree(encoding_guess);