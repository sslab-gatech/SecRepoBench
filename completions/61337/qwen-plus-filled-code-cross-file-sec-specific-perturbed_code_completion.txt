handler = xmlFindCharEncodingHandler((const char *)encoding_guess);
if (handler != NULL && strcmp(handler->name, "UTF-8") != 0) {
    if (!xmlSwitchEncoding(ctxt, handler)) {
        htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                     "Unsupported encoding %s\n",
                     BAD_CAST encoding_guess, NULL);
    }
} else {
    // If no handler is found or it's UTF-8, report an error
    htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                 "Unsupported or unknown encoding %s\n",
                 BAD_CAST encoding_guess, NULL);
}
free(encoding_guess); // Ensure the guessed encoding string is freed to avoid memory leaks