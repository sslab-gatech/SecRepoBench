{
    handler = xmlFindCharEncodingHandler((const char *)encoding_guess);
    if (handler != NULL) {
        if (xmlStrcmp(encoding_guess, BAD_CAST "UTF-8")) {
            xmlSwitchToEncoding(ctxt, handler);
        }
        xmlFree(encoding_guess);
    } else {
        htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                    "Unsupported encoding\n", encoding_guess, NULL);
        xmlFree(encoding_guess);
        xmlSwitchEncoding(ctxt, XML_CHAR_ENCODING_8859_1);
    }
}