handler = xmlFindCharEncodingHandler((const char*) encoding_guess);
        if (handler != NULL) {
            if (handler->enc != XML_CHAR_ENCODING_UTF8) {
                xmlSwitchEncoding(ctxt, handler->enc);
            }
            ctxt->input->flags |= XML_INPUT_HAS_ENCODING;
        } else {
            htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                        "Unsupported encoding %s\n", encoding_guess);
        }
        xmlFree(encoding_guess);