// <MASK>
ctxt->input->flags |= XML_INPUT_HAS_ENCODING;
if (encoding_guess == NULL) {
    xmlSwitchEncoding(ctxt, XML_CHAR_ENCODING_8859_1);
} else {
    xmlCharEncodingHandlerPtr handler;
    handler = xmlFindCharEncodingHandler((const char *) encoding_guess);
    if (handler != NULL && !xmlStrEqual(BAD_CAST "UTF-8", encoding_guess)) {
        xmlSwitchToEncoding(ctxt, handler);
    } else {
        htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                     "Unsupported encoding %s\n", encoding_guess, NULL);
    }
    xmlFree(encoding_guess);
}