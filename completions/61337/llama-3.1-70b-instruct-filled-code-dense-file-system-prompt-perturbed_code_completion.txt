handler = xmlGetCharEncodingHandler(encoding_guess);
if (handler!= NULL) {
    if (strcmp((const char *)handler->name, "UTF-8")!= 0) {
        xmlSwitchEncoding(ctxt, handler);
    }
} else {
    htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                 "Unsupported encoding %s\n", encoding_guess);
}