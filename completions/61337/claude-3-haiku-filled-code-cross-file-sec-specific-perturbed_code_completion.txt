handler = xmlGetCharEncodingHandler(encoding_guess);
if (handler == NULL) {
    xmlFatalErrMsg(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                   "Unsupported encoding %s\n", encoding_guess);
} else if (strcmp((const char *)handler->name, "UTF-8") != 0) {
    xmlSwitchEncoding(ctxt, handler->enchandler);
}
ctxt->input->flags |= XML_INPUT_HAS_ENCODING;