if (encoding_guess!= NULL) {
    xmlCharEncodingHandlerPtr handler;

    handler = xmlFindCharEncodingHandler(encoding_guess);
    if (handler!= NULL) {
        xmlSwitchToEncoding(ctxt, handler);
    } else {
        htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                     "Unsupported encoding %s\n", encoding_guess, NULL);
    }
    xmlFree(encoding_guess);
}