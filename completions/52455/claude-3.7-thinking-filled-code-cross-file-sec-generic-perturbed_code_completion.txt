// Check for typical fault in the compound word
if (checkcompoundrep && cpdrep_check(st, i + compound_result->blen)) {
    st[i + compound_result->blen] = r;
    continue;
}

// If forbiddenword flag is set, check if the word is in the dictionary and forbidden
if (forbiddenword) {
    struct hentry* rv = lookup(st.c_str(), i + compound_result->blen);
    if (rv && rv->astr && TESTAFF(rv->astr, forbiddenword, rv->alen)) {
        st[i + compound_result->blen] = r;
        return NULL;
    }
}

// Restore the original character at the position
st[i + compound_result->blen] = r;