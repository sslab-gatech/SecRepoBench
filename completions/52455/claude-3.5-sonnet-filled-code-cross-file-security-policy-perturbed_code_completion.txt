if (i + compound_result->blen <= st.size()) {
  st[i + compound_result->blen] = r;
  
  if (checkcompoundrep && cpdrep_check(st.c_str(), i + compound_result->blen))
    return NULL;
  
  if (forbiddenword) {
    struct hentry* rv = lookup(st.c_str(), i + compound_result->blen);
    if (rv && rv->astr && TESTAFF(rv->astr, forbiddenword, rv->alen))
      return NULL;
  }
  
  st[i + compound_result->blen] = '\0';
}