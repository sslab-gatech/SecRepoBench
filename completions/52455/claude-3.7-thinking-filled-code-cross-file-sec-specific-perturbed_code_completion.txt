struct hentry *rv = NULL;

// Check if the current part has a typical fault 
if (checkcompoundrep && (rv = lookup(st.c_str()))) {
  if (rv->astr && TESTAFF(rv->astr, compoundrep, rv->alen)) {
    st[i + compound_result->blen] = r;
    continue;
  }
}

// Check if the current part is a forbidden word
if (forbiddenword && (rv = lookup(st.c_str()))) {
  if (rv->astr && TESTAFF(rv->astr, forbiddenword, rv->alen)) {
    st[i + compound_result->blen] = r;
    return NULL;
  }
}

// Restore the original character
st[i + compound_result->blen] = r;