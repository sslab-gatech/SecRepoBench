while(numbers_left > 0 && i < payload_len) {
  // There must be at least one digit
  if(!isdigit(packet_payload[i])) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, connection_flow);
    return;
  }
  
  // Skip remaining digits
  while(i < payload_len && isdigit(packet_payload[i])) {
    i++;
  }
  
  // Check for space after digits
  if(i < payload_len && packet_payload[i] == ' ') {
    numbers_left--;
    i++;
  } else {
    // No space found, invalid format
    NDPI_EXCLUDE_PROTO(ndpi_struct, connection_flow);
    return;
  }
}

// Check if we found all expected numeric sequences
if(numbers_left > 0) {
  NDPI_EXCLUDE_PROTO(ndpi_struct, connection_flow);
  return;
}

// Scan for alphanumeric characters until newline
while(i < payload_len) {
  if(packet_payload[i] == '\n') {
    connection_flow->tinc_state++;

    if(connection_flow->tinc_state > 3) {
      if(ndpi_struct->tinc_cache == NULL)
        ndpi_struct->tinc_cache = cache_new(TINC_CACHE_MAX_SIZE);

      if(ndpi_struct->tinc_cache != NULL)
        cache_add(ndpi_struct->tinc_cache, 
                 &connection_flow->tinc_cache_entry, sizeof(connection_flow->tinc_cache_entry));

      NDPI_LOG_INFO(ndpi_struct, "found tinc tcp connection\n");
      ndpi_set_detected_protocol(ndpi_struct, connection_flow, 
                                NDPI_PROTOCOL_TINC, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DPI);
    }
    
    return;
  }

  if(!isalnum(packet_payload[i]) && packet_payload[i] != ' ') {
    NDPI_EXCLUDE_PROTO(ndpi_struct, connection_flow);
    return;
  }

  i++;
}