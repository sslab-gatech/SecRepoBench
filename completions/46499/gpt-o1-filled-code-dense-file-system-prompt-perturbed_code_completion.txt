while((numbers_left > 0) && (i < payload_len)) {
  /* Expect a numeric sequence ending with a space */
  if(!isdigit(packet_payload[i])) {
    return;
  }
  while((i < payload_len) && isdigit(packet_payload[i])) {
    i++;
  }
  /* If we run out of data or don't get a space after the number, bail out */
  if((i >= payload_len) || (packet_payload[i] != ' ')) {
    return;
  }
  i++;
  numbers_left--;
}

/* If we didn't consume all expected numeric sequences, bail out */
if(numbers_left > 0) {
  return;
}

/* Continue scanning for alphanumeric or whitespace until newline */
while((i < payload_len) && (packet_payload[i] != '\n')) {
  if(!isalnum(packet_payload[i]) && !isspace(packet_payload[i])) {
    return;
  }
  i++;
}

/* If we haven't found a newline, bail out */
if(i >= payload_len || packet_payload[i] != '\n') {
  return;
}

/* We found a valid pattern, move to next state */
connection_flow->tinc_state++;
if(connection_flow->tinc_state > 3) {
  /* Ensure cache exists and add current connection info */
  if(ndpi_struct->tinc_cache == NULL) {
    ndpi_struct->tinc_cache = cache_init(64, sizeof(struct tinc_cache_entry), NULL, 0, 0);
  }
  cache_add(ndpi_struct->tinc_cache, &connection_flow->tinc_cache_entry, sizeof(connection_flow->tinc_cache_entry));

  NDPI_LOG_INFO(ndpi_struct, "found tinc tcp connection\n");
  ndpi_set_detected_protocol(ndpi_struct, connection_flow,
                             NDPI_PROTOCOL_TINC, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DPI_CACHE);
}
return;