u_int32_t j = i;
	while (j < payload_len && (isalnum(packet_payload[j]) || packet_payload[j] == '-'))
		j++;

	if (j >= payload_len || packet_payload[j] != '\n') {
		NDPI_EXCLUDE_PROTO(ndpi_struct, connection_flow);
		return;
	}

	connection_flow->tinc_state++;

	if (connection_flow->tinc_state > 3) {
		if (ndpi_struct->tinc_cache == NULL) {
			ndpi_struct->tinc_cache = cache_init();
			if (ndpi_struct->tinc_cache == NULL) {
				NDPI_EXCLUDE_PROTO(ndpi_struct, connection_flow);
				return;
			}
		}
		if (cache_add(ndpi_struct->tinc_cache, &connection_flow->tinc_cache_entry,
				sizeof(connection_flow->tinc_cache_entry)) == CACHE_NO_ERROR) {
			NDPI_LOG_INFO(ndpi_struct, "found tinc tcp connection\n");
			ndpi_set_detected_protocol(ndpi_struct, connection_flow, NDPI_PROTOCOL_TINC,
						   NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DPI_CACHE);
		}
	}