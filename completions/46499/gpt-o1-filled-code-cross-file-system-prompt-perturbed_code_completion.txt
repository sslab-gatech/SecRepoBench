{
  /* parse exactly four numeric sequences followed by a space */
  while(numbers_left > 0 && i < payload_len) {
    /* each sequence must start with at least one digit */
    if(!isdigit(packet_payload[i])) return;
    /* move past the digits */
    while(i < payload_len && isdigit(packet_payload[i])) i++;
    /* after digits, a space must follow */
    if(i >= payload_len || packet_payload[i] != ' ') return;
    i++;
    numbers_left--;
  }

  /* after the four sequences, we expect a newline */
  if(i >= payload_len || packet_payload[i] != '\n') return;

  /* format recognized: move to next state */
  connection_flow->tinc_state++;

  /* if we have passed the threshold, insert into cache and declare detection */
  if(connection_flow->tinc_state > 3) {
    if(!ndpi_struct->tinc_cache) {
      /* initialize cache if it's not yet created; you may need an actual init function here */
      ndpi_struct->tinc_cache = cache_init(tinc_cache_hash, tinc_cache_compare, 256, 0);
    }
    /* add this connection's entry into the TINC cache */
    cache_insert(ndpi_struct->tinc_cache,
                 &connection_flow->tinc_cache_entry,
                 sizeof(connection_flow->tinc_cache_entry),
                 NULL, 0);

    NDPI_LOG_INFO(ndpi_struct, "found tinc tcp connection\n");
    ndpi_set_detected_protocol(ndpi_struct, connection_flow,
                               NDPI_PROTOCOL_TINC,
                               NDPI_PROTOCOL_UNKNOWN,
                               NDPI_CONFIDENCE_DPI_CACHE);
  }

  return;
}