mrb_value val = GETARG();
        mrb_float fval;
        char fbuf[68];
        mrb_int need;

        if (mrb_type(val) == MRB_TT_FLOAT) {
          fval = mrb_float(val);
        }
        else {
          fval = mrb_to_flo(mrb, val);
        }

        if (isnan(fval)) {
          const char *s = "NaN";
          size_t len = strlen(s);
          if ((flags & FWIDTH) && width > len) {
            width -= len;
            if (!(flags & FMINUS)) {
              FILL(' ', width);
            }
            PUSH(s, len);
            if (flags & FMINUS) {
              FILL(' ', width);
            }
          }
          else {
            PUSH(s, len);
          }
          break;
        }
        if (isinf(fval)) {
          const char *s = (fval > 0 ? "Inf" : "-Inf");
          size_t len = strlen(s);
          if ((flags & FWIDTH) && width > len) {
            width -= len;
            if (!(flags & FMINUS)) {
              FILL(' ', width);
            }
            PUSH(s, len);
            if (flags & FMINUS) {
              FILL(' ', width);
            }
          }
          else {
            PUSH(s, len);
          }
          break;
        }