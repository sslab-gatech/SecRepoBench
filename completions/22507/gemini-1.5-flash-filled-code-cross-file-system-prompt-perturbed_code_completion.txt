mrb_value val = GETARG();
        double fval;
        char fbuf[68];
        mrb_int need;
        mrb_int n;

        fval = mrb_to_flo(mrb, val);
        if (ISNAN(fval)) {
          const char *s = "NaN";
          int len = 3;
          if (flags & FPLUS || flags & FSPACE) {
            len++;
            width--;
          }
          if (!(flags & FMINUS) && width > len) {
            FILL(' ', width - len);
          }
          if (flags & FPLUS) PUSH("+", 1);
          else if (flags & FSPACE) PUSH(" ", 1);
          PUSH(s, len);
          if (flags & FMINUS && width > len) {
            FILL(' ', width - len);
          }
          break;
        }
        if (ISINF(fval)) {
          const char *s = "Inf";
          int len = 3;
          if (fval < 0.0) {
            s = "-Inf";
            len = 4;
          }
          else if (flags & FPLUS || flags & FSPACE) {
            len++;
            width--;
          }
          if (!(flags & FMINUS) && width > len) {
            FILL(' ', width - len);
          }
          if (fval < 0.0) PUSH("-", 1);
          else if (flags & FPLUS) PUSH("+", 1);
          else if (flags & FSPACE) PUSH(" ", 1);
          PUSH(s, len);
          if (flags & FMINUS && width > len) {
            FILL(' ', width - len);
          }
          break;
        }