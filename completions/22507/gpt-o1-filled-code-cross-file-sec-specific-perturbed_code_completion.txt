{
  mrb_value val = GETARG();
  mrb_float fval;

  if (!mrb_float_p(val)) {
    val = mrb_to_flo(mrb, val);
  }
  fval = mrb_float(val);

  /* Check for NaN or Infinity */
  if (!isfinite(fval)) {
    const char *str;
    int speciallen;

    if (isnan(fval)) {
      str = "NaN";
      speciallen = 3;
    }
    else {
      if (signbit(fval)) {
        str = "-Inf";
        speciallen = 4;
      }
      else if (flags & FPLUS) {
        str = "+Inf";
        speciallen = 4;
      }
      else if (flags & FSPACE) {
        str = " Inf";
        speciallen = 4;
      }
      else {
        str = "Inf";
        speciallen = 3;
      }
    }

    if ((flags & FWIDTH) && width > speciallen && !(flags & FMINUS)) {
      FILL(' ', width - speciallen);
    }
    PUSH(str, speciallen);
    if ((flags & FWIDTH) && width > speciallen && (flags & FMINUS)) {
      FILL(' ', width - speciallen);
    }
    break;
  }
}