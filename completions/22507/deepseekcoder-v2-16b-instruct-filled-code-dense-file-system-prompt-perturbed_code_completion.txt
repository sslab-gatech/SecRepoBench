case 'f':
      case 'g':
      case 'G':
      case 'e':
      case 'E':
      case 'a':
      case 'A': {
        // Check if the next argument is finite. If the value is NaN (Not a Number) or
        // Infinity, prepare to format it as "NaN" or "Inf" respectively, 
        // including potential sign handling ('+' or ' ' for positive numbers if specified).
        // Calculate the number of characters needed for representation. 
        // Handle padding and alignment (left or right) based on flags before storing the result
        // in the buffer.
        mrb_value val = GETARG();
        if (mrb_float_p(val)) {
          double fval = mrb_float(val);
          if (isnan(fval)) {
            PUSH("NaN", 3);
          } else if (isinf(fval)) {
            PUSH("Inf", 3);
          } else {
            char fbuf[DBL_DIG * 4 + 20];
            char *buf = fbuf;
            int len = snprintf(buf, sizeof(fbuf), "%.*g", (int)(flags & FPREC ? prec : 6), fval);
            PUSH(buf, len);
          }
        } else {
          mrb_raisef(mrb, E_ARGUMENT_ERROR, "expected a float argument");
        }
      }
      break;