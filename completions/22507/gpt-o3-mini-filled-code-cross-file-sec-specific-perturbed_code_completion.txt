{
  mrb_value val = GETARG();
  mrb_float fval = mrb_float(val);
  char fbuf[64];
  int need;

  /* Handle non-finite values */
  if (isnan(fval)) {
    char sign = '\0';
    if (flags & FPLUS)
      sign = '+';
    else if (flags & FSPACE)
      sign = ' ';
    if (sign)
      PUSH(&sign, 1);
    PUSH("NaN", 3);
    break;
  }
  if (!isfinite(fval)) {
    char sign = '\0';
    if (fval < 0)
      sign = '-';
    else if (flags & FPLUS)
      sign = '+';
    else if (flags & FSPACE)
      sign = ' ';
    if (sign)
      PUSH(&sign, 1);
    PUSH("Inf", 3);
    break;
  }
}