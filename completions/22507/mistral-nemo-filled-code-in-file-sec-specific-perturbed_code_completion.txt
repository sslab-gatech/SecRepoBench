// <MASK>
if (mrb_float_p(arg)) {
  mrb_float fval = mrb_float(arg);
  int flags = 0;
  mrb_int width = 0, prec = 0;

  // Parse format string and extract flags, width, and precision
  // ...

  // Format the float value based on the parsed format string
  // ...

  // Store the formatted string in the result buffer
  // ...
} else {
  mrb_raise(mrb, E_ARGUMENT_ERROR, "invalid argument type - %S", mrb_obj_class_name(mrb, arg));
}