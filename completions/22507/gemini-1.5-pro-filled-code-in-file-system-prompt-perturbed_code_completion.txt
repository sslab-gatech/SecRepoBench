mrb_value val = GETARG();
        double fval;
        char fbuf[32];
        int need;

        fval = mrb_float(mrb, val);
        if (isnan(fval)) {
          const char *expr = "NaN";
          int explen = 3;
          if ((flags & FWIDTH) && width > explen) {
            CHECK(width);
            width -= explen;
            if (flags & FMINUS) {
              PUSH(expr, explen);
              FILL(' ', width);
            }
            else {
              FILL(' ', width);
              PUSH(expr, explen);
            }
          }
          else {
            PUSH(expr, explen);
          }
          break;
        }
        if (isinf(fval)) {
          const char *expr = (fval > 0.0) ? "Inf" : "-Inf";
          int explen = (fval > 0.0) ? 3 : 4;
          if (fval > 0.0 && flags & (FPLUS|FSPACE)) explen++;
          if ((flags & FWIDTH) && width > explen) {
            CHECK(width);
            width -= explen;
            if (flags & FMINUS) {
              if (fval > 0.0) {
                if (flags & FPLUS) PUSH("+", 1);
                else if (flags & FSPACE) PUSH(" ", 1);
              }
              PUSH(expr, explen);
              FILL(' ', width);
            }
            else {
              FILL(' ', width);
              if (fval > 0.0) {
                if (flags & FPLUS) PUSH("+", 1);
                else if (flags & FSPACE) PUSH(" ", 1);
              }
              PUSH(expr, explen);
            }
          }
          else {
            if (fval > 0.0) {
              if (flags & FPLUS) PUSH("+", 1);
              else if (flags & FSPACE) PUSH(" ", 1);
            }
            PUSH(expr, explen);
          }
          break;
        }