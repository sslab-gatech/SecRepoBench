mrb_float fval = mrb_float(GETARG());
        char fbuf[32];
        int need;

        if (isinf(fval)) {
          const char *infstr = "Inf";
          mrb_int len = 3;
          if (fval < 0) {
            number_sign = 1;
            sc = '-';
            width--;
          }
          else if (flags & FPLUS) {
            number_sign = 1;
            sc = '+';
            width--;
          }
          else if (flags & FSPACE) {
            number_sign = 1;
            sc = ' ';
            width--;
          }
          if (width > len) {
            if (!(flags & FMINUS)) {
              FILL(' ', width - len);
            }
            if (sc) PUSH(&sc, 1);
            PUSH(infstr, len);
            if (flags & FMINUS) {
              FILL(' ', width - len);
            }
          }
          else {
            if (sc) PUSH(&sc, 1);
            PUSH(infstr, len);
          }
        }
        else if (isnan(fval)) {
          const char *nanstr = "NaN";
          mrb_int len = 3;
          if (width > len) {
            if (!(flags & FMINUS)) {
              FILL(' ', width - len);
            }
            PUSH(nanstr, len);
            if (flags & FMINUS) {
              FILL(' ', width - len);
            }
          }
          else {
            PUSH(nanstr, len);
          }
        }
        else {