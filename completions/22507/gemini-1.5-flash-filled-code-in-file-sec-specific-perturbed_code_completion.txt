mrb_value val = GETARG();
        char fbuf[68];
        double fval;
        mrb_int need;
        char *s;

        if (mrb_type(val) == MRB_TT_FLOAT) {
          fval = mrb_float(val);
          if (isnan(fval)) {
            s = "NaN";
            need = 3;
          }
          else if (isinf(fval)) {
            s = (fval > 0) ? "Inf" : "-Inf";
            need = 4;
          }
          else {
            goto fmt_float;
          }
          if (flags & FPLUS || flags & FSPACE) {
            need++;
          }
          if ((flags & FWIDTH) && need < width) {
            need = width;
          }
          CHECK(need);
          if (flags & FPLUS) {
            *buf++ = '+';
          }
          else if (flags & FSPACE) {
            *buf++ = ' ';
          }
          memcpy(buf, s, need);
          blen += need;
            continue;
          }
        fmt_float: