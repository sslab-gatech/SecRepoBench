mrb_float fval;
        char fbuf[24];
        int need;
        mrb_value val = GETARG();

        fval = mrb_float(val);
        if (isnan(fval)) {
          const char *expr = "NaN";
          int explen = 3;
          if ((flags & FWIDTH) && width > explen) {
            CHECK(width);
            if (flags & FMINUS) {
              PUSH(expr, explen);
              FILL(' ', width - explen);
            }
            else {
              FILL(' ', width - explen);
              PUSH(expr, explen);
            }
          }
          else {
            PUSH(expr, explen);
          }
          break;
        }
        if (isinf(fval)) {
          const char *expr = (fval > 0.0) ? "Inf" : "-Inf";
          int explen = (fval > 0.0) ? 3 : 4;
          if (fval > 0.0) {
            if (flags & FPLUS) {
              expr = "+Inf";
              explen = 4;
            }
            else if (flags & FSPACE) {
              expr = " Inf";
              explen = 4;
            }
          }
          if ((flags & FWIDTH) && width > explen) {
            CHECK(width);
            if (flags & FMINUS) {
              PUSH(expr, explen);
              FILL(' ', width - explen);
            }
            else {
              FILL(' ', width - explen);
              PUSH(expr, explen);
            }
          }
          else {
            PUSH(expr, explen);
          }
          break;
        }