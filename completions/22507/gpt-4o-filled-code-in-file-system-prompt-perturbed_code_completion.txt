mrb_value val = GETARG();
        mrb_float fval;
        char fbuf[32];
        int need;

        switch (mrb_type(val)) {
          case MRB_TT_FLOAT:
            fval = mrb_float(val);
            break;
          case MRB_TT_FIXNUM:
            fval = (mrb_float)mrb_fixnum(val);
            break;
          case MRB_TT_STRING:
            val = mrb_str_to_inum(mrb, val, 0, TRUE);
            if (mrb_fixnum_p(val)) {
              fval = (mrb_float)mrb_fixnum(val);
            }
            else {
              fval = mrb_float(val);
            }
            break;
          default:
            fval = mrb_to_flo(mrb, val);
            break;
        }

        if (isnan(fval)) {
          if (fval < 0) {
            PUSH("-NaN", 4);
          }
          else if (flags & FPLUS) {
            PUSH("+NaN", 4);
          }
          else if (flags & FSPACE) {
            PUSH(" NaN", 4);
          }
          else {
            PUSH("NaN", 3);
          }
          break;
        }
        if (isinf(fval)) {
          if (fval < 0) {
            PUSH("-Inf", 4);
          }
          else if (flags & FPLUS) {
            PUSH("+Inf", 4);
          }
          else if (flags & FSPACE) {
            PUSH(" Inf", 4);
          }
          else {
            PUSH("Inf", 3);
          }
          break;
        }