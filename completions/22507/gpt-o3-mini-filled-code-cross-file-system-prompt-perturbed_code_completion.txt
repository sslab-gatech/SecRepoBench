{
  mrb_value farg = GETARG();
  fval = mrb_float(farg);
  if (!mrb_float_finite(fval)) {
    char sign = 0;
    const char *rep;
    int rep_len;
    if (isnan(fval)) {
      rep = "NaN";
    }
    else {
      rep = "Inf";
      if (fval < 0) {
        sign = '-';
      }
      else if (flags & FPLUS) {
        sign = '+';
      }
      else if (flags & FSPACE) {
        sign = ' ';
      }
    }
    rep_len = (int)strlen(rep);
    if (sign) rep_len++;
    if (!(flags & FMINUS) && width > rep_len)
      FILL(' ', width - rep_len);
    if (sign)
      PUSH(&sign, 1);
    PUSH(rep, strlen(rep));
    if ((flags & FMINUS) && width > rep_len)
      FILL(' ', width - rep_len);
    break;
  }
}