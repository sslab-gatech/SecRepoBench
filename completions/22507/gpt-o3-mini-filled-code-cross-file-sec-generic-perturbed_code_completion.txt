{
  mrb_value val = GETARG();
  double fval = mrb_float(val);
  if (isnan(fval)) {
    const char *nan_str = "NaN";
    int nan_len = 3;
    if (flags & FWIDTH) {
      if (flags & FMINUS) {
        PUSH(nan_str, nan_len);
        if (width > nan_len) FILL(' ', width - nan_len);
      }
      else {
        if (width > nan_len) FILL(' ', width - nan_len);
        PUSH(nan_str, nan_len);
      }
    }
    else {
      PUSH(nan_str, nan_len);
    }
    break;
  }
  if (isinf(fval)) {
    const char *inf_str = "Inf";
    int inf_len = 3;
    char sign_ch = 0;
    if (fval < 0) {
      sign_ch = '-';
    }
    else if (flags & FPLUS) {
      sign_ch = '+';
    }
    else if (flags & FSPACE) {
      sign_ch = ' ';
    }
    if (sign_ch) {
      if (width > (inf_len + 1)) {
        if (!(flags & FMINUS)) FILL(' ', width - (inf_len + 1));
        PUSH(&sign_ch, 1);
        PUSH(inf_str, inf_len);
        if (flags & FMINUS) FILL(' ', width - (inf_len + 1));
      }
      else {
        PUSH(&sign_ch, 1);
        PUSH(inf_str, inf_len);
      }
    }
    else {
      if (width > inf_len) {
        if (!(flags & FMINUS)) FILL(' ', width - inf_len);
        PUSH(inf_str, inf_len);
        if (flags & FMINUS) FILL(' ', width - inf_len);
      }
      else {
        PUSH(inf_str, inf_len);
      }
    }
    break;
  }
}