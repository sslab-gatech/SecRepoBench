// <MASK>
  if (mrb_float_p(fval)) {
    if (flags & FPLUS) {
      if (fval > 0) {
        buf[0] = '+';
        need++;
      }
    }
    else if (flags & FSPACE) {
      if (fval > 0) {
        buf[0] = ' ';
        need++;
      }
    }
    else if (fval < 0) {
      buf[0] = '-';
      need++;
    }
    else if (fval == 0) {
      buf[0] = '0';
      need++;
    }
    else {
      buf[0] = '0';
      need++;
      if (flags & FPREC) {
        buf[1] = '.';
        need++;
        if (prec > 6) {
          prec = 6;
        }
        mrb_float_to_cstr(mrb, &buf[2], need - 2, fbuf, fval);
      }
      else {
        mrb_float_to_cstr(mrb, &buf[1], need - 1, fbuf, fval);
      }
    }
  }
  else {
    mrb_raise(mrb, E_TYPE_ERROR, "can't convert %s into Float", mrb_obj_classname(mrb, val));
  }