mrb_value val = GETARG();
        mrb_float fval;
        char fbuf[32];
        int need;

        if (mrb_float_p(val)) {
          fval = mrb_float(val);
        }
        else if (mrb_fixnum_p(val)) {
          fval = (mrb_float)mrb_fixnum(val);
        }
        else {
          mrb_raise(mrb, E_TYPE_ERROR, "non-floating point argument");
        }

        if (isnan(fval)) {
          if (fval < 0) {
            PUSH("-NaN", 4);
          }
          else if (flags & FPLUS) {
            PUSH("+NaN", 4);
          }
          else if (flags & FSPACE) {
            PUSH(" NaN", 4);
          }
          else {
            PUSH("NaN", 3);
          }
          break;
        }
        if (isinf(fval)) {
          if (fval < 0) {
            PUSH("-Inf", 4);
          }
          else if (flags & FPLUS) {
            PUSH("+Inf", 4);
          }
          else if (flags & FSPACE) {
            PUSH(" Inf", 4);
          }
          else {
            PUSH("Inf", 3);
          }
          break;
        }