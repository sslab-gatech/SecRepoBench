char fbuf[32];
        double fval = mrb_float(GETARG());
        int need;

        if (isnan(fval)) {
          const char *nanstr = "NaN";
          if (flags & FPLUS) {
            PUSH("+", 1);
          }
          else if (flags & FSPACE) {
            PUSH(" ", 1);
          }
          need = 3;
          width -= need;
          if (!(flags & FMINUS) && width > 0) {
            FILL(' ', width);
          }
          PUSH(nanstr, need);
          if ((flags & FMINUS) && width > 0) {
            FILL(' ', width);
          }
          break;
        }
        if (isinf(fval)) {
          const char *infstr = "Inf";
          if (fval < 0) {
            PUSH("-", 1);
          }
          else {
            if (flags & FPLUS) {
              PUSH("+", 1);
            }
            else if (flags & FSPACE) {
              PUSH(" ", 1);
            }
          }
          need = 3;
          width -= need;
          if (!(flags & FMINUS) && width > 0) {
            FILL(' ', width);
          }
          PUSH(infstr, need);
          if ((flags & FMINUS) && width > 0) {
            FILL(' ', width);
          }
          break;
        }