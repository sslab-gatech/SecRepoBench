mrb_value val = GETARG();
        mrb_float fval = mrb_float(val);
        char fbuf[32];
        mrb_int need;

        if (mrb_float_p(val)) {
          if (isnan(fval)) {
            PUSH("NaN", 3);
            break;
          } else if (isinf(fval)) {
            if (fval > 0) {
              PUSH("Inf", 3);
            } else {
              PUSH("-Inf", 4);
            }
            break;
          }
        }

        fmt_setup(fbuf, sizeof(fbuf), *p, flags, width, prec);