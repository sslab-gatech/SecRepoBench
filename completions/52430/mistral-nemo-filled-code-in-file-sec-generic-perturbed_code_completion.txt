// ***** BEGIN LICENSE BLOCK *****
// Version: MPL 1.1/GPL 2.0/LGPL 2.1
//
// The contents of this file are subject to the Mozilla Public License Version
// 1.1 (the "MPL"), the GNU General Public License Version 2.0 (the "GPL"),
// and the GNU Lesser General Public License Version 2.1 (the "LGPL"),
// in that order of preference. If neither of these licenses apply to
// you, then you are permitted to use this file under the terms of any
// other valid open source license, obtained in writing for the express
// purpose of this file and of any other files or other works
// distributed under such license(s).
//
// Software distributed under the MPL, GPL, and LGPL is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied. See the licenses for the
// specific language governing permissions and limitations under
// the licenses.
// ***** END LICENSE BLOCK *****/

#include <cstdio>
#include <cstring>
#include <cstdlib>
#include <cmath>

#include <algorithm>
#include <memory>
#include <limits>
#include <string>
#include <vector>

#include "affixmgr.hxx"
#include "affentry.hxx"
#include "langnum.hxx"

#include "csutil.hxx"

AffixMgr::AffixMgr(const char* affpath,
                   const std::vector<HashMgr*>& ptr,
                   const char* key)
  : alldic(ptr)
  , pHMgr(ptr[0])
  , pStart(0)
  , sStart(0)
  , pFlag(0)
  , sFlag(0)
  , PfxEntry::pStart(this)
  , SfxEntry::sStart(this)
  , pHMgr(NULL)
  , cpdmin(-1)
  , cpdmaxsyllable(0)
  , cpdmaxsyllable_1(0)
  , checkcompoundrep(false)
  , checkcompoundrep2(false)
  , checkcompoundtriple(false)
  , checkcompoundcase(false)
  , checkcompoundtriple2(false)
  , simplifiedtriple(false)
  , simplifiedtriple2(false)
  , forbiddenword(FLAG_NULL)
  , nosuggest(FLAG_NULL)
  , nongramsuggest(FLAG_NULL)
  , needaffix(FLAG_NULL)
  , cpdroot(FLAG_NULL)
  , compoundflag(FLAG_NULL)
  , compoundbegin(FLAG_NULL)
  , compoundmiddle(FLAG_NULL)
  , compoundend(FLAG_NULL)
  , compoundpermitflag(FLAG_NULL)
  , compoundforbidflag(FLAG_NULL)
  , compoundroot(FLAG_NULL)
  , onlyincompound(FLAG_NULL)
  , circumfix(FLAG_NULL)
  , onlyupcaseflag(FLAG_NULL)
  , cpdwordmax(-1)
  , cpdmin(0)
  , cpdmaxsyllable(0)
  , checknum(false)
  , havecontclass(false)
  , lemma_present(FLAG_NULL)
  , substandard(FLAG_NULL)
  , fullstrip(false)
  , forceucase(false)
  , warn(false)
  , forbidwarn(false)
  , checksharps(false)
  , sfx(NULL)
  , pfx(NULL)
  , sfxappnd(NULL)
  , sfxextra(0)
  , sfxflag(FLAG_NULL)
  , compoundflag2(FLAG_NULL)
  , compoundbegin2(FLAG_NULL)
  , compoundmiddle2(FLAG_NULL)
  , compoundend2(FLAG_NULL)
  , compoundpermitflag2(FLAG_NULL)
  , compoundforbidflag2(FLAG_NULL)
  , compoundroot2(FLAG_NULL)
  , onlyincompound2(FLAG_NULL)
  , circumfix2(FLAG_NULL)
  , onlyupcaseflag2(FLAG_NULL)
  , compoundflag3(FLAG_NULL)
  , compoundbegin3(FLAG_NULL)
  , compoundmiddle3(FLAG_NULL)
  , compoundend3(FLAG_NULL)
  , compoundpermitflag3(FLAG_NULL)
  , compoundforbidflag3(FLAG_NULL)
  , compoundroot3(FLAG_NULL)
  , onlyincompound3(FLAG_NULL)
  , circumfix3(FLAG_NULL)
  , onlyupcaseflag3(FLAG_NULL)
  , compoundflag4(FLAG_NULL)
  , compoundbegin4(FLAG_NULL)
  , compoundmiddle4(FLAG_NULL)
  , compoundend4(FLAG_NULL)
  , compoundpermitflag4(FLAG_NULL)
  , compoundforbidflag4(FLAG_NULL)
  , compoundroot4(FLAG_NULL)
  , onlyincompound4(FLAG_NULL)
  , circumfix4(FLAG_NULL)
  , onlyupcaseflag4(FLAG_NULL)
  , compoundflag5(FLAG_NULL)
  , compoundbegin5(FLAG_NULL)
  , compoundmiddle5(FLAG_NULL)
  , compoundend5(FLAG_NULL)
  , compoundpermitflag5(FLAG_NULL)
  , compoundforbidflag5(FLAG_NULL)
  , compoundroot5(FLAG_NULL)
  , onlyincompound5(FLAG_NULL)
  , circumfix5(FLAG_NULL)
  , onlyupcaseflag5(FLAG_NULL)
  , compoundflag6(FLAG_NULL)
  , compoundbegin6(FLAG_NULL)
  , compoundmiddle6(FLAG_NULL)
  , compoundend6(FLAG_NULL)
  , compoundpermitflag6(FLAG_NULL)
  , compoundforbidflag6(FLAG_NULL)
  , compoundroot6(FLAG_NULL)
  , onlyincompound6(FLAG_NULL)
  , circumfix6(FLAG_NULL)
  , onlyupcaseflag6(FLAG_NULL)
  , compoundflag7(FLAG_NULL)
  , compoundbegin7(FLAG_NULL)
  , compoundmiddle7(FLAG_NULL)
  , compoundend7(FLAG_NULL)
  , compoundpermitflag7(FLAG_NULL)
  , compoundforbidflag7(FLAG_NULL)
  , compoundroot7(FLAG_NULL)
  , onlyincompound7(FLAG_NULL)
  , circumfix7(FLAG_NULL)
  , onlyupcaseflag7(FLAG_NULL)
  , compoundflag8(FLAG_NULL)
  , compoundbegin8(FLAG_NULL)
  , compoundmiddle8(FLAG_NULL)
  , compoundend8(FLAG_NULL)
  , compoundpermitflag8(FLAG_NULL)
  , compoundforbidflag8(FLAG_NULL)
  , compoundroot8(FLAG_NULL)
  , onlyincompound8(FLAG_NULL)
  , circumfix8(FLAG_NULL)
  , onlyupcaseflag8(FLAG_NULL)
  , compoundflag9(FLAG_NULL)
  , compoundbegin9(FLAG_NULL)
  , compoundmiddle9(FLAG_NULL)
  , compoundend9(FLAG_NULL)
  , compoundpermitflag9(FLAG_NULL)
  , compoundforbidflag9(FLAG_NULL)
  , compoundroot9(FLAG_NULL)
  , onlyincompound9(FLAG_NULL)
  , circumfix9(FLAG_NULL)
  , onlyupcaseflag9(FLAG_NULL)
  , compoundflag10(FLAG_NULL)
  , compoundbegin10(FLAG_NULL)
  , compoundmiddle10(FLAG_NULL)
  , compoundend10(FLAG_NULL)
  , compoundpermitflag10(FLAG_NULL)
  , compoundforbidflag10(FLAG_NULL)
  , compoundroot10(FLAG_NULL)
  , onlyincompound10(FLAG_NULL)
  , circumfix10(FLAG_NULL)
  , onlyupcaseflag10(FLAG_NULL)
  , compoundflag11(FLAG_NULL)
  , compoundbegin11(FLAG_NULL)
  , compoundmiddle11(FLAG_NULL)
  , compoundend11(FLAG_NULL)
  , compoundpermitflag11(FLAG_NULL)
  , compoundforbidflag11(FLAG_NULL)
  , compoundroot11(FLAG_NULL)
  , onlyincompound11(FLAG_NULL)
  , circumfix11(FLAG_NULL)
  , onlyupcaseflag11(FLAG_NULL)
  , compoundflag12(FLAG_NULL)
  , compoundbegin12(FLAG_NULL)
  , compoundmiddle12(FLAG_NULL)
  , compoundend12(FLAG_NULL)
  , compoundpermitflag12(FLAG_NULL)
  , compoundforbidflag12(FLAG_NULL)
  , compoundroot12(FLAG_NULL)
  , onlyincompound12(FLAG_NULL)
  , circumfix12(FLAG_NULL)
  , onlyupcaseflag12(FLAG_NULL)
  , compoundflag13(FLAG_NULL)
  , compoundbegin13(FLAG_NULL)
  , compoundmiddle13(FLAG_NULL)
  , compoundend13(FLAG_NULL)
  , compoundpermitflag13(FLAG_NULL)
  , compoundforbidflag13(FLAG_NULL)
  , compoundroot13(FLAG_NULL)
  , onlyincompound13(FLAG_NULL)
  , circumfix13(FLAG_NULL)
  , onlyupcaseflag13(FLAG_NULL)
  , compoundflag14(FLAG_NULL)
  , compoundbegin14(FLAG_NULL)
  , compoundmiddle14(FLAG_NULL)
  , compoundend14(FLAG_NULL)
  , compoundpermitflag14(FLAG_NULL)
  , compoundforbidflag14(FLAG_NULL)
  , compoundroot14(FLAG_NULL)
  , onlyincompound14(FLAG_NULL)
  , circumfix14(FLAG_NULL)
  , onlyupcaseflag14(FLAG_NULL)
  , compoundflag15(FLAG_NULL)
  , compoundbegin15(FLAG_NULL)
  , compoundmiddle15(FLAG_NULL)
  , compoundend15(FLAG_NULL)
  , compoundpermitflag15(FLAG_NULL)
  , compoundforbidflag15(FLAG_NULL)
  , compoundroot15(FLAG_NULL)
  , onlyincompound15(FLAG_NULL)
  , circumfix15(FLAG_NULL)
  , onlyupcaseflag15(FLAG_NULL)
  , compoundflag16(FLAG_NULL)
  , compoundbegin16(FLAG_NULL)
  , compoundmiddle16(FLAG_NULL)
  , compoundend16(FLAG_NULL)
  , compoundpermitflag16(FLAG_NULL)
  , compoundforbidflag16(FLAG_NULL)
  , compoundroot16(FLAG_NULL)
  , onlyincompound16(FLAG_NULL)
  , circumfix16(FLAG_NULL)
  , onlyupcaseflag16(FLAG_NULL)
  , compoundflag17(FLAG_NULL)
  , compoundbegin17(FLAG_NULL)
  , compoundmiddle17(FLAG_NULL)
  , compoundend17(FLAG_NULL)
  , compoundpermitflag17(FLAG_NULL)
  , compoundforbidflag17(FLAG_NULL)
  , compoundroot17(FLAG_NULL)
  , onlyincompound17(FLAG_NULL)
  , circumfix17(FLAG_NULL)
  , onlyupcaseflag17(FLAG_NULL)
  , compoundflag18(FLAG_NULL)
  , compoundbegin18(FLAG_NULL)
  , compoundmiddle18(FLAG_NULL)
  , compoundend18(FLAG_NULL)
  , compoundpermitflag18(FLAG_NULL)
  , compoundforbidflag18(FLAG_NULL)
  , compoundroot18(FLAG_NULL)
  , onlyincompound18(FLAG_NULL)
  , circumfix18(FLAG_NULL)
  , onlyupcaseflag18(FLAG_NULL)
  , compoundflag19(FLAG_NULL)
  , compoundbegin19(FLAG_NULL)
  , compoundmiddle19(FLAG_NULL)
  , compoundend19(FLAG_NULL)
  , compoundpermitflag19(FLAG_NULL)
  , compoundforbidflag19(FLAG_NULL)
  , compoundroot19(FLAG_NULL)
  , onlyincompound19(FLAG_NULL)
  , circumfix19(FLAG_NULL)
  , onlyupcaseflag19(FLAG_NULL)
  , compoundflag20(FLAG_NULL)
  , compoundbegin20(FLAG_NULL)
  , compoundmiddle20(FLAG_NULL)
  , compoundend20(FLAG_NULL)
  , compoundpermitflag20(FLAG_NULL)
  , compoundforbidflag20(FLAG_NULL)
  , compoundroot20(FLAG_NULL)
  , onlyincompound20(FLAG_NULL)
  , circumfix20(FLAG_NULL)
  , onlyupcaseflag20(FLAG_NULL)
  , compoundflag21(FLAG_NULL)
  , compoundbegin21(FLAG_NULL)
  , compoundmiddle21(FLAG_NULL)
  , compoundend21(FLAG_NULL)
  , compoundpermitflag21(FLAG_NULL)
  , compoundforbidflag21(FLAG_NULL)
  , compoundroot21(FLAG_NULL)
  , onlyincompound21(FLAG_NULL)
  , circumfix21(FLAG_NULL)
  , onlyupcaseflag21(FLAG_NULL)
  , compoundflag22(FLAG_NULL)
  , compoundbegin22(FLAG_NULL)
  , compoundmiddle22(FLAG_NULL)
  , compoundend22(FLAG_NULL)
  , compoundpermitflag22(FLAG_NULL)
  , compoundforbidflag22(FLAG_NULL)
  , compoundroot22(FLAG_NULL)
  , onlyincompound22(FLAG_NULL)
  , circumfix22(FLAG_NULL)
  , onlyupcaseflag22(FLAG_NULL)
  , compoundflag23(FLAG_NULL)
  , compoundbegin23(FLAG_NULL)
  , compoundmiddle23(FLAG_NULL)
  , compoundend23(FLAG_NULL)
  , compoundpermitflag23(FLAG_NULL)
  , compoundforbidflag23(FLAG_NULL)
  , compoundroot23(FLAG_NULL)
  , onlyincompound23(FLAG_NULL)
  , circumfix23(FLAG_NULL)
  , onlyupcaseflag23(FLAG_NULL)
  , compoundflag24