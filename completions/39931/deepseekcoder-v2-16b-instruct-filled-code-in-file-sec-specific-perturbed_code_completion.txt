;
        }
      }
      regs[a] = exc;
      NEXT;
    }

    CASE(OP_RESCUE, B) {
      mrb_value exc;
      mrb_value val;
      mrb_callinfo *ci = mrb->c->ci;
      mrb_int n = ci->n;
      mrb_int nk = ci->nk;
      mrb_value *argv = &ci->stack[1];
      mrb_value args;
      mrb_method_t m;
      struct RClass *clsp;

      if (n == 15) args = argv[0];
      else args = mrb_ary_new_from_values(mrb, n, argv);

      if (mrb_func_basic_p(mrb, regs[0], MRB_SYM(method_missing), mrb_obj_missing)) {
        goto method_missing;
      }
      m = mrb_method_search_vm(mrb, &clsp, MRB_SYM(method_missing));
      if (MRB_METHOD_UNDEF_P(m)) goto method_missing;
      mrb_stack_extend(mrb, 3);

      argv = &ci->stack[1];
      argv[0] = args;
      if (nk == 0) {
        argv[1] = regs[n+1];
      }
      else {
        mrb_assert(nk == 15);
        argv[1] = argv[n];
        argv[2] = regs[n+1];
      }
      ci->n = 15;
      ci->nk = 0;
      ci->mid = MRB_SYM(method_missing);
      ci->u.target_class = clsp;
      mrb_vm_ci_proc_set(ci, MRB_METHOD_PROC(m));
      mrb_stack_extend(mrb, 4);

      ci->stack[0] = regs[0];
      ci->stack[1] = args;
      ci->stack[2] = regs[n+1];
      ci->stack[3] = regs[n+2];
      val = mrb_run(mrb, MRB_METHOD_PROC(m), regs[0]);
      regs[0] = val;
      NEXT;
    }

    CASE(OP_ENSURE, B) {
      mrb_value val;
      mrb_callinfo *ci = mrb->c->ci;
      mrb_int n = ci->n;
      mrb_int nk = ci->nk;
      mrb_value *argv = &ci->stack[1];
      mrb_value args;
      mrb_method_t m;
      struct RClass *clsp;

      if (n == 15) args = argv[0];
      else args = mrb_ary_new_from_values(mrb, n, argv);

      if (mrb_func_basic_p(mrb, regs[0], MRB_SYM(method_missing), mrb_obj_missing)) {
        goto method_missing;
      }
      m = mrb_method_search_vm(mrb, &clsp, MRB_SYM(method_missing));
      if (MRB_METHOD_UNDEF_P(m)) goto method_missing;
      mrb_stack_extend(mrb, 3);

      argv = &ci->stack[1];
      argv[0] = args;
      if (nk == 0) {
        argv[1] = regs[n+1];
      }
      else {
        mrb_assert(nk == 15);
        argv[1] = argv[n];
        argv[2] = regs[n+1];
      }
      ci->n = 15;
      ci->nk = 0;
      ci->mid = MRB_SYM(method_missing);
      ci->u.target_class = clsp;
      mrb_vm_ci_proc_set(ci, MRB_METHOD_PROC(m));
      mrb_stack_extend(mrb, 4);

      ci->stack[0] = regs[0];
      ci->stack[1] = args;
      ci->stack[2] = regs[n+1];
      ci->stack[3] = regs[n+2];
      val = mrb_run(mrb, MRB_METHOD_PROC(m), regs[0]);
      regs[0] = val;
      NEXT;
    }

    CASE(OP_RAISE, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        exc = mrb_obj_value(mrb->exc);
      }
      mrb_exc_set(mrb, exc);
      goto L_RAISE;
    }

    CASE(OP_THROW, B) {
      mrb_value exc = regs[a];

      if (mrb_nil_p(exc)) {
        exc = mrb_obj_value(mrb->exc);
      }
      mrb_exc_set(mrb, exc);
      goto L_THROW;
    }

    CASE(OP_YIELD, B) {
      mrb_value blk = regs[a];
      mrb_value args = mrb_nil_value();
      mrb_int argc = 0;

      if (mrb_block_given_p()) {
        args = mrb_get_args_block(mrb, &argc, &blk);
      }
      return mrb_yield_with_class(mrb, blk, argc, args, regs[0], MRB_PROC_TARGET_CLASS(proc));
    }

    CASE(OP_RETSYM, B) {
      mrb_sym mid = syms[a];
      mrb_value ret = mrb_nil_value();

      if (mrb_block_given_p()) {
        ret = mrb_get_args_block(mrb, &argc, &blk);
      }
      return mrb_symbol_value(mid);
    }

    CASE(OP_RET, B) {
      mrb_value ret = regs[a];

      if (mrb_block_given_p()) {
        ret = mrb_get_args_block(mrb, &argc, &blk);
      }
      return ret;
    }

    CASE(OP_CALL, BB) {
      mrb_value recv = regs[a];
      mrb_sym mid = syms[b];
      mrb_int argc = 0;
      mrb_value *argv = &regs[a+1];
      mrb_value blk = mrb_nil_value();

      if (mrb_block_given_p()) {
        argc = 1;
        blk = mrb_block_proc(mrb);
      }
      mrb_get_args(mrb, "b*&", &argc, &argv);
      return mrb_funcall_with_block(mrb, recv, mid, argc, argv, blk);
    }

    CASE(OP_CALLARGS, BB) {
      mrb_value recv = regs[a];
      mrb_sym mid = syms[b];
      mrb_int argc = 0;
      mrb_value *argv = &regs[a+1];
      mrb_value blk = mrb_nil_value();

      if (mrb_block_given_p()) {
        argc = 1;
        blk = mrb_block_proc(mrb);
      }
      mrb_get_args(mrb, "b*&", &argc, &argv);
      return mrb_funcall_with_block(mrb, recv, mid, argc, argv, blk);
    }

    CASE(OP_SEND, BB) {
      mrb_value recv = regs[a];
      mrb_sym mid = syms[b];
      mrb_int argc = 0;
      mrb_value *argv = &regs[a+1];
      mrb_value blk = mrb_nil_value();

      if (mrb_block_given_p()) {
        argc = 1;
        blk = mrb_block_proc(mrb);
      }
      mrb_get_args(mrb, "b*&", &argc, &argv);
      return mrb_funcall_with_block(mrb, recv, mid, argc, argv, blk);
    }

    CASE(OP_SENDARGS, BB) {
      mrb_value recv = regs[a];
      mrb_sym mid = syms[b];
      mrb_int argc = 0;
      mrb_value *argv = &regs[a+1];
      mrb_value blk = mrb_nil_value();

      if (mrb_block_given_p()) {
        argc = 1;
        blk = mrb_block_proc(mrb);
      }
      mrb_get_args(mrb, "b*&", &argc, &argv);
      return mrb_funcall_with_block(mrb, recv, mid, argc, argv, blk);
    }

    CASE(OP_SUPER, BB) {
      mrb_value recv = regs[a];
      mrb_sym mid = syms[b];
      mrb_int argc = 0;
      mrb_value *argv = &regs[a+1];
      mrb_value blk = mrb_nil_value();

      if (mrb_block_given_p()) {
        argc = 1;
        blk = mrb_block_proc(mrb);
      }
      mrb_get_args(mrb, "b*&", &argc, &argv);
      return mrb_funcall_with_block(mrb, recv, mid, argc, argv, blk);
    }

    CASE(OP_SUPERARGS, BB) {
      mrb_value recv = regs[a];
      mrb_sym mid = syms[b];
      mrb_int argc = 0;
      mrb_value *argv = &regs[a+1];
      mrb_value blk = mrb_nil_value();

      if (mrb_block_given_p()) {
        argc = 1;
        blk = mrb_block_proc(mrb);
      }
      mrb_get_args(mrb, "b*&", &argc, &argv);
      return mrb_funcall_with_block(mrb, recv, mid, argc, argv, blk);
    }

    CASE(OP_CLASS, B) {
      mrb_value recv = regs[a];
      mrb_sym mid = syms[b];
      mrb_int argc = 0;
      mrb_value *argv = &regs[a+1];
      mrb_value blk = mrb_nil_value();

      if (mrb_block_given_p()) {
        argc = 1;
        blk = mrb_block_proc(mrb);
      }
      mrb_get_args(mrb, "b*&", &argc, &argv);
      return mrb_funcall_with_block(mrb, recv, mid, argc, argv, blk);
    }

    CASE(OP_CLASSARGS, B) {
      mrb_value recv = regs[a];
      mrb_sym mid = syms[b];
      mrb_int argc = 0;
      mrb_value *argv = &regs[a+1];
      mrb_value blk = mrb_nil_value();

      if (mrb_block_given_p()) {
        argc = 1;
        blk = mrb_block_proc(mrb);
      }
      mrb_get_args(mrb, "b*&", &argc, &argv);
      return mrb_funcall_with_block(mrb, recv, mid, argc, argv, blk);
    }

    CASE(OP_SEND_SYM, BB) {
    L_SEND_SYM:
      mrb_value recv = regs[a];
      mrb_sym mid = b;
      mrb_int argc = 0;
      mrb_value *argv = &regs[a+1];
      mrb_value blk = mrb_nil_value();

      if (mrb_block_given_p()) {
        argc = 1;
        blk