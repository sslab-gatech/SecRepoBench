/* Check if the time format string contains a year specifier ("%Y" or "%y"). */
{
    int has_year = FLB_FALSE;
    int has_tz = FLB_FALSE;
    char *found;

    /* Detect if format is epoch (%s). If so, treat it as having a year. */
    found = strstr(p->time_fmt, "%s");
    if (found) {
        is_epoch = FLB_TRUE;
        has_year = FLB_TRUE;
    }

    /* Detect if format already contains year specifiers. */
    if (strstr(p->time_fmt, "%Y") || strstr(p->time_fmt, "%y")) {
        has_year = FLB_TRUE;
    }

    /* If we have no year, prepend "%Y " to the format string. */
    if (has_year == FLB_FALSE) {
        len  = strlen(p->time_fmt);
        size = len + 4 + 2; /* 4 = '%Y ', 2 = null terminator safety */
        tmp  = flb_malloc(size);
        if (!tmp) {
            flb_errno();
            flb_free(p->time_fmt);
            flb_free(p->time_fmt_full);
            flb_free(p);
            return NULL;
        }
        snprintf(tmp, size, "%%Y %s", p->time_fmt);
        p->time_fmt_year = tmp;
    }
    else {
        p->time_fmt_year = NULL;
    }

    /* Check if timezone indicators (%z or %Z) are present. */
    if (strstr(p->time_fmt, "%z") || strstr(p->time_fmt, "%Z")) {
#ifdef FLB_HAVE_FLB_STRPTIME
        has_tz = FLB_TRUE;
#else
        flb_error("[parser:%s] time format '%s' includes timezone but is not supported",
                  name, p->time_fmt);
        flb_free(p->time_fmt);
        flb_free(p->time_fmt_full);
        if (p->time_fmt_year) {
            flb_free(p->time_fmt_year);
        }
        flb_free(p);
        return NULL;
#endif
    }

    /* Handle fractional seconds (%L). If found, record where fractional parsing
     * should begin; we may need to truncate or separately parse the fraction. */
    timeptr = strstr(p->time_fmt, "%L");
    if (timeptr) {
        diff = timeptr - p->time_fmt;
        /* No direct usage here, but keep track if needed for fractional sec parsing. */
        /* e.g. p->frac_sec_offset = diff; */
    }

    /* Process optional fixed timezone offset if provided, e.g. "-08:00". */
    if (time_offset) {
        /* For example, you might parse the string and convert to minutes.
         * This snippet just stores it for reference. */
        /* p->time_offset = atof(time_offset); // or parse with more rigor */
    }
}