{
        p->time_wyear = FLB_FALSE;
        if (strstr(time_fmt, "%Y") || strstr(time_fmt, "%y")) {
            p->time_wyear = FLB_TRUE;
        }

#ifdef FLB_HAVE_TIMEZONE
        p->time_zone = FLB_FALSE;
        if (strstr(time_fmt, "%z") || strstr(time_fmt, "%Z")) {
            p->time_zone = FLB_TRUE;
        }
#else
        if (strstr(time_fmt, "%z") || strstr(time_fmt, "%Z")) {
            flb_error("[parser:%s] timezone is used in time format '%s' "
                      "but this platform does not support timezone parsing",
                      name, time_fmt);
            flb_free(p->time_fmt_full);
            flb_free(p->time_fmt);
            flb_free(p);
            return NULL;
        }
#endif

        if (strstr(time_fmt, "%s")) {
            is_epoch = FLB_TRUE;
            p->time_wyear = FLB_TRUE;
        }
        else if (!p->time_wyear) {
            /* Prepend year to the time format */
            len = strlen(time_fmt);
            size = len + 4;
            tmp = flb_calloc(1, size);
            if (!tmp) {
                flb_errno();
                flb_free(p->time_fmt_full);
                flb_free(p->time_fmt);
                flb_free(p);
                return NULL;
            }
            snprintf(tmp, size, "%%Y %s", time_fmt);
            flb_free(p->time_fmt);
            p->time_fmt = tmp;
            p->time_fmt_year = flb_strdup(p->time_fmt);
        }

        /* Check for fractional seconds */
        timeptr = strstr(time_fmt, "%L");
        if (timeptr) {
#ifdef FLB_HAVE_TM_GMTOFF
            diff = timeptr - time_fmt;
#else
            diff = timeptr - time_fmt;
#endif
            p->time_frac_start = p->time_fmt + diff;
            p->time_frac = FLB_TRUE;
        }

        /* Optional fixed timezone offset */
#ifdef FLB_HAVE_TM_GMTOFF
        if (time_offset) {
            p->time_offset = atoi(time_offset);
        }
#endif
        p->is_epoch = is_epoch;
    }