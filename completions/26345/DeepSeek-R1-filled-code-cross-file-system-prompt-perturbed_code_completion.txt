tmp = strstr(p->time_fmt_full, "%Y");
        if (!tmp) {
            tmp = strstr(p->time_fmt_full, "%y");
        }
        if (tmp) {
            p->time_with_year = FLB_TRUE;
        }
        else if (strstr(p->time_fmt_full, "%s")) {
            is_epoch = FLB_TRUE;
            p->time_with_year = FLB_TRUE;
        }
        else {
            len = strlen(p->time_fmt_full);
            size = len + 3 + 1;
            tmp = flb_malloc(size);
            if (!tmp) {
                flb_errno();
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_free(p);
                return NULL;
            }
            snprintf(tmp, size, "%%Y %s", p->time_fmt_full);
            flb_free(p->time_fmt);
            p->time_fmt = tmp;
            p->time_fmt_year = tmp;
            p->time_with_year = FLB_TRUE;
        }

        if (strstr(p->time_fmt, "%z") || strstr(p->time_fmt, "%Z") ||
            strstr(p->time_fmt, "%:z")) {
#ifndef FLB_HAVE_STRPTIME_TZ
            flb_error("[parser:%s] time format includes timezone but "
                      "system does not support strptime timezone parsing", name);
            flb_free(p->time_fmt);
            flb_free(p->time_fmt_full);
            if (p->time_fmt_year) {
                flb_free(p->time_fmt_year);
            }
            flb_free(p);
            return NULL;
#endif
        }

        char *frac = strstr(p->time_fmt, "%L");
        if (frac) {
            *frac = '\0';
            p->time_frac = frac + 2;
        }

        if (time_offset) {
            if (sscanf(time_offset, "%d", &diff) != 1) {
                flb_error("[parser:%s] invalid time_offset format %s", name, time_offset);
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                if (p->time_fmt_year) {
                    flb_free(p->time_fmt_year);
                }
                flb_free(p);
                return NULL;
            }
            p->time_offset = diff * 3600;
        }