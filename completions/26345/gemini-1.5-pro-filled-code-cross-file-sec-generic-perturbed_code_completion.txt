if (strstr(p->time_fmt, "%Y") || strstr(p->time_fmt, "%y")) {
            p->time_with_year = FLB_TRUE;
        }
        if (strstr(p->time_fmt, "%s")) {
            is_epoch = FLB_TRUE;
            p->time_with_year = FLB_TRUE;
        }
        if (!p->time_with_year) {
            size = strlen(p->time_fmt) + 3;
            tmp = flb_malloc(size);
            if (!tmp) {
                flb_errno();
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_free(p);
                return NULL;
            }
            snprintf(tmp, size, "%%Y %s", p->time_fmt);
            flb_free(p->time_fmt);
            p->time_fmt = tmp;
        }

#ifdef HAVE_TIMEZONE
        /* Check if the format contains a timezone (%Z or %z) */
        if (strstr(p->time_fmt, "%Z") || strstr(p->time_fmt, "%z")) {
            p->time_tz = FLB_TRUE;
        }
#else
        if (strstr(p->time_fmt, "%Z") || strstr(p->time_fmt, "%z")) {
            flb_error("[parser] timezone parsing not available on this platform."
                      " Aborting.");

            flb_free(p->time_fmt);
            flb_free(p->time_fmt_full);
            flb_free(p);
            return NULL;
        }
#endif

        if (is_epoch == FLB_TRUE) {
            p->time_fmt = flb_strdup("%s");
        }

        /* Check if the format contains fractional seconds (msec, usec or nsec) */
        if ((timeptr = strstr(p->time_fmt, "%L"))) {
            /*
             * Extract sub-string before %L, this is required because
             * strptime(3) does not handle fractional seconds.
             */
            diff = timeptr - p->time_fmt;
            p->time_frac_secs = FLB_TRUE;
            p->time_frac = timeptr;

            size = diff + 1;
            tmp = flb_malloc(size);
            if (!tmp) {
                flb_errno();
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_free(p);
                return NULL;
            }
            memcpy(tmp, p->time_fmt, diff);
            tmp[diff] = '\0';
            flb_free(p->time_fmt);
            p->time_fmt = tmp;
        }

        if (time_offset) {
            p->time_offset = flb_strdup(time_offset);
        }