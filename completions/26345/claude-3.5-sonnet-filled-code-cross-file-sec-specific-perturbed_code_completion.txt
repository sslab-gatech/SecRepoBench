p->time_fmt_has_year = FLB_FALSE;
        p->time_with_year = FLB_FALSE;
        p->time_with_tz = FLB_FALSE;

        tmp = strstr(p->time_fmt, "%Y");
        if (tmp) {
            p->time_fmt_has_year = FLB_TRUE;
            p->time_with_year = FLB_TRUE;
        }
        else {
            tmp = strstr(p->time_fmt, "%y");
            if (tmp) {
                p->time_fmt_has_year = FLB_TRUE;
                p->time_with_year = FLB_TRUE;
            }
        }

        if (strstr(p->time_fmt, "%s")) {
            is_epoch = FLB_TRUE;
            p->time_with_year = FLB_TRUE;
        }

        if (!p->time_with_year) {
            size = strlen(p->time_fmt);
            p->time_fmt_year = flb_malloc(size + 4);
            if (!p->time_fmt_year) {
                flb_errno();
                flb_free(p->name);
                flb_free(p->p_regex);
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_regex_destroy(p->regex);
                flb_free(p);
                return NULL;
            }
            memcpy(p->time_fmt_year, "%Y ", 3);
            memcpy(p->time_fmt_year + 3, p->time_fmt, size);
            p->time_fmt_year[size + 3] = '\0';
        }

        if (strstr(p->time_fmt, "%z") || strstr(p->time_fmt, "%Z") ||
            strstr(p->time_fmt, "%SZ") || strstr(p->time_fmt, "%:z")) {
#if !defined(FLB_HAVE_GMTOFF) && !defined(FLB_HAVE_TIMEZONE)
            flb_warn("[parser] timezone offset parsing is not supported");
            flb_free(p->name);
            flb_free(p->p_regex);
            flb_free(p->time_fmt);
            flb_free(p->time_fmt_full);
            flb_free(p->time_fmt_year);
            flb_regex_destroy(p->regex);
            flb_free(p);
            return NULL;
#else
            p->time_with_tz = FLB_TRUE;
#endif
        }

        /* Check if the format contains fractional seconds */
        tmp = strstr(p->time_fmt, "%L");
        if (tmp) {
            tmp[0] = '\0';
            p->time_frac_secs = (tmp + 1);
        }
        else {
            p->time_frac_secs = NULL;
        }

        /* Optional fixed timezone offset */
        if (time_offset) {
            diff = 0;
            len = strlen(time_offset);
            ret = flb_parser_tzone_offset(time_offset, len, &diff);
            if (ret == -1) {
                flb_free(p->name);
                flb_free(p->p_regex);
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_free(p->time_fmt_year);
                flb_regex_destroy(p->regex);
                flb_free(p);
                return NULL;
            }
            p->time_offset = diff;
        }