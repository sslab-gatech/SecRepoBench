timeptr = strstr(p->time_fmt, "%Y");
        if (!timeptr) {
            timeptr = strstr(p->time_fmt, "%y");
        }
        if (timeptr) {
            p->time_with_year = FLB_TRUE;
        }

        timeptr = strstr(p->time_fmt, "%s");
        if (timeptr) {
            p->time_with_year = FLB_TRUE;
            is_epoch = FLB_TRUE;
        }

        if (!p->time_with_year) {
            size = strlen(p->time_fmt) + 3;
            tmp = flb_malloc(size);
            if (!tmp) {
                flb_errno();
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_free(p->name);
                flb_free(p);
                return NULL;
            }
            snprintf(tmp, size, "%%Y %s", p->time_fmt);
            flb_free(p->time_fmt);
            p->time_fmt = tmp;
        }

#ifdef HAVE_TIMEZONE
        /* Check if the format contains a timezone (%z or %Z) */
        if (strstr(p->time_fmt, "%z") || strstr(p->time_fmt, "%Z")) {
            p->time_tz = FLB_TRUE;
        }
#else
        if (strstr(p->time_fmt, "%z") || strstr(p->time_fmt, "%Z")) {
            flb_error("[parser] timezone parsing not available on this platform.");
            if (!p->time_with_year) {
                flb_free(p->time_fmt);
            }
            flb_free(p->time_fmt_full);
            flb_free(p->name);
            flb_free(p);
            return NULL;
        }

#endif

        if (is_epoch == FLB_TRUE) {
            p->time_fmt = flb_strdup("%s");
        }
        else {
            /* Check if we have fractional format */
            timeptr = strstr(p->time_fmt, "%L");
            if (timeptr) {
                len = (timeptr - p->time_fmt) + 2; /* +2 to include %L */
                tmp = flb_malloc(len + 1);
                if (!tmp) {
                    flb_errno();
                    if (!p->time_with_year) {
                        flb_free(p->time_fmt);
                    }
                    flb_free(p->time_fmt_full);
                    flb_free(p->name);
                    flb_free(p);
                    return NULL;
                }
                memcpy(tmp, p->time_fmt, len);
                tmp[len] = '\0';

                p->time_frac_format = tmp;
                diff = strlen(p->time_fmt) - len;
            }
        }

        if (time_offset) {
            p->time_offset = flb_strdup(time_offset);
        }

        if (p->time_frac_format) {
            p->time_fmt_year = flb_strdup(p->time_fmt);
        }