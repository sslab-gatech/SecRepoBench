if (strstr(time_fmt, "%Y") || strstr(time_fmt, "%y")) {
    p->time_with_year = FLB_TRUE;
} else if (strstr(time_fmt, "%s")) {
    p->time_with_year = FLB_TRUE;
    is_epoch = FLB_TRUE;
} else {
    len = strlen(p->time_fmt);
    p->time_with_year = FLB_FALSE;
    p->time_fmt_year = flb_malloc(len + 3);
    if (!p->time_fmt_year) {
        flb_errno();
        flb_free(p->name);
        flb_free(p->time_fmt);
        flb_free(p->time_fmt_full);
        flb_free(p);
        return NULL;
    }
    memcpy(p->time_fmt_year, "%Y ", 3);
    memcpy(p->time_fmt_year + 3, p->time_fmt, len);
    p->time_fmt_year[len + 3] = '\0';
}

if (strstr(time_fmt, "%z") || strstr(time_fmt, "%Z") ||
    strstr(time_fmt, "%SZ") || strstr(time_fmt, "%:z")) {
#if !defined(FLB_HAVE_GMTOFF) && !defined(FLB_HAVE_TIMEZONE)
    flb_warn("[parser] timezone offset parsing is not supported on this platform");
#else
    p->time_with_tz = FLB_TRUE;
#endif
}

if ((tmp = strstr(p->time_fmt, "%L")) != NULL) {
    tmp[0] = '\0';
    p->time_frac_secs = (tmp + 1);
}

if (time_offset) {
    diff = 0;
    size = strlen(time_offset);
    for (int i = 0; i < size; i++) {
        if (time_offset[i] == ':') {
            continue;
        }
        if (time_offset[i] == '+' || time_offset[i] == '-') {
            if (i == 0) {
                continue;
            }
            else {
                break;
            }
        }
        if (isdigit(time_offset[i]) == 0) {
            break;
        }
        diff = (diff * 10) + (time_offset[i] - '0');
    }
    if (time_offset[0] == '-') {
        diff = -diff;
    }
    p->time_offset = diff;
}

if (is_epoch == FLB_TRUE) {
    p->time_format = FLB_PARSER_TIME_EPOCH;
} else {
    p->time_format = FLB_PARSER_TIME_FMT;
}