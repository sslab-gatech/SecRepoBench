if (strstr(time_fmt, "%Y") || strstr(time_fmt, "%y")) {
            p->time_has_year = FLB_TRUE;
        }
        else if (strstr(time_fmt, "%s")) {
            is_epoch = FLB_TRUE;
            p->time_has_year = FLB_TRUE;
        }
        else {
            /* We need to prepend the year */
            len = strlen(time_fmt);
            size = len + 4;
            tmp = flb_malloc(size);
            if (!tmp) {
                flb_errno();
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_free(p);
                return NULL;
            }
            memset(tmp, 0, size);
            memcpy(tmp, "%Y ", 3);
            memcpy(tmp + 3, time_fmt, len);
            p->time_fmt_year = p->time_fmt;
            p->time_fmt = tmp;
        }

#ifdef FLB_HAVE_TIMEZONE
        if (strstr(time_fmt, "%z") || strstr(time_fmt, "%Z")) {
            p->time_timezone = FLB_TRUE;
        }
#else
        if (strstr(time_fmt, "%z") || strstr(time_fmt, "%Z")) {
            flb_error("[parser:%s] timezone is not supported on this platform",
                      name);
            flb_free(p->time_fmt);
            flb_free(p->time_fmt_full);
            if (p->time_fmt_year) {
                flb_free(p->time_fmt_year);
            }
            flb_free(p);
            return NULL;
        }
#endif

        /* Fractional seconds */
#ifdef FLB_HAVE_FRAC_SECS
        timeptr = strstr(p->time_fmt, "%L");
        if (timeptr) {
            p->time_frac_pointer = timeptr;
            *timeptr = '\0';
        }
#endif

        /* Time offset */
        if (time_offset) {
#ifdef FLB_HAVE_TIMEZONE
            diff = flb_time_offset_to_int(time_offset);
            if (diff == INT_MIN) {
                flb_error("[parser:%s] invalid time_offset", name);
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                if (p->time_fmt_year) {
                    flb_free(p->time_fmt_year);
                }
                flb_free(p);
                return NULL;
            }
            p->time_offset_sec = diff;
#else
            flb_error("[parser:%s] time_offset is not supported on this platform",
                      name);
            flb_free(p->time_fmt);
            flb_free(p->time_fmt_full);
            if (p->time_fmt_year) {
                flb_free(p->time_fmt_year);
            }
            flb_free(p);
            return NULL;
#endif
        }