// Check if the time format string contains a year specifier ("%Y" or "%y").
if (strstr(time_fmt, "%Y") || strstr(time_fmt, "%y")) {
    p->time_format_has_year = FLB_TRUE;
}

// If the format contains "%s", set it as an epoch format and indicate it includes a year.
if (strstr(time_fmt, "%s")) {
    is_epoch = FLB_TRUE;
    p->time_format_has_year = FLB_TRUE;
}

// If neither is found, allocate memory to prepend a year ("%Y") to the time format string.
if (!p->time_format_has_year) {
    size = strlen(time_fmt) + 4; // "+4" for "%Y " and null terminator
    p->time_fmt_year = flb_malloc(size);
    if (!p->time_fmt_year) {
        flb_errno();
        flb_parser_destroy(p);
        return NULL;
    }
    snprintf(p->time_fmt_year, size, "%%Y %s", time_fmt);
} else {
    p->time_fmt_year = NULL;
}

// Check if the time format contains timezone indicators ("%z", "%Z", etc.).
if (strstr(time_fmt, "%z") || strstr(time_fmt, "%Z") || strstr(time_fmt, "%:z")) {
    p->time_format_has_timezone = FLB_TRUE;
}

// If timezone support is enabled, set a flag indicating timezone is included.
#ifdef HAVE_TIME_WITH_TIMEZONE
    if (!p->time_format_has_timezone) {
        flb_error("[parser:%s] Timezone parsing is not supported on this platform", name);
        flb_parser_destroy(p);
        return NULL;
    }
#endif

// Determine the correct format string to use for fractional seconds handling.
if ((timeptr = strstr(time_fmt, "%L")) != NULL) {
    len = timeptr - time_fmt; // Position of "%L"
    if (len > 0) {
        tmp = flb_malloc(len + 1);
        if (!tmp) {
            flb_errno();
            flb_parser_destroy(p);
            return NULL;
        }
        strncpy(tmp, time_fmt, len);
        tmp[len] = '\0';
        p->time_frac_format = tmp;
    } else {
        p->time_frac_format = NULL;
    }
} else {
    p->time_frac_format = NULL;
}

// Process an optional fixed timezone offset if provided, adjusting the offset variable.
if (time_offset && !p->time_format_has_timezone) {
    diff = parse_time_offset(time_offset);
    if (diff == -1) {
        flb_error("[parser:%s] Invalid time offset '%s'", name, time_offset);
        flb_parser_destroy(p);
        return NULL;
    }
    p->time_offset = diff;
}