if (time_fmt) {
    p->time_fmt_full = flb_strdup(time_fmt);
    p->time_fmt = flb_strdup(time_fmt);

    /* Check if the format is considering the year */
    // Check if the time format string contains a year specifier ("%Y" or "%y").
    // If found, set a flag indicating the presence of a year in the format.
    // If the format contains "%s", set it as an epoch format and indicate it includes a year.
    // If neither is found, allocate memory to prepend a year ("%Y") to the time format string.
    // Check if the time format contains timezone indicators ("%z", "%Z", etc.).
    // If timezone support is enabled, set a flag indicating timezone is included.
    // Otherwise, log an error and clean up if the platform does not support timezone parsing.
    // Determine the correct format string to use for fractional seconds handling.
    // If fractional seconds ("%L") are found, truncate the format string at that position
    // and store a pointer to the location where fractional seconds should start.
    // Process an optional fixed timezone offset if provided, adjusting the offset variable.
    // Return NULL on failure and perform necessary cleanup in case of errors.
    p->time_with_year = FLB_FALSE;
    p->time_with_tz = FLB_FALSE;
    p->time_offset = 0;
    p->time_frac_secs = NULL;
    p->time_fmt_year = NULL;

    if (strcasestr(time_fmt, "%Y")!= NULL || strcasestr(time_fmt, "%y")!= NULL) {
        p->time_with_year = FLB_TRUE;
    }
    else if (strcasestr(time_fmt, "%s")!= NULL) {
        p->time_with_year = FLB_TRUE;
    }
    else {
        p->time_fmt_year = flb_strdup(time_fmt);
        p->time_fmt_year[0] = '%';
        p->time_fmt_year[1] = 'Y';
        p->time_fmt_year[2] = '\0';
    }

    if (strcasestr(time_fmt, "%z")!= NULL || strcasestr(time_fmt, "%Z")!= NULL) {
        p->time_with_tz = FLB_TRUE;
    }

    if (strcasestr(time_fmt, "%L")!= NULL) {
        p->time_frac_secs = flb_strdup(time_fmt);
        p->time_frac_secs[0] = '\0';
        p->time_frac_secs = flb_strrstr(p->time_frac_secs, "%L");
        if (p->time_frac_secs!= NULL) {
            *p->time_frac_secs = '\0';
            p->time_frac_secs++;
        }
    }

    if (time_offset) {
        p->time_offset = flb_parser_tzone_offset(time_offset, strlen(time_offset), NULL, NULL);
        if (p->time_offset < 0) {
            flb_error("[parser] invalid timezone offset '%s'", time_offset);
            flb_free(p);
            return NULL;
        }
    }
}