{
    /* Check if time format contains a year specifier or is epoch format */
    int has_year = FLB_FALSE;
    char *fmt_check;

    if (strstr(p->time_fmt, "%Y") || strstr(p->time_fmt, "%y")) {
        has_year = FLB_TRUE;
    }
    /* Check epoch format */
    if (strstr(p->time_fmt, "%s")) {
        is_epoch = FLB_TRUE;
        has_year = FLB_TRUE;
    }

    /* If no year specifier found, prepend year specifier */
    if (!has_year) {
        len = strlen(p->time_fmt) + 3; /* 3 = 2 chars of '%Y' plus null terminator */
        p->time_fmt_year = flb_calloc(1, len + 1);
        if (!p->time_fmt_year) {
            flb_errno();
            flb_free(p->time_fmt);
            flb_free(p->time_fmt_full);
            flb_free(p);
            return NULL;
        }
        snprintf(p->time_fmt_year, len + 1, "%%Y%s", p->time_fmt);
        p->time_fmt = p->time_fmt_year;
    }

    /* Check if time format has timezone specifiers */
    if (strstr(p->time_fmt, "%z") || strstr(p->time_fmt, "%Z")) {
#ifdef FLB_HAVE_LOCALTIME_R
        /* Timezone is supported on this platform */
#else
        flb_error("[parser:%s] this platform does not support timezone in time_format '%s'",
                  name, p->time_fmt);
        flb_free(p->time_fmt);
        flb_free(p->time_fmt_full);
        if (p->time_fmt_year) {
            flb_free(p->time_fmt_year);
        }
        flb_free(p);
        return NULL;
#endif
    }

    /* Handle fractional seconds if present (%L). We remove or track it as needed. */
    timeptr = strstr(p->time_fmt, "%L");
    if (timeptr) {
        /* Truncate the format string at %L and keep track of fractional seconds. */
        diff = timeptr - p->time_fmt;
        p->time_fmt[diff] = '\0';
        /* Optionally store the offset or do other setup here. */
    }

    /* If a fixed time offset is provided, parse and handle it. */
    if (time_offset) {
        /* Example parse of time_offset into an integer offset (diff).
         * A real implementation might need to handle +/-HH:MM or similar. */
        diff = atoi(time_offset);
    }
}