// Check if the time format string contains a year specifier ("%Y" or "%y").
// If found, set a flag indicating the presence of a year in the format.
// If the format contains "%s", set it as an epoch format and indicate it includes a year.
// If neither is found, allocate memory to prepend a year ("%Y") to the time format string.
if (strstr(p->time_fmt, "%Y") || strstr(p->time_fmt, "%y")) {
    is_epoch = FLB_FALSE;
}
else if (strstr(p->time_fmt, "%s")) {
    is_epoch = FLB_TRUE;
}
else {
    len = strlen(p->time_fmt);
    tmp = flb_malloc(len + 3);
    if (!tmp) {
        flb_errno();
        flb_free(p->time_fmt);
        flb_free(p->time_fmt_full);
        flb_free(p);
        return NULL;
    }
    strcpy(tmp, "%Y");
    strcat(tmp, p->time_fmt);
    flb_free(p->time_fmt);
    p->time_fmt = tmp;
    p->time_fmt_full = flb_strdup(p->time_fmt);
}

// Check if the time format contains timezone indicators ("%z", "%Z", etc.).
// If timezone support is enabled, set a flag indicating timezone is included.
// Otherwise, log an error and clean up if the platform does not support timezone parsing.
if (strstr(p->time_fmt, "%z") || strstr(p->time_fmt, "%Z") || strstr(p->time_fmt, "%:z") || strstr(p->time_fmt, "%::z")) {
    if (config->timezone_support) {
        p->has_timezone = FLB_TRUE;
    }
    else {
        flb_error("[parser:%s] Timezone support is not enabled, but the time format contains timezone indicators", name);
        flb_free(p->time_fmt);
        flb_free(p->time_fmt_full);
        flb_free(p);
        return NULL;
    }
}

// Determine the correct format string to use for fractional seconds handling.
// If fractional seconds ("%L") are found, truncate the format string at that position
// and store a pointer to the location where fractional seconds should start.
if ((timeptr = strstr(p->time_fmt, "%L"))!= NULL) {
    p->time_fmt_len = timeptr - p->time_fmt;
    p->time_frac_start = timeptr;
}
else {
    p->time_fmt_len = strlen(p->time_fmt);
    p->time_frac_start = NULL;
}

// Process an optional fixed timezone offset if provided, adjusting the offset variable.
if (time_offset) {
    if (sscanf(time_offset, "%d", &diff)!= 1) {
        flb_error("[parser:%s] Invalid time offset '%s'", name, time_offset);
        flb_free(p->time_fmt);
        flb_free(p->time_fmt_full);
        flb_free(p);
        return NULL;
    }
    p->time_offset = diff;
}
else {
    p->time_offset = 0;
}

// Return NULL on failure and perform necessary cleanup in case of errors.
if (!p->time_fmt_full) {
    flb_free(p->time_fmt);
    flb_free(p);
    return NULL;
}