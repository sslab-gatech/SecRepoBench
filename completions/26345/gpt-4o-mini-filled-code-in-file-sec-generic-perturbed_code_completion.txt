if (strstr(time_fmt, "%Y") || strstr(time_fmt, "%y")) {
            p->time_with_year = FLB_TRUE;
        } else if (strstr(time_fmt, "%s")) {
            is_epoch = FLB_TRUE;
            p->time_with_year = FLB_TRUE;
        } else {
            tmp = flb_malloc(strlen(time_fmt) + 6);
            if (!tmp) {
                flb_error("[parser:%s] memory allocation failed", name);
                flb_free(p);
                return NULL;
            }
            sprintf(tmp, "%Y %s", time_fmt);
            flb_free(p->time_fmt);
            p->time_fmt = tmp;
        }

        if (strstr(time_fmt, "%z") || strstr(time_fmt, "%Z")) {
            p->time_with_tz = FLB_TRUE;
        }

        if (is_epoch) {
            p->time_fmt_year = NULL;
        } else {
            p->time_fmt_year = flb_strdup(p->time_fmt);
        }

        if (time_offset) {
            if (flb_parser_tzone_offset(time_offset, strlen(time_offset), &diff) != 0) {
                flb_error("[parser:%s] invalid time offset", name);
                flb_free(p);
                return NULL;
            }
            p->time_offset = diff;
        } else {
            p->time_offset = 0;
        }

        if (strstr(time_fmt, "%L")) {
            char *frac_pos = strstr(time_fmt, "%L");
            *frac_pos = '\0'; // Truncate the format string
            p->time_frac_secs = flb_strdup(frac_pos);
        } else {
            p->time_frac_secs = NULL;
        }