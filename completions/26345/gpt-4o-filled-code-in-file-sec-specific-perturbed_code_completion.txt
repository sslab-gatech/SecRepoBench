if (strstr(time_fmt, "%Y") || strstr(time_fmt, "%y")) {
            p->time_with_year = FLB_TRUE;
        }
        else if (strstr(time_fmt, "%s")) {
            p->time_with_year = FLB_TRUE;
            is_epoch = FLB_TRUE;
        }
        else {
            p->time_fmt_year = flb_malloc(strlen(time_fmt) + 6);
            if (!p->time_fmt_year) {
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_free(p);
                return NULL;
            }
            snprintf(p->time_fmt_year, strlen(time_fmt) + 6, "%%Y %s", time_fmt);
            p->time_with_year = FLB_FALSE;
        }

        if (strstr(time_fmt, "%z") || strstr(time_fmt, "%Z")) {
#ifdef FLB_HAVE_GMTOFF
            p->time_with_tz = FLB_TRUE;
#else
            flb_error("[parser:%s] platform does not support timezones", name);
            flb_free(p->time_fmt);
            flb_free(p->time_fmt_full);
            if (p->time_fmt_year) {
                flb_free(p->time_fmt_year);
            }
            flb_free(p);
            return NULL;
#endif
        }
        else {
            p->time_with_tz = FLB_FALSE;
        }

        timeptr = strstr(time_fmt, "%L");
        if (timeptr) {
            len = (timeptr - time_fmt);
            p->time_frac_secs = flb_strdup(timeptr + 2);
            if (!p->time_frac_secs) {
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                if (p->time_fmt_year) {
                    flb_free(p->time_fmt_year);
                }
                flb_free(p);
                return NULL;
            }
            p->time_fmt[len] = '\0';
        }
        else {
            p->time_frac_secs = NULL;
        }

        if (time_offset) {
            status = flb_parser_tzone_offset(time_offset, strlen(time_offset), &diff);
            if (status == -1) {
                flb_error("[parser:%s] Invalid time offset %s", name, time_offset);
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                if (p->time_fmt_year) {
                    flb_free(p->time_fmt_year);
                }
                if (p->time_frac_secs) {
                    flb_free(p->time_frac_secs);
                }
                flb_free(p);
                return NULL;
            }
        }
        p->time_offset = diff;