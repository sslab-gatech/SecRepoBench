int year_found = 0;
        char *p;
        size_t len;

        p = strstr(p->time_fmt, "%Y");
        if (p) year_found = 1;
        else {
            p = strstr(p->time_fmt, "%y");
            if (p) year_found = 1;
        }

        if (strstr(p->time_fmt, "%s")) {
            is_epoch = FLB_TRUE;
            year_found = 1;
        }

        if (!year_found) {
            len = strlen(p->time_fmt) + 3;
            p->time_fmt_year = flb_malloc(len);
            if (!p->time_fmt_year) {
                flb_errno();
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_free(p);
                return NULL;
            }
            snprintf(p->time_fmt_year, len, "%Y%s", p->time_fmt);
            p->time_fmt = p->time_fmt_year;
        }

        if (flb_tz_support() == FLB_FALSE) {
            if (strstr(p->time_fmt, "%z") || strstr(p->time_fmt, "%Z")) {
                flb_error("[parser:%s] timezone support is disabled, "
                          "please enable it if you need to parse "
                          "timezone information in your time format", name);
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_free(p);
                return NULL;
            }
        }
        else {
            p->has_tz = (strstr(p->time_fmt, "%z") != NULL ||
                         strstr(p->time_fmt, "%Z") != NULL);
        }

        p->time_fmt_frac = NULL;
        p = strstr(p->time_fmt, "%L");
        if (p) {
            p->time_fmt_frac = p;
            *p = '\0';
        }

        if (time_offset) {
            diff = flb_time_offset(time_offset);
            if (diff == -1) {
                flb_error("[parser:%s] Invalid time offset '%s'",
                          name, time_offset);
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_free(p);
                return NULL;
            }
        }
        p->time_offset = diff;