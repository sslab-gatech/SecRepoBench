tmp = strstr(time_fmt, "%Y");
        if (!tmp) {
            tmp = strstr(time_fmt, "%y");
        }
        if (tmp) {
            p->time_with_year = FLB_TRUE;
        }
        else if (strstr(time_fmt, "%s")) {
            is_epoch = FLB_TRUE;
            p->time_with_year = FLB_TRUE;
        }
        else {
            len = strlen(time_fmt);
            size = len + 3 + 1; /* %Y + space + null terminator */
            p->time_fmt_year = flb_malloc(size);
            if (!p->time_fmt_year) {
                flb_errno();
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_free(p);
                return NULL;
            }
            snprintf(p->time_fmt_year, size, "%%Y %s", time_fmt);
            p->time_fmt = p->time_fmt_year;
        }

        /* Check if timezone is specified */
        if (strstr(time_fmt, "%z") || strstr(time_fmt, "%Z")) {
            p->time_with_tz = FLB_TRUE;
        }

        /* Check for fractional seconds */
        tmp = strstr(time_fmt, "%L");
        if (tmp) {
            p->time_frac = tmp - time_fmt;
        }

        /* Process time offset if provided */
        if (time_offset) {
            diff = atoi(time_offset);
            if (diff < -12 || diff > 12) {
                flb_error("[parser:%s] Invalid time offset %s", name, time_offset);
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                if (p->time_fmt_year) {
                    flb_free(p->time_fmt_year);
                }
                flb_free(p);
                return NULL;
            }
            p->time_offset = diff;
        }