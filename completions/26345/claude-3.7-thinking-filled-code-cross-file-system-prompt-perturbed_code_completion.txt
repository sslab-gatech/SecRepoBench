tmp = strstr(p->time_fmt, "%Y");
        if (tmp) {
            p->time_with_year = FLB_TRUE;
        }
        else {
            tmp = strstr(p->time_fmt, "%y");
            if (tmp) {
                p->time_with_year = FLB_TRUE;
            }
            else {
                p->time_with_year = FLB_FALSE;
            }
        }

        /* Check if the format is epoch */
        if (strstr(p->time_fmt, "%s") != NULL) {
            p->time_with_year = FLB_TRUE;
            is_epoch = FLB_TRUE;
        }

        /* If no year is found in the time format, prepend the year */
        if (p->time_with_year == FLB_FALSE) {
            size = strlen(p->time_fmt);
            p->time_fmt_year = flb_malloc(size + 4);
            if (!p->time_fmt_year) {
                flb_errno();
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_free(p->name);
                flb_free(p);
                return NULL;
            }

            /* Append the year at the beginning */
            tmp = p->time_fmt_year;
            *tmp++ = '%';
            *tmp++ = 'Y';
            *tmp++ = ' ';

            /* Copy the existing time format */
            memcpy(tmp, p->time_fmt, size);
            tmp += size;
            *tmp++ = '\0';
        }

        /* Check for timezone in the format */
        if (strstr(p->time_fmt, "%z") || 
            strstr(p->time_fmt, "%Z") ||
            strstr(p->time_fmt, "%SZ") ||
            strstr(p->time_fmt, "%:z")) {
#ifdef FLB_HAVE_TIMEZONE
            p->time_with_tz = FLB_TRUE;
#else
            flb_error("[parser] timezone not supported by the platform");
            flb_free(p->time_fmt_year);
            flb_free(p->time_fmt);
            flb_free(p->time_fmt_full);
            flb_free(p->name);
            flb_free(p);
            return NULL;
#endif
        }

        /* Lookup for millisecond specifier (%L) */
        tmp = strstr(p->time_fmt, "%L");
        if (tmp) {
            /* Need to lookup for the time */
            len = tmp - p->time_fmt;
            timeptr = flb_malloc(len + 1);
            if (!timeptr) {
                flb_errno();
                flb_free(p->time_fmt_year);
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_free(p->name);
                flb_free(p);
                return NULL;
            }

            memcpy(timeptr, p->time_fmt, len);
            timeptr[len] = '\0';

            /* Free the old format and keep the new one */
            flb_free(p->time_fmt);
            p->time_fmt = timeptr;
            p->time_frac_secs = FLB_TRUE;
        }

        /* Optional fixed timezone offset */
        if (time_offset) {
            diff = 0;
            len = strlen(time_offset);
            if (len <= 0) {
                flb_free(p->time_fmt_year);
                flb_free(p->time_fmt);
                flb_free(p->time_fmt_full);
                flb_free(p->name);
                flb_free(p);
                return NULL;
            }

            /* Handle sign and numerical offset */
            if (time_offset[0] == '+' || time_offset[0] == '-') {
                if (len >= 2) {
                    status = flb_utils_time_convert(time_offset + 1, &diff);
                    if (status == -1) {
                        flb_error("[parser] Invalid time offset");
                        flb_free(p->time_fmt_year);
                        flb_free(p->time_fmt);
                        flb_free(p->time_fmt_full);
                        flb_free(p->name);
                        flb_free(p);
                        return NULL;
                    }

                    /* Apply sign */
                    if (time_offset[0] == '-') {
                        diff = -diff;
                    }
                }
            }
            else {
                status = flb_utils_time_convert(time_offset, &diff);
                if (status == -1) {
                    flb_error("[parser] Invalid time offset");
                    flb_free(p->time_fmt_year);
                    flb_free(p->time_fmt);
                    flb_free(p->time_fmt_full);
                    flb_free(p->name);
                    flb_free(p);
                    return NULL;
                }
            }

            p->time_offset = diff;
        }