void collect_glyph_to_sid_map (hb_map_t *mapping, unsigned int glyph_count) const
  {
    unsigned int glyph = 0;
    unsigned int sid = 0;
    unsigned int start_sid = 0;
    unsigned int num_sids = 0;

    // Iterate over a collection of ranges to map glyphs to SIDs.
    for (unsigned int i = 0; i < mapping->num_ranges; i++)
      {
        const hb_range_t *range = &mapping->ranges[i];
        if (glyph >= glyph_count)
          break;

        // For each range, retrieve the starting SID and determine the number of consecutive SIDs to map.
        start_sid = range->start;
        num_sids = range->num_sids;

        // For each SID in the range, map the current glyph identifier to the SID.
        for (unsigned int j = 0; j < num_sids; j++)
          {
            if (glyph >= glyph_count)
              break;

            sid = start_sid + j;
            hb_codepoint_t glyph_id = get_glyph (sid, glyph_count);
            if (glyph_id!= 0)
              {
                mapping->glyph_to_sid_map[glyph] = sid;
                glyph++;
              }
          }
      }
  }