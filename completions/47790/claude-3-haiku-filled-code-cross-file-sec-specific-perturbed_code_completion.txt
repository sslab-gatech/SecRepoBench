for (unsigned int range_index = 0; range_index < num_ranges; range_index++)
{
    hb_codepoint_t start_sid = ranges[range_index].start_sid;
    unsigned int sid_count = ranges[range_index].sid_count;

    for (unsigned int sid = start_sid; sid < start_sid + sid_count; sid++)
    {
        hb_codepoint_t glyph = get_glyph(sid, glyph_count);
        if (glyph != 0)
        {
            hb_map_set(mapping, glyph, sid);
        }
        glyph_index++;
        if (glyph_index >= glyph_count)
            break;
    }
}