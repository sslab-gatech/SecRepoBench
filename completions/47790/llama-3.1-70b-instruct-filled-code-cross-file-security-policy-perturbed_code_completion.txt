if (glyph_count == 0) return;

unsigned int glyph_id = 0;
for (const auto &range : ranges) {
  unsigned int sid = range.start_sid;
  unsigned int num_sids = range.num_sids;
  for (unsigned int i = 0; i < num_sids && glyph_id < glyph_count; i++) {
    hb_codepoint_t glyph = get_glyph(sid + i, glyph_count);
    if (glyph) {
      hb_map_set(mapping, glyph, sid + i);
      glyph_id++;
    }
  }
  if (glyph_id >= glyph_count) break;
}