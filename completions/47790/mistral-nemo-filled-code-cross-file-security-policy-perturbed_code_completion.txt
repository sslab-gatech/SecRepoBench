if (glyph_count > 0) {
  unsigned int start_sid = 0;
  unsigned int sid_count = 0;
  for (unsigned int i = 0; i < glyph_count; ++i) {
    if (i == 0 || glyphs[i] != glyphs[i - 1]) {
      start_sid = get_start_sid(glyphs[i]);
      sid_count = get_sid_count(glyphs[i]);
    }
    for (unsigned int j = 0; j < sid_count; ++j) {
      hb_map_set(mapping, glyphs[i], start_sid + j);
    }
  }
}