for (unsigned int glyph = 0; glyph < glyph_count; glyph++)
{
  hb_codepoint_t sid = 0;
  if (charset != &Null (Charset))
    sid = charset->get_sid (glyph, glyph_count);
  else
  {
    switch (topDict.CharsetOffset)
    {
      case ISOAdobeCharset:
        if (glyph <= 228 /*zcaron*/) sid = glyph;
        break;
      case ExpertCharset:
        sid = lookup_expert_charset_for_sid (glyph);
        break;
      case ExpertSubsetCharset:
        sid = lookup_expert_subset_charset_for_sid (glyph);
        break;
      default:
        break;
    }
  }
  hb_map_set (mapping, glyph, sid);
}