{
    unsigned int glyph_id = 0;

    for (unsigned int i = 0; i < ranges.length; i++)
    {
      const GlyphToSidRange& range = ranges[i];
      hb_codepoint_t start_sid = range.start_sid;
      unsigned int sid_count = range.end_sid - start_sid + 1;

      if (glyph_id + sid_count > glyph_count)
        sid_count = glyph_count - glyph_id;
      
      if (glyph_id >= glyph_count)
        break;

      for (unsigned int j = 0; j < sid_count; j++)
      {
        mapping->set (glyph_id, start_sid + j);
        glyph_id++;

        if (glyph_id == glyph_count)
          break;
      }
      if (glyph_id == glyph_count)
        break;

    }
  }