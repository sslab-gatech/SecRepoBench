unsigned int glyph = 1;  // glyph 0 is reserved (e.g. for .notdef)
for (unsigned int range = 0; range < this->num_ranges && glyph < glyph_count; range++)
{
  hb_codepoint_t first_sid = this->ranges[range].first;
  unsigned int range_count = this->ranges[range].n_left;  // number of extra SIDs in the range

  // Map the first SID and then range_count additional consecutive SIDs.
  for (unsigned int j = 0; j <= range_count && glyph < glyph_count; j++, glyph++)
  {
    hb_map_set(mapping, glyph, first_sid + j);
  }
}