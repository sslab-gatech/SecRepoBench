unsigned int glyph_id = 0;
for (unsigned int i = 0; i < ranges.length; i++) {
  const auto& range = ranges[i];
  unsigned int sid = range.start_sid;
  unsigned int num_sids = range.num_sids;
  for (unsigned int j = 0; j < num_sids; j++) {
    if (glyph_id >= glyph_count) break;
    hb_codepoint_t glyph = get_glyph(sid, glyph_count);
    hb_map_set(mapping, glyph, sid);
    glyph_id++;
    sid++;
  }
  if (glyph_id >= glyph_count) break;
}