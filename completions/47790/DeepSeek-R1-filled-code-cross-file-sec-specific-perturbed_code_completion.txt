unsigned glyph_id = 0;
for (unsigned i = 0; i < get_range_count() && glyph_id < glyph_count; ++i) {
    unsigned start_sid = get_range_start_sid(i);
    unsigned num_sids = get_range_num_sids(i);
    
    for (unsigned j = 0; j < num_sids && glyph_id < glyph_count; ++j) {
        mapping->set(glyph_id, start_sid + j);
        ++glyph_id;
    }
}