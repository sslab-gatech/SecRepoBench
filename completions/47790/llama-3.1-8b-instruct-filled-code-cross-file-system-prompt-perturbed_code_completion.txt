void collect_glyph_to_sid_map (hb_map_t *mapping, unsigned int glyph_count) const
  {
    unsigned int glyph_id = 0;
    for (unsigned int i = 0; i < mapping->num_ranges; ++i)
    {
      hb_range_t range = mapping->ranges[i];
      hb_codepoint_t sid = get_sid (range.start, range.end);
      unsigned int num_sids = range.end - range.start + 1;
      for (unsigned int j = 0; j < num_sids; ++j)
      {
        hb_codepoint_t glyph = get_glyph (sid + j, glyph_count);
        if (glyph!= 0)
        {
          mapping->glyph_to_sid_map[glyph_id] = sid + j;
          glyph_id++;
          if (glyph_id >= glyph_count)
            break;
        }
      }
    }
  }