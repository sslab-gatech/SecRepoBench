unsigned int glyph = 0;
  for (unsigned int i = 0; i < ranges.len; i++) {
    hb_codepoint_t sid = ranges.data[i].sid;
    unsigned int count = ranges.data[i].count;
    if (glyph + count > glyph_count)
      count = glyph_count - glyph;
    for (unsigned int j = 0; j < count; j++) {
      mapping->add (glyph, sid + j);
      glyph++;
    }
  }