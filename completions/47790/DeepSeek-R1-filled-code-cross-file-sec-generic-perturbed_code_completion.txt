unsigned int glyph = 0;
for (unsigned int r = 0; r < get_num_ranges(); r++)
{
    unsigned int start_sid = get_start_sid(r);
    unsigned int num_sids = get_num_sids(r);
    for (unsigned int i = 0; i < num_sids; i++)
    {
        if (glyph >= glyph_count)
            break;
        mapping->set(glyph, start_sid + i);
        glyph++;
    }
    if (glyph >= glyph_count)
        break;
}