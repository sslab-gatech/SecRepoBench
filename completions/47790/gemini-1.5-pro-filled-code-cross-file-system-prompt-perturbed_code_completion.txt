{
  unsigned int glyph_id = 0;

  for (hb_codepoint_t first = 0; first < glyph_count && hb_map_allocation_successful(mapping); ) {
    hb_codepoint_t last;
    hb_codepoint_t sid = get_sid (first, &last);

    if (sid == HB_MAP_VALUE_INVALID) {
      // If the SID is invalid, skip the current glyph.
      first++;
      continue;
    }

    unsigned int count = last - first + 1;

    for (unsigned int i = 0; i < count && glyph_id < glyph_count; i++) {
      hb_map_set (mapping, glyph_id++, sid++);
    }

    first += count;
  }
}