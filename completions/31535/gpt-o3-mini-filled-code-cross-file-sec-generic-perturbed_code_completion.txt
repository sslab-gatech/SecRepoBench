if (frame->sframe) {
    off_pos = header_len;
  } else {
    if (cbytes > INT64_MAX - header_len) {
      BLOSC_TRACE_ERROR("Header length plus cbytes overflows.");
      return NULL;
    }
    off_pos = header_len + cbytes;
  }
  if (off_pos >= frame->len) {
    BLOSC_TRACE_ERROR("Not enough space in the frame for the offsets.");
    return NULL;
  }
  /* The remaining bytes in the frame after off_pos are assumed to contain
     the compressed offsets. */
  int32_t coffsets_cbytes_local = (int32_t)(frame->len - off_pos);
  if (compressed_chunk_size != NULL) {
    *compressed_chunk_size = coffsets_cbytes_local;
  }
  frame->coffsets = frame->cframe + off_pos;
  return frame->coffsets;