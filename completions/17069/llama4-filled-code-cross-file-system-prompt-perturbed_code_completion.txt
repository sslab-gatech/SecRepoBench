// Handle the case where there are unconsumed words left to process.
while(val < end) {
    /* read the unary most significant bits (MSBs) and end bit */
    x = COUNT_ZERO_MSBS2(b);
    if(x == FLAC__BITS_PER_WORD) {
        /* didn't find stop bit yet, have to keep going... */
        cwords++;
        if (cwords >= wordcount)
            goto incomplete_msbs;
        b = br->buffer[cwords];
        x += COUNT_ZERO_MSBS2(b);
    }
    b <<= x;
    b <<= 1; /* account for stop bit */
    ucbits = (ucbits - x - 1) % FLAC__BITS_PER_WORD;
    msbs = x;

    /* read the binary LSBs */
    x = (FLAC__uint32)(b >> (FLAC__BITS_PER_WORD - parameter)); /* parameter < 32, so we can cast to 32-bit uint32_t */
    if(parameter <= ucbits) {
        ucbits -= parameter;
        b <<= parameter;
    } else {
        /* there are still bits left to read, they will all be in the next word */
        cwords++;
        if (cwords >= wordcount)
            goto incomplete_lsbs;
        b = br->buffer[cwords];
        ucbits += FLAC__BITS_PER_WORD - parameter;
        x |= (FLAC__uint32)(b >> ucbits);
        b <<= FLAC__BITS_PER_WORD - ucbits;
    }
    lsbs = x;

    /* compose the value */
    x = (msbs << parameter) | lsbs;
    *val++ = (int)(x >> 1) ^ -(int)(x & 1);
}