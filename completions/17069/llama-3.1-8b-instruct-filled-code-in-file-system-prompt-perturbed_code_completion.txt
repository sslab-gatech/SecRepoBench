do {
	// Handle the case where there are unconsumed words left to process.
	// Read the unary most significant bits (MSBs) and update the consumed words and bits count.
	// Continue by reading the binary least significant bits (LSBs) if necessary.
	// Compose the signed value by combining MSBs and LSBs, and store it in the output array.
	// Update the internal state of the bitreader, ensuring the buffer is positioned correctly for subsequent reads.
	// <MASK>
	if (cwords >= wordcount) {
		// If we've consumed all the words, we can just return true.
		return true;
	}

	// Read the unary MSBs and update the consumed words and bits count.
	x = y = COUNT_ZERO_MSBS2(b);
	if (x == FLAC__BITS_PER_WORD) {
		x = ucbits;
		do {
			// Didn't find stop bit yet, have to keep going...
			cwords++;
			if (cwords >= wordcount)
				goto incomplete_msbs;
			b = br->buffer[cwords];
			y = COUNT_ZERO_MSBS2(b);
			x += y;
		} while (y == FLAC__BITS_PER_WORD);
	}
	b <<= y;
	b <<= 1; /* account for stop bit */
	ucbits = (ucbits - x - 1) % FLAC__BITS_PER_WORD;
	msbs = x;

	// Read the binary LSBs.
	x = (FLAC__uint32)(b >> (FLAC__BITS_PER_WORD - parameter)); /* parameter < 32, so we can cast to 32-bit uint32_t */
	if (parameter <= ucbits) {
		ucbits -= parameter;
		b <<= parameter;
	} else {
		// There are still bits left to read, they will all be in the next word.
		cwords++;
		if (cwords >= wordcount)
			goto incomplete_lsbs;
		b = br->buffer[cwords];
		ucbits += FLAC__BITS_PER_WORD - parameter;
		x |= (FLAC__uint32)(b >> ucbits);
		b <<= FLAC__BITS_PER_WORD - ucbits;
	}
	lsbs = x;

	// Compose the signed value by combining MSBs and LSBs.
	x = (msbs << parameter) | lsbs;
	*val++ = (int)(x >> 1) ^ -(int)(x & 1);

} while (cwords >= wordcount && val < end);

// If we've consumed all the words, we can just return true.
if (cwords >= wordcount) {
	return true;
}

// Update the internal state of the bitreader, ensuring the buffer is positioned correctly for subsequent reads.
br->consumed_bits = FLAC__BITS_PER_WORD - ucbits;
br->consumed_words = cwords;

return true;