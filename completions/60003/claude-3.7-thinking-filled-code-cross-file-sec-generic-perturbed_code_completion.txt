if(packet->payload_packet_len >= 4) {
  /* Check for known Line protocol patterns */
  if((packet->payload_packet_len == 101 && packet->payload[0] == 0x80 && 
      (packet->payload[1] == 0x02 || packet->payload[1] == 0x03 || 
       packet->payload[1] == 0x04 || packet->payload[1] == 0x05)) ||
     (packet->payload_packet_len == 117 && packet->payload[0] == 0x80 && 
      (packet->payload[1] == 0x02 || packet->payload[1] == 0x03 || 
       packet->payload[1] == 0x04 || packet->payload[1] == 0x05))) {
    ndpi_int_line_add_connection(detectionmodulestruct, flow);
    return;
  }
  
  /* Check for Line initialization packets */
  if(packet->payload_packet_len == 13 && 
     packet->payload[0] == 0x11 && packet->payload[1] == 0x00 && 
     packet->payload[2] == 0x0B && packet->payload[3] == 0x00) {
    ndpi_int_line_add_connection(detectionmodulestruct, flow);
    return;
  }
  
  /* Check for another Line-specific pattern */
  if(packet->payload_packet_len > 32 && 
     packet->payload[0] == 0x19 && packet->payload[1] == 0x02 && 
     packet->payload[2] == 0xA3 && packet->payload[3] == 0x17) {
    ndpi_int_line_add_connection(detectionmodulestruct, flow);
    return;
  }
}