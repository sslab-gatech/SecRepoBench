// Get the current offsets
  int32_t off_nbytes = (nchunks + 1) * sizeof(int64_t);
  int64_t* offsets = malloc(off_nbytes);
  if (nchunks > 0) {
    int32_t coffsets_cbytes;
    uint8_t* coffsets = get_coffsets(frame, headerlength, cbytes, &coffsets_cbytes);
    if (coffsets == NULL) {
      BLOSC_TRACE_ERROR("Cannot get the offsets for the frame.");
      free(offsets);
      return BLOSC2_ERROR_DATA;
    }

    // Decompress offsets
    blosc2_dparams off_dparams = BLOSC2_DPARAMS_DEFAULTS;
    blosc2_context* dctx = blosc2_create_dctx(off_dparams);
    int32_t prev_nbytes = blosc2_decompress_ctx(dctx, coffsets, coffsets_cbytes, offsets,
                                                nchunks * sizeof(int64_t));
    blosc2_free_ctx(dctx);
    if (prev_nbytes < 0) {
      free(offsets);
      BLOSC_TRACE_ERROR("Cannot decompress the offsets chunk.");
      return BLOSC2_ERROR_DATA;
    }
  }

  // Get the offset for the nchunk
  if (nchunk >= 0 && nchunk < nchunks) {
    *offset = offsets[nchunk];
  } else {
    BLOSC_TRACE_ERROR("Chunk index out of bounds.");
    free(offsets);
    return BLOSC2_ERROR_INVALID_PARAM;
  }

  free(offsets);
  return BLOSC2_ERROR_SUCCESS;