int32_t coffsets_cbytes = 0;
  uint8_t *coffsets = get_coffsets(frame, headerlength, cbytes, &coffsets_cbytes);
  if (coffsets == NULL) {
    BLOSC_TRACE_ERROR("Cannot retrieve the offsets chunk from the frame.");
    return BLOSC2_ERROR_DATA;
  }
  size_t decomp_size = ((size_t)nchunk + 1) * sizeof(int64_t);
  int64_t *offs = (int64_t *)malloc(decomp_size);
  if (offs == NULL) {
    BLOSC_TRACE_ERROR("Memory allocation error while getting chunk offset.");
    return BLOSC2_ERROR_MEMORY_ALLOC;
  }
  blosc2_dparams off_dparams = BLOSC2_DPARAMS_DEFAULTS;
  blosc2_context *dctx = blosc2_create_dctx(off_dparams);
  int32_t ret_decomp = blosc2_decompress_ctx(dctx, coffsets, coffsets_cbytes, (uint8_t*)offs, decomp_size);
  blosc2_free_ctx(dctx);
  if (ret_decomp < 0) {
    free(offs);
    BLOSC_TRACE_ERROR("Decompression of the offsets failed.");
    return ret_decomp;
  }
  size_t num_offsets = ret_decomp / sizeof(int64_t);
  if ((size_t)nchunk >= num_offsets) {
    free(offs);
    BLOSC_TRACE_ERROR("Chunk index %d out of bounds (number of offsets: %zu).", nchunk, num_offsets);
    return BLOSC2_ERROR_INVALID_PARAM;
  }
  *offset = offs[nchunk];
  free(offs);
  return 0;