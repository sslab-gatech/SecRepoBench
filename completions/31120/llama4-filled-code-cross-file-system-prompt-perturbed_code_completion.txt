// Retrieve the offsets for all chunks in the frame using helper function.
uint8_t *coffsets = get_coffsets(frame, headerlength, cbytes, NULL);
if (coffsets == NULL) {
  BLOSC_TRACE_ERROR("Cannot get the offsets for the frame.");
  return BLOSC2_ERROR_DATA;
}
int32_t coffsets_cbytes;
if (get_coffsets(frame, headerlength, cbytes, &coffsets_cbytes) < 0) {
  BLOSC_TRACE_ERROR("Cannot get the offsets for the frame.");
  free(coffsets);
  return BLOSC2_ERROR_DATA;
}

// Decompress offsets
blosc2_dparams off_dparams = BLOSC2_DPARAMS_DEFAULTS;
blosc2_context *dctx = blosc2_create_dctx(off_dparams);
int32_t prev_nbytes = blosc2_decompress_ctx(dctx, coffsets, coffsets_cbytes, offset,
                                            nchunk * sizeof(int64_t));
blosc2_free_ctx(dctx);
free(coffsets);
if (prev_nbytes < 0) {
  BLOSC_TRACE_ERROR("Cannot decompress the offsets chunk.");
  return BLOSC2_ERROR_DATA;
}

// Obtain the offset for the specified chunk index within the offsets data.
*offset = *(int64_t*)((uint8_t*)offset);
if (*offset == INT64_MAX) {
  // Special value
  return 0;
}

// Return the result code of the operation.
return 0;