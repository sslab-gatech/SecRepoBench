int32_t off_cbytes;
uint8_t *coffsets = get_coffsets(frame, headerlength, cbytes, &off_cbytes);
if (coffsets == NULL) {
  BLOSC_TRACE_ERROR("Cannot get the offsets for the frame.");
  return BLOSC2_ERROR_DATA;
}

blosc2_dparams off_dparams = BLOSC2_DPARAMS_DEFAULTS;
blosc2_context *dctx = blosc2_create_dctx(off_dparams);
int64_t* offsets = (int64_t *) malloc((size_t)frame->nchunks * 8);
int32_t off_nbytes = blosc2_decompress_ctx(dctx, coffsets, off_cbytes,
                                           offsets, frame->nchunks * sizeof(int64_t));
blosc2_free_ctx(dctx);                                           
if (off_nbytes < 0) {
    free(offsets);
    return off_nbytes;
}
*offset = offsets[nchunk];
free(offsets);
return 0;