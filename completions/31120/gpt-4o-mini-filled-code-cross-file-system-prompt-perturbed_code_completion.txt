int ret;
  int64_t* offsets = (int64_t*) malloc(nchunk * sizeof(int64_t));
  if (offsets == NULL) {
    BLOSC_TRACE_ERROR("Memory allocation failed for offsets.");
    return BLOSC2_ERROR_MEMORY_ALLOC;
  }

  ret = get_coffsets(frame, headerlength, cbytes, offsets);
  if (ret < 0) {
    BLOSC_TRACE_ERROR("Failed to retrieve offsets for the frame.");
    free(offsets);
    return ret;
  }

  if (nchunk < 0 || nchunk >= (int32_t)(cbytes / sizeof(int64_t))) {
    BLOSC_TRACE_ERROR("Invalid chunk index: %d.", nchunk);
    free(offsets);
    return BLOSC2_ERROR_INVALID_PARAM;
  }

  *offset = offsets[nchunk];
  free(offsets);
  return 0;