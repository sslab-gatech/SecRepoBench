int32_t coffsets_cbytes = 0;
  uint8_t* coffsets = get_coffsets(frame, headerlength, cbytes, &coffsets_cbytes);
  if (coffsets == NULL) {
    BLOSC_TRACE_ERROR("Cannot get the offsets for the frame.");
    return BLOSC2_ERROR_DATA;
  }

  if (coffsets_cbytes == 0) {
    coffsets_cbytes = (int32_t)cbytes;
  }

  // Get the total number of chunks
  int32_t hlen;
  int64_t flen, nbytes_, cbytes_;
  int32_t chunksize, nchunks;
  int rc = get_header_info(frame, &hlen, &flen, &nbytes_, &cbytes_, &chunksize, &nchunks,
                           NULL, NULL, NULL, NULL, NULL);
  if (rc < 0) {
    BLOSC_TRACE_ERROR("Unable to get meta info from frame.");
    return rc;
  }

  // Check chunk index bounds
  if (nchunk < 0 || nchunk >= nchunks) {
    BLOSC_TRACE_ERROR("nchunk (%d) out of bounds.", nchunk);
    return BLOSC2_ERROR_INVALID_PARAM;
  }

  // Decompress the offsets
  int64_t* offsets_buf = (int64_t*)malloc((size_t)nchunks * sizeof(int64_t));
  if (offsets_buf == NULL) {
    BLOSC_TRACE_ERROR("Cannot allocate memory for offsets buffer.");
    return BLOSC2_ERROR_MEMORY_ALLOC;
  }

  blosc2_dparams dparams = BLOSC2_DPARAMS_DEFAULTS;
  blosc2_context* dctx = blosc2_create_dctx(dparams);
  int32_t decompressed_size =
      blosc2_decompress_ctx(dctx, coffsets, coffsets_cbytes, offsets_buf,
                            (size_t)nchunks * sizeof(int64_t));
  blosc2_free_ctx(dctx);

  if (decompressed_size < 0) {
    BLOSC_TRACE_ERROR("Cannot decompress the offsets chunk.");
    free(offsets_buf);
    return (int)decompressed_size;
  }

  *offset = offsets_buf[nchunk];
  free(offsets_buf);

  return 0;