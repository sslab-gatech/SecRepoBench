int32_t coffsets_cbytes = 0;
  uint8_t* coffsets = get_coffsets(frame, headerlength, cbytes, &coffsets_cbytes);
  if (coffsets == NULL) {
    BLOSC_TRACE_ERROR("Cannot get the offsets for the frame.");
    return BLOSC2_ERROR_DATA;
  }

  // Decompress offsets
  int32_t off_nbytes = sw32_(coffsets + BLOSC2_CHUNK_NBYTES);
  int64_t* offsets_buf = (int64_t*)malloc((size_t)off_nbytes);
  if (offsets_buf == NULL) {
    BLOSC_TRACE_ERROR("Cannot allocate memory for offsets buffer.");
    return BLOSC2_ERROR_MEMORY_ALLOC;
  }

  blosc2_dparams off_dparams = BLOSC2_DPARAMS_DEFAULTS;
  blosc2_context* dctx = blosc2_create_dctx(off_dparams);
  int32_t n_uncompressed = blosc2_decompress_ctx(dctx, coffsets, coffsets_cbytes, offsets_buf, off_nbytes);
  blosc2_free_ctx(dctx);
  if (n_uncompressed < 0) {
    BLOSC_TRACE_ERROR("Cannot decompress the offsets chunk.");
    free(offsets_buf);
    return n_uncompressed;
  }

  // Obtain the offset for the requested chunk index
  *offset = offsets_buf[nchunk];
  free(offsets_buf);

  return 0;