int32_t coffsets_cbytes;
  uint8_t *coffsets = get_coffsets(frame, headerlength, cbytes, &coffsets_cbytes);
  if (coffsets == NULL) {
    BLOSC_TRACE_ERROR("Cannot get the offsets for the frame.");
    return BLOSC2_ERROR_DATA;
  }

  if (coffsets_cbytes == 0) {
    *offset = cbytes * nchunk;  // offsets are implicit
  } else {
    // Decompress offsets
    blosc2_dparams off_dparams = BLOSC2_DPARAMS_DEFAULTS;
    blosc2_context *dctx = blosc2_create_dctx(off_dparams);
    int64_t* offsets = malloc(coffsets_cbytes);
    if (offsets == NULL) {
      BLOSC_TRACE_ERROR("Failed to allocate memory for offsets.");
      return BLOSC2_ERROR_MEMORY_ALLOC;
    }

    int32_t nbytes_read = blosc2_decompress_ctx(dctx, coffsets, coffsets_cbytes, offsets, coffsets_cbytes);
    blosc2_free_ctx(dctx);

    if (nbytes_read < 0) {
      free(offsets);
      BLOSC_TRACE_ERROR("Cannot decompress the offsets chunk.");
      return nbytes_read;
    }

    *offset = offsets[nchunk];

    free(offsets);
  }

  return 0;