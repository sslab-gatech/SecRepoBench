def frame_from_schunk(blosc2_schunk *schunk, blosc2_frame_s *frame) {
  // ... (existing code)

  // Create the frame and put the header at the beginning
  if (frame->urlpath == NULL) {
    frame->cframe = malloc((size_t)frame->len);
    memcpy(frame->cframe, h2, h2len);
  }
  else {
    if (frame->sframe) {
      fp = sframe_open_index(frame->urlpath, "wb");
    }
    else {
      fp = fopen(frame->urlpath, "wb");
    }
    fwrite(h2, h2len, 1, fp);
  }
  free(h2);

  // ... (existing code)
}