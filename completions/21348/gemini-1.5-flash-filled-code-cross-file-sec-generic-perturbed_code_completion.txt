u_int offset = ip_offset + ip_len + sizeof(struct ndpi_udphdr);
      u_int8_t tzsp_version = packet[offset];
      u_int8_t tzsp_type = packet[offset + 1];
      if (tzsp_version == 1 && tzsp_type == 1) { // Check for TZSP version 1 and Ethernet type
        u_int eth_offset_tzsp = offset + 2; // Skip version and type bytes
        while (eth_offset_tzsp < header->caplen) {
          u_int8_t tag_type = packet[eth_offset_tzsp];
          u_int16_t tag_len = ntohs(*(u_int16_t*)(packet + eth_offset_tzsp + 1));
          if (tag_type == 0x00) { // END tag
            break;
          } else if (tag_type == 0x01) { // PADDING tag
            eth_offset_tzsp += tag_len + 2;
          } else if (tag_type == 0x02) { // Ethernet frame tag
            eth_offset = eth_offset_tzsp + 2;
            goto datalink_check;
          } else {
            eth_offset_tzsp += tag_len + 2;
          }
        }
      }