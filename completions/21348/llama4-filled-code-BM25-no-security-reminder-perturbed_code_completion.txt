// Check for TZSP (TaZman Sniffer Protocol) encapsulation in UDP packets.
if((sport == TZSP_PORT) || (dport == TZSP_PORT)) {
  // Calculate the initial offset for the TZSP header within the UDP payload.
  u_int offset = ip_offset + ip_len + sizeof(struct ndpi_udphdr);
  
  // Verify the TZSP version and type, and that it encapsulates Ethernet frames.
  if(packet[offset] == 0x0 && packet[offset+1] == 0x0 && packet[offset+2] == 0x03) {
    offset += 3; // Skip the fixed 3-byte header
    
    // Iterate through the TZSP tags in the packet, adjusting the offset as needed.
    while(packet[offset] != 0x03 /* END tag */) {
      if(packet[offset] == 0x02 /* PADDING tag */) {
        offset += 1; // Skip padding bytes
      } else {
        // Handle other tag types or invalid tags
        break;
      }
    }
    
    if(packet[offset] == 0x03 /* END tag */) {
      offset += 1; // Move past the END tag
      
      // Check if there's enough room for an Ethernet frame
      if(header->caplen >= offset + 14) {
        eth_offset = offset;
        goto datalink_check; // Re-process the encapsulated frame
      }
    }
  }
}