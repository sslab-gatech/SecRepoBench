// Check for TZSP (TaZman Sniffer Protocol) encapsulation in UDP packets.
// Calculate the initial offset for the TZSP header within the UDP payload.
// Verify the TZSP version and type, and that it encapsulates Ethernet frames.
// Iterate through the TZSP tags in the packet, adjusting the offset as needed.
// Handle different tag types, stopping at the END tag or processing PADDING tags.
// If a valid encapsulated Ethernet frame is found, adjust the eth_offset and
// jump back to datalink type checking for further processing of the encapsulated frame.
u_int offset = ip_offset+ip_len+sizeof(struct ndpi_udphdr);
u_int8_t tzsp_version = packet[offset];
u_int8_t tzsp_type = packet[offset+1];

if(tzsp_version == TZSP_VERSION && tzsp_type == TZSP_TYPE_ETHERNET) {
  offset += 2;
  while(1) {
    u_int8_t tag_type = packet[offset];
    u_int8_t tag_len = packet[offset+1];
    offset += 2 + tag_len;

    if(tag_type == TZSP_TAG_END) {
      break;
    } else if(tag_type == TZSP_TAG_PADDING) {
      continue;
    } else if(tag_type == TZSP_TAG_ETHERNET) {
      eth_offset = offset;
      goto datalink_check;
    }
  }
}