// Check for TZSP (TaZman Sniffer Protocol) encapsulation in UDP packets.
      // Calculate the initial offset for the TZSP header within the UDP payload.
      u_int offset = ip_offset + ip_len + sizeof(struct ndpi_udphdr);
      
      // Verify the TZSP version and type, and that it encapsulates Ethernet frames.
      if (packet[offset] == 1 /* TZSP version */ && packet[offset + 1] == 0 /* encapsulated Ethernet */) {
        offset += 2; // Skip version and type

        // Iterate through the TZSP tags in the packet, adjusting the offset as needed.
        while (offset < header->caplen) {
          u_int8_t tag_type = packet[offset];
          u_int8_t tag_length = packet[offset + 1];
          offset += 2; // Move past the tag type and length

          // Handle different tag types, stopping at the END tag or processing PADDING tags.
          if (tag_type == 1 /* END */) {
            break;
          } else if (tag_type == 0 /* PADDING */) {
            continue;
          } else {
            offset += tag_length; // Skip the tag data
          }
        }

        // If a valid encapsulated Ethernet frame is found, adjust the eth_offset and
        // jump back to datalink type checking for further processing of the encapsulated frame.
        eth_offset = offset;
        datalink_type = DLT_EN10MB;
        goto datalink_check;
      }