u_int8_t tzsp_version = packet[offset];
      u_int8_t tzsp_type = packet[offset + 1];

      if (tzsp_version == 1 && tzsp_type == 0) { // Check for valid TZSP version and type
        u_int16_t encapsulated_len = ntohs(*(u_int16_t *)&packet[offset + 2]);
        offset += 4; // Move past the TZSP header

        if (offset + encapsulated_len <= header->caplen) {
          // Adjust eth_offset for the encapsulated packet
          eth_offset = offset;
          // Recheck the datalink type for the encapsulated packet
          goto datalink_check;
        }
      }