// <MASK>
    /* Check for TZSP (TaZman Sniffer Protocol) encapsulation in UDP packets.
     * Calculate the initial offset for the TZSP header within the UDP payload.
     * Verify the TZSP version and type, and that it encapsulates Ethernet frames.
     * Iterate through the TZSP tags in the packet, adjusting the offset as needed.
     * Handle different tag types, stopping at the END tag or processing PADDING tags.
     * If a valid encapsulated Ethernet frame is found, adjust the eth_offset and
     * jump back to datalink type checking for further processing of the encapsulated frame.
     */
    u_int offset = ip_offset + ip_len + sizeof(struct ndpi_udphdr);
    u_int8_t tzsp_version = packet[offset];
    u_int8_t tzsp_type = packet[offset + 1];

    if (tzsp_version == 0x01 && tzsp_type == 0x01) { // TZSP version 1, TZSP type 1 (encapsulated frames)
        offset += 2; // Skip TZSP version and type
        u_int16_t encap_proto = (packet[offset] << 8) | packet[offset + 1];
        offset += 2; // Skip encapsulated protocol

        if (encap_proto == 0x0001) { // Ethernet
            while (offset < header->caplen) {
                u_int8_t tag_type = packet[offset];
                u_int8_t tag_len = packet[offset + 1];
                offset += 2; // Skip tag type and length

                if (tag_type == 0x00) { // PADDING tag
                    continue;
                } else if (tag_type == 0xFF) { // END tag
                    break;
                } else {
                    offset += tag_len; // Skip tag data
                }
            }

            eth_offset = offset;
            datalink_type = DLT_EN10MB;
            goto datalink_check;
        }
    }