// Check for TZSP (TaZman Sniffer Protocol) encapsulation in UDP packets.
    // Calculate the initial offset for the TZSP header within the UDP payload.
    // Verify the TZSP version and type, and that it encapsulates Ethernet frames.
    // Iterate through the TZSP tags in the packet, adjusting the offset as needed.
    // Handle different tag types, stopping at the END tag or processing PADDING tags.
    // If a valid encapsulated Ethernet frame is found, adjust the eth_offset and
    // jump back to datalink type checking for further processing of the encapsulated frame.
    u_int offset = ip_offset + ip_len + sizeof(struct ndpi_udphdr);
    
    // Check for TZSP header
    if (offset + 12 > header->caplen)
        return(detected_protocol);
    
    // Verify TZSP version and type
    if (packet[offset] != 1 || packet[offset + 1] != 0x02)
        return(detected_protocol);
    
    // Process TZSP tags
    u_int tag_offset = offset + 12;
    while (tag_offset < header->caplen) {
        u_int8_t tag_type = packet[tag_offset];
        u_int8_t tag_len = packet[tag_offset + 1];
        
        if (tag_len < 2)
            break;
        
        if (tag_type == 0xFF) // END tag
            break;
        else if (tag_type == 0x00) { // PADDING tag
            tag_offset += tag_len;
            continue;
        }
        
        tag_offset += tag_len;
    }
    
    // Check for valid Ethernet frame
    if (tag_offset + 14 > header->caplen)
        return(detected_protocol);
    
    // Update eth_offset and restart datalink processing
    eth_offset = tag_offset;
    goto datalink_check;