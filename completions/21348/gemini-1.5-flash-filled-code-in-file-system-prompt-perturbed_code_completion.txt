u_int offset = ip_offset + ip_len + sizeof(struct ndpi_udphdr);
      u_int8_t tzsp_version = packet[offset];
      u_int8_t tzsp_type = packet[offset + 1];

      if (tzsp_version == 1 && tzsp_type == 1) { // Check for TZSP version 1 and Ethernet type
        u_int eth_len = ntohs(*(u_int16_t *)&packet[offset + 2]); // Get Ethernet frame length
        if (header->caplen >= offset + 4 + eth_len) { // Check if enough data for Ethernet frame
          eth_offset = offset + 4; // Set eth_offset to the beginning of the Ethernet frame
          datalink_type = DLT_EN10MB; // Set datalink type to Ethernet
          goto datalink_check; // Jump back to datalink type checking
        }
      }