u_int offset = ip_offset + ip_len + sizeof(struct ndpi_udphdr);
      u_int8_t version = packet[offset];
      u_int8_t type = packet[offset + 1];

      if(version == 1 && type == 1) { // Check for TZSP version 1 and Ethernet encapsulation
        offset += 2; // Skip version and type

        // Iterate through TZSP tags
        while(offset < header->caplen) {
          u_int8_t tag_type = packet[offset];
          u_int8_t tag_length = packet[offset + 1];

          offset += 2; // Move past tag type and length

          if(tag_type == 1) { // END tag
            break;
          } else if(tag_type == 0) { // PADDING tag
            continue;
          } else {
            offset += tag_length; // Skip over the tag data
          }
        }

        // Check if we have enough space for an Ethernet frame
        if(offset + sizeof(struct ndpi_ethhdr) <= header->caplen) {
          eth_offset = offset;
          goto datalink_check; // Process the encapsulated Ethernet frame
        }
      }