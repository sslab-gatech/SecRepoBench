->ack && !flow->s_to_c_init_win){
            flow->s_to_c_init_win = rawsize;
        }
    }

    if(ndpi_flow->detection_completed) {
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;
    } else {
      ndpi_flow->detection_started = 1;
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 0;
    }

    if(ndpi_flow->ndpi_flow->detection_in_progress) {
      ndpi_flow->detection_in_progress = 0;
      ndpi_flow->detection_completed = 1;
      process_ndpi_collected_info(workflow, flow);
      return(nproto);
    }

    if(ndpi_flow->ndpi_flow->detection_started) {
      ndpi_flow->detection_in_progress = 1;
      ndpi_flow->detection_completed = 0;