// <MASK>
// Search the data buffer for a specific four-character code indicating an ESDS box type.
// If found, create a new bitstream starting at the identified location in the data buffer.
// Set a cookie on the new bitstream to suppress logging for the operations that follow.
// If an ESDS box already exists in the current box structure, remove its reference from the parent-child hierarchy and delete it.
// Parse a new ESDS box from the bitstream and update the ESDS box reference in the current box structure.
// If the parsing is successful and the box type matches ESDS, ensure the box is added to the list of child boxes.
// Clean up by deleting the created bitstream and handle any memory management necessary for ESDS box references.

u32 esds_code = 0x65736473; // Four-character code for ESDS box
u32 index;
u32 found_code;

for (index = 0; index < size - 8; index++) {
    if (data[index] == (esds_code & 0xFF) &&
        data[index + 1] == (esds_code >> 8 & 0xFF) &&
        data[index + 2] == (esds_code >> 16 & 0xFF) &&
        data[index + 3] == (esds_code >> 24 & 0xFF)) {
        
        // Found the ESDS box, create a new bitstream
        GF_BitStream *esds_bs = gf_bs_new(data + index, 4, GF_FALSE);
        if (!esds_bs) {
            gf_free(data);
            return GF_OUT_OF_MEM;
        }

        // Set cookie to suppress logging
        gf_bs_set_cookie(esds_bs, GF_ISOM_BS_COOKIE_QT_CONV);

        // Check if an ESDS box already exists
        GF_Box *esds_box = gf_isom_box_find_child(s, GF_ISOM_BOX_TYPE_ESDS);
        if (esds_box) {
            gf_isom_box_remove_child(s, esds_box);
            gf_isom_box_delete(esds_box);
        }

        // Parse the new ESDS box
        GF_Err e = gf_isom_box_parse((GF_Box **)&esds_box, esds_bs);
        if (e) {
            gf_bs_delete(esds_bs);
            gf_free(data);
            return e;
        }

        // Ensure the box is added to the list of child boxes
        if (esds_box->type == GF_ISOM_BOX_TYPE_ESDS) {
            gf_isom_box_add_child(s, esds_box);
        } else {
            gf_isom_box_delete(esds_box);
        }

        // Clean up
        gf_bs_delete(esds_bs);
        break;
    }
}