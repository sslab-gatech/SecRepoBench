for (index=0; index<size-8; index++) {
    // Search the data buffer for a specific four-character code indicating an ESDS box type.
    // If found, create a new bitstream starting at the identified location in the data buffer.
    // Set a cookie on the new bitstream to suppress logging for the operations that follow.
    // If an ESDS box already exists in the current box structure, remove its reference from the parent-child hierarchy and delete it.
    // Parse a new ESDS box from the bitstream and update the ESDS box reference in the current box structure.
    // If the parsing is successful and the box type matches ESDS, ensure the box is added to the list of child boxes.
    // Clean up by deleting the created bitstream and handle any memory management necessary for ESDS box references.
    GF_Box *esds_box = NULL;
    u32 esds_box_size = 0;
    u32 esds_box_pos = 0;
    GF_BitStream *esds_bs = NULL;
    GF_Err e = GF_OK;

    // Search for the ESDS box type in the data buffer
    if (memcmp(data + index, "esds", 4) == 0) {
        // Create a new bitstream starting at the identified location in the data buffer
        esds_bs = gf_bs_new(data + index, size - index);
        if (!esds_bs) {
            e = GF_OUT_OF_MEM;
            break;
        }

        // Set a cookie on the new bitstream to suppress logging for the operations that follow
        gf_bs_set_cookie(esds_bs, GF_ISOM_BS_COOKIE_SUPPRESS_LOG);

        // Parse a new ESDS box from the bitstream
        e = gf_isom_box_parse(&esds_box, esds_bs);
        if (e) {
            gf_bs_delete(esds_bs);
            break;
        }

        // Update the ESDS box reference in the current box structure
        if (s->child_boxes) {
            GF_Box *child = gf_isom_box_find_child(s->child_boxes, GF_ISOM_BOX_TYPE_ESDS);
            if (child) {
                gf_isom_box_remove_child(s->child_boxes, child);
                gf_box_delete(child);
            }
        }
        gf_isom_box_add_child(s->child_boxes, esds_box);

        // Ensure the box is added to the list of child boxes
        esds_box_size = gf_isom_box_get_size(esds_box);
        esds_box_pos = gf_bs_get_position(esds_bs);
        gf_bs_seek(esds_bs, esds_box_pos);
        gf_bs_write(esds_bs, esds_box, esds_box_size);
        gf_bs_seek(esds_bs, esds_box_pos + esds_box_size);

        // Clean up by deleting the created bitstream and handle any memory management necessary for ESDS box references
        gf_box_delete(esds_box);
        gf_bs_delete(esds_bs);
    }
}