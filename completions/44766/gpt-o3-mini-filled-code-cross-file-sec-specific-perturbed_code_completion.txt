if (data[index]=='e' && data[index+1]=='s' && data[index+2]=='d' && data[index+3]=='s') {
    GF_BitStream *esds_bs = gf_bs_new_from_buffer((unsigned char *)(data + index), size - index);
    if (esds_bs) {
        /* Set a cookie on the new bitstream to suppress logging */
        gf_bs_set_cookie(esds_bs, GF_ISOM_BS_COOKIE_SILENT);

        /* If an ESDS box already exists, remove it and delete it */
        GF_Box *old_esds = gf_isom_box_find_child(s->child_boxes, GF_ISOM_BOX_TYPE_ESDS);
        if (old_esds) {
            gf_list_remove(s->child_boxes, old_esds);
            gf_box_del(old_esds);
        }

        /* Parse a new ESDS box from the bitstream */
        GF_Box *new_esds = NULL;
        e = gf_isom_box_parse(&new_esds, esds_bs);
        if (e == GF_OK && new_esds && new_esds->type == GF_ISOM_BOX_TYPE_ESDS) {
            gf_list_add(s->child_boxes, new_esds);
            ptr->esds = (GF_ESDSBox *)new_esds;
        } else if (new_esds) {
            gf_box_del(new_esds);
        }
        gf_bs_delete(esds_bs);
    }
    break;
}