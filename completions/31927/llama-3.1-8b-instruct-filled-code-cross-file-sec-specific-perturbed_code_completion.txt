for (index = 0; index < ptr->sampleCount; ) {
    u32 sampleSize = gf_bs_read_u8(bs);
    if (sampleSize == 4) {
        if (ptr->sampleCount / 2 > ptr->size) {
            GF_LOG(GF_LOG_ERROR, GF_LOG_CONTAINER, ("[iso file] Invalid number of entries %d in stsz\n", ptr->sampleCount));
            return GF_ISOM_INVALID_FILE;
        }
    } else {
        if (ptr->sampleCount > ptr->size / (sampleSize/8)) {
            GF_LOG(GF_LOG_ERROR, GF_LOG_CONTAINER, ("[iso file] Invalid number of entries %d in stsz\n", ptr->sampleCount));
            return GF_ISOM_INVALID_FILE;
        }
    }
    ptr->sizes[index] = sampleSize;
    index++;
    if (sampleSize == 4) {
        index++;
    }
    ptr->total_size += sampleSize;
    ptr->total_samples++;
}