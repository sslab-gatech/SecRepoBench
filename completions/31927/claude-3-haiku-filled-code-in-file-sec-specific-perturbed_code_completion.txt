if (! ptr->sizes) {
    ptr->sizes = (u32 *) gf_malloc(sizeof(u32)*ptr->sampleCount);
    if (! ptr->sizes) return GF_OUT_OF_MEM;
    ptr->alloc_size = ptr->sampleCount;
    ptr->total_size = 0;
    ptr->total_samples = 0;
    ptr->max_size = 0;
}

for (index = 0; index < ptr->sampleCount; index++) {
    switch (ptr->sampleSize) {
    case 4:
        ptr->sizes[index] = gf_bs_read_int(bs, 4);
        if (index+1 < ptr->sampleCount) {
            ptr->sizes[index+1] = gf_bs_read_int(bs, 4);
        } else {
            //0 padding in odd sample count
            ptr->sizes[index] |= (gf_bs_read_int(bs, 4) << 4);
        }
        index += 1;
        break;
    default:
        ptr->sizes[index] = gf_bs_read_int(bs, ptr->sampleSize);
        break;
    }
    if (ptr->max_size < ptr->sizes[index])
        ptr->max_size = ptr->sizes[index];
    ptr->total_size += ptr->sizes[index];
    ptr->total_samples++;
}