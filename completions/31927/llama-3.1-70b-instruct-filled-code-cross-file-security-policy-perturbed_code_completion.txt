if (ptr->sampleSize == 4) {
    u8 val;
    while (index < ptr->sampleCount) {
        if (index + 2 <= ptr->sampleCount) {
            val = gf_bs_read_u8(bs);
            if (index < ptr->sampleCount && index + 1 < ptr->alloc_size) {
                ptr->sizes[index] = (val >> 4) & 0xF;
            }
            if (index + 1 < ptr->sampleCount && index + 2 < ptr->alloc_size) {
                ptr->sizes[index + 1] = val & 0xF;
            }
            index += 2;
        } else {
            val = gf_bs_read_u8(bs);
            if (index < ptr->sampleCount && index < ptr->alloc_size) {
                ptr->sizes[index] = (val >> 4) & 0xF;
            }
            index++;
            // padding
            gf_bs_read_u8(bs);
            break;
        }
        if (ptr->max_size < ptr->sizes[index - 1])
            ptr->max_size = ptr->sizes[index - 1];
        ptr->total_size += ptr->sizes[index - 1];
        ptr->total_samples++;
    }
} else {
    while (index < ptr->sampleCount) {
        if (ptr->sampleSize == 8) {
            u8 val = gf_bs_read_u8(bs);
            if (index < ptr->sampleCount && index < ptr->alloc_size) {
                ptr->sizes[index] = val;
            }
        } else if (ptr->sampleSize == 16) {
            u16 val = gf_bs_read_u16(bs);
            if (index < ptr->sampleCount && index < ptr->alloc_size) {
                ptr->sizes[index] = val;
            }
        }
        index++;
        if (ptr->max_size < ptr->sizes[index - 1])
            ptr->max_size = ptr->sizes[index - 1];
        ptr->total_size += ptr->sizes[index - 1];
        ptr->total_samples++;
    }
}