for (index = 0; index < ptr->sampleCount; ) {
    // For 4-bit sample sizes, read pairs of samples from each byte
    u8 byte_val = gf_bs_read_u8(bs);
    
    // Extract first sample size (upper 4 bits)
    ptr->sizes[index] = byte_val >> 4;
    if (ptr->max_size < ptr->sizes[index])
        ptr->max_size = ptr->sizes[index];
    ptr->total_size += ptr->sizes[index];
    ptr->total_samples++;
    index++;
    
    // If we have an odd number of samples, only process one sample from the last byte
    if (index == ptr->sampleCount) 
        break;
    
    // Extract second sample size (lower 4 bits)
    ptr->sizes[index] = byte_val & 0xF;
    if (ptr->max_size < ptr->sizes[index])
        ptr->max_size = ptr->sizes[index];
    ptr->total_size += ptr->sizes[index];
    ptr->total_samples++;
    index++;
}