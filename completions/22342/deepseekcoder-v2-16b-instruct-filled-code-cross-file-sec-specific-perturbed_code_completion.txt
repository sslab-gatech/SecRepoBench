// Check if the packet is using TCP and perform initial validation of the payload.
  // Determine the length of the TPKT protocol and verify if it matches the expected length.
  // Inspect specific payload byte values to distinguish between H.323 and RDP protocols.
  // Increment the count of valid H.323 packets and identify H.323 broadcast if conditions are met.
  // For UDP packets, compute source and destination ports and validate the payload structure.
  // Identify H.323 broadcasts by checking specific byte patterns and packet length.
  // Exclude non-H.323 protocols from detection if conditions are not satisfied.

  if (packet->payload_packet_len >= 3) {
    u_int8_t *payload = packet->payload;
    if (payload[0] == 0x03 && payload[1] == 0x00 && payload[2] == 0x00) {
      // TPKT header found, validate the rest of the H.323 packet
      if (packet->payload_packet_len >= 12 &&
          payload[3] == 0x00 && payload[4] == 0x00 && payload[5] == 0x00 &&
          payload[6] == 0x00 && payload[7] == 0x00 && payload[8] == 0x00 &&
          payload[9] == 0x00 && payload[10] == 0x00 && payload[11] == 0x00) {
        // Valid H.323 packet
        NDPI_LOG_INFO(ndpi_struct, "Detected H.323 protocol\n");
        stream->detected_protocol = NDPI_PROTOCOL_H323;
        return;
      }
    }
  }

  // If not H.323, continue with other checks or return