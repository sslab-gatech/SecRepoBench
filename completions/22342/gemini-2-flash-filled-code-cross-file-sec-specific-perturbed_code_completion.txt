{
    /* TPKT */
    u_int32_t tpkt_length;

    if(packet->payload_len < 4)
      return;

    tpkt_length = (packet->payload[2] << 8) | packet->payload[3];

    if((tpkt_length > packet->payload_len) || (tpkt_length < 4))
      return;

    if((packet->payload[0] == 0x03) && (packet->payload[1] == 0x00)) {
      NDPI_LOG_DBG(ndpi_struct, "found h323 over tcp\n");

      if((packet->payload[4] == 0x80) && (packet->payload[5] == 0x01)) {
        NDPI_LOG_DBG(ndpi_struct, "found h323 broadcast\n");
        stream->h323.h323_broadcast = 1;
      }

      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323, NDPI_PROTOCOL_UNKNOWN);
      return;
    } else
      NDPI_ADD_PROTOCOL_TO_BITMASK(stream->exclude_protocol_bitmask, NDPI_PROTOCOL_H323);
  } else if(packet->udp != NULL) {
    sport = ntohs(packet->udp->source);
    dport = ntohs(packet->udp->dest);

    if(packet->payload_len > 8) {
      if((packet->payload[0] == 0x80) && (packet->payload[1] == 0x01)) {
        NDPI_LOG_DBG(ndpi_struct, "found h323 broadcast\n");
        stream->h323.h323_broadcast = 1;

        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323, NDPI_PROTOCOL_UNKNOWN);
        return;
      } else if((packet->payload_len == 1472) && (packet->payload[0] == 0x00) && (packet->payload[1] == 0x00) &&
                (packet->payload[2] == 0x00) && (packet->payload[3] == 0x01)) {
        /* Polycom V2 */
        NDPI_LOG_DBG(ndpi_struct, "found h323 broadcast\n");
        stream->h323.h323_broadcast = 1;

        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323, NDPI_PROTOCOL_UNKNOWN);
        return;
      } else
        NDPI_ADD_PROTOCOL_TO_BITMASK(stream->exclude_protocol_bitmask, NDPI_PROTOCOL_H323);
    } else
      NDPI_ADD_PROTOCOL_TO_BITMASK(stream->exclude_protocol_bitmask, NDPI_PROTOCOL_H323);
  } else
    NDPI_ADD_PROTOCOL_TO_BITMASK(stream->exclude_protocol_bitmask, NDPI_PROTOCOL_H323);