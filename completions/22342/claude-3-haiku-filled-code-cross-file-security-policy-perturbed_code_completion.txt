// <MASK>
  if (packet->tcp != NULL) {
    u_int16_t tpkt_len = ntohs(*(u_int16_t *)(packet->payload));
    if (tpkt_len >= 4 && tpkt_len <= packet->payload_packet_len) {
      if (packet->payload[3] == 0x03 && packet->payload[4] == 0x00) {
        NDPI_LOG_INFO(ndpi_struct, "Found H.323 over TCP");
        ndpi_int_h323_add_connection(ndpi_struct, stream);
        if (packet->payload[5] == 0x05 && packet->payload[6] == 0x05) {
          NDPI_LOG_INFO(ndpi_struct, "H.323 broadcast detected");
        }
      } else if (packet->payload[3] == 0x03 && packet->payload[4] == 0x01) {
        NDPI_LOG_INFO(ndpi_struct, "Found RDP over TCP");
        ndpi_int_add_connection(ndpi_struct, stream, NDPI_PROTOCOL_RDP, NDPI_REAL_PROTOCOL);
      } else {
        NDPI_LOG_DBG(ndpi_struct, "Exclude non-H.323 protocols");
        return;
      }
    } else {
      NDPI_LOG_DBG(ndpi_struct, "Invalid TPKT length");
      return;
    }
  } else if (packet->udp != NULL) {
    sport = ntohs(packet->udp->source);
    dport = ntohs(packet->udp->dest);
    if ((sport == 1718 || sport == 1719 || sport == 1720 || dport == 1718 || dport == 1719 || dport == 1720) &&
        packet->payload_packet_len >= 12 && packet->payload[0] == 0x45 && packet->payload[1] == 0x00) {
      NDPI_LOG_INFO(ndpi_struct, "Found H.323 over UDP");
      ndpi_int_h323_add_connection(ndpi_struct, stream);
      if (packet->payload[2] == 0x00 && packet->payload[3] == 0x0c) {
        NDPI_LOG_INFO(ndpi_struct, "H.323 broadcast detected");
      }
    } else {
      NDPI_LOG_DBG(ndpi_struct, "Exclude non-H.323 protocols");
      return;
    }
  } else {
    NDPI_LOG_DBG(ndpi_struct, "Exclude non-H.323 protocols");
    return;
  }