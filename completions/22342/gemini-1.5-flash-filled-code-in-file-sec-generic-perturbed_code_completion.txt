{
    struct tpkt *tpkt_header;
    u_int32_t len;

    if (packet->payload_len < sizeof(struct tpkt)) return;

    tpkt_header = (struct tpkt *)packet->payload;
    len = ntohs(tpkt_header->len);

    if (len > packet->payload_len) return;

    if ((tpkt_header->version == 3) && (len >= 4)) {
      if ((packet->payload[4] == 0x03) && (packet->payload[5] == 0x00)) {
	stream->detected_protocol = NDPI_PROTOCOL_H323;
	stream->h323_packets++;
	if (packet->udp != NULL) {
	  sport = ntohs(packet->udp->source);
	  dport = ntohs(packet->udp->dest);
	}
	if (packet->payload_len == 8 && packet->payload[6] == 0x00 && packet->payload[7] == 0x00) {
	  stream->h323_broadcast++;
	}
      }
    } else if (packet->udp != NULL) {
      sport = ntohs(packet->udp->source);
      dport = ntohs(packet->udp->dest);
      if (packet->payload_len >= 8 && packet->payload[0] == 0x00 && packet->payload[1] == 0x00 && packet->payload[2] == 0x00 && packet->payload[3] == 0x00 && packet->payload[4] == 0x00 && packet->payload[5] == 0x00 && packet->payload[6] == 0x00 && packet->payload[7] == 0x00) {
	stream->h323_broadcast++;
      }
    }
  }