{
    if (packet->payload_packet_len < 4) {
      return;
    }

    if (packet->payload[0] == 0x03 && packet->payload[1] == 0x00) {
      u_int16_t tpkt_len = ntohs(*(u_int16_t *)(packet->payload + 2));

      if(tpkt_len + 4 != packet->payload_packet_len)
	return;

      NDPI_LOG_DBG(ndpi_struct, "tpkt_len: %u payload_packet_len: %u\n", tpkt_len, packet->payload_packet_len);

      if (packet->payload_packet_len > 8 && packet->payload[4] == 0x03 && packet->payload[5] == 0x88 && packet->payload[6] == 0x09 && packet->payload[7] == 0xbc) {
	NDPI_ADD_PROTOCOL_TO_BITMASK(ndpi_struct->src_or_dst_protocols_bitmask, NDPI_PROTOCOL_RDP);
	return;
      }

      ndpi_int_h323_counter++;

      if (packet->payload_packet_len > 4 && packet->payload[4] == 0x08) {
	NDPI_ADD_PROTOCOL_TO_BITMASK(ndpi_struct->src_or_dst_protocols_bitmask, NDPI_PROTOCOL_H323);
	ndpi_int_broadcast_h323_counter++;
      }
    }
  } else {
    if (packet->payload_packet_len < 2)
      return;

    sport = ntohs(packet->udp->source), dport = ntohs(packet->udp->dest);

    if (packet->payload[0] == 0x08 && packet->payload_packet_len > 8) {
      if (packet->payload[1] == 0x11 && packet->payload[2] == 0x00 && packet->payload[3] == 0x01 && packet->payload[4] == 0x00 && packet->payload[5] == 0x05 && packet->payload[6] == 0x00 && packet->payload[7] == 0x30) {
	NDPI_ADD_PROTOCOL_TO_BITMASK(ndpi_struct->src_or_dst_protocols_bitmask, NDPI_PROTOCOL_RTSP);
	return;
      }
    }

    if (packet->payload[0] == 0x08 && packet->payload_packet_len > 4) {
      ndpi_int_h323_counter++;
      ndpi_int_broadcast_h323_counter++;
      NDPI_ADD_PROTOCOL_TO_BITMASK(ndpi_struct->src_or_dst_protocols_bitmask, NDPI_PROTOCOL_H323);
    }
  }