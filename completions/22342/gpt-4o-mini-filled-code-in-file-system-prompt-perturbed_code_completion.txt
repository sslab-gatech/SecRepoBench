{
    struct tpkt *t_pkt = (struct tpkt *)packet->payload;

    if (packet->tcp->payload_length < sizeof(struct tpkt)) {
      return;
    }

    if (t_pkt->version != 0 || ntohs(t_pkt->len) > packet->tcp->payload_length) {
      return;
    }

    // Increment the count of valid H.323 packets
    stream->h323_packet_count++;

    // Check for H.323 broadcast
    if (ntohs(t_pkt->len) == 0) {
      stream->h323_broadcast = 1;
    }

    // Additional checks for UDP packets
    if (packet->udp != NULL) {
      sport = ntohs(packet->udp->source);
      dport = ntohs(packet->udp->dest);

      if (packet->udp->payload_length < sizeof(struct tpkt)) {
        return;
      }

      // Further validation for H.323 over UDP
      if (t_pkt->version == 0 && ntohs(t_pkt->len) <= packet->udp->payload_length) {
        stream->h323_packet_count++;
      }
    }
  }