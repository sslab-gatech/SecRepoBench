{
    if (packet->payload_packet_len >= 4 && packet->payload[0] == 0x03 && packet->payload[1] == 0x00) {
      u_int16_t tpkt_len = ((packet->payload[2] << 8) + packet->payload[3]);

      if (packet->payload_packet_len < tpkt_len || tpkt_len < 4) {
        return;
      }

      if (packet->payload_packet_len > 4 && packet->payload[4] == 0x03 && packet->payload[5] == 0xf0) {
        NDPI_LOG_DBG(ndpi_struct, "Exclude RDP from detection (H323)\n");
        return;
      }

      ndpi_int_h323_add_connection(ndpi_struct, stream, NDPI_PROTOCOL_H323);
      return;
    }

    if (packet->udp != NULL) {
      sport = ntohs(packet->udp->source), dport = ntohs(packet->udp->dest);

      if (packet->payload_packet_len > 12 && packet->payload[0] == 0x00 && packet->payload[1] == 0x01) {
        if (packet->payload_packet_len > 12 && packet->payload[12] == 0x29 && packet->payload[13] == 0x00) {
          NDPI_LOG_DBG(ndpi_struct, "found H.323 RAS packet (bc)\n");
          ndpi_int_h323_add_connection(ndpi_struct, stream, NDPI_PROTOCOL_H323_RAS);
          return;
        }
      } else if (packet->payload_packet_len > 4 && packet->payload[0] == 0x08 && packet->payload[1] == 0x00 && packet->payload[2] == 0x00 && packet->payload[3] == 0x00 && packet->payload[4] == 0x00 && packet->payload[5] == 0x00 && packet->payload[6] == 0x00 && packet->payload[7] == 0x00) {
        NDPI_LOG_DBG(ndpi_struct, "found H.323 Q931 broadcast\n");
        ndpi_int_h323_add_connection(ndpi_struct, stream, NDPI_PROTOCOL_H323);
        return;
      } else if (packet->payload_packet_len == 4 && packet->payload[0] == 0x00 && packet->payload[1] == 0x00 && packet->payload[2] == 0x00 && packet->payload[3] == 0x00) {
        NDPI_LOG_DBG(ndpi_struct, "found H.323 Tunneling packet\n");
        ndpi_int_h323_add_connection(ndpi_struct, stream, NDPI_PROTOCOL_H323);
        return;
      } else {
        if (packet->payload_packet_len > 2 && packet->payload[0] == 0 && packet->payload[1] == 0x0a) {
          NDPI_LOG_DBG(ndpi_struct, "exclude non-H323 protocol from detection (1)\n");
          return;
        }
      }
    }
  }