{
  /* TCP-based H.323 TPKT check */
  if(packet->tcp && (packet->payload_packet_len > 4)
     && (packet->payload[0] == 0x03) && (packet->payload[1] == 0x00)) {
    u_int16_t tpkt_len = (packet->payload[2] << 8) | packet->payload[3];

    /* Check if the TPKT length matches the packet length */
    if(tpkt_len == packet->payload_packet_len) {
      /* Distinguish from RDP by inspecting the next byte(s) */
      if(packet->payload[4] != 0x02) {
        NDPI_LOG_INFO(ndpi_struct, "found H.323 TPKT over TCP\n");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323, NDPI_PROTOCOL_UNKNOWN);
        return;
      }
    }
  }

  /* UDP-based H.323 check */
  if(packet->udp) {
    sport = ntohs(packet->udp->source);
    dport = ntohs(packet->udp->dest);

    /* Known H.323 ports: 1718, 1719 (RAS), 1720 (H.225) */
    if((sport == 1718) || (dport == 1718) ||
       (sport == 1719) || (dport == 1719) ||
       (sport == 1720) || (dport == 1720)) {
      if(packet->payload_packet_len > 4) {
        NDPI_LOG_INFO(ndpi_struct, "found H.323 over UDP\n");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323, NDPI_PROTOCOL_UNKNOWN);
        return;
      }
    }
  }

  /* No match: exclude protocol */
  NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
}