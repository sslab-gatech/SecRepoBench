if((packet->tcp != NULL) && (packet->tcp->dest != ntohs(102))) {
    struct tpkt *tpkt = (struct tpkt *)packet->payload;
    if(tpkt->len == ntohs(packet->payload_size) - 4) {
      if(tpkt->version == 0x03 && tpkt->reserved == 0x00) {
        stream->h323_valid_packets++;
        if(stream->h323_valid_packets == 1) {
          stream->h323_broadcast = (packet->payload[4] == 0x00 && packet->payload[5] == 0x01);
        }
      }
    }
  } else if(packet->udp != NULL) {
    struct tpkt *tpkt = (struct tpkt *)packet->payload;
    if(tpkt->len == ntohs(packet->payload_size) - 4) {
      if(tpkt->version == 0x03 && tpkt->reserved == 0x00) {
        sport = ntohs(*(u_int16_t *)&packet->payload[0]);
        dport = ntohs(*(u_int16_t *)&packet->payload[2]);
        if(sport == 1720 || dport == 1720) {
          stream->h323_valid_packets++;
          if(stream->h323_valid_packets == 1) {
            stream->h323_broadcast = (packet->payload[4] == 0x00 && packet->payload[5] == 0x01);
          }
        }
      }
    }
  }
  if(stream->h323_valid_packets > 0 && !stream->h323_broadcast) {
    ndpi_set_detection_bitmask(stream, detection_bitmask, NDPI_PROTOCOL_H323);
  }
}