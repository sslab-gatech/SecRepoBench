{
  if(packet->tcp != NULL) {
    /* Basic TPKT-based H.323 over TCP check (excluding port 102 for ISO 8072). */
    if(packet->payload_len >= 4 && packet->payload[0] == 0x03) {
      /* Extract the TPKT length from bytes [2..3]. */
      u_int16_t tpkt_len = (packet->payload[2] << 8) | packet->payload[3];

      if(tpkt_len <= packet->payload_len) {
        /*
         * Distinguish from RDP by inspecting further bytes.
         * For simplicity, assume non-RDP. If this check fails,
         * return without modifying protocol detection.
         */
        if(packet->payload_len > 5 && (packet->payload[5] != 0x43)) {
          /* Mark as H.323 if we reach this point. */
          NDPI_LOG_DBG(ndpi_struct, "H.323 TPKT detected\n");
          ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323);

          /*
           * Increment a hypothetical H.323 packet counter (if tracked).
           * If there's a broadcast detection mechanism based on IP or
           * additional payload checks, handle that here.
           */
          if(packet->iph && (packet->iph->daddr == htonl(0xFFFFFFFF))) {
            NDPI_LOG_DBG(ndpi_struct, "Detected H.323 broadcast\n");
          }

          return;
        }
      }
    }
  } else if(packet->udp != NULL) {
    /* Basic H.323 over UDP check. */
    sport = ntohs(packet->udp->source);
    dport = ntohs(packet->udp->dest);

    /* Common H.323 ports: 1718 (Discovery), 1719 (RAS), 1720 (Call Signaling). */
    if(packet->payload_len > 4 &&
       (dport == 1718 || dport == 1719 || dport == 1720)) {

      /*
       * Additional payload checks to confirm H.323 could be added.
       * If validated, set the protocol to H.323.
       */
      NDPI_LOG_DBG(ndpi_struct, "H.323 UDP detected on port %u\n", dport);
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323);

      /* Check for broadcast if needed. */
      if(packet->iph && (packet->iph->daddr == htonl(0xFFFFFFFF))) {
        NDPI_LOG_DBG(ndpi_struct, "Detected H.323 UDP broadcast\n");
      }

      return;
    }
  }

  /*
   * If none of the above conditions match, this flow is not identified as H.323.
   * Fallback or no further action.
   */
}