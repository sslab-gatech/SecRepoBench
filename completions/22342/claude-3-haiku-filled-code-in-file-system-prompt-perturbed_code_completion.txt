{
  if((packet->tcp != NULL) && (packet->tcp->dest != ntohs(102))) {
    struct tpkt *tpkt = (struct tpkt *) packet->payload;
    
    if(packet->payload_packet_len >= sizeof(struct tpkt)
       && tpkt->version == 3 && tpkt->reserved == 0) {
      u_int16_t tpkt_len = ntohs(tpkt->len);
      
      if(tpkt_len == packet->payload_packet_len) {
        NDPI_LOG_DBG2(ndpi_struct, "Found H.323 TPKT\n");
        ndpi_int_h323_add_connection(ndpi_struct, stream);
        
        if((packet->payload[sizeof(struct tpkt)] == 0x05)
           && (packet->payload[sizeof(struct tpkt) + 1] == 0x05)
           && (packet->payload[sizeof(struct tpkt) + 2] == 0x01)
           && (packet->payload[sizeof(struct tpkt) + 3] == 0x00)) {
          NDPI_LOG_INFO(ndpi_struct, "Found H.323 broadcast\n");
          ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323, NDPI_PROTOCOL_UNKNOWN);
        }
      }
    }
  } else if(packet->udp != NULL) {
    sport = ntohs(packet->udp->source);
    dport = ntohs(packet->udp->dest);
    
    if((sport == 1718 && dport == 1719) || (sport == 1719 && dport == 1718)) {
      if(packet->payload_packet_len >= 12
         && packet->payload[0] == 0x00 && packet->payload[1] == 0x00
         && packet->payload[2] == 0x00 && packet->payload[3] == 0x0c) {
        NDPI_LOG_INFO(ndpi_struct, "Found H.323 broadcast\n");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323, NDPI_PROTOCOL_UNKNOWN);
      }
    } else {
      NDPI_LOG_DBG(ndpi_struct, "Exclude non-H.323 protocols\n");
      NDPI_ADD_PROTOCOL_TO_BITMASK(stream->excluded_protocol_bitmask, NDPI_PROTOCOL_H323);
    }
  }
}