{
    struct tpkt *tpkt_header;
    u_int32_t len;

    tpkt_header = (struct tpkt *)packet->payload;
    len = ntohs(tpkt_header->len);

    if (len < sizeof(struct tpkt))
      return;

    if ((tpkt_header->version == 3) && (packet->payload_len >= len)) {
      if ((packet->payload[sizeof(struct tpkt)] == 0x03) && (packet->payload[sizeof(struct tpkt) + 1] == 0x00)) {
	stream->protocol_id = NDPI_PROTOCOL_H323;
	stream->detected_protocol = 1;
	ndpi_inc_detected_packet_count(ndpi_struct, stream);
      }
    } else if (packet->udp != NULL) {
      sport = ntohs(packet->udp->source);
      dport = ntohs(packet->udp->dest);

      if ((packet->payload_len >= 4) && (packet->payload[0] == 0x03) && (packet->payload[1] == 0x00) && (packet->payload[2] == 0x00) && (packet->payload[3] == 0x00)) {
	stream->protocol_id = NDPI_PROTOCOL_H323;
	stream->detected_protocol = 1;
	ndpi_inc_detected_packet_count(ndpi_struct, stream);
      }
    }
  }