{
    // Check if the packet length is valid
    if (packet->tcp->payload_len < sizeof(struct tpkt)) {
      NDPI_LOG_DBG(ndpi_struct, "Invalid payload length\n");
      return;
    }

    struct tpkt *tpkt = (struct tpkt *)packet->tcp->payload;

    // Verify the TPKT version
    if (tpkt->version != 0) {
      NDPI_LOG_DBG(ndpi_struct, "Invalid TPKT version\n");
      return;
    }

    // Check the length field
    if (ntohs(tpkt->len) > packet->tcp->payload_len) {
      NDPI_LOG_DBG(ndpi_struct, "TPKT length exceeds payload length\n");
      return;
    }

    // Further inspection of the payload to distinguish between H.323 and RDP
    // Example: Check specific byte values in the payload
    if (/* condition to identify H.323 */) {
      // Increment count of valid H.323 packets
      stream->h323_packet_count++;
      NDPI_LOG_DBG(ndpi_struct, "Detected H.323 packet\n");
    } else {
      NDPI_LOG_DBG(ndpi_struct, "Not an H.323 packet\n");
    }
  }