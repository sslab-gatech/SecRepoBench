{
    // Validate the TCP packet and extract the payload
    u_int16_t payload_length = ntohs(packet->tcp->payload_len);
    if (payload_length < sizeof(struct tpkt)) {
      NDPI_LOG_DBG(ndpi_struct, "Invalid payload length\n");
      return;
    }

    struct tpkt *tpkt = (struct tpkt *)packet->payload;

    // Check TPKT version and reserved fields
    if (tpkt->version != 0 || tpkt->reserved != 0) {
      NDPI_LOG_DBG(ndpi_struct, "Invalid TPKT version or reserved field\n");
      return;
    }

    // Check if the length field matches the expected payload length
    if (ntohs(tpkt->len) != payload_length - sizeof(struct tpkt)) {
      NDPI_LOG_DBG(ndpi_struct, "TPKT length mismatch\n");
      return;
    }

    // Inspect specific payload byte values to distinguish between H.323 and RDP protocols
    if (tpkt->len > 0) {
      // Increment the count of valid H.323 packets
      stream->h323_packet_count++;

      // Check for H.323 broadcast (example condition)
      if (packet->tcp->dest == ntohs(1719)) {
        stream->h323_broadcast = 1;
      }
    }
  }