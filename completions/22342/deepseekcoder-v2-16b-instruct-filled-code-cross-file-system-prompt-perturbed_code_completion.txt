if((packet->tcp != NULL) && (packet->tcp->dest != ntohs(102))) {
    // Check if the packet is using TCP and perform initial validation of the payload.
    // Determine the length of the TPKT protocol and verify if it matches the expected length.
    // Inspect specific payload byte values to distinguish between H.323 and RDP protocols.
    // Increment the count of valid H.323 packets and identify H.323 broadcast if conditions are met.
    // For UDP packets, compute source and destination ports and validate the payload structure.
    // Identify H.323 broadcasts by checking specific byte patterns and packet length.
    // Exclude non-H.323 protocols from detection if conditions are not satisfied.
    u_int8_t *packet_data = packet->payload;
    u_int32_t payload_len = packet->payload_packet_len;

    if (payload_len >= 4 && packet_data[0] == 0x03 && packet_data[1] == 0x00 && packet_data[2] == 0x00 && packet_data[3] == 0x02) {
      // Valid TPKT header found, now check for H.323 specific payload
      if (payload_len >= 12 && packet_data[4] == 0x00 && packet_data[5] == 0x00 && packet_data[6] == 0x01 && packet_data[7] == 0x00 &&
          packet_data[8] == 0x00 && packet_data[9] == 0x00 && packet_data[10] == 0x00 && packet_data[11] == 0x00) {
        // Potential H.323 packet
        NDPI_LOG_INFO(ndpi_struct, "Detected H.323 protocol\n");
        stream->detected_protocol = NDPI_PROTOCOL_H323;
        ndpi_int_add_connection(ndpi_struct, stream, NDPI_PROTOCOL_H323);
      }
    }
  } else if (packet->udp != NULL) {
    // For UDP, check for H.323 specific port and payload structure
    sport = ntohs(packet->udp->source);
    dport = ntohs(packet->udp->dest);

    if ((sport == 102 || dport == 102) && payload_len >= 4) {
      // Check for H.323 specific payload
      if (packet_data[0] == 0x00 && packet_data[1] == 0x00 && packet_data[2] == 0x01 && packet_data[3] == 0x00) {
        // Potential H.323 broadcast
        NDPI_LOG_INFO(ndpi_struct, "Detected H.323 broadcast\n");
        stream->detected_protocol = NDPI_PROTOCOL_H323;
        ndpi_int_add_connection(ndpi_struct, stream, NDPI_PROTOCOL_H323);
      }
    }
  }