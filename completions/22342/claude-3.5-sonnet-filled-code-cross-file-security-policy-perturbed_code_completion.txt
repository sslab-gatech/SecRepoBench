{
  if(packet->payload_packet_len >= 4) {
    u_int16_t tpkt_len = ntohs(get_u_int16_t(packet->payload, 2));

    if(tpkt_len == packet->payload_packet_len) {
      if((packet->payload[0] == 0x03) && (packet->payload[1] == 0) &&
         (packet->payload_packet_len >= 5) && (packet->payload[4] != 0x01)) {
        NDPI_LOG_INFO(ndpi_struct, "Found H323\n");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DPI);
        stream->h323_valid_packets++;

        if((packet->payload_packet_len > 10) &&
           (packet->payload[5] == 0x20) && (packet->payload[6] == 0x80))
          stream->h323_broadcast = 1;

        return;
      }
    }
  }

  if(packet->udp != NULL) {
    sport = ntohs(packet->udp->source), dport = ntohs(packet->udp->dest);

    if(((sport == 1718) || (dport == 1718) || (sport == 1719) || (dport == 1719)) &&
       (packet->payload_packet_len >= 5)) {
      if((packet->payload[0] == 0x16) && (packet->payload[1] == 0x80) &&
         (packet->payload[4] == 0x06) && (packet->payload[5] == 0x00)) {
        NDPI_LOG_INFO(ndpi_struct, "Found H323 broadcast\n");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DPI);
        stream->h323_broadcast = 1;
        return;
      }
    }
  }

  NDPI_EXCLUDE_PROTO(ndpi_struct, stream);
}