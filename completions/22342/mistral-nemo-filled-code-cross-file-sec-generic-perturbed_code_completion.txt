if((packet->tcp != NULL) && (packet->tcp->dest != ntohs(102))) {
  u_int16_t tpkt_len = 0;
  u_int8_t *payload = packet->payload;
  u_int16_t payload_len = packet->payload_len;

  // Determine the length of the TPKT protocol
  if(payload_len >= 2) {
    tpkt_len = (payload[0] << 8) | payload[1];
    if(tpkt_len > payload_len) {
      // Invalid TPKT length, skip this packet
      return;
    }
  } else {
    // Insufficient payload for TPKT length, skip this packet
    return;
  }

  // Verify if it matches the expected length
  if(tpkt_len != payload_len) {
    // Mismatch in TPKT length, skip this packet
    return;
  }

  // Inspect specific payload byte values to distinguish between H.323 and RDP protocols
  if(payload[2] == 0x03) {
    // Potential H.323 packet, increment the count of valid H.323 packets
    stream->h323_packets++;

    if(payload_len >= 4 && payload[3] == 0x01) {
      // H.323 broadcast detected
      stream->h323_broadcast = 1;
    }
  } else if(payload[2] == 0x03) {
    // Potential RDP packet, exclude from H.323 detection
    return;
  }

  // For UDP packets, compute source and destination ports and validate the payload structure
  if(packet->udp != NULL) {
    sport = ntohs(packet->udp->source);
    dport = ntohs(packet->udp->dest);

    if(payload_len >= 4 && payload[0] == 0x01 && payload[1] == 0x01) {
      // H.323 broadcast detected over UDP
      stream->h323_broadcast = 1;
    }
  }
}