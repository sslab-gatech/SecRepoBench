if((packet->tcp!= NULL) && (packet->tcp->dest!= ntohs(102))) 
{
  if(packet->payload_len >= 4) 
  {
    u_int32_t tpkt_len = ntohl(*(u_int32_t*)(packet->payload));
    if(tpkt_len > 0 && packet->payload_len >= tpkt_len + 4) 
    {
      if(packet->payload[tpkt_len + 3] == 0x00 && packet->payload[tpkt_len + 4] == 0x00) 
      {
        if(packet->payload_len >= tpkt_len + 6) 
        {
          if(packet->payload[tpkt_len + 5] == 0x01) 
          {
            ndpi_add_or_update_detection_bitmask(ndpi_struct, stream, NDPI_PROTOCOL_H323, NDPI_SELECTION_BITMASK_PROTOCOL_V4_V6_TCP_WITH_PAYLOAD_WITHOUT_RETRANSMISSION);
            if(packet->ip->src.s_addr == INADDR_BROADCAST) 
            {
              ndpi_add_or_update_detection_bitmask(ndpi_struct, stream, NDPI_PROTOCOL_H323_BROADCAST, NDPI_SELECTION_BITMASK_PROTOCOL_V4_V6_TCP_WITH_PAYLOAD_WITHOUT_RETRANSMISSION);
            }
          }
          else if(packet->payload[tpkt_len + 5] == 0x02) 
          {
            ndpi_add_or_update_detection_bitmask(ndpi_struct, stream, NDPI_PROTOCOL_H323_RAS, NDPI_SELECTION_BITMASK_PROTOCOL_V4_V6_TCP_WITH_PAYLOAD_WITHOUT_RETRANSMISSION);
          }
          else 
          {
            ndpi_exclude_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323);
          }
        }
        else 
        {
          ndpi_exclude_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323);
        }
      }
      else 
      {
        ndpi_exclude_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323);
      }
    }
    else 
    {
      ndpi_exclude_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323);
    }
  }
  else 
  {
    ndpi_exclude_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323);
  }
}