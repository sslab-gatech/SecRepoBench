// <MASK>
{
  if (packet->tcp != NULL) {
    u_int16_t tpkt_len = ntohs(packet->tcp->th_win);
    if (tpkt_len >= 4 && packet->payload[0] == 0x03 && packet->payload[1] == 0x00) {
      // TPKT protocol detected
      if (packet->payload_packet_len == (tpkt_len + 4)) {
        // Payload length matches TPKT length
        if (packet->payload[2] == 0x00 && packet->payload[3] == 0x16) {
          // H.323 protocol detected
          NDPI_LOG_INFO(ndpi_struct, "found H.323 TCP");
          ndpi_int_h323_add_connection(ndpi_struct, stream);
          return;
        } else if (packet->payload[2] == 0x00 && packet->payload[3] == 0x01) {
          // RDP protocol detected
          NDPI_LOG_INFO(ndpi_struct, "found RDP TCP");
          ndpi_int_add_connection(ndpi_struct, stream, NDPI_PROTOCOL_RDP, NDPI_REAL_PROTOCOL);
          return;
        }
      }
    }
  } else if (packet->udp != NULL) {
    sport = ntohs(packet->udp->source);
    dport = ntohs(packet->udp->dest);
    if ((sport == 1718 || sport == 1719 || sport == 1720 || dport == 1718 || dport == 1719 || dport == 1720) &&
        packet->payload_packet_len >= 12 && packet->payload[0] == 0x00 && packet->payload[1] == 0x00 &&
        packet->payload[2] == 0x00 && packet->payload[3] == 0x0c) {
      // H.323 UDP broadcast detected
      NDPI_LOG_INFO(ndpi_struct, "found H.323 UDP broadcast");
      ndpi_int_h323_add_connection(ndpi_struct, stream);
      return;
    }
  }

  NDPI_LOG_DBG(ndpi_struct, "exclude H.323");
  NDPI_ADD_PROTOCOL_TO_BITMASK(stream->excluded_protocol_bitmask, NDPI_PROTOCOL_H323);
}