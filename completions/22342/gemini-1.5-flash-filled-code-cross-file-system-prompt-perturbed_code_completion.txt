{
    u_int8_t *payload;
    u_int32_t payload_len;

    if (packet->tcp == NULL) {
      if (packet->udp != NULL) {
        sport = ntohs(packet->udp->source);
        dport = ntohs(packet->udp->dest);
        payload = packet->data;
        payload_len = packet->len - (packet->l3_len + packet->l4_len);

        if (payload_len >= 4 && payload[0] == 0x03 && payload[1] == 0x03) {
          stream->detected_protocol = NDPI_PROTOCOL_H323;
          stream->h323.h323_broadcast = 0;
          if (payload_len >= 8 && payload[4] == 0x00 && payload[5] == 0x00 && payload[6] == 0x00 && payload[7] == 0x00) {
            stream->h323.h323_broadcast = 1;
          }
          NDPI_LOG_DBG(ndpi_struct, "H323 detected on UDP\n");
        }
      }
    } else {
      payload = packet->data;
      payload_len = packet->len - (packet->l3_len + packet->l4_len);
      if (payload_len >= 4 && payload[0] == 0x03 && payload[1] == 0x03) {
        stream->detected_protocol = NDPI_PROTOCOL_H323;
        stream->h323.h323_broadcast = 0;
        if (payload_len >= 8 && payload[4] == 0x00 && payload[5] == 0x00 && payload[6] == 0x00 && payload[7] == 0x00) {
          stream->h323.h323_broadcast = 1;
        }
        NDPI_LOG_DBG(ndpi_struct, "H323 detected on TCP\n");
      }
    }
  }