{
    if (packet->payload_packet_len >= 4 && packet->payload[0] == 0x03 && packet->payload[1] == 0 && packet->payload[2] < 0x03 && packet->payload[3] == 0) {
      if (packet->payload_packet_len > 4 && packet->payload[4] == 0x03 && packet->payload[5] == 0) {
        // Check for RDP to avoid false positives
        if (packet->payload_packet_len > 8 && packet->payload[6] < 3 && packet->payload[7] == 3 && packet->payload[8] == 0)
          return;
      }

      NDPI_LOG_DBG(ndpi_struct, "found H.323\n");
      ndpi_int_h323_add_connection(ndpi_struct, stream, NDPI_PROTOCOL_H323);
      return;
    }

    if(packet->udp != NULL) {
      sport = packet->udp->source, dport = packet->udp->dest;

      if(packet->payload_packet_len > 12 && packet->payload[0] == 0x08 && packet->payload[1] == 0x00 && packet->payload[2] == 0x45 && packet->payload[3] == 0x00 && packet->payload[12] == 0x08) {
        NDPI_LOG_DBG(ndpi_struct, "found H.323 (broadcast)\n");
        ndpi_int_h323_add_connection(ndpi_struct, stream, NDPI_PROTOCOL_H323);
        return;
      }

      if (packet->payload_packet_len == 4 && packet->payload[0] == 0x00 && packet->payload[1] == 0x01 && packet->payload[2] == 0x00 && packet->payload[3] == 0x0a) {
        if (sport == 1719 || dport == 1719) {
          NDPI_LOG_DBG(ndpi_struct, "found H.323 RAS\n");
          ndpi_int_h323_add_connection(ndpi_struct, stream, NDPI_PROTOCOL_H323_RAS);
          return;
        }
      }
    }
  }