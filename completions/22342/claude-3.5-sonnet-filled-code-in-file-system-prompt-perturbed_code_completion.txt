{
    struct tpkt *tpkt = (struct tpkt*)packet->payload;
    u_int16_t len = ntohs(tpkt->len);

    if((len == packet->payload_packet_len) && (tpkt->version == 3)) {
      if((packet->payload[4] == 0x08) && (packet->payload[5] == 0x02)) {
        NDPI_LOG_INFO(ndpi_struct, "found H323 broadcast\n");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DPI);
        return;
      } else if(packet->payload[4] == 0x83) {
        stream->h323_valid_packets++;

        if(stream->h323_valid_packets > 1) {
          NDPI_LOG_INFO(ndpi_struct, "found H323\n");
          ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DPI);
        }
        return;
      }
    }
  }

  if(packet->udp != NULL) {
    sport = ntohs(packet->udp->source), dport = ntohs(packet->udp->dest);

    if((((sport == 1718) || (dport == 1718))
        || ((sport == 1719) || (dport == 1719)))
       && (packet->payload_packet_len > 5)) {
      if((packet->payload[0] == 0x80) && (packet->payload[1] == 0x08)
         && (packet->payload[2] == 0xe7) && (packet->payload[4] == 0x0b)) {
        NDPI_LOG_INFO(ndpi_struct, "found H323 broadcast\n");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DPI);
        return;
      }
    }
  }

  NDPI_EXCLUDE_PROTO(ndpi_struct, stream);