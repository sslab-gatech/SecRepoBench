{
  if(packet->payload == NULL) return;

  /* Handle TCP-based H.323 (H.225) via TPKT detection */
  if((packet->tcp != NULL) && (packet->payload_packet_len >= 4) && (packet->payload[0] == 0x03)) {
    uint16_t tpkt_len = (packet->payload[2] << 8) | packet->payload[3];
    /* Validate TPKT length to avoid out-of-bounds access */
    if(tpkt_len <= packet->payload_packet_len && tpkt_len >= 4) {
      /* Perform a rudimentary check for Q.931, used in H.225 */
      if(tpkt_len >= 8 && packet->payload[4] == 0x08) {
        NDPI_LOG_DBG(ndpi_struct, "Detected H.323 (H.225) via TPKT\n");
        ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323);
        return;
      }
    }
  }

  /* Handle UDP-based H.323 (RAS) detection */
  if(packet->udp != NULL) {
    sport = ntohs(packet->udp->source);
    dport = ntohs(packet->udp->dest);

    /* Check common RAS ports 1718/1719 and sufficient payload size */
    if((sport == 1718 || sport == 1719 || dport == 1718 || dport == 1719) &&
       (packet->payload_packet_len > 0)) {
      /*
       * Additional checks can be applied here for RAS message structure.
       * For demonstration, do a minimal payload pattern check.
       */
      NDPI_LOG_DBG(ndpi_struct, "Detected H.323 RAS over UDP\n");
      ndpi_set_detected_protocol(ndpi_struct, stream, NDPI_PROTOCOL_H323);
      return;
    }
  }

  /* If conditions not met, it's not H.323 */
}