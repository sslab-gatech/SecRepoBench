if (packet->payload_packet_len >= 4) {
    u_int32_t tpkt_len = ntohl(*((u_int32_t *)packet->payload));
    if (tpkt_len > 0 && tpkt_len <= packet->payload_packet_len) {
      if (packet->payload_packet_len >= 8 && packet->payload[4] == 0x00 && packet->payload[5] == 0x00 && packet->payload[6] == 0x00 && packet->payload[7] == 0x00) {
        stream->detected_protocol = NDPI_PROTOCOL_H323;
        stream->h323_packet_count++;
        if (packet->payload[8] == 0x00 && packet->payload[9] == 0x00 && packet->payload[10] == 0x00 && packet->payload[11] == 0x00) {
          stream->h323_broadcast_count++;
        }
      }
    }
  } else if (packet->udp != NULL) {
    sport = ntohs(packet->udp->source);
    dport = ntohs(packet->udp->dest);
    if (packet->payload_packet_len >= 4) {
      if (packet->payload[0] == 0x00 && packet->payload[1] == 0x00 && packet->payload[2] == 0x00 && packet->payload[3] == 0x00) {
        stream->detected_protocol = NDPI_PROTOCOL_H323;
        stream->h323_packet_count++;
        if (packet->payload_packet_len >= 12 && packet->payload[8] == 0x00 && packet->payload[9] == 0x00 && packet->payload[10] == 0x00 && packet->payload[11] == 0x00) {
          stream->h323_broadcast_count++;
        }
      }
    }
  }
}