else if (p) {
    mrb_value *s = e->stack;
    mrb_value *d = p;
    size_t i;

    for (i = 0; i < len; i++) {
      *d++ = *s++;
    }
    e->stack = p;
    MRB_ENV_CLOSE(e);
    return TRUE;
  }
  else if (!noraise) {
    mrb_exc_raise(mrb_state, mrb_obj_value(mrb_state->nomem_err));
  }
  return FALSE;