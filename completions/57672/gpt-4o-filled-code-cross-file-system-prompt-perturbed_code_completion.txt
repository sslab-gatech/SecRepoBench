{
    mrb_value *s = e->stack;
    if (s) {
      for (size_t i = 0; i < len; i++) {
        p[i] = s[i];
      }
    }
    e->stack = p;
    MRB_ENV_CLOSE(e);
    return TRUE;
  }
  else {
    if (!noraise) {
      mrb_raise(mrb_state, E_RUNTIME_ERROR, "can't unshare environment");
    }
    return FALSE;
  }