{
    /* Copy the existing stack contents to the newly allocated memory */
    memcpy(p, e->stack, sizeof(mrb_value) * len);

    /* Update the environment to use the new stack */
    e->stack = p;

    /* Mark the environment as closed */
    MRB_ENV_CLOSE(e);

    return TRUE;
  }