{
    /* Copy the existing stack contents to the newly allocated memory */
    for (size_t i = 0; i < len; i++) {
      p[i] = e->stack[i];
    }

    /* Update the environment to use the new stack */
    e->stack = p;

    /* Mark the environment as closed */
    MRB_ENV_CLOSE(e);

    return TRUE;
  }