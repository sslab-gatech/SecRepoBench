if (*p == '{')
{
  level++;
  q = subexpression;
  for (p++; *p != '\0'; )
  {
    if (*p == '{')
      level++;
    else if (*p == '}')
    {
      level--;
      if (level == 0)
        break;
    }
    *q++ = *p++;
    if ((size_t) (q - subexpression) >= sizeof(subexpression) - 1)
      break;
  }
  *q = '\0';
  if (*p != '\0')
    p++;
}
else if (*p == '[')
{
  level++;
  q = subexpression;
  for (p++; *p != '\0'; )
  {
    if (*p == '[')
      level++;
    else if (*p == ']')
    {
      level--;
      if (level == 0)
        break;
    }
    *q++ = *p++;
    if ((size_t) (q - subexpression) >= sizeof(subexpression) - 1)
      break;
  }
  *q = '\0';
  if (*p != '\0')
    p++;
}
alpha = FxEvaluateSubexpression(fx_info, pixchannel, x, y, subexpression,
  &depth, &beta, exception);
point.x = alpha;
point.y = beta;