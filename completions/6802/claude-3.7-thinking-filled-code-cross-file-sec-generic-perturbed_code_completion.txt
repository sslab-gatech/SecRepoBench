if ((*p == '{') || (*p == '['))
{
  char opening = *p;
  char closing = (opening == '{') ? '}' : ']';
  
  level++;
  q = subexpression;
  for (p++; *p != '\0'; )
  {
    if (*p == opening)
      level++;
    else
      if (*p == closing)
        {
          level--;
          if (level == 0)
            break;
        }
    *q++ = (*p++);
  }
  *q = '\0';
  
  alpha = FxEvaluateSubexpression(fx_info, pixchannel, x, y, subexpression, &depth, &beta, exception);
  point.x = alpha;
  point.y = beta;
  if (*p != '\0')
    p++;
}