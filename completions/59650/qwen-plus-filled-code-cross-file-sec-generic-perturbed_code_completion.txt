if (record.isNull())
{
	return resRec;
}

uint8_t* nextPtr = record.getBasePointer() + record.getTotalSize();
size_t remainingLength = tlvDataLen - (nextPtr - tlvBufferPtr);

if (remainingLength < sizeof(uint16_t)) // Check for at least the type and length fields
{
	resRec.assign(NULL);
}
else
{
	resRec.assign(nextPtr, remainingLength);
	if (!resRec.isValid())
	{
		resRec.assign(NULL);
	}
}

return resRec;