if (record.isNull())
{
    return resRec;
}

const uint8_t* nextRecordPtr = record.getRawData() + record.getSize();
size_t remainingBytes = tlvDataLen - (nextRecordPtr - tlvBufferPtr);

if (remainingBytes < sizeof(TLVRecordType))
{
    return resRec;
}

resRec.assign(nextRecordPtr);

if (!resRec.isValid() || (nextRecordPtr + resRec.getSize() > tlvBufferPtr + tlvDataLen))
{
    resRec.assign(NULL);
}

return resRec;