if (record.isNull())
{
    return resRec;
}

const uint8_t* nextRecordPtr = record.getRawData() + record.getSize();
size_t remainingDataLen = tlvDataLen - (nextRecordPtr - tlvBufferPtr);

if (remainingDataLen >= sizeof(uint16_t) * 2)
{
    resRec.assign(const_cast<uint8_t*>(nextRecordPtr));
    
    if (resRec.getType() == 0 || resRec.getDataSize() > remainingDataLen - sizeof(uint16_t) * 2)
    {
        resRec.assign(NULL);
    }
}

return resRec;