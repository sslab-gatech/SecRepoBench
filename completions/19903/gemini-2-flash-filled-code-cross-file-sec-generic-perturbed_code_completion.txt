while (isspace((int) ((unsigned char) *expression)) != 0)
    expression++;
  if (*expression == '(')
    {
      const char
        *end;

      end=expression;
      level=1;
      for (end++; *end != '\0'; end++)
      {
        if (*end == '(')
          level++;
        if (*end == ')')
          level--;
        if (level == 0)
          break;
      }
      if (level != 0)
        {
          (void) ThrowMagickException(exception,GetMagickModule(),OptionError,
            "UnbalancedParenthesis","`%s'",expression);
          FxReturn(0.0);
        }
      (void) CopyMagickString(subexpression,expression+1,(size_t)
        (end-expression));
      result=FxEvaluateSubexpression(fx_info,channel,x,y,subexpression,depth+1,
        beta,exception);
      expression=end+1;
      FxReturn(result);
    }
  if (isdigit((int) ((unsigned char) *expression)) != 0)
    {
      result=StringToDouble(expression,&expression);
      FxReturn(result);
    }
  if (LocaleCompare(expression,"pi") == 0)
    FxReturn(MagickPI);
  if (LocaleCompare(expression,"e") == 0)
    FxReturn(MagickE);
  if (IsFxFunction(expression,"abs",3) != MagickFalse)
    {
      expression+=3;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(fabs(*beta));
    }
  if (IsFxFunction(expression,"acos",4) != MagickFalse)
    {
      expression+=4;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      if (fabs(*beta) > 1.0)
        *beta=(*beta > 0.0 ? 1.0 : -1.0);
      FxReturn(acos(*beta));
    }
#if defined(MAGICKCORE_HAVE_ACOSH)
  if (IsFxFunction(expression,"acosh",5) != MagickFalse)
    {
      expression+=5;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(acosh(*beta));
    }
#endif
  if (IsFxFunction(expression,"asin",4) != MagickFalse)
    {
      expression+=4;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      if (fabs(*beta) > 1.0)
        *beta=(*beta > 0.0 ? 1.0 : -1.0);
      FxReturn(asin(*beta));
    }
#if defined(MAGICKCORE_HAVE_ASINH)
  if (IsFxFunction(expression,"asinh",5) != MagickFalse)
    {
      expression+=5;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(asinh(*beta));
    }
#endif
  if (IsFxFunction(expression,"atan",4) != MagickFalse)
    {
      expression+=4;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(atan(*beta));
    }
  if (IsFxFunction(expression,"atan2",5) != MagickFalse)
    {
      expression+=5;
      alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(atan2(alpha,*beta));
    }
#if defined(MAGICKCORE_HAVE_ATANH)
  if (IsFxFunction(expression,"atanh",5) != MagickFalse)
    {
      expression+=5;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(atanh(*beta));
    }
#endif
  if (IsFxFunction(expression,"ceil",4) != MagickFalse)
    {
      expression+=4;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(ceil(*beta));
    }
  if (IsFxFunction(expression,"cos",3) != MagickFalse)
    {
      expression+=3;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(cos(*beta));
    }
  if (IsFxFunction(expression,"exp",3) != MagickFalse)
    {
      expression+=3;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(exp(*beta));
    }
  if (IsFxFunction(expression,"floor",5) != MagickFalse)
    {
      expression+=5;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(floor(*beta));
    }
  if (IsFxFunction(expression,"hypot",5) != MagickFalse)
    {
      expression+=5;
      alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(hypot(alpha,*beta));
    }
  if (IsFxFunction(expression,"ln",2) != MagickFalse)
    {
      expression+=2;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(log(*beta));
    }
  if (IsFxFunction(expression,"log",3) != MagickFalse)
    {
      expression+=3;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(log10(*beta));
    }
  if (IsFxFunction(expression,"max",3) != MagickFalse)
    {
      expression+=3;
      alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(alpha > (*beta) ? alpha : (*beta));
    }
  if (IsFxFunction(expression,"min",3) != MagickFalse)
    {
      expression+=3;
      alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(alpha < (*beta) ? alpha : (*beta));
    }
  if (IsFxFunction(expression,"pow",3) != MagickFalse)
    {
      expression+=3;
      alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(pow(alpha,*beta));
    }
  if (IsFxFunction(expression,"rand",4) != MagickFalse)
    {
      expression+=4;
      FxReturn((double) ((double) rand()/(double) RAND_MAX));
    }
  if (IsFxFunction(expression,"round",5) != MagickFalse)
    {
      expression+=5;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(floor(*beta+0.5));
    }
  if (IsFxFunction(expression,"sin",3) != MagickFalse)
    {
      expression+=3;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(sin(*beta));
    }
  if (IsFxFunction(expression,"sqrt",4) != MagickFalse)
    {
      expression+=4;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(sqrt(*beta));
    }
  if (IsFxFunction(expression,"tan",3) != MagickFalse)
    {
      expression+=3;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(tan(*beta));
    }
#if defined(MAGICKCORE_HAVE_COSH)
  if (IsFxFunction(expression,"cosh",4) != MagickFalse)
    {
      expression+=4;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(cosh(*beta));
    }
#endif
#if defined(MAGICKCORE_HAVE_SINH)
  if (IsFxFunction(expression,"sinh",4) != MagickFalse)
    {
      expression+=4;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(sinh(*beta));
    }
#endif
#if defined(MAGICKCORE_HAVE_TANH)
  if (IsFxFunction(expression,"tanh",4) != MagickFalse)
    {
      expression+=4;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(tanh(*beta));
    }
#endif
  if (IsFxFunction(expression,"trunc",5) != MagickFalse)
    {
      expression+=5;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      FxReturn(trunc(*beta));
    }
  if (IsFxFunction(expression,"j0",2) != MagickFalse)
    {
      expression+=2;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
#if defined(MAGICKCORE_HAVE_J0)
      FxReturn(j0(*beta));
#else
      FxReturn(0.0);
#endif
    }
  if (IsFxFunction(expression,"j1",2) != MagickFalse)
    {
      expression+=2;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
#if defined(MAGICKCORE_HAVE_J1)
      FxReturn(j1(*beta));
#else
      FxReturn(0.0);
#endif
    }
  if (IsFxFunction(expression,"jn",2) != MagickFalse)
    {
      expression+=2;
      alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
#if defined(MAGICKCORE_HAVE_JN)
      FxReturn(jn((int) alpha,*beta));
#else
      FxReturn(0.0);
#endif
    }
  if (IsFxFunction(expression,"y0",2) != MagickFalse)
    {
      expression+=2;
      *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
#if defined(MAGICKCORE_HAVE_Y0)
      FxReturn(y0(*beta));
#else