while (isspace((int) ((unsigned char) *expression)) != 0)
    expression++;
  if (*expression == '(')
    {
      size_t
        level;

      expression++;
      level=1;
      p=expression;
      while (*p != '\0')
      {
        if (*p == '(')
          level++;
        if (*p == ')')
          level--;
        if (level == 0)
          break;
        p++;
      }
      if (*p == '\0')
        {
          (void) ThrowMagickException(exception,GetMagickModule(),OptionError,
            "UnbalancedParenthesis","`%s'",expression);
          FxReturn(0.0);
        }
      *p='\0';
      alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
        beta,exception);
      expression=p+1;
      FxReturn(alpha);
    }
  if (isalpha((int) ((unsigned char) *expression)) != 0)
    {
      if (IsFxFunction(expression,"abs",3) != MagickFalse)
        {
          expression+=3;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(fabs(alpha));
        }
      if (IsFxFunction(expression,"acos",4) != MagickFalse)
        {
          expression+=4;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(acos(alpha));
        }
      if (IsFxFunction(expression,"angle",5) != MagickFalse)
        {
          expression+=5;
          alpha=atan2((double) y,(double) x)*MagickRadToDegrees;
          FxReturn(alpha);
        }
      if (IsFxFunction(expression,"asin",4) != MagickFalse)
        {
          expression+=4;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(asin(alpha));
        }
      if (IsFxFunction(expression,"atan",4) != MagickFalse)
        {
          expression+=4;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(atan(alpha));
        }
#if defined(MAGICKCORE_HAVE_ACOSH)
      if (IsFxFunction(expression,"acosh",5) != MagickFalse)
        {
          expression+=5;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(acosh(alpha));
        }
#endif
#if defined(MAGICKCORE_HAVE_ASINH)
      if (IsFxFunction(expression,"asinh",5) != MagickFalse)
        {
          expression+=5;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(asinh(alpha));
        }
#endif
#if defined(MAGICKCORE_HAVE_ATANH)
      if (IsFxFunction(expression,"atanh",5) != MagickFalse)
        {
          expression+=5;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(atanh(alpha));
        }
#endif
      if (IsFxFunction(expression,"atan2",5) != MagickFalse)
        {
          expression+=5;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(atan2(alpha,*beta));
        }
      if (IsFxFunction(expression,"ceil",4) != MagickFalse)
        {
          expression+=4;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(ceil(alpha));
        }
      if (IsFxFunction(expression,"cos",3) != MagickFalse)
        {
          expression+=3;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(cos(alpha));
        }
      if (IsFxFunction(expression,"cosh",4) != MagickFalse)
        {
          expression+=4;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(cosh(alpha));
        }
      if (IsFxFunction(expression,"degrees",7) != MagickFalse)
        {
          expression+=7;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(alpha*MagickRadToDegrees);
        }
      if (IsFxFunction(expression,"exp",3) != MagickFalse)
        {
          expression+=3;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(exp(alpha));
        }
      if (IsFxFunction(expression,"floor",5) != MagickFalse)
        {
          expression+=5;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(floor(alpha));
        }
      if (IsFxFunction(expression,"hypot",5) != MagickFalse)
        {
          expression+=5;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(hypot(alpha,*beta));
        }
      if (IsFxFunction(expression,"ln",2) != MagickFalse)
        {
          expression+=2;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(log(alpha));
        }
      if (IsFxFunction(expression,"log",3) != MagickFalse)
        {
          expression+=3;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(log10(alpha));
        }
      if (IsFxFunction(expression,"max",3) != MagickFalse)
        {
          expression+=3;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(alpha > *beta ? alpha : *beta);
        }
      if (IsFxFunction(expression,"min",3) != MagickFalse)
        {
          expression+=3;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(alpha < *beta ? alpha : *beta);
        }
      if (IsFxFunction(expression,"mod",3) != MagickFalse)
        {
          expression+=3;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(fmod(alpha,*beta));
        }
      if (IsFxFunction(expression,"pow",3) != MagickFalse)
        {
          expression+=3;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          *beta=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(pow(alpha,*beta));
        }
      if (IsFxFunction(expression,"radians",7) != MagickFalse)
        {
          expression+=7;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(alpha*MagickDegreesToRad);
        }
      if (IsFxFunction(expression,"rand",4) != MagickFalse)
        {
          expression+=4;
          FxReturn((double) GetPseudoRandomValue(fx_info->random_info));
        }
      if (IsFxFunction(expression,"round",5) != MagickFalse)
        {
          expression+=5;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(floor(alpha+0.5));
        }
      if (IsFxFunction(expression,"sin",3) != MagickFalse)
        {
          expression+=3;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(sin(alpha));
        }
      if (IsFxFunction(expression,"sinh",4) != MagickFalse)
        {
          expression+=4;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(sinh(alpha));
        }
      if (IsFxFunction(expression,"sqrt",4) != MagickFalse)
        {
          expression+=4;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(sqrt(alpha));
        }
      if (IsFxFunction(expression,"tan",3) != MagickFalse)
        {
          expression+=3;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(tan(alpha));
        }
      if (IsFxFunction(expression,"tanh",4) != MagickFalse)
        {
          expression+=4;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(tanh(alpha));
        }
      if (IsFxFunction(expression,"trunc",5) != MagickFalse)
        {
          expression+=5;
          alpha=FxEvaluateSubexpression(fx_info,channel,x,y,expression,depth+1,
            beta,exception);
          FxReturn(trunc(alpha));
        }
      if (IsFxFunction(expression,"u",1) != MagickFalse)
        {
          expression++;
          FxReturn((double) x);
        }
      if (IsFxFunction(expression,"v",1) != MagickFalse)
        {
          expression++;
          FxReturn((double) y);
        }
      if (IsFxFunction(expression,"pi",2) != MagickFalse)
        {
          expression+=2;
          FxReturn(MagickPI);
        }
      if (IsFxFunction(expression,"e",1) != MagickFalse)
        {
          expression++;
          FxReturn(MagickE);
        }
    }
  if (isdigit((int) ((unsigned char) *expression)) != 0)
    {
      alpha=StringToDouble(expression,&p);
      expression=p;
      FxReturn(alpha);
    }