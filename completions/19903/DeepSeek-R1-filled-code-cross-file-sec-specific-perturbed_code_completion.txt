if (*expression == '(')
    {
      const char
        *closing_paren;

      char
        *subexpr;

      size_t
        length;

      closing_paren=FxSubexpression(expression,exception);
      if (closing_paren == (const char *) NULL)
        {
          (void) ThrowMagickException(exception,GetMagickModule(),OptionError,
            "MismatchedParenthesis","`%s'",expression);
          FxReturn(0.0);
        }
      length=(size_t) (closing_paren-expression-1);
      subexpr=AcquireString(length+1);
      if (subexpr == (char *) NULL)
        {
          (void) ThrowMagickException(exception,GetMagickModule(),
            ResourceLimitError,"MemoryAllocationFailed","`%s'",expression);
          FxReturn(0.0);
        }
      (void) CopyMagickString(subexpr,expression+1,length+1);
      alpha=FxEvaluateSubexpression(fx_info,channel,x,y,subexpr,depth+1,beta,
        exception);
      subexpr=DestroyString(subexpr);
      expression=closing_paren+1;
      FxReturn(alpha);
    }
  if (isalpha((int) ((unsigned char) *expression)) != 0)
    {
      char
        *func_name,
        *arguments;

      const char
        *closing_paren,
        *p;

      double
        value;

      size_t
        arg_length,
        func_name_length;

      p=expression;
      while (isalpha((int) ((unsigned char) *p)) != 0)
        p++;
      if (*p != '(')
        {
          if (LocaleCompare(expression,"pi") == 0)
            FxReturn(MagickPI);
          if (LocaleCompare(expression,"e") == 0)
            FxReturn(exp(1.0));
          goto evaluate_symbol;
        }
      func_name_length=(size_t) (p-expression);
      func_name=AcquireString(func_name_length+1);
      if (func_name == (char *) NULL)
        {
          (void) ThrowMagickException(exception,GetMagickModule(),
            ResourceLimitError,"MemoryAllocationFailed","`%s'",expression);
          FxReturn(0.0);
        }
      (void) CopyMagickString(func_name,expression,func_name_length+1);
      arguments=p+1;
      closing_paren=FxSubexpression(p,exception);
      if ((closing_paren == (const char *) NULL) || (*closing_paren != ')'))
        {
          func_name=DestroyString(func_name);
          (void) ThrowMagickException(exception,GetMagickModule(),OptionError,
            "MismatchedParenthesis","`%s'",expression);
          FxReturn(0.0);
        }
      arg_length=(size_t) (closing_paren-arguments);
      arguments=DestroyString((char *) arguments);
      arguments=AcquireString(arg_length+1);
      if (arguments == (char *) NULL)
        {
          func_name=DestroyString(func_name);
          (void) ThrowMagickException(exception,GetMagickModule(),
            ResourceLimitError,"MemoryAllocationFailed","`%s'",expression);
          FxReturn(0.0);
        }
      (void) CopyMagickString(arguments,p+1,arg_length+1);
      value=FxEvaluateSubexpression(fx_info,channel,x,y,arguments,depth+1,beta,
        exception);
      arguments=DestroyString((char *) arguments);
      if (LocaleCompare(func_name,"abs") == 0)
        value=fabs(value);
      else if (LocaleCompare(func_name,"acos") == 0)
        value=acos(value);
      else if (LocaleCompare(func_name,"asin") == 0)
        value=asin(value);
      else if (LocaleCompare(func_name,"atan") == 0)
        value=atan(value);
      else if (LocaleCompare(func_name,"ceil") == 0)
        value=ceil(value);
      else if (LocaleCompare(func_name,"cos") == 0)
        value=cos(value);
      else if (LocaleCompare(func_name,"cosh") == 0)
        value=cosh(value);
      else if (LocaleCompare(func_name,"exp") == 0)
        value=exp(value);
      else if (LocaleCompare(func_name,"floor") == 0)
        value=floor(value);
      else if (LocaleCompare(func_name,"log") == 0)
        value=log(value);
      else if (LocaleCompare(func_name,"sin") == 0)
        value=sin(value);
      else if (LocaleCompare(func_name,"sinh") == 0)
        value=sinh(value);
      else if (LocaleCompare(func_name,"sqrt") == 0)
        value=sqrt(value);
      else if (LocaleCompare(func_name,"tan") == 0)
        value=tan(value);
      else if (LocaleCompare(func_name,"tanh") == 0)
        value=tanh(value);
      else
        {
          func_name=DestroyString(func_name);
          (void) ThrowMagickException(exception,GetMagickModule(),OptionError,
            "UnrecognizedFunction","`%s'",func_name);
          FxReturn(0.0);
        }
      func_name=DestroyString(func_name);
      expression=closing_paren+1;
      FxReturn(value);
    }
  evaluate_symbol: subexpression=DestroyString(subexpression);
  q=(char *) expression;
  alpha=InterpretSiPrefixValue(expression,&q);
  if (q == expression)
    alpha=FxGetSymbol(fx_info,channel,x,y,expression,depth+1,exception);
  FxReturn(alpha);