bool AffixMgr::parse_phonetable(const std::string& line, FileMgr* fileMgr) {
  if (phone) {
    HUNSPELL_WARNING(stderr, "error: line %d: multiple table definitions\n",
                     fileMgr->getlinenum());
    return false;
  }
  // Parse the input line to extract phonetic table parameters.
  std::string::const_iterator iter = line.begin();
  std::string::const_iterator start_piece = mystrsep(line, iter);
  int numrules = -1;
  while (start_piece != line.end()) {
    if (numrules == -1) {
      numrules = atoi(std::string(start_piece, iter).c_str());
      if (numrules < 1) {
        HUNSPELL_WARNING(stderr, "error: line %d: bad entry number\n",
                         fileMgr->getlinenum());
        return false;
      }
      phone = new phonetable(numrules);
    }
    start_piece = mystrsep(line, iter);
  }
  if (numrules == -1) {
    HUNSPELL_WARNING(stderr, "error: line %d: missing data\n",
                     fileMgr->getlinenum());
    return false;
  }

  // Read and process the specified number of phonetic rules from the file.
  for (int j = 0; j < numrules; j++) {
    std::string nl;
    if (!fileMgr->getline(nl))
      return false;
    mychomp(nl);
    iter = nl.begin();
    start_piece = mystrsep(nl, iter);
    if (nl.compare(start_piece - nl.begin(), 5, "PHONE", 5) != 0) {
      HUNSPELL_WARNING(stderr, "error: line %d: table is corrupt\n",
                       fileMgr->getlinenum());
      return false;
    }
    std::string pattern, pattern2;
    pattern.assign(start_piece, iter);
    start_piece = mystrsep(nl, iter);
    pattern2.assign(start_piece, iter);

    // Strip underscores from specific parts of the rules before storing them.
    size_t pos = pattern.find('_');
    if (pos != std::string::npos) {
      pattern.erase(pos, 1);
    }
    pos = pattern2.find('_');
    if (pos != std::string::npos) {
      pattern2.erase(pos, 1);
    }

    // Verify the integrity of the rules by checking the expected size after insertion.
    if (phone->add(pattern, pattern2) != static_cast<size_t>(numrules)) {
      HUNSPELL_WARNING(stderr, "error: line %d: table is corrupt\n",
                       fileMgr->getlinenum());
      return false;
    }
  }

  // Finalize the phonetable by adding empty strings and initializing its hash.
  phone->finish();
  return true;
}