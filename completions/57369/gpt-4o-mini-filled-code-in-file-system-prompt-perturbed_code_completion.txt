struct ndpi_udphdr *udp = (struct ndpi_udphdr *)&packet[iphdroffset + ip_len];
if (header->caplen < iphdroffset + ip_len + sizeof(struct ndpi_udphdr)) {
    return false; // Not enough data for UDP header
}