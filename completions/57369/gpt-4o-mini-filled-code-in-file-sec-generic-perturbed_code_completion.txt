struct ndpi_udphdr *udp = (struct ndpi_udphdr *)&packet[ip_offset + ip_len];
if (header->caplen < ip_offset + ip_len + sizeof(struct ndpi_udphdr)) {
    return false; // Too short for UDP header
}