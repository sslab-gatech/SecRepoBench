u_int16_t vxlan_dst_port = htons(4789);
struct udphdr *udp;
uint16_t offset;

/* Verify we have at least a minimal IP header */
if(iphdroffset + 20 > header->caplen) {
  return false;
}

/* Calculate actual IP header size for IPv4 */
uint8_t ip_header_len = (packet[iphdroffset] & 0x0F) * 4;
if(iphdroffset + ip_header_len > header->caplen) {
  return false;
}

/* Move to the start of the UDP header */
offset = iphdroffset + ip_header_len;
if(offset + sizeof(struct udphdr) > header->caplen) {
  return false;
}

/* Parse the UDP header */
udp = (struct udphdr *)(packet + offset);
offset += sizeof(struct udphdr);

/* Ensure we have enough bytes for the VXLAN header check */
if(offset + 8 > header->caplen) {
  return false;
}