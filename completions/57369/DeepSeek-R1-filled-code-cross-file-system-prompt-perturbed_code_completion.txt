const struct ndpi_iphdr *ip = (const struct ndpi_iphdr *)(packet + iphdroffset);
u_int16_t ip_header_len = ip->ihl * 4;
u_int16_t udp_offset = iphdroffset + ip_header_len;

if (header->caplen < udp_offset + sizeof(struct ndpi_udphdr) + 8) {
    return false;
}

if (ip->protocol != IPPROTO_UDP) {
    return false;
}

const u_int16_t vxlan_dst_port = htons(4789);
const struct ndpi_udphdr *udp = (const struct ndpi_udphdr *)(packet + udp_offset);

if (ntohs(udp->len) < sizeof(struct ndpi_udphdr) + 8) {
    return false;
}

u_int16_t offset = udp_offset + sizeof(struct ndpi_udphdr);