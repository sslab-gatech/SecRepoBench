if (phantom_only)
  return true;

if (unlikely (num_contours >= 0xFFFF)) return false;
if (unlikely (num_contours >= endPtsOfContours.length)) return false;

unsigned int num_points = 0;
if (num_contours > 0)
{
  num_points = endPtsOfContours[num_contours - 1] + 1;
  if (unlikely (num_points > 0x10000)) return false;
}

contour_points.resize (num_points);
if (num_points == 0)
  return true;

for (unsigned int i = 0; i < num_contours; i++)
{
  unsigned int start_point = i == 0 ? 0 : endPtsOfContours[i - 1] + 1;
  unsigned int end_point = endPtsOfContours[i];
  
  if (unlikely (end_point >= num_points)) return false;
  if (unlikely (start_point > end_point)) return false;
  
  for (unsigned int p = start_point; p <= end_point; p++)
    contour_points.arrayZ[p].is_end_point = (p == end_point);
}