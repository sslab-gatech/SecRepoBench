if (unlikely (!contour_points.resize (num_contours + 1))) return false;

for (unsigned i = 0; i <= num_contours; i++)
{
  contour_points.arrayZ[i].index = endPtsOfContours[i];
  if (unlikely (endPtsOfContours[i] > points.length)) return false;
}

if (phantom_only) return true;

// Add phantom points
if (unlikely (!contour_points.reserve (points.length + 4))) return false;

contour_point_t *phantom_points[4];
for (unsigned i = 0; i < 4; i++)
{
  if (unlikely (!(phantom_points[i] = contour_points.push()))) return false;
  phantom_points[i]->flag = 0;
}

// Set the first phantom point
phantom_points[0]->x = points[0].x - leftSideBearing;
phantom_points[0]->y = points[0].y;

// Set the second phantom point
phantom_points[1]->x = phantom_points[0]->x + advanceWidth;
phantom_points[1]->y = points[0].y;

// Set the third and fourth phantom points
phantom_points[2]->x = phantom_points[0]->x;
phantom_points[2]->y = points[0].y - hb_max (yMin, yMax);
phantom_points[3]->x = phantom_points[0]->x;
phantom_points[3]->y = points[0].y + hb_max (-yMin, -yMax);