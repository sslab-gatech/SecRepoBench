unsigned int num_contours = header.numberOfContours;
if (unlikely (!num_contours)) return false;

const HBUINT16 *endPtsOfContours = &StructAtOffset<HBUINT16> (&bytes, GlyphHeader::static_size);
if (unlikely ((const char *) endPtsOfContours + HBUINT16::static_size * num_contours > bytes.arrayZ + bytes.length))
  return false;

unsigned int num_points = endPtsOfContours[num_contours - 1] + 1;
if (unlikely (!contour_points.resize (num_points + 4))) return false;

for (unsigned int i = 0; i < num_contours; i++)
{
  unsigned int endPt = endPtsOfContours[i];
  if (unlikely (endPt >= num_points)) return false;
  contour_points.arrayZ[endPt].is_end_point = true;
}

if (phantom_only) return true;