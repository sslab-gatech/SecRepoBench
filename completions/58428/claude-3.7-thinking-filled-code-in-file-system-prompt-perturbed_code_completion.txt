unsigned int num_contours = header.numberOfContours;
if (unlikely (!num_contours)) return true; /* Empty glyph */

/* Access the end points of contours */
const HBUINT16 *endPtsOfContours = (const HBUINT16 *) (bytes.arrayZ + GlyphHeader::static_size);

/* Check if we have enough data for the end points */
if (unlikely (bytes.length < instruction_len_offset ()))
  return false;

/* Get the total number of points in the glyph */
unsigned int num_points = endPtsOfContours[num_contours - 1] + 1;
if (unlikely (num_points > 0x1FFF)) return false;

/* Allocate memory for contour points, including phantom points */
if (unlikely (!contour_points.alloc (num_points + 4))) return false;
contour_points.length = num_points + 4;

/* If phantom_only is true, we're done */
if (phantom_only) return true;