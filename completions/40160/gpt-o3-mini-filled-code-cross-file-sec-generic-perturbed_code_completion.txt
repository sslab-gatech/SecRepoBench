for (u_int16_t k = 0; k < cipher_length; k += 2) {
    if ((cipher_offset + k + 1) >= total_len)
        break;
    u_int16_t cipher = ntohs(*((u_int16_t *)&packet->payload[cipher_offset + k]));

    /* Skip GREASE cipher suites.
       GREASE values in JA3 are detected by the pattern where both nibbles equal a constant.
       Here we check several common GREASE patterns. */
    if (((cipher & 0x0F0F) == 0x0A0A) ||
        ((cipher & 0x0F0F) == 0x1A1A) ||
        ((cipher & 0x0F0F) == 0x2A2A) ||
        ((cipher & 0x0F0F) == 0x3A3A) ||
        ((cipher & 0x0F0F) == 0x4A4A) ||
        ((cipher & 0x0F0F) == 0x5A5A) ||
        ((cipher & 0x0F0F) == 0x6A6A) ||
        ((cipher & 0x0F0F) == 0x7A7A) ||
        ((cipher & 0x0F0F) == 0x8A8A) ||
        ((cipher & 0x0F0F) == 0x9A9A) ||
        ((cipher & 0x0F0F) == 0xAAAA) ||
        ((cipher & 0x0F0F) == 0xBABA) ||
        ((cipher & 0x0F0F) == 0xCACA) ||
        ((cipher & 0x0F0F) == 0xDADA) ||
        ((cipher & 0x0F0F) == 0xEAEA) ||
        ((cipher & 0x0F0F) == 0xFAFA)) {
        continue;
    }

    if (ja3.client.num_cipher < MAX_NUM_JA3)
        ja3.client.cipher[ja3.client.num_cipher++] = cipher;

    /* Heuristic checks:
       - Mark TLS 1.3 cipher suites as "not Safari" (example values 0x1301/0x1302/0x1303)
       - Increment safari_ciphers for even-numbered ciphers and chrome_ciphers for odd-numbered ones (dummy heuristic)
       - Flag a specific cipher (e.g. 0xCCA9) as indicating Safari on Big Sur */
    if (cipher == 0x1301 || cipher == 0x1302 || cipher == 0x1303)
        this_is_not_safari = 1;
    if ((cipher & 1) == 0)
        safari_ciphers++;
    else
        chrome_ciphers++;
    if (cipher == 0xCCA9)
        looks_like_safari_on_big_sur = 1;
}