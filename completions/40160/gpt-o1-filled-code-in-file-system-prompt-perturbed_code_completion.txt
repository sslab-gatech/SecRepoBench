for(u_int16_t i = 0; i < cipher_length; i += 2) {
  u_int16_t c = ntohs(*((u_int16_t *)&packet->payload[cipher_offset + i]));

  /* Skip empty or GREASE-like entries where high and low bytes match */
  if((c == 0x0000) || (packet->payload[cipher_offset + i] == packet->payload[cipher_offset + i + 1])) {
    /* GREASE or zero, do nothing */
    continue;
  }

  if(ja3.client.num_cipher < MAX_NUM_JA3) {
    ja3.client.cipher[ja3.client.num_cipher++] = c;
  } else {
    invalid_ja3 = 1;
  }

  /* Heuristic checks for Safari/Chrome ciphers */
  switch(c) {
    /* Potential Safari ciphers */
    case 0x1301: /* TLS_AES_128_GCM_SHA256 */
    case 0x1302: /* TLS_AES_256_GCM_SHA384 */
    case 0x1303: /* TLS_CHACHA20_POLY1305_SHA256 */
    case 0xc02b: /* TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 */
    case 0xc02c: /* TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 */
    case 0xc02f: /* TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 */
    case 0xc030: /* TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 */
    case 0xcca8: /* TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 */
    case 0xcca9: /* TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 */
    case 0xc009: /* TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA */
    case 0xc00a: /* TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA */
    case 0xc013: /* TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA */
    case 0xc014: /* TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA */
      safari_ciphers++;
      break;

    /* Potential Chrome ciphers */
    case 0x009c: /* TLS_RSA_WITH_AES_128_GCM_SHA256 */
    case 0x009d: /* TLS_RSA_WITH_AES_256_GCM_SHA384 */
      chrome_ciphers++;
      break;

    /* Also treat these TLS 1.3 ciphers as common in Chrome */
    case 0x1301:
    case 0x1302:
    case 0x1303:
    case 0xc02b:
    case 0xc02f:
    case 0xcca8:
    case 0xcca9:
    case 0xc030:
    case 0xc02c:
      chrome_ciphers++;
      break;

    /* Used to detect that it might be Safari on a newer OS version */
    case 0x1304:
    case 0x1305:
      looks_like_safari_on_big_sur = 1;
      break;

    default:
      this_is_not_safari = 1;
      break;
  }
}