for(int i=0; i<cipher_length && cipher_offset + i + 1 < total_len; i += 2) {
    u_int16_t cipher = ntohs(*((u_int16_t*)&packet->payload[cipher_offset+i]));

    if((cipher == 0) || (packet->payload[cipher_offset+i] != packet->payload[cipher_offset+i+1])) {
        /* Skip GREASE */
        if(ja3.client.num_cipher < MAX_NUM_JA3)
            ja3.client.cipher[ja3.client.num_cipher++] = cipher;
        else {
            invalid_ja3 = 1;
#ifdef DEBUG_TLS
            printf("Client TLS Invalid num cipher %u\n", ja3.client.num_cipher);
#endif
            break;
        }

        /* Safari/Chrome heuristics */
        switch(cipher) {
        case 0x1301: /* TLS_AES_128_GCM_SHA256 */
        case 0x1302: /* TLS_AES_256_GCM_SHA384 */
        case 0x1303: /* TLS_CHACHA20_POLY1305_SHA256 */
        case 0xC02B: /* TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 */
        case 0xC02F: /* TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 */
        case 0xC02C: /* TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 */
        case 0xC030: /* TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 */
        case 0xCCA8: /* TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 */
        case 0xCCA9: /* TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 */
        case 0xC013: /* TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA */
        case 0xC014: /* TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA */
        case 0x009C: /* TLS_RSA_WITH_AES_128_GCM_SHA256 */
        case 0x009D: /* TLS_RSA_WITH_AES_256_GCM_SHA384 */
            safari_ciphers++;
            break;

        case 0xC02B: /* TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 */
        case 0xC02F: /* TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 */
        case 0xC02C: /* TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 */
        case 0xC030: /* TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 */
        case 0xCCA8: /* TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 */
        case 0xCCA9: /* TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 */
        case 0xC009: /* TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA */
        case 0xC013: /* TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA */
        case 0xC00A: /* TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA */
        case 0xC014: /* TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA */
        case 0x002F: /* TLS_RSA_WITH_AES_128_CBC_SHA */
        case 0x0035: /* TLS_RSA_WITH_AES_256_CBC_SHA */
            chrome_ciphers++;
            break;

        case 0x1301: /* TLS_AES_128_GCM_SHA256 */
        case 0x1302: /* TLS_AES_256_GCM_SHA384 */
        case 0x1303: /* TLS_CHACHA20_POLY1305_SHA256 */
            looks_like_safari_on_big_sur = 1;
            break;

        case 0x00FF: /* TLS_EMPTY_RENEGOTIATION_INFO_SCSV */
            this_is_not_safari = 1;
            break;
        }
    }
}