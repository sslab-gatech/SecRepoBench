for (i = 0; i < cipher_length; i += 2) {
    u_int16_t cipher_suite = ntohs(*((u_int16_t*)&packet->payload[cipher_offset + i]));

    if (cipher_suite == 0xFF01 || cipher_suite == 0xFF02) {
        // Skip GREASE cipher suites
        continue;
    }

    if (ja3.client.num_cipher < MAX_NUM_JA3) {
        ja3.client.cipher[ja3.client.num_cipher++] = cipher_suite;
    }

    if (ndpi_is_safe_ssl_cipher(cipher_suite) == 0) {
        // Mark as weak cipher
        ndpi_set_risk(ndpi_struct, flow, NDPI_TLS_WEAK_CIPHER);
    }

    // Check for specific browser heuristics
    if (cipher_suite == 0xC02F || cipher_suite == 0xC030) { // Example for Safari
        safari_ciphers++;
    } else if (cipher_suite == 0xC02B || cipher_suite == 0xC02C) { // Example for Chrome
        chrome_ciphers++;
    } else {
        this_is_not_safari = 1; // If we find a cipher not in Safari's list
    }
}