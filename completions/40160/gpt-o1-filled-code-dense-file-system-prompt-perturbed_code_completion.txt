/* Iterate over the advertised cipher suites */
  {
    u_int16_t pos;
    for(pos = cipher_offset; (pos + 1) < (cipher_offset + cipher_length); pos += 2) {
      /* Read the cipher ID in network byte order */
      u_int16_t cipher_id = ntohs(*((u_int16_t *)&packet->payload[pos]));

      /* Skip GREASE values (e.g., 0x0A0A, 0x1A1A, etc.) */
      if((cipher_id & 0x0F0F) == 0x0A0A)
        continue;

      /* Record the cipher in the JA3 client list if there's room */
      if(ja3.client.num_cipher < MAX_NUM_JA3) {
        ja3.client.cipher[ja3.client.num_cipher++] = cipher_id;
      } else {
        invalid_ja3 = 1;
#ifdef DEBUG_TLS
        printf("Client TLS Invalid num cipher %u\n", ja3.client.num_cipher);
#endif
        break;
      }

      /*
       * Simple heuristic checks for Safari and Chrome:
       * - We count certain ciphers commonly seen in Safari or Chrome handshakes.
       * - If we detect ciphers outside Safari's typical set, we set this_is_not_safari.
       * - Some ciphers also indicate "Big Sur" Safari usage.
       */
      switch(cipher_id) {
        /*
         * Example Safari/Big Sur ciphers. Adjust or extend to reflect
         * real-world usage patterns. Setting 'looks_like_safari_on_big_sur'
         * if one of these is seen.
         */
        case 0x1301: /* TLS_AES_128_GCM_SHA256 */
        case 0x1302: /* TLS_AES_256_GCM_SHA384 */
        case 0x1303: /* TLS_CHACHA20_POLY1305_SHA256 */
          safari_ciphers++;
          looks_like_safari_on_big_sur = 1;
          break;

        /*
         * Example Chrome ciphers. Adjust or extend to reflect
         * real-world usage patterns.
         */
        case 0xC02F: /* TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 */
        case 0xC02B: /* TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 */
        case 0xCCA8: /* TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 */
        case 0xCCA9: /* TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 */
          chrome_ciphers++;
          break;

        default:
          /* If we see anything unexpected, it likely isn't Safari-only. */
          this_is_not_safari = 1;
          break;
      }
    }
  }