for(i = 0; i + 1 < cipher_length; i += 2) {
  /* Ensure we don't read beyond the packet boundary */
  if ((cipher_offset + i + 1) >= total_len) break;

  /* Read cipher ID (2 bytes) */
  u_int16_t cipher_id = ntohs(*((u_int16_t*)&packet->payload[cipher_offset + i]));

  /* Skip GREASE (RFC 8701) */
  if ((cipher_id & 0x0F0F) == 0x0A0A) continue;

  /* Append cipher ID to the JA3 client cipher list, if space allows */
  if (ja3.client.num_cipher < MAX_NUM_JA3) {
    ja3.client.cipher[ja3.client.num_cipher++] = cipher_id;
  } else {
    invalid_ja3 = 1;
#ifdef DEBUG_TLS
    printf("Client TLS Invalid cipher index %u\n", ja3.client.num_cipher);
#endif
  }

  /* Basic heuristic checks for Safari/Chrome or other browsers */
  switch (cipher_id) {
    /* Example Safari-like ciphers */
    case 0xC02C:
    case 0xC02B:
    case 0xC030:
    case 0xC02F:
      safari_ciphers++;
      break;

    /* Example Chrome-like ciphers */
    case 0xC02F:
    case 0xC02B:
    case 0xCCA8:
    case 0xCCA9:
      chrome_ciphers++;
      break;

    /* Heuristic example for Big Sur Safari usage */
    case 0x1304:
      looks_like_safari_on_big_sur = 1;
      break;

    /* Mark that we have at least one cipher not in the Safari set */
    default:
      this_is_not_safari = 1;
      break;
  }
}