// Iterate through the list of cipher suites in the client's TLS handshake message.
// For each cipher suite, convert it from network byte order to host byte order.
// Skip cipher suites that match the GREASE pattern.
// For each non-GREASE cipher suite, add the cipher ID to the client's JA3 cipher list.
// Count the number of Safari and Chrome specific cipher suites to perform heuristic checks.
// Identify if the cipher suite looks like Safari on Big Sur for further browser heuristics.
u_int16_t cipher_suite;
u_int8_t safari_ciphers = 0, chrome_ciphers = 0, this_is_not_safari = 0, looks_like_safari_on_big_sur = 0;
for (i = 0; i < cipher_length; i += 2) {
    cipher_suite = ntohs(*((u_int16_t*)&packet->payload[cipher_offset + i]));
    if ((cipher_suite & 0xF0F0) == 0x0A0A) {
        // Skip GREASE cipher suites
        continue;
    }
    if (ja3.client.num_cipher < MAX_NUM_JA3) {
        ja3.client.cipher[ja3.client.num_cipher++] = cipher_suite;
    } else {
        invalid_ja3 = 1;
        break;
    }
    switch (cipher_suite) {
        case 0xC02B: // TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
        case 0xC02F: // TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
        case 0xCCA8: // TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256
        case 0xCCA9: // TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
        case 0xCCAA: // TLS_ECDHE_ECDSA_WITH_AES_128_CCM
        case 0xCCAB: // TLS_ECDHE_ECDSA_WITH_AES_256_CCM
        case 0xCCAC: // TLS_ECDHE_ECDSA_WITH_AES_128_CCM_8
        case 0xCCAD: // TLS_ECDHE_ECDSA_WITH_AES_256_CCM_8
        case 0xCCAF: // TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256
        case 0xCCB8: // TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        case 0xCCB9: // TLS_ECDHE_RSA_WITH_AES_128_CCM
        case 0xCCBA: // TLS_ECDHE_RSA_WITH_AES_256_CCM
        case 0xCCBB: // TLS_ECDHE_RSA_WITH_AES_128_CCM_8
        case 0xCCBC: // TLS_ECDHE_RSA_WITH_AES_256_CCM_8
            chrome_ciphers++;
            break;
        case 0x1301: // TLS_AES_128_GCM_SHA256
        case 0x1302: // TLS_AES_256_GCM_SHA384
        case 0x1303: // TLS_CHACHA20_POLY1305_SHA256
        case 0xC02C: // TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
        case 0xC02D: // TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        case 0xC030: // TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA
        case 0xC02E: // TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA
        case 0xC028: // TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA
        case 0xC027: // TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA
            safari_ciphers++;
            break;
        default:
            this_is_not_safari = 1;
            if (cipher_suite == 0x1301 || cipher_suite == 0x1302 || cipher_suite == 0x1303) {
                looks_like_safari_on_big_sur = 1;
            }
            break;
    }
}