// Iterate through the list of cipher suites in the client's TLS handshake message.
// For each cipher suite, convert it from network byte order to host byte order.
// Skip cipher suites that match the GREASE pattern.
// For each non-GREASE cipher suite, add the cipher ID to the client's JA3 cipher list.
// Count the number of Safari and Chrome specific cipher suites to perform heuristic checks.
// Identify if the cipher suite looks like Safari on Big Sur for further browser heuristics.
for(i=0; i<cipher_length; i+=2) {
  u_int16_t cipher = ntohs(*((u_int16_t*)&packet->payload[cipher_offset+i]));

  if((cipher & 0x0F0F) == 0x0A0A) {
    /* Skip GREASE */
    continue;
  }

  if(ja3.client.num_cipher < MAX_NUM_JA3)
    ja3.client.cipher[ja3.client.num_cipher++] = cipher;
  else {
    invalid_ja3 = 1;
#ifdef DEBUG_TLS
    printf("Client TLS Invalid ciphers %u\n", ja3.client.num_cipher);
#endif
    break;
  }

  switch(cipher) {
  case 0xC02B: /* TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 */
  case 0xC02F: /* TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 */
  case 0xCCA8: /* TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 */
  case 0xCCA9: /* TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 */
  case 0xCCAA: /* TLS_ECDHE_ECDSA_WITH_AES_128_CCM */
  case 0xCCAB: /* TLS_ECDHE_ECDSA_WITH_AES_256_CCM */
  case 0xCCAC: /* TLS_ECDHE_ECDSA_WITH_AES_128_CCM_8 */
  case 0xCCAD: /* TLS_ECDHE_ECDSA_WITH_AES_256_CCM_8 */
  case 0xCCAF: /* TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 */
  case 0xCCB8: /* TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 */
  case 0xCCB9: /* TLS_ECDHE_RSA_WITH_AES_128_CCM */
  case 0xCCBA: /* TLS_ECDHE_RSA_WITH_AES_256_CCM */
  case 0xCCBB: /* TLS_ECDHE_RSA_WITH_AES_128_CCM_8 */
  case 0xCCBC: /* TLS_ECDHE_RSA_WITH_AES_256_CCM_8 */
    safari_ciphers++;
    break;

  case 0xC030: /* TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 */
  case 0xC02C: /* TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 */
  case 0xC013: /* TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 */
  case 0xC014: /* TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 */
  case 0xC027: /* TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA */
  case 0xC028: /* TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA */
  case 0xC023: /* TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA */
  case 0xC024: /* TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA */
  case 0x009C: /* TLS_RSA_WITH_AES_128_GCM_SHA256 */
  case 0x009D: /* TLS_RSA_WITH_AES_256_GCM_SHA384 */
  case 0x002F: /* TLS_RSA_WITH_AES_128_CBC_SHA */
  case 0x0035: /* TLS_RSA_WITH_AES_256_CBC_SHA */
    chrome_ciphers++;
    break;

  default:
    this_is_not_safari = 1;
    break;
  }

  if(flow->protos.tls_quic_stun.tls_quic.ssl_version == 0x0301 /* TLS 1.0 */
     && (cipher == 0x0035 /* TLS_RSA_WITH_AES_256_CBC_SHA */
	 || cipher == 0x002F /* TLS_RSA_WITH_AES_128_CBC_SHA */)) {
    looks_like_safari_on_big_sur = 1;
  }
}