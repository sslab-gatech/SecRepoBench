for(i = 0; (i + 1 < cipher_length) && ((cipher_offset + i + 1) < total_len); i += 2) {
  /* Each cipher suite is 2 bytes */
  u_int16_t cipher_id = ntohs(*((u_int16_t*)&packet->payload[cipher_offset + i]));

  /* Skip GREASE cipher suites: if the two bytes are the same, it's likely GREASE */
  if((cipher_id == 0) || (packet->payload[cipher_offset + i] != packet->payload[cipher_offset + i + 1])) {
    if(ja3.client.num_cipher < MAX_NUM_JA3) {
      ja3.client.cipher[ja3.client.num_cipher++] = cipher_id;
    } else {
      invalid_ja3 = 1;
#ifdef DEBUG_TLS
      printf("[TLS] Client: too many ciphers, invalid JA3.\n");
#endif
    }
  }

#ifdef DEBUG_HEURISTIC
  printf("[CIPHERS] Found cipher 0x%04X\n", cipher_id);
#endif

  /*
    Heuristic: check if cipher matches known Safari or Chrome sets.
    The values and counts below are example heuristics that might
    overlap; set or increment "this_is_not_safari", "safari_ciphers",
    "chrome_ciphers", or "looks_like_safari_on_big_sur" based on
    observed cipher IDs.
  */
  switch(cipher_id) {
  case 0xC02F: /* TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 */
  case 0xC02B: /* TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 */
    safari_ciphers++;
    break;

  case 0xC030: /* TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 */
    safari_ciphers++;
    looks_like_safari_on_big_sur = 1;
    break;

  case 0x1301: /* TLS_AES_128_GCM_SHA256 */
  case 0x1302: /* TLS_AES_256_GCM_SHA384 */
  case 0x1303: /* TLS_CHACHA20_POLY1305_SHA256 */
    /* Common to many clients, including Safari and Chrome */
    safari_ciphers++;
    chrome_ciphers++;
    break;

  case 0xC02C: /* TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 */
    /* Example of a cipher often used by Chrome */
    chrome_ciphers++;
    break;

  default:
    /* Not a typical Safari cipher, mark as not Safari. */
    this_is_not_safari = 1;
    break;
  }
}