for(i=0; i<cipher_length; i+=2) {
  u_int16_t cipher_id = ntohs(*((u_int16_t*)&packet->payload[cipher_offset+i]));

  // Skip GREASE values (RFC 8701)
  if((cipher_id & 0x0F0F) == 0x0A0A)
    continue;

  if(ja3.client.num_cipher < MAX_NUM_JA3)
    ja3.client.cipher[ja3.client.num_cipher++] = cipher_id;

  // Heuristics for Safari and Chrome ciphers
  switch(cipher_id) {
    // Safari ciphers (from nDPI's heuristics)
    case 0x1301: case 0x1302: case 0x1303: case 0xC02F: case 0xC02B:
    case 0xC030: case 0xC02C: case 0x009E: case 0x009F: case 0xCC14:
    case 0xCC13: case 0xC00A:
      safari_ciphers++;
      break;
    // Chrome ciphers (from nDPI's heuristics)
    case 0x1301: case 0x1302: case 0x1303: case 0xC02B: case 0xC02F:
    case 0xC02C: case 0xC030: case 0x009E: case 0x009F: case 0xCC14:
    case 0xCC13: case 0xC00A: case 0xC009: case 0xC013:
      chrome_ciphers++;
      break;
  }

  // Heuristic for Safari on Big Sur (special cipher suite order)
  if(i == 0 && cipher_id == 0x1301)
    looks_like_safari_on_big_sur = 1;
  if(i == 2 && cipher_id != 0x1302)
    looks_like_safari_on_big_sur = 0;

  // If a cipher is not in Safari's set, mark as not Safari
  if(cipher_id != 0x1301 && cipher_id != 0x1302 && cipher_id != 0x1303 &&
     cipher_id != 0xC02F && cipher_id != 0xC02B && cipher_id != 0xC030 &&
     cipher_id != 0xC02C && cipher_id != 0x009E && cipher_id != 0x009F &&
     cipher_id != 0xCC14 && cipher_id != 0xCC13 && cipher_id != 0xC00A)
    this_is_not_safari = 1;
}