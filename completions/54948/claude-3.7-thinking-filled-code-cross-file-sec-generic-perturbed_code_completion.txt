while (ctx->pos < ctx->end) {
    if (*ctx->pos == '\\') {
        num_escapes++;
        ctx->pos++;  // Move past the backslash
        if (ctx->pos >= ctx->end) {
            PLIST_OSTEP_ERR("Unexpected end of quoted string at offset %ld\n", ctx->pos - ctx->start);
            ctx->err++;
            plist_free_data(data);
            goto err_out;
        }
    } else if (*ctx->pos == quote_char) {
        break;  // Found closing quote
    }
    ctx->pos++;
}

if (ctx->pos >= ctx->end || *ctx->pos != quote_char) {
    PLIST_OSTEP_ERR("Unterminated quoted string at offset %ld\n", p - ctx->start);
    ctx->err++;
    plist_free_data(data);
    goto err_out;
}

size_t slen = ctx->pos - p;
char *strbuf = (char *)malloc(slen + 1);
if (!strbuf) {
    PLIST_OSTEP_ERR("Out of memory when parsing string at offset %ld\n", ctx->pos - ctx->start);
    ctx->err++;
    plist_free_data(data);
    goto err_out;
}
ctx->pos++; // Skip the closing quote