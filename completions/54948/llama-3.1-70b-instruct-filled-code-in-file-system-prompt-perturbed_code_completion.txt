while (ctx->pos < ctx->end) {
    if (*ctx->pos == '\\') {
        ctx->pos++;
        if (ctx->pos >= ctx->end) {
            PLIST_OSTEP_ERR("Unexpected end of string at offset %ld\n", ctx->pos - ctx->start);
            ctx->err++;
            break;
        }
        if (*ctx->pos == 'U') {
            ctx->pos++;
            if (ctx->pos + 4 > ctx->end) {
                PLIST_OSTEP_ERR("Unexpected end of string at offset %ld\n", ctx->pos - ctx->start);
                ctx->err++;
                break;
            }
            int i;
            for (i = 0; i < 4; i++) {
                if (!isxdigit(ctx->pos[i])) {
                    PLIST_OSTEP_ERR("Invalid Unicode escape sequence at offset %ld\n", ctx->pos - ctx->start);
                    ctx->err++;
                    break;
                }
            }
            ctx->pos += 4;
            num_escapes++;
        } else if (isxdigit(*ctx->pos)) {
            ctx->pos++;
            if (ctx->pos + 2 > ctx->end) {
                PLIST_OSTEP_ERR("Unexpected end of string at offset %ld\n", ctx->pos - ctx->start);
                ctx->err++;
                break;
            }
            int i;
            for (i = 0; i < 2; i++) {
                if (!isxdigit(ctx->pos[i])) {
                    PLIST_OSTEP_ERR("Invalid escape sequence at offset %ld\n", ctx->pos - ctx->start);
                    ctx->err++;
                    break;
                }
            }
            ctx->pos += 2;
            num_escapes++;
        } else {
            ctx->pos++;
            num_escapes++;
        }
    } else if (*ctx->pos == quote_char) {
        ctx->pos++;
        break;
    } else {
        ctx->pos++;
    }
}
size_t slen = ctx->pos - p;