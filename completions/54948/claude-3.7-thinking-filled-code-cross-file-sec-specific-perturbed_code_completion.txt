while (ctx->pos < ctx->end) {
    if (*ctx->pos == '\\') {
        // Found an escape sequence
        num_escapes++;
        ctx->pos++;
        if (ctx->pos >= ctx->end) {
            // Unexpected end after backslash
            PLIST_OSTEP_ERR("Unexpected end of string at offset %ld\n", ctx->pos - ctx->start);
            ctx->err++;
            plist_free_data(data);
            goto err_out;
        }
        ctx->pos++; // Move past the escaped character
    } else if (*ctx->pos == quote_char) {
        // Found the closing quote (not escaped)
        break;
    } else {
        // Regular character
        ctx->pos++;
    }
}

if (ctx->pos >= ctx->end) {
    // Reached end without finding closing quote
    PLIST_OSTEP_ERR("Missing terminating %c in string at offset %ld\n", quote_char, p - ctx->start - 1);
    ctx->err++;
    plist_free_data(data);
    goto err_out;
}

// Calculate string length (excluding the quotes)
size_t slen = ctx->pos - p;
// Allocate memory for string including null terminator
char *strbuf = (char*)malloc(slen + 1);
if (!strbuf) {
    // Memory allocation failure
    PLIST_OSTEP_ERR("Out of memory when parsing string at offset %ld\n", ctx->pos - ctx->start);
    ctx->err++;
    plist_free_data(data);
    goto err_out;
}

ctx->pos++; // Move past the closing quote