while (ctx->pos < ctx->end) {
    if (*ctx->pos == '\\') {
        /* increment position to skip the '\' */
        ctx->pos++;
        if (ctx->pos < ctx->end) {
            /* skip the next character as it is escaped */
            ctx->pos++;
            num_escapes++;
        }
    } else if (*ctx->pos == quote_char) {
        /* found the closing quote */
        break;
    } else {
        ctx->pos++;
    }
}

if (ctx->pos >= ctx->end) {
    PLIST_OSTEP_ERR("Missing terminating quote at offset %ld\n", ctx->pos - ctx->start);
    ctx->err++;
    plist_free_data(data);
    goto err_out;
}

/* calculate the length of the quoted string and allocate buffer */
slen = ctx->pos - p;
strbuf = (char *)malloc(slen + 1);
if (!strbuf) {
    PLIST_OSTEP_ERR("Memory allocation failed at offset %ld\n", ctx->pos - ctx->start);
    ctx->err++;
    plist_free_data(data);
    goto err_out;
}

/* move past the closing quote */
ctx->pos++;