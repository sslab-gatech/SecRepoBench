if (quote_char == '"') {
    size_t slen = 0;
    p = ctx->pos;
    while (ctx->pos < ctx->end) {
        if (*ctx->pos == '\\') {
            num_escapes++;
            ctx->pos++;
            if (ctx->pos >= ctx->end) {
                PLIST_OSTEP_ERR("Unexpected end of string at offset %ld\n", ctx->pos - ctx->start);
                ctx->err++;
                break;
            }
            if (*ctx->pos == '"') {
                ctx->pos++;
                break;
            }
            if (!isxdigit(*ctx->pos)) {
                PLIST_OSTEP_ERR("Invalid escape sequence in string at offset %ld\n", ctx->pos - ctx->start);
                ctx->err++;
                break;
            }
            uint8_t b = HEX_DIGIT(*ctx->pos);
            ctx->pos++;
            if (ctx->pos >= ctx->end) {
                PLIST_OSTEP_ERR("Unexpected end of string at offset %ld\n", ctx->pos - ctx->start);
                ctx->err++;
                break;
            }
            if (!isxdigit(*ctx->pos)) {
                PLIST_OSTEP_ERR("Invalid escape sequence in string at offset %ld\n", ctx->pos - ctx->start);
                ctx->err++;
                break;
            }
            b = (b << 4) + HEX_DIGIT(*ctx->pos);
            ctx->pos++;
            if (b == 0x5C) {
                /* backslash */
                strbuf[o++] = '\\';
            } else if (b == 0x22) {
                /* double quote */
                strbuf[o++] = '"';
            } else if (b == 0x5B) {
                /* left square bracket */
                strbuf[o++] = '[';
            } else if (b == 0x5D) {
                /* right square bracket */
                strbuf[o++] = ']';
            } else if (b == 0x5C) {
                /* backslash */
                strbuf[o++] = '\\';
            } else if (b == 0x2F) {
                /* forward slash */
                strbuf[o++] = '/';
            } else if (b == 0x7B) {
                /* left curly bracket */
                strbuf[o++] = '{';
            } else if (b == 0x7C) {
                /* vertical bar */
                strbuf[o++] = '|';
            } else if (b == 0x7D) {
                /* right curly bracket */
                strbuf[o++] = '}';
            } else if (b == 0x08) {
                /* backspace */
                strbuf[o++] = '\b';
            } else if (b == 0x09) {
                /* horizontal tab */
                strbuf[o++] = '\t';
            } else if (b == 0x0A) {
                /* line feed */
                strbuf[o++] = '\n';
            } else if (b == 0x0D) {
                /* carriage return */
                strbuf[o++] = '\r';
            } else if (b == 0x0B) {
                /* vertical tab */
                strbuf[o++] = '\v';
            } else if (b == 0x0C) {
                /* form feed */
                strbuf[o++] = '\f';
            } else if (b == 0x00) {
                /* null */
                strbuf[o++] = '\0';
            } else {
                PLIST_OSTEP_ERR("Invalid escape sequence in string at offset %ld\n", ctx->pos - ctx->start);
                ctx->err++;
                break;
            }
        } else {
            strbuf[o++] = *ctx->pos++;
        }
    }
    slen = ctx->pos - p;
    if (slen > 0) {
        data->type = PLIST_STRING;
        data->strval = strndup(p, slen);
        data->length = slen;
        *plist = plist_new_node(data);
        parse_skip_ws(ctx);
        break;
    } else {
        plist_free_data(data);
        PLIST_OSTEP_ERR("Unexpected character when parsing string at offset %ld\n", ctx->pos - ctx->start);
        ctx->err++;
        break;
    }
} else {
    // handle single quoted string
    size_t slen = 0;
    p = ctx->pos;
    while (ctx->pos < ctx->end) {
        if (*ctx->pos == '\\') {
            num_escapes++;
            ctx->pos++;
            if (ctx->pos >= ctx->end) {
                PLIST_OSTEP_ERR("Unexpected end of string at offset %ld\n", ctx->pos - ctx->start);
                ctx->err++;
                break;
            }
            if (*ctx->pos == '\'') {
                ctx->pos++;
                break;
            }
            if (!isxdigit(*ctx->pos)) {
                PLIST_OSTEP_ERR("Invalid escape sequence in string at offset %ld\n", ctx->pos - ctx->start);
                ctx->err++;
                break;
            }
            uint8_t b = HEX_DIGIT(*ctx->pos);
            ctx->pos++;
            if (ctx->pos >= ctx->end) {
                PLIST_OSTEP_ERR("Unexpected end of string at offset %ld\n", ctx->pos - ctx->start);
                ctx->err++;
                break;
            }
            if (!isxdigit(*ctx->pos)) {
                PLIST_OSTEP_ERR("Invalid escape sequence in string at offset %ld\n", ctx->pos - ctx->start);
                ctx->err++;
                break;
            }
            b = (b << 4) + HEX_DIGIT(*ctx->pos);
            ctx->pos++;
            if (b == 0x5C) {
                /* backslash */
                strbuf[o++] = '\\';
            } else if (b == 0x27) {
                /* single quote */
                strbuf[o++] = '\'';
            } else if (b == 0x5B) {
                /* left square bracket */
                strbuf[o++] = '[';
            } else if (b == 0x5D) {
                /* right square bracket */
                strbuf[o++] = ']';
            } else if (b == 0x5C) {
                /* backslash */
                strbuf[o++] = '\\';
            } else if (b == 0x2F) {
                /* forward slash */
                strbuf[o++] = '/';
            } else if (b == 0x7B) {
                /* left curly bracket */
                strbuf[o++] = '{';
            } else if (b == 0x7C) {
                /* vertical bar */
                strbuf[o++] = '|';
            } else if (b == 0x7D) {
                /* right curly bracket */
                strbuf[o++] = '}';
            } else if (b == 0x08) {
                /* backspace */
                strbuf[o++] = '\b';
            } else if (b == 0x09) {
                /* horizontal tab */
                strbuf[o++] = '\t';
            } else if (b == 0x0A) {
                /* line feed */
                strbuf[o++] = '\n';
            } else if (b == 0x0D) {
                /* carriage return */
                strbuf[o++] = '\r';
            } else if (b == 0x0B) {
                /* vertical tab */
                strbuf[o++] = '\v';
            } else if (b == 0x0C) {
                /* form feed */
                strbuf[o++] = '\f';
            } else if (b == 0x00) {
                /* null */
                strbuf[o++] = '\0';
            } else {
                PLIST_OSTEP_ERR("Invalid escape sequence in string at offset %ld\n", ctx->pos - ctx->start);
                ctx->err++;
                break;
            }
        } else {
            strbuf[o++] = *ctx->pos++;
        }
    }
    slen = ctx->pos - p;
    if (slen > 0) {
        data->type = PLIST_STRING;
        data->strval = strndup(p, slen);
        data->length = slen;
        *plist = plist_new_node(data);
        parse_skip_ws(ctx);
        break;
    } else {
        plist_free_data(data);
        PLIST_OSTEP_ERR("Unexpected character when parsing string at offset %ld\n", ctx->pos - ctx->start);
        ctx->err++;
        break;
    }
}