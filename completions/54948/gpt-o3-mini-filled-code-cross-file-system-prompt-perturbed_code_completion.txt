const char *q = ctx->pos;
while (q < ctx->end) {
    if (*q == '\\') {
        num_escapes++;
        q++;
        if (q >= ctx->end) {
            PLIST_OSTEP_ERR("Unexpected end of input in escape sequence at offset %ld\n", q - ctx->start);
            ctx->err++;
            break;
        }
        q++;
    } else if (*q == quote_char) {
        break;
    } else {
        q++;
    }
}
size_t slen = q - p;
if (q >= ctx->end || *q != quote_char) {
    PLIST_OSTEP_ERR("Missing terminating quote '%c' at offset %ld\n", quote_char, q - ctx->start);
    ctx->err++;
} else {
    ctx->pos = q + 1;
}
char *strbuf = malloc(slen + 1);
if (!strbuf) {
    PLIST_OSTEP_ERR("Memory allocation failed while parsing quoted string at offset %ld\n", p - ctx->start);
    ctx->err++;
} else {
    memcpy(strbuf, p, slen);
    strbuf[slen] = '\0';
    p = strbuf;
}