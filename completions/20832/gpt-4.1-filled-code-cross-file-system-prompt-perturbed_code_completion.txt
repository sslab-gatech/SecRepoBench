{
  int name_len = 0;
  int start_offset = offset;

  // Walk through the QNAME (domain name in DNS query)
  while((offset < flow->packet.payload_packet_len) && (flow->packet.payload[offset] != '\0')) {
    offset++;
    name_len++;
  }

  if(offset >= flow->packet.payload_packet_len)
    return(1 /* invalid: out of bounds */);

  // Skip the null terminator
  offset++;

  // Ensure there are at least 4 bytes for QTYPE and QCLASS
  if((offset + 4) > flow->packet.payload_packet_len)
    return(1 /* invalid: out of bounds for QTYPE/QCLASS */);

  // Extract QTYPE (2 bytes)
  flow->protos.dns.req_type = ntohs(*(u_int16_t*)&flow->packet.payload[offset]);
  offset += 2;

  // Optionally, extract QCLASS (2 bytes), not used here
  offset += 2;

  // Optionally, log the query type for debugging
  // printf("[DNS Query Type: %u]\n", flow->protos.dns.req_type);
}