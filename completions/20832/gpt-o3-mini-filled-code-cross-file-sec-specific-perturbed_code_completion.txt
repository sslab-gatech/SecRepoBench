{
  unsigned int curr = offset;
  /* Iterate through the query name until a null terminator is found */
  while(curr < flow->packet.payload_packet_len && flow->packet.payload[curr] != '\0') {
    curr++;
  }
  if(curr >= flow->packet.payload_packet_len) {
    /* Null terminator not found, invalid DNS query */
    return 1;
  }
  /* Skip the null terminator */
  curr++;
  /* Ensure there are at least 2 bytes available for the query type */
  if((curr + 2) > flow->packet.payload_packet_len) {
    return 1;
  }
  /* Read query type safely from the packet payload */
  u_int16_t qtype = get16(&curr, flow->packet.payload);
  flow->protos.dns.req_type = qtype;
#ifdef DEBUG_DNS
  NDPI_LOG_DBG(ndpi_struct, "DNS query type: %u", qtype);
#endif
  /* Update the offset to the new value after processing the query section */
  offset = curr;
}