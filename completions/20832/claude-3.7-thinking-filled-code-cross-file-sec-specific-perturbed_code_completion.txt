{
  /* Extract query type */
  u_int16_t query_type;
  
  /* Iterate until we find the null terminator */
  while((offset < flow->packet.payload_packet_len) && 
        (flow->packet.payload[offset] != '\0')) {
    offset++;
  }
  
  /* Skip the null terminator */
  if(offset < flow->packet.payload_packet_len)
    offset++;
  else
    return(1 /* invalid */);
  
  /* Make sure we have enough space to read the query type (2 bytes) and class (2 bytes) */
  if((offset + 4) <= flow->packet.payload_packet_len) {
    query_type = get16(&offset, flow->packet.payload); /* This advances offset by 2 */
    flow->protos.dns.query_type = query_type;
    /* NDPI_LOG_DBG(ndpi_struct, "DNS query type: %u\n", query_type); */
    offset += 2; /* Skip the class (usually IN=1) */
    return(0 /* valid */);
  } else {
    return(1 /* invalid */);
  }
}