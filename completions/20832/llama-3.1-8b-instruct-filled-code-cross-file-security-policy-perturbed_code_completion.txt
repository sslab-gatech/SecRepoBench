if(*is_query) {
  /* DNS Request */
  if((dns_header->num_queries > 0) && (dns_header->num_queries <= NDPI_MAX_DNS_REQUESTS)
     && (((dns_header->flags & 0x2800) == 0x2800 /* Dynamic DNS Update */)
	 || ((dns_header->num_answers == 0) && (dns_header->authority_rrs == 0)))) 
  {
    u_int16_t query_type;
    u_int16_t query_class;
    u_int32_t query_ttl;
    u_int16_t query_rdlength;
    u_int16_t query_type_len;
    u_int16_t query_class_len;
    u_int32_t query_ttl_len;
    u_int16_t query_rdlength_len;
    u_int16_t query_type_len_len;
    u_int16_t query_class_len_len;
    u_int32_t query_ttl_len_len;
    u_int16_t query_rdlength_len_len;
    u_int16_t query_type_len_len_len;
    u_int16_t query_class_len_len_len;
    u_int32_t query_ttl_len_len_len;
    u_int16_t query_rdlength_len_len_len;
    u_int16_t query_type_len_len_len_len;
    u_int16_t query_class_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_rdlength_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_type_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int16_t query_class_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len_len;
    u_int32_t query_ttl_len_len_len_len_len_len_len_len_le