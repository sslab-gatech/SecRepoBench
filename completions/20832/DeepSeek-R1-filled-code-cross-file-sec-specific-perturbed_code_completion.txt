u_int16_t payload_len = flow->packet.payload_packet_len;

while(offset < payload_len && flow->packet.payload[offset] != '\0') {
    offset++;
}

if(offset >= payload_len || (offset + 4) > payload_len) {
    return 1; /* invalid */
}

offset++; /* Skip null terminator */

flow->protos.dns.query_type = get16(&offset, flow->packet.payload);
/* Skip query class */
get16(&offset, flow->packet.payload);

NDPI_LOG_DBG(ndpi_struct, "DNS query type: %u\n", flow->protos.dns.query_type);