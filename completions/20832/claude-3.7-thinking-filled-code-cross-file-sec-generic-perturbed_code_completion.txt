{
  /* Extract the query type from the DNS query section */
  u_int16_t query_type;
  
  /* Skip the query name */
  while((offset < flow->packet.payload_packet_len) && 
        (flow->packet.payload[offset] != '\0')) {
    offset++;
  }
  
  if(offset < flow->packet.payload_packet_len) {
    offset++; /* Skip null terminator */
    
    /* Ensure we can read the query type (2 bytes) and class (2 bytes) */
    if((offset + 4) <= flow->packet.payload_packet_len) {
      query_type = get16(&offset, flow->packet.payload);
      flow->protos.dns.query_type = query_type;
      
      /* Skip class (2 bytes) */
      offset += 2;
      
      return(0 /* valid */);
    }
  }
  
  /* Cannot read query type, packet too short or malformed */
  return(1 /* invalid */);
}