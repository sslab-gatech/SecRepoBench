u_int16_t query_type = 0;

/* Parse the domain name until the null terminator */
while((offset < flow->packet.payload_packet_len) &&
      (flow->packet.payload[offset] != '\0')) {
  offset++;
}

/* Ensure there's enough space after the null terminator to read the type */
if((offset + 1 + 2) <= flow->packet.payload_packet_len) {
  /* Skip the null terminator */
  offset++;

  /* Read the query type (2 bytes) */
  query_type = get16(&offset, flow->packet.payload);

#ifdef DNS_DEBUG
  NDPI_LOG_DBG2(ndpi_struct, "DNS query type: %u\n", query_type);
#endif
} else {
  return(1 /* invalid */);
}