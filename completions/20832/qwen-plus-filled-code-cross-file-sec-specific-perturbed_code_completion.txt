u_int16_t query_type;

// Ensure that the offset does not exceed the payload length
if ((offset + 2) > flow->packet.payload_packet_len) {
  return(1 /* invalid */);
}

// Iterate over the payload starting from the current offset until a null character is found
while (offset < flow->packet.payload_packet_len && flow->packet.payload[offset] != '\0') {
  offset++;
}

// Check if the null character was found within bounds
if (offset >= flow->packet.payload_packet_len) {
  return(1 /* invalid */);
}

// Increment the offset to skip the null character
offset++;

// Check if there are enough bytes left for the query type
if ((offset + 2) > flow->packet.payload_packet_len) {
  return(1 /* invalid */);
}

// Read the query type
query_type = get16(&offset, flow->packet.payload);

// Optionally, log the query type for debugging purposes
NDPI_LOG_DBG(ndpi_struct, "DNS Query Type: %u\n", query_type);