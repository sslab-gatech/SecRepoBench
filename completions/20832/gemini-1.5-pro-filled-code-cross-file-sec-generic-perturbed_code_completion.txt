{
      int name_len;

      for (int i = 0; i < dns_header->num_queries; ++i) {
        if (offset >= flow->packet.payload_packet_len) {
          return 1; /* invalid */
        }

        name_len = getNameLength(offset, flow->packet.payload, flow->packet.payload_packet_len);
        if (name_len == 0 || (offset + name_len) >= flow->packet.payload_packet_len) {
          return 1; /* invalid */
        }
        offset += name_len;

        if ((offset + 4) > flow->packet.payload_packet_len) {
          return 1; /* invalid */
        }

        flow->protos.dns.query_type = get16(&offset, flow->packet.payload);

        NDPI_LOG_DBG(ndpi_struct, "DNS query type: %u\n", flow->protos.dns.query_type);

        offset += 2; // Skip class
      }
    }