if (offset >= flow->packet.payload_packet_len)
  return 1;

while (offset < flow->packet.payload_packet_len && flow->packet.payload[offset] != '\0')
  offset++;

if (offset >= flow->packet.payload_packet_len)
  return 1;

offset++; // Skip the null terminator

if (offset + 2 > flow->packet.payload_packet_len)
  return 1;

u_int16_t query_type = get16(&offset, flow->packet.payload);
NDPI_LOG_DBG(ndpi_struct, "DNS query type: %u\n", query_type);
flow->protos.dns.req_type = query_type;