{
      while (offset < flow->packet.payload_packet_len && flow->packet.payload[offset] != '\0') {
        offset++;
      }

      /* Check for offset validity before accessing payload */
      if (offset + 1 < flow->packet.payload_packet_len) {
        offset++;
      } else {
        return 1; /* invalid */
      }

      /* Check for offset validity before accessing payload with get16 */
      if (offset + 2 <= flow->packet.payload_packet_len) {
        flow->protos.dns.query_type = get16(&offset, flow->packet.payload);
      } else {
        return 1; /* invalid */
      }
    }