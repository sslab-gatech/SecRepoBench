{
        u_int queries = 0;
        while (queries < dns_header->num_queries && offset < flow->packet.payload_packet_len) {
          int name_len = getNameLength(offset, flow->packet.payload, flow->packet.payload_packet_len);

          if (name_len == 0 || (offset + name_len) > flow->packet.payload_packet_len) {
            return 1; /* invalid */
          }

          offset += name_len;

          if (offset + 4 > flow->packet.payload_packet_len) {
            return 1; /* invalid */
          }

          flow->protos.dns.query_type = get16(&offset, flow->packet.payload);

#ifdef DNS_DEBUG
          NDPI_LOG_DBG2(ndpi_struct, "query_type: %u\n", flow->protos.dns.query_type);
#endif

          offset += 2; /* Skip CLASS */
          queries++;
        }
        if (queries != dns_header->num_queries)
          return 1; /* invalid */
      }