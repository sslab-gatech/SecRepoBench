for (int q = 0; q < dns_header->num_queries; q++) {
        u_int len = getNameLength(offset, flow->packet.payload, flow->packet.payload_packet_len);
        if (len == 0 || (offset + len + 4) >= flow->packet.payload_packet_len) {
            return 1; // Invalid
        }
        offset += len;
        offset += 4; // Skip query type and class
    }