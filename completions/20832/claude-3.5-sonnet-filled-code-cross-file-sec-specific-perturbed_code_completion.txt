{
  u_int16_t query_type = 0;
  int end_offset = offset;

  while (end_offset < flow->packet.payload_packet_len && flow->packet.payload[end_offset] != '\0') {
    end_offset++;
  }

  if (end_offset < flow->packet.payload_packet_len) {
    end_offset++; // Move past the null terminator
    if (end_offset + 4 <= flow->packet.payload_packet_len) {
      query_type = ntohs(*(u_int16_t*)&flow->packet.payload[end_offset + 2]);
      // Optionally log the query type
      // NDPI_LOG_DBG(ndpi_struct, "DNS query type: %u\n", query_type);
    }
  }

  offset = end_offset + 4;
  return 0; // Valid DNS query
}