{
  /* This is a good query: we dissect it */
  int name_len;
  
  if((name_len = getNameLength(offset, flow->packet.payload, flow->packet.payload_packet_len)) > 0) {
    offset += name_len;
    
    /* Make sure we have enough bytes to read the query type (2) and class (2) */
    if((offset + 4) <= flow->packet.payload_packet_len) {
      u_int16_t query_type = get16(&offset, flow->packet.payload);
      
      flow->protos.dns.query_type = query_type;
      
#ifdef DNS_DEBUG
      NDPI_LOG_DBG2(ndpi_struct, "DNS query type: %u\n", query_type);
#endif
    }
  }
  
  return(0); /* Valid DNS query */
}