case DLT_PPP_SERIAL:
  if(header->caplen < eth_offset + 4)
    return(nproto); /* Too short for PPP serial header*/
    
  ethertype = packet[eth_offset + 2] << 8 | packet[eth_offset + 3];
  
  if(ethertype == 0x0021) // IPv4
    ethertype = ETH_P_IP;
  else if(ethertype == 0x0057) // IPv6
    ethertype = ETH_P_IPV6;
    
  ip_offset = eth_offset + 4; // PPP serial header is 4 bytes
  break;

case DLT_C_HDLC:
  if(header->caplen < eth_offset + sizeof(struct ndpi_chdlc))
    return(nproto); /* Too short for HDLC header*/
    
  chdlc = (struct ndpi_chdlc *) &packet[eth_offset];
  ethertype = ntohs(chdlc->proto_code);
  ip_offset = sizeof(struct ndpi_chdlc) + eth_offset;
  break;