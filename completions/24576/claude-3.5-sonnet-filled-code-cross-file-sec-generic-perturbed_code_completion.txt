case DLT_PPP_SERIAL:
  chdlc = (struct ndpi_chdlc *) &packet[eth_offset];
  ethertype = ntohs(chdlc->proto_code);
  ip_offset = sizeof(struct ndpi_chdlc); /* CHDLC header*/
  break;

case DLT_C_HDLC:
  chdlc = (struct ndpi_chdlc *) &packet[eth_offset];
  ethertype = ntohs(chdlc->proto_code);
  ip_offset = sizeof(struct ndpi_chdlc); /* CHDLC header*/
  break;

case DLT_PPP:
  if(packet[0] == 0x0f || packet[0] == 0x8f) {
    ip_offset = 2; /* PPP header */
    ethertype = ETH_P_IP;
  } else {
    /* PPP header, then HDLC header */
    chdlc = (struct ndpi_chdlc *) &packet[1];
    ethertype = ntohs(chdlc->proto_code);
    ip_offset = 3; /* PPP header + HDLC header */
  }
  break;