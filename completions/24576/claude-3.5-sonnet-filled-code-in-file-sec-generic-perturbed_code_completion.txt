case DLT_PPP_SERIAL:
  chdlc = (struct ndpi_chdlc *) &packet[eth_offset];
  ethertype = ntohs(chdlc->proto_code);
  ip_offset = sizeof(struct ndpi_chdlc); // CHDLC header
  break;

case DLT_C_HDLC:
  chdlc = (struct ndpi_chdlc *) &packet[eth_offset];
  ethertype = ntohs(chdlc->proto_code);
  ip_offset = sizeof(struct ndpi_chdlc); // CHDLC header
  break;

case DLT_PPP:
  if(packet[0] == 0x0f || packet[0] == 0x8f) {
    // PPP HDLC
    ethertype = ((uint16_t)packet[2] << 8) | packet[3];
    ip_offset = 4;
  } else {
    // Raw PPP
    ethertype = ((uint16_t)packet[0] << 8) | packet[1];
    ip_offset = 2;
  }
  break;