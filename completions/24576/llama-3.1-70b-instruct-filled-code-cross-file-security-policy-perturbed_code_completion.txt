case DLT_C_HDLC:
  chdlc = (struct ndpi_chdlc *) &packet[eth_offset];
  if(chdlc->address == 0 && chdlc->control == 0x0F) {
    ip_offset = 4 + eth_offset;
    ethertype = ETH_P_IP;
  } else {
    ip_offset = 4 + eth_offset;
    ethertype = ETH_P_IPV6;
  }
  break;

case DLT_PPP_SERIAL:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_PPP_ETHER:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IPV6;
  break;

case DLT_FRELAY:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_RAW:
  ip_offset = eth_offset = 0;
  break;

case DLT_LOOP:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_NULL:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IPV6;
  break;

case DLT_PPP:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_C_HDLC:
  chdlc = (struct ndpi_chdlc *) &packet[eth_offset];
  if(chdlc->address == 0 && chdlc->control == 0x0F) {
    ip_offset = 4 + eth_offset;
    ethertype = ETH_P_IP;
  } else {
    ip_offset = 4 + eth_offset;
    ethertype = ETH_P_IPV6;
  }
  break;

case DLT_IEEE802:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_ARCNET:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_SLIP:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_PPP_HDLC:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_ATM_CLIP:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_REDBACK_SMARTBRIDGE:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_IP_OVER_FC:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_SUNATM:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_RIO:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_PCI_EXP:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_XIAOLIN:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_LAPD:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_MATCHING_HEXA:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_RAWAF_LINK:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_LINUX_IRDA:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_LINUX_LAPD:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_BLUETOOTH_HCI_H4:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_BLUETOOTH_HCI_H4_WITH_PHDR:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_USB:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_IEEE802_11_RADIO:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_PRISM_HEADER:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_AIRONET_HEADER:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_HHDLC:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_IPMB:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_IEEE802_11_RADIO_AVS:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_MLPPP:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_MLFR:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_ES:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_GGSN:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_MFR:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_ATM2:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_PPPOE:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_GCOM_TIE1:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_GCOM_FDDI:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_GCOM_X25:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_LINUX_SLL2:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_RFC_1483:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_CSMA_ER:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_ATM1:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_NETANALYZER:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_NETANALYZER_TRANSPARENT:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_IPOIB:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_MPEG_2_TS:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_PPI:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_ERF:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_BLUETOOTH_HCI_H4_WITH_PHDR_NO_CRC:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_AX25_KISS:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_LAPD_WITH_DIR:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_C_HDLC_WITH_DIR:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_FRELAY_WITH_DIR:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_IPMB_LINUX:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_IEEE802_11_RADIO_AVS:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_VP:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_USB_LINUX:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_MTP2_WITH_PHDR:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_MTP2:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_MTP3:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_SCCP:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_DOCSIS:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_LINUX_IRDA:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_IBM_SN:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_K12:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_ETHER:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_PPP:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_FRELAY:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_CHDLC:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_MLPPP:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_MLFR:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_ES:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_GGSN:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_MFR:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_ATM2:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_PPPOE:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_GCOM_TIE1:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_GCOM_FDDI:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_GCOM_X25:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_LINUX_SLL2:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_RFC_1483:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_CSMA_ER:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_JUNIPER_ATM1:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_NETANALYZER:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_NETANALYZER_TRANSPARENT:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_IPOIB:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_MPEG_2_TS:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_PPI:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_ERF:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_BLUETOOTH_HCI_H4_WITH_PHDR_NO_CRC:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_AX25_KISS:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_LAPD_WITH_DIR:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case DLT_C_HDLC_WITH_DIR:
  ip_offset = 4 + eth_offset;
  ethertype = ETH_P_IP;
  break;

case