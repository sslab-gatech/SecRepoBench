case DLT_C_HDLC:
    chdlc = (struct ndpi_chdlc *) &packet[eth_offset];
    if(ntohs(chdlc->protocol) == PPP_IP_PROTO)
      ethertype = ETH_P_IP;
    else if(ntohs(chdlc->protocol) == PPP_IPV6_PROTO)
      ethertype = ETH_P_IPV6;
    ip_offset = sizeof(struct ndpi_chdlc) + eth_offset;
    break;

  case DLT_PPP_SERIAL:
    if(header->caplen < eth_offset + 2)
      return(nproto); /* Too short for PPP header */
    
    u_int16_t ppp_proto = (((u_int16_t)packet[eth_offset]) << 8) | packet[eth_offset+1];
    if(ppp_proto == PPP_IP_PROTO)
      ethertype = ETH_P_IP;
    else if(ppp_proto == PPP_IPV6_PROTO)
      ethertype = ETH_P_IPV6;
    else
      return(nproto); /* Unsupported PPP protocol */

    ip_offset = 2 + eth_offset;
    break;