case DLT_C_HDLC:            // Cisco PPP Serial
    chdlc = (struct ndpi_chdlc *) &packet[eth_offset];
    if (chdlc->address != 0xff || chdlc->control != 0x03)
        return nproto;

    ip_offset = CHDLC_HEADER_LEN + eth_offset;
    ethertype = (packet[ip_offset] << 8) | packet[ip_offset + 1];
    ip_offset += 2;
    break;

  case DLT_PPP_SERIAL:       // PPP over serial
    ip_offset = 4 + eth_offset;
    ethertype = (packet[eth_offset] << 8) | packet[eth_offset + 1];

    if (ethertype == 0x0021) { // HDLC address and control field
        if (packet[eth_offset + 2] != 0xff || packet[eth_offset + 3] != 0x03)
            return nproto;
        ethertype = (packet[ip_offset] << 8) | packet[ip_offset + 1];
        ip_offset += 2;
    }
    break;

    case DLT_PPP_ETHER:      // PPPoE
        ip_offset = 2 + eth_offset;
        ethertype = (packet[eth_offset] << 8) | packet[eth_offset + 1];
        break;