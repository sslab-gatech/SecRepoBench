case DLT_CHDLC: {
  chdlc = (struct ndpi_chdlc *)&packet[eth_offset];
  check = ntohs(chdlc->proto);

  /* Determine if it's IPv4 or IPv6 based on the protocol field. */
  switch(check) {
  case HDLC_IP:   /* 0x0021 */
    ethertype = ETH_P_IP;
    break;
  case HDLC_IPV6: /* 0x0057 */
    ethertype = ETH_P_IPV6;
    break;
  default:
    /* If it's neither IPv4 nor IPv6, discard. */
    goto v4_warning;
  }

  /* Set the IP header offset after the HDLC header. */
  ip_offset = eth_offset + sizeof(struct ndpi_chdlc);
}
break;