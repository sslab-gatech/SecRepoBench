// Initialize a character array to store the colorspace name from the input string.
// Define a boolean variable to indicate if the color is an ICC profile color.
char colorspace[MagickPathExtent];
bool icc_color = MagickFalse;

// Copy the input color name into the colorspace array for parsing.
(void) CopyMagickString(colorspace, color_name + i + 1, MagickPathExtent);

// Identify and isolate the colorspace name by finding the first occurrence of an opening parenthesis and terminate the string there.
size_t j = 0;
while (colorspace[j] != '\0' && colorspace[j] != '(') {
    j++;
}
if (colorspace[j] == '(') {
    colorspace[j] = '\0';
}

// Update the color_name pointer to point to the remaining part of the string after the colorspace name.
color_name += i + 1 + j;

// Initialize scale and set icc_color to MagickFalse
scale = (double) ScaleCharToQuantum(1);
icc_color = MagickFalse;

// Check if the colorspace is an ICC profile color
if (LocaleNCompare(colorspace, "device-", 7) == 0) {
    scale = (double) QuantumRange;
    icc_color = MagickTrue;
}
if (LocaleCompare(colorspace, "icc-color") == 0) {
    size_t k = 0;
    while (colorspace[k] != '\0' && colorspace[k] != ',') {
        k++;
    }
    if (colorspace[k] == ',') {
        colorspace[k] = '\0';
    }
    scale = (double) QuantumRange;
    icc_color = MagickTrue;
}

// Convert the colorspace name to lowercase
LocaleLower(colorspace);

// Set the alpha trait based on the presence of 'a' in the colorspace name
color->alpha_trait = UndefinedPixelTrait;
if ((i > 0) && (colorspace[i] == 'a')) {
    colorspace[i] = '\0';
    color->alpha_trait = BlendPixelTrait;
}

// Parse the colorspace type
type = ParseCommandOption(MagickColorspaceOptions, MagickFalse, colorspace);
if (type < 0) {
    (void) ThrowMagickException(exception, GetMagickModule(), OptionWarning, "UnrecognizedColor", "`%s'", color_name);
    return (MagickFalse);
}
color->colorspace = (ColorspaceType) type;

// Adjust the colorspace and depth if necessary
if ((icc_color == MagickFalse) && (color->colorspace == RGBColorspace)) {
    color->colorspace = sRGBColorspace;  /* as required by SVG standard */
    color->depth = 8;
}