TRACE_SERIALIZE (this);

    unsigned int axis_count = src->axis_count;
    unsigned int region_count = regionmapping.get_population ();

    if (unlikely (!hb_serialize_alloc (c, sizeof (VarRegionList) +
                                      region_count * sizeof (VarRegion) +
                                      region_count * axis_count * sizeof (float)))) return false;

    hb_serialize_write_uint16 (c, axis_count);
    hb_serialize_write_uint16 (c, region_count);

    VarRegion *regions = (VarRegion *) hb_serialize_get_ptr (c, region_count * sizeof (VarRegion));
    float *coords = (float *) hb_serialize_get_ptr (c, region_count * axis_count * sizeof (float));

    if (unlikely (!regions || !coords)) return false;

    unsigned int region_index = 0;
    for (hb_codepoint_t glyph_id : regionmapping)
    {
      unsigned int source_region_index = src->find_region_index (glyph_id);
      if (source_region_index == VarRegionList::NOT_FOUND)
      {
        // If the glyph id is not found in the source, set the region to NULL.
        regions[region_index].set_null ();
      }
      else
      {
        regions[region_index].axis_count = axis_count;
        regions[region_index].coords = coords + region_index * axis_count;
        for (unsigned int axis_index = 0; axis_index < axis_count; axis_index++)
        {
          regions[region_index].coords[axis_index] = src->regions[source_region_index].coords[axis_index];
        }
      }
      region_index++;
    }

    hb_serialize_add_ptr (c, regions, region_count * sizeof (VarRegion));
    hb_serialize_add_ptr (c, coords, region_count * axis_count * sizeof (float));

    return true;