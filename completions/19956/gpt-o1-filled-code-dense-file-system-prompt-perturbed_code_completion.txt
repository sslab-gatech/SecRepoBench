TRACE_SERIALIZE (this);
  if (unlikely (!c->extend_min (*this)))
    return_trace (false);

  // Determine how many regions we need to serialize using the mapping.
  unsigned int mapped_count = regionmapping.get_population ();
  unsigned int axis_count = src->axisCount;

  // Calculate the size needed for VarRegionList plus all region axis data.
  // (Exact size calculation depends on layout of VarRegionList in this codebase.)
  unsigned int size = sizeof (*this)
                    + (mapped_count * axis_count * sizeof (src->regions[0].axisData[0]))
                    - sizeof (this->regions);

  // Allocate space for the destination VarRegionList.
  VarRegionList *dest = c->allocate_size<VarRegionList> (size);
  if (unlikely (!dest))
    return_trace (false);

  // Set basic fields.
  dest->axisCount = axis_count;
  dest->regionCount = mapped_count;

  // Copy each region in the order determined by regionmapping.
  for (unsigned int i = 0; i < mapped_count; i++)
  {
    unsigned int old_index = regionmapping.backward (i);
    for (unsigned int j = 0; j < axis_count; j++)
      dest->regions[i].axisData[j] = src->regions[old_index].axisData[j];
  }

  return_trace (true);