{
  u_int16_t realm_offset = body_offset;
  u_int8_t realm_len;
  /* Advance to find the ASN.1 identifier for the realm (0x1B) */
  while (realm_offset < packet->payload_packet_len && packet->payload[realm_offset] != 0x1b)
    realm_offset++;

  if (realm_offset < packet->payload_packet_len && (realm_offset + 1) < packet->payload_packet_len) {
    realm_len = packet->payload[realm_offset + 1];
    /* Check that the realm length is within bounds */
    if (realm_len > 0 && (realm_offset + 2 + realm_len) <= packet->payload_packet_len) {
      char realm_str[48];
      u_int16_t j;
      if (realm_len >= sizeof(realm_str))
        realm_len = sizeof(realm_str) - 1;
      memcpy(realm_str, &packet->payload[realm_offset + 2], realm_len);
      realm_str[realm_len] = '\0';
      for (j = 0; j < realm_len; j++)
        realm_str[j] = tolower((unsigned char) realm_str[j]);
#ifdef KERBEROS_DEBUG
      printf("[Kerberos] [TGS-REQ][Realm: %s]\n", realm_str);
#endif
      snprintf(flow->protos.kerberos.domain, sizeof(flow->protos.kerberos.domain), "%s", realm_str);
    }
  }
}