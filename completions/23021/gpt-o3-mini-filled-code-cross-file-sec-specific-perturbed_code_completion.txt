{
  u_int16_t name_offset = body_offset;
  u_int16_t i;
  /* Search for the ASN.1 identifier (0x1b) indicating the start of the realm */
  while(name_offset < packet->payload_packet_len && packet->payload[name_offset] != 0x1b)
    name_offset++;
  if(name_offset + 1 < packet->payload_packet_len) {
    u_int8_t realm_len = packet->payload[name_offset + 1];
    if(name_offset + 2 + realm_len <= packet->payload_packet_len) {
      char realm_str[48];
      if(realm_len > sizeof(realm_str) - 1)
        realm_len = sizeof(realm_str) - 1;
      memcpy(realm_str, &packet->payload[name_offset + 2], realm_len);
      realm_str[realm_len] = '\0';
      for(i = 0; i < realm_len; i++)
        realm_str[i] = tolower(realm_str[i]);
      snprintf(flow->protos.kerberos.domain, sizeof(flow->protos.kerberos.domain), "%s", realm_str);
    }
  }
  if(flow->kerberos_buf.pktbuf != NULL) {
    ndpi_free(flow->kerberos_buf.pktbuf);
    packet->payload = original_packet_payload;
    packet->payload_packet_len = original_payload_packet_len;
    flow->kerberos_buf.pktbuf = NULL;
  }
}