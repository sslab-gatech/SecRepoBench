if(body_offset < packet->payload_packet_len) {
  u_int16_t name_offset = body_offset + 13, i;

  /* Locate the ASN.1 identifier (0x1b) that marks the start of the name field */
  for(i = 0; (i < 20) && (name_offset < packet->payload_packet_len); i++) {
    if(packet->payload[name_offset] != 0x1b)
      name_offset++;
    else
      break;
  }

  /* If we found the name field, proceed to parse it */
  if(name_offset < packet->payload_packet_len) {
    char cname_str[48];
    u_int8_t cname_len = packet->payload[++name_offset];

    if((name_offset + cname_len) < packet->payload_packet_len) {
      if(cname_len > sizeof(cname_str) - 1)
        cname_len = sizeof(cname_str) - 1;

      strncpy(cname_str, (char*)&packet->payload[name_offset + 1], cname_len);
      cname_str[cname_len] = '\0';

      /* Convert to lowercase */
      for(i = 0; i < cname_len; i++)
        cname_str[i] = tolower(cname_str[i]);

#ifdef KERBEROS_DEBUG
      printf("[TGS-REQ][Kerberos Cname][len: %u][%s]\n", cname_len, cname_str);
#endif

      /* If the cname ends with '$', treat it as a hostname; otherwise as a username */
      if(cname_len && cname_str[cname_len - 1] == '$') {
        cname_str[cname_len - 1] = '\0';
        snprintf(flow->protos.kerberos.hostname, sizeof(flow->protos.kerberos.hostname), "%s", cname_str);
      } else {
        snprintf(flow->protos.kerberos.username, sizeof(flow->protos.kerberos.username), "%s", cname_str);
      }

      /* Advance to find realm ASN.1 identifier */
      {
        u_int16_t realm_offset = name_offset + 1 + cname_len;

        for(i = 0; (i < 14) && (realm_offset < packet->payload_packet_len); i++) {
          if(packet->payload[realm_offset] != 0x1b)
            realm_offset++;
          else
            break;
        }

        if(realm_offset < packet->payload_packet_len) {
          realm_offset++;
          if(realm_offset < packet->payload_packet_len) {
            u_int8_t realm_len = packet->payload[realm_offset];

            if((realm_offset + realm_len) < packet->payload_packet_len) {
              char realm_str[48];
              if(realm_len > sizeof(realm_str) - 1)
                realm_len = sizeof(realm_str) - 1;

              realm_offset++;
              strncpy(realm_str, (char*)&packet->payload[realm_offset], realm_len);
              realm_str[realm_len] = '\0';

              /* Convert realm to lowercase */
              for(i = 0; i < realm_len; i++)
                realm_str[i] = tolower(realm_str[i]);

#ifdef KERBEROS_DEBUG
              printf("[TGS-REQ][Kerberos Realm][len: %u][%s]\n", realm_len, realm_str);
#endif

              snprintf(flow->protos.kerberos.domain, sizeof(flow->protos.kerberos.domain), "%s", realm_str);
            }
          }
        }
      }
    }
  }
}