{
  u_int16_t realm_offset = body_offset;
  u_int8_t realm_len = 0;
  int j;

  /* Skip over padding bytes until we find the ASN.1 tag for a GeneralString (0x1b) */
  for (j = 0; j < 14 && realm_offset < packet->payload_packet_len; j++) {
    if (packet->payload[realm_offset] == 0x1b)
      break;
    realm_offset++;
  }

  if (realm_offset < packet->payload_packet_len) {
    realm_offset++; /* Skip the tag byte */
    if (realm_offset < packet->payload_packet_len) {
      realm_len = packet->payload[realm_offset];
      realm_offset++; /* Move to the realm string */
      if ((realm_offset + realm_len) <= packet->payload_packet_len) {
        char realm_str[48];
        if (realm_len > sizeof(realm_str) - 1)
          realm_len = sizeof(realm_str) - 1;
        memcpy(realm_str, &packet->payload[realm_offset], realm_len);
        realm_str[realm_len] = '\0';
        for (j = 0; j < realm_len; j++)
          realm_str[j] = tolower(realm_str[j]);
#ifdef KERBEROS_DEBUG
        printf("[Kerberos][TGS-REQ] Extracted Realm: %s\n", realm_str);
#endif
        snprintf(flow->protos.kerberos.domain, sizeof(flow->protos.kerberos.domain), "%s", realm_str);
      }
    }
  }
}