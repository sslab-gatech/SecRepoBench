if (uc >= endptr)
    goto out;
switch (*uc++) {
case '"':
case '\\':
case '/':
case 'b':
case 'f':
case 'n':
case 'r':
case 't':
    break;
case 'u':
    if (uc + 4 > endptr)
        goto out;
    for (i = 0; i < 4; i++) {
        unsigned char c = uc[i];
        if (!((c >= '0' && c <= '9') || 
              (c >= 'a' && c <= 'f') || 
              (c >= 'A' && c <= 'F'))) {
            goto out;
        }
    }
    uc += 4;
    break;
default:
    goto out;
}