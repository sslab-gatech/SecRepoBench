{
    if (uc >= endptr)
        goto out;
    switch (*uc++) {
    case '"':
    case '\\':
    case '/':
        /* Valid one-character escapes: " \\ / */
        break;
    case 'b':
    case 'f':
    case 'n':
    case 'r':
    case 't':
        /* Valid single-character escapes: \b \f \n \r \t */
        break;
    case 'u':
        /* \u followed by 4 hex digits */
        if (uc + 4 > endptr)
            goto out;
        for (i = 0; i < 4; i++) {
            if (!isxdigit((unsigned char)uc[i]))
                goto out;
        }
        uc += 4;
        break;
    default:
        /* Invalid escape sequence */
        goto out;
    }
    break;
}