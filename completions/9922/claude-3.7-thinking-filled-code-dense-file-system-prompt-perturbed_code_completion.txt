if (uc >= endptr) {
    goto out;  // Unexpected end of data
}

switch (*uc) {
case '\\':
case '"':
case '/':
case 'b':
case 'f':
case 'n':
case 'r':
case 't':
    uc++;  // These escape sequences are valid, just skip over them
    break;
case 'u':
    uc++;  // Skip 'u'
    
    // Check for 4 hexadecimal digits
    for (i = 0; i < 4; i++) {
        if (uc >= endptr) {
            goto out;  // Unexpected end of data
        }
        
        unsigned char c = *uc;
        if (!((c >= '0' && c <= '9') || 
              (c >= 'a' && c <= 'f') || 
              (c >= 'A' && c <= 'F'))) {
            goto out;  // Invalid unicode escape sequence
        }
        uc++;
    }
    break;
default:
    goto out;  // Invalid escape sequence
}