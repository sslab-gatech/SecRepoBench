int32_t ntbytes = 0;
  bool memcpyed = ((uint8_t)context->header_flags & (uint8_t)BLOSC_MEMCPYED) != 0;
  if (!context->do_compress && context->special_type) {
    /* Treat chunk as memcpyed if it is special */
    memcpyed = true;
  }

  /* Calculate stop index (exclusive end) */
  int32_t stop = start + nitems;

  /* Early return if no items to process */
  if (nitems <= 0) {
    return 0;
  }

  /* Clamp start/stop within the range of total items */
  int32_t max_items = (int32_t)(hdr->nbytes / hdr->typesize);
  if (start < 0) {
    start = 0;
  }
  if (start >= max_items) {
    return 0;
  }
  if (stop > max_items) {
    stop = max_items;
  }

  /* Recompute nitems after clamping */
  nitems = stop - start;
  if (nitems <= 0) {
    return 0;
  }

  /* Validate the destination buffer size */
  if (destsize < nitems * hdr->typesize) {
    return BLOSC2_ERROR_WRITE_BUFFER;
  }