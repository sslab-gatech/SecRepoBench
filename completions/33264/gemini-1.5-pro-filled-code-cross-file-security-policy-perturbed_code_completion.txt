int32_t ntbytes = 0;                /* current pos for dest buffer */
  int32_t tbytes;                   /* total bytes to get */
  int32_t ebsize;                   /* extended block size */
  int j, bsize, bsize2, leftoverblock;
  int startb, stopb;
  bool memcpyed = hdr->flags & BLOSC_MEMCPYED;
  int stop = start + nitems;

  if (nitems == 0) {
    return 0;
  }

  tbytes = nitems * hdr->typesize;
  if (destsize < tbytes) {
    BLOSC_TRACE_ERROR("Destination buffer size is too small (%d < %d)", destsize, tbytes);
    return BLOSC2_ERROR_OUTPUT_BUFFER_TOO_SMALL;
  }

  if (start < 0 || stop > context->nitems) {
    BLOSC_TRACE_ERROR("Start or stop out of range");
    return BLOSC2_ERROR_INVALID_PARAM;
  }

  if (memcpyed || context->special_type) {
    if (hdr->blocksize == hdr->typesize) {
      /* This is clearly a memcpyed or special case.  Just
         copy the buffer directly. */
      memcpy(dest, _src + start * hdr->typesize, (unsigned int)tbytes);
      return tbytes;
    }
  }