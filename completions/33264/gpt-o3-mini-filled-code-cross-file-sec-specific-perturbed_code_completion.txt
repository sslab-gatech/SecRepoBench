/* Early exit if no items are requested */
  if (nitems <= 0) {
    return 0;
  }

  /* Calculate the ending item index */
  int stop = start + nitems;

  /* Validate that the destination buffer is large enough for the decompressed data.
     Each item occupies hdr->typesize bytes. */
  if (destsize < nitems * hdr->typesize) {
    return BLOSC2_ERROR_DEST_SMALL;
  }

  /* Verify that the start and stop positions (in bytes) fall within the uncompressed data.
     Assuming hdr->nbytes is the total uncompressed data size in bytes. */
  if (start < 0 || (stop * hdr->typesize) > hdr->nbytes) {
    return BLOSC2_ERROR_ITEM_OUT_OF_RANGE;
  }

  /* Initialize the counter for the number of uncompressed bytes written */
  int ntbytes = 0;