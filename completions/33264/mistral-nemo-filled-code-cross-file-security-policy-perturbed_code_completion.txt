// Validate that the destination buffer is large enough for the decompressed data.
  if (ntbytes > destsize) {
    BLOSC_ERROR(BLOSC2_ERROR_DEST_BUFFER_TOO_SMALL, "Destination buffer too small");
    return -1;
  }

  // Set up block start positions based on the source buffer and context.
  int32_t* bstarts = context->bstarts;
  for (j = 0; j < context->nblocks; j++) {
    if (context->do_compress && !memcpyed && !dict_training) {
      _sw32(bstarts + j, ntbytes);
    }
    // ... rest of the code ...
  }