int32_t ntbytes = 0;             /* Number of uncompressed bytes */
  int32_t bsize, bsize2, leftoverblock;
  int32_t j, ebsize, startb, stopb;
  int stop = start + nitems;
  bool memcpyed = (hdr->flags & BLOSC_MEMCPYED) || context->special_type;

  if (nitems == 0) {
    return 0;                  /* nothing to do */
  }

  if ((int32_t)(nitems * hdr->typesize) > destsize) {
    return BLOSC2_ERROR_WRITE_BUFFER;
  }

  if (!memcpyed) {
    context->bstarts = (int32_t *) (_src + context->header_overhead);
  }

  if ((start < 0) || (start * hdr->typesize > hdr->nbytes)) {
    return BLOSC2_ERROR_INVALID_PARAM;
  }
  if ((stop < 0) || (stop * hdr->typesize > hdr->nbytes)) {
    return BLOSC2_ERROR_INVALID_PARAM;
  }

  blosc2_calculate_blocks(context);