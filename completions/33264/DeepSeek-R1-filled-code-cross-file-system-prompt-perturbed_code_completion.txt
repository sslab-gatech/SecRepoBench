int32_t stop, ntbytes = 0;
bool memcpyed;
int32_t typesize = hdr->typesize;

if (nitems <= 0) {
    return 0;
}

if (destsize < (nitems * typesize)) {
    return BLOSC2_ERROR_WRITE_BUFFER;
}

int32_t n_elements = (hdr->nbytes) / typesize;
if (start < 0 || start >= n_elements) {
    return BLOSC2_ERROR_INVALID_PARAM;
}

stop = start + nitems;
if (stop > n_elements) {
    stop = n_elements;
    nitems = stop - start;
    if (nitems <= 0) {
        return 0;
    }
}

memcpyed = (hdr->flags & BLOSC_MEMCPYED) || context->special_type;