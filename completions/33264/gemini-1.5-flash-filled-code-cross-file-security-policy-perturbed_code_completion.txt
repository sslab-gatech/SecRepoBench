int32_t j, bsize, bsize2, ebsize, ntbytes = 0;
  int32_t startb, stopb;
  int32_t leftoverblock;
  int32_t stop = start + nitems;
  bool memcpyed = hdr->flags & (uint8_t)BLOSC_MEMCPYED;
  if (nitems <= 0) {
    return 0;
  }
  if (destsize < (size_t)nitems * hdr->typesize) {
    return BLOSC2_ERROR_DEST_BUFFER_TOO_SMALL;
  }
  uint8_t* _dest = (uint8_t*)dest;
  if (context->nthreads > 1) {
    /* Parallel mode */
    context->output_bytes = 0;
    context->end_threads = 0;
    ntbytes = parallel_blosc(context);
  }
  else {
    /* Serial mode */
    ntbytes = serial_blosc(context->serial_context);
  }