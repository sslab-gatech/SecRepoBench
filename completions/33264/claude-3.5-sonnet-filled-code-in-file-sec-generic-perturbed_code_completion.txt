uint8_t* _src = (uint8_t*)src;
int32_t bsize = hdr->blocksize;
int32_t leftoverblock = 0;
int32_t ntbytes = 0;
int32_t j = 0;
int32_t startb = (start * hdr->typesize) % bsize;
int32_t stopb = stop * hdr->typesize;
int32_t nblocks = context->nblocks;
int32_t leftover = context->leftover;
int32_t ebsize = bsize + hdr->typesize * (signed)sizeof(int32_t);

if (nitems == 0) {
  return 0;
}

if (nitems * hdr->typesize > destsize) {
  return BLOSC2_ERROR_WRITE_BUFFER;
}

if (start >= context->sourcesize / hdr->typesize ||
    stop > context->sourcesize / hdr->typesize) {
  return BLOSC2_ERROR_INVALID_PARAM;
}

bool memcpyed = (context->header_flags & (uint8_t)BLOSC_MEMCPYED) &&
                (context->blosc2_flags == 0);

if (memcpyed) {
  if (hdr->nbytes + context->header_overhead != hdr->cbytes) {
    return BLOSC2_ERROR_CORRUPT_CHUNK;
  }
  if (hdr->blocksize < (int32_t)sizeof(int64_t)) {
    return BLOSC2_ERROR_CORRUPT_CHUNK;
  }
}