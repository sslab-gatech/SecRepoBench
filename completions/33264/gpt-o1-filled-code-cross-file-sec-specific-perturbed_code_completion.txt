int32_t ntbytes = 0;
int32_t stop = start + nitems;

/* Check if there are no items to process */
if (nitems <= 0) {
  return 0;
}

/* Validate that 'dest' is large enough */
if ((int64_t)nitems * hdr->typesize > destsize) {
  return BLOSC2_ERROR_INVALID_PARAM;
}

/* Verify that the start and stop positions are within valid bounds */
int64_t total_items = (int64_t)hdr->nbytes / hdr->typesize;
if (start < 0) {
  start = 0;
}
if (stop > total_items) {
  stop = (int32_t)total_items;
}
if (start >= stop) {
  return 0;
}

/* Determine if the data is memcpyed based on header flags or context type */
bool memcpyed = ((context->header_flags & BLOSC_MEMCPYED) != 0);
if (!context->do_compress && context->special_type) {
  memcpyed = true;
}