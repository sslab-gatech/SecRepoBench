int32_t j, bsize, leftoverblock, startb, stopb, bsize2;
  int32_t ntbytes = 0;                    /* number of uncompressed bytes */
  int32_t ebsize;
  bool memcpyed = (hdr->flags & (uint8_t)BLOSC_MEMCPYED);
  int32_t start_ = start;
  int32_t stop = start + nitems;

  if (nitems <= 0) {
    return 0;
  }

  if (destsize < nitems * hdr->typesize) {
    return BLOSC2_ERROR_WRITE_BUFFER;
  }

  /* Compute start & stop for the whole chunk */
  int32_t start_block = start_ / context->blocksize;
  int32_t stop_block = (stop + context->blocksize - 1) / context->blocksize;
  if (stop_block > context->nblocks) {
    stop_block = context->nblocks;
  }

  /* Check that start and stop are within valid bounds */
  if (start_block < 0 || stop_block > context->nblocks) {
    return BLOSC2_ERROR_INVALID_PARAM;
  }