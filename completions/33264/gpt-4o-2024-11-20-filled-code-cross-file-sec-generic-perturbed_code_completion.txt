// Validate input parameters
  if (start < 0 || nitems <= 0 || dest == NULL || destsize <= 0) {
    return BLOSC2_ERROR_INVALID_PARAM;
  }

  // Calculate the stop position
  int stop = start + nitems;
  if (stop > hdr->nitems) {
    return BLOSC2_ERROR_OUT_OF_BOUNDS;
  }

  // Ensure the destination buffer is large enough
  if (destsize < nitems * hdr->typesize) {
    return BLOSC2_ERROR_MEMORY_ALLOC;
  }

  // Check if the data is memcpyed
  bool memcpyed = (hdr->flags & BLOSC_MEMCPYED) != 0;

  // Initialize variables for tracking decompression
  int32_t ntbytes = 0;  // Total number of bytes decompressed
  int32_t ebsize;       // Effective block size
  int32_t startb, stopb, bsize2;  // Block-specific start, stop, and size
  int32_t j, bsize, leftoverblock;

  // Ensure the start and stop positions are within valid bounds
  if (start < 0 || stop > hdr->nitems) {
    return BLOSC2_ERROR_OUT_OF_BOUNDS;
  }