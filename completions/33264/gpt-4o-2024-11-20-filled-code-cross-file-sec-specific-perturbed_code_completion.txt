// Validate input parameters to prevent potential overflows or invalid memory access
  if (start < 0 || nitems <= 0 || dest == NULL || src == NULL || hdr == NULL || context == NULL) {
    return BLOSC2_ERROR_INVALID_PARAM;
  }

  // Calculate the total number of bytes to be decompressed
  int32_t stop = start + nitems;
  int32_t total_bytes = nitems * hdr->typesize;

  // Ensure the destination buffer is large enough to hold the decompressed data
  if (destsize < total_bytes) {
    return BLOSC2_ERROR_WRITE_BUFFER;
  }

  // Check that the start and stop positions are within the valid range
  if (start * hdr->typesize >= srcsize || stop * hdr->typesize > srcsize) {
    return BLOSC2_ERROR_INVALID_PARAM;
  }

  // Determine if the data is memcpyed (no compression) based on the header flags
  bool memcpyed = hdr->flags & BLOSC_MEMCPYED;

  // Initialize variables for tracking decompression progress
  int32_t ntbytes = 0;  // Number of bytes written to the destination buffer
  int32_t ebsize;       // Effective block size
  int32_t startb, stopb, bsize2;