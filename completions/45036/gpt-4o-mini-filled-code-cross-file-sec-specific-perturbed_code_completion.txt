case ETH_P_MPLS_UNI:
    case ETH_P_MPLS_MCAST:
      {
        u_int32_t label;
        int label_count = 0;

        while ((ip_offset + 4) <= header->caplen) {
          label = ntohl(*(u_int32_t *)&packet[ip_offset]);
          ip_offset += 4;
          label_count++;

          // Update MPLS packet count
          network_flow->stats.mpls_count++;

          // Check if we have reached the last label
          if ((label & 0x00000001) == 0) {
            break; // Last label
          }
        }

        // Set the packet type to IP and adjust the IP offset past the MPLS header
        type = ETH_P_IP;
        ip_offset += 4; // Adjust for the last label
        recheck_type = 1; // Indicate that we need to recheck the packet type
      }
      break;