case ETH_P_MPLS_UNI:
case ETH_P_MPLS_MULTI:
  // Handle MPLS (Multiprotocol Label Switching) packets with multiple labels.
  // - Extract and convert MPLS labels from network to host byte order.
  // - Update the MPLS packet count in the workflow statistics.
  // - Set the packet type to IP and adjust the IP offset past the MPLS header.
  // - Iterate through MPLS labels, adjusting the IP offset until the last label is found.
  // - Set a flag to indicate that the packet type should be rechecked.
  mpls.u32 = 0;
  while (((bpf_u_int32)ip_offset + sizeof(struct ndpi_mpls_header)) < header->caplen) {
    mpls.mpls.label = (packet[ip_offset] << 12) + ((packet[ip_offset + 1] & 0xF0) << 4);
    network_flow->stats.mpls_count++;
    type = ETH_P_IP;
    ip_offset += sizeof(struct ndpi_mpls_header);
    if ((packet[ip_offset - 1] & 0x01) == 0) {
      // Last MPLS label
      break;
    }
  }
  recheck_type = 1;
  break;