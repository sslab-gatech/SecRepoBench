case ETH_P_MPLS_UNI:
case ETH_P_MPLS_MULTI:
  // Handle MPLS (Multiprotocol Label Switching) packets with multiple labels.
  // - Extract and convert MPLS labels from network to host byte order.
  // - Update the MPLS packet count in the workflow statistics.
  // - Set the packet type to IP and adjust the IP offset past the MPLS header.
  // - Iterate through MPLS labels, adjusting the IP offset until the last label is found.
  // - Set a flag to indicate that the packet type should be rechecked.
  if(header->caplen < ip_offset + sizeof(struct ndpi_mpls_header))
    return(nproto); /* Too short for MPLS header */

  mpls.u32 = ntohl(*((u_int32_t*)&packet[ip_offset]));
  ip_offset += sizeof(struct ndpi_mpls_header);

  while(mpls.u32!= 0) {
    if(header->caplen < ip_offset + sizeof(struct ndpi_mpls_header))
      return(nproto); /* Too short for MPLS header */

    mpls.mpls.label = ntohl(*((u_int32_t*)&packet[ip_offset]));
    ip_offset += sizeof(struct ndpi_mpls_header);

    if(mpls.mpls.label == 0x8000) {
      // Push label
      mpls.mpls.label = ntohl(*((u_int32_t*)&packet[ip_offset]));
      ip_offset += sizeof(struct ndpi_mpls_header);
    } else if(mpls.mpls.label == 0x8100) {
      // Pop label
      ip_offset += sizeof(struct ndpi_mpls_header);
    } else {
      // Unknown label
      return(nproto);
    }
  }

  type = ETH_P_IP;
  recheck_type = 1;
  break;