case ETH_P_MPLS_UNI:
  case ETH_P_MPLS_MULTI:
    /* Handle MPLS (Multiprotocol Label Switching) packets with multiple labels.
     * - Extract and convert MPLS labels from network to host byte order.
     * - Update the MPLS packet count in the workflow statistics.
     * - Set the packet type to IP and adjust the IP offset past the MPLS header.
     * - Iterate through MPLS labels, adjusting the IP offset until the last label is found.
     * - Set a flag to indicate that the packet type should be rechecked.
     */
    u_int16_t mpls_label_count = 0;
    u_int16_t mpls_label = 0;
    u_int16_t mpls_offset = ip_offset;

    while (mpls_offset < header->caplen && mpls_offset < ip_offset + sizeof(struct ndpi_iphdr)) {
      mpls_label = ntohs(((union mpls *)(&packet[mpls_offset])).mpls.label);
      mpls_label_count++;
      mpls_offset += sizeof(union mpls);
    }

    network_flow->stats.mpls_count += mpls_label_count;
    ip_offset += mpls_label_count * sizeof(union mpls);
    type = ETH_P_IP;
    recheck_type = 1;
    break;