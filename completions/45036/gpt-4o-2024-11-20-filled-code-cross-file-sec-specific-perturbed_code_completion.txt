case ETH_P_MPLS_UNI:
  case ETH_P_MPLS_MULTI:
    network_flow->stats.mpls_count++;
    type = ETH_P_IP;
    ip_offset += 4;

    // Process MPLS labels
    while (1) {
      if (ip_offset + 4 > header->caplen) {
        return nproto; // Too short for MPLS label
      }

      mpls.u32 = ntohl(*((uint32_t *)&packet[ip_offset]));
      ip_offset += 4;

      // Check if this is the last MPLS label
      if (mpls.mpls.s == 1) {
        break;
      }
    }

    recheck_type = 1;
    break;