static uint32_t handle_mpls(struct ndpi_workflow * workflow,
                            const u_int8_t *packet,
                            u_int16_t ip_offset,
                            u_int16_t ip_len,
                            u_int16_t *payload_len,
                            u_int8_t *proto,
                            u_int8_t *src_to_dst_direction,
                            u_int16_t *vlan_id,
                            u_int64_t time_ms,
                            ndpi_risk *flow_risk,
                            FILE * csv_fp) {
  union mpls mpls;
  struct ndpi_iphdr *iph;
  struct ndpi_ipv6hdr *iph6;
  u_int32_t label;
  u_int16_t ipsize;
  u_int16_t frag_off;
  u_int8_t recheck_type = 0;
  u_int8_t vlan_packet = 0;
  u_int8_t proto = 0;
  u_int8_t *l4ptr;
  u_int16_t iph_len;
  u_int16_t iph6_len;
  u_int16_t iph6_ext_len;
  u_int16_t iph6_ext_len_offset;
  u_int16_t iph6_ext_len_len;
  u_int16_t iph6_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_type;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_offset;
  u_int16_t iph6_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_ext_len_len;
  u_int16_t iph