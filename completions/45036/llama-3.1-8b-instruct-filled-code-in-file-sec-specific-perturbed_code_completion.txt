static uint32_t ndpi_handle_ipv6_extension_headers(u_int16_t ipsize, const u_int8_t **l4ptr, u_int16_t *ip_len, u_int8_t *proto) {
  const struct ndpi_ipv6hdr *iph6 = (struct ndpi_ipv6hdr *)*l4ptr;
  const struct ndpi_ipv6hdr *iph6_ext = NULL;
  u_int16_t ext_len = 0;
  u_int8_t ext_type = 0;
  u_int8_t ext_next = 0;
  u_int8_t ext_pad = 0;
  u_int8_t ext_reserved = 0;
  u_int8_t ext_reserved2 = 0;
  u_int8_t ext_reserved3 = 0;
  u_int8_t ext_reserved4 = 0;
  u_int8_t ext_reserved5 = 0;
  u_int8_t ext_reserved6 = 0;
  u_int8_t ext_reserved7 = 0;
  u_int8_t ext_reserved8 = 0;
  u_int8_t ext_reserved9 = 0;
  u_int8_t ext_reserved10 = 0;
  u_int8_t ext_reserved11 = 0;
  u_int8_t ext_reserved12 = 0;
  u_int8_t ext_reserved13 = 0;
  u_int8_t ext_reserved14 = 0;
  u_int8_t ext_reserved15 = 0;
  u_int8_t ext_reserved16 = 0;
  u_int8_t ext_reserved17 = 0;
  u_int8_t ext_reserved18 = 0;
  u_int8_t ext_reserved19 = 0;
  u_int8_t ext_reserved20 = 0;
  u_int8_t ext_reserved21 = 0;
  u_int8_t ext_reserved22 = 0;
  u_int8_t ext_reserved23 = 0;
  u_int8_t ext_reserved24 = 0;
  u_int8_t ext_reserved25 = 0;
  u_int8_t ext_reserved26 = 0;
  u_int8_t ext_reserved27 = 0;
  u_int8_t ext_reserved28 = 0;
  u_int8_t ext_reserved29 = 0;
  u_int8_t ext_reserved30 = 0;
  u_int8_t ext_reserved31 = 0;
  u_int8_t ext_reserved32 = 0;
  u_int8_t ext_reserved33 = 0;
  u_int8_t ext_reserved34 = 0;
  u_int8_t ext_reserved35 = 0;
  u_int8_t ext_reserved36 = 0;
  u_int8_t ext_reserved37 = 0;
  u_int8_t ext_reserved38 = 0;
  u_int8_t ext_reserved39 = 0;
  u_int8_t ext_reserved40 = 0;
  u_int8_t ext_reserved41 = 0;
  u_int8_t ext_reserved42 = 0;
  u_int8_t ext_reserved43 = 0;
  u_int8_t ext_reserved44 = 0;
  u_int8_t ext_reserved45 = 0;
  u_int8_t ext_reserved46 = 0;
  u_int8_t ext_reserved47 = 0;
  u_int8_t ext_reserved48 = 0;
  u_int8_t ext_reserved49 = 0;
  u_int8_t ext_reserved50 = 0;
  u_int8_t ext_reserved51 = 0;
  u_int8_t ext_reserved52 = 0;
  u_int8_t ext_reserved53 = 0;
  u_int8_t ext_reserved54 = 0;
  u_int8_t ext_reserved55 = 0;
  u_int8_t ext_reserved56 = 0;
  u_int8_t ext_reserved57 = 0;
  u_int8_t ext_reserved58 = 0;
  u_int8_t ext_reserved59 = 0;
  u_int8_t ext_reserved60 = 0;
  u_int8_t ext_reserved61 = 0;
  u_int8_t ext_reserved62 = 0;
  u_int8_t ext_reserved63 = 0;
  u_int8_t ext_reserved64 = 0;
  u_int8_t ext_reserved65 = 0;
  u_int8_t ext_reserved66 = 0;
  u_int8_t ext_reserved67 = 0;
  u_int8_t ext_reserved68 = 0;
  u_int8_t ext_reserved69 = 0;
  u_int8_t ext_reserved70 = 0;
  u_int8_t ext_reserved71 = 0;
  u_int8_t ext_reserved72 = 0;
  u_int8_t ext_reserved73 = 0;
  u_int8_t ext_reserved74 = 0;
  u_int8_t ext_reserved75 = 0;
  u_int8_t ext_reserved76 = 0;
  u_int8_t ext_reserved77 = 0;
  u_int8_t ext_reserved78 = 0;
  u_int8_t ext_reserved79 = 0;
  u_int8_t ext_reserved80 = 0;
  u_int8_t ext_reserved81 = 0;
  u_int8_t ext_reserved82 = 0;
  u_int8_t ext_reserved83 = 0;
  u_int8_t ext_reserved84 = 0;
  u_int8_t ext_reserved85 = 0;
  u_int8_t ext_reserved86 = 0;
  u_int8_t ext_reserved87 = 0;
  u_int8_t ext_reserved88 = 0;
  u_int8_t ext_reserved89 = 0;
  u_int8_t ext_reserved90 = 0;
  u_int8_t ext_reserved91 = 0;
  u_int8_t ext_reserved92 = 0;
  u_int8_t ext_reserved93 = 0;
  u_int8_t ext_reserved94 = 0;
  u_int8_t ext_reserved95 = 0;
  u_int8_t ext_reserved96 = 0;
  u_int8_t ext_reserved97 = 0;
  u_int8_t ext_reserved98 = 0;
  u_int8_t ext_reserved99 = 0;

  if(ipsize < sizeof(struct ndpi_ipv6hdr))
    return 0;

  ext_len = ntohs(iph6->ip6_hdr.ip6_un1_plen);
  if(ext_len == 0)
    return 0;

  if(ipsize < (sizeof(struct ndpi_ipv6hdr) + ext_len))
    return 0;

  *l4ptr += sizeof(struct ndpi_ipv6hdr);
  ip_len -= ext_len;

  ext_type = (*l4ptr)[0];
  ext_next = (*l4ptr)[1];

  switch(ext_type) {
  case 0: /* HOPOPT */
    break;
  case 1: /* ROUTING */
    break;
  case 2: /* FRAG */
    break;
  case 3: /* ESP */
    break;
  case 4: /* AH */
    break;
  case 5: /* No Next Header */
    break;
  case 6: /* Destination Options */
    break;
  case 7: /* No Next Header */
    break;
  case 8: /* Router Alert */
    break;
  case 59: /* IPv6 Hop-by-Hop Options */
    break;
  case 60: /* IPv6 Routing */
    break;
  case 61: /* IPv6 Fragment */
    break;
  case 62: /* ESP */
    break;
  case 64: /* AH */
    break;
  case 65: /* Destination Options */
    break;
  case 66: /* No Next Header */
    break;
  case 67: /* Router Alert */
    break;
  case 68: /* IPv6 Hop-by-Hop Options */
    break;
  case 69: /* IPv6 Routing */
    break;
  case 70: /* IPv6 Fragment */
    break;
  case 71: /* ESP */
    break;
  case 72: /* AH */
    break;
  case 73: /* Destination Options */
    break;
  case 74: /* No Next Header */
    break;
  case 75: /* Router Alert */
    break;
  case 76: /* IPv6 Hop-by-Hop Options */
    break;
  case 77: /* IPv6 Routing */
    break;
  case 78: /* IPv6 Fragment */
    break;
  case 79: /* ESP */
    break;
  case 80: /* AH */
    break;
  case 81: /* Destination Options */
    break;
  case 82: /* No Next Header */
    break;
  case 83: /* Router Alert */
    break;
  case 84: /* IPv6 Hop-by-Hop Options */
    break;
  case 85: /* IPv6 Routing */
    break;
  case 86: /* IPv6 Fragment */
    break;
  case 87: /* ESP */
    break;
  case 88: /* AH */
    break;
  case 89: /* Destination Options */
    break;
  case 90: /* No Next Header */
    break;
  case 91: /* Router Alert */
    break;
  case 92: /* IPv6 Hop-by-Hop Options */
    break;
  case 93: /* IPv6 Routing */
    break;
  case 94: /* IPv6 Fragment */
    break;
  case 95: /* ESP */
    break;
  case 96: /* AH */
    break;
  case 97: /* Destination Options */
    break;
  case 98: /* No Next Header */
    break;
  case 99: /* Router Alert */
    break;
  case 100: /* IPv6 Hop-by-Hop Options */
    break;
  case 101: /* IPv6 Routing */
    break;
  case 102: /* IPv6 Fragment */
    break;
  case 103: /* ESP */
    break;
  case 104: /* AH */
    break;
  case 105: /* Destination Options */
    break;
  case 106: /* No Next Header */
    break;
  case 107: /* Router Alert */
    break;
  case 108: /* IPv6 Hop-by-Hop Options */
    break;
  case 109: /* IPv6 Routing */
    break;
  case 110: /* IPv6 Fragment */
    break;
  case 111: /* ESP */
    break;
  case 112: /* AH */
    break;
  case 113: /* Destination Options */
    break;
  case 114: /* No Next Header */
    break;
  case 115: /* Router Alert */
    break;
  case 116: /* IPv6 Hop-by-Hop Options */
    break;
  case 117: /* IPv6 Routing */
    break;
  case 118: /* IPv6 Fragment */
    break;
  case 119: /* ESP */
    break;
  case 120: /* AH */
    break;
  case 121: /* Destination Options */
    break;
  case 122: /* No Next Header */
    break;
  case 123: /* Router Alert */
    break;
  case 124: /* IPv6 Hop-by-Hop Options */
    break;
  case 125: /* IPv6 Routing */
    break;
  case 126: /* IPv6 Fragment */
    break;
  case 127: /* ESP */
    break;
  case 128: /* AH */
    break;
  case 129: /* Destination Options */
    break;
  case 130: /* No Next Header */
    break;
  case 131: /* Router Alert */
    break;
  case 132: /* IPv6 Hop-by-Hop Options */
    break;
  case 133: /* IPv6 Routing */
    break;
  case 134: /* IPv6 Fragment */
    break;
  case 135: /* ESP */
    break;
  case 136: /* AH */
    break;
  case 137: /* Destination Options */
    break;
  case 138: /* No Next Header */
    break;
  case 139: /* Router Alert */
    break;
  case 140: /* IPv6 Hop-by-Hop Options */
    break;
  case 141: /* IPv6 Routing */
    break;
  case 142: /* IPv6 Fragment */
    break;
  case 143: /* ESP */
    break;
  case 144: /* AH */
    break;
  case 145: /* Destination Options */
    break;
  case 146: /* No Next Header */
    break;
  case 147: /* Router Alert */
    break;
  case 148: /* IPv6 Hop-by-Hop Options */
    break;
  case 149: /* IPv6 Routing */
    break;
  case 150: /* IPv6 Fragment */
    break;
  case 151: /* ESP */
    break;
  case 152: /* AH */
    break;
  case 153: /* Destination Options */
    break;
  case 154: /* No Next Header */
    break;
  case 155: /* Router Alert */
    break;
  case 156: /* IPv6 Hop-by-Hop Options */
    break;
  case 157: /* IPv6 Routing */
    break;
  case 158: /* IPv6 Fragment */
    break;
  case 159: /* ESP */
    break;
  case 160: /* AH */
    break;
  case 161: /* Destination Options */
    break;
  case 162: /* No Next Header */
    break;
  case 163: /* Router Alert */
    break;
  case 164: /* IPv6 Hop-by-Hop Options */
    break;
  case 165: /* IPv6 Routing */
    break;
  case 166: /* IPv6 Fragment */
    break;
  case 167: /* ESP */
    break;
  case 168: /* AH */
    break;
  case 169: /* Destination Options */
    break;
  case 170: /* No Next Header */
    break;
  case 171: /* Router Alert */
    break;
  case 172: /* IPv6 Hop-by-Hop Options */
    break;
  case 173: /* IPv6 Routing */
    break;
  case 174: /* IPv6 Fragment */
    break;
  case 175: /* ESP */
    break;
  case 176: /* AH */
    break;
  case 177: /* Destination Options */
    break;
  case 178: /* No Next Header */
    break;
  case 179