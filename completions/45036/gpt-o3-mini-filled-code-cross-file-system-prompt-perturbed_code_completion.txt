{
      const int mpls_label_size = 4;
      if (ip_offset + mpls_label_size > header->caplen)
        return(nproto);
      network_flow->stats.mpls_count++;

      /* Iterate through MPLS labels until Bottom of Stack (BOS) is encountered */
      while (1) {
        if (ip_offset + mpls_label_size > header->caplen)
          return(nproto);
        mpls.u32 = ntohl(*(uint32_t *)(&packet[ip_offset]));
        /* The BOS bit is the 9th bit (0x100) in the MPLS header */
        if (mpls.u32 & 0x00000100)
          break;
        ip_offset += mpls_label_size;
      }
      /* Move past the last MPLS header */
      ip_offset += mpls_label_size;
      type = ETH_P_IP;
      recheck_type = 1;
    }