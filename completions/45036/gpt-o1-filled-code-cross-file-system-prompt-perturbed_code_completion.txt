case ETH_P_MPLS_UNI:
case ETH_P_MPLS_MULTI:
  /* Increase MPLS counter in workflow statistics */
  network_flow->stats.mpls_count++;

  /* Iterate through MPLS labels */
  do {
    if(ip_offset + 4 > header->caplen)
      return(nproto); /* Not enough data for next MPLS label */

    mpls.u32 = ntohl(*(const uint32_t *)&packet[ip_offset]);
    ip_offset += 4;

    /* Break if bottom-of-stack is reached */
    if(mpls.mpls.bottom_of_stack)
      break;
  } while(1);

  /* After MPLS labels, assume IP packet */
  type = ETH_P_IP;
  recheck_type = 1;
  break;