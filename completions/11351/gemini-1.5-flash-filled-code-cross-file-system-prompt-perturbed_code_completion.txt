while (initial_gids_to_retain->next (&gid))
  {
    full_glyphs_to_retain->add (gid);
    glyphs->push (gid);
    if (glyf.is_composite (gid))
      glyf.collect_composite_glyphs (gid, full_glyphs_to_retain);
  }

  hb_set_destroy (initial_gids_to_retain);
  _create_old_gid_to_new_gid_map (*glyphs, codepoint_to_glyph);
  cmap.fini ();
  glyf.fini ();
  return full_glyphs_to_retain;