while (initial_gids_to_retain->next(&gid)) {
    if (gid >= glyf.get_num_glyphs()) {
      DEBUG_MSG(SUBSET, nullptr, "Invalid gid %u; exceeds max glyphs", gid);
      continue;
    }
    full_glyphs_to_retain->add(gid);
    glyf.add_composite_glyphs(gid, full_glyphs_to_retain);
  }

  hb_set_destroy(initial_gids_to_retain);

  gid = HB_SET_VALUE_INVALID;
  while (full_glyphs_to_retain->next(&gid)) {
    glyphs->push(gid);
  }

  cmap.fini();
  glyf.fini();

  return full_glyphs_to_retain;