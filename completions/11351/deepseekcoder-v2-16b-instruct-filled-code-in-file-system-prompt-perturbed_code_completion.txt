hb_set_t *full_glyphs_to_retain = hb_set_create ();
  hb_codepoint_t gid = HB_SET_VALUE_INVALID;
  while (initial_gids_to_retain->next (&gid)) {
    _add_gid_and_children (glyf, gid, full_glyphs_to_retain);
  }
  hb_set_destroy (initial_gids_to_retain);

  // Add all glyphs from the glyphs vector to the full set of glyphs to retain.
  for (unsigned int i = 0; i < glyphs.len; i++) {
    hb_set_add (full_glyphs_to_retain, glyphs[i]);
  }

  // Remove any glyphs that are not in the range of the face's glyph count.
  _remove_invalid_gids (full_glyphs_to_retain, hb_face_get_num_glyphs (face));

  // Finalize and clean up any resources associated with the glyph and cmap accelerators.
  cmap.fini ();
  glyf.fini ();

  return full_glyphs_to_retain;
}