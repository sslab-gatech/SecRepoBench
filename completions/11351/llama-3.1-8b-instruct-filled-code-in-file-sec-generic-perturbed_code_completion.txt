hb_set_t *full_glyphs_to_retain = hb_set_create ();
hb_vector_t<hb_codepoint_t> *glyphs_to_retain = hb_vector_create();
hb_codepoint_t gid = HB_SET_VALUE_INVALID;
while (hb_set_iterate (initial_gids_to_retain, &gid)) {
  glyphs_to_retain->push_back (gid);
  OT::glyf::accelerator_t glyf;
  glyf.init (face);
  OT::glyf::CompositeGlyphHeader::Iterator composite;
  if (glyf.get_composite (gid, &composite)) {
    do {
      _add_gid_and_children (glyf, (hb_codepoint_t) composite.current->glyphIndex, full_glyphs_to_retain);
    } while (composite.move_to_next());
  }
  hb_set_add (full_glyphs_to_retain, gid);
}
hb_set_destroy (initial_gids_to_retain);
hb_set_destroy (glyphs_to_retain);
hb_set_destroy (full_glyphs_to_retain);
return full_glyphs_to_retain;