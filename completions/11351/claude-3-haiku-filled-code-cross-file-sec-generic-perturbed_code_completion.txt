// Populate a full set of glyphs to retain by adding all referenced
// composite glyphs.
hb_codepoint_t gid = HB_SET_VALUE_INVALID;
hb_set_t *full_glyphs_to_retain = hb_set_create ();
while (initial_gids_to_retain->next (&gid))
{
  full_glyphs_to_retain->add (gid);
  if (glyf.get_glyph_data (gid, nullptr))
  {
    hb_codepoint_t component_gid;
    unsigned int start_offset, end_offset;
    if (glyf.get_composite_glyph (gid, &start_offset, &end_offset))
    {
      for (unsigned int i = start_offset; i < end_offset; i++)
      {
        if (glyf.get_component_glyph (gid, i, &component_gid))
          full_glyphs_to_retain->add (component_gid);
      }
    }
  }
}
hb_set_destroy (initial_gids_to_retain);

*glyphs = hb_vector_t<hb_codepoint_t> ();
hb_set_t *glyphs_to_retain = full_glyphs_to_retain;
hb_codepoint_t glyph;
while (glyphs_to_retain->next (&glyph))
  glyphs->push (glyph);

cmap.fini ();
glyf.fini ();

return full_glyphs_to_retain;