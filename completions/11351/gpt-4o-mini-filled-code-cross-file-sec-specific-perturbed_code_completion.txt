hb_set_t *composite_gids = hb_set_create ();
  hb_set_t *temp_gids = hb_set_create ();
  
  while (initial_gids_to_retain->next (&gid))
  {
    temp_gids->clear ();
    temp_gids->add (gid);
    hb_ot_layout_collect_composite_glyphs (face, temp_gids, composite_gids);
  }

  hb_set_union (full_glyphs_to_retain, composite_gids);
  
  hb_set_destroy (composite_gids);
  hb_set_destroy (temp_gids);
  hb_set_destroy (initial_gids_to_retain);
  
  glyphs->clear ();
  for (hb_codepoint_t glyph : full_glyphs_to_retain)
    glyphs->push_back (glyph);

  cmap.fini ();
  glyf.fini ();
  
  return full_glyphs_to_retain;