hb_codepoint_t gid;
  for (gid = 0; initial_gids_to_retain->has (gid); ++gid)
  {
    if (gid > face->num_glyphs())
    {
      DEBUG_MSG(SUBSET, nullptr, "Drop GID %u; out of range", gid);
      continue;
    }
    full_glyphs_to_retain->add (gid);
    hb_ot_glyf_glyph_t glyph;
    if (glyf.get (gid, &glyph))
    {
      for (unsigned int i = 0; i < glyph.num_contours; ++i)
      {
        hb_codepoint_t component_gid = glyph.contour_end[i];
        if (component_gid > face->num_glyphs())
        {
          DEBUG_MSG(SUBSET, nullptr, "Drop component GID %u; out of range", component_gid);
          continue;
        }
        full_glyphs_to_retain->add (component_gid);
      }
    }
  }
  hb_set_destroy (initial_gids_to_retain);
  glyphs->resize (full_glyphs_to_retain->len());
  for (gid = 0; full_glyphs_to_retain->has (gid); ++gid)
  {
    glyphs->push_back (gid);
  }
  cmap.fini();
  glyf.fini();
  return full_glyphs_to_retain;