/* ******************************************* */

void ndpi_fill_prefix_v4(ndpi_prefix_t *prefix, struct in_addr *pin, u_int32_t prefix_len, u_int32_t maxbits) {
  u_int32_t i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z;
  u_int32_t mask = 0;

  if(prefix_len > maxbits) {
    prefix_len = maxbits;
  }

  for(i = 0; i < 4; i++) {
    u_int32_t byte = pin->s_addr >> (i * 8);
    u_int32_t mask_byte = 0xFF << (32 - (prefix_len - (i * 8)));

    mask |= (byte & mask_byte) << (i * 8);
  }

  prefix->mask = mask;
  prefix->mask_len = prefix_len;
  prefix->value = pin->s_addr;
}

/* ******************************************* */