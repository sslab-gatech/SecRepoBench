uint16_t filename_len = 0;
          const uint8_t *payload = tftp_packet->payload;
          uint16_t payload_len = tftp_packet->payload_packet_len;

          // Find the length of the filename (first null-terminated string after opcode)
          while (filename_len + 2 < payload_len && payload[filename_len + 2] != 0x00) {
            filename_len++;
          }

          // Verify filename is present and consists of printable characters
          if (filename_len == 0 || filename_len + 2 >= payload_len) {
            NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
            return;
          }

          for (uint16_t i = 0; i < filename_len; i++) {
            if (!isprint(payload[i + 2])) {
              NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
              return;
            }
          }

          // Copy filename to flow structure (ensure null-termination)
          uint16_t copy_len = filename_len < sizeof(flow->protos.tftp.filename) - 1 ? 
                             filename_len : sizeof(flow->protos.tftp.filename) - 1;
          memcpy(flow->protos.tftp.filename, &payload[2], copy_len);
          flow->protos.tftp.filename[copy_len] = '\0';

          NDPI_LOG_INFO(ndpi_struct, "found TFTP %s request\n", 
                       (get_u_int8_t(tftp_packet->payload, 1) == 0x01) ? "read" : "write");
          ndpi_int_tftp_add_connection(ndpi_struct, flow);