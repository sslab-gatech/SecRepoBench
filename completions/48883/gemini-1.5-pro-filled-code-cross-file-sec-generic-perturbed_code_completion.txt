size_t filename_len = 0;
          const u_int8_t *filename_ptr = tftp_packet->payload + 2;

          while (filename_ptr < (tftp_packet->payload + tftp_packet->payload_packet_len - 1 - mode_len) && *filename_ptr != '\0') {
              if (!isprint(*filename_ptr)) {
                  NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
                  return;
              }
              filename_len++;
              filename_ptr++;
          }

          if (filename_len == 0 || filename_len > 255)
          {
            NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
            return;
          }

          // Ensure the filename fits within the allocated buffer.
          if (filename_len >= sizeof(flow->l4.udp.tftp_filename)) {
              filename_len = sizeof(flow->l4.udp.tftp_filename) - 1;
          }

          memcpy(flow->l4.udp.tftp_filename, tftp_packet->payload + 2, filename_len);
          flow->l4.udp.tftp_filename[filename_len] = '\0';

          NDPI_LOG_INFO(ndpi_struct, "found TFTP RRQ/WRQ, filename: %s\n", flow->l4.udp.tftp_filename);
          ndpi_int_tftp_add_connection(ndpi_struct, flow);