uint8_t fn_len = tftp_packet->payload_packet_len - 1 - mode_len - 2; // Subtract opcode, mode, and two null terminators

          if (fn_len > 0 && fn_len <= NDPI_TFTP_FILENAME_MAX_LEN && tftp_packet->payload[2] != 0x00) {
            int i;
            for (i = 0; i < fn_len; i++) {
              if (!isprint(tftp_packet->payload[2 + i])) {
                NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
                return;
              }
            }
            memcpy(flow->l4.udp.tftp_filename, &tftp_packet->payload[2], fn_len);
            flow->l4.udp.tftp_filename[fn_len] = '\0'; // Null-terminate

            NDPI_LOG_INFO(ndpi_struct, "found TFTP RRQ/WRQ packet (filename: %s)\n", flow->l4.udp.tftp_filename);
            ndpi_int_tftp_add_connection(ndpi_struct, flow);
          } else {
            NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
            return;
          }