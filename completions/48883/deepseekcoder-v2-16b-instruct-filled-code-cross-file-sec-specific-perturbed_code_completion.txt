// Extract the filename from the TFTP RRQ/WWQ packet.
  char filename[256]; // Ensure this size is appropriate for your use case
  size_t filename_len = 0;

  // Find the start of the filename in the packet
  const uint8_t *payload = tftp_packet->payload;
  size_t payload_len = tftp_packet->payload_packet_len;

  // Skip the first 2 bytes (opcode)
  payload += 2;
  payload_len -= 2;

  // Find the end of the filename (null terminator)
  for (size_t i = 0; i < payload_len; ++i) {
    if (payload[i] == 0x00) {
      filename_len = i;
      break;
    }
  }

  if (filename_len == 0) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  // Copy the filename to the flow structure's TFTP filename field
  if (filename_len >= sizeof(filename)) {
    filename_len = sizeof(filename) - 1;
  }
  memcpy(filename, payload, filename_len);
  filename[filename_len] = '\0'; // Null-terminate the string

  // Log the detection of a TFTP RRQ/WWQ packet and add the connection to the flow.
  NDPI_LOG_INFO(ndpi_struct, "found tftp\n");
  flow->l4.udp.tftp_filename = strdup(filename); // Ensure proper memory management
  ndpi_int_tftp_add_connection(ndpi_struct, flow);