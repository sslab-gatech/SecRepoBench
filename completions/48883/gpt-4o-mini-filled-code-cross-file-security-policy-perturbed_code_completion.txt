size_t filename_len = tftp_packet->payload_packet_len - 2 - mode_len; // Length of the filename
          if (filename_len > 0 && isprint(tftp_packet->payload[2])) {
            // Ensure the filename is null-terminated
            size_t safe_len = ndpi_min(filename_len, sizeof(flow->tftp_filename) - 1);
            memcpy(flow->tftp_filename, &tftp_packet->payload[2], safe_len);
            flow->tftp_filename[safe_len] = '\0'; // Null-terminate the string
            NDPI_LOG_INFO(ndpi_struct, "Detected TFTP filename: %s\n", flow->tftp_filename);
          } else {
            NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
            return;
          }