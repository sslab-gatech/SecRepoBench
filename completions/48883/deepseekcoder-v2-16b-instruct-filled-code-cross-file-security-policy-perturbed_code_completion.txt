// Extract the filename from the TFTP RRQ/WWQ packet.
  char filename[64]; // Adjust size as needed
  size_t filename_len = 0;
  const char *filename_ptr = (const char *)&tftp_packet->payload[tftp_packet->payload_packet_len - 1 - mode_len];

  // Find the start of the filename
  while (filename_len < mode_len && isprint(filename_ptr[mode_len - filename_len - 1])) {
    filename_len++;
  }

  if (filename_len == 0) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  // Copy the filename to the flow structure's TFTP filename field
  size_t max_filename_len = sizeof(flow->l4.udp.tftp_filename) - 1;
  filename_len = ndpi_min(filename_len, max_filename_len);
  memcpy(filename, filename_ptr, filename_len);
  filename[filename_len] = '\0'; // Null-terminate the string

  // Log the detection of a TFTP RRQ/WWQ packet and add the connection to the flow.
  NDPI_LOG_INFO(ndpi_struct, "found tftp\n");
  strncpy(flow->l4.udp.tftp_filename, filename, max_filename_len);
  flow->l4.udp.tftp_filename[max_filename_len] = '\0'; // Ensure null-termination
  ndpi_int_tftp_add_connection(ndpi_struct, flow);