// Extract the filename from the TFTP RRQ/WWQ packet.
  char filename[256]; // Ensure this is large enough to hold the filename
  size_t filename_len = 0;

  // Find the start of the filename in the payload
  const char *filename_start = NULL;
  for (size_t i = 2; i < tftp_packet->payload_packet_len - 1; ++i) {
    if (tftp_packet->payload[i] == ' ' || tftp_packet->payload[i] == '\0') {
      filename_start = &tftp_packet->payload[i + 1];
      break;
    }
  }

  if (filename_start == NULL) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  // Copy the filename to the flow structure's TFTP filename field
  filename_len = strnlen(filename_start, sizeof(filename) - 1);
  if (filename_len >= sizeof(filename)) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  memcpy(filename, filename_start, filename_len);
  filename[filename_len] = '\0'; // Null-terminate the filename

  // Log the detection of a TFTP RRQ/WWQ packet and add the connection to the flow.
  NDPI_LOG_INFO(ndpi_struct, "detected TFTP RRQ/WWQ packet with filename: %s\n", filename);
  flow->l4.udp.tftp_filename = strdup(filename); // Ensure null-termination and deep copy
  if (flow->l4.udp.tftp_filename == NULL) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  ndpi_int_tftp_add_connection(ndpi_struct, flow);