const uint8_t *payload = tftp_packet->payload;
          uint16_t payload_len = tftp_packet->payload_packet_len;
          uint16_t filename_len = 0;
          uint16_t i;

          // Find the length of the filename (first null-terminated string)
          for(i = 2; i < payload_len; i++) {
            if(payload[i] == 0x00) {
              filename_len = i - 2;
              break;
            }
          }

          // Validate filename length and content
          if(filename_len == 0 || filename_len > NDPI_MAX_TFTP_FILENAME_LEN) {
            NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
            return;
          }

          // Verify filename consists of printable characters
          for(i = 0; i < filename_len; i++) {
            if(!isprint(payload[2 + i])) {
              NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
              return;
            }
          }

          // Copy filename to flow structure
          strncpy(flow->protos.tftp.filename, (const char *)&payload[2], filename_len);
          flow->protos.tftp.filename[filename_len] = '\0';

          NDPI_LOG_DBG2(ndpi_struct, "found tftp RRQ/WWQ with filename %s\n", flow->protos.tftp.filename);
          ndpi_int_tftp_add_connection(ndpi_struct, flow);