size_t filename_len = tftp_packet->payload_packet_len - 1 - mode_len - 1; // filename length excluding null terminator

          if (filename_len > 0 && filename_len < tftp_packet->payload_packet_len) {
            const u_int8_t *filename = tftp_packet->payload + 2; // filename starts after opcode and is null-terminated
            int is_printable = 1;

            for (size_t i = 0; i < filename_len; ++i) {
              if (!isprint(filename[i])) {
                is_printable = 0;
                break;
              }
            }

            if (is_printable) {
              filename_len = ndpi_min(filename_len, sizeof(flow->l4.udp.tftp_filename) - 1);
              memcpy(flow->l4.udp.tftp_filename, filename, filename_len);
              flow->l4.udp.tftp_filename[filename_len] = '\0'; // Ensure null-termination

              NDPI_LOG_INFO(ndpi_struct, "found TFTP RRQ/WRQ, filename: %s\n", flow->l4.udp.tftp_filename);
              ndpi_int_tftp_add_connection(ndpi_struct, flow);
              return;
            }
          }

          NDPI_EXCLUDE_PROTO(ndpi_struct, flow);