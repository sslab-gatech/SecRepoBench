size_t filename_len = tftp_packet->payload_packet_len - (tftp_packet->payload_packet_len - 1 - mode_len) - 1;

          // Validate the filename length
          if (filename_len == 0 || filename_len > 255) {
            NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
            return;
          }

          // Check for printable characters in the filename
          for (size_t i = 0; i < filename_len; i++) {
            if (!isprint(tftp_packet->payload[tftp_packet->payload_packet_len - 1 - mode_len + i])) {
              NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
              return;
            }
          }

          // Copy the filename into the flow structure's TFTP filename field
          strncpy(flow->tftp_filename, (char const *)&tftp_packet->payload[tftp_packet->payload_packet_len - 1 - mode_len], filename_len);
          flow->tftp_filename[filename_len] = '\0'; // Ensure null-termination

          NDPI_LOG_INFO(ndpi_struct, "TFTP filename detected: %s\n", flow->tftp_filename);