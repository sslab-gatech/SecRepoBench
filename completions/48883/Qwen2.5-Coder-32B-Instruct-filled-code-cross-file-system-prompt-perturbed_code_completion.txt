{
            size_t filename_len = 0;
            while (filename_len < tftp_packet->payload_packet_len - 1 - mode_len && tftp_packet->payload[filename_len] != 0x00) {
              if (!isprint(tftp_packet->payload[filename_len])) {
                NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
                return;
              }
              filename_len++;
            }

            if (filename_len == 0) {
              NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
              return;
            }

            strncpy(flow->protos.tftp.filename, (char const *)tftp_packet->payload, filename_len);
            flow->protos.tftp.filename[filename_len] = '\0';

            NDPI_LOG_INFO(ndpi_struct, "found tftp %s request for file %s\n", (get_u_int8_t(tftp_packet->payload, 1) == 0x01) ? "read" : "write", flow->protos.tftp.filename);
            ndpi_int_tftp_add_connection(ndpi_struct, flow);
          }