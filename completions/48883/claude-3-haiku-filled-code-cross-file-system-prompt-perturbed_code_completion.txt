// Extract the filename from the TFTP RRQ/WWQ packet.
size_t filename_len = 0;
while (filename_len < tftp_packet->payload_packet_len && tftp_packet->payload[filename_len] != 0x00) {
    filename_len++;
}

if (filename_len == 0 || filename_len >= NDPI_FILENAME_LEN) {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
}

for (size_t i = 0; i < filename_len; i++) {
    if (!isprint(tftp_packet->payload[i])) {
        NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
        return;
    }
}

memcpy(flow->protos.tftp.filename, tftp_packet->payload, filename_len);
flow->protos.tftp.filename[filename_len] = '\0';

NDPI_LOG_INFO(ndpi_struct, "found tftp RRQ/WWQ packet, filename: %s\n", flow->protos.tftp.filename);
ndpi_int_tftp_add_connection(ndpi_struct, flow);