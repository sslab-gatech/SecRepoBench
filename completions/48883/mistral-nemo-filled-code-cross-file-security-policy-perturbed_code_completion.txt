// Extract the filename from the TFTP RRQ/WWQ packet.
  char *filename = (char *)&tftp_packet->payload[tftp_packet->payload_packet_len - 1 - mode_len];
  size_t filename_len = strlen(filename);

  // Verify the filename is present and consists of printable characters.
  if (filename_len == 0 || !isprint(filename[0]))
  {
    NDPI_EXCLUDE_PROTO(ndpi_struct, flow);
    return;
  }

  // Determine the length of the filename.
  size_t filename_max_len = ndpi_min(NDPI_MAX_TFTP_FILENAME_LEN, tftp_packet->payload_packet_len - 1 - mode_len);

  // Copy the filename into the flow structure's TFTP filename field, ensuring null-termination.
  memcpy(flow->tftp.filename, filename, ndpi_min(filename_len, filename_max_len));
  flow->tftp.filename[filename_max_len] = '\0';

  // Log the detection of a TFTP RRQ/WWQ packet and add the connection to the flow.
  NDPI_LOG_INFO(ndpi_struct, "found TFTP RRQ/WWQ packet with filename: %s\n", flow->tftp.filename);
  ndpi_int_tftp_add_connection(ndpi_struct, flow);