/* Add the content length if a body exists */
if (body && body_len > 0) {
    c->resp.content_length = body_len;
}

/* Check if a proxy is specified and parse its data */
if (proxy_address) {
    char *colon = strchr(proxy_address, ':');
    if (!colon) {
        flb_error("[http_client] invalid proxy address format: %s", proxy_address);
        flb_http_client_destroy(c);
        return NULL;
    }

    size_t host_len = colon - proxy_address;
    c->proxy.host = flb_calloc(1, host_len + 1);
    if (!c->proxy.host) {
        flb_errno();
        flb_http_client_destroy(c);
        return NULL;
    }

    memcpy(c->proxy.host, proxy_address, host_len);
    c->proxy.port = atoi(colon + 1);
    if (c->proxy.port <= 0) {
        flb_error("[http_client] invalid proxy port in address: %s", proxy_address);
        flb_http_client_destroy(c);
        return NULL;
    }
}
else {
    c->proxy.host = NULL;
    c->proxy.port = 0;
}

/* Allocate memory for the response data buffer */
c->resp.data = flb_calloc(1, FLB_HTTP_DATA_SIZE_MAX);