if (proxy_address) {
    char *colon;
    /* Duplicate the proxy_address string safely */
    c->proxy.host = flb_strdup(proxy_address);
    if (!c->proxy.host) {
        flb_errno();
        flb_http_client_destroy(c);
        return NULL;
    }
    /* Parse proxy port if specified in the format "host:port" */
    colon = strchr(c->proxy.host, ':');
    if (colon) {
        *colon = '\0';
        c->proxy.port = atoi(colon + 1);
        if (c->proxy.port <= 0) {
            flb_error("[http_client] invalid proxy port in proxy_address");
            flb_http_client_destroy(c);
            return NULL;
        }
    }
    else {
        /* No port specified, use a default proxy port */
        c->proxy.port = 8080;
    }
}

/* Allocate memory for the response data buffer */
c->resp.data = flb_malloc(FLB_HTTP_DATA_SIZE_MAX);
if (!c->resp.data) {
    flb_errno();
    flb_http_client_destroy(c);
    return NULL;
}

/* Add the Host header */
ret = flb_http_add_header(c, "Host", 4, host, strlen(host));
if (ret != 0) {
    flb_error("[http_client] error adding Host header");
    flb_http_client_destroy(c);
    return NULL;
}

/* If a body is provided, add the Content-Length header */
if (body && body_len > 0) {
    char cl_str[32];

    if (snprintf(cl_str, sizeof(cl_str), "%zu", body_len) < 0) {
        flb_errno();
        flb_http_client_destroy(c);
        return NULL;
    }

    ret = flb_http_add_header(c, "Content-Length", 14, cl_str, strlen(cl_str));
    if (ret != 0) {
        flb_error("[http_client] error adding Content-Length header");
        flb_http_client_destroy(c);
        return NULL;
    }
}