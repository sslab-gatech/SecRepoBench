if (add_host_and_content_length(c) != 0) {
    flb_error("[http_client] cannot add host and content length headers");
    flb_http_client_destroy(c);
    return NULL;
}

if (proxy_address) {
    if (proxy_parse(proxy_address, c) != 0) {
        flb_error("[http_client] cannot parse proxy address '%s'", proxy_address);
        flb_http_client_destroy(c);
        return NULL;
    }
}

if (!c->resp.data) {
    c->resp.data = flb_malloc(FLB_HTTP_DATA_SIZE_MAX);
    if (!c->resp.data) {
        flb_errno();
        flb_http_client_destroy(c);
        return NULL;
    }
}
c->resp.data_len = 0;
c->resp.data_size = FLB_HTTP_DATA_SIZE_MAX;
c->resp.data_size_max = FLB_HTTP_DATA_SIZE_MAX;