// Add host header if not explicitly set
if (!flb_http_client_header_exists(c, "Host")) {
    flb_http_add_header(c, "Host", 4, c->host, strlen(c->host));
}

// Add Content-Length header if body is present
if (c->body_len > 0) {
    char tmp[32];
    int len = snprintf(tmp, sizeof(tmp) - 1, "%zu", c->body_len);
    flb_http_add_header(c, "Content-Length", 14, tmp, len);
}

// Parse proxy data if specified
if (proxy_address) {
    c->proxy.host = flb_strdup(proxy_address);
    if (!c->proxy.host) {
        flb_errno();
        flb_http_client_destroy(c);
        return NULL;
    }
    
    char *colon = strchr(c->proxy.host, ':');
    if (colon) {
        *colon = '\0';
        c->proxy.port = atoi(colon + 1);
    } else {
        c->proxy.port = 80;  // Default HTTP proxy port
    }
}

// Allocate response data buffer
c->resp.data = flb_calloc(1, FLB_HTTP_DATA_SIZE_MAX);