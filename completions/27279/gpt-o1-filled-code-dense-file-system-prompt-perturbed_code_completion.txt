{
        int ret;
        char tmp[64];

        /* Add Host header */
        if (c->host) {
            flb_http_add_header(c, "Host", 4, c->host, strlen(c->host));
        }

        /* Add Content-Length header if we have a body */
        if (body && body_len > 0) {
            snprintf(tmp, sizeof(tmp), "%zu", body_len);
            flb_http_add_header(c, "Content-Length", 14, tmp, strlen(tmp));
        }

        /* Parse proxy if specified */
        if (proxy_address) {
            ret = proxy_parse(proxy_address, c);
            if (ret == -1) {
                flb_error("[http_client] could not parse proxy address: %s", proxy_address);
                flb_free(buf);
                flb_http_client_destroy(c);
                return NULL;
            }
        }

        /* Allocate memory for the response data buffer */
        c->resp.data = flb_calloc(1, FLB_HTTP_DATA_SIZE_MAX);
    }