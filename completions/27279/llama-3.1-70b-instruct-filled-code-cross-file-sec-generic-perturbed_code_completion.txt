// Add the host and content length to the HTTP client structure.
if (host) {
    flb_http_add_header(c, "Host", 4, host, strlen(host));
}

if (body && body_len > 0) {
    char content_len[64];
    snprintf(content_len, sizeof(content_len), "%zu", body_len);
    flb_http_add_header(c, "Content-Length", 14, content_len, strlen(content_len));
}

// Check if a proxy is specified and parse its data, updating the client structure accordingly.
if (proxy_address) {
    char *proxy_port = strchr(proxy_address, ':');
    if (proxy_port) {
        *proxy_port = '\0';
        c->proxy.host = flb_strdup(proxy_address);
        c->proxy.port = atoi(proxy_port + 1);
        *proxy_port = ':';
    } else {
        c->proxy.host = flb_strdup(proxy_address);
        c->proxy.port = 80; // default HTTP port
    }
} else {
    c->proxy.host = NULL;
    c->proxy.port = 0;
}

// Handle the case where proxy parsing fails.
if (c->proxy.host == NULL) {
    flb_error("[http_client] failed to parse proxy address");
    flb_http_client_destroy(c);
    return NULL;
}

// Allocate memory for the response data buffer with a predefined maximum size.
c->resp.data = flb_calloc(1, FLB_HTTP_DATA_SIZE_MAX);