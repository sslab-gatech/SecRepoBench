/* Add Host header */
if (host) {
    char host_header[256];
    if (port != 80 && port != 443) {
        snprintf(host_header, sizeof(host_header) - 1, "%s:%i", host, port);
    }
    else {
        snprintf(host_header, sizeof(host_header) - 1, "%s", host);
    }
    flb_http_add_header(c, "Host", 4, host_header, strlen(host_header));
}

/* Add Content-Length header */
if (body && body_len > 0) {
    char tmp[32];
    snprintf(tmp, sizeof(tmp) - 1, "%zu", body_len);
    flb_http_add_header(c, "Content-Length", 14, tmp, strlen(tmp));
}

/* Parse proxy data if specified */
if (proxy_address) {
    char *p;
    char *addr;
    size_t addr_len;
    
    addr_len = strlen(proxy_address) + 1;
    addr = flb_calloc(1, addr_len);
    if (!addr) {
        flb_errno();
        flb_http_client_destroy(c);
        return NULL;
    }
    
    memcpy(addr, proxy_address, addr_len - 1);
    c->proxy.host = addr;
    
    p = strchr(addr, ':');
    if (p) {
        *p = '\0';
        p++;
        c->proxy.port = atoi(p);
    }
    else {
        c->proxy.port = 80;
    }
}

/* Allocate response data buffer */
c->resp.data = flb_calloc(1, FLB_HTTP_DATA_SIZE_MAX);