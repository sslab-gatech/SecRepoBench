/* Add "Host" and "Content-Length" headers to the HTTP request if needed */
    if (c->host && strlen(c->host) > 0) {
        flb_http_add_header(c, "Host", 4, c->host, strlen(c->host));
    }
    if (body && body_len > 0) {
        char tmp[64];
        int len;

        len = snprintf(tmp, sizeof(tmp) - 1, "%zu", body_len);
        if (len > 0) {
            flb_http_add_header(c, "Content-Length", 14, tmp, len);
        }
    }

    /* Check and parse proxy address if specified */
    if (proxy_address) {
        char *sep;

        sep = strchr(proxy_address, ':');
        if (!sep) {
            flb_error("[http_client] invalid proxy address '%s'", proxy_address);
            flb_http_client_destroy(c);
            return NULL;
        }

        c->proxy.host = flb_strndup(proxy_address, sep - proxy_address);
        if (!c->proxy.host) {
            flb_errno();
            flb_http_client_destroy(c);
            return NULL;
        }

        c->proxy.port = atoi(sep + 1);
        if (c->proxy.port <= 0) {
            flb_error("[http_client] invalid proxy port in address '%s'", proxy_address);
            flb_free((void *)c->proxy.host);
            c->proxy.host = NULL;
            flb_http_client_destroy(c);
            return NULL;
        }
    }

    /* Allocate memory for the response data buffer */
    c->resp.data = flb_calloc(1, FLB_HTTP_DATA_SIZE_MAX);