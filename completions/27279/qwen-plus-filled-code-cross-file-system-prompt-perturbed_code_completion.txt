if (proxy_address) {
    c->proxy.host = flb_strdup(proxy_address);
    if (!c->proxy.host) {
        flb_errno();
        flb_http_client_destroy(c);
        return NULL;
    }
}

flb_http_add_header(c, "Host", 4, host, strlen(host));

if (body && body_len > 0) {
    char len_str[24];
    int len = snprintf(len_str, sizeof(len_str), "%zu", body_len);
    if (len < 0 || len >= sizeof(len_str)) {
        flb_free(buf);
        flb_http_client_destroy(c);
        return NULL;
    }
    flb_http_add_header(c, "Content-Length", 14, len_str, strlen(len_str));
}

c->resp.data = flb_malloc(FLB_HTTP_DATA_SIZE_MAX);
if (!c->resp.data) {
    flb_errno();
    flb_http_client_destroy(c);
    return NULL;
}