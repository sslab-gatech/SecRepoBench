// Add the host and content length to the HTTP client structure.
c->host_len = strlen(host);
c->body_len = body_len;

// Check if a proxy is specified and parse its data, updating the client structure accordingly.
if (proxy_address) {
    c->proxy.host = flb_strdup(proxy_address);
    if (!c->proxy.host) {
        flb_errno();
        flb_http_client_destroy(c);
        return NULL;
    }
    c->proxy.port = port;
}

// Handle the case where proxy parsing fails.
if (c->proxy.host && !flb_http_client_proxy_connect(c->u_conn)) {
    flb_http_client_destroy(c);
    return NULL;
}

// Allocate memory for the response data buffer with a predefined maximum size.
c->resp.data = flb_malloc(FLB_HTTP_DATA_SIZE_MAX);
if (!c->resp.data) {
    flb_errno();
    flb_http_client_destroy(c);
    return NULL;
}