case VALUE_UNISTR: {
  if(payload_len < 4)
    return 0;

  u_int32_t size = ntohl(get_u_int32_t(databuffer, 0));
  if(size == 0 || (size + 4) > payload_len)
    return 0;

  v->value.ptr.value_str = (char *)(databuffer + 4);
  v->value_size = size;

  // For VALUE_DATA, the value_size is the full size, for VALUE_STR/UNISTR, ensure null-termination
  if(t == VALUE_DATA) {
    // nothing to do, value_size is correct
  } else {
    // For VALUE_STR/UNISTR, ensure the string is null-terminated for safety
    // (the caller should copy out if needed)
    // But we can't write to the buffer, so just set value_size
  }

  ret = size + 4;
  break;
}