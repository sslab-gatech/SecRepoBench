{
  if (payload_len < sizeof(u_int16_t))
    return 0;

  u_int16_t size_indicator = ntohs(get_u_int16_t(databuffer, 0));
  if (size_indicator == 0)
    return 0;

  if (t == VALUE_UNISTR) {
    /* For Unicode strings, the size indicator represents the number of wide characters.
       Each character occupies 2 bytes. */
    size_t total_bytes = size_indicator * 2;
    if ((size_t)sizeof(u_int16_t) + total_bytes > payload_len)
      return 0;
    v->value.ptr.value_str = (char *)(databuffer + sizeof(u_int16_t));
    v->value_size = total_bytes;
    ret = sizeof(u_int16_t) + total_bytes;
  } else {
    /* For VALUE_STR and VALUE_DATA, the size indicator represents the byte length of the data */
    if ((size_t)sizeof(u_int16_t) + size_indicator > payload_len)
      return 0;
    v->value.ptr.value_str = (char *)(databuffer + sizeof(u_int16_t));
    v->value_size = size_indicator;
    ret = sizeof(u_int16_t) + size_indicator;
  }
  break;
}