case VALUE_UNISTR:
  if(payload_len < 2)
    return 0;

  v->value_size = ntohs(get_u_int16_t(databuffer, 0));
  if(v->value_size == 0 || v->value_size > payload_len - 2)
    return 0;

  v->value.ptr.raw = databuffer + 2;
  ret = v->value_size + 2;
  break;

case VALUE_STR:
  if(payload_len < 1)
    return 0;

  v->value_size = databuffer[0];
  if(v->value_size == 0 || v->value_size > payload_len - 1)
    return 0;

  v->value.ptr.raw = databuffer + 1;
  ret = v->value_size + 1;
  break;

case VALUE_DATA:
  if(payload_len < 4)
    return 0;

  v->value_size = ntohl(get_u_int32_t(databuffer, 0));
  if(v->value_size == 0 || v->value_size > payload_len - 4)
    return 0;

  v->value.ptr.raw = databuffer + 4;
  ret = v->value_size + 4;
  break;