case VALUE_UNISTR:
      if (payload_len < 2) // Minimum size for a length indicator
        return 0;

      // Extract the size of the UNISTR value
      v->value_size = ntohs(get_u_int16_t(databuffer, 0));
      if (v->value_size == 0 || v->value_size > payload_len - 2)
        return 0;

      // Allocate memory for the UNISTR value
      v->value.ptr.value_unistr = malloc(v->value_size);
      if (v->value.ptr.value_unistr == NULL)
        return 0;

      // Copy the data into the allocated memory
      memcpy(v->value.ptr.value_unistr, databuffer + 2, v->value_size);

      // Return the total size processed (size indicator + data)
      ret = v->value_size + 2;
      break;

    case VALUE_DATA:
      if (payload_len < 2) // Minimum size for a length indicator
        return 0;

      // Extract the size of the DATA value
      v->value_size = ntohs(get_u_int16_t(databuffer, 0));
      if (v->value_size == 0 || v->value_size > payload_len - 2)
        return 0;

      // Allocate memory for the DATA value
      v->value.ptr.value_data = malloc(v->value_size);
      if (v->value.ptr.value_data == NULL)
        return 0;

      // Copy the data into the allocated memory
      memcpy(v->value.ptr.value_data, databuffer + 2, v->value_size);

      // Return the total size processed (size indicator + data)
      ret = v->value_size + 2;
      break;

    case VALUE_STR:
      if (payload_len < 2) // Minimum size for a length indicator
        return 0;

      // Extract the size of the STR value
      v->value_size = ntohs(get_u_int16_t(databuffer, 0));
      if (v->value_size == 0 || v->value_size > payload_len - 2)
        return 0;

      // Allocate memory for the STR value
      v->value.ptr.value_str = malloc(v->value_size + 1); // +1 for null terminator
      if (v->value.ptr.value_str == NULL)
        return 0;

      // Copy the data into the allocated memory
      memcpy(v->value.ptr.value_str, databuffer + 2, v->value_size);
      v->value.ptr.value_str[v->value_size] = '\0'; // Null-terminate the string

      // Return the total size processed (size indicator + data)
      ret = v->value_size + 2;
      break;