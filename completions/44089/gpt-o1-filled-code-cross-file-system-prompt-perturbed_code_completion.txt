char tmp[str_len + 1];
memcpy(tmp, str_val, str_len);
tmp[str_len] = '\0';

errno = 0;
double dval = strtod(tmp, &endp);

if (endp == tmp) {
    PLIST_JSON_ERR("%s: invalid numeric value '%.*s' encountered\n", __func__, (int)str_len, str_val);
} else if (*endp != '\0') {
    PLIST_JSON_ERR("%s: invalid numeric value '%.*s' encountered\n", __func__, (int)str_len, str_val);
} else {
    if (!errno) {
        if (floor(dval) == dval && dval >= 0.0) {
            parsed_value = plist_new_uint((uint64_t)dval);
        } else {
            parsed_value = plist_new_real(dval);
        }
    } else {
        PLIST_JSON_ERR("%s: numeric value '%.*s' is out of range\n", __func__, (int)str_len, str_val);
    }
}