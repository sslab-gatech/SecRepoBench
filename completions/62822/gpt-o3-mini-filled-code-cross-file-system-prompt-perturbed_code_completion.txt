const unsigned char *s = (const unsigned char*)src;
const unsigned char *s0 = s;
if (count == -1) count = slen * 8;
dst = mrb_str_new(mrbstate, NULL, count);
dptr0 = RSTRING_PTR(dst);
dptr = dptr0;
for (int i = 0; i < count; i++) {
  int byte_index = i / 8;
  unsigned char byte = s[byte_index];
  int bit;
  if (flags & PACK_FLAG_LSB)
    bit = (byte >> (i % 8)) & 1;
  else
    bit = (byte >> (7 - (i % 8))) & 1;
  *dptr++ = bit ? '1' : '0';
}
s += (count + 7) / 8;