mrb_value dst;
  const char *sptr = (const char*)src;
  int max_count = slen * 8;
  
  if (count == -1) {
    count = max_count;
  } else if (count > max_count) {
    count = max_count;
  }

  dst = mrb_str_new(mrbstate, NULL, count);
  char *dptr = RSTRING_PTR(dst);
  const char *sptr0 = sptr;
  const char *dptr0 = dptr;

  for (int i = 0; i < count; i++) {
    if (i < slen * 8) {
      *dptr++ = (*sptr & (1 << (7 - (i % 8)))) ? '1' : '0';
      if (i % 8 == 7) {
        sptr++;
      }
    }
  }

  dst = mrb_str_resize(mrbstate, dst, (mrb_int)(dptr - dptr0));