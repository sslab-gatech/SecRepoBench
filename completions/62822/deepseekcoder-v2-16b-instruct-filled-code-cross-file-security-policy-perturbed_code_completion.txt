// Create a new string `dst` to hold the unpacked bit representation with a length of `count`.
  dst = mrb_str_new(mrbstate, NULL, count);
  char *dptr = RSTRING_PTR(dst);
  const char *dptr0 = dptr;

  // Iterate over each bit in the specified range and convert it to a character '0' or '1' based on the value of each bit.
  const char *sptr = (const char *)src;
  const char *sptr0 = sptr;
  for (int i = 0; i < count; i++) {
    unsigned char byte = 0;
    if (flags & PACK_FLAG_LSB) {
      byte = (*sptr >> (i % 8)) & 1;
    } else {
      byte = (*sptr >> (7 - (i % 8))) & 1;
    }
    dptr[i / 8] |= byte << (i % 8);
  }

  // Ensure the string `dst` is resized to the correct length.
  dst = mrb_str_resize(mrbstate, dst, (mrb_int)(dptr - dptr0));
  mrb_ary_push(mrbstate, ary, dst);
  return (int)(sptr - sptr0);