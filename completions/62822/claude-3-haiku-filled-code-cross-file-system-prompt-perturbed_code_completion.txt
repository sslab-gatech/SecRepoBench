char *dst;
char *dptr, *dptr0;
const char *sptr, *sptr0;
int i;

sptr = (const char*)src;
sptr0 = sptr;

if (flags & PACK_FLAG_LSB) {
  for (i = 0; i < count; i++) {
    if (*sptr & 1) {
      *dptr = '1';
    } else {
      *dptr = '0';
    }
    dptr++;
    sptr++;
    if (i & 7 == 7) {
      sptr++;
    }
  }
} else {
  for (i = 0; i < count; i++) {
    if (*sptr & 0x80) {
      *dptr = '1';
    } else {
      *dptr = '0';
    }
    dptr++;
    sptr++;
    if (i & 7 == 7) {
      sptr++;
    }
  }
}