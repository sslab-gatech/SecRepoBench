const unsigned char *sptr = (const unsigned char *)src;
  const unsigned char *sptr0 = sptr;
  mrb_value dst;
  int i;

  if (count == -1) {
    count = slen * 8; // Default to the number of bits in the source
  }

  dst = mrb_str_new(mrbstate, NULL, count);
  char *dptr = RSTRING_PTR(dst);
  char *dptr0 = dptr;

  for (i = 0; i < count; i++) {
    if (i < slen * 8) {
      int bit = (sptr[i / 8] >> (7 - (i % 8))) & 1; // Read the bit
      *dptr++ = bit ? '1' : '0'; // Convert to '0' or '1'
    } else {
      *dptr++ = '0'; // Fill with '0' if count exceeds available bits
    }
  }