if ((cur->type == XML_ELEMENT_NODE) &&
    (cur->ns!= NULL) &&
    (xmlStrEqual(cur->name, XINCLUDE_NODE)) &&
    ((xmlStrEqual(cur->ns->href, XINCLUDE_NS)) ||
     (xmlStrEqual(cur->ns->href, XINCLUDE_OLD_NS)))) {
    xmlXIncludeRefPtr ref = xmlXIncludeExpandNode(ctxt, cur);

    if (ref == NULL)
        goto error;
    /*
     * TODO: Insert XML_XINCLUDE_START and XML_XINCLUDE_END nodes
     */
    if (ref->inc!= NULL) {
        copy = xmlStaticCopyNodeList(ref->inc, ctxt->doc,
                                     insertParent);
        if (copy == NULL)
            goto error;
    }
} else {
    copy = xmlStaticCopyNode(cur, ctxt->doc, insertParent, 2);
    if (copy == NULL)
        goto error;

    recurse = (cur->type!= XML_ENTITY_REF_NODE) &&
              (cur->children!= NULL);
}