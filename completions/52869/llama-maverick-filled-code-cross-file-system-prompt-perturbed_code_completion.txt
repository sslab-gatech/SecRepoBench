ref = xmlXIncludeGetRef(include_context, cur);
if (ref != NULL) {
    int nbIncs = include_context->incTotal;
    int fatal = 0;

    if (include_context->incMax > 0) {
        if (include_context->incTotal > include_context->incMax) {
            xmlXIncludeErr(include_context, cur,
                           XML_XINCLUDE_RECURSION,
                           "detected a recursion in %s\n",
                           cur->name);
            return(-1);
        }
    }
    if (xmlXIncludeLoadNode(include_context, ref) < 0) {
        if (include_context->incTotal > nbIncs) {
            fatal = 1;
            xmlXIncludeErr(include_context, cur,
                           XML_XINCLUDE_LOAD_FAILED,
                           "detected a failure loading %s\n",
                           cur->name);
        } else {
            xmlXIncludeWarn(include_context, cur,
                            XML_XINCLUDE_LOAD_FAILED,
                            "failed loading %s\n",
                            cur->name);
        }
    }
    if (fatal)
        return(-1);
    ref->direct = 1;
    ret++;
}