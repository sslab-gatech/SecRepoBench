if (cur->type == XML_TEXT_NODE) {
    const xmlChar *content = cur->content;
    int len;

    if (content == NULL) {
        tmp = xmlNewDocTextLen(ctxt->doc, NULL, 0);
    } else {
        len = index2;
        if ((cur == start) && (index1 > 1)) {
            content += (index1 - 1);
            len -= (index1 - 1);
        }
        tmp = xmlNewDocTextLen(ctxt->doc, content, len);
    }
    /* single sub text node selection */
    if (list == NULL)
        return(tmp);
    /* prune and return full set */
    if (level == lastLevel)
        xmlAddNextSibling(last, tmp);
    else
        xmlAddChild(last, tmp);
    break; /* break the loop since we've handled the text node */
}