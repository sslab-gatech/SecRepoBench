ref = xmlXIncludeNewRef(include_context, cur);
            if (ref == NULL) {
                xmlXIncludeErr(include_context, cur, XML_XINCLUDE_NO_MEMORY,
                               "failed to create new XInclude reference\n", NULL);
                return(-1);
            }

            if (xmlXIncludeLoadNode(include_context, ref) < 0) {
                xmlXIncludeErr(include_context, cur, XML_XINCLUDE_RECURSION,
                               "failed to load XInclude node\n", NULL);
                xmlXIncludeFreeRef(ref);
                return(-1);
            }

            ref->inc = xmlXIncludeCopyRange(include_context, ref->range);
            if (ref->inc == NULL) {
                xmlXIncludeErr(include_context, cur, XML_XINCLUDE_NO_MEMORY,
                               "failed to copy XInclude range\n", NULL);
                xmlXIncludeFreeRef(ref);
                return(-1);
            }

            ref->replace = 1; // Mark the node for replacement
            include_context->incTab[include_context->incNr++] = ref;