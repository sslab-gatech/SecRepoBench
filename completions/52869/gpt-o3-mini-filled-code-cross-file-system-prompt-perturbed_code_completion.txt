#ifdef FUZZING
    /* In fuzzing mode, avoid excessive expansion */
    if ((include_context->max_includes > 0) &&
        (include_context->incNr >= include_context->max_includes)) {
        xmlXIncludeErr(include_context, cur, XML_XINCLUDE_FUZZ_LIMIT,
                        "Reached maximum number of include expansions, skipping %s\n",
                        cur->name);
        /* Skip processing this node */
        break;
    }
#endif

ref = (xmlXIncludeRefPtr) xmlMalloc(sizeof(*ref));
if (ref == NULL) {
    xmlXIncludeErr(include_context, cur, XML_ERR_NO_MEMORY,
                    "Memory allocation failed for XInclude reference\n", NULL);
    break;
}
memset(ref, 0, sizeof(*ref));
ref->elem = cur;
ref->replace = 1; /* Mark for replacement in second phase */

if (xmlXIncludeLoadNode(include_context, ref) == 0) {
    /* Mark as a direct include expansion */
    ref->direct = 1;
    /* Add the new reference to the context's table */
    include_context->incTab = (xmlXIncludeRefPtr *)
        xmlRealloc(include_context->incTab,
                   (include_context->incNr + 1) * sizeof(ref));
    if (include_context->incTab == NULL) {
        xmlXIncludeErr(include_context, cur, XML_ERR_NO_MEMORY,
                        "Reallocation failed for XInclude reference table\n", NULL);
        xmlFree(ref);
        break;
    }
    include_context->incTab[include_context->incNr++] = ref;
} else {
    /* Failed to load the include node; free the reference */
    xmlFree(ref);
}