<MASK>
    xmlXIncludeRefPtr
    xmlXIncludeExpandNode(xmlXIncludeCtxtPtr ctxt, xmlNodePtr node) {
        xmlXIncludeRefPtr ref;
        int i;

        if (ctxt->depth >= XINCLUDE_MAX_DEPTH) {
            xmlXIncludeErr(ctxt, node, XML_XINCLUDE_RECURSION,
                           "maximum recursion depth exceeded\n", NULL);
            return(NULL);
        }

        for (i = 0; i < ctxt->incNr; i++) {
            if (ctxt->incTab[i]->elem == node) {
                if (ctxt->incTab[i]->expanding) {
                    xmlXIncludeErr(ctxt, node, XML_XINCLUDE_RECURSION,
                                   "inclusion loop detected\n", NULL);
                    return(NULL);
                }
                return(ctxt->incTab[i]);
            }
        }

        ref = xmlXIncludeAddNode(ctxt, node);
        if (ref == NULL)
            return(NULL);
        ref->expanding = 1;
        ctxt->depth++;
        xmlXIncludeLoadNode(ctxt, ref);
        ctxt->depth--;
        ref->expanding = 0;

        return(ref);
    }
</MASK>