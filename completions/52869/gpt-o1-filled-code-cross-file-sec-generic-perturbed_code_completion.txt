{
#ifdef FUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION
    /* Limit the total number of expansions in fuzzing mode */
    if (include_context->incNr >= 1024) {
        xmlXIncludeErr(include_context, cur, XML_XINCLUDE_RECURSION,
                       "Fuzzing: too many expansions, skipping\n", NULL);
        break;
    }
#endif

    /* Create a reference for this XInclude node */
    ref = xmlXIncludeNewRef(include_context, cur);
    if (ref != NULL) {
        /* Attempt to load (expand) the referenced content */
        if (xmlXIncludeLoadNode(include_context, ref) >= 0) {
            /* Mark this as a direct include */
            ref->replace = 1;

            /* Add the new reference to the context array */
            if (include_context->incNr >= include_context->incMax) {
                xmlXIncludeErr(include_context, cur, XML_XINCLUDE_RECURSION,
                               "Too many xincludes, skipping\n", NULL);
                xmlFree(ref);
            } else {
                include_context->incTab[include_context->incNr++] = ref;
                /* Increment total inclusion count */
                ret++;
            }
        } else {
            /* Loading failed; free the reference */
            xmlFree(ref);
        }
    }
}