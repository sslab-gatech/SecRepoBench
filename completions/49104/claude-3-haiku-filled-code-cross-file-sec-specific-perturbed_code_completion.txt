LockSemaphoreInfo(magic_list_semaphore);
for (p = (const MagicInfo *) GetFirstValueInLinkedList(magic_list); p != (const MagicInfo *) NULL; p = (const MagicInfo *) GetNextValueInLinkedList(magic_list))
{
  if (p->offset <= size)
  {
    if (memcmp(magic, p->magic, p->offset) == 0)
    {
      break;
    }
  }
}
if (p != (const MagicInfo *) NULL)
{
  LockSemaphoreInfo(magic_cache_semaphore);
  (void) InsertValueInSortedLinkedList(magic_cache, MagicInfoCompare, NULL, p);
  UnlockSemaphoreInfo(magic_cache_semaphore);
}
else
{
  p = (const MagicInfo *) NULL;
}
UnlockSemaphoreInfo(magic_list_semaphore);