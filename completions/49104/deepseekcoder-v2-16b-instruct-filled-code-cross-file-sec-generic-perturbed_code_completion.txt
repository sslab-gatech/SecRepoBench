if (magic == NULL)
  {
    LockSemaphoreInfo(magic_list_semaphore);
    p = SearchLinkedList(magic_list, (void *) magic, MagickCompare);
    UnlockSemaphoreInfo(magic_list_semaphore);
  }
  else
  {
    LockSemaphoreInfo(magic_cache_semaphore);
    p = SearchLinkedList(magic_cache, (void *) magic, MagickCompare);
    UnlockSemaphoreInfo(magic_cache_semaphore);
  }

  if (p != (const MagicInfo *) NULL)
  {
    LockSemaphoreInfo(magic_cache_semaphore);
    (void) InsertValueInSortedLinkedList(magic_cache, CompareMagickInfoExtent, NULL, p);
    UnlockSemaphoreInfo(magic_cache_semaphore);
  }
  return(p);