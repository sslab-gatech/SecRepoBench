LockSemaphoreInfo(magic_list_semaphore);
for (p = (const MagicInfo *) GetFirstValueInLinkedList(magic_list); p != (const MagicInfo *) NULL; p = (const MagicInfo *) GetNextValueInLinkedList(magic_list))
{
  if (p->offset <= size && size - p->offset >= p->length)
  {
    if (memcmp(magic, p->magic, p->length) == 0)
    {
      break;
    }
  }
}
if (p != (const MagicInfo *) NULL)
{
  LockSemaphoreInfo(magic_cache_semaphore);
  (void) InsertValueInSortedLinkedList(magic_cache, MagicInfoCompare, NULL, p);
  UnlockSemaphoreInfo(magic_cache_semaphore);
}
UnlockSemaphoreInfo(magic_list_semaphore);