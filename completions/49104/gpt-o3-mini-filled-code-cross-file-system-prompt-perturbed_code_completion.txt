{
  size_t
    i;

  p=(const MagicInfo *) NULL;
  if (magic != (const unsigned char *) NULL)
  {
    LockSemaphoreInfo(magic_cache_semaphore);
    for (i=0; i < GetLinkedListLength(magic_cache); i++)
    {
      const MagicInfo *magic_info=(const MagicInfo *) GetValueFromLinkedList(magic_cache,i);
      if ((size >= magic_info->offset+magic_info->length) &&
          (memcmp(magic+magic_info->offset,magic_info->magic,magic_info->length) == 0))
      {
        p=magic_info;
        break;
      }
    }
    UnlockSemaphoreInfo(magic_cache_semaphore);
  }
  LockSemaphoreInfo(magic_list_semaphore);
  if (p == (const MagicInfo *) NULL)
  {
    for (i=0; i < GetLinkedListLength(magic_list); i++)
    {
      const MagicInfo *magic_info=(const MagicInfo *) GetValueFromLinkedList(magic_list,i);
      if ((size >= magic_info->offset+magic_info->length) &&
          (memcmp(magic+magic_info->offset,magic_info->magic,magic_info->length) == 0))
      {
        p=magic_info;
        break;
      }
    }
  }
}