p=(const MagicInfo *) NULL;
  if (magic != (const unsigned char *) NULL)
    {
      LockSemaphoreInfo(magic_cache_semaphore);
      if (IsMagicCacheInstantiated() != MagickFalse)
        {
          ResetLinkedListIterator(magic_cache);
          for (p=(const MagicInfo *) GetNextNodeInLinkedList(magic_cache); p != (const MagicInfo *) NULL; p=(const MagicInfo *) GetNextNodeInLinkedList(magic_cache))
          {
            if ((size >= p->extent) && (memcmp(magic,p->magic,p->extent) == 0))
              break;
          }
        }
      UnlockSemaphoreInfo(magic_cache_semaphore);
    }
  LockSemaphoreInfo(magic_list_semaphore);
  if (p == (const MagicInfo *) NULL)
    {
      ResetLinkedListIterator(magic_list);
      for (p=(const MagicInfo *) GetNextNodeInLinkedList(magic_list); p != (const MagicInfo *) NULL; p=(const MagicInfo *) GetNextNodeInLinkedList(magic_list))
      {
        if ((size >= p->extent) && (memcmp(magic,p->magic,p->extent) == 0))
          break;
      }
    }