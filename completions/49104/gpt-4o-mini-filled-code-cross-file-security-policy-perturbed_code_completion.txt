if (magic != (unsigned char *) NULL && size > 0)
{
    LockSemaphoreInfo(magic_list_semaphore);
    for (p = (const MagicInfo *) GetFirstValueFromLinkedList(magic_list);
         p != (const MagicInfo *) NULL;
         p = (const MagicInfo *) GetNextValueFromLinkedList(magic_list))
    {
        if (size >= sizeof(p->signature) && 
            VerifyBufferBounds(magic, size, sizeof(p->signature)) &&
            CompareMagicInfo(magic, size, p) == 0)
        {
            UnlockSemaphoreInfo(magic_list_semaphore);
            return p;
        }
    }
    UnlockSemaphoreInfo(magic_list_semaphore);
}
p = (const MagicInfo *) NULL;