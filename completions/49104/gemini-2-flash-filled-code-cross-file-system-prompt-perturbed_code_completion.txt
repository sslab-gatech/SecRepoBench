(void) exception;
  if (magic_list_semaphore == (SemaphoreInfo *) NULL)
    ActivateSemaphoreInfo(&magic_list_semaphore);
  if (magic_cache_semaphore == (SemaphoreInfo *) NULL)
    ActivateSemaphoreInfo(&magic_cache_semaphore);
  if (IsMagicCacheInstantiated() == MagickFalse)
    magic_cache=NewLinkedList(0);
  if (magic == (const unsigned char *) NULL)
    return((const MagicInfo *) NULL);
  LockSemaphoreInfo(magic_cache_semaphore);
  ResetLinkedListIterator(magic_cache);
  p=(const MagicInfo *) GetFirstValueInLinkedList(magic_cache);
  while (p != (const MagicInfo *) NULL)
  {
    if ((size >= p->length) && (LocaleNCompare((char *) magic,p->magic,
         p->length) == 0))
      break;
    p=(const MagicInfo *) GetNextValueInLinkedList(magic_cache);
  }
  UnlockSemaphoreInfo(magic_cache_semaphore);
  if (p != (const MagicInfo *) NULL)
    return(p);
  LockSemaphoreInfo(magic_list_semaphore);
  ResetLinkedListIterator(magic_list);
  p=(const MagicInfo *) GetFirstValueInLinkedList(magic_list);
  while (p != (const MagicInfo *) NULL)
  {
    if ((size >= p->length) && (LocaleNCompare((char *) magic,p->magic,
         p->length) == 0))
      break;
    p=(const MagicInfo *) GetNextValueInLinkedList(magic_list);
  }