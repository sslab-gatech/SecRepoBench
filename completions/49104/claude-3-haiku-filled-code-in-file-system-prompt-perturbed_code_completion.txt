LockSemaphoreInfo(magic_list_semaphore);
if (magic == (const unsigned char *) NULL)
  {
    UnlockSemaphoreInfo(magic_list_semaphore);
    return((const MagicInfo *) NULL);
  }
ResetLinkedListIterator(magic_list);
p=(const MagicInfo *) GetNextValueInLinkedList(magic_list);
while (p != (const MagicInfo *) NULL)
{
  if (MatchesMagic(magic,size,p) != MagickFalse)
    break;
  p=(const MagicInfo *) GetNextValueInLinkedList(magic_list);
}