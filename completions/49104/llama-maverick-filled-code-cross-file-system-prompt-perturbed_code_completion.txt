assert(exception != (ExceptionInfo *) NULL);
  if (IsMagicCacheInstantiated() != MagickFalse)
    {
      /*
        Search for cached magic info.
      */
      LockSemaphoreInfo(magic_cache_semaphore);
      p=(const MagicInfo *) GetValueFromLinkedList(magic_cache,(size_t) size,
        (const unsigned char *) magic);
      if (p != (const MagicInfo *) NULL)
        {
          UnlockSemaphoreInfo(magic_cache_semaphore);
          return(p);
        }
      UnlockSemaphoreInfo(magic_cache_semaphore);
    }
  if (magic == (const unsigned char *) NULL)
    return((const MagicInfo *) NULL);
  /*
    Search for magic info.
  */
  LockSemaphoreInfo(magic_list_semaphore);
  ResetLinkedListIterator(magic_list);
  p=(const MagicInfo *) NULL;
  while ((p=(const MagicInfo *) GetNextValueInLinkedList(magic_list)) != NULL)
  {
    if (size < p->length)
      continue;
    if (memcmp(magic,p->magic,p->length) == 0)
      break;
  }