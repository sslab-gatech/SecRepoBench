assert(exception != (ExceptionInfo *) NULL);
  if (IsMagicCacheInstantiated() == MagickFalse)
    return((const MagicInfo *) NULL);
  if (magic == (const unsigned char *) NULL)
    return((const MagicInfo *) NULL);
  if (size > (size_t) MAGICK_SSIZE_MAX/2)
    return(0);
  LockSemaphoreInfo(magic_cache_semaphore);
  ResetLinkedListIterator(magic_cache);
  p=(const MagicInfo *) GetNextValueInLinkedList(magic_cache);
  for ( ; p != (const MagicInfo *) NULL; )
  {
    if (MatchesMagic(magic,size,p) != MagickFalse)
      break;
    p=(const MagicInfo *) GetNextValueInLinkedList(magic_cache);
  }
  UnlockSemaphoreInfo(magic_cache_semaphore);
  if (p != (const MagicInfo *) NULL)
    return(p);
  if (IsMagicListInstantiated(exception) == MagickFalse)
    return((const MagicInfo *) NULL);
  LockSemaphoreInfo(magic_list_semaphore);
  ResetLinkedListIterator(magic_list);
  p=(const MagicInfo *) GetNextValueInLinkedList(magic_list);
  for ( ; p != (const MagicInfo *) NULL; )
  {
    if (MatchesMagic(magic,size,p) != MagickFalse)
      break;
    p=(const MagicInfo *) GetNextValueInLinkedList(magic_list);
  }