LockSemaphoreInfo(magic_list_semaphore);
p=(const MagicInfo *) GetNextValueInLinkedList(magic_list);
while (p != (const MagicInfo *) NULL)
{
  if ((size >= p->length) && (memcmp(magic,p->magic,p->length) == 0))
    break;
  p=(const MagicInfo *) GetNextValueInLinkedList(magic_list);
}
UnlockSemaphoreInfo(magic_list_semaphore);
if (p == (const MagicInfo *) NULL)
  {
    LockSemaphoreInfo(magic_cache_semaphore);
    p=(const MagicInfo *) GetNextValueInLinkedList(magic_cache);
    while (p != (const MagicInfo *) NULL)
    {
      if ((size >= p->length) && (memcmp(magic,p->magic,p->length) == 0))
        break;
      p=(const MagicInfo *) GetNextValueInLinkedList(magic_cache);
    }
    UnlockSemaphoreInfo(magic_cache_semaphore);
  }