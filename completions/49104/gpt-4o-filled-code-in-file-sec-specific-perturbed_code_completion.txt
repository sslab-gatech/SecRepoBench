assert(exception != (ExceptionInfo *) NULL);
  if (IsMagicListInstantiated(exception) == MagickFalse)
    return((const MagicInfo *) NULL);
  LockSemaphoreInfo(magic_list_semaphore);
  if ((magic != (const unsigned char *) NULL) && (magic_cache != (LinkedListInfo *) NULL))
    {
      ResetLinkedListIterator(magic_cache);
      p=(const MagicInfo *) GetNextValueInLinkedList(magic_cache);
      while (p != (const MagicInfo *) NULL)
      {
        if (MatchesMagic(magic,size,p) != MagickFalse)
          break;
        p=(const MagicInfo *) GetNextValueInLinkedList(magic_cache);
      }
      if (p != (const MagicInfo *) NULL)
        {
          UnlockSemaphoreInfo(magic_list_semaphore);
          return(p);
        }
    }
  ResetLinkedListIterator(magic_list);
  p=(const MagicInfo *) GetNextValueInLinkedList(magic_list);
  while (p != (const MagicInfo *) NULL)
  {
    if (MatchesMagic(magic,size,p) != MagickFalse)
      break;
    p=(const MagicInfo *) GetNextValueInLinkedList(magic_list);
  }