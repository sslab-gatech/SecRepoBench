if (exception == (ExceptionInfo *) NULL)
    return((const MagicInfo *) NULL);
if ((magic_list == (LinkedListInfo *) NULL) ||
    (IsMagicCacheInstantiated() == MagickFalse))
  return((const MagicInfo *) NULL);
p=(const MagicInfo *) NULL;
if (magic != (const unsigned char *) NULL)
  {
    LockSemaphoreInfo(magic_cache_semaphore);
    p=(const MagicInfo *) GetValueFromLinkedList(magic_cache,0);
    while (p != (const MagicInfo *) NULL)
    {
      if ((size >= p->offset) &&
          (memcmp(magic+p->offset,p->magic,p->length) == 0))
        break;
      p=(const MagicInfo *) GetNextValueInLinkedList(magic_cache);
    }
    UnlockSemaphoreInfo(magic_cache_semaphore);
    if (p != (const MagicInfo *) NULL)
      return(p);
  }
LockSemaphoreInfo(magic_list_semaphore);
if (magic != (const unsigned char *) NULL)
  {
    p=(const MagicInfo *) GetValueFromLinkedList(magic_list,0);
    while (p != (const MagicInfo *) NULL)
    {
      if ((size >= p->offset) &&
          (memcmp(magic+p->offset,p->magic,p->length) == 0))
        break;
      p=(const MagicInfo *) GetNextValueInLinkedList(magic_list);
    }
  }