if (magic == (const unsigned char *) NULL)
    {
      UnlockSemaphoreInfo(magic_list_semaphore);
      if (IsMagicCacheInstantiated() != MagickFalse)
        {
          LockSemaphoreInfo(magic_cache_semaphore);
          p = (const MagicInfo *) SearchLinkedList(magic_cache,CompareMagickInfoExtent,magic);
          UnlockSemaphoreInfo(magic_cache_semaphore);
          if (p != (const MagicInfo *) NULL)
            return(p);
        }
      LockSemaphoreInfo(magic_list_semaphore);
      p = (const MagicInfo *) SearchLinkedList(magic_list,CompareMagickInfoExtent,magic);
      UnlockSemaphoreInfo(magic_list_semaphore);
      if (p != (const MagicInfo *) NULL)
        return(p);
    }
  else
    {
      if (IsMagicCacheInstantiated() != MagickFalse)
        {
          LockSemaphoreInfo(magic_cache_semaphore);
          p = (const MagicInfo *) SearchLinkedList(magic_cache,CompareMagickInfoExtent,magic);
          UnlockSemaphoreInfo(magic_cache_semaphore);
          if (p != (const MagicInfo *) NULL)
            return(p);
        }
      LockSemaphoreInfo(magic_list_semaphore);
      p = (const MagicInfo *) SearchLinkedList(magic_list,CompareMagickInfoExtent,magic);
      UnlockSemaphoreInfo(magic_list_semaphore);
      if (p != (const MagicInfo *) NULL)
        return(p);
    }