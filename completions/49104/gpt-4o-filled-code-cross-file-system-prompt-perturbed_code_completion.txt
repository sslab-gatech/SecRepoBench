assert(exception != (ExceptionInfo *) NULL);
  if ((magic_list == (LinkedListInfo *) NULL) || 
      (IsMagicCacheInstantiated() == MagickFalse))
    return((const MagicInfo *) NULL);

  p = (const MagicInfo *) NULL;
  if (magic != (const unsigned char *) NULL)
    {
      LockSemaphoreInfo(magic_cache_semaphore);
      ResetLinkedListIterator(magic_cache);
      while ((p = (const MagicInfo *) GetNextValueInLinkedList(magic_cache)) != (const MagicInfo *) NULL)
      {
        if ((size >= p->length) && 
            (memcmp(magic, p->magic, p->length) == 0))
          break;
      }
      UnlockSemaphoreInfo(magic_cache_semaphore);
      if (p != (const MagicInfo *) NULL)
        return(p);
    }

  LockSemaphoreInfo(magic_list_semaphore);
  ResetLinkedListIterator(magic_list);
  while ((p = (const MagicInfo *) GetNextValueInLinkedList(magic_list)) != (const MagicInfo *) NULL)
  {
    if ((size >= p->length) && 
        (memcmp(magic, p->magic, p->length) == 0))
      break;
  }