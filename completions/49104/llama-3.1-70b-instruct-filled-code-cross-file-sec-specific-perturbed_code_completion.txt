// Search the cached magic entries for a match.
LockSemaphoreInfo(magic_cache_semaphore);
p=GetFirstLinkedListNode(magic_cache);
while (p!= (const MagicInfo *) NULL)
{
  if (memcmp(magic,(*p)->magic,(*p)->offset) == 0)
    break;
  p=GetNextLinkedListNode(magic_cache,p);
}
UnlockSemaphoreInfo(magic_cache_semaphore);

// If no match is found in the cache, or if the magic is null, proceed to search the main magic list.
if (p == (const MagicInfo *) NULL)
{
  LockSemaphoreInfo(magic_list_semaphore);
  p=GetFirstLinkedListNode(magic_list);
  while (p!= (const MagicInfo *) NULL)
  {
    if (memcmp(magic,(*p)->magic,(*p)->offset) == 0)
      break;
    p=GetNextLinkedListNode(magic_list,p);
  }
}