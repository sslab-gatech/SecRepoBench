if (magic!= (const unsigned char *) NULL)
  {
    if (IsMagicCacheInstantiated()!= MagickFalse)
      {
        LockSemaphoreInfo(magic_cache_semaphore);
        p=FindFirstInSortedLinkedList(magic_cache,MagicInfoCompare,
          NULL,magic,size);
        if (p!= (const MagicInfo *) NULL)
          {
            UnlockSemaphoreInfo(magic_cache_semaphore);
            return(p);
          }
        UnlockSemaphoreInfo(magic_cache_semaphore);
      }
    LockSemaphoreInfo(magic_list_semaphore);
    p=FindFirstInSortedLinkedList(magic_list,MagicCompare,
      NULL,magic,size);
    if (p!= (const MagicInfo *) NULL)
      {
        UnlockSemaphoreInfo(magic_list_semaphore);
        if (IsMagicCacheInstantiated()!= MagickFalse)
          {
            LockSemaphoreInfo(magic_cache_semaphore);
            InsertValueInSortedLinkedList(magic_cache,MagicInfoCompare,
              NULL,p);
            UnlockSemaphoreInfo(magic_cache_semaphore);
          }
        return(p);
      }
    UnlockSemaphoreInfo(magic_list_semaphore);
  }
return((const MagicInfo *) NULL);