p = (const MagicInfo *) NULL;
if (magic != (const unsigned char *) NULL)
{
  LockSemaphoreInfo(magic_cache_semaphore);
  {
    const size_t count = GetNumberOfElementsInLinkedList(magic_cache);
    for (size_t i = 0; i < count; i++)
    {
      const MagicInfo *mc = (const MagicInfo *) GetValueFromLinkedList(magic_cache, i);
      if ((mc->length <= size) &&
          (memcmp(magic, mc->magic, mc->length) == 0))
      {
        p = mc;
        break;
      }
    }
  }
  UnlockSemaphoreInfo(magic_cache_semaphore);
  if (p != (const MagicInfo *) NULL)
    return p;
}
LockSemaphoreInfo(magic_list_semaphore);
{
  const size_t count = GetNumberOfElementsInLinkedList(magic_list);
  for (size_t i = 0; i < count; i++)
  {
    const MagicInfo *ml = (const MagicInfo *) GetValueFromLinkedList(magic_list, i);
    if ((ml->length <= size) &&
        (memcmp(magic, ml->magic, ml->length) == 0))
    {
      p = ml;
      break;
    }
  }
}