LockSemaphoreInfo(magic_cache_semaphore);
  for (p=GetFirstValueInLinkedList(magic_cache); p != (const MagicInfo *) NULL; 
       p=GetNextValueInLinkedList(magic_cache))
    if (p->extent <= size && memcmp(magic,p->magic,p->extent) == 0)
      {
        UnlockSemaphoreInfo(magic_cache_semaphore);
        return(p);
      }
  UnlockSemaphoreInfo(magic_cache_semaphore);
  if (magic != (const unsigned char *) NULL)
    {
      size_t
        extent;

      LockSemaphoreInfo(magic_list_semaphore);
      for (p=GetFirstValueInLinkedList(magic_list); p != (const MagicInfo *) NULL; 
           p=GetNextValueInLinkedList(magic_list))
        {
          extent=(size < p->extent ? size : p->extent);
          if (memcmp(magic,p->magic,extent) == 0)
            {
              UnlockSemaphoreInfo(magic_list_semaphore);
              return(p);
            }
        }
      UnlockSemaphoreInfo(magic_list_semaphore);
    }
  exception->severity=WarningException;
  (void) ThrowException(exception,MagickCoreException,OptionWarning,
    "NoMatchingMagic",GetImageModule(),exception->severity);