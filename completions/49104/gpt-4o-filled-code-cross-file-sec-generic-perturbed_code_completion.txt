assert(exception != (ExceptionInfo *) NULL);
  if (magic_list == (LinkedListInfo *) NULL)
    {
      (void) ThrowMagickException(exception,GetMagickModule(),ModuleError,
        "MagicListNotInitialized","`%s'","Magic list is not initialized");
      return((const MagicInfo *) NULL);
    }
  if (IsMagicCacheInstantiated() == MagickFalse)
    {
      (void) ThrowMagickException(exception,GetMagickModule(),ModuleError,
        "MagicCacheNotInstantiated","`%s'","Magic cache is not instantiated");
      return((const MagicInfo *) NULL);
    }
  LockSemaphoreInfo(magic_cache_semaphore);
  if (magic != (const unsigned char *) NULL)
    {
      p=(const MagicInfo *) GetValueFromLinkedList(magic_cache,0);
      while (p != (const MagicInfo *) NULL)
      {
        if ((size >= p->length) && 
            (memcmp(magic,p->magic,(size_t) p->length) == 0))
          {
            UnlockSemaphoreInfo(magic_cache_semaphore);
            return(p);
          }
        p=(const MagicInfo *) GetNextValueInLinkedList(magic_cache);
      }
    }
  UnlockSemaphoreInfo(magic_cache_semaphore);
  LockSemaphoreInfo(magic_list_semaphore);
  p=(const MagicInfo *) GetValueFromLinkedList(magic_list,0);
  while (p != (const MagicInfo *) NULL)
  {
    if ((size >= p->length) && 
        (memcmp(magic,p->magic,(size_t) p->length) == 0))
      break;
    p=(const MagicInfo *) GetNextValueInLinkedList(magic_list);
  }