LockSemaphoreInfo(magic_list_semaphore);
for (p=GetFirstValueInLinkedList(magic_list); p != (const MagicInfo *) NULL; p=GetNextValueInLinkedList(magic_list))
  {
    if (p->offset == 0)
      {
        if (LocaleNCompare((const char *) magic,(const char *) p->magic,p->magic_length) == 0)
          break;
      }
    else
      {
        if (size >= p->offset+p->magic_length)
          {
            if (LocaleNCompare((const char *) magic+p->offset,(const char *) p->magic,p->magic_length) == 0)
              break;
          }
      }
  }