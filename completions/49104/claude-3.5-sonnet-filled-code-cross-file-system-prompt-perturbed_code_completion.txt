assert(exception != (ExceptionInfo *) NULL);
if (magic_list == (LinkedListInfo *) NULL)
  if (MagicComponentGenesis() == MagickFalse)
    return((const MagicInfo *) NULL);
if ((magic == (const unsigned char *) NULL) || (size == 0))
  return((const MagicInfo *) NULL);
if (IsMagicCacheInstantiated() == MagickFalse)
  return((const MagicInfo *) NULL);
LockSemaphoreInfo(magic_cache_semaphore);
p=(const MagicInfo *) GetLastValueInLinkedList(magic_cache);
while (p != (const MagicInfo *) NULL)
{
  if ((size >= p->offset) &&
      (memcmp(magic+p->offset,p->magic,p->length) == 0))
    break;
  p=(const MagicInfo *) GetPreviousValueInLinkedList(magic_cache);
}
UnlockSemaphoreInfo(magic_cache_semaphore);
if (p != (const MagicInfo *) NULL)
  return(p);
if (magic_list == (LinkedListInfo *) NULL)
  return((const MagicInfo *) NULL);
LockSemaphoreInfo(magic_list_semaphore);
ResetLinkedListIterator(magic_list);
p=(const MagicInfo *) GetNextValueInLinkedList(magic_list);
while (p != (const MagicInfo *) NULL)
{
  if ((size >= p->offset) &&
      (memcmp(magic+p->offset,p->magic,p->length) == 0))
    break;
  p=(const MagicInfo *) GetNextValueInLinkedList(magic_list);
}