/* Prepare the cipher context with the provided client secret and version */
  ciphers.hp_cipher.algo = GCRY_CIPHER_AES128;
  ciphers.hp_cipher.mode = GCRY_MODE_GCM;
  if(!quic_hp_cipher_init(&ciphers.hp_cipher, GCRY_MD_SHA2_256, 16, client_secret, version)) {
    NDPI_LOG_DBG(ndpi_struct, "Error initializing HP cipher\n");
    return NULL;
  }

  /* Initialize the payload protection cipher */
  ciphers.pp_cipher.algo = GCRY_CIPHER_AES128;
  ciphers.pp_cipher.mode = GCRY_MODE_GCM;
  if(!quic_hp_cipher_init(&ciphers.pp_cipher, GCRY_MD_SHA2_256, 16, client_secret, version)) {
    NDPI_LOG_DBG(ndpi_struct, "Error initializing PP cipher\n");
    return NULL;
  }

  /* Calculate the packet number offset */
  pn_offset = 4; /* Version (1 byte) + dest_conn_id (3 bytes) */
  
  /* Determine the length of the tokens and add it to the offset */
  token_length = quic_get_token_length(version);
  pn_offset += token_length;

  /* Retrieve the payload length from the packet */
  payload_length = pntoh16(&packet->payload[1]);

  /* Log the calculated offsets and lengths for debugging */
  NDPI_LOG_DBG2(ndpi_struct, "pn_offset: %u, payload_length: %u\n", pn_offset, payload_length);