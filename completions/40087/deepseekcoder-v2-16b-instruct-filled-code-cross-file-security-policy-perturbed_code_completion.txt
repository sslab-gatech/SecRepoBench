// Prepare the cipher context with the provided client secret and version.
  // Calculate the packet number offset.
  // Determine the length of the tokens and add it to the offset.
  // Retrieve the payload length from the packet, updating the packet number offset.
  // Log the calculated offsets and lengths for debugging purposes.
  uint8_t hp_key[256/8]; /* Maximum key size is for AES256 cipher. */
  uint32_t hash_len = gcry_md_get_algo_dlen(GCRY_MD_SHA256);
  char *label = is_version_with_v1_labels(version) ? "quic hp" : "quicv2 hp";

  if(!quic_hkdf_expand_label(GCRY_MD_SHA256, secret, hash_len, label, hp_key, key_length)) {
    return 0;
  }

  return gcry_cipher_setkey(hp_cipher->hp_cipher, hp_key, key_length) == 0;
}