// Prepare the cipher context with the provided client secret and version.
quic_derive_initial_ciphers(version, client_secret, &ciphers);

// Calculate the packet number offset.
pn_offset = 1 + 4; // 1 byte for the first byte and 4 bytes for the version

// Determine the length of the tokens and add it to the offset.
token_length = packet->payload[5] + packet->payload[6 + packet->payload[5]];
pn_offset += 6 + token_length;

// Retrieve the payload length from the packet, updating the packet number offset.
payload_length = packet->payload_packet_len - pn_offset;

// Log the calculated offsets and lengths for debugging purposes.
NDPI_LOG_DBG2(ndpi_struct, "pn_offset %d payload_length %d\n", pn_offset, payload_length);