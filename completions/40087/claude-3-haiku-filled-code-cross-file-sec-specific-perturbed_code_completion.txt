// Prepare the cipher context with the provided client secret and version.
if(!quic_hp_cipher_init(&ciphers.hp_cipher, GCRY_CIPHER_AES128, 16, client_secret, version)) {
  NDPI_LOG_DBG(ndpi_struct, "Error quic_hp_cipher_init\n");
  quic_ciphers_reset(&ciphers);
  return NULL;
}

// Calculate the packet number offset.
pn_offset = dest_conn_id_len + src_conn_id_len + 1;
token_length = packet->payload[pn_offset] + (packet->payload[pn_offset + 1] << 8);
pn_offset += 2 + token_length;

// Determine the length of the tokens and add it to the offset.
payload_length = (packet->payload[pn_offset] << 0) |
                 (packet->payload[pn_offset + 1] << 8) |
                 (packet->payload[pn_offset + 2] << 16) |
                 (packet->payload[pn_offset + 3] << 24);
pn_offset += 4;

// Retrieve the payload length from the packet, updating the packet number offset.
NDPI_LOG_DBG2(ndpi_struct, "pn_offset %u payload_length %u\n", pn_offset, payload_length);