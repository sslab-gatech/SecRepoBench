/* Initialize packet number offset */
  pn_offset = dest_conn_id_len + src_conn_id_len + 5; /* 5 bytes for QUIC header */

  /* Ensure pn_offset is within bounds */
  if (pn_offset >= packet->payload_packet_len) {
    NDPI_LOG_DBG(ndpi_struct, "Invalid packet number offset: %d\n", pn_offset);
    return NULL;
  }

  /* Extract token length */
  token_length = packet->payload[pn_offset];
  pn_offset += 1;

  /* Ensure token length is within bounds */
  if (pn_offset + token_length > packet->payload_packet_len) {
    NDPI_LOG_DBG(ndpi_struct, "Invalid token length: %d\n", token_length);
    return NULL;
  }

  /* Skip token */
  pn_offset += token_length;

  /* Ensure pn_offset is still within bounds */
  if (pn_offset + 2 > packet->payload_packet_len) {
    NDPI_LOG_DBG(ndpi_struct, "Invalid payload length offset: %d\n", pn_offset);
    return NULL;
  }

  /* Extract payload length */
  payload_length = (packet->payload[pn_offset] << 8) | packet->payload[pn_offset + 1];
  pn_offset += 2;

  /* Log calculated offsets and lengths */
  NDPI_LOG_DBG2(ndpi_struct, "pn_offset: %d, token_length: %d, payload_length: %d\n",
                pn_offset, token_length, payload_length);