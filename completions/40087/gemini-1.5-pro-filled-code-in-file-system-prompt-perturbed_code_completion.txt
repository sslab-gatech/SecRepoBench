if (!quic_ciphers_prepare(&ciphers, GCRY_MD_SHA256, GCRY_CIPHER_AES128,
                           GCRY_CIPHER_MODE_GCM, client_secret, version)) {
    NDPI_LOG_DBG(ndpi_struct, "Error quic_ciphers_prepare\n");
    return NULL;
  }

  pn_offset = 1 + 4 + 1 /* DCID Len */ + dest_conn_id_len + 1 /* SCID Len */ + src_conn_id_len;
  offset = pn_offset;
  if (pub_bit2) {
    offset += quic_len(&packet->payload[offset], &token_length);
    pn_offset += token_length;
  }
  offset += quic_len(&packet->payload[offset], &payload_length);
  pn_offset += quic_len_buffer_still_required(packet->payload[offset - quic_len(&packet->payload[offset], &payload_length)]);

  NDPI_LOG_DBG2(ndpi_struct, "token_length %lu payload_length %lu pn_offset %u\n",
                token_length, payload_length, pn_offset);