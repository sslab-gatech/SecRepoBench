pn_offset = dest_conn_id_len + src_conn_id_len + 5;
  if (pn_offset >= packet->payload_packet_len) {
    NDPI_LOG_DBG(ndpi_struct, "Invalid packet number offset\n");
    return NULL;
  }

  token_length = packet->payload[pn_offset - 1];
  pn_offset += token_length;
  if (pn_offset >= packet->payload_packet_len) {
    NDPI_LOG_DBG(ndpi_struct, "Invalid token length\n");
    return NULL;
  }

  payload_length = packet->payload[pn_offset] << 8 | packet->payload[pn_offset + 1];
  pn_offset += 2;
  if (pn_offset >= packet->payload_packet_len) {
    NDPI_LOG_DBG(ndpi_struct, "Invalid payload length\n");
    return NULL;
  }

  NDPI_LOG_DBG2(ndpi_struct, "pn_offset %u, token_length %llu, payload_length %llu\n",
                pn_offset, token_length, payload_length);