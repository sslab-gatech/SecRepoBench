// Prepare the cipher context with the provided client secret and version.
  if (!quic_hp_cipher_init(&ciphers.hp_cipher, GCRY_MD_SHA256, 16, client_secret, version)) {
    NDPI_LOG_DBG(ndpi_struct, "Error initializing HP cipher\n");
    return NULL;
  }

  // Calculate the packet number offset.
  pn_offset = 1 + (first_byte >> 2);
  
  // Determine the length of the tokens and add it to the offset.
  token_length = (first_byte & 0x03) + 1; // Assuming token length is encoded in the first byte
  pn_offset += token_length;

  // Retrieve the payload length from the packet, updating the packet number offset.
  payload_length = packet->payload_packet_len - pn_offset - 16; // 16 bytes for the auth tag

  // Log the calculated offsets and lengths for debugging purposes.
  NDPI_LOG_DBG(ndpi_struct, "Calculated pn_offset: %d, payload_length: %d\n", pn_offset, payload_length);