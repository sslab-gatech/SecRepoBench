/* Initialize header and payload protection ciphers with the derived client secret. */
if(quic_derive_aes_hp_ciphers(client_secret, version, &ciphers.hp_cipher, ciphers.hp_iv) != 0
   || quic_derive_aes_pp_ciphers(client_secret, version, &ciphers.pp_cipher, ciphers.pp_iv) != 0) {
  NDPI_LOG_DBG(ndpi_struct, "Error deriving initial ciphers\n");
  return NULL;
}

/* Calculate the offset to the Packet Number by skipping version, DCID, and SCID. */
pn_offset = 7 + dest_conn_id_len + src_conn_id_len;

/* Read the token length as a varint and skip the token bytes. */
pn_offset += quic_len(&packet->payload[pn_offset], &token_length);
pn_offset += token_length;

/* Read the payload length as a varint. */
pn_offset += quic_len(&packet->payload[pn_offset], &payload_length);

NDPI_LOG_DBG2(ndpi_struct,
              "pn_offset %u, token_length %"PRIu64", payload_length %"PRIu64"\n",
              pn_offset, token_length, payload_length);