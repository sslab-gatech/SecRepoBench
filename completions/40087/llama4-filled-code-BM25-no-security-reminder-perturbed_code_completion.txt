// Prepare the cipher context with the provided client secret and version.
quic_hp_cipher_init(&ciphers.hp_cipher, GCRY_CIPHER_AES128, 16, client_secret, version);
quic_pp_cipher_init(&ciphers.pp_cipher, GCRY_CIPHER_AES128, 16, client_secret, version);

// Calculate the packet number offset.
pn_offset = 1 + (first_byte & 0x3f);

// Determine the length of the tokens and add it to the offset.
token_length = 0;
if (dest_conn_id_len) token_length += dest_conn_id_len + 1;
if (src_conn_id_len) token_length += src_conn_id_len + 1;
offset = pn_offset + token_length;

// Retrieve the payload length from the packet, updating the packet number offset.
payload_length = ntohs(*(uint16_t*)&packet->payload[offset]);
offset += 2;

// Log the calculated offsets and lengths for debugging purposes.
NDPI_LOG_DBG(ndpi_struct, "pn_offset=%u payload_length=%u offset=%u token_length=%u", 
             pn_offset, payload_length, offset, token_length);