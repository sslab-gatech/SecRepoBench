// Initialize the header protection cipher
  if (!quic_hp_cipher_init(&ciphers.hp_cipher, GCRY_MD_SHA256, 16, client_secret, version)) {
    NDPI_LOG_DBG(ndpi_struct, "Error initializing header protection cipher\n");
    return NULL;
  }

  // Initialize the payload protection cipher
  if (!quic_pp_cipher_init(&ciphers.pp_cipher, GCRY_MD_SHA256, 16, client_secret, version)) {
    NDPI_LOG_DBG(ndpi_struct, "Error initializing payload protection cipher\n");
    quic_ciphers_reset(&ciphers);
    return NULL;
  }

  // Calculate the packet number offset
  pn_offset = 0;
  if (src_conn_id_len > 0) {
    pn_offset += src_conn_id_len + 1;
  }
  pn_offset += dest_conn_id_len + 1;

  // Determine the length of the tokens and add it to the offset
  token_length = packet->payload[pn_offset];
  pn_offset += 1 + token_length;

  // Retrieve the payload length from the packet, updating the packet number offset
  payload_length = packet->payload_packet_len - pn_offset;

  // Log the calculated offsets and lengths for debugging purposes
  NDPI_LOG_DBG2(ndpi_struct, "pn_offset: %u, payload_length: %lu\n", pn_offset, payload_length);