/* Prepare the cipher context with the provided client secret and version. */
  if(!quic_hp_cipher_init(&ciphers.hp_cipher, GCRY_MD_SHA256, 16, client_secret, version)) {
    NDPI_LOG_DBG(ndpi_struct, "Error initializing HP cipher\n");
    return NULL;
  }

  /* Calculate the packet number offset. */
  pn_offset = pntoh64(packet->payload + 12);

  /* Determine the length of the tokens and add it to the offset. */
  token_length = (packet->payload[14] & 3) + 1;
  offset = pn_offset + token_length;

  /* Retrieve the payload length from the packet, updating the packet number offset. */
  payload_length = pntoh32(packet->payload + offset);
  offset += 4;

  /* Log the calculated offsets and lengths for debugging purposes. */
  NDPI_LOG_DBG2(ndpi_struct, "pn_offset %" PRIu64 " token_length %" PRIu64 " payload_length %" PRIu32 " offset %" PRIu32 "\n",
                pn_offset, token_length, payload_length, offset);