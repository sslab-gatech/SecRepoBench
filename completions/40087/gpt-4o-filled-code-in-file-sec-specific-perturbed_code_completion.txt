if (!quic_ciphers_prepare(&ciphers, GCRY_MD_SHA256, GCRY_CIPHER_AES128, GCRY_CIPHER_MODE_GCM, client_secret, version)) {
    NDPI_LOG_DBG(ndpi_struct, "Error quic_ciphers_prepare\n");
    return NULL;
  }

  pn_offset = 6 + dest_conn_id_len + 1 + src_conn_id_len + 2;
  if (pn_offset >= packet->payload_packet_len) {
    NDPI_LOG_DBG(ndpi_struct, "Invalid packet number offset\n");
    quic_ciphers_reset(&ciphers);
    return NULL;
  }

  if (!quic_len(&packet->payload[pn_offset], &token_length)) {
    NDPI_LOG_DBG(ndpi_struct, "Error reading token length\n");
    quic_ciphers_reset(&ciphers);
    return NULL;
  }
  pn_offset += token_length + 2;

  if (!quic_len(&packet->payload[pn_offset], &payload_length)) {
    NDPI_LOG_DBG(ndpi_struct, "Error reading payload length\n");
    quic_ciphers_reset(&ciphers);
    return NULL;
  }
  pn_offset += 2;