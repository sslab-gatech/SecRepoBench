if (packet->payload_length < MIN_OPENVPN_PAYLOAD_LENGTH) {
    return; // Not enough data to analyze
  }

  if (packet->tcp != NULL) {
    ovpn_payload += TCP_HEADER_SIZE; // Adjust for TCP header
  }

  operationcode = ovpn_payload[0];
  if (packet->udp != NULL) {
    if (flow->openvpn_counter == 0 && operationcode == OPENVPN_CLIENT_HELLO) {
      // First packet, check for specific length and operation code
      if (packet->payload_length == EXPECTED_OPENVPN_LENGTH) {
        // Identify as OpenVPN
        flow->detected_protocol_stack[0] = NDPI_PROTOCOL_OPENVPN;
        flow->openvpn_counter++;
        return;
      }
    } else if (flow->openvpn_counter < MAX_OPENVPN_COUNTER && operationcode == OPENVPN_CLIENT_RESET) {
      // Check for client reset
      // Extract session ID logic here
      // ...
      flow->openvpn_counter++;
      return;
    } else if (flow->openvpn_counter < MAX_OPENVPN_COUNTER && operationcode == OPENVPN_SERVER_RESET) {
      // Check for server reset and validate session ID
      // ...
      flow->openvpn_counter++;
      return;
    }
  }

  // If we reach here, detection failed
  flow->detected_protocol_stack[0] = NDPI_PROTOCOL_UNKNOWN;