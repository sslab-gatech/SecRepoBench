if (packet->payload_length < 1) {
    return; // Not enough data to analyze
  }

  operationcode = ovpn_payload[0];

  if (packet->tcp != NULL) {
    // Adjust payload pointer for TCP
    ovpn_payload += 1; // Assuming we skip the first byte for TCP
    packet->payload_length -= 1; // Decrease the length accordingly
  }

  if (packet->payload_length < 1) {
    return; // Not enough data after adjustment
  }

  if (flow->openvpn_counter == 0) {
    if (operationcode == EXPECTED_OPERATION_CODE && packet->payload_length == EXPECTED_LENGTH) {
      // Identify as OpenVPN
      flow->detected_protocol_stack[0] = NDPI_PROTOCOL_OPENVPN;
    }
  } else if (flow->openvpn_counter < THRESHOLD) {
    if (operationcode == CLIENT_RESET_CODE) {
      // Attempt to extract session ID
      if (packet->payload_length >= SESSION_ID_LENGTH) {
        session_remote = ovpn_payload + 1; // Assuming session ID starts after operation code
        // Store session ID logic here
      }
    }
  } else if (flow->openvpn_counter < ANOTHER_THRESHOLD) {
    if (operationcode == SERVER_RESET_CODE) {
      // Verify session ID matches
      if (session_remote_matches) {
        flow->detected_protocol_stack[0] = NDPI_PROTOCOL_OPENVPN;
      } else {
        failed = 1; // Mark attempt as failed
      }
    }
  }

  flow->openvpn_counter++;

  if (failed) {
    flow->detected_protocol_stack[0] = NDPI_PROTOCOL_UNKNOWN; // Exclude protocol
  }