// Analyze the packet payload to determine if it might be an OpenVPN packet.
  if (packet->payload_packet_len >= 4) {
    operationcode = ovpn_payload[2];
    if (packet->udp != NULL) {
      if (packet->payload_packet_len >= 12 && operationcode == 1) { // Client Hello
        // Check if it's the first packet in the flow and matches the criteria
        if (flow->openvpn_counter == 0) {
          // Extract session ID if available
          if (packet->payload_packet_len > 12) {
            session_remote = ovpn_payload + 12;
            alen = session_remote[0];
            if (alen > 0 && alen <= 32) { // Valid session ID length
              memcpy(flow->session_id, session_remote + 1, alen);
              flow->session_id[alen] = '\0'; // Null-terminate the session ID
            }
          }
          ndpi_set_detected_protocol(ndpi_struct, flow, NDPI_PROTOCOL_OPENVPN, NDPI_PROTOCOL_UNKNOWN);
        } else {
          failed = 1;
        }
      } else if (operationcode == 2) { // Server Hello
        if (flow->openvpn_counter > 0 && flow->openvpn_counter < 10) {
          // Verify session ID
          if (flow->session_id[0] != '\0' && memcmp(flow->session_id, ovpn_payload + 12, strlen(flow->session_id)) == 0) {
            ndpi_set_detected_protocol(ndpi_struct, flow, NDPI_PROTOCOL_OPENVPN, NDPI_PROTOCOL_UNKNOWN);
          } else {
            failed = 1;
          }
        } else {
          failed = 1;
        }
      } else if (operationcode == 3) { // Client Key Exchange
        // Additional checks for Client Key Exchange
      } else if (operationcode == 4) { // Server Key Exchange
        // Additional checks for Server Key Exchange
      } else if (operationcode == 5) { // Client Certificate
        // Additional checks for Client Certificate
      } else if (operationcode == 6) { // Server Certificate
        // Additional checks for Server Certificate
      } else if (operationcode == 7) { // Client Finished
        // Additional checks for Client Finished
      } else if (operationcode == 8) { // Server Finished
        // Additional checks for Server Finished
      } else if (operationcode == 9) { // Client Diffie-Hellman Public
        // Additional checks for Client Diffie-Hellman Public
      } else if (operationcode == 10) { // Server Diffie-Hellman Public
        // Additional checks for Server Diffie-Hellman Public
      } else if (operationcode == 11) { // Client Padding
        // Additional checks for Client Padding
      } else if (operationcode == 12) { // Server Padding
        // Additional checks for Server Padding
      } else if (operationcode == 13) { // Client Change Cipher Spec
        // Additional checks for Client Change Cipher Spec
      } else if (operationcode == 14) { // Server Change Cipher Spec
        // Additional checks for Server Change Cipher Spec
      } else if (operationcode == 15) { // Client Alert
        // Additional checks for Client Alert
      } else if (operationcode == 16) { // Server Alert
        // Additional checks for Server Alert
      } else if (operationcode == 17) { // Client Handshake
        // Additional checks for Client Handshake
      } else if (operationcode == 18) { // Server Handshake
        // Additional checks for Server Handshake
      } else if (operationcode == 19) { // Client Encrypted
        // Additional checks for Client Encrypted
      } else if (operationcode == 20) { // Server Encrypted
        // Additional checks for Server Encrypted
      } else if (operationcode == 21) { // Client Heartbeat
        // Additional checks for Client Heartbeat
      } else if (operationcode == 22) { // Server Heartbeat
        // Additional checks for Server Heartbeat
      }
    } else if (packet->tcp != NULL) {
      // Additional checks for TCP
    }
  }

  // Increment the flow's OpenVPN counter after processing
  if (!failed) {
    flow->openvpn_counter++;
  } else {
    ndpi_exclude_protocol(ndpi_struct, flow, NDPI_PROTOCOL_OPENVPN);
  }