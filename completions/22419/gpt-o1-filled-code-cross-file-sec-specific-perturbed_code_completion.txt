u_int8_t realm_len;
if((realm_offset + 1) < packet->payload_packet_len) {
  realm_len = packet->payload[realm_offset];
  if((realm_offset + 1 + realm_len) <= packet->payload_packet_len) {
    char realm_str[48];
    u_int16_t copy_len = (realm_len < (sizeof(realm_str) - 1)) ? realm_len : (sizeof(realm_str) - 1);

    strncpy(realm_str, (char*)&packet->payload[realm_offset + 1], copy_len);
    realm_str[copy_len] = '\0';

    for(i = 0; i < copy_len; i++)
      realm_str[i] = tolower((unsigned char)realm_str[i]);

    snprintf(kerberos_flow->protos.kerberos.domain,
             sizeof(kerberos_flow->protos.kerberos.domain),
             "%s", realm_str);
  }
}