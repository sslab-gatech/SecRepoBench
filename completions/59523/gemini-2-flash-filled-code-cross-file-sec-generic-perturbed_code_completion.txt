{
        if (strEQc (f->type, "TFv"))
          {
            size_t len = f->size - 1;
            char *str = (char*)*(char**)value;
            if (str)
              {
                char *new_str = (char*)malloc (f->size);
                if (!new_str)
                  return;
                memset (new_str, 0, f->size);
                strncpy (new_str, str, len); // ensure null termination
                if (*(char**)old)
                  free (*(char**)old);
                memcpy (old, &new_str, sizeof (char*));
              }
            else
              {
                if (*(char**)old)
                  free (*(char**)old);
                memcpy (old, value, sizeof (char*));
              }
          }
        else if (f->is_string && versiontype < R_13b1)
          {
            char *str = (char*)*(char**)value;
            if (str)
              {
                size_t len = strlen (str);
                char *new_str = (char*)malloc (len + 1);
                if (!new_str)
                  return;
                strcpy (new_str, str);
                if (*(char**)old)
                  free (*(char**)old);
                memcpy (old, &new_str, sizeof (char*));
              }
            else
              {
                if (*(char**)old)
                  free (*(char**)old);
                memcpy (old, value, sizeof (char*));
              }
          }
        else if (f->is_string && is_utf8)
          {
            const char *utf8_str = *(const char **)value;
            if (utf8_str)
              {
                size_t wlen = mbstowcs (NULL, utf8_str, 0);
                if (wlen != (size_t)-1)
                  {
                    wchar_t *wstr = (wchar_t *)malloc ((wlen + 1) * sizeof (wchar_t));
                    if (!wstr)
                      return;
                    mbstowcs (wstr, utf8_str, wlen + 1);
                    if (*(char**)old)
                      free (*(char**)old);
                    memcpy (old, &wstr, sizeof (char*));
                  }
                else
                  {
                    // Handle error: UTF-8 conversion failed
                    if (*(char**)old)
                      free (*(char**)old);
                    *(char**)old = NULL;
                  }
              }
            else
              {
                if (*(char**)old)
                  free (*(char**)old);
                memcpy (old, value, sizeof (char*));
              }
          }
        else
          {
            char *str = (char*)*(char**)value;
            if (str)
              {
                size_t len = strlen (str);
                char *new_str = (char*)malloc (len + 1);
                if (!new_str)
                  return;
                strcpy (new_str, str);
                if (*(char**)old)
                  free (*(char**)old);
                memcpy (old, &new_str, sizeof (char*));
              }
            else
              {
                if (*(char**)old)
                  free (*(char**)old);
                memcpy (old, value, sizeof (char*));
              }
          }
      }