// Allocate memory and copy the string from 'value' to a new memory block,
// accounting for both fixed-length and dynamically allocated strings.
// If the string is fixed-length (TFv), allocate memory according to the field's size
// and copy the string with consideration for null-termination.
// For ASCII strings with specific DWG versions, allocate memory based on
// the length of the input string and copy it accordingly.
// For wide character strings, convert UTF-8 encoded strings to a wide character format
// if necessary, and allocate memory for the wide string before copying it.
// If the field type is not TF and DWG version conditions are met, perform these conversions.
// In all cases, update the pointer in 'old' to the newly allocated string memory,
// ensuring the previous memory is freed to avoid memory leaks.
if (strEQc (f->type, "TFv"))
{
  // Allocate memory for the fixed-length string
  char *new_value = (char *)malloc(f->size);
  if (new_value)
  {
    memcpy(new_value, value, f->size - 1); // Copy the string and null-terminate
    new_value[f->size - 1] = '\0'; // Ensure null-termination
    free(old); // Free the previous memory
    memcpy(old, &new_value, sizeof(char*)); // Update the pointer in 'old'
  }
}
else if (strEQc (f->type, "TF"))
{
  // Allocate memory for the ASCII string based on its length
  char *new_value = (char *)malloc(strlen((char *)value) + 1);
  if (new_value)
  {
    strcpy(new_value, (char *)value); // Copy the string
    free(old); // Free the previous memory
    memcpy(old, &new_value, sizeof(char*)); // Update the pointer in 'old'
  }
}
else if (strEQc (f->type, "WCS"))
{
  // Convert UTF-8 encoded string to wide character string
  wchar_t *wide_value = utf8_to_wchar((char *)value);
  if (wide_value)
  {
    // Allocate memory for the wide character string
    wchar_t *new_value = (wchar_t *)malloc((wcslen(wide_value) + 1) * sizeof(wchar_t));
    if (new_value)
    {
      wcscpy(new_value, wide_value); // Copy the wide string
      free(old); // Free the previous memory
      memcpy(old, &new_value, sizeof(wchar_t*)); // Update the pointer in 'old'
      free(wide_value); // Free the UTF-8 converted memory
    }
  }
}
else
{
  // For other field types, just copy the value
  memcpy(old, value, f->size);
}