if (is_utf8)
{
  size_t len = strlen((const char*)value) + 1;
  char* new_str = malloc(len);
  strcpy(new_str, (const char*)value);
  *(char**)old = new_str;
}
else
{
  size_t len = strlen((const char*)value) + 1;
  wchar_t* new_wstr = malloc(len * sizeof(wchar_t));
  mbstowcs(new_wstr, (const char*)value, len);
  *(wchar_t**)old = new_wstr;
}