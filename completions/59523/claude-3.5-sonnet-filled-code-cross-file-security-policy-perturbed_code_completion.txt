if (strEQc(f->type, "TFv"))
{
    size_t len = strlen(*(const char**)value);
    char *new_str = (char*)calloc(f->size + 1, sizeof(char));
    if (!new_str)
        return;
    strncpy(new_str, *(const char**)value, f->size);
    new_str[f->size] = '\0';
    *(char**)old = new_str;
}
else if (f->type[0] == 'T' && f->type[1] == 'F')
{
    if (dwg->header.version < R_2007 || !is_utf8)
    {
        size_t len = strlen(*(const char**)value);
        char *new_str = (char*)malloc(len + 1);
        if (!new_str)
            return;
        strcpy(new_str, *(const char**)value);
        *(char**)old = new_str;
    }
    else
    {
        BITCODE_TU wstr = bit_utf8_to_TU(*(const char**)value, 0);
        if (!wstr)
            return;
        size_t wlen = wcslen(wstr);
        BITCODE_TU new_wstr = (BITCODE_TU)calloc(wlen + 1, sizeof(BITCODE_TU));
        if (!new_wstr)
        {
            free(wstr);
            return;
        }
        wcscpy(new_wstr, wstr);
        free(wstr);
        *(BITCODE_TU*)old = new_wstr;
    }
}
else
{
    memcpy(old, value, f->size);
}