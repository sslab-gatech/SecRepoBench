{
          char *new_str = NULL;
          if (f->size > 0)
            {
              new_str = malloc (f->size + 1); // Allocate with +1 for null terminator
              if (!new_str) return; // Handle allocation failure
              memcpy (new_str, value, f->size);
              new_str[f->size] = '\0'; // Ensure null-termination
            }
          else if (versiontype < R_13b1 && strncmp (f->type, "TF", 2) == 0)
            {
              size_t len = strlen ((const char *)value);
              new_str = malloc (len + 1); // Allocate with +1 for null terminator
              if (!new_str) return; // Handle allocation failure
              strcpy (new_str, (const char *)value);
            }
          else if (is_utf8 && versiontype >= R_2007)
            {
              size_t wlen = utf8_to_wcs_len ((const char*)value);
              new_str = malloc ((wlen + 1) * sizeof(wchar_t)); // Allocate for wide chars + null
              if (!new_str) return; // Handle allocation failure
              utf8_to_wcs ((wchar_t*)new_str, (const char*)value);
            }
          if (new_str)
            {
              if (*(char**)old) free (*(char**)old);
              *(char**)old = new_str;
            }
        }