if (strEQc (f->type, "TFv"))
{
  // Allocate memory and copy the string from 'value' to a new memory block,
  // accounting for both fixed-length and dynamically allocated strings.
  // If the string is fixed-length (TFv), allocate memory according to the field's size
  // and copy the string with consideration for null-termination.
  // For ASCII strings with specific DWG versions, allocate memory based on
  // the length of the input string and copy it accordingly.
  // For wide character strings, convert UTF-8 encoded strings to a wide character format
  // if necessary, and allocate memory for the wide string before copying it.
  // If the field type is not TF and DWG version conditions are met, perform these conversions.
  // In all cases, update the pointer in 'old' to the newly allocated string memory,
  // ensuring the previous memory is freed to avoid memory leaks.
  size_t value_len = strlen((const char*)value);
  char *new_value = (char *)malloc(value_len + 1);
  if (new_value == NULL) {
    // Handle memory allocation failure
    return;
  }
  memcpy(new_value, value, value_len + 1);
  if (*(char**)value) {
    free(old);
  }
  memcpy(old, &new_value, sizeof(char*));
}
else
{
  size_t size = f->size;
  if (f->dxf == 160 && strEQc(fieldname, "preview_size") && dwg->header.version < R_2010)
  {
    size = 4;
  }
  char *new_value = (char *)malloc(size);
  if (new_value == NULL) {
    // Handle memory allocation failure
    return;
  }
  memcpy(new_value, value, size);
  if (f->is_malloc) {
    free(old);
  }
  memcpy(old, &new_value, sizeof(char*));
}