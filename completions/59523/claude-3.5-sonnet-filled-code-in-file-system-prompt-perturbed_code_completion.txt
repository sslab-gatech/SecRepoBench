{
  size_t len = strlen(*(char**)value);
  char *new_str = (char*)malloc(f->size);
  if (new_str)
    {
      strncpy(new_str, *(char**)value, f->size - 1);
      new_str[f->size - 1] = '\0';
      *(char**)old = new_str;
    }
}
else if (strEQc (f->type, "T") || strEQc (f->type, "TV"))
{
  if (dwg_version < R_2007 || !is_utf8)
    {
      size_t len = strlen(*(char**)value) + 1;
      char *new_str = (char*)malloc(len);
      if (new_str)
        {
          strcpy(new_str, *(char**)value);
          *(char**)old = new_str;
        }
    }
  else // R_2007+ and UTF-8
    {
      BITCODE_TU wstr = bit_utf8_to_TU(*(char**)value);
      if (wstr)
        {
          *(BITCODE_TU*)old = wstr;
        }
    }
}