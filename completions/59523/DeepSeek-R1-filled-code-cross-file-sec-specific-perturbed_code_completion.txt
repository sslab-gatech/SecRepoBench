char **old_ptr = (char **)old;
        if (*old_ptr)
            free(*old_ptr);

        if (strEQc(f->type, "TFv")) {
            *old_ptr = (char *)malloc(f->size);
            if (*old_ptr) {
                strncpy(*old_ptr, *(char **)value, f->size - 1);
                (*old_ptr)[f->size - 1] = '\0';
            }
        } else if (versiontype < R_2004) {
            const char *src = *(char **)value;
            size_t len = strlen(src) + 1;
            *old_ptr = (char *)malloc(len);
            if (*old_ptr)
                strncpy(*old_ptr, src, len);
        } else {
            if (is_utf8) {
                const char *src = *(char **)value;
                size_t wlen = mbstowcs(NULL, src, 0) + 1;
                wchar_t *wstr = (wchar_t *)malloc(wlen * sizeof(wchar_t));
                if (wstr) {
                    mbstowcs(wstr, src, wlen);
                    *old_ptr = (char *)wstr;
                }
            } else {
                const wchar_t *src = *(wchar_t **)value;
                size_t wlen = wcslen(src) + 1;
                wchar_t *wstr = (wchar_t *)malloc(wlen * sizeof(wchar_t));
                if (wstr)
                    wcscpy(wstr, src);
                *old_ptr = (char *)wstr;
            }
        }