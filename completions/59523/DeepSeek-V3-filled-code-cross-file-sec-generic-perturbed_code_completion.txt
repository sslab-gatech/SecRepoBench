char *new_str = NULL;
        if (strEQc (f->type, "TFv"))
          {
            new_str = (char *)malloc (f->size);
            if (!new_str)
              return;
            strncpy (new_str, *(char **)value, f->size - 1);
            new_str[f->size - 1] = '\0';
          }
        else if (is_utf8 && versiontype >= R_2007)
          {
            size_t len = strlen (*(char **)value) + 1;
            new_str = (char *)malloc (len * 2);
            if (!new_str)
              return;
            // Convert UTF-8 to wide char (simplified example)
            // In real code, use proper conversion functions like mbstowcs
            for (size_t i = 0; i < len; i++)
              {
                new_str[i * 2] = (*(char **)value)[i];
                new_str[i * 2 + 1] = 0;
              }
          }
        else
          {
            size_t len = strlen (*(char **)value) + 1;
            new_str = (char *)malloc (len);
            if (!new_str)
              return;
            strcpy (new_str, *(char **)value);
          }
        if (*(char **)old)
          free (*(char **)old);
        *(char **)old = new_str;