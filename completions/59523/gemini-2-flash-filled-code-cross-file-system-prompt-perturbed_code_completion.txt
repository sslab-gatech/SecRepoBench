{
        if (strEQc (f->type, "TFv"))
          {
            size_t len = f->size - 1;
            char *str = (char*)value;
            char *new_str = (char*)malloc (f->size);
            if (!new_str)
              return;
            memset (new_str, 0, f->size);
            strncpy (new_str, str, len);
            memcpy (old, &new_str, sizeof (char*));
          }
        else if (!strEQc (f->type, "TF") && versiontype < R_13b1)
          {
            const char *str = *(const char**)value;
            if (str)
              {
                size_t len = strlen (str) + 1;
                char *new_str = (char*)malloc (len);
                if (!new_str)
                  return;
                memcpy (new_str, str, len);
                if (*(char**)old)
                  free (*(char**)old);
                memcpy (old, &new_str, sizeof (char*));
              }
            else
              {
                if (*(char**)old)
                  free (*(char**)old);
                memcpy (old, value, sizeof (char*));
              }
          }
        else
          {
            const char *str = *(const char**)value;
            if (is_utf8)
              {
                size_t wlen = utf8_to_wchar (NULL, 0, str, 0);
                wchar_t *wstr = (wchar_t*)malloc ((wlen + 1) * sizeof (wchar_t));
                if (!wstr)
                  return;
                utf8_to_wchar (wstr, wlen + 1, str, 0);
                if (*(wchar_t**)old)
                  free (*(wchar_t**)old);
                memcpy (old, &wstr, sizeof (wchar_t*));
              }
            else
              {
                if (str)
                  {
                    size_t len = strlen (str) + 1;
                    char *new_str = (char*)malloc (len);
                    if (!new_str)
                      return;
                    memcpy (new_str, str, len);
                    if (*(char**)old)
                      free (*(char**)old);
                    memcpy (old, &new_str, sizeof (char*));
                  }
                else
                  {
                    if (*(char**)old)
                      free (*(char**)old);
                    memcpy (old, value, sizeof (char*));
                  }
              }
          }
      }