{
  size_t size = f->size;
  if (size <= 0)
    return;
  
  const char *str = *(const char**)value;
  
  // Free existing memory
  if (*(char**)old)
    free (*(char**)old);
  
  // Allocate memory for the fixed-size string
  *(char**)old = (char*)calloc (1, size);
  if (!*(char**)old)
    return; // Memory allocation failed
  
  // Copy the string data, handling UTF-8 if needed
  if (is_utf8 && versiontype < R_2007)
  {
    // Convert UTF-8 to ASCII for older DWG versions
    size_t i, j;
    for (i = 0, j = 0; str[i] && j < size - 1; i++)
    {
      // Simple conversion: skip UTF-8 continuation bytes
      if ((str[i] & 0xC0) != 0x80)
        (*(char**)old)[j++] = (str[i] & 0x80) ? '?' : str[i];
    }
    (*(char**)old)[j] = '\0';
  }
  else
  {
    // Copy with length limit
    strncpy (*(char**)old, str, size - 1);
    (*(char**)old)[size - 1] = '\0'; // Ensure null termination
  }
}