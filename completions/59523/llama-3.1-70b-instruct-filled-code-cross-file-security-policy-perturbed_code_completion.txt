// Allocate memory and copy the string from 'value' to a new memory block,
// accounting for both fixed-length and dynamically allocated strings.
// If the string is fixed-length (TFv), allocate memory according to the field's size
// and copy the string with consideration for null-termination.
// For ASCII strings with specific DWG versions, allocate memory based on
// the length of the input string and copy it accordingly.
// For wide character strings, convert UTF-8 encoded strings to a wide character format
// if necessary, and allocate memory for the wide string before copying it.
// If the field type is not TF and DWG version conditions are met, perform these conversions.
// In all cases, update the pointer in 'old' to the newly allocated string memory,
// ensuring the previous memory is freed to avoid memory leaks.

// Check if the field type is TFv
if (strEQc (f->type, "TFv"))
  {
    // Allocate memory according to the field's size
    char *new_str = malloc (f->size + 1);
    if (!new_str)
      {
        // Handle memory allocation error
        return;
      }
    // Copy the string with consideration for null-termination
    strncpy (new_str, value, f->size);
    new_str[f->size] = '\0';
    // Update the pointer in 'old' to the newly allocated string memory
    free (*(char **)old);
    *(char **)old = new_str;
  }
// Check if the field type is TF and DWG version is R_13 or later
else if (strEQc (f->type, "TF") && versiontype >= R_13)
  {
    // Allocate memory based on the length of the input string
    size_t len = strlen (value) + 1;
    char *new_str = malloc (len);
    if (!new_str)
      {
        // Handle memory allocation error
        return;
      }
    // Copy the string
    strcpy (new_str, value);
    // Update the pointer in 'old' to the newly allocated string memory
    free (*(char **)old);
    *(char **)old = new_str;
  }
// Check if the field type is TF and DWG version is earlier than R_13
else if (strEQc (f->type, "TF") && versiontype < R_13)
  {
    // Allocate memory based on the length of the input string
    size_t len = strlen (value) + 1;
    char *new_str = malloc (len);
    if (!new_str)
      {
        // Handle memory allocation error
        return;
      }
    // Copy the string
    strcpy (new_str, value);
    // Update the pointer in 'old' to the newly allocated string memory
    free (*(char **)old);
    *(char **)old = new_str;
  }
// Check if the field type is not TF and DWG version conditions are met
else if (!strEQc (f->type, "TF") && versiontype >= R_13)
  {
    // Convert UTF-8 encoded strings to a wide character format if necessary
    if (is_utf8)
      {
        // Allocate memory for the wide string
        size_t len = strlen (value) + 1;
        wchar_t *new_str = malloc ((len + 1) * sizeof (wchar_t));
        if (!new_str)
          {
            // Handle memory allocation error
            return;
          }
        // Convert UTF-8 encoded string to a wide character format
        mbstowcs (new_str, value, len);
        // Update the pointer in 'old' to the newly allocated string memory
        free (*(wchar_t **)old);
        *(wchar_t **)old = new_str;
      }
    else
      {
        // Allocate memory based on the length of the input string
        size_t len = strlen (value) + 1;
        char *new_str = malloc (len);
        if (!new_str)
          {
            // Handle memory allocation error
            return;
          }
        // Copy the string
        strcpy (new_str, value);
        // Update the pointer in 'old' to the newly allocated string memory
        free (*(char **)old);
        *(char **)old = new_str;
      }
  }