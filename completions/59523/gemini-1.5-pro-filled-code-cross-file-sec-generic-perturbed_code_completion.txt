{
          char *new_str = NULL;
          if (f->size)
            {
              new_str = malloc (f->size);
              if (!new_str)
                return; // Or handle the allocation failure appropriately
              memcpy (new_str, value, f->size);
              *(char **)old = new_str;
            }
          else if (dwg_version_type (versiontype) == DWG_VERSION_ASCII)
            {
              size_t len = strlen ((const char *)value) + 1;
              new_str = malloc (len);
              if (!new_str)
                return; // Or handle the allocation failure appropriately

              memcpy (new_str, value, len);
              *(char **)old = new_str;
            }
          else
            {
              wchar_t *wstr;
              if (is_utf8)
                {
                  wstr = dwg_utf8_to_wcs ((const char *)value);
                  if (!wstr)
                    return; // Or handle the conversion failure appropriately
                }
              else
                wstr = (wchar_t *)value; // Trust the caller that it's a valid wide string

              size_t wlen = wcslen (wstr) + 1;
              new_str = malloc (wlen * sizeof (wchar_t));
              if (!new_str)
                {
                  if (is_utf8) free(wstr);
                  return; // Or handle the allocation failure appropriately
                }
              memcpy (new_str, wstr, wlen * sizeof (wchar_t));
              *(wchar_t **)old = (wchar_t*)new_str;

              if (is_utf8) free(wstr);
            }
          if (*(char**)old != value && *(char**)old != NULL)
            free(*(char**)old);
          *(char**)old = new_str;

        }