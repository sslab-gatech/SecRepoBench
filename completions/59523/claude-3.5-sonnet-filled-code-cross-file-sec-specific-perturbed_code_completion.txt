size_t len = strlen(*(const char**)value);
if (strEQc(f->type, "TFv"))
{
    size_t alloc_size = f->size > 0 ? f->size : len + 1;
    char *new_str = (char*)calloc(alloc_size, sizeof(char));
    if (!new_str) {
        // Handle allocation failure
        return;
    }
    strncpy(new_str, *(const char**)value, alloc_size - 1);
    new_str[alloc_size - 1] = '\0';
    *(char**)old = new_str;
}
else if (f->type[0] == 'T' && f->type[1] == 'F')
{
    if (dwg->header.version < R_2007 || !is_utf8)
    {
        char *new_str = (char*)malloc(len + 1);
        if (!new_str) {
            // Handle allocation failure
            return;
        }
        strncpy(new_str, *(const char**)value, len);
        new_str[len] = '\0';
        *(char**)old = new_str;
    }
    else
    {
        BITCODE_TU wstr = bit_utf8_to_TU((char*)value, 0);
        if (!wstr) {
            // Handle conversion failure
            return;
        }
        *(BITCODE_TU*)old = wstr;
    }
}
else
{
    char *new_str = (char*)malloc(len + 1);
    if (!new_str) {
        // Handle allocation failure
        return;
    }
    strncpy(new_str, *(const char**)value, len);
    new_str[len] = '\0';
    *(char**)old = new_str;
}