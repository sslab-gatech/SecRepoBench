{
  /* Free any previously allocated memory. */
  if (*(char **)old)
    free (*(char **)old);

  /* For fixed-length strings (TFv), allocate memory based on f->size. */
  {
    size_t max_len = f->size;
    const char *src = (const char *)value;
    /* Note: In a complete implementation, you might detect if a wide-character
       conversion is needed here based on versiontype and is_utf8, and then
       handle UTF-8 -> wide-char conversion. For simplicity, this example
       treats TFv as ASCII and copies directly, ensuring null-termination. */

    /* Allocate memory for the new string buffer. */
    char *dst = (char *)malloc (max_len);
    if (!dst)
      return; /* or handle error */

    /* Zero-initialize to ensure proper termination for shorter strings. */
    memset (dst, 0, max_len);

    /* Safely copy up to max_len - 1 characters and null-terminate. */
    strncpy (dst, src, max_len - 1);

    /* Update 'old' to point to the newly allocated string. */
    *(char **)old = dst;
  }
}