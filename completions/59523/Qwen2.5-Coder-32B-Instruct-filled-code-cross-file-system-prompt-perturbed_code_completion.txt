if (versiontype < R_13b1)
  {
    // Allocate memory for fixed-length strings
    char *new_str = (char *)malloc(f->size);
    if (new_str)
      {
        strncpy(new_str, *(char **)value, f->size - 1);
        new_str[f->size - 1] = '\0'; // Ensure null-termination
        if (*(char **)old)
          free(*(char **)old);
        *(char **)old = new_str;
      }
  }
else
  {
    // Handle UTF-8 conversion and dynamic allocation for strings post R13b1
    if (is_utf8)
      {
        // Convert UTF-8 to wide character
        int len = mbstowcs(NULL, *(char **)value, 0);
        if (len != (size_t)-1)
          {
            wchar_t *new_wstr = (wchar_t *)malloc((len + 1) * sizeof(wchar_t));
            if (new_wstr)
              {
                mbstowcs(new_wstr, *(char **)value, len + 1);
                if (*(wchar_t **)old)
                  free(*(wchar_t **)old);
                *(wchar_t **)old = new_wstr;
              }
          }
      }
    else
      {
        // Directly allocate and copy for non-UTF8 strings
        size_t len = strlen(*(char **)value) + 1;
        char *new_str = (char *)malloc(len);
        if (new_str)
          {
            strcpy(new_str, *(char **)value);
            if (*(char **)old)
              free(*(char **)old);
            *(char **)old = new_str;
          }
      }
  }