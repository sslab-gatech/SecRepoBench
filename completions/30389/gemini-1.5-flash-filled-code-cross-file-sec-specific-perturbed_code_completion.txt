if (len > 0) {
      uint8_t *tag_value = (uint8_t *)malloc(len + 1);
      if (tag_value == NULL) {
        NDPI_LOG_ERR(detectionmodule, "Memory allocation failed");
        break;
      }
      memcpy(tag_value, &crypto_data[prev_offset], len);
      tag_value[len] = '\0';

      if (memcmp(tag, "SNI\0", 4) == 0) {
        if (sni_found == 0) {
          snprintf(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name,
                   sizeof(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name),
                   "%s", tag_value);
          NDPI_LOG_DBG(detectionmodule, "SNI: %s", tag_value);
          ret_match = ndpi_match_sni(detectionmodule, flow, tag_value);
          if (ret_match == NDPI_PROTOCOL_MATCH_FOUND) {
            ndpi_set_protocol(detectionmodule, flow, NDPI_PROTOCOL_QUIC_APPLICATION_PROTOCOL);
          }
          ndpi_check_dga(detectionmodule, flow, tag_value);
          sni_found = 1;
        }
      } else if (memcmp(tag, "UAID", 4) == 0) {
        if (ua_found == 0) {
          NDPI_LOG_DBG(detectionmodule, "UAID: %s", tag_value);
          ndpi_process_http_user_agent(detectionmodule, flow, tag_value);
          ua_found = 1;
        }
      }
      free(tag_value);
    }
    if (sni_found == 1 && ua_found == 1) {
      break;
    }