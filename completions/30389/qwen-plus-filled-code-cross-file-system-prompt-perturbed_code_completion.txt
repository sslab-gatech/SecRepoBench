if(memcmp(tag, "SNI\0", 4) == 0) {
  sni_len = len - 1; // Subtract 1 to exclude the null terminator in "SNI\0"
  if(sni_len > 255) { // Ensure SNI length is sane
    NDPI_LOG_ERR(detectionmodule, "SNI length exceeds maximum allowed size\n");
    return;
  }
  if(prev_offset + 1 + sni_len > crypto_data_len || prev_offset >= crypto_data_len) {
    NDPI_LOG_ERR(detectionmodule, "Invalid SNI offset or length\n");
    return;
  }
  memcpy(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name,
         &crypto_data[prev_offset + 1], sni_len);
  flow->protos.tls_quic_stun.tls_quic.client_requested_server_name[sni_len] = '\0';
#ifdef QUIC_DEBUG
  NDPI_LOG_DBG(detectionmodule, "SNI: %s\n",
               flow->protos.tls_quic_stun.tls_quic.client_requested_server_name);
#endif
  ndpi_protocol_match_result_init(&ret_match, NDPI_PROTOCOL_UNKNOWN, NULL);
  ndpi_match_string(detectionmodule->subprotocol_automa.ac_automa,
                    flow->protos.tls_quic_stun.tls_quic.client_requested_server_name, &ret_match);
  if(ret_match.protocol != NDPI_PROTOCOL_UNKNOWN) {
    ndpi_set_detected_protocol(detectionmodule, flow, ret_match.protocol, NDPI_PROTOCOL_UNKNOWN, NDPI_CONFIDENCE_DGA);
  } else {
    check_dga_flow(detectionmodule, flow, flow->protos.tls_quic_stun.tls_quic.client_requested_server_name,
                   NDPI_DGA_SNI_HOSTNAME);
  }
  sni_found = 1;
} else if(memcmp(tag, "UAID", 4) == 0) {
  if(len > 255) { // Ensure UAID length is sane
    NDPI_LOG_ERR(detectionmodule, "UAID length exceeds maximum allowed size\n");
    return;
  }
  if(prev_offset + len > crypto_data_len || prev_offset >= crypto_data_len) {
    NDPI_LOG_ERR(detectionmodule, "Invalid UAID offset or length\n");
    return;
  }
  char user_agent[len];
  memcpy(user_agent, &crypto_data[prev_offset], len);
  user_agent[len] = '\0'; // Null terminate the string
#ifdef QUIC_DEBUG
  NDPI_LOG_DBG(detectionmodule, "User Agent: %s\n", user_agent);
#endif
  process_http_user_agent(detectionmodule, flow, user_agent, len);
  ua_found = 1;
}

if(sni_found && ua_found)
  return;