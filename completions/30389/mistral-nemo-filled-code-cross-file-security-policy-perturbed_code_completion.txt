for(i = 0; i < num_tags; i++) {
    if(8 + 8 * i + 8 >= crypto_data_len)
      break;
    tag = &crypto_data[8 + 8 * i];
    offset = le32toh(*((u_int32_t *)&crypto_data[8 + 8 * i + 4]));
    if(prev_offset > offset)
      break;
    len = (uint32_t)(offset - prev_offset); // Promote to uint32_t to prevent overflow
    if(len > crypto_data_len - (8 + 8 * i + 8)) {
      NDPI_LOG_DBG(detectionmodule, "Invalid tag length %u > %u\n", len, crypto_data_len - (8 + 8 * i + 8));
      break;
    }
    // Process tags within the crypto data by iterating over them.
    // For each tag, check if it is either "SNI\0" or "UAID".
    // If the tag is "SNI\0", extract the server name information (SNI) from the crypto data
    // and store it in the flow structure's SNI field. Log the SNI for debugging purposes.
    // Perform matching of the SNI against known subprotocols and check for DGA.
    // Mark the hello message as processed once SNI is handled.
    // If the tag is "UAID", extract the user agent information from the crypto data,
    // log it for debugging, and process it using the HTTP user agent handling function.
    // Keep track of whether SNI or UAID have been found and return early if both are processed.
    if(memcmp(tag, "SNI\0", 4) == 0) {
      sni_len = len - 4;
      if(sni_len > 0) {
        if(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name[0] == '\0') {
          memcpy(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name, &tag[4], sni_len);
          flow->protos.tls_quic_stun.tls_quic.client_requested_server_name[sni_len] = '\0';
          sni_found = 1;
          NDPI_LOG_DBG(detectionmodule, "SNI: %s\n", flow->protos.tls_quic_stun.tls_quic.client_requested_server_name);
          // Perform matching of the SNI against known subprotocols and check for DGA.
          // Mark the hello message as processed once SNI is handled.
        }
      }
    } else if(memcmp(tag, "UAID", 4) == 0) {
      if(ua_found == 0) {
        ua_found = 1;
        NDPI_LOG_DBG(detectionmodule, "UAID found\n");
        // Process the user agent information using the HTTP user agent handling function.
      }
    }
    prev_offset = offset;
  }