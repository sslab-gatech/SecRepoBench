if(memcmp(tag, "SNI\0", 4) == 0) {
  sni_len = len > sizeof(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name) - 1 ?
            sizeof(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name) - 1 : len;
  memcpy(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name,
         &crypto_data[tag_offset_start + prev_offset], sni_len);
  flow->protos.tls_quic_stun.tls_quic.client_requested_server_name[sni_len] = '\0';
  
  NDPI_LOG_DBG2(detectionmodule, "SNI: %s\n", flow->protos.tls_quic_stun.tls_quic.client_requested_server_name);
  
  ndpi_match_host_subprotocol(detectionmodule, flow,
                              (char *)flow->protos.tls_quic_stun.tls_quic.client_requested_server_name,
                              strlen((const char*)flow->protos.tls_quic_stun.tls_quic.client_requested_server_name),
                              &ret_match, NDPI_PROTOCOL_QUIC);
  
  if(ndpi_is_valid_hostname((char *)flow->protos.tls_quic_stun.tls_quic.client_requested_server_name) == 0) {
    ndpi_set_risk(detectionmodule, flow, NDPI_INVALID_CHARACTERS);
  }
  
  ndpi_check_dga_name(detectionmodule, flow,
                      flow->protos.tls_quic_stun.tls_quic.client_requested_server_name,
                      1, 1);
  
  flow->protos.tls_quic_stun.tls_quic.hello_processed = 1;
  sni_found = 1;
} else if(memcmp(tag, "UAID", 4) == 0) {
  if(len <= sizeof(flow->protos.tls_quic_stun.tls_quic.user_agent)) {
    memcpy(flow->protos.tls_quic_stun.tls_quic.user_agent,
           &crypto_data[tag_offset_start + prev_offset], len);
    flow->protos.tls_quic_stun.tls_quic.user_agent[len] = '\0';
    
    NDPI_LOG_DBG2(detectionmodule, "UA: %s\n", flow->protos.tls_quic_stun.tls_quic.user_agent);
    
    http_process_user_agent(detectionmodule, flow,
                            flow->protos.tls_quic_stun.tls_quic.user_agent,
                            len);
    ua_found = 1;
  }
}

if(sni_found && ua_found)
  return;