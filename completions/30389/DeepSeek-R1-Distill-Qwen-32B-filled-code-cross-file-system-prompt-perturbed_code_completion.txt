if(memcmp(tag, "SNI\0", 4) == 0) {
  if(len > 0 && prev_offset + len <= crypto_data_len) {
    sni_len = len;
    strncpy(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name,
            (const char *)&crypto_data[prev_offset],
            MIN(sni_len, sizeof(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name)-1));
    flow->protos.tls_quic_stun.tls_quic.client_requested_server_name[MIN(sni_len, sizeof(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name)-1)] = '\0';
    NDPI_LOG_DBG(detectionmodule, "Found SNI: %s\n", flow->protos.tls_quic_stun.tls_quic.client_requested_server_name);
    ret_match = ndpi_match_protocol_name(detectionmodule, flow, flow->protos.tls_quic_stun.tls_quic.client_requested_server_name);
    if(ret_match.protocol != NDPI_PROTOCOL_UNKNOWN) {
      flow->guessed_protocol = ret_match.protocol;
      flow->protocol_confidence = ret_match.confidence;
    }
    flow->protos.tls_quic_stun.tls_quic.hello_processed = 1;
    sni_found = 1;
  }
} else if(memcmp(tag, "UAID", 4) == 0) {
  if(len > 0 && prev_offset + len <= crypto_data_len) {
    char *ua = (char *)&crypto_data[prev_offset];
    uint32_t ua_len = len;
    NDPI_LOG_DBG(detectionmodule, "Found UAID: %s\n", ua);
    http_user_agent_handler(detectionmodule, flow, ua, ua_len);
    ua_found = 1;
  }
}
if(sni_found && ua_found)
  break;