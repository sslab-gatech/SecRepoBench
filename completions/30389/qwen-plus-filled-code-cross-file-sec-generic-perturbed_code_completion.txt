if(memcmp(tag, "SNI\0", 4) == 0) {
    if(prev_offset + 4 >= crypto_data_len)
        break;
    sni_len = le32toh(*(uint32_t *)&crypto_data[prev_offset]);
    if(sni_len + prev_offset + 4 > crypto_data_len)
        break;
    memcpy(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name,
           &crypto_data[prev_offset + 4], sni_len);
    flow->protos.tls_quic_stun.tls_quic.client_requested_server_name[sni_len] = '\0';
#ifdef QUIC_DEBUG
    NDPI_LOG_DBG(detectionmodule, "SNI: %s\n",
                 flow->protos.tls_quic_stun.tls_quic.client_requested_server_name);
#endif
    ndpi_match_string(detectionmodule->subprotocol_automa, flow->protos.tls_quic_stun.tls_quic.client_requested_server_name);
    ndpi_check_dga_domain(detectionmodule, flow);
    sni_found = 1;
} else if(memcmp(tag, "UAID", 4) == 0) {
    if(prev_offset + 4 >= crypto_data_len)
        break;
    len = le32toh(*(uint32_t *)&crypto_data[prev_offset]);
    if(len + prev_offset + 4 > crypto_data_len)
        break;
    char user_agent[len + 1];
    memcpy(user_agent, &crypto_data[prev_offset + 4], len);
    user_agent[len] = '\0';
#ifdef QUIC_DEBUG
    NDPI_LOG_DBG(detectionmodule, "User-Agent: %s\n", user_agent);
#endif
    process_http_user_agent(detectionmodule, flow, user_agent);
    ua_found = 1;
}

if(sni_found && ua_found)
    return;