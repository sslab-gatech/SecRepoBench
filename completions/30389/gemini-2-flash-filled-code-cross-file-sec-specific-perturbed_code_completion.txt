if(8 + 8 * i + 8 > crypto_data_len || offset > crypto_data_len)
      continue;

    if(len > crypto_data_len || offset + len > crypto_data_len)
      continue;

    if(len > 0 && tag != NULL) {
      if(memcmp(tag, "SNI\0", 4) == 0) {
        if(len > 4) {
          sni_len = len - 4;
          if (sni_len > NDPI_MAX_HOST_NAME)
            sni_len = NDPI_MAX_HOST_NAME;

          if(offset + 4 + sni_len <= crypto_data_len) {
            memcpy(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name,
                   &crypto_data[offset + 4], sni_len);
            flow->protos.tls_quic_stun.tls_quic.client_requested_server_name[sni_len] = '\0';

#ifdef QUIC_DEBUG
            NDPI_LOG_DBG(detectionmodule, "SNI: %s\n", flow->protos.tls_quic_stun.tls_quic.client_requested_server_name);
#endif

            ret_match = ndpi_match_subprotocol(detectionmodule, flow,
                                                 flow->protos.tls_quic_stun.tls_quic.client_requested_server_name,
                                                 sizeof(flow->protos.tls_quic_stun.tls_quic.client_requested_server_name),
                                                 NDPI_PROTOCOL_TLS,
                                                 NDPI_PROTOCOL_QUIC,
                                                 TRUE);

            if(ret_match == NDPI_PROTOCOL_MATCH_DGA) {
              ndpi_set_risk(detectionmodule, flow, NDPI_PROTOCOL_IS_DGA);
            }

            flow->protos.tls_quic_stun.tls_quic.hello_processed = 1;
            sni_found = 1;
          }
        }
      } else if(memcmp(tag, "UAID", 4) == 0) {
        if(len > 4) {
          /* User Agent */
#ifdef QUIC_DEBUG
          char *ua = ndpi_malloc(len - 3);
          if(ua != NULL) {
            memcpy(ua, &crypto_data[offset + 4], len - 4);
            ua[len - 4] = '\0';
            NDPI_LOG_DBG(detectionmodule, "UAID: %s\n", ua);
            ndpi_free(ua);
          }
#endif
          ua_found = 1;
          ndpi_http_user_agent(detectionmodule, flow, &crypto_data[offset + 4], len - 4);
        }
      }
    }
    if(sni_found && ua_found)
      return;