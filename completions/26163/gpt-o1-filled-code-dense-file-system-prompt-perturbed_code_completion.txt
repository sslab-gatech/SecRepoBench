{
    /* Convert character to its 0..15 hexadecimal value */
    if (ch >= '0' && ch <= '9') {
        ch -= '0';
    } else if (ch >= 'A' && ch <= 'F') {
        ch = (char)(ch - 'A' + 10);
    } else if (ch >= 'a' && ch <= 'f') {
        ch = (char)(ch - 'a' + 10);
    } else {
        return FP_VAL;
    }

    /* Store the 4-bit nibble into the current digit */
    fpnumber->dp[k] |= ((fp_digit)ch << j);
    j += 4;
    if (j == DIGIT_BIT) {
        j = 0;
        k++;
        /* Check if we've exceeded the available digit space */
        if (k >= FP_SIZE) {
            return FP_VAL;
        }
        /* Initialize the next digit to zero */
        fpnumber->dp[k] = 0;
    }
}