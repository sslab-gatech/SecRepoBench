if (ch >= '0' && ch <= '9')
    ch -= '0';
else if (ch >= 'A' && ch <= 'F')
    ch -= 'A' - 10;
else if (ch >= 'a' && ch <= 'f')
    ch -= 'a' - 10;
else
    return FP_VAL;

int y = DIGIT_BIT - (j & ((1 << DIGIT_BIT) - 1)) - 1;
fpnumber->dp[k] |= ((fp_digit)ch) << y;
j += 4;
if (y <= 0) {
    ++k;
    j = 0;
    if (k >= FP_SIZE)
        return FP_VAL;
}