if (ch >= '0' && ch <= '9')
    ch -= '0';
else if (ch >= 'A' && ch <= 'F')
    ch -= 'A' - 10;
else if (ch >= 'a' && ch <= 'f')
    ch -= 'a' - 10;
else
    return FP_VAL;  // Invalid character

if (k >= FP_SIZE) {
    return FP_VAL;  // Exceeds maximum size
}

fpnumber->dp[k] |= ((fp_digit)ch << j);
j += 4;
while (j >= DIGIT_BIT) {
    j -= DIGIT_BIT;
    k++;
    if (k >= FP_SIZE) {
        return FP_VAL;  // Exceeds maximum size
    }
    if (j > 0) {
        fpnumber->dp[k] |= ((fp_digit)ch >> (4 - j));
    }
}