if (isdigit(ch)) {
    ch -= '0';
} else if (ch >= 'a' && ch <= 'f') {
    ch -= 'a' - 10;
} else if (ch >= 'A' && ch <= 'F') {
    ch -= 'A' - 10;
} else {
    return FP_VAL;
}

fp_digit dp_value = (fp_digit)ch;

int pos = k;
int shift = (j * DIGIT_BIT);

fpnumber->dp[pos] = (fpnumber->dp[pos] & ~(0xFFFF << shift)) | ((dp_value << shift));

j++;
if (j == (int)sizeof(fp_digit) / sizeof(char)) {
    j = 0;
    k++;
}
if (k >= FP_SIZE) {
    return FP_VAL;
}