int ch_val;
if (ch >= '0' && ch <= '9')
    ch_val = ch - '0';
else if (ch >= 'A' && ch <= 'F')
    ch_val = ch - 'A' + 10;
else if (ch >= 'a' && ch <= 'f')
    ch_val = ch - 'a' + 10;
else
    return FP_VAL;

int idx = k >> 2;
if (idx >= FP_SIZE)
    return FP_VAL;

fpnumber->dp[idx] |= ((fp_digit)ch_val) << ((k & 3) << 2);
k++;

if (k == (DIGIT_BIT * FP_SIZE))
    return FP_VAL;