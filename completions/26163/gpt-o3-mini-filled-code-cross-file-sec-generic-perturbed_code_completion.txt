int digit, bits, available;
    if (ch >= '0' && ch <= '9') {
        digit = ch - '0';
    }
    else if (ch >= 'a' && ch <= 'f') {
        digit = ch - 'a' + 10;
    }
    else if (ch >= 'A' && ch <= 'F') {
        digit = ch - 'A' + 10;
    }
    else {
        return FP_VAL;
    }
    /* Initialize the current multi-precision digit if starting fresh */
    if (j == 0)
        fpnumber->dp[k] = 0;
    bits = 4;
    if (j + bits < DIGIT_BIT) {
        fpnumber->dp[k] |= ((fp_digit)digit << j);
        j += bits;
    }
    else {
        available = DIGIT_BIT - j;
        fpnumber->dp[k] |= ((fp_digit)digit << j);
        bits -= available;
        k++;
        if (k >= FP_SIZE)
            return FP_MEM;
        fpnumber->dp[k] = ((fp_digit)digit >> available);
        j = bits;
    }