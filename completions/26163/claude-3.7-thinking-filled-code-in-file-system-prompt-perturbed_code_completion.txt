if (ch >= '0' && ch <= '9')
  ch -= '0';
else if (ch >= 'A' && ch <= 'F')
  ch -= 'A' - 10;
else if (ch >= 'a' && ch <= 'f')
  ch -= 'a' - 10;
else
  return FP_VAL;  // Invalid character

// Add the value to the current digit at the current bit position
fpnumber->dp[k] |= ((fp_digit)ch) << j;
j += 4;  // Each hex character is 4 bits

// If we've filled the current digit, move to the next
if (j >= DIGIT_BIT) {
  j = 0;
  k++;
  if (k >= FP_SIZE)
    return FP_VAL;  // Number too large
}