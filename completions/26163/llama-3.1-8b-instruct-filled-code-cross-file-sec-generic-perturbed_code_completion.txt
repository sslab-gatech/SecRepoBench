for (i = (int)(XSTRLEN(str) - 1); i >= 0; i--) {
    ch = str[i];
    if (ch >= '0' && ch <= '9') {
        d = ch - '0';
    } else if (ch >= 'A' && ch <= 'F') {
        d = ch - 'A' + 10;
    } else if (ch >= 'a' && ch <= 'f') {
        d = ch - 'a' + 10;
    } else {
        return FP_VAL; /* invalid character */
    }
    if (k >= FP_SIZE) {
        return FP_VAL; /* number too large */
    }
    fpnumber->dp[k] = d;
    k++;
    if (j == 0 && ch == '0') {
        j = 1;
    }
}