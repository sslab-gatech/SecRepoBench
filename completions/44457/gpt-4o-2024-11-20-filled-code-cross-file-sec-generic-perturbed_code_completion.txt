{
  OperatorE topOperator;

  // Ensure the operator stack is not empty
  if (fxinfo->usedOprStack == 0)
  {
    (void) ThrowMagickException(
      fxinfo->exception, GetMagickModule(), OptionError,
      "Ternary operator without preceding operator", "'%s'",
      SetShortExp(fxinfo));
    return MagickFalse;
  }

  // Get the top operator from the stack
  topOperator = fxinfo->OperatorStack[fxinfo->usedOprStack - 1];

  if (topOperator == oQuery) // Handle the '?' operator
  {
    if (ptern->addrQuery != NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS)
    {
      (void) ThrowMagickException(
        fxinfo->exception, GetMagickModule(), OptionError,
        "Nested or incomplete ternary operator", "'%s'",
        SetShortExp(fxinfo));
      return MagickFalse;
    }

    // Pop the '?' operator from the stack
    fxinfo->usedOprStack--;

    // Set the query address to the current element index
    ptern->addrQuery = fxinfo->usedElements;

    // Add an addressing element for conditional execution
    if (!AddAddressingElement(fxinfo, rIfZero, NULL_ADDRESS))
      return MagickFalse;
  }
  else if (topOperator == oColon) // Handle the ':' operator
  {
    if (ptern->addrQuery == NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS)
    {
      (void) ThrowMagickException(
        fxinfo->exception, GetMagickModule(), OptionError,
        "Misplaced colon in ternary operator", "'%s'",
        SetShortExp(fxinfo));
      return MagickFalse;
    }

    // Pop the ':' operator from the stack
    fxinfo->usedOprStack--;

    // Set the colon address to the current element index
    ptern->addrColon = fxinfo->usedElements;

    // Mark the current element to push a result
    fxinfo->Elements[fxinfo->usedElements - 1].DoPush = MagickTrue;

    // Add an addressing element for control flow
    if (!AddAddressingElement(fxinfo, rJump, NULL_ADDRESS))
      return MagickFalse;
  }
  else
  {
    // Invalid operator for ternary processing
    (void) ThrowMagickException(
      fxinfo->exception, GetMagickModule(), OptionError,
      "Invalid operator in ternary processing", "'%s'",
      SetShortExp(fxinfo));
    return MagickFalse;
  }
}