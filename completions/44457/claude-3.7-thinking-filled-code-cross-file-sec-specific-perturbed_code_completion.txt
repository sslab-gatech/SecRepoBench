if (fxinfo->usedOprStack <= 0) return MagickTrue;

OperatorE op = fxinfo->OperatorStack[fxinfo->usedOprStack-1];

if (op == oQuery) {
  if (ptern->addrQuery != NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS) {
    (void) ThrowMagickException(
      fxinfo->exception, GetMagickModule(), OptionError,
      "Unexpected ? in ternary", "at '%s'",
      SetShortExp(fxinfo));
    return MagickFalse;
  }
  fxinfo->usedOprStack--;
  ptern->addrQuery = fxinfo->usedElements;
  (void) AddAddressingElement(fxinfo, rSkipIfZero, NULL_ADDRESS);
}
else if (op == oColon) {
  if (ptern->addrQuery == NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS) {
    (void) ThrowMagickException(
      fxinfo->exception, GetMagickModule(), OptionError,
      "Unexpected : in ternary", "at '%s'",
      SetShortExp(fxinfo));
    return MagickFalse;
  }
  fxinfo->usedOprStack--;
  if (fxinfo->usedElements > 0) {
    ElementT *pel = &fxinfo->Elements[fxinfo->usedElements-1];
    pel->DoPush = MagickTrue;
  }
  ptern->addrColon = fxinfo->usedElements;
  (void) AddAddressingElement(fxinfo, rGoto, NULL_ADDRESS);
}