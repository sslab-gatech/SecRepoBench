OperatorE op;

  if (pfx->usedOprStack == 0) return MagickTrue;

  op = pfx->OperatorStack[pfx->usedOprStack-1];

  if (op == oQuery) {
    if (ternary.addrQuery != NULL_ADDRESS || ternary.addrColon != NULL_ADDRESS) {
      (void) ThrowMagickException (
        pfx->exception, GetMagickModule(), OptionError,
        "Imbalanced ternary operator", "'%s' at '%s'",
        pfx->token, SetShortExp(pfx));
      return MagickFalse;
    }
    pfx->usedOprStack--;
    ternary.addrQuery = (ssize_t) pfx->usedElements;
    (void) AddAddressingElement (pfx, rQuery, NULL_ADDRESS);
  } else if (op == oColon) {
    if (ternary.addrQuery == NULL_ADDRESS || ternary.addrColon != NULL_ADDRESS) {
      (void) ThrowMagickException (
        pfx->exception, GetMagickModule(), OptionError,
        "Imbalanced ternary operator", "'%s' at '%s'",
        pfx->token, SetShortExp(pfx));
      return MagickFalse;
    }
    pfx->usedOprStack--;
    ternary.addrColon = (ssize_t) pfx->usedElements;
    pfx->Elements[pfx->usedElements-1].DoPush = MagickTrue;
    (void) AddAddressingElement (pfx, rColon, NULL_ADDRESS);
  } else
    return MagickTrue;