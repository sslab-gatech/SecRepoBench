OperatorE op;

  if (ptern->addrQuery == NULL_ADDRESS && ptern->addrColon == NULL_ADDRESS &&
      pfx->usedOprStack > 0) {
    op = pfx->OperatorStack[pfx->usedOprStack - 1];
    if (op == oQuery) {
      pfx->usedOprStack--;
      ptern->addrQuery = (ssize_t) pfx->usedElements;
      if (!AddAddressingElement (fxinfo, rQuery, NULL_ADDRESS))
        return MagickFalse;
    }
    else if (op == oColon) {
      if (ptern->addrQuery == NULL_ADDRESS) {
        (void) ThrowMagickException (
          fxinfo->exception, GetMagickModule(), OptionError,
          "Missing query '?' in ternary operator", NULL);
        return MagickFalse;
      }
      if (ptern->addrColon != NULL_ADDRESS) {
        (void) ThrowMagickException (
          fxinfo->exception, GetMagickModule(), OptionError,
          "Too many colons ':' in ternary operator", NULL);
        return MagickFalse;
      }
      pfx->usedOprStack--;
      ptern->addrColon = (ssize_t) pfx->usedElements;
      fxinfo->Elements[pfx->usedElements-1].DoPush = MagickTrue;
      if (!AddAddressingElement (fxinfo, rColon, NULL_ADDRESS))
        return MagickFalse;
    }
  }