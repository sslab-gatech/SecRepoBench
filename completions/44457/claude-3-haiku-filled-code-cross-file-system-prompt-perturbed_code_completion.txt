if (TopOprIsQuery(pfx)) {
  if (ternary.addrQuery != NULL_ADDRESS) {
    (void) ThrowMagickException(
      pfx->exception, GetMagickModule(), OptionError,
      "Ternary operator already has a query", "'%s'",
      SetShortExp(pfx));
    return MagickFalse;
  }
  ternary.addrQuery = pfx->usedElements;
  (void) AddAddressingElement(pfx, rConditional, NULL_ADDRESS);
  pfx->usedOprStack--;
} else if (TopOprIsColon(pfx)) {
  if (ternary.addrQuery == NULL_ADDRESS) {
    (void) ThrowMagickException(
      pfx->exception, GetMagickModule(), OptionError,
      "Ternary operator has no preceding query", "'%s'",
      SetShortExp(pfx));
    return MagickFalse;
  }
  if (ternary.addrColon != NULL_ADDRESS) {
    (void) ThrowMagickException(
      pfx->exception, GetMagickModule(), OptionError,
      "Ternary operator already has a colon", "'%s'",
      SetShortExp(pfx));
    return MagickFalse;
  }
  ternary.addrColon = pfx->usedElements;
  (void) AddAddressingElement(pfx, rJump, NULL_ADDRESS);
  pfx->usedElements[ternary.addrQuery].EleNdx = pfx->usedElements - 1;
  pfx->usedOprStack--;
} else {
  (void) ThrowMagickException(
    pfx->exception, GetMagickModule(), OptionError,
    "Unexpected operator in ternary expression", "'%s'",
    SetShortExp(pfx));
  return MagickFalse;
}