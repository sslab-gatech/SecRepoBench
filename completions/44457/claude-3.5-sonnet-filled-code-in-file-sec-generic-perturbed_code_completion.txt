if (pfx->usedOprStack == 0) {
    return MagickTrue;
  }

  OperatorE topOp = pfx->OperatorStack[pfx->usedOprStack - 1];

  if (topOp == oQuery) {
    if (ptern->addrQuery != NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS) {
      (void) ThrowMagickException(
        pfx->exception, GetMagickModule(), OptionError,
        "Nested ternary operators are not supported", "'%s'",
        SetShortExp(pfx));
      return MagickFalse;
    }
    pfx->usedOprStack--;
    ptern->addrQuery = pfx->usedElements;
    (void) AddAddressingElement(pfx, rIfZeroGoto, NULL_ADDRESS);
  }
  else if (topOp == oColon) {
    if (ptern->addrQuery == NULL_ADDRESS) {
      (void) ThrowMagickException(
        pfx->exception, GetMagickModule(), OptionError,
        "':' without preceding '?'", "'%s'",
        SetShortExp(pfx));
      return MagickFalse;
    }
    if (ptern->addrColon != NULL_ADDRESS) {
      (void) ThrowMagickException(
        pfx->exception, GetMagickModule(), OptionError,
        "Multiple ':' in ternary operator", "'%s'",
        SetShortExp(pfx));
      return MagickFalse;
    }
    pfx->usedOprStack--;
    ptern->addrColon = pfx->usedElements;
    pfx->Elements[pfx->usedElements - 1].DoPush = MagickTrue;
    (void) AddAddressingElement(pfx, rGoto, NULL_ADDRESS);
  }

  return MagickTrue;