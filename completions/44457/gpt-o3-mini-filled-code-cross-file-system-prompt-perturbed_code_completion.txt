if (fxinfo->usedOprStack > 0)
{
  OperatorE op = fxinfo->OperatorStack[fxinfo->usedOprStack - 1];
  if (op == oTernaryQuery)
  {
    if (ptern->addrQuery != NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS)
    {
      (void) ThrowMagickException(fxinfo->exception, GetMagickModule(), OptionError,
        "Unexpected '?' encountered in ternary operator", "at '%s'", SetShortExp(fxinfo));
      return MagickFalse;
    }
    fxinfo->usedOprStack--;
    ptern->addrQuery = fxinfo->usedElements;
    if (!AddAddressingElement(fxinfo, rTernaryQuery, ptern->addrQuery))
      return MagickFalse;
  }
  else if (op == oTernaryColon)
  {
    if (ptern->addrQuery == NULL_ADDRESS)
    {
      (void) ThrowMagickException(fxinfo->exception, GetMagickModule(), OptionError,
        "':' encountered without a preceding '?' in ternary operator", "at '%s'", SetShortExp(fxinfo));
      return MagickFalse;
    }
    if (ptern->addrColon != NULL_ADDRESS)
    {
      (void) ThrowMagickException(fxinfo->exception, GetMagickModule(), OptionError,
        "Multiple ':' encountered in ternary operator", "at '%s'", SetShortExp(fxinfo));
      return MagickFalse;
    }
    fxinfo->usedOprStack--;
    ptern->addrColon = fxinfo->usedElements;
    if (!AddAddressingElement(fxinfo, rTernaryColon, ptern->addrColon))
      return MagickFalse;
    fxinfo->Elements[fxinfo->usedElements - 1].DoPush = MagickTrue;
  }
}