if (fxinfo->OperatorStack[fxinfo->usedOprStack-1] == oQuery)
{
  if (ptern->query_addr!= -1 || ptern->colon_addr!= -1)
    {
      (void) ThrowMagickException (
        fxinfo->exception, GetMagickModule(), OptionFatalError,
        "Ternary operator syntax error");
      return MagickFalse;
    }
  ptern->query_addr = fxinfo->usedElementStack;
  if (!PopOprOpenParen (fxinfo, oQuery))
    {
      (void) ThrowMagickException (
        fxinfo->exception, GetMagickModule(), OptionFatalError,
        "Ternary operator syntax error");
      return MagickFalse;
    }
  if (!ExtendRPN (fxinfo))
    return MagickFalse;
  fxinfo->Elements[fxinfo->usedElementStack].type = oCondAddr;
  fxinfo->Elements[fxinfo->usedElementStack].addr = fxinfo->usedElementStack + 1;
  fxinfo->usedElementStack++;
}
else if (fxinfo->OperatorStack[fxinfo->usedOprStack-1] == oColon)
{
  if (ptern->query_addr == -1 || ptern->colon_addr!= -1)
    {
      (void) ThrowMagickException (
        fxinfo->exception, GetMagickModule(), OptionFatalError,
        "Ternary operator syntax error");
      return MagickFalse;
    }
  ptern->colon_addr = fxinfo->usedElementStack;
  if (!PopOprOpenParen (fxinfo, oColon))
    {
      (void) ThrowMagickException (
        fxinfo->exception, GetMagickModule(), OptionFatalError,
        "Ternary operator syntax error");
      return MagickFalse;
    }
  if (!ExtendRPN (fxinfo))
    return MagickFalse;
  fxinfo->Elements[fxinfo->usedElementStack].type = oAddr;
  fxinfo->Elements[fxinfo->usedElementStack].addr = fxinfo->usedElementStack + 1;
  fxinfo->usedElementStack++;
  fxinfo->Elements[fxinfo->usedElementStack].type = oPushResult;
  fxinfo->usedElementStack++;
}