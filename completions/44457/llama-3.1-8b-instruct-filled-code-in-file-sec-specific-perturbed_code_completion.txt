static MagickBooleanType ProcessTernaryOpr (FxInfo * fxinfo, TernaryT * ptern)
/* Ternary operator "...?... :..."
   returns false iff we have exception
*/
{
  // Check the top operator of the stack to determine if it is a ternary query ('?') or colon (':').
  // If the operator is a query ('?'):
  //   - Ensure there is no existing query or colon set in the ternary structure.
  //   - Pop the operator stack and set the query address to the current element index.
  //   - Add an addressing element for conditional execution based on the query result.
  // If the operator is a colon (':'):
  //   - Ensure there is a preceding query in the ternary structure and no existing colon set.
  //   - Pop the operator stack and set the colon address to the current element index.
  //   - Mark the current element to push a result and add an addressing element for control flow.
  // Handle exceptions appropriately by throwing an error if the ternary structure is inconsistent.
  // Return false only if an exception occurs during the processing of the ternary operator.
  if (ptern->addrQuery!= NULL_ADDRESS) {
    if (ptern->addrColon!= NULL_ADDRESS) {
      (void) ThrowMagickException (
        fxinfo->exception, GetMagickModule(), OptionError,
        "'?' with no corresponding ':'", "'%s' at '%s'",
        fxinfo->token, SetShortExp(fxinfo));
      return MagickFalse;
    }
    pfx->Elements[ptern->addrQuery].EleNdx = pfx->usedElements;
    pfx->Elements[ptern->addrQuery].DoPush = MagickTrue;
    pfx->Elements[ptern->addrQuery].type = etControl;
    pfx->Elements[ptern->addrQuery].oprNum = rIfZeroGoto;
    pfx->Elements[ptern->addrQuery].nArgs = 1;
    pfx->Elements[ptern->addrQuery].ChannelQual = NO_CHAN_QUAL;
    pfx->Elements[ptern->addrQuery].ImgAttrQual = aNull;
    pfx->Elements[ptern->addrQuery].pExpStart = NULL;
    pfx->Elements[ptern->addrQuery].lenExp = 0;
    pfx->Elements[ptern->addrQuery].IsRelative = MagickFalse;
    pfx->Elements[ptern->addrQuery].nDest = 0;
    pfx->Elements[ptern->addrQuery].EleNdx = pfx->usedElements;
    pfx->usedElements++;
  } else if (ptern->addrColon!= NULL_ADDRESS) {
    if (ptern->addrQuery!= NULL_ADDRESS) {
      (void) ThrowMagickException (
        fxinfo->exception, GetMagickModule(), OptionError,
        "':' with no corresponding '?'", "'%s' at '%s'",
        fxinfo->token, SetShortExp(fxinfo));
      return MagickFalse;
    }
    pfx->Elements[ptern->addrColon].EleNdx = pfx->usedElements;
    pfx->Elements[ptern->addrColon].DoPush = MagickTrue;
    pfx->Elements[ptern->addrColon].type = etControl;
    pfx->Elements[ptern->addrColon].oprNum = rIfNotZeroGoto;
    pfx->Elements[ptern->addrColon].nArgs = 1;
    pfx->Elements[ptern->addrColon].ChannelQual = NO_CHAN_QUAL;
    pfx->Elements[ptern->addrColon].ImgAttrQual = aNull;
    pfx->Elements[ptern->addrColon].pExpStart = NULL;
    pfx->Elements[ptern->addrColon].lenExp = 0;
    pfx->Elements[ptern->addrColon].IsRelative = MagickFalse;
    pfx->Elements[ptern->addrColon].nDest = 0;
    pfx->Elements[ptern->addrColon].EleNdx = pfx->usedElements;
    pfx->usedElements++;
  }
  return MagickTrue;
}