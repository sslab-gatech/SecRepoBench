OperatorE op;

  if (fxinfo->usedOprStack == 0)
    return MagickTrue;

  op = fxinfo->OperatorStack[fxinfo->usedOprStack - 1];

  if (op == oQuery) {
    if (ptern->addrQuery != NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS) {
      (void) ThrowMagickException(
        fxinfo->exception, GetMagickModule(), OptionError,
        "Invalid ternary operator structure", "'%s' at '%s'",
        fxinfo->token, SetShortExp(fxinfo));
      return MagickFalse;
    }
    fxinfo->usedOprStack--;
    ptern->addrQuery = fxinfo->usedElements;
    (void) AddAddressingElement(fxinfo, rQuery, NULL_ADDRESS);
  } 
  else if (op == oColon) {
    if (ptern->addrQuery == NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS) {
      (void) ThrowMagickException(
        fxinfo->exception, GetMagickModule(), OptionError,
        "Invalid ternary operator structure", "'%s' at '%s'",
        fxinfo->token, SetShortExp(fxinfo));
      return MagickFalse;
    }
    fxinfo->usedOprStack--;
    ptern->addrColon = fxinfo->usedElements;
    ElementT *pel = &fxinfo->Elements[fxinfo->usedElements - 1];
    pel->DoPush = MagickTrue;
    (void) AddAddressingElement(fxinfo, rColon, NULL_ADDRESS);
  }