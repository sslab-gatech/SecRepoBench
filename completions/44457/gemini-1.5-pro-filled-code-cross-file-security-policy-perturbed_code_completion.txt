if (pfx->usedOprStack > 0) {
    OperatorE op = pfx->OperatorStack[pfx->usedOprStack - 1];
    if (op == oQuery) {
      if (ternary.addrQuery != NULL_ADDRESS || ternary.addrColon != NULL_ADDRESS) {
        (void)ThrowMagickException(
            pfx->exception, GetMagickModule(), OptionError,
            "Nested ternary operators not supported", "'%s' at '%s'", pfx->token,
            SetShortExp(pfx));
        return MagickFalse;
      }
      pfx->usedOprStack--;
      ternary.addrQuery = pfx->usedElements;
      (void)AddAddressingElement(pfx, rQuery, NULL_ADDRESS);
    } else if (op == oColon) {
      if (ternary.addrQuery == NULL_ADDRESS || ternary.addrColon != NULL_ADDRESS) {
        (void)ThrowMagickException(
            pfx->exception, GetMagickModule(), OptionError, "Inconsistent ternary operator",
            "'%s' at '%s'", pfx->token, SetShortExp(pfx));
        return MagickFalse;
      }
      pfx->usedOprStack--;
      ternary.addrColon = pfx->usedElements;
      pfx->Elements[pfx->usedElements - 1].DoPush = MagickTrue;
      (void)AddAddressingElement(pfx, rColon, NULL_ADDRESS);
    }
  }