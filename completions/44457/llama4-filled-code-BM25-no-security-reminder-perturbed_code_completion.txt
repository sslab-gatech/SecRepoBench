OperatorE op;

if (ptern->addrQuery != NULL_ADDRESS) {
  if (*pfx->pex == '?') {
    if (ptern->addrColon != NULL_ADDRESS) {
      (void) ThrowMagickException (
        fxinfo->exception, GetMagickModule(), OptionError,
        "Inconsistent ternary operator: multiple queries", "'%s' at '%s'",
        fxinfo->token, SetShortExp(fxinfo));
      return MagickFalse;
    }
    if (fxinfo->usedOprStack == 0) {
      (void) ThrowMagickException (
        fxinfo->exception, GetMagickModule(), OptionError,
        "Inconsistent ternary operator: query without operands", "'%s' at '%s'",
        fxinfo->token, SetShortExp(fxinfo));
      return MagickFalse;
    }
    op = fxinfo->OperatorStack[fxinfo->usedOprStack-1];
    fxinfo->usedOprStack--;
    ptern->addrQuery = fxinfo->usedElements;
    (void) AddAddressingElement (fxinfo, rQuery, ptern->addrQuery);
  } else if (*pfx->pex == ':') {
    if (ptern->addrColon != NULL_ADDRESS) {
      (void) ThrowMagickException (
        fxinfo->exception, GetMagickModule(), OptionError,
        "Inconsistent ternary operator: multiple colons", "'%s' at '%s'",
        fxinfo->token, SetShortExp(fxinfo));
      return MagickFalse;
    }
    if (ptern->addrQuery == NULL_ADDRESS) {
      (void) ThrowMagickException (
        fxinfo->exception, GetMagickModule(), OptionError,
        "Inconsistent ternary operator: colon without query", "'%s' at '%s'",
        fxinfo->token, SetShortExp(fxinfo));
      return MagickFalse;
    }
    op = fxinfo->OperatorStack[fxinfo->usedOprStack-1];
    fxinfo->usedOprStack--;
    ptern->addrColon = fxinfo->usedElements;
    if (fxinfo->Elements[fxinfo->usedElements-1].DoPush) {
      fxinfo->Elements[fxinfo->usedElements-1].DoPush = MagickFalse;
      (void) AddAddressingElement (fxinfo, rCopyTo, fxinfo->usedElements);
    }
  } else {
    return MagickTrue;
  }
} else {
  if (*pfx->pex == '?') {
    if (fxinfo->usedOprStack == 0) {
      (void) ThrowMagickException (
        fxinfo->exception, GetMagickModule(), OptionError,
        "Inconsistent ternary operator: query without preceding operands", "'%s' at '%s'",
        fxinfo->token, SetShortExp(fxinfo));
      return MagickFalse;
    }
    op = fxinfo->OperatorStack[fxinfo->usedOprStack-1];
    fxinfo->usedOprStack--;
    ptern->addrQuery = fxinfo->usedElements;
    (void) AddAddressingElement (fxinfo, rQuery, ptern->addrQuery);
  }
}

if (fxinfo->exception->severity != UndefinedException)
  return MagickFalse;

return MagickTrue;