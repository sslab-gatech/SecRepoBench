// <MASK>
  OperatorE top_operator = pfx->OperatorStack[pfx->usedOprStack - 1];
  if (top_operator == oQuery) {
    if (ptern->query_address != -1 || ptern->colon_address != -1) {
      ThrowMagickException(pfx->exception, GetMagickModule(), SyntaxError,
                           "Ternary operator structure is inconsistent", NULL);
      return MagickFalse;
    }
    ptern->query_address = pfx->current_index;
    pfx->usedOprStack--;
    AddAddressingElement(pfx, pfx->current_index, ptern->query_address, ptern->colon_address);
  } else if (top_operator == oColon) {
    if (ptern->query_address == -1 || ptern->colon_address != -1) {
      ThrowMagickException(pfx->exception, GetMagickModule(), SyntaxError,
                           "Ternary operator structure is inconsistent", NULL);
      return MagickFalse;
    }
    ptern->colon_address = pfx->current_index;
    pfx->usedOprStack--;
    AddResultElement(pfx, pfx->current_index);
    AddAddressingElement(pfx, pfx->current_index, ptern->query_address, ptern->colon_address);
  } else {
    ThrowMagickException(pfx->exception, GetMagickModule(), SyntaxError,
                         "Unexpected operator in ternary operator stack", NULL);
    return MagickFalse;
  }
  return MagickTrue;