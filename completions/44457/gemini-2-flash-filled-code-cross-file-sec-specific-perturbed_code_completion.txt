{
  OperatorE op;

  if (pfx->usedOprStack == 0)
    return MagickTrue;

  op = pfx->OperatorStack[pfx->usedOprStack-1];

  if (op == oQuery) {
    if (ternary->addrQuery != NULL_ADDRESS || ternary->addrColon != NULL_ADDRESS) {
      (void) ThrowMagickException (
        fxinfo->exception, GetMagickModule(), OptionError,
        "Imbalanced ternary operator", "'?' at '%s'",
        SetShortExp(fxinfo));
      return MagickFalse;
    }
    pfx->usedOprStack--;
    ternary->addrQuery = fxinfo->usedElements;
    (void) AddAddressingElement (fxinfo, rQuery, NULL_ADDRESS);
  }
  else if (op == oColon) {
    if (ternary->addrQuery == NULL_ADDRESS || ternary->addrColon != NULL_ADDRESS) {
      (void) ThrowMagickException (
        fxinfo->exception, GetMagickModule(), OptionError,
        "Imbalanced ternary operator", "':' at '%s'",
        SetShortExp(fxinfo));
      return MagickFalse;
    }
    pfx->usedOprStack--;
    ternary->addrColon = fxinfo->usedElements;
    fxinfo->Elements[fxinfo->usedElements-1].DoPush = MagickTrue;
    (void) AddAddressingElement (fxinfo, rColon, NULL_ADDRESS);
  }
  else
    return MagickTrue;
}