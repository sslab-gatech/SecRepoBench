if (fxinfo->usedOprStack == 0) return MagickTrue;  // No operators to process

  OperatorE op = fxinfo->OperatorStack[fxinfo->usedOprStack - 1];
  
  if (op == oQuery) {  // '?'
    if (ptern->addrQuery != NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS) {
      (void) ThrowMagickException(
        fxinfo->exception, GetMagickModule(), OptionError,
        "Nested ternary operator not supported", "at '%s'",
        SetShortExp(fxinfo));
      return MagickFalse;
    }
    
    // Pop the operator stack
    fxinfo->usedOprStack--;
    
    // Set the query address to the current element index
    ptern->addrQuery = fxinfo->usedElements;
    
    // Add an addressing element for conditional execution (jump if false)
    (void) AddAddressingElement(fxinfo, rJumpZero, NULL_ADDRESS);  // Address will be filled in later
  }
  else if (op == oColon) {  // ':'
    if (ptern->addrQuery == NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS) {
      (void) ThrowMagickException(
        fxinfo->exception, GetMagickModule(), OptionError,
        "Mismatched ternary operator", "at '%s'",
        SetShortExp(fxinfo));
      return MagickFalse;
    }
    
    // Pop the operator stack
    fxinfo->usedOprStack--;
    
    // Mark the current element to push a result
    ElementT* pel = &fxinfo->Elements[fxinfo->usedElements-1];
    pel->DoPush = MagickTrue;
    
    // Set the colon address to the current element index
    ptern->addrColon = fxinfo->usedElements;
    
    // Add an addressing element for control flow (unconditional jump)
    (void) AddAddressingElement(fxinfo, rJump, NULL_ADDRESS);  // Address will be filled in later
  }
  // If the top operator is neither a query nor a colon, do nothing