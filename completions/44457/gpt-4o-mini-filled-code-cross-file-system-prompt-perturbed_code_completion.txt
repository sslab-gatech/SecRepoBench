OperatorE topOperator = TopOpr(pfx);
if (topOperator == oTernaryQuery) {
    if (ptern->addrQuery != NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS) {
        (void) ThrowMagickException(
            fxinfo->exception, GetMagickModule(), OptionError,
            "Inconsistent ternary structure: multiple queries or colons", 
            "at '%s'", SetShortExp(fxinfo));
        return MagickFalse;
    }
    ptern->addrQuery = fxinfo->usedElements;
    (void) PopOperator(pfx);
    (void) AddAddressingElement(fxinfo, rConditional, ptern->addrQuery);
} else if (topOperator == oTernaryColon) {
    if (ptern->addrQuery == NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS) {
        (void) ThrowMagickException(
            fxinfo->exception, GetMagickModule(), OptionError,
            "Inconsistent ternary structure: missing query or multiple colons", 
            "at '%s'", SetShortExp(fxinfo));
        return MagickFalse;
    }
    ptern->addrColon = fxinfo->usedElements;
    (void) PopOperator(pfx);
    (void) AddAddressingElement(fxinfo, rResult, ptern->addrColon);
} else {
    (void) ThrowMagickException(
        fxinfo->exception, GetMagickModule(), OptionError,
        "Expected ternary operator", "at '%s'", SetShortExp(fxinfo));
    return MagickFalse;
}