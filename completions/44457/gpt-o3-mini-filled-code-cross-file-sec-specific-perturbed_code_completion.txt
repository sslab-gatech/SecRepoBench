if (fxinfo->usedOprStack <= 0)
    return MagickTrue;  /* No operator to process, so nothing to do */

  {
    OperatorE op = fxinfo->OperatorStack[fxinfo->usedOprStack - 1];
    if (op == oQuery) {
      if (ptern->addrQuery != NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS) {
        (void) ThrowMagickException(fxinfo->exception, GetMagickModule(), OptionError,
                                    "Unexpected '?' in ternary operator",
                                    "at '%s'", SetShortExp(fxinfo));
        return MagickFalse;
      }
      /* Pop the '?' operator from the stack */
      fxinfo->usedOprStack--;
      /* Set the query address to the current element index */
      ptern->addrQuery = fxinfo->usedElements;
      /* Add an addressing element for conditional jump (to be patched later) */
      if (!AddAddressingElement(fxinfo, rIfFalse, ptern->addrQuery))
        return MagickFalse;
    }
    else if (op == oColon) {
      if (ptern->addrQuery == NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS) {
        (void) ThrowMagickException(fxinfo->exception, GetMagickModule(), OptionError,
                                    "Unexpected ':' in ternary operator",
                                    "at '%s'", SetShortExp(fxinfo));
        return MagickFalse;
      }
      /* Pop the ':' operator from the stack */
      fxinfo->usedOprStack--;
      /* Set the colon address to the current element index */
      ptern->addrColon = fxinfo->usedElements;
      /* Mark the current element to indicate that it should push a result */
      fxinfo->Elements[fxinfo->usedElements].DoPush = MagickTrue;
      /* Add an addressing element for control flow (to be patched later) */
      if (!AddAddressingElement(fxinfo, rGoto, ptern->addrColon))
        return MagickFalse;
    }
  }