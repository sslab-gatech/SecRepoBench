if (fxinfo->usedOprStack > 0)
{
  OperatorE topOpr = fxinfo->OperatorStack[fxinfo->usedOprStack-1];
  if (topOpr == oQuery)
  {
    // Handle '?'
    if (ptern->addrQuery != NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS)
    {
      (void) ThrowMagickException(
        fxinfo->exception, GetMagickModule(), OptionError,
        "Unexpected '?' in ternary expression", "at '%s'",
        SetShortExp(fxinfo));
      return MagickFalse;
    }
    fxinfo->usedOprStack--;
    ptern->addrQuery = fxinfo->usedElements;
    (void) AddAddressingElement(fxinfo, rQuery, NULL_ADDRESS);
  }
  else if (topOpr == oColon)
  {
    // Handle ':'
    if (ptern->addrQuery == NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS)
    {
      (void) ThrowMagickException(
        fxinfo->exception, GetMagickModule(), OptionError,
        "Unexpected ':' in ternary expression", "at '%s'",
        SetShortExp(fxinfo));
      return MagickFalse;
    }
    fxinfo->usedOprStack--;
    ptern->addrColon = fxinfo->usedElements;
    if (fxinfo->usedElements > 0)
    {
      ElementT *pel = &fxinfo->Elements[fxinfo->usedElements-1];
      pel->DoPush = MagickTrue;
    }
    (void) AddAddressingElement(fxinfo, rColon, NULL_ADDRESS);
  }
}