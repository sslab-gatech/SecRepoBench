if (pfx->usedOprStack == 0)
  {
    (void) ThrowMagickException(
      pfx->exception, GetMagickModule(), OptionError,
      "Missing operator in ternary expression", "'%s'", SetShortExp(pfx));
    return MagickFalse;
  }

  OperatorE op = pfx->OperatorStack[pfx->usedOprStack-1];
  if (op == oQuery)
  {
    if (ptern->addrQuery != NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS)
    {
      (void) ThrowMagickException(
        pfx->exception, GetMagickModule(), OptionError,
        "Multiple query operators in ternary expression", "'%s'", SetShortExp(pfx));
      return MagickFalse;
    }

    pfx->usedOprStack--;
    ptern->addrQuery = pfx->usedElements;
    (void) AddAddressingElement(pfx, rCondJump, pfx->usedElements);
  }
  else if (op == oColon)
  {
    if (ptern->addrQuery == NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS)
    {
      (void) ThrowMagickException(
        pfx->exception, GetMagickModule(), OptionError,
        "Missing query operator in ternary expression", "'%s'", SetShortExp(pfx));
      return MagickFalse;
    }

    pfx->usedOprStack--;
    ptern->addrColon = pfx->usedElements;
    (void) AddAddressingElement(pfx, rCondJump, ptern->addrQuery);
    pfx->Elements[pfx->usedElements-1].DoPush = MagickTrue;
  }
  else
  {
    (void) ThrowMagickException(
      pfx->exception, GetMagickModule(), OptionError,
      "Unexpected operator in ternary expression", "'%s'", SetShortExp(pfx));
    return MagickFalse;
  }

  return MagickTrue;