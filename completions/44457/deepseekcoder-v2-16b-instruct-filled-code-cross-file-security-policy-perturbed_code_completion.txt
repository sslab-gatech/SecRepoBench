if (pfx->usedOprStack > 0) {
  OperatorE topOpr = pfx->OperatorStack[pfx->usedOprStack - 1];
  if (topOpr == oQuery) {
    if (ptern->addrQuery == NULL_ADDRESS) {
      ptern->addrQuery = pfx->usedElements - 1;
      (void)AddElement(pfx, (fxFltType)0, oQuery);
    } else {
      ThrowMagickException(pfx->exception, GetMagickModule(), OptionError, "Ternary operator query already set", NULL);
      return MagickFalse;
    }
  } else if (topOpr == oColon) {
    if (ptern->addrQuery != NULL_ADDRESS && ptern->addrColon == NULL_ADDRESS) {
      ptern->addrColon = pfx->usedElements - 1;
      (void)AddElement(pfx, (fxFltType)0, oColon);
    } else {
      ThrowMagickException(pfx->exception, GetMagickModule(), OptionError, "Ternary operator colon not preceded by query", NULL);
      return MagickFalse;
    }
  } else {
    ThrowMagickException(pfx->exception, GetMagickModule(), OptionError, "Unexpected operator on stack", NULL);
    return MagickFalse;
  }
} else {
  ThrowMagickException(pfx->exception, GetMagickModule(), OptionError, "Operator stack is empty", NULL);
  return MagickFalse;
}