{
  MagickBooleanType
    status = MagickTrue;

  if (fxinfo->usedOprStack > 0)
  {
    OperatorE op = fxinfo->OperatorStack[fxinfo->usedOprStack - 1];

    if (op == oQuestion)
    {
      /* If '?' is on top, ensure no previous query or colon is set */
      if ((ptern->addrQuery != NULL_ADDRESS) || (ptern->addrColon != NULL_ADDRESS))
      {
        (void) ThrowMagickException(
          fxinfo->exception, GetMagickModule(), OptionError,
          "Ternary operator mismatch","'?' encountered in invalid state at '%s'",
          SetShortExp(fxinfo));
        status = MagickFalse;
      }
      else
      {
        /* Pop the operator stack, set query address, add addressing element */
        fxinfo->usedOprStack--;
        (void) AddAddressingElement(fxinfo, rTernIf, NULL_ADDRESS);
        ptern->addrQuery = (int) (fxinfo->usedElements - 1);
      }
    }
    else if (op == oColon)
    {
      /* If ':' is on top, ensure we have a query and no colon yet */
      if ((ptern->addrQuery == NULL_ADDRESS) || (ptern->addrColon != NULL_ADDRESS))
      {
        (void) ThrowMagickException(
          fxinfo->exception, GetMagickModule(), OptionError,
          "Ternary operator mismatch","':' encountered without matching '?' at '%s'",
          SetShortExp(fxinfo));
        status = MagickFalse;
      }
      else
      {
        /* Pop the operator stack, set colon address, mark element to push, add addressing element */
        fxinfo->usedOprStack--;
        (void) AddAddressingElement(fxinfo, rTernElse, NULL_ADDRESS);
        ptern->addrColon = (int) (fxinfo->usedElements - 1);
        fxinfo->Elements[fxinfo->usedElements - 1].DoPush = MagickTrue;
      }
    }
  }

  /* Return false if there's an exception, true otherwise */
  if (fxinfo->exception->severity != UndefinedException)
    status = MagickFalse;

  return status;
}