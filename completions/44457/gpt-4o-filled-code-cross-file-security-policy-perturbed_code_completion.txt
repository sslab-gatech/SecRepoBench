if (fxinfo->usedOprStack > 0) {
    OperatorE op = fxinfo->OperatorStack[fxinfo->usedOprStack - 1];
    if (op == oQuery) {
        if (ptern->addrQuery != NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS) {
            (void) ThrowMagickException(
                fxinfo->exception, GetMagickModule(), OptionError,
                "Invalid ternary operator structure", "at '%s'",
                SetShortExp(fxinfo));
            return MagickFalse;
        }
        fxinfo->usedOprStack--;
        ptern->addrQuery = fxinfo->usedElements;
        (void) AddAddressingElement(fxinfo, rCondJump, NULL_ADDRESS);
    } else if (op == oColon) {
        if (ptern->addrQuery == NULL_ADDRESS || ptern->addrColon != NULL_ADDRESS) {
            (void) ThrowMagickException(
                fxinfo->exception, GetMagickModule(), OptionError,
                "Invalid ternary operator structure", "at '%s'",
                SetShortExp(fxinfo));
            return MagickFalse;
        }
        fxinfo->usedOprStack--;
        ptern->addrColon = fxinfo->usedElements;
        ElementT *pel = &fxinfo->Elements[fxinfo->usedElements - 1];
        pel->DoPush = MagickTrue;
        (void) AddAddressingElement(fxinfo, rJump, NULL_ADDRESS);
    }
}