// Calculate the coefficient using a lookup table and adjust it based on
// the position within the block and a quality scale.
coeff = ctx->scantable.coeffs[ctx->scantable.permutated[pos]] *
        (1 << (qscale - 1));
if (coeff > 0x7fff)
    coeff = 0x7fff;
else if (coeff < -0x8000)
    coeff = -0x8000;
block[ctx->scantable.permutated[pos]] = (int16_t) coeff;