// Calculate the coefficient using a lookup table and adjust it based on
// the position within the block and a quality scale.
coeff = vlcdec_lookup[vlc & 0x7] * (1 << (qscale - 1)) + ctx->vlc.offset;
if (pos & 1) {
    coeff = -coeff;
}

if (num_bits > 0) {
    if (num_bits > 8) {
        magnitude = get_bits(&ctx->gb, num_bits - 8);
    }
    magnitude = (magnitude << 8) | get_bits(&ctx->gb, 8);
    if (magnitude > 0x7fff) {
        magnitude -= 0x10000;
    }
    coeff += magnitude;
}

if (coeff > 0x7fff) {
    coeff -= 0x10000;
}

block[ctx->scantable.permutated[pos]] = coeff;