// Ensure magnitude is within a valid range
        if (magnitude < 0 || magnitude > (1 << num_bits) - 1)
            return AVERROR_INVALIDDATA;

        // Calculate the coefficient
        coeff = (magnitude * qscale) >> 3;

        // Apply sign bit if present
        if (get_bits1(&ctx->gb))
            coeff = -coeff;