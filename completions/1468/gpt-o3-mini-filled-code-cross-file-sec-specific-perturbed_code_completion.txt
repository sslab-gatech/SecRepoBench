if (ctx->scantable.permutated[pos] >= 64)
    return AVERROR_INVALIDDATA;
if (magnitude >= (int)(sizeof(ctx->ac_coeff_table)/sizeof(ctx->ac_coeff_table[0])))
    return AVERROR_INVALIDDATA;
coeff = ctx->ac_coeff_table[magnitude];
/* adjust coefficient based on quality scale; the rounding value here (4) was chosen
   so that with qscale=8 the operation is nearly a 1:1 restoration of the original scale */
coeff = (coeff * qscale + 4) >> 3;