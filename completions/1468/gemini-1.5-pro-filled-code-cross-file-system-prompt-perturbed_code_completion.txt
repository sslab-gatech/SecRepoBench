coeff = magnitude;
        if (vlc & 16) // sign
            coeff = -coeff;
        coeff <<= ctx->vlc.table_extra_bits;

        if (ctx->qscale_table[pos] * qscale > 255)
            coeff *= ctx->qscale_table[pos] * qscale;
        else
            coeff *= ctx->qscale_table[pos] * qscale + 128 >> 8;