// Case handlers for auxiliary fields of types 'H' and 'B' in BAM records.
// Handles 'H' type (hexadecimal string) by creating a new block if necessary,
// and encoding the data from the auxiliary fields.
// For 'B' type (byte array), computes the length based on the sub-type and count,
// allocates blocks as needed, and encodes the data.
// Checks for sufficient data remaining in the auxiliary field buffer before processing.
// Updates the auxiliary field pointer appropriately after encoding.
case 'H':
    if (aux_limit - aux < 3+1)
        goto err;

    if (!tm->blk) {
        if (!(tm->blk = cram_new_block(EXTERNAL, key)))
            goto err;
        codec->u.e_byte_array_len.val_codec->out = tm->blk;
    }

    aux+=3;
    //codec->encode(s, codec, aux, 1);
    // Functionally equivalent, but less code.
    BLOCK_APPEND_CHAR(tm->blk, *aux);
    aux++;
    break;

case 'B':
    if (aux_limit - aux < 3+1)
        goto err;

    // Work out the size of the array
    int type = aux[2];
    int len  = 0;
    switch(type) {
    case 'c': case 'C': len = 1; break;
    case 's': case 'S': len = 2; break;
    case 'i': case 'I': len = 4; break;
    case 'd':           len = 8; break;
    default:
        hts_log_error("Unhandled type code for B tag");
        goto err;
    }
    if (aux_limit - aux < 3+len)
        goto err;

    if (!tm->blk) {
        if (!(tm->blk = cram_new_block(EXTERNAL, key)))
            goto err;
        codec->u.e_byte_array_len.val_codec->out = tm->blk;
    }

    aux+=3;
    //codec->encode(s, codec, aux, len);
    BLOCK_APPEND(tm->blk, aux, len);
    aux+=len;
    break;