case 'H':
    if (aux_limit - aux < 4)
        goto err;

    if (!tm->blk) {
        if (!(tm->blk = cram_new_block(EXTERNAL, key)))
            goto err;
        codec->out = tm->blk;
    }

    aux+=3;
    int len = 0;
    while (aux + len < aux_limit && isxdigit(aux[len]))
        len++;

    if (aux + len + 1 >= aux_limit || aux[len] != 0)
        goto err;

    codec->encode(s, codec, aux, len+1);
    aux += len+1;
    break;

case 'B': {
    if (aux_limit - aux < 5)
        goto err;

    uint8_t sub_type = aux[3];
    uint32_t count = bam_auxB_len((uint8_t *)aux+3, (uint8_t *)aux_limit);
    if (count == 0)
        goto err;

    size_t blen = auxB_size(sub_type, count);
    if (aux_limit - aux < blen + 4)
        goto err;

    if (!tm->blk) {
        if (!(tm->blk = cram_new_block(EXTERNAL, key)))
            goto err;
        codec->u.e_byte_array_len.val_codec->out = tm->blk;
        if (CRAM_MAJOR_VERS(fd->version) >= 4) {
            if (!(tm->blk2 = cram_new_block(EXTERNAL, key+128)))
                goto err;
            codec->u.e_byte_array_len.len_codec->out = tm->blk2;
        }
    }

    if (CRAM_MAJOR_VERS(fd->version) >= 4) {
        codec->u.e_byte_array_len.len_codec->encode(s,
            codec->u.e_byte_array_len.len_codec,
            (char *)&count, 1);
    }

    aux+=4;
    //codec->encode(s, codec, aux, blen);
    BLOCK_APPEND(tm->blk, aux, blen);
    aux+=blen;
    break;
}