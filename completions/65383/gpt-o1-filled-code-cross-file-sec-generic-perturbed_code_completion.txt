case 'Z':
        case 'H': {
            /* Find the null terminator */
            char *end = memchr(aux + 3, 0, aux_limit - (aux + 3));
            if (!end)
                goto err;

            /* Create block if needed */
            if (!tm->blk) {
                if (!(tm->blk = cram_new_block(EXTERNAL, key)))
                    goto err;
                codec->u.e_byte_array_len.val_codec->out = tm->blk;
            }

            int len = end - (aux + 3) + 1;
            aux += 3;
            BLOCK_APPEND(tm->blk, aux, len);
            aux += len;
            break;
        }

        case 'B': {
            /* Check we have enough data for B type: subtype + length */
            if (aux_limit - aux < 3 + 1 + 4)
                goto err;

            /* Create block if needed */
            if (!tm->blk) {
                if (!(tm->blk = cram_new_block(EXTERNAL, key)))
                    goto err;
                codec->u.e_byte_array_len.val_codec->out = tm->blk;
            }

            char st = aux[3];
            /* Decode little-endian 4-byte length */
            int32_t n = ((unsigned char)aux[4])         |
                        ((unsigned char)aux[5]) << 8  |
                        ((unsigned char)aux[6]) << 16 |
                        ((unsigned char)aux[7]) << 24;

            /* Determine subtype size */
            int size;
            switch (st) {
            case 'c': case 'C': case 'A':
                size = 1;
                break;
            case 's': case 'S':
                size = 2;
                break;
            case 'i': case 'I': case 'f':
                size = 4;
                break;
            default:
                hts_log_error("Unknown sub-type '%c' in 'B' tag", st);
                goto err;
            }

            /* Check we have entire array */
            if (aux_limit - aux < 3 + 1 + 4 + (int64_t)n * size)
                goto err;

            aux += 3;
            BLOCK_APPEND(tm->blk, aux, 1 + 4 + (size_t)n * size);
            aux += 1 + 4 + (size_t)n * size;
            break;
        }