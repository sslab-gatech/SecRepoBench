case 'H':
    if (aux_limit - aux < 4)
        goto err;

    if (!tm->blk) {
        if (!(tm->blk = cram_new_block(EXTERNAL, key)))
            goto err;
        codec->out = tm->blk;
    }

    aux+=3;
    int hex_len = 0;
    while (aux + hex_len < aux_limit && isxdigit(aux[hex_len]))
        hex_len++;

    if (hex_len == 0 || (hex_len % 2) != 0) {
        hts_log_error("Invalid hexadecimal string in tag");
        goto err;
    }

    if (codec->encode(s, codec, aux, hex_len) < 0)
        goto err;

    aux += hex_len;
    break;

case 'B': {
    if (aux_limit - aux < 5)
        goto err;

    uint8_t sub_type = aux[3];
    uint32_t count;
    int count_bytes;

    aux += 4;
    if (aux > aux_limit - 4)
        goto err;

    count = le_to_u32(aux);
    count_bytes = count *
        (sub_type == 'c' || sub_type == 'C' ? 1 :
         sub_type == 's' || sub_type == 'S' ? 2 :
         sub_type == 'i' || sub_type == 'I' || sub_type == 'f' ? 4 :
         0);

    if (count_bytes == 0 || aux > aux_limit - count_bytes)
        goto err;

    if (!tm->blk) {
        if (!(tm->blk = cram_new_block(EXTERNAL, key)))
            goto err;
        codec->u.e_byte_array_len.val_codec->out = tm->blk;
        if (codec->u.e_byte_array_len.len_codec->codec == E_EXTERNAL) {
            if (!(tm->blk2 = cram_new_block(EXTERNAL, key+128)))
                goto err;
            codec->u.e_byte_array_len.len_codec->out = tm->blk2;
        }
    }

    if (codec->encode(s, codec, aux, count_bytes) < 0)
        goto err;

    aux += count_bytes;
    break;
}