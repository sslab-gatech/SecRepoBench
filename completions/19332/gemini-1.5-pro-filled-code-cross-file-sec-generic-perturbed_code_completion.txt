while (offset < payload_length) {
        u_int16_t attr_type = ntohs(*(u_int16_t *)(payload + offset));
        u_int16_t attr_len = ntohs(*(u_int16_t *)(payload + offset + 2));

        // Ensure attr_len is aligned to 4-byte boundaries
        attr_len = (attr_len + 3) & ~3;

        switch (attr_type) {
        case 0x0006: // USERNAME attribute (often used in WhatsApp)
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
            return NDPI_IS_STUN;
        case 0x0008: // MESSAGE-INTEGRITY attribute
            if (flow->detected_protocol_stack[0] == NDPI_PROTOCOL_UNKNOWN) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
            }
            return NDPI_IS_STUN;
        case 0x0009: // ERROR-CODE attribute
            if (flow->detected_protocol_stack[0] == NDPI_PROTOCOL_UNKNOWN) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
            }
            return NDPI_IS_STUN;
        case 0x0015: // PRIORITY attribute
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
            return NDPI_IS_STUN;
        case 0x0020: // XOR-MAPPED-ADDRESS
            if (flow->detected_protocol_stack[0] == NDPI_PROTOCOL_UNKNOWN) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_TEAMVIEWER;
            }
            return NDPI_IS_STUN;
        case 0x8022: // SOFTWARE attribute (used to identify specific applications)
            if (attr_len >= sizeof("WhatsApp") - 1 &&
                !memcmp(payload + offset + 4, "WhatsApp", sizeof("WhatsApp") - 1)) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
                return NDPI_IS_STUN;
            }
            break;
        default:
            break;
        }

        // Advance to the next attribute
        offset += 4 + attr_len;

        // Check for buffer overflow to avoid infinite loops
        if (offset > payload_length) {
            return NDPI_IS_NOT_STUN;
        }
    }