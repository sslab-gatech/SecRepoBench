u_int offset = 20;

      /* Iterate over STUN attributes safely to avoid buffer overflows. */
      while((offset + 4) <= payload_length) {
        u_int16_t attr_type  = ntohs(*((u_int16_t*)&payload[offset]));
        u_int16_t attr_len   = ntohs(*((u_int16_t*)&payload[offset + 2]));
        u_int16_t aligned_len;
        const u_int8_t *attr_data;
        
        offset += 4;
        /* If the attribute length exceeds remaining payload, stop parsing. */
        if((offset + attr_len) > payload_length) {
          break;
        }
        
        attr_data = &payload[offset];
        aligned_len = (attr_len + 3) & ~3; /* Align to 4-byte boundary */

        /*
         * Example attribute checks:
         * - SOFTWARE (0x8022) might indicate specific vendors like
         *   "WhatsApp", "Skype", "Signal", etc.
         * - For demonstration, match strings in the SOFTWARE attribute
         *   to assign known host protocols.
         */
        if(attr_type == 0x8022 && attr_len > 0) {
          /* Look for textual indicators. */
          /* Make sure we don't read beyond attr_len. */
          char software_str[256];
          u_int16_t copy_len = (attr_len < (sizeof(software_str) - 1)) ? attr_len : (sizeof(software_str) - 1);
          memcpy(software_str, attr_data, copy_len);
          software_str[copy_len] = '\0';

          /* Example checks for known protocol strings. Adjust as needed. */
          if(strcasestr(software_str, "WhatsApp")) {
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
            goto udp_stun_found;
          } else if(strcasestr(software_str, "Skype")) {
            /* If NDPI_PROTOCOL_SKYPE is not defined, you can map it to something else. */
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_MESSENGER;
            goto udp_stun_found;
          } else if(strcasestr(software_str, "Signal")) {
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_SIGNAL;
            goto udp_stun_found;
          } else if(strcasestr(software_str, "Zoom")) {
            /* If NDPI_PROTOCOL_ZOOM is not defined, you can map it to a known protocol. */
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_STUN; /* Example fallback. */
            goto udp_stun_found;
          }
        }

        offset += aligned_len;
      }