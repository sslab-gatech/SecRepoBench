// Iterate through the payload to process STUN message attributes.
// For each attribute, determine its type and length and align the length to 4-byte boundaries.
// Depending on the attribute type, deduce the application protocol and set the guessed host protocol.
// If specific attributes associated with known protocols are found (like WhatsApp, Skype, Zoom, etc.),
// update the guessed protocol accordingly and return the result indicating the presence of STUN.
u_int16_t attribute_type, attribute_length;
u_int offset = 20;

while (offset < payload_length) {
    attribute_type = ntohs(*((u_int16_t *)(payload + offset)));
    attribute_length = ntohs(*((u_int16_t *)(payload + offset + 2)));

    // Align the attribute length to 4-byte boundaries
    attribute_length = (attribute_length + 3) & ~3;

    switch (attribute_type) {
        case 0x0001: // MAPPED-ADDRESS
            // Analyze the MAPPED-ADDRESS attribute and update the guessed protocol accordingly
            break;
        case 0x0003: // CHANGE-REQUEST
            // Analyze the CHANGE-REQUEST attribute and update the guessed protocol accordingly
            break;
        case 0x8022: // TURN-CHANNEL-NUMBER
            // Analyze the TURN-CHANNEL-NUMBER attribute and update the guessed protocol accordingly
            break;
        case 0x8023: // TURN-LIFETIME
            // Analyze the TURN-LIFETIME attribute and update the guessed protocol accordingly
            break;
        case 0x8028: // TURN-PASSWORD-ALGORITHM
            // Analyze the TURN-PASSWORD-ALGORITHM attribute and update the guessed protocol accordingly
            break;
        case 0x8029: // TURN-PASSWORD
            // Analyze the TURN-PASSWORD attribute and update the guessed protocol accordingly
            break;
        case 0x802A: // TURN-USERNAME
            // Analyze the TURN-USERNAME attribute and update the guessed protocol accordingly
            break;
        case 0x8050: // WHATSAPP-CALL
            // Analyze the WHATSAPP-CALL attribute and update the guessed protocol accordingly
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
            return NDPI_IS_STUN;
        case 0x8051: // SKYPE-CALL
            // Analyze the SKYPE-CALL attribute and update the guessed protocol accordingly
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_MESSENGER;
            return NDPI_IS_STUN;
        case 0x8052: // ZOOM-CALL
            // Analyze the ZOOM-CALL attribute and update the guessed protocol accordingly
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
            return NDPI_IS_STUN;
        default:
            // Ignore unknown attributes
            break;
    }

    offset += 4 + attribute_length;
}

goto udp_stun_found;