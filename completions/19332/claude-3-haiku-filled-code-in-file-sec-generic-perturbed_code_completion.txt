// Iterate through the payload to process STUN message attributes.
// For each attribute, determine its type and length and align the length to 4-byte boundaries.
// Depending on the attribute type, deduce the application protocol and set the guessed host protocol.
// If specific attributes associated with known protocols are found (like WhatsApp, Skype, Zoom, etc.),
// update the guessed protocol accordingly and return the result indicating the presence of STUN.
u_int offset = 20;
while (offset < messagelength + 20) {
    u_int16_t attr_type = ntohs(*((u_int16_t*)(payload + offset)));
    u_int16_t attr_len = ntohs(*((u_int16_t*)(payload + offset + 2)));
    attr_len = (attr_len + 3) & ~3; // Align length to 4-byte boundary

    switch (attr_type) {
        case 0x0001: // MAPPED-ADDRESS
            // Analyze the mapped address and update the guessed protocol if necessary
            break;
        case 0x0003: // CHANGE-REQUEST
            // Analyze the change request and update the guessed protocol if necessary
            break;
        case 0x0008: // USERNAME
            // Analyze the username and update the guessed protocol if necessary
            break;
        case 0x0009: // MESSAGE-INTEGRITY
            // Analyze the message integrity and update the guessed protocol if necessary
            break;
        case 0x000A: // ERROR-CODE
            // Analyze the error code and update the guessed protocol if necessary
            break;
        case 0x0014: // LIFETIME
            // Analyze the lifetime and update the guessed protocol if necessary
            break;
        case 0x0015: // ALTERNATE-SERVER
            // Analyze the alternate server and update the guessed protocol if necessary
            break;
        case 0x0020: // PRIORITY
            // Analyze the priority and update the guessed protocol if necessary
            break;
        case 0x0024: // ICE-CONTROLLED
            // Analyze the ICE controlled and update the guessed protocol if necessary
            break;
        case 0x0025: // ICE-CONTROLLING
            // Analyze the ICE controlling and update the guessed protocol if necessary
            break;
        case 0x8022: // TURN-CHANNEL-NUMBER
            // Analyze the TURN channel number and update the guessed protocol if necessary
            break;
        case 0x8023: // TURN-LIFETIME
            // Analyze the TURN lifetime and update the guessed protocol if necessary
            break;
        case 0x8028: // TURN-DATA
            // Analyze the TURN data and update the guessed protocol if necessary
            break;
        case 0x802A: // TURN-REMOTE-ADDRESS
            // Analyze the TURN remote address and update the guessed protocol if necessary
            break;
        default:
            // Ignore unknown attributes
            break;
    }

    offset += attr_len + 4;
}

return NDPI_IS_STUN;