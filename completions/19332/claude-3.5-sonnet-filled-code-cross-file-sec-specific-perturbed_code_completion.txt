while (offset < payload_length) {
  u_int16_t attribute_type = ntohs(*((u_int16_t*)&payload[offset]));
  u_int16_t attribute_len = ntohs(*((u_int16_t*)&payload[offset + 2]));

  offset += 4;

  if (attribute_len % 4 != 0)
    attribute_len += 4 - (attribute_len % 4);

  if (attribute_type == 0x8054) { /* Candidate identifier for WhatsApp */
    flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
    return(NDPI_IS_STUN);
  } else if (attribute_type == 0x8070) { /* MS-specific attribute */
    if (payload[offset] == 0x01) { /* Type is MS-Lync */
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE_TEAMS;
      return(NDPI_IS_STUN);
    }
  } else if (attribute_type == 0x8090) { /* Zoom-specific attribute */
    flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
    return(NDPI_IS_STUN);
  }

  offset += attribute_len;

  if (offset >= payload_length)
    break;
}

/* If no specific attributes were found, assume generic STUN */
flow->guessed_host_protocol_id = NDPI_PROTOCOL_STUN;