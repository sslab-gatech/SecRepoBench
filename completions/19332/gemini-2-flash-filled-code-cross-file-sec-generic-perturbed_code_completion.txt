while (offset < payload_length) {
        u_int16_t attribute_type = ntohs(*((u_int16_t*)&payload[offset]));
        u_int16_t attribute_length = ntohs(*((u_int16_t*)&payload[offset + 2]));
        u_int total_attribute_length = attribute_length + 4;

        if ((offset + total_attribute_length) > payload_length) {
          NDPI_LOG_ERROR(ndpi_struct, "STUN attribute length exceeds payload length, aborting dissection.\n");
          break;
        }

        // Align attribute length to 4-byte boundaries
        if ((attribute_length % 4) != 0) {
          attribute_length += (4 - (attribute_length % 4));
        }

        switch (attribute_type) {
          case 0x0006: /* XOR-MAPPED-ADDRESS */
            /* WhatsApp uses this */
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
            return(NDPI_IS_STUN);
            break;

          case 0x0009: /* SOFTWARE */
            if (attribute_length > 0) {
              char software[256];
              memset(software, 0, sizeof(software));
              strncpy(software, (const char*)&payload[offset + 4],
                      (attribute_length < (sizeof(software) - 1)) ? attribute_length : (sizeof(software) - 1));

              if (strstr(software, "Zoom")) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
                return(NDPI_IS_STUN);
              } else if (strstr(software, "Skype")) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
                return(NDPI_IS_STUN);
              }
            }
            break;

          case 0x8022: /* ICE-CONTROLLING */
          case 0x8023: /* ICE-CONTROLLED */
            /* Used by various protocols */
            break;

          default:
            /* Unknown attribute type */
            break;
        }

        offset += total_attribute_length;
      }