while((offset + 4) < payload_length) {
  u_int16_t attr_type = ntohs(*((u_int16_t*)&payload[offset]));
  u_int16_t attr_len = ntohs(*((u_int16_t*)&payload[offset+2]));
  u_int attr_len_padded = (attr_len + 3) & 0xFFFFFFFC; /* Align to 4-byte boundary */
  
  offset += 4; /* Skip the attribute header */
  
  if(attr_type == 0x8054 /* CANDIDATE IDENTIFIER */) {
    /* This is Ms Lync (former Skype) that later becomes RTP */
    flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE_TEAMS_CALL;
    return(NDPI_IS_STUN);
  } else if(attr_type == 0x8055 /* MS Service Quality */) {
    /* Skype/Teams */
    flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE_TEAMS_CALL;
    return(NDPI_IS_STUN);
  } else if(attr_type == 0x4000 /* PRIORITY attribute (RFC 5245) */) {
    /* Typical of many WebRTC applications */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN) {
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_WEBRTC;
    }
  } else if(attr_type == 0x8070 /* Implementation Version */) {
    /* Often seen in WhatsApp */
    flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
    return(NDPI_IS_STUN);
  } else if(attr_type == 0x000a /* USERNAME attribute */) {
    if(attr_len > 19 && payload[offset] == ':') {
      /* WhatsApp uses a specific format for username attribute */
      if(memcmp(&payload[offset], ":wic:", 5) == 0) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
        return(NDPI_IS_STUN);
      } else if(memcmp(&payload[offset], ":sic:", 5) == 0) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
        return(NDPI_IS_STUN);
      } else if(memcmp(&payload[offset], ":osirus:", 8) == 0 ||
               memcmp(&payload[offset], ":OSIRUS:", 8) == 0) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_FACEBOOK_VOIP;
        return(NDPI_IS_STUN);
      }
    }
  } else if(attr_type == 0x8028 /* SOFTWARE */) {
    if(attr_len > 7) {
      if(memcmp(&payload[offset], "signal", 6) == 0) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_SIGNAL;
        return(NDPI_IS_STUN);
      } else if(memcmp(&payload[offset], "Zoom", 4) == 0) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
        return(NDPI_IS_STUN);
      }
    }
  }

  offset += attr_len_padded; /* Move to the next attribute */
}