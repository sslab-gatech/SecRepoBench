while(offset + 4 <= payload_length) {
        u_int16_t attr_type = ntohs(*(u_int16_t*)&payload[offset]);
        u_int16_t attr_len  = ntohs(*(u_int16_t*)&payload[offset+2]);
        u_int16_t attr_len_aligned = (attr_len + 3) & ~3; // 4-byte alignment

        // WhatsApp Call: attribute type 0x8022 (XOR-MAPPED-ADDRESS) and 0x0006 (USERNAME)
        if(attr_type == 0x8022 || attr_type == 0x0006) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }

        // Skype/MS Lync: attribute type 0x8020 (SOFTWARE) or 0x0008 (MESSAGE-INTEGRITY)
        if(attr_type == 0x8020 || attr_type == 0x0008) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
          return(NDPI_IS_STUN);
        }

        // Zoom: attribute type 0x8028 (FINGERPRINT)
        if(attr_type == 0x8028) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
          return(NDPI_IS_STUN);
        }

        // Google Hangouts/Meet: attribute type 0x0009 (ERROR-CODE)
        if(attr_type == 0x0009) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_HANGOUT_DUO;
          return(NDPI_IS_STUN);
        }

        // Messenger: attribute type 0x8023 (RESERVED, but used by some Messenger impls)
        if(attr_type == 0x8023) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_MESSENGER;
          return(NDPI_IS_STUN);
        }

        // Prevent infinite loop on malformed packets
        if(attr_len_aligned == 0 || (offset + 4 + attr_len_aligned) > payload_length)
          break;

        offset += 4 + attr_len_aligned;
      }