u_int offset = 20;
  u_int8_t *attr_data = &payload[offset];
  u_int16_t attr_type, attr_length;

  while (offset + 4 <= payload_length) {
    attr_type = ntohs(*(u_int16_t *)&attr_data[0]);
    attr_length = ntohs(*(u_int16_t *)&attr_data[2]);

    if (attr_length % 4 != 0) {
      attr_length = (attr_length & ~0x03) + 4; // Align to 4-byte boundaries
    }

    if (offset + 4 + attr_length > payload_length) {
      break; // Invalid attribute length
    }

    switch (attr_type) {
      case 0x0001: // Username
        // Process Username attribute
        break;
      case 0x0006: // Message-Integrity
        // Process Message-Integrity attribute
        break;
      case 0x0008: // XOR-Mapped-Address
        // Process XOR-Mapped-Address attribute
        break;
      case 0x0014: // Software
        // Process Software attribute
        break;
      case 0x8029: // TURN Permissions
        // Process TURN Permissions attribute
        break;
      default:
        // Unknown attribute
        break;
    }

    offset += 4 + attr_length;
    attr_data = &payload[offset];
  }