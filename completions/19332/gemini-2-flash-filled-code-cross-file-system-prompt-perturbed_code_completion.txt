while (offset < payload_length) {
        u_int16_t attribute_type = ntohs(*((u_int16_t*)&payload[offset]));
        u_int16_t attribute_length = ntohs(*((u_int16_t*)&payload[offset + 2]));
        u_int16_t aligned_length = (attribute_length + 3) & ~0x03; // Align to 4-byte boundary

#ifdef DEBUG_STUN
        printf("Attribute Type: 0x%04X, Length: %u\n", attribute_type, attribute_length);
#endif

        if ((offset + 4 + attribute_length) > payload_length) {
          NDPI_LOG_ERROR(ndpi_struct, "STUN attribute exceeds payload length, aborting parsing\n");
          break;
        }

        switch (attribute_type) {
          case 0x0006: /* XOR-MAPPED-ADDRESS */
            /* WhatsApp uses this */
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
            return(NDPI_IS_STUN);
            break;

          case 0x0009: /* SOFTWARE */
            if (attribute_length > 0) {
              if (memcmp(&payload[offset + 4], "Zoom", 4) == 0) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
                return NDPI_IS_STUN;
              } else if (memcmp(&payload[offset + 4], "3CX", 3) == 0) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_THREE_CX;
                return NDPI_IS_STUN;
              }
            }
            break;

          case 0x8022: /* ICE-CONTROLLING */
          case 0x8029: /* ICE-CONTROLLED */
            /* Skype uses this */
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
            return(NDPI_IS_STUN);
            break;

          default:
            break;
        }

        offset += (4 + aligned_length);
      }