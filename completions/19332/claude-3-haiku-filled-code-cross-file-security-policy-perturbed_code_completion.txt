// Iterate through the payload to process STUN message attributes.
// For each attribute, determine its type and length and align the length to 4-byte boundaries.
// Depending on the attribute type, deduce the application protocol and set the guessed host protocol.
// If specific attributes associated with known protocols are found (like WhatsApp, Skype, Zoom, etc.),
// update the guessed protocol accordingly and return the result indicating the presence of STUN.
u_int16_t attr_type, attr_len;
u_int offset = 20;

while ((offset + 4) <= payload_length) {
    attr_type = ntohs(*((u_int16_t *) &payload[offset]));
    attr_len = ntohs(*((u_int16_t *) &payload[offset + 2]));

    switch (attr_type) {
        case 0x0001: // MAPPED-ADDRESS
        case 0x0020: // USERNAME
        case 0x0024: // REALM
        case 0x0027: // NONCE
            // Process STUN attributes related to WhatsApp, Skype, Zoom, etc.
            // Update the guessed protocol accordingly
            if (attr_type == 0x0001) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
                return NDPI_IS_STUN;
            }
            break;
        default:
            break;
    }

    // Align the attribute length to 4-byte boundaries
    attr_len = ((attr_len + 3) / 4) * 4;
    offset += (4 + attr_len);
}