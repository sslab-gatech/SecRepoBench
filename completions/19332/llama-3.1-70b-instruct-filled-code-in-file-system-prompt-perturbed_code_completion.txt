u_int offset = 20;
u_int attr_type, attr_len;

while(offset < payload_length) {
  attr_type = ntohs(*((u_int16_t*) &payload[offset]));
  attr_len = ntohs(*((u_int16_t*) &payload[offset + 2]));

  if(attr_len % 4!= 0)
    attr_len = (attr_len / 4 + 1) * 4;

  offset += 4 + attr_len;

  switch(attr_type) {
  case 0x0001: /* MAPPED-ADDRESS */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x0020: /* XOR-MAPPED-ADDRESS */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8028: /* SOFTWARE */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN) {
      if(strncmp((const char*)&payload[offset - attr_len], (const char*)"WhatsApp", 8) == 0)
	flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
      else if(strncmp((const char*)&payload[offset - attr_len], (const char*)"Skype", 5) == 0)
	flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
      else if(strncmp((const char*)&payload[offset - attr_len], (const char*)"Zoom", 4) == 0)
	flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
    }
    break;

  case 0x8029: /* ALTERNATE-SERVER */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8030: /* FINGERPRINT */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x802A: /* ICE-CONTROLLED */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x802B: /* ICE-CONTROLLING */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x802C: /* RESPONSE-PORT */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x802D: /* RESPONSE-ADDRESS */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x802E: /* OTHER-ADDRESS */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x802F: /* USERNAME */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8031: /* PASSWORD */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8032: /* MESSAGE-INTEGRITY */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8033: /* ERROR-CODE */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8034: /* UNKNOWN-ATTRIBUTES */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8035: /* CHANNEL-NUMBER */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8036: /* LIFETIME */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8037: /* BANDWIDTH */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8038: /* DESTINATION-ADDRESS */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8039: /* SOURCE-ADDRESS */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x803A: /* DATA */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x803B: /* REALM */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x803C: /* NONCE */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x803D: /* XOR-RELAYED-ADDRESS */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x803E: /* REQUESTED-TRANSPORT */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x803F: /* DONT-FRAGMENT */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8040: /* EVEN-PORT */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8041: /* REQUESTED-IP */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8042: /* RESERVATION-TOKEN */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8043: /* PRIORITY */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8044: /* USE-CANDIDATE */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8045: /* PADDING */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8046: /* RESPONSE-ORIGIN */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8047: /* OTHER-ADDRESS-ERROR-CODE */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8048: /* ENCRYPTION-KEY-LENGTH */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8049: /* ENCRYPTION-KEY */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x804A: /* EVEN-PORT-REQUEST */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x804B: /* LIFETIME64 */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x804C: /* ALTERNATE-DOMAIN */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8052: /* TIMER-VAL */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8057: /* ADDITIONAL-TLS-PORT */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8058: /* DONT-FRAGMENT-ON-CONSENT */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8059: /* Reserved (was DONT-FRAGMENT) */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x805A: /* Reserved (was ICE-PWD) */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x805B: /* UFRAG */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x805C: /* XOR-PASSWORD */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x805D: /* MESSAGE-INTEGRITY-SHA256 */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x805E: /* PEER-REFLEXIVE-ADDRESS */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x805F: /* SERVER-REFLEXIVE-ADDRESS */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8060: /* CHANNEL-NUMBER-EXTENDED */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8061: /* SECONDARY-ADDRESS */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8062: /* USE-CANDIDATE-EXTENDED */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8063: /* THIRD-PARTY-AUTHORIZATION */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8064: /* ECHO-REQUEST */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8065: /* ECHO-RESPONSE */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8066: /* RE-TRANSMIT-TIMER */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8067: /* DESIRED-TRANSPORT */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8068: /* LIFETIME64-EXTENDED */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x8069: /* ALTERNATE-SERVER-EXTENDED */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
    break;

  case 0x806A: /* ALTERNATE-DOMAIN-EXTENDED */
    if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN)
      flow->guesse