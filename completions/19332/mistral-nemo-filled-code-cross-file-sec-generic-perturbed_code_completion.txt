// Iterate through the payload to process STUN message attributes.
  u_int offset = 20;
  while (offset < payload_length) {
    u_int16_t attr_type = ntohs(*(u_int16_t*)(payload + offset));
    u_int16_t attr_length = ntohs(*(u_int16_t*)(payload + offset + 2));
    attr_length = (attr_length + 3) & ~3; // Align length to 4-byte boundaries.

    switch (attr_type) {
      case 0x0001: // MAPPED-ADDRESS
        if (attr_length == 12) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0002: // CHANGE-REQUEST
        if (flow->guessed_protocol_id == NDPI_PROTOCOL_STUN) {
          flow->guessed_protocol_id = NDPI_PROTOCOL_SKYPE;
        }
        break;
      // Add more attribute type cases as needed for other protocols.
      default:
        break;
    }

    offset += attr_length;
  }

  goto udp_stun_found;