{
  unsigned int offset = 20;
  while (offset + 4 <= payload_length) {
    u_int16_t attr_type = ntohs(*(u_int16_t *)(payload + offset));
    u_int16_t attr_len = ntohs(*(u_int16_t *)(payload + offset + 2));
    if (offset + 4 + attr_len > payload_length)
      break;

    // Check for specific attributes that help us identify the application protocol
    // These attribute type values are chosen as examples:
    // For instance, attribute 0x0008 might be associated with WhatsApp,
    // 0x0006 with Messenger/Skype, and 0x0024 with Google/Hangout Duo.
    if (attr_type == 0x0008) {
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
      return NDPI_IS_STUN;
    } else if (attr_type == 0x0006) {
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_MESSENGER;
      return NDPI_IS_STUN;
    } else if (attr_type == 0x0024) {
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_HANGOUT_DUO;
      return NDPI_IS_STUN;
    }
    
    // Move to the next attribute (attributes are padded to 4-byte boundaries)
    offset += 4 + ((attr_len + 3) & ~3);
  }
}