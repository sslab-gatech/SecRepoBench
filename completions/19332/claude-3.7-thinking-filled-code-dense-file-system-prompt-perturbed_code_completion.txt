while((offset + 4) < payload_length) {
  u_int16_t attr_type = ntohs(get_u_int16_t(payload, offset));
  u_int16_t attr_len = ntohs(get_u_int16_t(payload, offset + 2));
  
  offset += 4; // Move past attribute header
  
  if((attr_len + offset) > payload_length) {
    /* Invalid attribute length */
    break;
  }
  
  /* STUN Software attribute */
  if(attr_type == 0x8022) {
    if(attr_len > 0) {
      /* Check for specific software identifiers */
      if(attr_len >= 14 && memcmp(&payload[offset], "Messenger", 9) == 0) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_MESSENGER;
        return(NDPI_IS_STUN);
      } else if(attr_len >= 10 && memcmp(&payload[offset], "Google", 6) == 0) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_HANGOUT_DUO;
        return(NDPI_IS_STUN);
      } else if(attr_len >= 13 && memcmp(&payload[offset], "WhatsApp", 8) == 0) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
        return(NDPI_IS_STUN);
      } else if(attr_len >= 8 && memcmp(&payload[offset], "Zoom", 4) == 0) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
        return(NDPI_IS_STUN);
      }
    }
  } else if(attr_type == 0x8054) { /* CANDIDATE-IDENTIFIER */
    flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
    return(NDPI_IS_STUN);
  } else if(attr_type == 0x8055) { /* MS-Implementation-Version */
    flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE_TEAMS;
    return(NDPI_IS_STUN);
  }
  
  // Align attribute length to 4-byte boundary
  attr_len = (attr_len + 3) & (~3);
  
  // Move to next attribute
  offset += attr_len;
}

/* Continue to udp_stun_found */
goto udp_stun_found;