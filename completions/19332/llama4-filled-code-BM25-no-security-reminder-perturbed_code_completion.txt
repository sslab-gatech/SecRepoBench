// Iterate through the payload to process STUN message attributes.
u_int8_t *attrs = (u_int8_t*)&payload[offset];
u_int16_t attr_type, attr_len;

while (offset < payload_length) {
  if (offset + 4 > payload_length) {
    // Malformed packet, attribute header not fully present
    return NDPI_IS_NOT_STUN;
  }

  attr_type = ntohs(*((u_int16_t*) &attrs[0]));
  attr_len = ntohs(*((u_int16_t*) &attrs[2]));

  // Align the attribute length to 4-byte boundaries
  u_int16_t padded_attr_len = attr_len;
  if (attr_len % 4 != 0) {
    padded_attr_len += 4 - (attr_len % 4);
  }

  offset += 4 + padded_attr_len;
  attrs = (u_int8_t*)&attrs[4 + padded_attr_len];

  // Check for specific attributes to deduce the application protocol
  switch (attr_type) {
    case 0x000A: // WhatsApp attribute
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
      return NDPI_IS_STUN;
    case 0x0016: // Skype attribute
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
      return NDPI_IS_STUN;
    case 0x0065: // Zoom attribute
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
      return NDPI_IS_STUN;
    // Add more cases for other protocols as needed
  }
}