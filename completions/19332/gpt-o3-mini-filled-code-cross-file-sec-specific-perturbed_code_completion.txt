{
  u_int offset = 20;
  while (offset + 4 <= payload_length) {
    u_int16_t attr_type = ntohs(*(const u_int16_t *)(payload + offset));
    u_int16_t attr_length = ntohs(*(const u_int16_t *)(payload + offset + 2));

    /* Check that the attribute does not exceed the payload buffer */
    if (offset + 4 + attr_length > payload_length)
      break;

    /* Check for known protocol markers in STUN attributes.
       Attribute 0x0024 is typically the SOFTWARE attribute.
       Look for protocol-specific strings such as "WhatsApp". */
    if (attr_type == 0x0024 && attr_length >= 8) {
      if (memmem(payload + offset + 4, attr_length, "WhatsApp", 8) != NULL) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
        goto udp_stun_found;
      }
    }

    /* Check attribute 0x8022 for markers associated with Skype */
    if (attr_type == 0x8022 && attr_length >= 5) {
      if (memmem(payload + offset + 4, attr_length, "Skype", 5) != NULL) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_MESSENGER;
        goto udp_stun_found;
      }
    }

    /* Check attribute 0x8028 for markers associated with Zoom */
    if (attr_type == 0x8028 && attr_length >= 4) {
      if (memmem(payload + offset + 4, attr_length, "Zoom", 4) != NULL) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_HANGOUT_DUO;
        goto udp_stun_found;
      }
    }

    /* Advance offset past this attribute.
       Attribute length is padded to a multiple of 4 bytes. */
    u_int padded_length = (attr_length + 3) & ~3;
    offset += 4 + padded_length;
  }
}