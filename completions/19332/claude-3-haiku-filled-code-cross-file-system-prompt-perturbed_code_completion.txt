// Iterate through the payload to process STUN message attributes.
// For each attribute, determine its type and length and align the length to 4-byte boundaries.
// Depending on the attribute type, deduce the application protocol and set the guessed host protocol.
// If specific attributes associated with known protocols are found (like WhatsApp, Skype, Zoom, etc.),
// update the guessed protocol accordingly and return the result indicating the presence of STUN.
while (offset < messagelength) {
    u_int16_t attr_type = ntohs(*((u_int16_t *) &payload[offset]));
    u_int16_t attr_len = ntohs(*((u_int16_t *) &payload[offset + 2]));
    offset += 4; // Skip header

    // Align length to 4-byte boundary
    attr_len = ((attr_len + 3) / 4) * 4;

    switch (attr_type) {
        case 0x0001: // MAPPED-ADDRESS
        case 0x0020: // XOR-MAPPED-ADDRESS
            // Analyze the mapped address and update the guessed protocol if needed
            break;
        case 0x8022: // TURN-CHANNEL-NUMBER
        case 0x8023: // TURN-LIFETIME
        case 0x8028: // TURN-DATA
        case 0x802B: // TURN-REMOTE-ADDRESS
            // Analyze the TURN attributes and update the guessed protocol if needed
            break;
        case 0x8029: // TURN-REALM
        case 0x802A: // TURN-NONCE
            // Analyze the TURN authentication attributes and update the guessed protocol if needed
            break;
        case 0x8003: // FINGERPRINT
            // Analyze the STUN fingerprint and update the guessed protocol if needed
            break;
        case 0x8008: // SOFTWARE
            // Analyze the software attribute and update the guessed protocol if needed
            break;
        case 0x8027: // ICE-CONTROLLED
        case 0x8028: // ICE-CONTROLLING
            // Analyze the ICE attributes and update the guessed protocol if needed
            break;
        default:
            // Unrecognized attribute, skip it
            break;
    }

    offset += attr_len;
}

// After processing the STUN attributes, update the guessed protocol based on the findings
if (flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN) {
    flow->guessed_protocol_id = NDPI_PROTOCOL_STUN;
} else {
    // The STUN attributes indicated the presence of a known protocol like WhatsApp, Skype, Zoom, etc.
    // Update the guessed protocol accordingly
}

return NDPI_IS_STUN;