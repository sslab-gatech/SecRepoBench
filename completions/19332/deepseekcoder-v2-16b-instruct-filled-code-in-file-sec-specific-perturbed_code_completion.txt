u_int offset = 20;

  while (offset < payload_length) {
    u_int8_t attribute_type = payload[offset];
    u_int16_t attribute_length = payload[offset + 1];

    if (attribute_type == 0x0001) { // Mapped Address
      // Extract IP and port from the attribute
      u_int32_t ip = ntohl(*((u_int32_t*)(&payload[offset + 4])));
      u_int16_t port = ntohs(*((u_int16_t*)(&payload[offset + 8])));

      if (is_messenger_ip_address(ip)) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_MESSENGER;
        return NDPI_IS_STUN;
      } else if (is_google_ip_address(ip)) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_HANGOUT_DUO;
        return NDPI_IS_STUN;
      }
    } else if (attribute_type == 0x0006) { // Username
      // Extract username and check for known protocols
      // This is a placeholder for actual username parsing and protocol identification
    } else if (attribute_type == 0x0008) { // Message Integrity
      // This is a placeholder for message integrity attribute processing
    } else if (attribute_type == 0x000A) { // Error Code
      // This is a placeholder for error code attribute processing
    } else if (attribute_type == 0x000C) { // Unknown Attributes
      // This is a placeholder for unknown attributes processing
    }

    offset += attribute_length + 2; // Move to the next attribute
  }