while (offset < payload_length) {
        u_int16_t attr_type = ntohs(*(u_int16_t *)&payload[offset]);
        u_int16_t attr_length = ntohs(*(u_int16_t *)&payload[offset + 2]);
        u_int16_t aligned_length = (attr_length + 3) & ~0x03; // Align to 4-byte boundary

        if (offset + 4 + aligned_length > payload_length) {
          break; // Prevent buffer overflow
        }

        // Check for specific STUN attributes to identify protocols
        if (attr_type == 0x0001) { // Mapped Address
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
        } else if (attr_type == 0x0002) { // Response Address
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_SIGNAL;
        } else if (attr_type == 0x0003) { // Change Request
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_MESSENGER;
        }

        offset += 4 + aligned_length; // Move to the next attribute
      }