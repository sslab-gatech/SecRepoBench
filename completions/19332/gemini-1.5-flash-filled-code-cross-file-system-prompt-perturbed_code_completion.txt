while(offset < messagelength) {
        u_int16_t type = ntohs(*((u_int16_t*)(payload + offset)));
        u_int16_t len = ntohs(*((u_int16_t*)(payload + offset + 2)));
        u_int32_t attr_len = (len + 3) & ~3;

        switch(type) {
          case 0x0001: /* MAPPED-ADDRESS */
            if(len >= 8) {
              u_int32_t ip = ntohl(*((u_int32_t*)(payload + offset + 4)));
              u_int16_t port = ntohs(*((u_int16_t*)(payload + offset + 8)));

              if(is_messenger_ip_address(ip))
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_MESSENGER;
              else if(is_google_ip_address(ip))
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_HANGOUT_DUO;
            }
            break;

          case 0x0005: /* XOR-MAPPED-ADDRESS */
            if(len >= 8) {
              u_int32_t ip = ntohl(*((u_int32_t*)(payload + offset + 4)));
              u_int16_t port = ntohs(*((u_int16_t*)(payload + offset + 8)));

              if(is_messenger_ip_address(ip))
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_MESSENGER;
              else if(is_google_ip_address(ip))
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_HANGOUT_DUO;
            }
            break;

          case 0x0006: /* REFLECTED-FROM */
            break;

          case 0x0008: /* SOFTWARE */
            break;

          case 0x0009: /* ALTERNATE-SERVER */
            break;

          case 0x000A: /* FINGERPRINT */
            break;

          case 0x000B: /* ICE-CONTROLLING */
            break;

          case 0x000C: /* ICE-CONTROLLED */
            break;

          case 0x000D: /* REQUESTED-TRANSPORT */
            break;

          case 0x0010: /* USE-CANDIDATE */
            break;

          case 0x0011: /* CHANNEL-NUMBER */
            break;

          case 0x0012: /* LIFETIME */
            break;

          case 0x0013: /* CONNECTION-TIMEOUT */
            break;

          case 0x0014: /* CONNECTION-REQUEST */
            break;

          case 0x0015: /* CONNECTION-RESPONSE */
            break;

          case 0x0016: /* CONNECTION-ACK */
            break;

          case 0x0017: /* CONNECTION-ERROR */
            break;

          case 0x0018: /* CONNECTION-SUCCESS */
            break;

          case 0x0019: /* CONNECTION-FAILURE */
            break;

          case 0x001A: /* CONNECTION-CLOSE */
            break;

          case 0x001B: /* CONNECTION-REOPEN */
            break;

          case 0x001C: /* CONNECTION-ABORT */
            break;

          case 0x001D: /* CONNECTION-RESET */
            break;

          case 0x001E: /* CONNECTION-TIMEOUT */
            break;

          case 0x001F: /* CONNECTION-ERROR */
            break;

          case 0x0020: /* CONNECTION-SUCCESS */
            break;

          case 0x0021: /* CONNECTION-FAILURE */
            break;

          case 0x0022: /* CONNECTION-CLOSE */
            break;

          case 0x0023: /* CONNECTION-REOPEN */
            break;

          case 0x0024: /* CONNECTION-ABORT */
            break;

          case 0x0025: /* CONNECTION-RESET */
            break;

          default:
            break;
        }

        offset += attr_len;
      }