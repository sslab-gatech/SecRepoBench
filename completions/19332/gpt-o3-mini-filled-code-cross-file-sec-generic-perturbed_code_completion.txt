{
  u_int offset = 20;
  while (offset + 4 <= payload_length) {
    u_int16_t attr_type, attr_len;
    memcpy(&attr_type, payload + offset, sizeof(attr_type));
    memcpy(&attr_len, payload + offset + 2, sizeof(attr_len));
    attr_type = ntohs(attr_type);
    attr_len = ntohs(attr_len);

    /* Ensure we have the complete attribute within the payload */
    if (offset + 4 + attr_len > payload_length)
      break;

    /* Check for specific attribute types to deduce the application protocol */
    if (attr_type == 0x8022) { /* XOR-MAPPED-ADDRESS: example trigger for WhatsApp */
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
      return NDPI_IS_STUN;
    }
    else if (attr_type == 0x0006) { /* USERNAME: example trigger for Messenger/Skype */
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_MESSENGER;
      return NDPI_IS_STUN;
    }
    else if (attr_type == 0x8028) { /* VENDOR-SPECIFIC: example trigger for Hangout Duo */
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_HANGOUT_DUO;
      return NDPI_IS_STUN;
    }

    offset += 4 + attr_len;
    /* Align to 4-byte boundary */
    if (attr_len % 4 != 0)
      offset += (4 - (attr_len % 4));
  }
}