// Iterate through the payload to process STUN message attributes.
u_int offset = 20;
u_int attr_type, attr_len;

while (offset < payload_length) {
  attr_type = ntohs(*((u_int16_t*) &payload[offset]));
  attr_len = ntohs(*((u_int16_t*) &payload[offset + 2]));

  // Align the length to 4-byte boundaries.
  attr_len = (attr_len + 3) & ~3;

  // Check for specific attributes associated with known protocols.
  switch (attr_type) {
    case 0x0001: // MAPPED-ADDRESS
      // WhatsApp
      if (flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
      }
      break;
    case 0x0020: // XOR-MAPPED-ADDRESS
      // Skype
      if (flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
      }
      break;
    case 0x8028: // SOFTWARE
      // Zoom
      if (flow->guessed_host_protocol_id == NDPI_PROTOCOL_UNKNOWN) {
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
      }
      break;
    default:
      break;
  }

  offset += 4 + attr_len;
}

return NDPI_IS_STUN;