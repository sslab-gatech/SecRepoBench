while (offset < messagelength) {
        u_int16_t type = ntohs(*((u_int16_t*)(payload + offset)));
        u_int16_t len = ntohs(*((u_int16_t*)(payload + offset + 2)));
        u_int32_t attr_len = (len + 3) & ~3; // Align to 4-byte boundary

        switch (type) {
          case 0x0001: // MAPPED-ADDRESS
            if (attr_len >= 8) {
              u_int32_t ip = ntohl(*((u_int32_t*)(payload + offset + 4)));
              if (is_google_ip_address(ip)) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_HANGOUT_DUO;
              } else if (is_messenger_ip_address(ip)) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_MESSENGER;
              }
            }
            break;
          case 0x0005: // XOR-MAPPED-ADDRESS
            if (attr_len >= 8) {
              u_int32_t ip = ntohl(*((u_int32_t*)(payload + offset + 4)));
              if (is_google_ip_address(ip)) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_HANGOUT_DUO;
              } else if (is_messenger_ip_address(ip)) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_MESSENGER;
              }
            }
            break;
          case 0x0006: // SOFTWARE
            // Check for specific software strings to identify protocols
            break;
          case 0x0008: // ALTERNATE-SERVER
            // Check for specific server addresses to identify protocols
            break;
          // Add more cases for other STUN attributes as needed
          default:
            break;
        }
        offset += attr_len;
      }