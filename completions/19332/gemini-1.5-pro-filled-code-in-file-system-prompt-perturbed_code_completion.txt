while (offset + 4 <= payload_length) {
        u_int16_t attr_type = ntohs(*((u_int16_t*)(payload + offset)));
        u_int16_t attr_len = ntohs(*((u_int16_t*)(payload + offset + 2)));

        // Align the length to 4-byte boundaries
        attr_len = (attr_len + 3) & ~3;

        switch (attr_type) {
        case 0x0006: // USERNAME
        case 0x0008: // MESSAGE-INTEGRITY
        case 0x0009: // ERROR-CODE
        case 0x000C: // REALM
        case 0x0014: // REALM
        case 0x0015: // NONCE
        case 0x8022: // SOFTWARE
        case 0x8028: // FINGERPRINT
        case 0x802A: // ICE-CONTROLLED
        case 0x802B: // ICE-CONTROLLING
        case 0x0025: // PRIORITY
        case 0x0001: // MAPPED-ADDRESS
        case 0x0003: // CHANGE-REQUEST
        case 0x0004: // SOURCE-ADDRESS
        case 0x0005: // CHANGED-ADDRESS
          break;

        case 0x0012: // XOR-PEER-ADDRESS
          if (flow->packet.udp->dest == htons(3478)) {
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
            return NDPI_IS_STUN;
          }
          break;

        case 0x0016: // XOR-RELAYED-ADDRESS
          if (flow->packet.udp->dest == htons(3478)) {
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
            return NDPI_IS_STUN;
          }
          break;

        case 0x0020: // XOR-MAPPED-ADDRESS
          if (flow->packet.udp->dest == htons(3478)) {
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
            return NDPI_IS_STUN;
          } else if (flow->packet.udp->dest == htons(50000) || flow->packet.udp->source == htons(50000)) {
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
            return NDPI_IS_STUN;
          } else if (flow->packet.udp->dest == htons(50001) || flow->packet.udp->source == htons(50001)) {
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
            return NDPI_IS_STUN;
          }
          break;

        default:
#ifdef DEBUG_STUN
          printf("[STUN] Unknown attribute %04x (len=%u)\n", attr_type, attr_len);
#endif
          break;
        }

        offset += 4 + attr_len;
      }