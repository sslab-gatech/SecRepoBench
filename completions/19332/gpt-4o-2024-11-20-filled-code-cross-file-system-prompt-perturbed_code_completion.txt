while(offset < payload_length) {
        if((offset + 4) > payload_length) break;

        u_int16_t attr_type = ntohs(*((u_int16_t*)&payload[offset]));
        u_int16_t attr_length = ntohs(*((u_int16_t*)&payload[offset + 2]));

        if((offset + 4 + attr_length) > payload_length) break;

        switch(attr_type) {
          case 0x0006: /* USERNAME */
          case 0x0015: /* NONCE */
          case 0x0008: /* MESSAGE-INTEGRITY */
          case 0x0020: /* XOR-MAPPED-ADDRESS */
            /* These are common STUN attributes, continue processing */
            break;

          case 0x8022: /* SOFTWARE */
            if(attr_length > 0) {
              if(strncmp((const char*)&payload[offset + 4], "WhatsApp", 8) == 0) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
                return(NDPI_IS_STUN);
              } else if(strncmp((const char*)&payload[offset + 4], "Skype", 5) == 0) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
                return(NDPI_IS_STUN);
              } else if(strncmp((const char*)&payload[offset + 4], "Zoom", 4) == 0) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
                return(NDPI_IS_STUN);
              }
            }
            break;

          case 0x8028: /* FINGERPRINT */
            /* This attribute is used for message integrity, continue processing */
            break;

          default:
            /* Unknown attribute, skip it */
            break;
        }

        /* Align to 4-byte boundary */
        offset += 4 + ((attr_length + 3) & ~3);
      }