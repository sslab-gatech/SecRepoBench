while (offset < (messagelength + 20)) {
        u_int16_t attr_type = ntohs(*(u_int16_t *)&payload[offset]);
        u_int16_t attr_length = ntohs(*(u_int16_t *)&payload[offset + 2]);

        // Ensure we do not exceed the payload length
        if (offset + 4 + attr_length > payload_length) {
          return NDPI_IS_NOT_STUN; // Invalid length
        }

        // Align length to 4-byte boundaries
        u_int16_t aligned_length = (attr_length + 3) & ~3;

        // Check for specific STUN attributes and update guessed protocol
        if (attr_type == 0x0001) { // Mapped-Address
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
        } else if (attr_type == 0x0002) { // Response-Address
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_SIGNAL;
        }

        // Move to the next attribute
        offset += 4 + aligned_length;
      }