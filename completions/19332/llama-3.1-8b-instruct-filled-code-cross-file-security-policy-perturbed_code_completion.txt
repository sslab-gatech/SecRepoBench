// Iterate through the payload to process STUN message attributes.
// For each attribute, determine its type and length and align the length to 4-byte boundaries.
// Depending on the attribute type, deduce the application protocol and set the guessed host protocol.
// If specific attributes associated with known protocols are found (like WhatsApp, Skype, Zoom, etc.),
// update the guessed protocol accordingly and return the result indicating the presence of STUN.
for (u_int offset = 20; offset < payload_length; offset += 4) {
  u_int32_t attr_type = ntohl(*((u_int32_t*) &payload[offset]));
  u_int32_t attr_length = ntohl(*((u_int32_t*) &payload[offset + 4]));

  if (attr_length > 0 && attr_length <= (payload_length - offset - 8)) {
    // Process the attribute
    switch (attr_type) {
      case 0x0001: // MAPPED-ADDRESS
        // Check if the mapped address is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0002: // USERNAME
        // Check if the username is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0003: // MESSAGE-INTEGRITY
        // Check if the message integrity is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0004: // ERROR-CODE
        // Check if the error code is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0005: // UNKNOWN-ATTRIBUTES
        // Check if the unknown attributes are associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0006: // REALM
        // Check if the realm is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0007: // NONCE
        // Check if the nonce is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0008: // SERVER
        // Check if the server is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0009: // MAX-MESSAGE-SIZE
        // Check if the max message size is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x000A: // MESSAGE-SIZE
        // Check if the message size is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x000B: // FINGERPRINT
        // Check if the fingerprint is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x000C: // ERROR-CATEGORY
        // Check if the error category is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x000D: // UNKNOWN-ATTRIBUTES-2
        // Check if the unknown attributes 2 are associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x000E: // REALM-REQUESTED
        // Check if the realm requested is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x000F: // NONCE-SUM
        // Check if the nonce sum is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0010: // MESSAGE-INTEGRITY-SIGNATURE
        // Check if the message integrity signature is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0011: // FINGERPRINT-ALGORITHM
        // Check if the fingerprint algorithm is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0012: // ERROR-CATEGORY-2
        // Check if the error category 2 is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0013: // UNKNOWN-ATTRIBUTES-3
        // Check if the unknown attributes 3 are associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0014: // REALM-REQUESTED-2
        // Check if the realm requested 2 is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0015: // NONCE-SUM-2
        // Check if the nonce sum 2 is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0016: // MESSAGE-INTEGRITY-SIGNATURE-2
        // Check if the message integrity signature 2 is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0017: // FINGERPRINT-ALGORITHM-2
        // Check if the fingerprint algorithm 2 is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0018: // ERROR-CATEGORY-3
        // Check if the error category 3 is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0019: // UNKNOWN-ATTRIBUTES-4
        // Check if the unknown attributes 4 are associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x001A: // REALM-REQUESTED-3
        // Check if the realm requested 3 is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x001B: // NONCE-SUM-3
        // Check if the nonce sum 3 is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x001C: // MESSAGE-INTEGRITY-SIGNATURE-3
        // Check if the message integrity signature 3 is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x001D: // FINGERPRINT-ALGORITHM-3
        // Check if the fingerprint algorithm 3 is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x001E: // ERROR-CATEGORY-4
        // Check if the error category 4 is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x001F: // UNKNOWN-ATTRIBUTES-5
        // Check if the unknown attributes 5 are associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0020: // REALM-REQUESTED-4
        // Check if the realm requested 4 is associated with a known protocol
        if (payload[offset + 8] == 0x01 && payload[offset + 9] == 0x00) {
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return(NDPI_IS_STUN);
        }
        break;
      case 0x0021: // NONCE-SUM-4
        // Check if the nonce sum 4 is associated with a know