while (offset < payload_length) {
        u_int16_t attr_type = ntohs(*((u_int16_t*)(payload + offset)));
        u_int16_t attr_len = ntohs(*((u_int16_t*)(payload + offset + 2)));
        u_int32_t attr_len_aligned = (attr_len + 3) & ~3;

        if ((offset + 4 + attr_len_aligned) > payload_length)
          break;

        switch (attr_type) {
          case 0x0001: // MAPPED-ADDRESS
            if (attr_len >= 8) {
              flow->guessed_host_protocol_id = NDPI_PROTOCOL_VOIP;
            }
            break;
          case 0x0005: // RESPONSE-ORIGIN
            if (attr_len >= 8) {
              flow->guessed_host_protocol_id = NDPI_PROTOCOL_VOIP;
            }
            break;
          case 0x0006: // CHANGE-REQUEST
            if (attr_len >= 8) {
              flow->guessed_host_protocol_id = NDPI_PROTOCOL_VOIP;
            }
            break;
          case 0x0008: // ERROR-CODE
            if (attr_len >= 8) {
              flow->guessed_host_protocol_id = NDPI_PROTOCOL_VOIP;
            }
            break;
          case 0x0009: // UNKNOWN-ATTRIBUTES
            if (attr_len >= 8) {
              flow->guessed_host_protocol_id = NDPI_PROTOCOL_VOIP;
            }
            break;
          case 0x000A: // REFLECTED-FROM
            if (attr_len >= 8) {
              flow->guessed_host_protocol_id = NDPI_PROTOCOL_VOIP;
            }
            break;
          case 0x8022: // ICE-CONTROLLING
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WEBRTC;
            break;
          case 0x8023: // ICE-CONTROLLED
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WEBRTC;
            break;
          case 0x8024: // TURN-CREDENTIALS
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_TURN;
            break;
          case 0x8025: // TURN-ALLOCATE
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_TURN;
            break;
          case 0x8026: // TURN-REFRESH
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_TURN;
            break;
          case 0x8027: // TURN-SEND
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_TURN;
            break;
          case 0x8028: // TURN-DATA
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_TURN;
            break;
          case 0x8029: // TURN-CHANNEL
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_TURN;
            break;
          case 0x802A: // TURN-CHANNEL-DATA
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_TURN;
            break;
          default:
            break;
        }
        offset += 4 + attr_len_aligned;
      }