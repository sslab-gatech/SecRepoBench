while (offset < messagelength && offset + 4 <= payload_length) {
        u_int16_t attr_type = ntohs(*(u_int16_t *)(payload + offset));
        u_int16_t attr_len = ntohs(*(u_int16_t *)(payload + offset + 2));

        if (attr_len + offset + 4 > payload_length) {
          // Invalid attribute length, stop processing
          break;
        }

        switch (attr_type) {
        case 0x0006: // CHANNEL-NUMBER
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return NDPI_IS_STUN;
        case 0x0009: // LIFETIME
          if (flow->packet.udp->dest == htons(50000) || flow->packet.udp->source == htons(50000)) {
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
            return NDPI_IS_STUN;
          }
          break;
        case 0x000C: // SOFTWARE
          if (attr_len >= 12 && memcmp(payload + offset + 4, "WhatsApp", 8) == 0) {
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
            return NDPI_IS_STUN;
          } else if (attr_len >= 6 && memcmp(payload + offset + 4, "Skype", 5) == 0) {
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
            return NDPI_IS_STUN;
          }
          break;
        case 0x0015: // PRIORITY
          flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          return NDPI_IS_STUN;
        case 0x0025: // ICE-CONTROLLED
        case 0x0026: // ICE-CONTROLLING
          if (flow->packet.udp->dest == htons(50000) || flow->packet.udp->source == htons(50000)) {
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
            return NDPI_IS_STUN;
          }
          break;
        }

        // Align attribute length to 4-byte boundary
        offset += 4 + ((attr_len + 3) & ~3);
      }