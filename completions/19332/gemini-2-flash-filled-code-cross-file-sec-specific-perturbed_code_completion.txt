while (offset < payload_length) {
        u_int16_t attribute_type = ntohs(*((u_int16_t*)&payload[offset]));
        u_int16_t attribute_length = ntohs(*((u_int16_t*)&payload[offset + 2]));
        u_int16_t aligned_length = (attribute_length + 3) & ~0x03; // Align to 4-byte boundary

        if ((offset + 4 + aligned_length) > payload_length) {
          NDPI_LOG_ERROR(ndpi_struct, "STUN attribute length exceeds payload length, attribute_type: %04X, attribute_length: %u, aligned_length: %u, offset: %u, payload_length: %u\n",
                         attribute_type, attribute_length, aligned_length, offset, payload_length);
          return NDPI_IS_NOT_STUN;
        }

        switch (attribute_type) {
          case 0x0006: /* XOR-MAPPED-ADDRESS */
            /* WhatsApp uses STUN with XOR-MAPPED-ADDRESS */
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
            return NDPI_IS_STUN;
            break;

          case 0x0009: /* SOFTWARE */
          {
            /* Check if the software attribute contains "Zoom" */
            if (attribute_length > 0 && attribute_length < 256) {
              char software_string[256];
              memcpy(software_string, &payload[offset + 4], attribute_length);
              software_string[attribute_length] = '\0';

              if (strstr(software_string, "Zoom")) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
                return NDPI_IS_STUN;
              }
            }
            break;
          }

          case 0x8022: /* ICE-CONTROLLING */
          case 0x8023: /* ICE-CONTROLLED */
            /* Skype uses STUN with ICE-CONTROLLING and ICE-CONTROLLED */
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
            return NDPI_IS_STUN;
            break;

          default:
            break;
        }

        offset += 4 + aligned_length;
      }