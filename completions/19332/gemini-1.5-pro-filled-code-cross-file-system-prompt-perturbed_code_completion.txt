while (offset < messagelength + 20) {
        u_int16_t attr_type = ntohs(*(u_int16_t *)(payload + offset));
        u_int16_t attr_len = ntohs(*(u_int16_t *)(payload + offset + 2));

        // Align the length to 4-byte boundaries
        attr_len = (attr_len + 3) & ~3;

        switch (attr_type) {
        case 0x0006: // USERNAME attribute (WhatsApp)
            if (attr_len >= 16 && memcmp(payload + offset + 4, "npp_", 4) == 0) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
                return NDPI_IS_STUN;
            }
            break;

        case 0x0008: // MESSAGE-INTEGRITY attribute (WhatsApp, Skype)
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL; // Or Skype
            return NDPI_IS_STUN;

        case 0x0009: // ERROR-CODE attribute
        case 0x000A: // UNKNOWN-ATTRIBUTES attribute
        case 0x0014: // REALM attribute
        case 0x0015: // NONCE attribute
        case 0x0020: // XOR-MAPPED-ADDRESS attribute
            break;

        case 0x8022: // SOFTWARE attribute (Zoom)
            if (attr_len >= 4 && memcmp(payload + offset + 4, "Zoom", 4) == 0) {
                flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
                return NDPI_IS_STUN;
            }
            break;

        default:
            break;
        }

        offset += 4 + attr_len;
    }