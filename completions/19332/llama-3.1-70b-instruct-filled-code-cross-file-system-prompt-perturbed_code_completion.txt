u_int offset = 20;
u_int attr_type, attr_len;

while(offset < messagelength) {
  attr_type = ntohs(*((u_int16_t*) &payload[offset]));
  attr_len = ntohs(*((u_int16_t*) &payload[offset+2]));

  // Align the length to 4-byte boundaries
  attr_len = (attr_len + 3) & ~3;

  switch(attr_type) {
    case 0x0001: // MAPPED-ADDRESS
      // Check if this is a WhatsApp Call
      if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_WHATSAPP_CALL)
        return(NDPI_IS_STUN);
      break;

    case 0x0020: // XOR-MAPPED-ADDRESS
      // Check if this is a Skype or Lync protocol
      if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_SKYPE ||
         flow->guessed_host_protocol_id == NDPI_PROTOCOL_LYNC)
        return(NDPI_IS_STUN);
      break;

    case 0x8028: // SOFTWARE
      // Check if this is a Zoom protocol
      if(flow->guessed_host_protocol_id == NDPI_PROTOCOL_ZOOM)
        return(NDPI_IS_STUN);
      break;

    default:
      break;
  }

  offset += 4 + attr_len;
}