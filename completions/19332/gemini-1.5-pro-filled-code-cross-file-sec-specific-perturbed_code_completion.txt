while (offset < payload_length) {
    u_int16_t attr_type = ntohs(*(u_int16_t *)(payload + offset));
    u_int16_t attr_len = ntohs(*(u_int16_t *)(payload + offset + 2));

    if (attr_len + offset + 4 > payload_length) {
        // Attribute length exceeds payload boundary. Malformed packet.
        return NDPI_IS_NOT_STUN;
    }

    switch (attr_type) {
    case 0x0006: // CHANNEL-NUMBER
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
        return NDPI_IS_STUN;
    case 0x0009: // LIFETIME
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
        return NDPI_IS_STUN;
    case 0x000C: // SOFTWARE
        if(attr_len >= 5 && !strncmp((const char*)payload + offset + 4, "Wire", 4)) {
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WIRE;
            return NDPI_IS_STUN;
        }
        break;
    case 0x0015: // PRIORITY
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
        return NDPI_IS_STUN;
    case 0x0020: // XOR-MAPPED-ADDRESS
        if(flow->protos.stun_ssl.stun.num_binding_requests >= 4) {
            flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
            return NDPI_IS_STUN;
        }
        break;

    default:
        break;
    }

    offset += 4 + attr_len;
    if (attr_len % 4 != 0) {
        offset += (4 - (attr_len % 4));
    }
}