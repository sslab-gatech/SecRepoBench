{
  /* Iterate over STUN attributes starting right after the header (offset=20). */
  while ((offset + 4) <= payload_length) {
    u_int16_t attr_type = (payload[offset] << 8) | payload[offset + 1];
    u_int16_t attr_len  = (payload[offset + 2] << 8) | payload[offset + 3];
    u_int     attr_end  = offset + 4 + attr_len;

    /* Make sure we don't read beyond the payload. */
    if (attr_end > payload_length)
      break;

    switch (attr_type) {
      case 0x8022: /* SOFTWARE attribute (RFC 5389) */
        /*
         * We can parse the software string here. If it indicates a specific app
         * (e.g., "Signal", "WhatsApp", "Messenger", "Duo"), we can set the
         * guessed_host_protocol_id accordingly. Example:
         *
         * if(strstr((const char *)&payload[offset+4], "Signal"))
         *   flow->guessed_host_protocol_id = NDPI_PROTOCOL_SIGNAL;
         *
         * if(strstr((const char *)&payload[offset+4], "WhatsApp"))
         *   flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
         */
        break;

      /* Add extra cases to check for other STUN attributes if needed. */
      default:
        /* Unknown or unhandled attribute type; just skip it. */
        break;
    }

    /* Move to the next attribute boundary, aligning length to a 4-byte boundary. */
    attr_len = (attr_len + 3) & ~3;
    offset  += 4 + attr_len;
  }
}