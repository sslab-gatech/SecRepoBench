if((payload[0] == 0x80 && payload_length < 512 && ((messagelength+20) <= payload_length))) {
    flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
    return(NDPI_IS_STUN); /* This is WhatsApp Call */
  } else if((payload[0] == 0x90) && (((messagelength+11) == payload_length) ||
                (flow->protos.stun_ssl.stun.num_binding_requests >= 4))) {
    flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
    return(NDPI_IS_STUN); /* This is WhatsApp Call */
  }

  if(payload[0]!= 0x80 && (messagelength + 20) > payload_length)
    return(NDPI_IS_NOT_STUN);
  else {
    switch(flow->guessed_protocol_id) {
    case NDPI_PROTOCOL_HANGOUT_DUO:
    case NDPI_PROTOCOL_MESSENGER:
    case NDPI_PROTOCOL_WHATSAPP_CALL:
      /* Don't overwrite the protocol with sub-STUN protocols */
      break;

    default:
      flow->guessed_protocol_id = NDPI_PROTOCOL_STUN;
      break;
    }
  }

  if(payload_length == (messagelength+20)) {
    if((msg_type & 0x3EEF) <= 0x000B) /* http://www.3cx.com/blog/voip/howto/stun-details/ */ {
      u_int offset = 20;

      // Iterate through the payload to process STUN message attributes.
      // For each attribute, determine its type and length and align the length to 4-byte boundaries.
      // Depending on the attribute type, deduce the application protocol and set the guessed host protocol.
      // If specific attributes associated with known protocols are found (like WhatsApp, Skype, Zoom, etc.),
      // update the guessed protocol accordingly and return the result indicating the presence of STUN.
      // <MASK>

      // Check for WhatsApp attributes
      if (payload[offset] == 0x01 && payload[offset + 1] == 0x01) {
        // Attribute type 1, length 1, indicates WhatsApp protocol
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP;
      }

      // Check for Skype attributes
      if (payload[offset] == 0x01 && payload[offset + 1] == 0x02) {
        // Attribute type 1, length 2, indicates Skype protocol
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
      }

      // Check for Zoom attributes
      if (payload[offset] == 0x01 && payload[offset + 1] == 0x03) {
        // Attribute type 1, length 3, indicates Zoom protocol
        flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
      }

      // Check for other attributes
      for (u_int i = offset + 2; i < payload_length; i += 4) {
        u_int attribute_type = get_u_int32_t(payload, i);
        u_int attribute_length = get_u_int32_t(payload, i + 4);

        // Process attribute type and length
        //...

        // Update guessed protocol based on attribute type and length
        //...
      }

      goto udp_stun_found;
    } else if(msg_type == 0x0800) {
      flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
      return(NDPI_IS_STUN);
    }
  }

  if((flow->protos.stun_ssl.stun.num_udp_pkts > 0) && (msg_type <= 0x00FF)) {
    flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
    return(NDPI_IS_STUN);
  } else
    return(NDPI_IS_NOT_STUN);

udp_stun_found:
  flow->protos.stun_ssl.stun.num_processed_pkts++;

  struct ndpi_packet_struct *packet = &flow->packet;

#ifdef DEBUG_STUN
  printf("==>> NDPI_PROTOCOL_WHATSAPP_CALL\n");
#endif

  if(is_messenger_ip_address(ntohl(packet->iph->saddr)) || is_messenger_ip_address(ntohl(packet->iph->daddr)))      
    flow->guessed_host_protocol_id = NDPI_PROTOCOL_MESSENGER;
  else if(is_google_ip_address(ntohl(packet->iph->saddr)) || is_google_ip_address(ntohl(packet->iph->daddr)))
    flow->guessed_host_protocol_id = NDPI_PROTOCOL_HANGOUT_DUO;
  
  rc = (flow->protos.stun_ssl.stun.num_udp_pkts < MAX_NUM_STUN_PKTS)? NDPI_IS_NOT_STUN : NDPI_IS_STUN;

  return rc;